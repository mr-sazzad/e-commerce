
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="8ebcdabe-4469-56a6-9d9c-320e57af2f61")}catch(e){}}();
(()=>{var Nv=Object.create;var Xd=Object.defineProperty;var Rv=Object.getOwnPropertyDescriptor;var Ov=Object.getOwnPropertyNames;var Fv=Object.getPrototypeOf,xv=Object.prototype.hasOwnProperty;var Co=(i,e)=>()=>(i&&(e=i(i=0)),e);var Hh=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),vi=(i,e)=>{for(var t in e)Xd(i,t,{get:e[t],enumerable:!0})},a_=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ov(e))!xv.call(i,r)&&r!==t&&Xd(i,r,{get:()=>e[r],enumerable:!(n=Rv(e,r))||n.enumerable});return i};var $a=(i,e,t)=>(t=i!=null?Nv(Fv(i)):{},a_(e||!i||!i.__esModule?Xd(t,"default",{value:i,enumerable:!0}):t,i)),Ei=i=>a_(Xd({},"__esModule",{value:!0}),i);var l_={};vi(l_,{ByteBuffer:()=>Ci});var zh,s_,Ci,jd=Co(()=>{zh=new Int32Array(1),s_=new Float32Array(zh.buffer),Ci=class i{constructor(e){if(e&&!(e instanceof Uint8Array))throw new Error("Must initialize a ByteBuffer with a Uint8Array");this._data=e||new Uint8Array(256),this._index=0,this._start=0,this.length=e?e.length:0}extendWindowTo(e){this._index=e._index}getNewWindowFromRight(){let e=new i(this._data);return e._index=this._index,e._start=this._index,e}windowToUint8Array(){return this._data.subarray(this._start,this._index)}toUint8Array(){return this._data.subarray(0,this.length)}readByte(){if(this._index+1>this._data.length)throw new Error("Index out of bounds");return this._data[this._index++]}readByteArray(){let e=this.readVarUint(),t=this._index,n=t+e;if(n>this._data.length)throw new Error("Read array out of bounds");this._index=n;let r=new Uint8Array(e);return r.set(this._data.subarray(t,n)),r}readVarFloat(){let e=this._index,t=this._data,n=t.length;if(e+1>n)throw new Error("Index out of bounds");let r=t[e];if(r===0)return this._index=e+1,0;if(e+4>n)throw new Error("Index out of bounds");let o=r|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24;return this._index=e+4,o=o<<23|o>>>9,zh[0]=o,s_[0]}readVarUint(){let e=0,t=0;do{var n=this.readByte();e|=(n&127)<<t,t+=7}while(n&128&&t<35);return e>>>0}readVarInt(){let e=this.readVarUint()|0;return e&1?~(e>>>1):e>>>1}readVarUint64Bin(){let e=0,t="";do{var n=this.readByte();if(e<8){let r=((n&127)>>>0).toString(2);t=(n&128?r.padStart(7,"0"):r)+t}else{t=n.toString(2)+t;break}e+=1}while(n&128);return t}readVarUint64(){return this.convertBase(this.readVarUint64Bin(),2,10)}readVarInt64(){let e=this.readVarUint64Bin();if(e.slice(-1)=="1"){let t=this.parseToDigitsArray(e.slice(0,-1),2);return t=this.add(t,[1],2),"-"+this.convertBase(this.parseFromDigitsArray(t,2),2,10)}else return this.convertBase(e.slice(0,-1),2,10)}readString(){let e="";for(;;){let t,n=this.readByte();if(n<192)t=n;else{let r=this.readByte();if(n<224)t=(n&31)<<6|r&63;else{let o=this.readByte();if(n<240)t=(n&15)<<12|(r&63)<<6|o&63;else{let a=this.readByte();t=(n&7)<<18|(r&63)<<12|(o&63)<<6|a&63}}}if(t===0)break;t<65536?e+=String.fromCharCode(t):(t-=65536,e+=String.fromCharCode((t>>10)+55296,(t&1024-1)+56320))}return e}_growBy(e){if(this.length+e>this._data.length){let t=new Uint8Array(this.length+e<<1);t.set(this._data),this._data=t}this.length+=e}writeByte(e){let t=this.length;this._growBy(1),this._data[t]=e}writeByteArray(e){this.writeVarUint(e.length);let t=this.length;this._growBy(e.length),this._data.set(e,t)}writeVarFloat(e){let t=this.length;s_[0]=e;let n=zh[0];if(n=n>>>23|n<<9,!(n&255)){this.writeByte(0);return}this._growBy(4);let r=this._data;r[t]=n,r[t+1]=n>>8,r[t+2]=n>>16,r[t+3]=n>>24}writeVarUint(e){do{let t=e&127;e>>>=7,this.writeByte(e?t|128:t)}while(e)}writeVarInt(e){this.writeVarUint(e<<1^e>>31)}writeVarUint64Helper(e){if(e){var t=0;do{if(t<8){var n=parseInt(e.slice(-7),2);e=e.slice(0,-7)}else{var n=parseInt(e.slice(-8),2);e=e.slice(0,-8),this.writeByte(n);break}this.writeByte(e?n|128:n),t+=1}while(e)}}writeVarUint64(e){e=this.cleanNumericString(e);let t=this.convertBase(e,10,2);this.writeVarUint64Helper(t)}subtractOne(e){let t=1,n=e.split("").map(Number);for(let r=n.length-1;r>=0;r--)if(n[r]<t)n[r]=1;else{n[r]--,t=0;break}return n.join("").replace(/^0+/,"")}cleanNumericString(e){let t="";for(let n=0;n<e.length;n++){let r=e.charAt(n);(r>="0"&&r<="9"||n===0&&r==="-")&&(t+=r)}return t}writeVarInt64(e){if(e=this.cleanNumericString(e),e!=""){if(e[0]!="-")var t=this.convertBase(e,10,2)+"0";else{var t=this.convertBase(e.slice(1),10,2);if(t=="0"||t==""){this.writeVarUint64("0");return}t=this.subtractOne(t)+"1"}this.writeVarUint64Helper(t)}}add(e,t,n){let r=[],o=Math.max(e.length,t.length),a=0,s=0;for(;s<o||a;){let l=s<e.length?e[s]:0,d=s<t.length?t[s]:0,c=a+l+d;r.push(c%n),a=Math.floor(c/n),s++}return r}multiplyByNumber(e,t,n){if(e<0)return[];if(e===0)return[];let r=[],o=t;for(;e&1&&(r=this.add(r,o,n)),e=e>>1,e!==0;)o=this.add(o,o,n);return r}parseToDigitsArray(e,t){let n=e.toString().split(""),r=[];for(let o=n.length-1;o>=0;o--){let a=parseInt(n[o],t);if(isNaN(a))return[];r.push(a)}return r}parseFromDigitsArray(e,t){let n="";for(let r=e.length-1;r>=0;r--)n+=e[r].toString(t);return n}convertBase(e,t,n){let r=this.parseToDigitsArray(e,t);if(r===null)return"";let o=[0],a=[1];for(let s=0;s<r.length;s++)r[s]&&(o=this.add(o,this.multiplyByNumber(r[s],a,n),n)),a=this.multiplyByNumber(t,a,n);return this.parseFromDigitsArray(o,n)}writeString(e){let t;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(n+1===e.length||r<55296||r>=56320)t=r;else{let o=e.charCodeAt(++n);t=(r<<10)+o+(65536-56623104-56320)}if(t===0)throw new Error("Cannot encode a string containing the null character");t<128?this.writeByte(t):(t<2048?this.writeByte(t>>6&31|192):(t<65536?this.writeByte(t>>12&15|224):(this.writeByte(t>>18&7|240),this.writeByte(t>>12&63|128)),this.writeByte(t>>6&63|128)),this.writeByte(t&63|128))}this.writeByte(0)}}});var Wh,Zd,c_=Co(()=>{Wh=class{constructor(){this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer),this._value=0}reset(){this._value=0}value(){return this._value}hashStr(e){for(var t=0;t<e.length;++t)this.hashI(e.codePointAt(t)||0)}hashBool(e){this.hashI(e?1:0)}hashBytes(e){for(var t=0;t<e.length;++t)this.hashI(e[t])}hashF(e){this._float[0]=e,this._value=this._combine(this._value,this._int[0])}hashI(e){this._value=this._combine(this._value,e)}_combine(e,t){return t+2654435769+(e<<6)+(e>>2)}},Zd=class{constructor(e){this._helper=new Wh,this._bb=e}bb(){return this._bb}windowToUint8Array(){return this._bb.windowToUint8Array()}value(){return this._helper.value()}readByte(){let e=this._bb.readByte();return this._helper.hashI(e),e}readByteArray(){let e=this._bb.readByteArray();return this._helper.hashBytes(e),e}readVarFloat(){let e=this._bb.readVarFloat();return this._helper.hashF(e),e}readVarUint(){let e=this._bb.readVarUint();return this._helper.hashI(e),e}readVarInt(){let e=this._bb.readVarInt();return this._helper.hashI(e),e}readVarUint64(){let e=this._bb.readVarUint64();return this._helper.hashStr(e),e}readVarInt64(){let e=this._bb.readVarInt64();return this._helper.hashStr(e),e}readString(){let e=this._bb.readString();return this._helper.hashStr(e),e}}});var oc,d_=Co(()=>{oc=class{constructor(e,t){this._buckets=new Map,this._hash=e,this._equals=t}get(e,t){let n=this._hash(e),r=this._buckets.get(n);if(r!==void 0)for(let o=0;o<r.length;++o){let a=r[o];if(this._equals(e,a.key))return a.value}return t}set(e,t){let n=this._hash(e),r=this._buckets.get(n);r===void 0&&(r=[],this._buckets.set(n,r));for(let o=0;o<r.length;++o){let a=r[o];if(this._equals(e,a.key))return a.value=t,t}return r.push({key:e,value:t}),t}remove(e){let t=this._hash(e),n=this._buckets.get(t);if(n!==void 0){for(let r=0;r<n.length;++r)if(this._equals(e,n[r].key)){n.splice(r,1),n.length===0&&this._buckets.delete(t);break}}}}});function et(i){return JSON.stringify(i)}function ln(i,e,t){var n=new Error(i);throw n.line=e,n.column=t,n}var Ja=Co(()=>{});var m_={};vi(m_,{nativeTypes:()=>p_,parseSchema:()=>Qh,reservedNames:()=>h_});function Kv(i){let e=i.split(Pv),t=[],n=0,r=0;for(let o=0;o<e.length;o++){let a=e[o];o&1?Dv.test(a)||t.push({text:a,line:r+1,column:n+1}):a!==""&&ln("Syntax error "+et(a),r+1,n+1);let s=a.split(`
`);s.length>1&&(n=0),r+=s.length-1,n+=s[s.length-1].length}return t.push({text:"",line:r,column:n}),t}function qv(i){function e(){return i[s]}function t(l){return l.test(e().text)?(s++,!0):!1}function n(l,d){if(!t(l)){let c=e();ln("Expected "+d+" but found "+et(c.text),c.line,c.column)}}function r(){let l=e();ln("Unexpected token "+et(l.text),l.line,l.column)}let o=[],a=null,s=0;for(t(Wv)&&(a=e().text,n($d,"identifier"),n(u_,'";"'));s<i.length&&!t(Lv);){let l=[],d;t(Gv)?d="ENUM":t(Hv)?d="STRUCT":t(zv)?d="MESSAGE":r();let c=e();for(n($d,"identifier"),n(Vv,'"{"');!t(kv);){let p=null,u=!1,h=!1;d!=="ENUM"&&(p=e().text,n($d,"identifier"),u=t(Uv));let f=e();n($d,"identifier");let _=null;d!=="STRUCT"&&(n(Mv,'"="'),_=e(),n(Bv,"integer"),(+_.text|0)+""!==_.text&&ln("Invalid integer "+et(_.text),_.line,_.column));let m=e();t(Qv)&&(d!=="MESSAGE"&&ln("Cannot deprecate this field",m.line,m.column),h=!0),n(u_,'";"'),l.push({name:f.text,line:f.line,column:f.column,type:p,isArray:u,isDeprecated:h,value:_!==null?+_.text|0:l.length+1})}o.push({name:c.text,line:c.line,column:c.column,kind:d,fields:l})}return{package:a,definitions:o}}function Yv(i){let e=p_.slice(),t={};for(let o=0;o<i.definitions.length;o++){let a=i.definitions[o];e.indexOf(a.name)!==-1&&ln("The type "+et(a.name)+" is defined twice",a.line,a.column),h_.indexOf(a.name)!==-1&&ln("The type name "+et(a.name)+" is reserved",a.line,a.column),e.push(a.name),t[a.name]=a}for(let o=0;o<i.definitions.length;o++){let a=i.definitions[o],s=a.fields;if(a.kind==="ENUM"||s.length===0)continue;for(let d=0;d<s.length;d++){let c=s[d];e.indexOf(c.type)===-1&&ln("The type "+et(c.type)+" is not defined for field "+et(c.name),c.line,c.column)}let l=[];for(let d=0;d<s.length;d++){let c=s[d];l.indexOf(c.value)!==-1&&ln("The id for field "+et(c.name)+" is used twice",c.line,c.column),c.value<=0&&ln("The id for field "+et(c.name)+" must be positive",c.line,c.column),c.value>s.length&&ln("The id for field "+et(c.name)+" cannot be larger than "+s.length,c.line,c.column),l.push(c.value)}}let n={},r=o=>{let a=t[o];if(a&&a.kind==="STRUCT"&&(n[o]===1&&ln("Recursive nesting of "+et(o)+" is not allowed",a.line,a.column),n[o]!==2&&a)){n[o]=1;let s=a.fields;for(let l=0;l<s.length;l++){let d=s[l];d.isArray||r(d.type)}n[o]=2}return!0};for(let o=0;o<i.definitions.length;o++)r(i.definitions[o].name)}function Qh(i){let e=qv(Kv(i));return Yv(e),e}var p_,h_,Pv,$d,Dv,Mv,Lv,u_,Bv,Vv,kv,Uv,Gv,Hv,zv,Wv,Qv,Kh=Co(()=>{Ja();p_=["bool","byte","float","int","string","uint","int64","uint64"],h_=["ByteBuffer","package"],Pv=/((?:-|\b)\d+\b|[=;{}]|\[\]|\[deprecated\]|\b[A-Za-z_][A-Za-z0-9_]*\b|\/\/.*|\s+)/g,$d=/^[A-Za-z_][A-Za-z0-9_]*$/,Dv=/^\/\/.*|\s+$/,Mv=/^=$/,Lv=/^$/,u_=/^;$/,Bv=/^-?\d+$/,Vv=/^\{$/,kv=/^\}$/,Uv=/^\[\]$/,Gv=/^enum$/,Hv=/^struct$/,zv=/^message$/,Wv=/^package$/,Qv=/^\[deprecated\]$/});var g_={};vi(g_,{decodeBinarySchema:()=>Xh,encodeBinarySchema:()=>Xv});function Xh(i){let e=i instanceof Ci?i:new Ci(i),t=e.readVarUint(),n=[];for(let r=0;r<t;r++){let o=e.readString(),a=e.readByte(),s=e.readVarUint(),l=[];for(let d=0;d<s;d++){let c=e.readString(),p=e.readVarInt(),u=!!(e.readByte()&1),h=e.readVarUint();l.push({name:c,line:0,column:0,type:Yh[a]==="ENUM"?null:p,isArray:u,isDeprecated:!1,value:h})}n.push({name:o,line:0,column:0,kind:Yh[a],fields:l})}for(let r=0;r<t;r++){let o=n[r].fields;for(let a=0;a<o.length;a++){let s=o[a],l=s.type;if(l!==null&&l<0){if(~l>=qh.length)throw new Error("Invalid type "+l);s.type=qh[~l]}else{if(l!==null&&l>=n.length)throw new Error("Invalid type "+l);s.type=l===null?null:n[l].name}}}return{package:null,definitions:n}}function Xv(i){let e=new Ci,t=i.definitions,n={};e.writeVarUint(t.length);for(let r=0;r<t.length;r++)n[t[r].name]=r;for(let r=0;r<t.length;r++){let o=t[r];e.writeString(o.name),e.writeByte(Yh.indexOf(o.kind)),e.writeVarUint(o.fields.length);for(let a=0;a<o.fields.length;a++){let s=o.fields[a],l=qh.indexOf(s.type);e.writeString(s.name),e.writeVarInt(l===-1?n[s.type]:~l),e.writeByte(s.isArray?1:0),e.writeVarUint(s.value)}}return e.toUint8Array()}var qh,Yh,jh=Co(()=>{jd();qh=["bool","byte","int","uint","float","string","int64","uint64"],Yh=["ENUM","STRUCT","MESSAGE"]});var __={};vi(__,{compileSchema:()=>tE,compileSchemaJS:()=>f_});function jv(i,e,t,n){let r=[],o="  ";r.push("function(bb, optDedupCache) {"),r.push("  var dedupKey = null;"),t.includes(i.name)&&(r.push("  if (!!optDedupCache) {"),r.push("    if (!(optDedupCache instanceof this.HashTable)) {"),r.push('      throw new Error("optDedupCache must be instance of HashTable");'),r.push("    }"),r.push("    // lookahead with hasher then reference result with dedup cache"),r.push("    var hasher = new this.Hasher(bb.getNewWindowFromRight());"),r.push(`    this[${et("hash"+i.name)}](hasher);`),r.push(`    dedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${et(i.name)} };`),r.push("    var cachedResult = optDedupCache.get(dedupKey, null);"),r.push("    if (cachedResult !== null) {"),r.push("      bb.extendWindowTo(hasher.bb());"),r.push("      return cachedResult;"),r.push("    }"),r.push("  }")),r.push("  var result = {};"),r.push("  if (!(bb instanceof this.ByteBuffer)) {"),r.push("    bb = new this.ByteBuffer(bb);"),r.push("  }"),r.push(""),i.kind==="MESSAGE"&&(r.push("  while (true) {"),r.push("  var x = bb.readVarUint();"),r.push("    switch (x) {"),r.push("    case 0:"),r.push("      return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),r.push(""),o="      ");for(let a=0;a<i.fields.length;a++){let s=i.fields[a],l,d;switch(s.type){case"bool":{l="!!bb.readByte()",d="!!hasher.readByte()";break}case"byte":{l="bb.readByte()",d="hasher.readByte()";break}case"int":{l="bb.readVarInt()",d="hasher.readVarInt()";break}case"uint":{l="bb.readVarUint()",d="hasher.readVarUint()";break}case"int64":{l="bb.readVarInt64()",d="hasher.readVarInt64()";break}case"uint64":{l="bb.readVarUint64()",d="hasher.readVarUint64()";break}case"float":{l="bb.readVarFloat()",d="hasher.readVarFloat()";break}case"string":{l="bb.readString()",d="hasher.readString()";break}default:{let c=e[s.type];c?c.kind==="ENUM"?(l=`this[${et(c.name)}][bb.readVarUint()]`,d=`this[${et(c.name)}][hasher.readVarUint()]`):(l=`this[${et("decode"+c.name)}](bb, optDedupCache || null)`,d=`this[${et("hash"+c.name)}](hasher)`):ln(`Invalid type ${et(s.type)} for field ${et(s.name)}`,s.line,s.column)}}i.kind==="MESSAGE"&&r.push(`    case ${s.value}:`),s.isArray?s.isDeprecated?s.type==="byte"?r.push(o+"bb.readByteArray();"):(r.push(o+"var length = bb.readVarUint();"),r.push(o+`while (length-- > 0) ${l};`)):s.type==="byte"?r.push(o+`result[${et(s.name)}] = bb.readByteArray();`):(r.push(o+"var arrayDedupKey = null;"),r.push(o+"var values = null;"),n.includes(s.type)&&(r.push(o+"if (!!optDedupCache) {"),r.push(o+"  // lookahead with hasher then reference result with dedup cache"),r.push(o+"  var hasher = new this.Hasher(bb.getNewWindowFromRight());"),r.push(o+"  var length = hasher.readVarUint();"),r.push(o+`  for (var i = 0; i < length; i++) ${d};`),r.push(o+`  arrayDedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${et(s.type+"[]")} };`),r.push(o+"  var cachedResult = optDedupCache.get(arrayDedupKey, null);"),r.push(o+"  if (cachedResult !== null) {"),r.push(o+"    bb.extendWindowTo(hasher.bb());"),r.push(o+"    values = cachedResult;"),r.push(o+"  }"),r.push(o+"}")),r.push(o+"if (values === null) {"),r.push(o+"  var length = bb.readVarUint();"),r.push(o+"  var values = Array(length);"),r.push(o+`  for (var i = 0; i < length; i++) values[i] = ${l};`),r.push(o+"  if (arrayDedupKey !== null) { optDedupCache.set(arrayDedupKey, values); }"),r.push(o+"}"),r.push(o+`result[${et(s.name)}] = values;`)):s.isDeprecated?r.push(o+`${l};`):r.push(o+`result[${et(s.name)}] = ${l};`),i.kind==="MESSAGE"&&(r.push("      break;"),r.push(""))}return i.kind==="MESSAGE"?(r.push("    default:"),r.push('      throw new Error("Attempted to parse invalid message");'),r.push("    }"),r.push("  }")):r.push("  return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),r.push("}"),r.join(`
`)}function Zv(i,e){let t=[],n="  ";t.push("function(hasher) {"),t.push("  var result = {};"),t.push("  if (!(hasher instanceof this.Hasher)) {"),t.push('    throw new Error("Expected Hasher");'),t.push("  }"),t.push(""),i.kind==="MESSAGE"&&(t.push("  while (true) {"),t.push("    switch (hasher.readVarUint()) {"),t.push("    case 0:"),t.push("      return;"),t.push(""),n="      ");for(let r=0;r<i.fields.length;r++){let o=i.fields[r],a;switch(o.type){case"bool":{a="hasher.readByte()";break}case"byte":{a="hasher.readByte()";break}case"int":{a="hasher.readVarInt()";break}case"uint":{a="hasher.readVarUint()";break}case"int64":{a="hasher.readVarInt64()";break}case"uint64":{a="hasher.readVarUint64()";break}case"float":{a="hasher.readVarFloat()";break}case"string":{a="hasher.readString()";break}default:{let s=e[o.type];s?s.kind==="ENUM"?a="hasher.readVarUint()":a=`this[${et("hash"+s.name)}](hasher)`:ln(`Invalid type ${et(o.type)} for field ${et(o.name)}`,o.line,o.column)}}i.kind==="MESSAGE"&&t.push(`    case ${o.value}:`),o.isArray?o.type==="byte"?t.push(n+"hasher.readByteArray();"):(t.push(n+"var length = hasher.readVarUint();"),t.push(n+`while (length-- > 0) ${a};`)):t.push(n+`${a};`),i.kind==="MESSAGE"&&(t.push("      break;"),t.push(""))}return i.kind==="MESSAGE"?(t.push("    default:"),t.push('      throw new Error("Attempted to parse invalid message");'),t.push("    }"),t.push("  }")):t.push("  return;"),t.push("}"),t.join(`
`)}function $v(i,e){let t=[];t.push("function(message, bb) {"),t.push("  var isTopLevel = !bb;"),t.push("  if (isTopLevel) bb = new this.ByteBuffer();");for(let n=0;n<i.fields.length;n++){let r=i.fields[n],o;if(!r.isDeprecated){switch(r.type){case"bool":{o="bb.writeByte(value);";break}case"byte":{o="bb.writeByte(value);";break}case"int":{o="bb.writeVarInt(value);";break}case"uint":{o="bb.writeVarUint(value);";break}case"int64":{o="bb.writeVarInt64(value);";break}case"uint64":{o="bb.writeVarUint64(value);";break}case"float":{o="bb.writeVarFloat(value);";break}case"string":{o="bb.writeString(value);";break}default:{let a=e[r.type];if(a)a.kind==="ENUM"?o=`var encoded = this[${et(a.name)}][value]; if (encoded === void 0) throw new Error("Invalid value " + JSON.stringify(value) + ${et(" for enum "+et(a.name))}); bb.writeVarUint(encoded);`:o=`this[${et("encode"+a.name)}](value, bb);`;else throw new Error(`Invalid type ${et(r.type)} for field ${et(r.name)}`)}}t.push(""),t.push(`  var value = message[${et(r.name)}];`),t.push("  if (value != null) {"),i.kind==="MESSAGE"&&t.push(`    bb.writeVarUint(${r.value});`),r.isArray?r.type==="byte"?t.push("    bb.writeByteArray(value);"):(t.push("    var values = value, n = values.length;"),t.push("    bb.writeVarUint(n);"),t.push("    for (var i = 0; i < n; i++) {"),t.push("      value = values[i];"),t.push(`      ${o}`),t.push("    }")):t.push(`    ${o}`),i.kind==="STRUCT"&&(t.push("  } else {"),t.push(`    throw new Error(${et("Missing required field "+et(r.name))});`)),t.push("  }")}}return i.kind==="MESSAGE"&&t.push("  bb.writeVarUint(0);"),t.push(""),t.push("  if (isTopLevel) return bb.toUint8Array();"),t.push("}"),t.join(`
`)}function Jv(i){return typeof i=="string"?Qh(i):i instanceof Uint8Array||i instanceof Ci?Xh(i):i}function f_(i,e,t){i=Jv(i);let n={},r=i.package,o=[];r!==null?o.push(`var ${r} = exports || ${r} || {}, exports;`):(o.push("var exports = exports || {};"),r="exports"),o.push(`${r}.ByteBuffer = ${r}.ByteBuffer || require("kiwi-schema").ByteBuffer;`);for(let a=0;a<i.definitions.length;a++){let s=i.definitions[a];n[s.name]=s}for(let a=0;a<i.definitions.length;a++){let s=i.definitions[a];switch(s.kind){case"ENUM":{let l={};for(let d=0;d<s.fields.length;d++){let c=s.fields[d];l[c.name]=c.value,l[c.value]=c.name}o.push(`${r}[${et(s.name)}] = ${JSON.stringify(l,null,2)};`);break}case"STRUCT":case"MESSAGE":{o.push(""),o.push(`${r}[${et("decode"+s.name)}] = ${jv(s,n,e,t)};`),o.push(""),o.push(`${r}[${et("encode"+s.name)}] = ${$v(s,n)};`),o.push(""),o.push(`${r}[${et("hash"+s.name)}] = ${Zv(s,n)};`);break}default:ln("Invalid definition kind "+et(s.kind),s.line,s.column)}}return o.push(""),o.join(`
`)}function eE(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}function tE(i,e){let t={ByteBuffer:Ci,Hasher:Zd,HashTable:oc,makeDedupCache:()=>new oc(o=>o.hash,(o,a)=>o.defName===a.defName&&eE(o.data,a.data))},n=[],r=[];return e&&(n=e.filter(o=>!!o.match(/^[A-Za-z_][A-Za-z0-9_]*$/)),r=e.filter(o=>!!o.match(/^[A-Za-z_][A-Za-z0-9_]*\[\]$/)).map(o=>o.slice(0,o.length-2)),r.length+n.length!==e.length&&console.warn("Some definitions to dedup are invalid identifiers, skipping...")),new Function("exports",f_(i,n,r))(t),t}var A_=Co(()=>{jd();c_();d_();Ja();Kh();jh()});var I_={};vi(I_,{compileSchemaCallbackCPP:()=>rE});function nE(i,e,t){switch(e){case"bool":return{type:"bool ",name:t};case"byte":return{type:"uint8_t ",name:t};case"int":return{type:"int32_t ",name:t};case"uint":return{type:"uint32_t ",name:t};case"int64":return{type:"int64_t ",name:t};case"uint64":return{type:"uint64_t ",name:t};case"float":return{type:"float ",name:t};case"string":return{type:"const char *",name:t};default:{let n=i[e];return n.kind==="ENUM"?{type:n.name+" ",name:t}:null}}}function es(i,e,t,n){let r=[];for(let o=0;o<t.length;o++){let a=t[o],s=e+a.name;if(a.isArray&&!n)return null;let l=nE(i,a.type,s);if(l!==null){r.push(l);continue}let d=i[a.type];if(d.kind!=="STRUCT")return null;let c=es(i,s+"_",d.fields,!1);if(c===null)return null;r.push.apply(r,c)}return r}function Ys(i){return i.type+i.name}function b_(i){return i.name}function T_(i){switch(i.type){case"bool ":return`!bb.readBool(${i.name})`;case"uint8_t ":return`!bb.readByte(${i.name})`;case"int32_t ":return`!bb.readVarInt(${i.name})`;case"uint32_t ":return`!bb.readVarUint(${i.name})`;case"int64_t ":return`!bb.readVarInt64(${i.name})`;case"uint64_t ":return`!bb.readVarUint64(${i.name})`;case"float ":return`!bb.readVarFloat(${i.name})`;case"const char *":return`!bb.readString(${i.name})`;default:return`!bb.readVarUint(reinterpret_cast<uint32_t &>(${i.name}))`}}function S_(i){switch(i.type){case"bool ":return`_wb.writeBool(${i.name})`;case"uint8_t ":return`_wb.writeByte(${i.name})`;case"int32_t ":return`_wb.writeVarInt(${i.name})`;case"uint32_t ":return`_wb.writeVarUint(${i.name})`;case"int64_t ":return`_wb.writeVarInt64(${i.name})`;case"uint64_t ":return`_wb.writeVarUint64(${i.name})`;case"float ":return`_wb.writeVarFloat(${i.name})`;case"const char *":return`_wb.writeString(${i.name})`;default:return`_wb.writeVarUint(static_cast<uint32_t>(${i.name}))`}}function y_(i,e,t,n,r){let o=n.name;if(n.isArray){let s=`_${o}_count`;i.push(r+`uint32_t ${s};`),i.push(r+`if (!bb.readVarUint(${s})) return false;`),n.isDeprecated||i.push(r+`visitor.visit${t.name}_${n.name}_count(${s});`),i.push(r+`while (${s}-- > 0) {`),r+="  ",o+="_element"}let a=es(e,"",[n],!0);if(a!==null){for(let s=0;s<a.length;s++)i.push(r+`${Ys(a[s])};`);i.push(r+`if (${a.map(T_).join(" || ")}) return false;`),n.isDeprecated||i.push(r+`visitor.visit${t.name}_${o}(${a.map(b_).join(", ")});`)}else{n.isDeprecated||i.push(r+`visitor.visit${t.name}_${o}();`);let s=e[n.type];i.push(r+`if (!parse${s.name}(bb, visitor)) return false;`)}n.isArray&&i.push(r.slice(2)+"}")}function rE(i){let e={},t=[];for(let n=0;n<i.definitions.length;n++){let r=i.definitions[n];e[r.name]=r}i.package!==null&&(t.push(`#ifndef INCLUDE_${i.package.toUpperCase()}_H`),t.push(`#define INCLUDE_${i.package.toUpperCase()}_H`),t.push("")),t.push('#include "kiwi.h"'),t.push(""),i.package!==null&&(t.push(`namespace ${i.package} {`),t.push(""));for(let n=0;n<i.definitions.length;n++){let r=i.definitions[n];if(r.kind==="ENUM"){t.push(`enum class ${r.name} : uint32_t {`);for(let o=0;o<r.fields.length;o++){let a=r.fields[o];a.isDeprecated||t.push(`  ${a.name} = ${a.value},`)}t.push("};"),t.push("")}}for(let n=0;n<2;n++){let r=") = 0;";n===0?(t.push("class Visitor {"),t.push("public:")):(t.push("class Writer : public Visitor {"),t.push("private:"),t.push("  kiwi::WriteBuffer &_wb;"),t.push("public:"),t.push("  Writer(kiwi::WriteBuffer &wb) : _wb(wb) {}"),r=") override;");for(let o=0;o<i.definitions.length;o++){let a=i.definitions[o];if(a.kind==="STRUCT"){let s=es(e,"",a.fields,!1);if(s!==null){t.push(`  virtual void visit${a.name}(${s.map(Ys).join(", ")}${r}`);continue}}if(a.kind==="STRUCT"||a.kind==="MESSAGE"){t.push(`  virtual void begin${a.name}(${r}`);for(let s=0;s<a.fields.length;s++){let l=a.fields[s];if(l.isDeprecated)continue;let d=l.name;l.isArray&&(t.push(`  virtual void visit${a.name}_${l.name}_count(uint32_t size${r}`),d+="_element");let c=es(e,"",[l],!0);c!==null?t.push(`  virtual void visit${a.name}_${d}(${c.map(Ys).join(", ")}${r}`):t.push(`  virtual void visit${a.name}_${d}(${r}`)}t.push(`  virtual void end${a.name}(${r}`)}}t.push("};"),t.push("")}for(let n=0;n<i.definitions.length;n++){let r=i.definitions[n];(r.kind==="STRUCT"||r.kind==="MESSAGE")&&t.push(`bool parse${r.name}(kiwi::ByteBuffer &bb, Visitor &visitor);`)}t.push(""),t.push("#ifdef IMPLEMENT_SCHEMA_H"),t.push("");for(let n=0;n<i.definitions.length;n++){let r=i.definitions[n];if(r.kind==="STRUCT"){let o=es(e,"",r.fields,!1);if(o!==null){t.push(`bool parse${r.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`);for(let a=0;a<o.length;a++)t.push(`  ${Ys(o[a])};`);t.push(`  if (${o.map(T_).join(" || ")}) return false;`),t.push(`  visitor.visit${r.name}(${o.map(b_).join(", ")});`),t.push("  return true;"),t.push("}"),t.push("")}else{t.push(`bool parse${r.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`),t.push(`  visitor.begin${r.name}();`);for(let a=0;a<r.fields.length;a++){let s=r.fields[a];y_(t,e,r,s,"  ")}t.push(`  visitor.end${r.name}();`),t.push("  return true;"),t.push("}"),t.push("")}}else if(r.kind==="MESSAGE"){t.push(`bool parse${r.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`),t.push(`  visitor.begin${r.name}();`),t.push("  while (true) {"),t.push("    uint32_t _type;"),t.push("    if (!bb.readVarUint(_type)) return false;"),t.push("    switch (_type) {"),t.push("      case 0: {"),t.push(`        visitor.end${r.name}();`),t.push("        return true;"),t.push("      }");for(let o=0;o<r.fields.length;o++){let a=r.fields[o];t.push(`      case ${a.value}: {`),y_(t,e,r,a,"        "),t.push("        break;"),t.push("      }")}t.push("      default: return false;"),t.push("    }"),t.push("  }"),t.push("}"),t.push("")}}for(let n=0;n<i.definitions.length;n++){let r=i.definitions[n];if(r.kind==="STRUCT"){let o=es(e,"",r.fields,!1);if(o!==null){t.push(`void Writer::visit${r.name}(${o.map(Ys).join(", ")}) {`);for(let a=0;a<o.length;a++)t.push(`  ${S_(o[a])};`);t.push("}"),t.push("");continue}}if(r.kind==="STRUCT"||r.kind==="MESSAGE"){t.push(`void Writer::begin${r.name}() {`),t.push("}"),t.push("");for(let o=0;o<r.fields.length;o++){let a=r.fields[o];if(a.isDeprecated)continue;let s=a.name;a.isArray&&(t.push(`void Writer::visit${r.name}_${a.name}_count(uint32_t size) {`),r.kind==="MESSAGE"&&t.push(`  _wb.writeVarUint(${a.value});`),t.push("  _wb.writeVarUint(size);"),t.push("}"),t.push(""),s+="_element");let l=es(e,"",[a],!0);if(l!==null){t.push(`void Writer::visit${r.name}_${s}(${l.map(Ys).join(", ")}) {`),r.kind==="MESSAGE"&&!a.isArray&&t.push(`  _wb.writeVarUint(${a.value});`);for(let d=0;d<l.length;d++)t.push(`  ${S_(l[d])};`);t.push("}"),t.push("")}else t.push(`void Writer::visit${r.name}_${s}() {`),r.kind==="MESSAGE"&&!a.isArray&&t.push(`  _wb.writeVarUint(${a.value});`),t.push("}"),t.push("")}t.push(`void Writer::end${r.name}() {`),r.kind==="MESSAGE"&&t.push("  _wb.writeVarUint(0);"),t.push("}"),t.push("")}}return t.push("#endif"),t.push(""),i.package!==null&&(t.push("}"),t.push(""),t.push("#endif"),t.push("")),t.join(`
`)}var v_=Co(()=>{});var N_={};vi(N_,{compileSchemaCPP:()=>pE,compileSchemaEnumsCPP:()=>hE});function yr(i,e,t){let n;switch(e.type){case"bool":n="bool";break;case"byte":n="uint8_t";break;case"int":n="int32_t";break;case"uint":n="uint32_t";break;case"int64":n="int64_t";break;case"uint64":n="uint64_t";break;case"float":n="float";break;case"string":n="kiwi::String";break;default:{let r=i[e.type];r||ln(`Invalid type ${et(e.type)} for field ${et(e.name)}`,e.line,e.column),n=r.name;break}}return t&&(n=`kiwi::Array<${n}>`),n}function $i(i){return"_data_"+i.name}function $h(i){return i>>5}function Jh(i){return`(1 << ${i%32})`}function so(i,e){return!e.isArray&&e.type in i&&i[e.type].kind!=="ENUM"}function Zh(i,e,t){switch(e.type){case"bool":return`_wb.writeBool(${t});`;case"byte":return`_wb.writeByte(${t});`;case"int":return`_wb.writeVarInt(${t});`;case"uint":return`_wb.writeVarUint(${t});`;case"int64":return`_wb.writeVarInt64(${t});`;case"uint64":return`_wb.writeVarUint64(${t});`;case"float":return`_wb.writeVarFloat(${t});`;case"string":return`_wb.writeString(${t}.c_str());`;default:{let n=i[e.type];if(!n)ln(`Invalid type ${et(e.type)} for field ${et(e.name)}`,e.line,e.column);else return n.kind==="ENUM"?`_wb.writeVarUint(static_cast<uint32_t>(${t}));`:`if (!${t}${so(i,e)?"->":"."}encode(_wb)) return false;`}}}function E_(i,e,t){let n=so(i,e);switch(e.type){case"bool":return`_bb.readBool(${t})`;case"byte":return`_bb.readByte(${t})`;case"int":return`_bb.readVarInt(${t})`;case"uint":return`_bb.readVarUint(${t})`;case"int64":return`_bb.readVarInt64(${t})`;case"uint64":return`_bb.readVarUint64(${t})`;case"float":return`_bb.readVarFloat(${t})`;case"string":return`_bb.readString(${t}, _pool)`;default:{let r=i[e.type];if(!r)ln(`Invalid type ${et(e.type)} for field ${et(e.name)}`,e.line,e.column);else return r.kind==="ENUM"?`_bb.readVarUint(reinterpret_cast<uint32_t &>(${t}))`:`${t+(n?"->":".")}decode(_bb, _pool, _schema)`}}}function C_(i){let e={bool:1,byte:1,int:4,uint:4,float:4};return i.slice().sort(function(t,n){let r=!t.isArray&&e[t.type]||8,o=!n.isArray&&e[n.type]||8;return r!==o?o-r:i.indexOf(t)-i.indexOf(n)})}function oE(i,e,t){let n=i.fields,r=[];r.push(`class ${i.name} {`),r.push("public:"),r.push(`  ${i.name}() { (void)_flags; }`),t||(r.push(`  ${i.name}(const ${i.name}&) = delete;`),r.push(`  ${i.name}& operator=(const ${i.name}&) = delete;`)),r.push(`  ${i.name}(${i.name}&&) = default;`),r.push(`  ${i.name}& operator=(${i.name}&&) = default;`),r.push(""),t&&(r.push(`  ${i.name} copy() const;`),r.push(""));for(let s=0;s<n.length;s++){let l=n[s];if(l.isDeprecated)continue;let d=yr(e,l,l.isArray);r.push(`  ${d} *${l.name}();`),r.push(`  const ${d} *${l.name}() const;`),so(e,l)?r.push(`  void set_${l.name}(${d} *value);`):l.isArray?r.push(`  ${d} &set_${l.name}(kiwi::MemoryPool &pool, uint32_t count);`):r.push(`  void set_${l.name}(const ${d} &value);`),r.push("")}r.push("  bool encode(kiwi::WriteBuffer &wb) const;"),r.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema = nullptr);"),r.push(""),r.push("private:"),t&&(r.push(`  ${i.name}(const ${i.name}&) = default;`),r.push(`  ${i.name}& operator=(const ${i.name}&) = default;`)),r.push(`  uint32_t _flags[${n.length+31>>5}] = {};`);let o=C_(n),a="  ";for(let s=0;s<o.length;s++){let l=o[s];if(l.isDeprecated)continue;let d=$i(l),c=yr(e,l,l.isArray);so(e,l)?r.push(a+`${c} *${d} = {};`):r.push(a+`${c} ${d} = {};`)}return r.push("};"),r.push(""),r}function iE(i,e,t){let n=i.fields,r=[];r.push(`class ${i.name} {`),r.push("public:"),r.push(`  ${i.name}() { (void)_flags; }`),r.push(`  ${i.name}(const ${i.name}&) = delete;`),r.push(`  ${i.name}& operator=(const ${i.name}&) = delete;`),r.push(`  ${i.name}(${i.name}&&) = default;`),r.push(`  ${i.name}& operator=(${i.name}&&) = default;`),r.push(""),t&&(r.push(`  ${i.name} copy(kiwi::MemoryPool& pool) const;`),r.push(""));for(let s=0;s<n.length;s++){let l=n[s];if(l.isDeprecated)continue;let d=yr(e,l,l.isArray);so(e,l)?(r.push(`  ${d} *${l.name}();`),r.push(`  const ${d} *${l.name}() const;`)):r.push(`  kiwi::Optional<${d}> ${l.name}() const;`),so(e,l)?r.push(`  void set_${l.name}(kiwi::MemoryPool &pool, ${d} *value);`):l.isArray?r.push(`  ${d} &set_${l.name}(kiwi::MemoryPool &pool, uint32_t count);`):r.push(`  void set_${l.name}(kiwi::MemoryPool &pool, const ${d} &value);`),r.push("")}r.push("  bool encode(kiwi::WriteBuffer &wb) const;"),r.push("  bool encode2(kiwi::WriteBuffer &wb) const;"),r.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema = nullptr);"),r.push(""),r.push("private:"),r.push(`  uint32_t _flags[${n.length+31>>5}] = {};`);let o=C_(n);r.push("  union Field {"),r.push("  public:"),r.push("    bool operator==(const Field&) const { return false; }");let a="    ";for(let s=0;s<o.length;s++){let l=o[s];if(l.isDeprecated)continue;let d=$i(l),c=yr(e,l,l.isArray);so(e,l)?r.push(a+`${c} *${d};`):r.push(a+`${c} ${d};`)}return r.push("  };"),r.push("  kiwi::SparseFields<Field> _fields;"),r.push("  friend std::hash<Field>;"),r.push("};"),r.push(""),r}function aE(i,e,t){let n=i.fields,r=[];t&&(r.push(`inline ${i.name} ${i.name}::copy() const {`),r.push(`  ${i.name} clone = *this;`),r.push("  return clone;"),r.push("}"),r.push(""));for(let o=0;o<n.length;o++){let a=n[o],s=$i(a),l=yr(e,a,a.isArray),d=$h(o),c=Jh(o);if(a.isDeprecated)continue;let p=`_flags[${d}] |= ${c}`,u=`_flags[${d}] & ${c}`;so(e,a)?(r.push(`inline ${l} *${i.name}::${a.name}() {`),r.push(`  return ${s};`),r.push("}"),r.push(""),r.push(`inline const ${l} *${i.name}::${a.name}() const {`),r.push(`  return ${s};`),r.push("}"),r.push(""),r.push(`inline void ${i.name}::set_${a.name}(${l} *value) {`),r.push(`  ${s} = value;`),r.push("}"),r.push("")):a.isArray?(r.push(`inline ${l} *${i.name}::${a.name}() {`),r.push(`  return ${u} ? &${s} : nullptr;`),r.push("}"),r.push(""),r.push(`inline const ${l} *${i.name}::${a.name}() const {`),r.push(`  return ${u} ? &${s} : nullptr;`),r.push("}"),r.push(""),r.push(`inline ${l} &${i.name}::set_${a.name}(kiwi::MemoryPool &pool, uint32_t count) {`),r.push(`  ${p}; return ${s} = pool.array<${yr(e,a,!1)}>(count);`),r.push("}"),r.push("")):(r.push(`inline ${l} *${i.name}::${a.name}() {`),r.push(`  return ${u} ? &${s} : nullptr;`),r.push("}"),r.push(""),r.push(`inline const ${l} *${i.name}::${a.name}() const {`),r.push(`  return ${u} ? &${s} : nullptr;`),r.push("}"),r.push(""),r.push(`inline void ${i.name}::set_${a.name}(const ${l} &value) {`),r.push(`  ${p}; ${s} = value;`),r.push("}"),r.push(""))}return r}function sE(i,e){let t=i.fields,n=[];n.push(`bool ${i.name}::encode(kiwi::WriteBuffer &_wb) const {`);for(let r=0;r<t.length;r++){let o=t[r];if(o.isDeprecated)continue;let a="  ";i.kind==="STRUCT"?n.push(`  if (${o.name}() == nullptr) return false;`):(n.push(`  if (${o.name}() != nullptr) {`),a="    ");let s=$i(o),l=o.isArray?"_it":s,d=Zh(e,o,l);i.kind==="MESSAGE"&&n.push(a+`_wb.writeVarUint(${o.value});`),o.isArray?(n.push(a+`_wb.writeVarUint(${s}.size());`),n.push(a+`for (const ${yr(e,o,!1)} &_it : ${s}) ${d}`)):n.push(a+d),i.kind!=="STRUCT"&&n.push("  }")}return i.kind==="MESSAGE"&&n.push("  _wb.writeVarUint(0);"),n.push("  return true;"),n.push("}"),n.push(""),n}function lE(i,e){let t=i.fields,n=[];n.push(`bool ${i.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema) {`);for(let r=0;r<t.length;r++)if(t[r].isArray){n.push("  uint32_t count;");break}i.kind==="MESSAGE"&&(n.push("  while (true) {"),n.push("    uint32_t type;"),n.push("    if (!_bb.readVarUint(type)) return false;"),n.push("    switch (type) {"),n.push("      case 0:"),n.push("        return true;"));for(let r=0;r<t.length;r++){let o=t[r],a=$i(o),s=o.isArray?"_it":a,l=so(e,o),d=E_(e,o,s),c=yr(e,o,!1),p="  ";i.kind==="MESSAGE"&&(n.push(`      case ${o.value}: {`),p="        "),o.isArray?(n.push(p+"if (!_bb.readVarUint(count)) return false;"),o.isDeprecated?o.type==="byte"?n.push(p+"if (!_bb.skipCount(count)) return false;"):n.push(p+`for (${c} &_it : _pool.array<${c}>(count)) if (!${d}) return false;`):o.type==="byte"?n.push(p+`if (!_bb.readByteArray(set_${o.name}(_pool, count).data(), count)) return false;`):n.push(p+`for (${c} &_it : set_${o.name}(_pool, count)) if (!${d}) return false;`)):o.isDeprecated?(l?n.push(p+`${c} *${a} = _pool.allocate<${c}>();`):n.push(p+`${c} ${a} = {};`),n.push(p+`if (!${d}) return false;`)):(l&&n.push(p+`${a} = _pool.allocate<${c}>();`),n.push(p+`if (!${d}) return false;`),l||n.push(p+`set_${o.name}(${a});`)),i.kind==="MESSAGE"&&(n.push("        break;"),n.push("      }"))}return i.kind==="MESSAGE"?(n.push("      default: {"),n.push(`        if (!_schema || !_schema->skip${i.name}Field(_bb, type)) return false;`),n.push("        break;"),n.push("      }"),n.push("    }"),n.push("  }")):n.push("  return true;"),n.push("}"),n.push(""),n}function cE(i,e,t){let n=i.fields,r=[];t&&(r.push(`inline ${i.name} ${i.name}::copy(kiwi::MemoryPool& pool) const {`),r.push(`  ${i.name} clone;`),r.push("  clone._fields = _fields.copy(pool);"),r.push("  memcpy(clone._flags, _flags, sizeof(_flags));"),r.push("  return clone;"),r.push("}"),r.push(""));for(let o=0;o<n.length;o++){let a=n[o],s=$i(a),l=yr(e,a,a.isArray),d=$h(o),c=Jh(o);if(a.isDeprecated)continue;let p=`_flags[${d}] |= ${c}`,u=`_flags[${d}] & ${c}`,h=so(e,a);h?(r.push(`inline ${l} *${i.name}::${a.name}() {`),r.push(`  if (!(${u})) return nullptr;`),r.push(`  Field* field = _fields.getField(${a.value});`),r.push(`  return field ? ${h?"":"&"}field->${s} : nullptr;`),r.push("}"),r.push(""),r.push(`inline const ${l} *${i.name}::${a.name}() const {`),r.push(`  if (!(${u})) return nullptr;`),r.push(`  const Field* field = _fields.getField(${a.value});`),r.push(`  return field ? ${h?"":"&"}field->${s} : nullptr;`),r.push("}"),r.push("")):(r.push(`inline kiwi::Optional<${l}> ${i.name}::${a.name}() const {`),r.push(`  if (!(${u})) return std::nullopt;`),r.push(`  const Field* field = _fields.getField(${a.value});`),r.push(`  return field ? kiwi::Optional<${l}>(field->${s}) : std::nullopt;`),r.push("}"),r.push("")),so(e,a)?r.push(`inline void ${i.name}::set_${a.name}(kiwi::MemoryPool &pool, ${l} *value) {`):a.isArray?(r.push(`inline ${l} &${i.name}::set_${a.name}(kiwi::MemoryPool &pool, uint32_t count) {`),r.push(`  ${l} value = pool.array<${yr(e,a,!1)}>(count);`)):r.push(`inline void ${i.name}::set_${a.name}(kiwi::MemoryPool &pool, const ${l} &value) {`),r.push(`  if (${u}) {`),r.push(`    Field* field = _fields.getField(${a.value});`),r.push(`    field->${s} = value;`),a.isArray&&r.push(`    return field->${s};`),r.push("  } else {"),r.push(`    ${p};`),a.isArray?r.push(`    return _fields.addField({${a.value}, Field{.${s} = value}}, pool)->field.${s};`):r.push(`    _fields.addField({${a.value}, Field{.${s} = value}}, pool);`),r.push("  }"),r.push("}"),r.push("")}return r}function dE(i,e){let t=i.fields,n=[];n.push(`bool ${i.name}::encode(kiwi::WriteBuffer &_wb) const {`);for(let o=0;o<t.length;o++){let a=t[o];if(a.isDeprecated)continue;let s=yr(e,a,a.isArray),l=so(e,a),d;l?d=`${s}*`:d=`kiwi::Optional<${s}>`;let c=$i(a);n.push(`  const ${d} ${c} = ${a.name}();`),n.push(`  if (${c}) {`),l?n.push(`    const ${yr(e,a,a.isArray)}* _data = ${c};`):n.push(`    const ${yr(e,a,a.isArray)}& _data = *${c};`);let p="    ";c="_data";let u=a.isArray?"_it":c,h=Zh(e,a,u);n.push(p+`_wb.writeVarUint(${a.value});`),a.isArray?(n.push(p+`_wb.writeVarUint(${c}.size());`),n.push(p+`for (const ${yr(e,a,!1)} &_it : ${c}) ${h}`)):n.push(p+h),n.push("  }")}n.push("  _wb.writeVarUint(0);"),n.push("  return true;"),n.push("}"),n.push(""),n.push(`bool ${i.name}::encode2(kiwi::WriteBuffer &_wb) const {`),n.push("  for (auto* it = _fields.begin(); it != _fields.end(); it++) {"),n.push("    uint32_t index = it->index;"),n.push("    const Field& field = it->field;"),n.push("    _wb.writeVarUint(index);"),n.push("    switch (index) {");let r="      ";for(let o=0;o<t.length;o++){let a=t[o];if(a.isDeprecated)continue;let s=yr(e,a,a.isArray),l=so(e,a),d=$i(a),c=a.isArray?"_it":d,p=Zh(e,a,c);n.push(r+`case ${a.value}: {`),n.push(r+`  const ${s}${l?"*":"&"} ${d} = field.${d};`),a.isArray?(n.push(r+`  _wb.writeVarUint(${d}.size());`),n.push(r+`  for (const ${yr(e,a,!1)} &_it : ${d}) ${p}`)):n.push(r+"  "+p),n.push(r+"  break;"),n.push(r+"}")}return n.push("      default: {"),n.push("        continue;"),n.push("      }"),n.push("    }"),n.push("  }"),n.push("  _wb.writeVarUint(0);"),n.push("  return true;"),n.push("}"),n.push(""),n}function uE(i,e){let t=i.fields,n=[];n.push(`bool ${i.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema) {`);for(let r=0;r<t.length;r++)if(t[r].isArray){n.push("  uint32_t count;");break}n.push("  std::vector<kiwi::SparseFields<Field>::Element> tempFields;"),n.push("  while (true) {"),n.push("    uint32_t type;"),n.push("    if (!_bb.readVarUint(type)) return false;"),n.push("    switch (type) {"),n.push("      case 0: {"),n.push("        _fields = kiwi::SparseFields<Field>(tempFields.data(), tempFields.size(), _pool);"),n.push("        return true;"),n.push("      }");for(let r=0;r<t.length;r++){let o=t[r],a=$i(o),s=o.isArray?"_it":a,l=so(e,o),d=E_(e,o,s),c=yr(e,o,!1),p=$h(r),u=Jh(r),h=`_flags[${p}] |= ${u}`;n.push(`      case ${o.value}: {`);let f="        ";o.isArray?(n.push(f+"if (!_bb.readVarUint(count)) return false;"),o.isDeprecated?o.type==="byte"?n.push(f+"if (!_bb.skipCount(count)) return false;"):n.push(f+`for (${c} &_it : _pool.array<${c}>(count)) if (!${d}) return false;`):(n.push(f+`${h};`),n.push(f+`${yr(e,o,!0)} ${a} = _pool.array<${c}>(count);`),o.type==="byte"?n.push(f+`if (!_bb.readByteArray(${a}.data(), count)) return false;`):n.push(f+`for (${c} &_it : ${a}) if (!${d}) return false;`),n.push(f+`tempFields.push_back({${o.value}, Field{.${a} = ${a}}});`))):(l?n.push(f+`${c}* ${a} = _pool.allocate<${c}>();`):n.push(f+`${c} ${a} = {};`),n.push(f+`if (!${d}) return false;`),o.isDeprecated||(n.push(f+`${h};`),n.push(f+`tempFields.push_back({${o.value}, Field{.${a} = ${a}}});`))),n.push("        break;"),n.push("      }")}return n.push("      default: {"),n.push(`        if (!_schema || !_schema->skip${i.name}Field(_bb, type)) return false;`),n.push("        break;"),n.push("      }"),n.push("    }"),n.push("  }"),n.push("}"),n.push(""),n}function pE(i,e={}){let t={};for(let s of i.definitions)t[s.name]=s;let{sparseMessages:n=[],copyableMessages:r=[],separateEnumFile:o}=e;for(let s of n)s in t||ln(`Requesting sparse implementation for ${et(s)} which is not defined in the schema`,0,0);let a=[];a.push('#include "kiwi.h"'),o&&a.push(`#include "${o}"`),a.push(""),i.package!==null&&(a.push(`namespace ${i.package} {`),a.push(""),a.push(`#ifndef INCLUDE_${i.package.toUpperCase()}_H`),a.push(`#define INCLUDE_${i.package.toUpperCase()}_H`),a.push("")),a.push("class BinarySchema {"),a.push("public:"),a.push("  bool parse(kiwi::ByteBuffer &bb);"),a.push("  const kiwi::BinarySchema &underlyingSchema() const { return _schema; }");for(let s=0;s<i.definitions.length;s++){let l=i.definitions[s];l.kind==="MESSAGE"&&a.push(`  bool skip${l.name}Field(kiwi::ByteBuffer &bb, uint32_t id) const;`)}a.push(""),a.push("private:"),a.push("  kiwi::BinarySchema _schema;");for(let s=0;s<i.definitions.length;s++){let l=i.definitions[s];l.kind==="MESSAGE"&&a.push(`  uint32_t _index${l.name} = 0;`)}a.push("};"),a.push(""),o||w_(i,a);for(let s of[0,1,2,3]){let l=!1;if(s===3){if(i.package!==null){if(n.length>0){a.push(`}  // namespace ${i.package}`);for(let d of n)a.push("template<>"),a.push(`struct std::hash<${i.package}::${d}::Field> {`),a.push(`  size_t operator()(const ${i.package}::${d}::Field& msg) const {`),a.push("    return 0;"),a.push("  }"),a.push("};");a.push(`namespace ${i.package} {`)}a.push(`#endif  // INCLUDE_${i.package.toUpperCase()}_H`)}a.push("#ifdef IMPLEMENT_SCHEMA_H"),a.push(""),a.push("bool BinarySchema::parse(kiwi::ByteBuffer &bb) {"),a.push("  if (!_schema.parse(bb)) return false;");for(let d=0;d<i.definitions.length;d++){let c=i.definitions[d];c.kind==="MESSAGE"&&a.push(`  _schema.findDefinition("${c.name}", _index${c.name});`)}a.push("  return true;"),a.push("}"),a.push("");for(let d=0;d<i.definitions.length;d++){let c=i.definitions[d];c.kind==="MESSAGE"&&(a.push(`bool BinarySchema::skip${c.name}Field(kiwi::ByteBuffer &bb, uint32_t id) const {`),a.push(`  return _schema.skipField(bb, _index${c.name}, id);`),a.push("}"),a.push(""))}}for(let d=0;d<i.definitions.length;d++){let c=i.definitions[d];if(c.kind==="ENUM")continue;let p=n.includes(c.name);if(p&&c.kind!=="MESSAGE"){let u=`Type ${et(c.name)} cannot be declared as sparse. `;u+=`${et(c.name)} is type ${et(c.kind)}, but needs to be a MESSAGE.`,ln(u,c.line,c.column)}s===0?(a.push(`class ${c.name};`),l=!0):s===1?p?a=a.concat(iE(c,t,r.includes(c.name))):a=a.concat(oE(c,t,r.includes(c.name))):s===2?p?a=a.concat(cE(c,t,r.includes(c.name))):a=a.concat(aE(c,t,r.includes(c.name))):p?(a=a.concat(dE(c,t)),a=a.concat(uE(c,t))):(a=a.concat(sE(c,t)),a=a.concat(lE(c,t)))}s===3?(a.push("#endif  // IMPLEMENT_SCHEMA_H"),a.push("")):l&&a.push("")}return i.package!==null&&(a.push(`}  // namespace ${i.package}`),a.push("")),a.join(`
`)}function hE(i){let e=["#pragma once",""];return i.package&&(e.push(`namespace ${i.package} {`),e.push("")),w_(i,e),i.package&&(e.push(""),e.push(`}  // namespace ${i.package}`),e.push("")),e.join(`
`)}function w_(i,e){for(let t of i.definitions)if(t.kind==="ENUM"){e.push(`enum class ${t.name} : uint32_t {`);for(let n=0;n<t.fields.length;n++){let r=t.fields[n];e.push(`  ${r.name} = ${r.value},`)}e.push("};"),e.push("")}}var R_=Co(()=>{Ja()});var x_={};vi(x_,{compileSchemaSkew:()=>gE});function O_(i){i[i.length-1]===""&&i.pop()}function mE(i,e){if(e.isArray)return"null";switch(e.type){case"bool":return"false";case"byte":case"int":case"uint":return"0";case"int64":case"uint64":return'"0"';case"float":return"0.0";case"string":return"null"}let t=i[e.type];return t.kind==="ENUM"?t.fields.length>0?"."+t.fields[0].name:"0 as "+e.type:"null"}function F_(i){let e;switch(i.type){case"bool":e="bool";break;case"byte":case"int":case"uint":e="int";break;case"int64":case"uint64":e="string";break;case"float":e="double";break;case"string":default:e=i.type;break}return i.isArray&&(e="List<"+e+">"),e}function gE(i){let e={},t="",n=[];i.package!==null&&(n.push("namespace "+i.package+" {"),t+="  ");for(let r=0;r<i.definitions.length;r++){let o=i.definitions[r];e[o.name]=o}n.push(t+"class BinarySchema {"),n.push(t+"  var _schema = Kiwi.BinarySchema.new");for(let r=0;r<i.definitions.length;r++){let o=i.definitions[r];o.kind==="MESSAGE"&&n.push(t+"  var _index"+o.name+" = 0")}n.push(""),n.push(t+"  def parse(bytes Uint8Array) {"),n.push(t+"    _schema.parse(Kiwi.ByteBuffer.new(bytes))");for(let r=0;r<i.definitions.length;r++){let o=i.definitions[r];o.kind==="MESSAGE"&&n.push(t+"    _index"+o.name+' = _schema.findDefinition("'+o.name+'")')}n.push(t+"  }");for(let r=0;r<i.definitions.length;r++){let o=i.definitions[r];o.kind==="MESSAGE"&&(n.push(""),n.push(t+"  def skip"+o.name+"Field(bb Kiwi.ByteBuffer, id int) {"),n.push(t+"    _schema.skipField(bb, _index"+o.name+", id)"),n.push(t+"  }"))}n.push(t+"}"),n.push("");for(let r=0;r<i.definitions.length;r++){let o=i.definitions[r];switch(o.kind){case"ENUM":{let a={},s={};n.push(t+"enum "+o.name+" {");for(let l=0;l<o.fields.length;l++){let d=o.fields[l];a[d.name]=d.value,s[d.value]=d.name,n.push(t+"  "+d.name)}n.push(t+"}"),n.push(""),n.push(t+"namespace "+o.name+" {"),n.push(t+"  const _encode = "+JSON.stringify(a,null,2).replace(/"/g,"").replace(/\n/g,`
  `+t)),n.push(""),n.push(t+"  const _decode = "+JSON.stringify(s,null,2).replace(/"/g,"").replace(/\n/g,`
  `+t)),n.push(""),n.push(t+"  def encode(value "+o.name+") int {"),n.push(t+"    return _encode[value]"),n.push(t+"  }"),n.push(""),n.push(t+"  def decode(value int) "+o.name+" {"),n.push(t+"    if !(value in _decode) {"),n.push(t+"      Kiwi.DecodeError.throwInvalidEnumValue("+et(o.name)+")"),n.push(t+"    }"),n.push(t+"    return _decode[value]"),n.push(t+"  }"),n.push(t+"}"),n.push("");break}case"STRUCT":case"MESSAGE":{n.push(t+"class "+o.name+" {");for(let s=0;s<o.fields.length;s+=32)n.push(t+"  var _flags"+(s>>5)+" = 0");for(let s=0;s<o.fields.length;s++){let l=o.fields[s];l.isDeprecated||n.push(t+"  var _"+l.name+" "+F_(l)+" = "+mE(e,l))}n.push("");for(let s=0;s<o.fields.length;s++){let l=o.fields[s];if(l.isDeprecated)continue;let d=F_(l),c="_flags"+(s>>5),p=""+(1<<s%32>>>0);n.push(t+"  def has_"+l.name+" bool {"),n.push(t+"    return ("+c+" & "+p+") != 0"),n.push(t+"  }"),n.push(""),n.push(t+"  def "+l.name+" "+d+" {"),n.push(t+"    assert(has_"+l.name+")"),n.push(t+"    return _"+l.name),n.push(t+"  }"),n.push(""),n.push(t+"  def "+l.name+"=(value "+d+") {"),n.push(t+"    _"+l.name+" = value"),n.push(t+"    "+c+" |= "+p),n.push(t+"  }"),n.push("")}n.push(t+"  def encode(bb Kiwi.ByteBuffer) {");for(let s=0;s<o.fields.length;s++){let l=o.fields[s];if(l.isDeprecated)continue;let d="_"+l.name,c;switch(l.isArray&&(d="value"),l.type){case"bool":{c="bb.writeByte("+d+" as int)";break}case"byte":{c="bb.writeByte("+d+")";break}case"int":{c="bb.writeVarInt("+d+")";break}case"uint":{c="bb.writeVarUint("+d+")";break}case"int64":{c="bb.writeVarInt64("+d+")";break}case"uint64":{c="bb.writeVarUint64("+d+")";break}case"float":{c="bb.writeVarFloat("+d+")";break}case"string":{c="bb.writeString("+d+")";break}default:{let u=e[l.type];u?u.kind==="ENUM"?c="bb.writeVarUint("+u.name+".encode("+d+"))":c=d+".encode(bb)":ln("Invalid type "+et(l.type)+" for field "+et(l.name),l.line,l.column)}}let p=t+"    ";o.kind==="STRUCT"?n.push(p+"assert(has_"+l.name+")"):(n.push(p+"if has_"+l.name+" {"),p+="  "),o.kind==="MESSAGE"&&n.push(p+"bb.writeVarUint("+l.value+")"),l.isArray?(n.push(p+"bb.writeVarUint(_"+l.name+".count)"),n.push(p+"for value in _"+l.name+" {"),n.push(p+"  "+c),n.push(p+"}")):n.push(p+c),o.kind!=="STRUCT"&&n.push(t+"    }"),n.push("")}o.kind==="MESSAGE"?n.push(t+"    bb.writeVarUint(0)"):O_(n),n.push(t+"  }"),n.push(""),n.push(t+"  def encode Uint8Array {"),n.push(t+"    var bb = Kiwi.ByteBuffer.new"),n.push(t+"    encode(bb)"),n.push(t+"    return bb.toUint8Array"),n.push(t+"  }"),n.push(t+"}"),n.push(""),n.push(t+"namespace "+o.name+" {"),n.push(t+"  def decode(bytes Uint8Array) "+o.name+" {"),n.push(t+"    return decode(Kiwi.ByteBuffer.new(bytes), null)"),n.push(t+"  }"),n.push(""),n.push(t+"  def decode(bytes Uint8Array, schema BinarySchema) "+o.name+" {"),n.push(t+"    return decode(Kiwi.ByteBuffer.new(bytes), schema)"),n.push(t+"  }"),n.push(""),n.push(t+"  def decode(bb Kiwi.ByteBuffer, schema BinarySchema) "+o.name+" {"),n.push(t+"    var self = new");for(let s=0;s<o.fields.length;s++)if(o.fields[s].isArray){n.push(t+"    var count = 0");break}let a=t+"  ";o.kind==="MESSAGE"&&(n.push(t+"    while true {"),n.push(t+"      var type = bb.readVarUint"),n.push(t+"      switch type {"),n.push(t+"        case 0 {"),n.push(t+"          break"),n.push(t+"        }"),n.push(""),a+="      ");for(let s=0;s<o.fields.length;s++){let l=o.fields[s],d;switch(l.type){case"bool":{d=l.isDeprecated?"bb.readByte":"bb.readByte as bool";break}case"byte":{d="bb.readByte";break}case"int":{d="bb.readVarInt";break}case"uint":{d="bb.readVarUint";break}case"int64":{d="bb.readVarInt64";break}case"uint64":{d="bb.readVarUint64";break}case"float":{d="bb.readVarFloat";break}case"string":{d="bb.readString";break}default:{let c=e[l.type];c?c.kind==="ENUM"?d=c.name+".decode(bb.readVarUint)":d=c.name+".decode(bb, schema)":ln("Invalid type "+et(l.type)+" for field "+et(l.name),l.line,l.column)}}o.kind==="MESSAGE"&&n.push(a+"case "+l.value+" {"),l.isArray?l.isDeprecated?(n.push(a+"  for i in 0..bb.readVarUint {"),n.push(a+"    "+d),n.push(a+"  }")):(n.push(a+"  count = bb.readVarUint"),n.push(a+"  self."+l.name+" = []"),n.push(a+"  for array = self._"+l.name+"; count != 0; count-- {"),n.push(a+"    array.append("+d+")"),n.push(a+"  }")):l.isDeprecated?n.push(a+"  "+d):n.push(a+"  self."+l.name+" = "+d),o.kind==="MESSAGE"&&(n.push(a+"}"),n.push(""))}o.kind==="MESSAGE"&&(n.push(t+"        default {"),n.push(t+"          if schema == null { Kiwi.DecodeError.throwInvalidMessage }"),n.push(t+"          else { schema.skip"+o.name+"Field(bb, type) }"),n.push(t+"        }"),n.push(t+"      }"),n.push(t+"    }")),n.push(t+"    return self"),n.push(t+"  }"),n.push(t+"}"),n.push("");break}default:ln("Invalid definition kind "+et(o.kind),o.line,o.column)}}return i.package!==null&&(O_(n),n.push("}")),n.push(""),n.join(`
`)}var P_=Co(()=>{Ja()});var D_={};vi(D_,{compileSchemaSkewTypes:()=>fE});function fE(i){var e="",t=[];i.package!==null&&(t.push("namespace "+i.package+" {"),e+="  ");for(var n=0;n<i.definitions.length;n++){var r=i.definitions[n];if(r.kind==="ENUM"){if(t.push(e+"type "+r.name+" : string {"),t.push(e+"  @alwaysinline"),t.push(e+"  def toString string { return self as string }"),t.push(e+"}"),r.fields.length>0){t.push(e+"namespace "+r.name+" {");for(var o=0;o<r.fields.length;o++)t.push(e+"  @alwaysinline"),t.push(e+"  def "+r.fields[o].name+" "+r.name+" { return "+JSON.stringify(r.fields[o].name)+" as "+r.name+" }");t.push(e+"}")}t.push("")}}for(var n=0;n<i.definitions.length;n++){var r=i.definitions[n];if(r.kind==="STRUCT"||r.kind==="MESSAGE"){t.push(e+"@import"),t.push(e+"class "+r.name+" {");for(var o=0;o<r.fields.length;o++){var a=r.fields[o],s;if(!a.isDeprecated){switch(a.type){case"byte":case"uint":s="int";break;case"uint64":case"int64":s="string";break;case"float":s="double";break;default:s=a.type;break}a.type==="byte"&&a.isArray?s="Uint8Array":a.isArray&&(s="List<"+s+">"),t.push(e+"  var "+a.name+" "+s),t.push(e+"  @alwaysinline"),t.push(e+"  def has_"+a.name+" bool { return self."+a.name+" != dynamic.void(0) }")}}t.push(e+"}"),t.push(""),t.push(e+"namespace "+r.name+" {"),t.push(e+"  @alwaysinline"),t.push(e+"  def new "+r.name+" { return {} as dynamic }"),t.push(e+"}"),t.push("")}else r.kind!=="ENUM"&&ln("Invalid definition kind "+et(r.kind),r.line,r.column)}t.push(e+"type DedupCache = dynamic"),t.push(""),t.push(e+"@import"),t.push(e+"class Schema {"),t.push(e+"  const makeDedupCache fn() DedupCache");for(var n=0;n<i.definitions.length;n++){var r=i.definitions[n];r.kind==="ENUM"?t.push(e+"  const "+r.name+" dynamic"):(r.kind==="STRUCT"||r.kind==="MESSAGE")&&(t.push(e+"  def encode"+r.name+"(message "+r.name+") Uint8Array"),t.push(e+"  def decode"+r.name+"(buffer Uint8Array) "+r.name),t.push(e+"  def decode"+r.name+"(buffer Uint8Array, optionalDedupCache DedupCache) "+r.name))}return t.push(e+"}"),i.package!==null&&t.push("}"),t.push(""),t.join(`
`)}var M_=Co(()=>{Ja()});var L_={};vi(L_,{compileSchemaTypeScript:()=>_E});function _E(i){var e="",t=[];i.package!==null&&(t.push("export namespace "+i.package+" {"),e+="  ");for(var n=0;n<i.definitions.length;n++){var r=i.definitions[n];if(r.kind==="ENUM"){t.push(e+"export type "+r.name+" =");for(var o=0;o<r.fields.length;o++)t.push(e+"  "+JSON.stringify(r.fields[o].name)+(o+1<r.fields.length?" |":";"));r.fields.length||t.push(e+"  any;"),t.push("")}}for(var n=0;n<i.definitions.length;n++){var r=i.definitions[n];if(r.kind==="STRUCT"||r.kind==="MESSAGE"){t.push(e+"export interface "+r.name+" {");for(var o=0;o<r.fields.length;o++){var a=r.fields[o],s;if(!a.isDeprecated){switch(a.type){case"bool":s="boolean";break;case"byte":case"int":case"uint":case"float":s="number";break;case"int64":case"uint64":s="string";break;default:s=a.type;break}a.type==="byte"&&a.isArray?s="Uint8Array":a.isArray&&(s+="[]"),t.push(e+"  "+a.name+(r.kind==="MESSAGE"?"?":"")+": "+s+";")}}t.push(e+"}"),t.push("")}else r.kind!=="ENUM"&&ln("Invalid definition kind "+et(r.kind),r.line,r.column)}t.push(e+"export type DedupCache = any;"),t.push(""),t.push(e+"export interface Schema {"),t.push(e+"  makeDedupCache(): DedupCache;");for(var n=0;n<i.definitions.length;n++){var r=i.definitions[n];r.kind==="ENUM"?t.push(e+"  "+r.name+": any;"):(r.kind==="STRUCT"||r.kind==="MESSAGE")&&(t.push(e+"  encode"+r.name+"(message: "+r.name+"): Uint8Array;"),t.push(e+"  decode"+r.name+"(buffer: Uint8Array, optionalDedupCache?: DedupCache): "+r.name+";"))}return t.push(e+"}"),i.package!==null&&t.push("}"),t.push(""),t.join(`
`)}var B_=Co(()=>{Ja()});var V_={};vi(V_,{prettyPrintSchema:()=>AE});function AE(i){let e=i.definitions,t="";i.package!==null&&(t+="package "+i.package+`;
`);for(let n=0;n<e.length;n++){let r=e[n];(n>0||i.package!==null)&&(t+=`
`),t+=r.kind.toLowerCase()+" "+r.name+` {
`;for(let o=0;o<r.fields.length;o++){let a=r.fields[o];t+="  ",r.kind!=="ENUM"&&(t+=a.type,a.isArray&&(t+="[]"),t+=" "),t+=a.name,r.kind!=="STRUCT"&&(t+=" = "+a.value),a.isDeprecated&&(t+=" [deprecated]"),t+=`;
`}t+=`}
`}return t}var k_=Co(()=>{});var Xs=Hh(bn=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});bn.prettyPrintSchema=bn.parseSchema=bn.encodeBinarySchema=bn.decodeBinarySchema=bn.compileSchemaTypeScript=bn.compileSchemaSkewTypes=bn.compileSchemaSkew=bn.compileSchemaCPP=bn.compileSchemaCallbackCPP=bn.compileSchemaJS=bn.compileSchema=bn.ByteBuffer=void 0;var SE=(jd(),Ei(l_));Object.defineProperty(bn,"ByteBuffer",{enumerable:!0,get:function(){return SE.ByteBuffer}});var U_=(A_(),Ei(__));Object.defineProperty(bn,"compileSchema",{enumerable:!0,get:function(){return U_.compileSchema}});Object.defineProperty(bn,"compileSchemaJS",{enumerable:!0,get:function(){return U_.compileSchemaJS}});var yE=(v_(),Ei(I_));Object.defineProperty(bn,"compileSchemaCallbackCPP",{enumerable:!0,get:function(){return yE.compileSchemaCallbackCPP}});var bE=(R_(),Ei(N_));Object.defineProperty(bn,"compileSchemaCPP",{enumerable:!0,get:function(){return bE.compileSchemaCPP}});var TE=(P_(),Ei(x_));Object.defineProperty(bn,"compileSchemaSkew",{enumerable:!0,get:function(){return TE.compileSchemaSkew}});var IE=(M_(),Ei(D_));Object.defineProperty(bn,"compileSchemaSkewTypes",{enumerable:!0,get:function(){return IE.compileSchemaSkewTypes}});var vE=(B_(),Ei(L_));Object.defineProperty(bn,"compileSchemaTypeScript",{enumerable:!0,get:function(){return vE.compileSchemaTypeScript}});var G_=(jh(),Ei(g_));Object.defineProperty(bn,"decodeBinarySchema",{enumerable:!0,get:function(){return G_.decodeBinarySchema}});Object.defineProperty(bn,"encodeBinarySchema",{enumerable:!0,get:function(){return G_.encodeBinarySchema}});var EE=(Kh(),Ei(m_));Object.defineProperty(bn,"parseSchema",{enumerable:!0,get:function(){return EE.parseSchema}});var CE=(k_(),Ei(V_));Object.defineProperty(bn,"prettyPrintSchema",{enumerable:!0,get:function(){return CE.prettyPrintSchema}})});var AS=Hh((Tm,Im)=>{(function(i,e){typeof Tm=="object"&&typeof Im<"u"?Im.exports=e():typeof define=="function"&&define.amd?define(e):(i=i||self).RBush=e()})(Tm,function(){"use strict";function i(m,A,y,S,g){(function b(T,I,O,w,P){for(;w>O;){if(w-O>600){var H=w-O+1,re=I-O+1,q=Math.log(H),W=.5*Math.exp(2*q/3),x=.5*Math.sqrt(q*W*(H-W)/H)*(re-H/2<0?-1:1),F=Math.max(O,Math.floor(I-re*W/H+x)),k=Math.min(w,Math.floor(I+(H-re)*W/H+x));b(T,I,F,k,P)}var G=T[I],M=O,Q=w;for(e(T,O,I),P(T[w],G)>0&&e(T,O,w);M<Q;){for(e(T,M,Q),M++,Q--;P(T[M],G)<0;)M++;for(;P(T[Q],G)>0;)Q--}P(T[O],G)===0?e(T,O,Q):e(T,++Q,w),Q<=I&&(O=Q+1),I<=Q&&(w=Q-1)}})(m,A,y||0,S||m.length-1,g||t)}function e(m,A,y){var S=m[A];m[A]=m[y],m[y]=S}function t(m,A){return m<A?-1:m>A?1:0}var n=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(m,A,y){if(!y)return A.indexOf(m);for(var S=0;S<A.length;S++)if(y(m,A[S]))return S;return-1}function o(m,A){a(m,0,m.children.length,A,m)}function a(m,A,y,S,g){g||(g=f(null)),g.minX=1/0,g.minY=1/0,g.maxX=-1/0,g.maxY=-1/0;for(var b=A;b<y;b++){var T=m.children[b];s(g,m.leaf?S(T):T)}return g}function s(m,A){return m.minX=Math.min(m.minX,A.minX),m.minY=Math.min(m.minY,A.minY),m.maxX=Math.max(m.maxX,A.maxX),m.maxY=Math.max(m.maxY,A.maxY),m}function l(m,A){return m.minX-A.minX}function d(m,A){return m.minY-A.minY}function c(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function p(m){return m.maxX-m.minX+(m.maxY-m.minY)}function u(m,A){return m.minX<=A.minX&&m.minY<=A.minY&&A.maxX<=m.maxX&&A.maxY<=m.maxY}function h(m,A){return A.minX<=m.maxX&&A.minY<=m.maxY&&A.maxX>=m.minX&&A.maxY>=m.minY}function f(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _(m,A,y,S,g){for(var b=[A,y];b.length;)if(!((y=b.pop())-(A=b.pop())<=S)){var T=A+Math.ceil((y-A)/S/2)*S;i(m,T,A,y,g),b.push(A,T,T,y)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(m){var A=this.data,y=[];if(!h(m,A))return y;for(var S=this.toBBox,g=[];A;){for(var b=0;b<A.children.length;b++){var T=A.children[b],I=A.leaf?S(T):T;h(m,I)&&(A.leaf?y.push(T):u(m,I)?this._all(T,y):g.push(T))}A=g.pop()}return y},n.prototype.collides=function(m){var A=this.data;if(!h(m,A))return!1;for(var y=[];A;){for(var S=0;S<A.children.length;S++){var g=A.children[S],b=A.leaf?this.toBBox(g):g;if(h(m,b)){if(A.leaf||u(m,b))return!0;y.push(g)}}A=y.pop()}return!1},n.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var A=0;A<m.length;A++)this.insert(m[A]);return this}var y=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var S=this.data;this.data=y,y=S}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},n.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},n.prototype.clear=function(){return this.data=f([]),this},n.prototype.remove=function(m,A){if(!m)return this;for(var y,S,g,b=this.data,T=this.toBBox(m),I=[],O=[];b||I.length;){if(b||(b=I.pop(),S=I[I.length-1],y=O.pop(),g=!0),b.leaf){var w=r(m,b.children,A);if(w!==-1)return b.children.splice(w,1),I.push(b),this._condense(I),this}g||b.leaf||!u(b,T)?S?(y++,b=S.children[y],g=!1):b=null:(I.push(b),O.push(y),y=0,S=b,b=b.children[0])}return this},n.prototype.toBBox=function(m){return m},n.prototype.compareMinX=function(m,A){return m.minX-A.minX},n.prototype.compareMinY=function(m,A){return m.minY-A.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(m){return this.data=m,this},n.prototype._all=function(m,A){for(var y=[];m;)m.leaf?A.push.apply(A,m.children):y.push.apply(y,m.children),m=y.pop();return A},n.prototype._build=function(m,A,y,S){var g,b=y-A+1,T=this._maxEntries;if(b<=T)return o(g=f(m.slice(A,y+1)),this.toBBox),g;S||(S=Math.ceil(Math.log(b)/Math.log(T)),T=Math.ceil(b/Math.pow(T,S-1))),(g=f([])).leaf=!1,g.height=S;var I=Math.ceil(b/T),O=I*Math.ceil(Math.sqrt(T));_(m,A,y,O,this.compareMinX);for(var w=A;w<=y;w+=O){var P=Math.min(w+O-1,y);_(m,w,P,I,this.compareMinY);for(var H=w;H<=P;H+=I){var re=Math.min(H+I-1,P);g.children.push(this._build(m,H,re,S-1))}}return o(g,this.toBBox),g},n.prototype._chooseSubtree=function(m,A,y,S){for(;S.push(A),!A.leaf&&S.length-1!==y;){for(var g=1/0,b=1/0,T=void 0,I=0;I<A.children.length;I++){var O=A.children[I],w=c(O),P=(H=m,re=O,(Math.max(re.maxX,H.maxX)-Math.min(re.minX,H.minX))*(Math.max(re.maxY,H.maxY)-Math.min(re.minY,H.minY))-w);P<b?(b=P,g=w<g?w:g,T=O):P===b&&w<g&&(g=w,T=O)}A=T||A.children[0]}var H,re;return A},n.prototype._insert=function(m,A,y){var S=y?m:this.toBBox(m),g=[],b=this._chooseSubtree(S,this.data,A,g);for(b.children.push(m),s(b,S);A>=0&&g[A].children.length>this._maxEntries;)this._split(g,A),A--;this._adjustParentBBoxes(S,g,A)},n.prototype._split=function(m,A){var y=m[A],S=y.children.length,g=this._minEntries;this._chooseSplitAxis(y,g,S);var b=this._chooseSplitIndex(y,g,S),T=f(y.children.splice(b,y.children.length-b));T.height=y.height,T.leaf=y.leaf,o(y,this.toBBox),o(T,this.toBBox),A?m[A-1].children.push(T):this._splitRoot(y,T)},n.prototype._splitRoot=function(m,A){this.data=f([m,A]),this.data.height=m.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(m,A,y){for(var S,g,b,T,I,O,w,P=1/0,H=1/0,re=A;re<=y-A;re++){var q=a(m,0,re,this.toBBox),W=a(m,re,y,this.toBBox),x=(g=q,b=W,T=void 0,I=void 0,O=void 0,w=void 0,T=Math.max(g.minX,b.minX),I=Math.max(g.minY,b.minY),O=Math.min(g.maxX,b.maxX),w=Math.min(g.maxY,b.maxY),Math.max(0,O-T)*Math.max(0,w-I)),F=c(q)+c(W);x<P?(P=x,S=re,H=F<H?F:H):x===P&&F<H&&(H=F,S=re)}return S||y-A},n.prototype._chooseSplitAxis=function(m,A,y){var S=m.leaf?this.compareMinX:l,g=m.leaf?this.compareMinY:d;this._allDistMargin(m,A,y,S)<this._allDistMargin(m,A,y,g)&&m.children.sort(S)},n.prototype._allDistMargin=function(m,A,y,S){m.children.sort(S);for(var g=this.toBBox,b=a(m,0,A,g),T=a(m,y-A,y,g),I=p(b)+p(T),O=A;O<y-A;O++){var w=m.children[O];s(b,m.leaf?g(w):w),I+=p(b)}for(var P=y-A-1;P>=A;P--){var H=m.children[P];s(T,m.leaf?g(H):H),I+=p(T)}return I},n.prototype._adjustParentBBoxes=function(m,A,y){for(var S=y;S>=0;S--)s(A[S],m)},n.prototype._condense=function(m){for(var A=m.length-1,y=void 0;A>=0;A--)m[A].children.length===0?A>0?(y=m[A-1].children).splice(y.indexOf(m[A]),1):this.clear():o(m[A],this.toBBox)},n})});var RI=Hh((Td,Bf)=>{(function(e,t){typeof Td=="object"&&typeof Bf=="object"?Bf.exports=t():typeof define=="function"&&define.amd?define([],t):typeof Td=="object"?Td.JsDiff=t():e.JsDiff=t()})(Td,function(){return function(i){var e={};function t(n){if(e[n])return e[n].exports;var r=e[n]={exports:{},id:n,loaded:!1};return i[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}return t.m=i,t.c=e,t.p="",t(0)}([function(i,e,t){"use strict";e.__esModule=!0,e.canonicalize=e.convertChangesToXML=e.convertChangesToDMP=e.merge=e.parsePatch=e.applyPatches=e.applyPatch=e.createPatch=e.createTwoFilesPatch=e.structuredPatch=e.diffArrays=e.diffJson=e.diffCss=e.diffSentences=e.diffTrimmedLines=e.diffLines=e.diffWordsWithSpace=e.diffWords=e.diffChars=e.Diff=void 0;var n=t(1),r=y(n),o=t(2),a=t(3),s=t(5),l=t(6),d=t(7),c=t(8),p=t(9),u=t(10),h=t(11),f=t(13),_=t(14),m=t(16),A=t(17);function y(S){return S&&S.__esModule?S:{default:S}}e.Diff=r.default,e.diffChars=o.diffChars,e.diffWords=a.diffWords,e.diffWordsWithSpace=a.diffWordsWithSpace,e.diffLines=s.diffLines,e.diffTrimmedLines=s.diffTrimmedLines,e.diffSentences=l.diffSentences,e.diffCss=d.diffCss,e.diffJson=c.diffJson,e.diffArrays=p.diffArrays,e.structuredPatch=_.structuredPatch,e.createTwoFilesPatch=_.createTwoFilesPatch,e.createPatch=_.createPatch,e.applyPatch=u.applyPatch,e.applyPatches=u.applyPatches,e.parsePatch=h.parsePatch,e.merge=f.merge,e.convertChangesToDMP=m.convertChangesToDMP,e.convertChangesToXML=A.convertChangesToXML,e.canonicalize=c.canonicalize},function(i,e){"use strict";e.__esModule=!0,e.default=t;function t(){}t.prototype={diff:function(a,s){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},d=l.callback;typeof l=="function"&&(d=l,l={}),this.options=l;var c=this;function p(g){return d?(setTimeout(function(){d(void 0,g)},0),!0):g}a=this.castInput(a),s=this.castInput(s),a=this.removeEmpty(this.tokenize(a)),s=this.removeEmpty(this.tokenize(s));var u=s.length,h=a.length,f=1,_=u+h,m=[{newPos:-1,components:[]}],A=this.extractCommon(m[0],s,a,0);if(m[0].newPos+1>=u&&A+1>=h)return p([{value:this.join(s),count:s.length}]);function y(){for(var g=-1*f;g<=f;g+=2){var b=void 0,T=m[g-1],I=m[g+1],O=(I?I.newPos:0)-g;T&&(m[g-1]=void 0);var w=T&&T.newPos+1<u,P=I&&0<=O&&O<h;if(!w&&!P){m[g]=void 0;continue}if(!w||P&&T.newPos<I.newPos?(b=r(I),c.pushComponent(b.components,void 0,!0)):(b=T,b.newPos++,c.pushComponent(b.components,!0,void 0)),O=c.extractCommon(b,s,a,g),b.newPos+1>=u&&O+1>=h)return p(n(c,b.components,s,a,c.useLongestToken));m[g]=b}f++}if(d)(function g(){setTimeout(function(){if(f>_)return d();y()||g()},0)})();else for(;f<=_;){var S=y();if(S)return S}},pushComponent:function(a,s,l){var d=a[a.length-1];d&&d.added===s&&d.removed===l?a[a.length-1]={count:d.count+1,added:s,removed:l}:a.push({count:1,added:s,removed:l})},extractCommon:function(a,s,l,d){for(var c=s.length,p=l.length,u=a.newPos,h=u-d,f=0;u+1<c&&h+1<p&&this.equals(s[u+1],l[h+1]);)u++,h++,f++;return f&&a.components.push({count:f}),a.newPos=u,h},equals:function(a,s){return this.options.comparator?this.options.comparator(a,s):a===s||this.options.ignoreCase&&a.toLowerCase()===s.toLowerCase()},removeEmpty:function(a){for(var s=[],l=0;l<a.length;l++)a[l]&&s.push(a[l]);return s},castInput:function(a){return a},tokenize:function(a){return a.split("")},join:function(a){return a.join("")}};function n(o,a,s,l,d){for(var c=0,p=a.length,u=0,h=0;c<p;c++){var f=a[c];if(f.removed){if(f.value=o.join(l.slice(h,h+f.count)),h+=f.count,c&&a[c-1].added){var m=a[c-1];a[c-1]=a[c],a[c]=m}}else{if(!f.added&&d){var _=s.slice(u,u+f.count);_=_.map(function(y,S){var g=l[h+S];return g.length>y.length?g:y}),f.value=o.join(_)}else f.value=o.join(s.slice(u,u+f.count));u+=f.count,f.added||(h+=f.count)}}var A=a[p-1];return p>1&&typeof A.value=="string"&&(A.added||A.removed)&&o.equals("",A.value)&&(a[p-2].value+=A.value,a.pop()),a}function r(o){return{newPos:o.newPos,components:o.components.slice(0)}}},function(i,e,t){"use strict";e.__esModule=!0,e.characterDiff=void 0,e.diffChars=s;var n=t(1),r=o(n);function o(l){return l&&l.__esModule?l:{default:l}}var a=e.characterDiff=new r.default;function s(l,d,c){return a.diff(l,d,c)}},function(i,e,t){"use strict";e.__esModule=!0,e.wordDiff=void 0,e.diffWords=c,e.diffWordsWithSpace=p;var n=t(1),r=a(n),o=t(4);function a(u){return u&&u.__esModule?u:{default:u}}var s=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,l=/\S/,d=e.wordDiff=new r.default;d.equals=function(u,h){return this.options.ignoreCase&&(u=u.toLowerCase(),h=h.toLowerCase()),u===h||this.options.ignoreWhitespace&&!l.test(u)&&!l.test(h)},d.tokenize=function(u){for(var h=u.split(/(\s+|\b)/),f=0;f<h.length-1;f++)!h[f+1]&&h[f+2]&&s.test(h[f])&&s.test(h[f+2])&&(h[f]+=h[f+2],h.splice(f+1,2),f--);return h};function c(u,h,f){return f=(0,o.generateOptions)(f,{ignoreWhitespace:!0}),d.diff(u,h,f)}function p(u,h,f){return d.diff(u,h,f)}},function(i,e){"use strict";e.__esModule=!0,e.generateOptions=t;function t(n,r){if(typeof n=="function")r.callback=n;else if(n)for(var o in n)n.hasOwnProperty(o)&&(r[o]=n[o]);return r}},function(i,e,t){"use strict";e.__esModule=!0,e.lineDiff=void 0,e.diffLines=l,e.diffTrimmedLines=d;var n=t(1),r=a(n),o=t(4);function a(c){return c&&c.__esModule?c:{default:c}}var s=e.lineDiff=new r.default;s.tokenize=function(c){var p=[],u=c.split(/(\n|\r\n)/);u[u.length-1]||u.pop();for(var h=0;h<u.length;h++){var f=u[h];h%2&&!this.options.newlineIsToken?p[p.length-1]+=f:(this.options.ignoreWhitespace&&(f=f.trim()),p.push(f))}return p};function l(c,p,u){return s.diff(c,p,u)}function d(c,p,u){var h=(0,o.generateOptions)(u,{ignoreWhitespace:!0});return s.diff(c,p,h)}},function(i,e,t){"use strict";e.__esModule=!0,e.sentenceDiff=void 0,e.diffSentences=s;var n=t(1),r=o(n);function o(l){return l&&l.__esModule?l:{default:l}}var a=e.sentenceDiff=new r.default;a.tokenize=function(l){return l.split(/(\S.+?[.!?])(?=\s+|$)/)};function s(l,d,c){return a.diff(l,d,c)}},function(i,e,t){"use strict";e.__esModule=!0,e.cssDiff=void 0,e.diffCss=s;var n=t(1),r=o(n);function o(l){return l&&l.__esModule?l:{default:l}}var a=e.cssDiff=new r.default;a.tokenize=function(l){return l.split(/([{}:;,]|\s+)/)};function s(l,d,c){return a.diff(l,d,c)}},function(i,e,t){"use strict";e.__esModule=!0,e.jsonDiff=void 0;var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u};e.diffJson=c,e.canonicalize=p;var r=t(1),o=s(r),a=t(5);function s(u){return u&&u.__esModule?u:{default:u}}var l=Object.prototype.toString,d=e.jsonDiff=new o.default;d.useLongestToken=!0,d.tokenize=a.lineDiff.tokenize,d.castInput=function(u){var h=this.options,f=h.undefinedReplacement,_=h.stringifyReplacer,m=_===void 0?function(A,y){return typeof y>"u"?f:y}:_;return typeof u=="string"?u:JSON.stringify(p(u,null,null,m),m,"  ")},d.equals=function(u,h){return o.default.prototype.equals.call(d,u.replace(/,([\r\n])/g,"$1"),h.replace(/,([\r\n])/g,"$1"))};function c(u,h,f){return d.diff(u,h,f)}function p(u,h,f,_,m){h=h||[],f=f||[],_&&(u=_(m,u));var A=void 0;for(A=0;A<h.length;A+=1)if(h[A]===u)return f[A];var y=void 0;if(l.call(u)==="[object Array]"){for(h.push(u),y=new Array(u.length),f.push(y),A=0;A<u.length;A+=1)y[A]=p(u[A],h,f,_,m);return h.pop(),f.pop(),y}if(u&&u.toJSON&&(u=u.toJSON()),(typeof u>"u"?"undefined":n(u))==="object"&&u!==null){h.push(u),y={},f.push(y);var S=[],g=void 0;for(g in u)u.hasOwnProperty(g)&&S.push(g);for(S.sort(),A=0;A<S.length;A+=1)g=S[A],y[g]=p(u[g],h,f,_,g);h.pop(),f.pop()}else y=u;return y}},function(i,e,t){"use strict";e.__esModule=!0,e.arrayDiff=void 0,e.diffArrays=s;var n=t(1),r=o(n);function o(l){return l&&l.__esModule?l:{default:l}}var a=e.arrayDiff=new r.default;a.tokenize=function(l){return l.slice()},a.join=a.removeEmpty=function(l){return l};function s(l,d,c){return a.diff(l,d,c)}},function(i,e,t){"use strict";e.__esModule=!0,e.applyPatch=s,e.applyPatches=l;var n=t(11),r=t(12),o=a(r);function a(d){return d&&d.__esModule?d:{default:d}}function s(d,c){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof c=="string"&&(c=(0,n.parsePatch)(c)),Array.isArray(c)){if(c.length>1)throw new Error("applyPatch only works with a single input.");c=c[0]}var u=d.split(/\r\n|[\n\v\f\r\x85]/),h=d.match(/\r\n|[\n\v\f\r\x85]/g)||[],f=c.hunks,_=p.compareLine||function(j,ie,de,tt){return ie===tt},m=0,A=p.fuzzFactor||0,y=0,S=0,g=void 0,b=void 0;function T(j,ie){for(var de=0;de<j.lines.length;de++){var tt=j.lines[de],bt=tt.length>0?tt[0]:" ",ht=tt.length>0?tt.substr(1):tt;if(bt===" "||bt==="-"){if(!_(ie+1,u[ie],bt,ht)&&(m++,m>A))return!1;ie++}}return!0}for(var I=0;I<f.length;I++){for(var O=f[I],w=u.length-O.oldLines,P=0,H=S+O.oldStart-1,re=(0,o.default)(H,y,w);P!==void 0;P=re())if(T(O,H+P)){O.offset=S+=P;break}if(P===void 0)return!1;y=O.offset+O.oldStart+O.oldLines}for(var q=0,W=0;W<f.length;W++){var x=f[W],F=x.oldStart+x.offset+q-1;q+=x.newLines-x.oldLines,F<0&&(F=0);for(var k=0;k<x.lines.length;k++){var G=x.lines[k],M=G.length>0?G[0]:" ",Q=G.length>0?G.substr(1):G,Y=x.linedelimiters[k];if(M===" ")F++;else if(M==="-")u.splice(F,1),h.splice(F,1);else if(M==="+")u.splice(F,0,Q),h.splice(F,0,Y),F++;else if(M==="\\"){var B=x.lines[k-1]?x.lines[k-1][0]:null;B==="+"?g=!0:B==="-"&&(b=!0)}}}if(g)for(;!u[u.length-1];)u.pop(),h.pop();else b&&(u.push(""),h.push(`
`));for(var te=0;te<u.length-1;te++)u[te]=u[te]+h[te];return u.join("")}function l(d,c){typeof d=="string"&&(d=(0,n.parsePatch)(d));var p=0;function u(){var h=d[p++];if(!h)return c.complete();c.loadFile(h,function(f,_){if(f)return c.complete(f);var m=s(_,h,c);c.patched(h,m,function(A){if(A)return c.complete(A);u()})})}u()}},function(i,e){"use strict";e.__esModule=!0,e.parsePatch=t;function t(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n.split(/\r\n|[\n\v\f\r\x85]/),a=n.match(/\r\n|[\n\v\f\r\x85]/g)||[],s=[],l=0;function d(){var u={};for(s.push(u);l<o.length;){var h=o[l];if(/^(\-\-\-|\+\+\+|@@)\s/.test(h))break;var f=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(h);f&&(u.index=f[1]),l++}for(c(u),c(u),u.hunks=[];l<o.length;){var _=o[l];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(_))break;if(/^@@/.test(_))u.hunks.push(p());else{if(_&&r.strict)throw new Error("Unknown line "+(l+1)+" "+JSON.stringify(_));l++}}}function c(u){var h=/^(---|\+\+\+)\s+(.*)$/.exec(o[l]);if(h){var f=h[1]==="---"?"old":"new",_=h[2].split("	",2),m=_[0].replace(/\\\\/g,"\\");/^".*"$/.test(m)&&(m=m.substr(1,m.length-2)),u[f+"FileName"]=m,u[f+"Header"]=(_[1]||"").trim(),l++}}function p(){for(var u=l,h=o[l++],f=h.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),_={oldStart:+f[1],oldLines:+f[2]||1,newStart:+f[3],newLines:+f[4]||1,lines:[],linedelimiters:[]},m=0,A=0;l<o.length&&!(o[l].indexOf("--- ")===0&&l+2<o.length&&o[l+1].indexOf("+++ ")===0&&o[l+2].indexOf("@@")===0);l++){var y=o[l].length==0&&l!=o.length-1?" ":o[l][0];if(y==="+"||y==="-"||y===" "||y==="\\")_.lines.push(o[l]),_.linedelimiters.push(a[l]||`
`),y==="+"?m++:y==="-"?A++:y===" "&&(m++,A++);else break}if(!m&&_.newLines===1&&(_.newLines=0),!A&&_.oldLines===1&&(_.oldLines=0),r.strict){if(m!==_.newLines)throw new Error("Added line count did not match for hunk at line "+(u+1));if(A!==_.oldLines)throw new Error("Removed line count did not match for hunk at line "+(u+1))}return _}for(;l<o.length;)d();return s}},function(i,e){"use strict";e.__esModule=!0,e.default=function(t,n,r){var o=!0,a=!1,s=!1,l=1;return function d(){if(o&&!s){if(a?l++:o=!1,t+l<=r)return l;s=!0}if(!a)return s||(o=!0),n<=t-l?-l++:(a=!0,d())}}},function(i,e,t){"use strict";e.__esModule=!0,e.calcLineCount=s,e.merge=l;var n=t(14),r=t(11),o=t(15);function a(w){if(Array.isArray(w)){for(var P=0,H=Array(w.length);P<w.length;P++)H[P]=w[P];return H}else return Array.from(w)}function s(w){var P=O(w.lines),H=P.oldLines,re=P.newLines;H!==void 0?w.oldLines=H:delete w.oldLines,re!==void 0?w.newLines=re:delete w.newLines}function l(w,P,H){w=d(w,H),P=d(P,H);var re={};(w.index||P.index)&&(re.index=w.index||P.index),(w.newFileName||P.newFileName)&&(c(w)?c(P)?(re.oldFileName=p(re,w.oldFileName,P.oldFileName),re.newFileName=p(re,w.newFileName,P.newFileName),re.oldHeader=p(re,w.oldHeader,P.oldHeader),re.newHeader=p(re,w.newHeader,P.newHeader)):(re.oldFileName=w.oldFileName,re.newFileName=w.newFileName,re.oldHeader=w.oldHeader,re.newHeader=w.newHeader):(re.oldFileName=P.oldFileName||w.oldFileName,re.newFileName=P.newFileName||w.newFileName,re.oldHeader=P.oldHeader||w.oldHeader,re.newHeader=P.newHeader||w.newHeader)),re.hunks=[];for(var q=0,W=0,x=0,F=0;q<w.hunks.length||W<P.hunks.length;){var k=w.hunks[q]||{oldStart:1/0},G=P.hunks[W]||{oldStart:1/0};if(u(k,G))re.hunks.push(h(k,x)),q++,F+=k.newLines-k.oldLines;else if(u(G,k))re.hunks.push(h(G,F)),W++,x+=G.newLines-G.oldLines;else{var M={oldStart:Math.min(k.oldStart,G.oldStart),oldLines:0,newStart:Math.min(k.newStart+x,G.oldStart+F),newLines:0,lines:[]};f(M,k.oldStart,k.lines,G.oldStart,G.lines),W++,q++,re.hunks.push(M)}}return re}function d(w,P){if(typeof w=="string"){if(/^@@/m.test(w)||/^Index:/m.test(w))return(0,r.parsePatch)(w)[0];if(!P)throw new Error("Must provide a base reference or pass in a patch");return(0,n.structuredPatch)(void 0,void 0,P,w)}return w}function c(w){return w.newFileName&&w.newFileName!==w.oldFileName}function p(w,P,H){return P===H?P:(w.conflict=!0,{mine:P,theirs:H})}function u(w,P){return w.oldStart<P.oldStart&&w.oldStart+w.oldLines<P.oldStart}function h(w,P){return{oldStart:w.oldStart,oldLines:w.oldLines,newStart:w.newStart+P,newLines:w.newLines,lines:w.lines}}function f(w,P,H,re,q){var W={offset:P,lines:H,index:0},x={offset:re,lines:q,index:0};for(y(w,W,x),y(w,x,W);W.index<W.lines.length&&x.index<x.lines.length;){var F=W.lines[W.index],k=x.lines[x.index];if((F[0]==="-"||F[0]==="+")&&(k[0]==="-"||k[0]==="+"))_(w,W,x);else if(F[0]==="+"&&k[0]===" "){var G;(G=w.lines).push.apply(G,a(g(W)))}else if(k[0]==="+"&&F[0]===" "){var M;(M=w.lines).push.apply(M,a(g(x)))}else F[0]==="-"&&k[0]===" "?m(w,W,x):k[0]==="-"&&F[0]===" "?m(w,x,W,!0):F===k?(w.lines.push(F),W.index++,x.index++):A(w,g(W),g(x))}S(w,W),S(w,x),s(w)}function _(w,P,H){var re=g(P),q=g(H);if(T(re)&&T(q)){if((0,o.arrayStartsWith)(re,q)&&I(H,re,re.length-q.length)){var W;(W=w.lines).push.apply(W,a(re));return}else if((0,o.arrayStartsWith)(q,re)&&I(P,q,q.length-re.length)){var x;(x=w.lines).push.apply(x,a(q));return}}else if((0,o.arrayEqual)(re,q)){var F;(F=w.lines).push.apply(F,a(re));return}A(w,re,q)}function m(w,P,H,re){var q=g(P),W=b(H,q);if(W.merged){var x;(x=w.lines).push.apply(x,a(W.merged))}else A(w,re?W:q,re?q:W)}function A(w,P,H){w.conflict=!0,w.lines.push({conflict:!0,mine:P,theirs:H})}function y(w,P,H){for(;P.offset<H.offset&&P.index<P.lines.length;){var re=P.lines[P.index++];w.lines.push(re),P.offset++}}function S(w,P){for(;P.index<P.lines.length;){var H=P.lines[P.index++];w.lines.push(H)}}function g(w){for(var P=[],H=w.lines[w.index][0];w.index<w.lines.length;){var re=w.lines[w.index];if(H==="-"&&re[0]==="+"&&(H="+"),H===re[0])P.push(re),w.index++;else break}return P}function b(w,P){for(var H=[],re=[],q=0,W=!1,x=!1;q<P.length&&w.index<w.lines.length;){var F=w.lines[w.index],k=P[q];if(k[0]==="+")break;if(W=W||F[0]!==" ",re.push(k),q++,F[0]==="+")for(x=!0;F[0]==="+";)H.push(F),F=w.lines[++w.index];k.substr(1)===F.substr(1)?(H.push(F),w.index++):x=!0}if((P[q]||"")[0]==="+"&&W&&(x=!0),x)return H;for(;q<P.length;)re.push(P[q++]);return{merged:re,changes:H}}function T(w){return w.reduce(function(P,H){return P&&H[0]==="-"},!0)}function I(w,P,H){for(var re=0;re<H;re++){var q=P[P.length-H+re].substr(1);if(w.lines[w.index+re]!==" "+q)return!1}return w.index+=H,!0}function O(w){var P=0,H=0;return w.forEach(function(re){if(typeof re!="string"){var q=O(re.mine),W=O(re.theirs);P!==void 0&&(q.oldLines===W.oldLines?P+=q.oldLines:P=void 0),H!==void 0&&(q.newLines===W.newLines?H+=q.newLines:H=void 0)}else H!==void 0&&(re[0]==="+"||re[0]===" ")&&H++,P!==void 0&&(re[0]==="-"||re[0]===" ")&&P++}),{oldLines:P,newLines:H}}},function(i,e,t){"use strict";e.__esModule=!0,e.structuredPatch=o,e.createTwoFilesPatch=a,e.createPatch=s;var n=t(5);function r(l){if(Array.isArray(l)){for(var d=0,c=Array(l.length);d<l.length;d++)c[d]=l[d];return c}else return Array.from(l)}function o(l,d,c,p,u,h,f){f||(f={}),typeof f.context>"u"&&(f.context=4);var _=(0,n.diffLines)(c,p,f);_.push({value:"",lines:[]});function m(w){return w.map(function(P){return" "+P})}for(var A=[],y=0,S=0,g=[],b=1,T=1,I=function(P){var H=_[P],re=H.lines||H.value.replace(/\n$/,"").split(`
`);if(H.lines=re,H.added||H.removed){var q;if(!y){var W=_[P-1];y=b,S=T,W&&(g=f.context>0?m(W.lines.slice(-f.context)):[],y-=g.length,S-=g.length)}(q=g).push.apply(q,r(re.map(function(Y){return(H.added?"+":"-")+Y}))),H.added?T+=re.length:b+=re.length}else{if(y)if(re.length<=f.context*2&&P<_.length-2){var x;(x=g).push.apply(x,r(m(re)))}else{var F,k=Math.min(re.length,f.context);(F=g).push.apply(F,r(m(re.slice(0,k))));var G={oldStart:y,oldLines:b-y+k,newStart:S,newLines:T-S+k,lines:g};if(P>=_.length-2&&re.length<=f.context){var M=/\n$/.test(c),Q=/\n$/.test(p);re.length==0&&!M?g.splice(G.oldLines,0,"\\ No newline at end of file"):(!M||!Q)&&g.push("\\ No newline at end of file")}A.push(G),y=0,S=0,g=[]}b+=re.length,T+=re.length}},O=0;O<_.length;O++)I(O);return{oldFileName:l,newFileName:d,oldHeader:u,newHeader:h,hunks:A}}function a(l,d,c,p,u,h,f){var _=o(l,d,c,p,u,h,f),m=[];l==d&&m.push("Index: "+l),m.push("==================================================================="),m.push("--- "+_.oldFileName+(typeof _.oldHeader>"u"?"":"	"+_.oldHeader)),m.push("+++ "+_.newFileName+(typeof _.newHeader>"u"?"":"	"+_.newHeader));for(var A=0;A<_.hunks.length;A++){var y=_.hunks[A];m.push("@@ -"+y.oldStart+","+y.oldLines+" +"+y.newStart+","+y.newLines+" @@"),m.push.apply(m,y.lines)}return m.join(`
`)+`
`}function s(l,d,c,p,u,h){return a(l,l,d,c,p,u,h)}},function(i,e){"use strict";e.__esModule=!0,e.arrayEqual=t,e.arrayStartsWith=n;function t(r,o){return r.length!==o.length?!1:n(r,o)}function n(r,o){if(o.length>r.length)return!1;for(var a=0;a<o.length;a++)if(o[a]!==r[a])return!1;return!0}},function(i,e){"use strict";e.__esModule=!0,e.convertChangesToDMP=t;function t(n){for(var r=[],o=void 0,a=void 0,s=0;s<n.length;s++)o=n[s],o.added?a=1:o.removed?a=-1:a=0,r.push([a,o.value]);return r}},function(i,e){"use strict";e.__esModule=!0,e.convertChangesToXML=t;function t(r){for(var o=[],a=0;a<r.length;a++){var s=r[a];s.added?o.push("<ins>"):s.removed&&o.push("<del>"),o.push(n(s.value)),s.added?o.push("</ins>"):s.removed&&o.push("</del>")}return o.join("")}function n(r){var o=r;return o=o.replace(/&/g,"&amp;"),o=o.replace(/</g,"&lt;"),o=o.replace(/>/g,"&gt;"),o=o.replace(/"/g,"&quot;"),o}}])})});var Tv=$a(Xs());var Jd=class{constructor(){this.buffer=""}},fn;(t=>{function i(n,r,o){return n<r?r:n>o?o:n}t.Math_clamp1=i;function e(n,r,o){return n<r?r:n>o?o:n}t.Math_clamp2=e})(fn||(fn={}));var ts=i=>i===(i|0);var eu=class{constructor(e){this._context=null,this._ext=null,this._activeQuery=null,this._isRunning=!1,this._eventsPendingTimestamps=[],this._resolvedEvents=[],this._context=e,this._ext=e.getExtension("EXT_disjoint_timer_query")}start(){if(this._ext==null)throw new Error("EXT_disjoint_timer_query WebGL extension is not available. Cannot start profiler.");if(this._isRunning)throw new Error("Profiler is already running");let e=this._context.getExtension("WEBGL_debug_renderer_info");if(e!==null){let t=this._context.getParameter(e.UNMASKED_RENDERER_WEBGL);if(t.indexOf("NVIDIA GeForce GT 750M")!=-1)throw new Error(`${t} cards seem to have a buggy implementation of EXT_disjoint_timer_query. Refusing to profile to avoid confusing results.`)}this._isRunning=!0,this._eventsPendingTimestamps.length=0,this._resolvedEvents.length=0,this._activeQuery=this._ext.createQueryEXT(),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery)}stop(){if(this._ext!=null){if(!this._isRunning)throw new Error("Profiler is already stopped");this._isRunning=!1,this._activeQuery=null,this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT)}}isRunning(){return this._isRunning}_markAction(e){if(this._ext==null)return;if(this._activeQuery==null)throw new Error("Cannot mark actions while no profile is active");let t=this._activeQuery;this._activeQuery=this._ext.createQueryEXT(),this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery),this._eventsPendingTimestamps.push(new em(e,t))}pushFrame(e){this._markAction(new tu(0,e))}popFrame(e){this._markAction(new tu(1,e))}resolveEventsIfPossible(){if(this._ext==null)return;let e=0;for(;e<this._eventsPendingTimestamps.length;){let t=this._eventsPendingTimestamps[e],n=t.query;if(!this._ext.getQueryObjectEXT(n,this._ext.QUERY_RESULT_AVAILABLE_EXT))break;if(this._context.getParameter(this._ext.GPU_DISJOINT_EXT))throw new Error("GPU_DISJOINT_EXT");let r=this._ext.getQueryObjectEXT(n,this._ext.QUERY_RESULT_EXT);this._ext.deleteQueryEXT(n);let a=(this._resolvedEvents.length==0?0:ce.List_last(this._resolvedEvents).timestamp)+r;this._resolvedEvents.push(new tm(t.action,a)),e=e+1}e>0&&(this._eventsPendingTimestamps=this._eventsPendingTimestamps.slice(e))}hasPendingResults(){return this._eventsPendingTimestamps.length!=0}resolvedEvents(){return this._resolvedEvents}exportSpeedscopeProfile(){let e=[],t=[];if(this._resolvedEvents.length==0)throw new Error("Profile is empty");let n={type:"evented",name:"GPU Profile",unit:"nanoseconds",startValue:0,endValue:ce.List_last(this._resolvedEvents).timestamp,events:t},r={$schema:"https://www.speedscope.app/file-format-schema.json",shared:{frames:e},profiles:[n]},o=new Map,a=d=>(o.has(d)||(o.set(d,e.length),e.push({name:d})),o.get(d)),s="O",l="C";for(let d of this._resolvedEvents)t.push({type:d.action.type==0?s:l,frame:a(d.action.name),at:d.timestamp});return JSON.stringify(r)}},z_=(t=>(t[t.OPEN_FRAME=0]="OPEN_FRAME",t[t.CLOSE_FRAME=1]="CLOSE_FRAME",t))(z_||{}),tu=class{constructor(e,t){this.type=e,this.name=t}},em=class{constructor(e,t){this.action=e,this.query=t}},tm=class{constructor(e,t){this.action=e,this.timestamp=t}},H_;(e=>{function i(t){return z_[t]}e.GPUProfilerActionType_toString=i})(H_||(H_={}));var ic;(r=>{function i(o,a,s){js?o.annotateBlock(a,s):s()}r.WebGLRenderingContext_annotateBlock=i;function e(o,a,s){return js?o.annotateBlock(a,s):s()}r.WebGLRenderingContext_annotateBlockAndReturn=e;function t(o,a,s){js?o.annotateProfile(a,s):s()}r.WebGLRenderingContext_annotateProfile=t;function n(o,a){return o.TEXTURE0+a}r.WebGLRenderingContext_TEXTURE_N=n})(ic||(ic={}));var js=!1;var cn;(o=>{function i(a){let s=[];for(let l=0,d=a.length;l<d;l=l+1)s.push(a[l]);return s}o.asList=i;function e(a,s,l){a.addEventListener(s,l)}o.on1=e;function t(a,s,l,d){a.addEventListener(s,l,d)}o.on2=t;function n(a,s,l){a.removeEventListener(s,l)}o.off=n;function r(a){a.preventDefault()}o.preventDefault=r})(cn||(cn={}));var lo;(r=>{function i(o){try{return o.getContext("2d")}catch{}return null}r.HTMLCanvasElement_getContext2D=i;function e(o){let a=null;try{a=o.getContext("webgl")}catch{}return js?n(o,a):a}r.HTMLCanvasElement_getContextWebGL1=e;function t(o,a){let s=null;try{s=o.getContext("webgl",a)}catch{}return js?n(o,s):s}r.HTMLCanvasElement_getContextWebGL2=t;function n(o,a){console.log("WebGL intercepts are enabled. This records all calls.");let s=window.requestAnimationFrame,l=0,d=new eu(a);window.requestAnimationFrame=()=>(l=l+1,d.hasPendingResults()&&d.resolveEventsIfPossible(),s.apply(window,arguments));let c=o,p=a,u=c.width,h=c.height,f=l,_=[],m={},A="  ",y=q=>{_.push(A+q)},S=()=>{l!=f&&(f=l,y("yield;"))},g=(q,W)=>{S(),y(`{ // ${q}`);let x=A;A+="  ",d.isRunning()&&d.pushFrame(q);let F=W();return d.isRunning()&&d.popFrame(q),A=x,y("}"),F},b=(q,W)=>{d.isRunning()&&d.pushFrame(q),W(),d.isRunning()&&d.popFrame(q)},T=()=>{let q=`function* render(gl) {

`;q+=`  // Recorded using https://github.com/evanw/webgl-recorder
`;for(let W in m)q+="  var "+W+`s = [];
`;for(let W of _)q+=W+`
`;return q+=`}
`,q},I=(q,W)=>{let x=document.createElement("a");x.href=URL.createObjectURL(new Blob([q],{type:"application/javascript"})),x.download=W==null?"trace.js":W,document.body.appendChild(x),x.click(),document.body.removeChild(x)},O=q=>{I(T(),q==null?"trace.js":q)},w=()=>{d.start()},P=q=>{d.stop();let W=()=>{d.hasPendingResults()?s(W):I(d.exportSpeedscopeProfile(),`viewer-${+new Date}.speedscope.json`)};W()},H=q=>{if(q instanceof WebGLActiveInfo||q instanceof WebGLBuffer||q instanceof WebGLFramebuffer||q instanceof WebGLProgram||q instanceof WebGLRenderbuffer||q instanceof WebGLShader||q instanceof WebGLShaderPrecisionFormat||q instanceof WebGLTexture||q instanceof WebGLUniformLocation){let W=q.constructor.name,x=W in m?m[W]:m[W]=[],F=x.indexOf(q);return F==-1&&(F=x.length,x.push(q)),W+"s["+F+"]"}return null},re={traceLines:_,compileTrace:T,downloadTrace:O,startProfile:w,stopProfile:P,annotateBlock:g,annotateProfile:b};y(`gl.canvas.width = ${u};`),y(`gl.canvas.height = ${h};`);for(let q in p){let W=p[q];if(typeof W=="function"){let x=((F,k)=>()=>{let G=[];S(),(c.width!=u||c.height!=h)&&(u=c.width,h=c.height,y(`gl.canvas.width = ${u};`),y(`gl.canvas.height = ${h};`));for(let B=0,te=arguments.length;B<te;B=B+1){let j=arguments[B];if(typeof j=="number"||typeof j=="boolean"||typeof j=="string"||Array.isArray(j)||j===null)G.push(JSON.stringify(j));else if(ArrayBuffer.isView(j))G.push(`new ${j.constructor.name}([${Array.prototype.slice.call(j)}])`);else{let ie=H(j);ie!=null?G.push(ie):(console.warn("unsupported value:",j),G.push("null"))}}let M=`gl.${F}(`;for(let B=0,te=G.length;B<te;B=B+1)B!=0&&(M+=", "),M+=G[B];M+=");",d.isRunning()&&F.startsWith("draw")&&d.pushFrame(M);let Q=k.apply(p,arguments);d.isRunning()&&F.startsWith("draw")&&d.popFrame(M);let Y=H(Q);return Y!=null&&(M=Y+" = "+M),y(M),Q})(q,W);re[q]=x}else(x=>{Object.defineProperty(re,x,{set:F=>{p[x]=F},get:()=>p[x]})})(q)}return window.recordingContext=re,re}r.HTMLCanvasElement_makeRecordableContext=n})(lo||(lo={}));var nu;(t=>{function i(n){return n.result}t.FileReader_resultAsArrayBuffer=i;function e(n){return n.result}t.FileReader_resultAsString=e})(nu||(nu={}));var ns;(e=>{function i(t){return t&&t.now?t.now():+new Date}e.Performance_now=i})(ns||(ns={}));var en;(b=>{function i(T,I,O){cn.on1(T,I,O)}b.EventTarget_addEventListener1=i;function e(T,I,O){cn.on1(T,I,O)}b.EventTarget_addEventListener2=e;function t(T,I,O){cn.on1(T,I,O)}b.EventTarget_addEventListener3=t;function n(T,I,O){cn.on1(T,I,O)}b.EventTarget_addEventListener4=n;function r(T,I,O){cn.on1(T,I,O)}b.EventTarget_addEventListener5=r;function o(T,I,O){cn.on1(T,I,O)}b.EventTarget_addEventListener6=o;function a(T,I,O){cn.on1(T,I,O)}b.EventTarget_addEventListener7=a;function s(T,I,O,w){cn.on2(T,I,O,w)}b.EventTarget_addEventListener8=s;function l(T,I,O,w){cn.on2(T,I,O,w)}b.EventTarget_addEventListener9=l;function d(T,I,O,w){cn.on2(T,I,O,w)}b.EventTarget_addEventListener10=d;function c(T,I,O,w){cn.on2(T,I,O,w)}b.EventTarget_addEventListener11=c;function p(T,I,O,w){cn.on2(T,I,O,w)}b.EventTarget_addEventListener12=p;function u(T,I,O,w){cn.on2(T,I,O,w)}b.EventTarget_addEventListener13=u;function h(T,I,O,w){cn.on2(T,I,O,w)}b.EventTarget_addEventListener14=h;function f(T,I,O){cn.off(T,I,O)}b.EventTarget_removeEventListener1=f;function _(T,I,O){cn.off(T,I,O)}b.EventTarget_removeEventListener2=_;function m(T,I,O){cn.off(T,I,O)}b.EventTarget_removeEventListener3=m;function A(T,I,O){cn.off(T,I,O)}b.EventTarget_removeEventListener4=A;function y(T,I,O){cn.off(T,I,O)}b.EventTarget_removeEventListener5=y;function S(T,I,O){cn.off(T,I,O)}b.EventTarget_removeEventListener6=S;function g(T,I,O){cn.off(T,I,O)}b.EventTarget_removeEventListener7=g})(en||(en={}));var jr;(r=>{function i(o){return new Image}r.HTMLDocument_createElementImage=i;function e(o){return o.createElement("canvas")}r.HTMLDocument_createElementCanvas=e;function t(o,a){return cn.asList(o.querySelectorAll(a))}r.HTMLDocument_querySelectorAll=t;function n(o,a){return cn.asList(o.getElementsByClassName(a))}r.HTMLDocument_getElementsByClassName=n})(jr||(jr={}));var Qo;(e=>{function i(t){cn.preventDefault(t)}e.Event_preventDefault=i})(Qo||(Qo={}));var ru;(t=>{function i(n){return cn.asList(n.types)}t.DataTransfer_types=i;function e(n){return cn.asList(n.files)}t.DataTransfer_files=e})(ru||(ru={}));var W_;(e=>{function i(t){if(typeof t.buttons>"u"){let n=t.which;return n<2?n:n==3?2:4}return t.buttons}e.MouseEvent_buttons=i})(W_||(W_={}));var ou;(n=>{function i(r){return cn.asList(r.touches)}n.TouchEvent_touches=i;function e(r){return cn.asList(r.targetTouches)}n.TouchEvent_targetTouches=e;function t(r){return cn.asList(r.changedTouches)}n.TouchEvent_changedTouches=t})(ou||(ou={}));function Zr(){return self}var rs=Zr();var iu;(o=>{function i(s,l){let d=0;switch(l){case 0:{for(let c of s)c<128?d=d+1:c<2048?d=d+2:c<65536?d=d+3:d=d+4;break}case 1:{for(let c of s)c<65536?d=d+1:d=d+2;break}case 2:{d=s.length;break}}return d}o.codeUnitCountForCodePoints=i;let e;(c=>(c[c.UTF8=0]="UTF8",c[c.UTF16=1]="UTF16",c[c.UTF32=2]="UTF32"))(e=o.Encoding||(o.Encoding={}));let a=class a{reset(l,d){return this.value=l,this.index=d,this.stop=l.length,this}countCodePointsUntil(l){let d=0;for(;this.index<l&&this.nextCodePoint()>=0;)d=d+1;return d}previousCodePoint(){if(this.index<=0)return-1;let l=this.value.charCodeAt(this.index=this.index-1);return(l&64512)!=56320?l:this.index<=0?-1:(this.value.charCodeAt(this.index=this.index-1)<<10)+l+(65536-56623104-56320)}nextCodePoint(){if(this.index>=this.stop)return-1;let l=this.value.charCodeAt((this.index=this.index+1)+-1);if((l&64512)!=55296)return l;if(this.index>=this.stop)return-1;let d=this.value.charCodeAt((this.index=this.index+1)+-1);return(l<<10)+d+(65536-56623104-56320)}constructor(){this.value="",this.index=0,this.stop=0}};a.INSTANCE=new a;let t=a;o.StringIterator=a;let n;(l=>{function s(d){return e[d]}l.Encoding_toString=s})(n=o.in_Encoding||(o.in_Encoding={})),o.STRING_ENCODING=Ji==1?0:Ji==2||Ji==3?1:2})(iu||(iu={}));var Se=class{static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:e.value==t.value}constructor(e){this.value=e}},ce;(h=>{function i(f){f.length!=0,f.pop()}h.List_removeLast=i;function e(f){let _=0;for(let m=0,A=f.length;m<A;m=m+1){let y=!1,S=f[m];for(let g=0;g<m;g=g+1)if(S==f[g]){y=!0;break}y||(_<m&&(f[_]=f[m]),_=_+1)}for(;_<f.length;)i(f)}h.List_removeDuplicates=e;function t(f){return f.length!=0,f[f.length-1]}h.List_last=t;let n=1e5;function r(f,_){if(_!=f,_.length<n){f.push(..._);return}for(let m of _)f.push(m)}h.List_append2=r;function o(f,_,m){if(m!=f,m.length<n){f.splice(_,0,...m);return}for(let A of m)f.splice(_,0,A),_=_+1}h.List_insert1=o;function a(f,_){f.indexOf(_)==-1&&f.push(_)}h.List_appendOne=a;function s(f,_){let m=f.indexOf(_);m>=0&&f.splice(m,1)}h.List_removeOne=s;function l(f,_){let m=0;for(let A=0,y=f.length;A<y;A=A+1)_(f[A])||(m<A&&(f[m]=f[A]),m=m+1);for(;m<f.length;)i(f)}h.List_removeIf=l;function d(f,_){if(f.length!=_.length)return!1;for(let m=0,A=f.length;m<A;m=m+1)if(f[m]!=_[m])return!1;return!0}h.List_equals=d;function c(f,_){let m=f.slice();return m.push(_),m}h.List_cloneAndAppend=c;function p(f,_,m){let A=m;for(let y=0,S=f.length;y<S;y=y+1)A=_(A,f[y],y);return A}h.List_reduce=p;function u(f,_,m){if(f==null!=(_==null))return!1;if(f==null)return!0;if(f.length==_.length){for(let A=0,y=f.length;A<y;A=A+1)if(!m(f[A],_[A]))return!1;return!0}return!1}h.List_equalsWithComparison=u})(ce||(ce={}));var Le;(n=>{function i(r,o,a){let s=r.get(o);return s!==void 0?s:a}n.StringMap_get=i;function e(r,o){r.forEach((a,s)=>{o(s,a)})}n.StringMap_each=e;function t(r){let o={};return e(r,(a,s)=>{o[a]=s}),o}n.StringMap_toJSObject=t})(Le||(Le={}));var qt;(t=>{function i(n,r,o){let a=n.get(r);return a!==void 0?a:o}t.IntMap_get=i;function e(n,r){n.forEach((o,a)=>{r(a,o)})}t.IntMap_each=e})(qt||(qt={}));var At;(t=>{function i(n,r){return(r<n?1:0)-(r>n?1:0)}t.int_compare=i;function e(n,r){return rs.hack1=n,rs.hack2=r,rs.hack3=rs.hack1%rs.hack2,rs.hack3|0}t.int_remainder=e})(At||(At={}));var tn;(n=>{function i(r,o){return(o<r?1:0)-(o>r?1:0)}n.double_compare=i;function e(r,o,a){return r*(1-a)+o*a}n.double_lerp=e;function t(r,o,a){return Math.min(Math.max(r,o),a)}n.double_clamp=t})(tn||(tn={}));var Wn;(a=>{function i(s){return s}a.string_toString=i;function e(s){let l=new Jd;for(let d of s)l.buffer+=o(d);return l.buffer}a.string_fromCodePoints=e;function t(s,l){return(l<s|0)-(l>s|0)}a.string_compare=t;function n(s){let l="";for(let d of s)l+=String.fromCharCode(d);return l}a.string_fromCodeUnits=n;function r(s){let l=[],d=iu.StringIterator.INSTANCE;for(d.reset(s,0);;){let c=d.nextCodePoint();if(c<0)return l;l.push(c)}}a.string_codePoints=r;function o(s){return s<65536?String.fromCharCode(s):String.fromCharCode((s-65536>>10)+55296)+String.fromCharCode((s-65536&1024-1)+56320)}a.string_fromCodePoint=o})(Wn||(Wn={}));var Ji=3;var Be;(b=>{function i(T,I,O,w,P,H){b._internalTrackAnalyticsEvent=T,b._internalDefinedAnalyticsHandler=I,b._appTimerStart=O,b._appTimerStop=w,b._internalLoadTimeTracker=P,b._internalSocketConnectionTracker=H}b.initialize=i;function e(T){let I=b._internalTrackAnalyticsEvent;return b._internalTrackAnalyticsEvent=T,()=>{b._internalTrackAnalyticsEvent=I}}b.mockTrackEvent=e;function t(T,I){b._internalDefinedAnalyticsHandler!==null&&b._internalDefinedAnalyticsHandler.trackDefinedEvent(T,Le.StringMap_toJSObject(I))}b.trackDefinedEvent=t;function n(T,I){b._internalTrackAnalyticsEvent!=null&&(0,b._internalTrackAnalyticsEvent)(T,Le.StringMap_toJSObject(I),void 0)}b.trackEvent1=n;function r(T,I,O){b._internalTrackAnalyticsEvent!=null&&(0,b._internalTrackAnalyticsEvent)(T,Le.StringMap_toJSObject(I),Le.StringMap_toJSObject(O))}b.trackEvent2=r;function o(T,I){a(T,I,void 0)}b.trackEventJSON1=o;function a(T,I,O){b._internalTrackAnalyticsEvent!=null&&(0,b._internalTrackAnalyticsEvent)(T,I,O)}b.trackEventJSON2=a;function s(T){b._appTimerStart!=null&&(0,b._appTimerStart)(T)}b.appTimerStart=s;function l(T){b._appTimerStop!=null&&(0,b._appTimerStop)(T)}b.appTimerStop=l;function d(){b._internalLoadTimeTracker!==null&&b._internalLoadTimeTracker.handleMultiplayerOpenConnection()}b.handleMultiplayerOpenConnection=d;function c(){b._internalLoadTimeTracker!==null&&b._internalLoadTimeTracker.handleMultiplayerIFLSatisfied()}b.handleMultiplayerIFLSatisfied=c;function p(){b._internalLoadTimeTracker!==null&&b._internalLoadTimeTracker.handleMultiplayerFirstResponse()}b.handleMultiplayerFirstResponse=p;function u(){b._internalLoadTimeTracker!==null&&b._internalLoadTimeTracker.handleIFLCompleted()}b.handleIFLCompleted=u;function h(T){b._internalSocketConnectionTracker!==null&&b._internalSocketConnectionTracker.handleSocketDisconnect(T)}b.handleMultiplayerSocketDisconnected=h;function f(T,I,O,w){b._internalSocketConnectionTracker!==null&&(T||I>3)&&b._internalSocketConnectionTracker.handleSocketConnectionAttempt(T,I,O,w)}b.handleMultiplayerSocketConnectionAttempt=f,b._internalTrackAnalyticsEvent=null,b._internalDefinedAnalyticsHandler=null,b._internalLoadTimeTracker=null,b._internalSocketConnectionTracker=null,b._appTimerStart=null,b._appTimerStop=null})(Be||(Be={}));var wt;(T=>{function i(){return T._workerURL}T.getWorkerURL=i;function e(I){T._workerURL=I}T.setWorkerURL=e;function t(){return T._imagePrefixURL}T.getImagePrefixURL=t;function n(I){T._imagePrefixURL=I}T.setImagePrefixURL=n;function r(){return T._imageBatchURL}T.getImageBatchURL=r;function o(I){T._imageBatchURL=I}T.setImageBatchURL=o;function a(){return T._videoPrefixURL}T.getVideoPrefixUrl=a;function s(I){T._videoPrefixURL=I}T.setVideoPrefixUrl=s;function l(){return T._deviceInfoByIdentifier}T.getDeviceInfoByIdentifier=l;function d(I){T._deviceInfoByIdentifier=I}T.setDeviceInfoByIdentifier=d;function c(){return T._containerElement}T.getContainerElement=c;function p(I){T._containerElement=I}T.setContainerElement=p;function u(){return T._forceMobileOptimizations}T.forceMobileOptimizations=u;function h(I){let O=P=>{if(!(P in I))throw new Error(`Missing required parameter '${P}'`);return I[P]},w=(P,H)=>P in I?I[P]:H;T._workerURL=O("workerURL"),T._deviceInfoByIdentifier=w("deviceInfoByIdentifier",T._deviceInfoByIdentifierDefault),T._containerElement=O("containerElement"),T._forceMobileOptimizations=w("forceMobileOptimizations",!1)}T.initialize=h,T._workerURL=null,T._imagePrefixURL=null,T._imageBatchURL=null,T._videoPrefixURL=null,T._deviceInfoByIdentifierDefault=null,T._deviceInfoByIdentifier=T._deviceInfoByIdentifierDefault,T._containerElement=null,T._forceMobileOptimizations=!1})(wt||(wt={}));var Xe;(m=>{let i;function e(A){i=A}m.initialize=e;function t(){return i!=null&&i.mac==!0}m.mac=t;function n(){return i!=null&&i.windows==!0}m.windows=n;function r(){return i!=null&&i.ios==!0}m.ios=r;function o(){return i!=null&&i.android==!0}m.android=o;function a(){return i!=null&&i.linux==!0}m.linux=a;function s(){return i!=null&&i.chrome==!0}m.chrome=s;function l(){return i!=null&&i.safari==!0}m.safari=l;function d(){return i!=null&&i.firefox==!0}m.firefox=d;function c(){return i!=null&&i.msedge==!0}m.edge=c;function p(){return i!=null&&i.msie==!0}m.msie=p;function u(A){return A==2||A==1}m.isMobile=u;function h(){return m.isMobile(m.current())||m.current()==4&&navigator.maxTouchPoints>0}m.isCurrentOSMobileOrIPad=h;function f(){return m.OS__current==0&&(m.OS__current=t()?4:n()?5:r()?2:o()?1:a()?3:0),m.OS__current}m.current=f,m.OS__current=0})(Xe||(Xe={}));var E=class i{constructor(e,t){this._x=0,this._y=0,this._x=e,this._y=t}x(){return this._x}y(){return this._y}setX(e){this._x=e}setY(e){this._y=e}multiply(e){return new i(this.x()*e,this.y()*e)}multiply1(e){return new i(this.x()*e.x(),this.y()*e.y())}add(e){return new i(this.x()+e,this.y()+e)}add1(e){return new i(this.x()+e.x(),this.y()+e.y())}negative(){return new i(-this.x(),-this.y())}subtract(e){return new i(this.x()-e,this.y()-e)}subtract1(e){return new i(this.x()-e.x(),this.y()-e.y())}divide(e){return new i(this.x()/e,this.y()/e)}divide1(e){return new i(this.x()/e.x(),this.y()/e.y())}clone(){return new i(this.x(),this.y())}dot(e){return this.x()*e.x()+this.y()*e.y()}equals(e){return this.x()==e.x()&&this.y()==e.y()}freeze(){return this.clone()}isZero(){return this.x()==0&&this.y()==0}isPositive(){return this.x()>0&&this.y()>0}length(){return Math.sqrt(this.x()*this.x()+this.y()*this.y())}max1(){return Math.max(this.x(),this.y())}max2(e){return new i(Math.max(this.x(),e.x()),Math.max(this.y(),e.y()))}min1(){return Math.min(this.x(),this.y())}min2(e){return new i(Math.min(this.x(),e.x()),Math.min(this.y(),e.y()))}distanceTo(e){return Math.sqrt(this.squaredDistanceTo(e))}withOnesForZeros(){return new i(this.x()==0?1:this.x(),this.y()==0?1:this.y())}area(){return this.x()*this.y()}squaredDistanceTo(e){let t=this.x()-e.x(),n=this.y()-e.y();return t*t+n*n}approximatelyEquals(e,t){return this.squaredDistanceTo(e)<=t*t}mixedWith(e,t){return new i(this.x()+(e.x()-this.x())*t,this.y()+(e.y()-this.y())*t)}flipped(){return new i(this._y,this._x)}mixWith(e,t){this._x+=(e.x()-this.x())*t,this._y+=(e.y()-this.y())*t}addUpdate(e){this._x+=e,this._y+=e}addUpdate1(e){this._x+=e.x(),this._y+=e.y()}subtractUpdate(e){this._x-=e,this._y-=e}subtractUpdate1(e){this._x-=e.x(),this._y-=e.y()}multiplyUpdate(e){this._x*=e,this._y*=e}multiplyUpdate1(e){this._x*=e.x(),this._y*=e.y()}divideUpdate(e){this._x/=e,this._y/=e}divideUpdate1(e){this._x/=e.x(),this._y/=e.y()}rounded(){return new i(Math.round(this._x),Math.round(this._y))}setTo(e,t){return this._x=e,this._y=t,this}copyFrom(e){return this._x=e.x(),this._y=e.y(),this}makeAbs(){return this._x=Math.abs(this._x),this._y=Math.abs(this._y),this}toString(){return`Vector(${this.x()}, ${this.y()})`}toJSON(){return{x:this._x,y:this._y}}static new2(){return new i(0,0)}static new3(e){return new i(e.x(),e.y())}static cross(e,t){return e.x()*t.y()-e.y()*t.x()}static lerp(e,t,n){return e.multiply(1-n).add1(t.multiply(n))}static equals_(e,t){return e==null!=(t==null)?!1:e==null?!0:e.equals(t)}},ve;(s=>{function i(){return E.new2()}s.FrozenVector_new1=i;function e(l){return l}s.FrozenVector_new2=e;function t(l){return E.new3(l)}s.FrozenVector_new3=t;function n(l,d){return new E(l,d)}s.FrozenVector_new4=n,s.FrozenVector_ZERO=i(),s.FrozenVector_ONE=n(1,1),s.FrozenVector_INFINITY=n(1/0,1/0)})(ve||(ve={}));var dr=class dr{static fromMinAndMax(e,t,n,r){return new dr(e,t,n-e,r-t)}constructor(e,t,n,r){this._x=0,this._y=0,this._width=0,this._height=0,this._x=e,this._y=t,this._width=n,this._height=r}x(){return this._x}y(){return this._y}width(){return this._width}height(){return this._height}setX(e){this._x=e}setY(e){this._y=e}setWidth(e){this._width=e}setHeight(e){this._height=e}clone(){return new dr(this.x(),this.y(),this.width(),this.height())}freeze(){return this.clone()}left(){return this.x()}top(){return this.y()}right(){return this.x()+this.width()}bottom(){return this.y()+this.height()}centerX(){return this.x()+this.width()/2}centerY(){return this.y()+this.height()/2}area(){return this.width()*this.height()}isEmpty(){return!(this.width()>0&&this.height()>0)}isInvalid(){return!(this.width()>=0&&this.height()>=0)}isFinite(){return isFinite(this._x)&&isFinite(this._y)&&isFinite(this._width)&&isFinite(this._height)}equals(e){return this.x()==e.x()&&this.y()==e.y()&&this.width()==e.width()&&this.height()==e.height()}contains1(e){return this.isEmpty()||e.isEmpty()?!1:this._x<=e.x()&&this._y<=e.y()&&this._x+this._width>=e.x()+e.width()&&this._y+this._height>=e.y()+e.height()}contains2(e){return!this.isEmpty()&&e!=null&&this.left()<=e.x()&&e.x()<this.right()&&this.top()<=e.y()&&e.y()<this.bottom()}overlaps(e){return!this.isEmpty()&&e!=null&&!e.isEmpty()&&this.left()<e.right()&&e.left()<this.right()&&this.top()<e.bottom()&&e.top()<this.bottom()}distanceTo(e){let t=Math.max(0,Math.abs(this.centerX()-e.centerX())-(this.width()+e.width())/2),n=Math.max(0,Math.abs(this.centerY()-e.centerY())-(this.height()+e.height())/2);return Math.sqrt(t*t+n*n)}topLeft(){return new E(this.left(),this.top())}topRight(){return new E(this.right(),this.top())}bottomLeft(){return new E(this.left(),this.bottom())}bottomRight(){return new E(this.right(),this.bottom())}size(){return new E(this.width(),this.height())}center(){return new E(this.x()+this.width()/2,this.y()+this.height()/2)}centerSelf(){return this.translate2(this.center().negative()),this}translate1(e,t){this._x+=e,this._y+=t}translate2(e){this._x+=e.x(),this._y+=e.y()}translatedBy(e){let t=this.clone();return t.translate2(e),t}scaleFromCenter(e){e-=1,this.expand2(this.width()*e,this.height()*e)}scaledBy1(e){return this.scaledBy2(new E(e,e))}scaledBy2(e){return this.isInvalid()?this.copyFrom(dr.INVALID):this.isFinite()?(this._x=this._x*e.x(),this._y=this._y*e.y(),this._width=this._width*e.x(),this._height=this._height*e.y(),this):this.copyFrom(dr.INFINITE)}expandToInts(){let e=Math.floor(this._x),t=Math.floor(this._y);this._width=Math.ceil(this._x+this._width)-e,this._height=Math.ceil(this._y+this._height)-t,this._x=e,this._y=t}setTo1(e,t,n,r){return this._x=e,this._y=t,this._width=n,this._height=r,this}setTo2(e,t){return this._x=e.x(),this._y=e.y(),this._width=t.x(),this._height=t.y(),this}copyFrom(e){return this.setX(e.x()),this.setY(e.y()),this.setWidth(e.width()),this.setHeight(e.height()),this}expand1(e){this._x-=e,this._y-=e,this._width+=2*e,this._height+=2*e}contract(e){this.expand1(-e)}expandedBy1(e){return this.expand1(e),this}expandedBy2(e,t){return this.expand2(e,t),this}expand2(e,t){this._x-=e,this._y-=t,this._width+=2*e,this._height+=2*t}expandToInclude(e){if(e.isEmpty())return;if(this.isEmpty()){this.copyFrom(e);return}let t=Math.min(this._x,e.x()),n=Math.min(this._y,e.y());this._width=Math.max(this._x+this._width,e.x()+e.width())-t,this._height=Math.max(this._y+this._height,e.y()+e.height())-n,this._x=t,this._y=n}intersectedWith(e){return this.intersectWith(e),this}intersectWith(e){if(this.isEmpty()||e.isEmpty())this.copyFrom(Jn.FrozenRect_EMPTY);else{let t=Math.max(this._x,e.x()),n=Math.max(this._y,e.y());this._width=Math.min(this._x+this._width,e.x()+e.width())-t,this._height=Math.min(this._y+this._height,e.y()+e.height())-n,this._x=t,this._y=n}}round(){let e=Math.round(this._x),t=Math.round(this._y),n=Math.round(this._x+this._width),r=Math.round(this._y+this._height);this._x=e,this._y=t,this._width=n-e,this._height=r-t}rounded(){return this.round(),this}toString(){return`Rect(${this.x()}, ${this.y()}, ${this.width()}, ${this.height()})`}transformInto1(e,t){Tt.INSTANCE.reset();let n=E.new2();for(let r=0;r<4;r=r+1)n.setTo(this._x+this._width*(r&1),this._y+this._height*(r>>1)),t.transformPoint(n),Tt.INSTANCE.include2(n);Tt.INSTANCE.buildTo(e)}transformBy1(e){this.transformInto1(this,e)}transformInto2(e,t){Tt.INSTANCE.reset();let n=E.new2();for(let r=0;r<4;r=r+1)n.setTo(this._x+this._width*(r&1),this._y+this._height*(r>>1)),t.transformPoint(n),Tt.INSTANCE.include2(n);Tt.INSTANCE.buildTo(e)}transformBy2(e){this.transformInto2(this,e)}leftThird(){return new dr(this._x,this._y,this._width/3,this._height)}rightThird(){let e=this._width/3;return new dr(this._x+2*e,this._y,this._width/3,this._height)}static new2(){return new dr(0,0,0,0)}static new3(e){return new dr(e.x(),e.y(),e.width(),e.height())}static new4(e,t){return new dr(e.x(),e.y(),t.x(),t.y())}};dr.INVALID=new dr(1/0,1/0,-1/0,-1/0),dr.INFINITE=new dr(-1/0,-1/0,1/0,1/0),dr.CLIP=dr.fromMinAndMax(-1,-1,1,1),dr.UNIT=new dr(0,0,1,1);var U=dr,au=class au{constructor(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this.reset()}isValid(){return this._minX<this._maxX&&this._minY<this._maxY}isValidOrZeroArea(){return this._minX<=this._maxX&&this._minY<=this._maxY}reset(){this._minX=1/0,this._minY=1/0,this._maxX=-1/0,this._maxY=-1/0}include1(e,t){this._minX=Math.min(this._minX,e),this._minY=Math.min(this._minY,t),this._maxX=Math.max(this._maxX,e),this._maxY=Math.max(this._maxY,t)}include2(e){this.include1(e.x(),e.y())}include3(e){e!=null&&!e.isEmpty()&&(this.include1(e.left(),e.top()),this.include1(e.right(),e.bottom()))}include4(e,t){if(!e.isEmpty()){let n=U.new2();e.transformInto1(n,t),this.include3(n)}}buildTo(e){e.setTo1(this._minX,this._minY,this._maxX-this._minX,this._maxY-this._minY)}build(){let e=U.new2();return this.buildTo(e),e}};au.INSTANCE=new au;var Tt=au,os=class i{constructor(){if(arguments[0]==0){let[,e,t,n,r]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=U.new4(e,t),this._nodeRadius=n,this._cornerSmoothing=r}else if(arguments[0]==1){let[,e,t,n,r]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=U.new4(e,t),this._vertexRadii=n,this._cornerSmoothing=r}else if(arguments[0]==2){let[,e,t,n,r]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=e,this._nodeRadius=t,this._vertexRadii=n}}clone(){var e;return new i(2,this._rect.clone(),this._nodeRadius,(e=this._vertexRadii)==null?void 0:e.slice(),this._cornerSmoothing)}cornerSmoothing(){return this._cornerSmoothing}left(){return this._rect.x()}top(){return this._rect.top()}width(){return this._rect.width()}height(){return this._rect.height()}rect(){return this._rect}nodeRadius(){return this._nodeRadius}vertexRadii(){return this._vertexRadii}isRounded(){return this._nodeRadius>0||this._vertexRadii!=null&&this._vertexRadii.some(e=>e>0)}transform(e){e.transformRect(this._rect)}contract(e){this._rect.contract(e)}expand(e){this._rect.expand1(e)}adjustCornerRadiiForSpread(e){if(this._vertexRadii!=null)for(let t=0,n=this.vertexRadii().length;t<n;t=t+1)this._vertexRadii[t]!=0&&(this._vertexRadii[t]=Math.max(this._vertexRadii[t]+e,0));else this._nodeRadius!=0&&(this._nodeRadius=Math.max(this._nodeRadius+e,0))}},Jn;(o=>{function i(){return U.new2()}o.FrozenRect_new1=i;function e(a){return a}o.FrozenRect_new2=e;function t(a){return U.new3(a)}o.FrozenRect_new3=t;function n(a,s,l,d){return new U(a,s,l,d)}o.FrozenRect_new4=n,o.FrozenRect_EMPTY=i()})(Jn||(Jn={}));var oe=class i{constructor(e,t,n,r,o,a){this._m00=0,this._m01=0,this._m02=0,this._m10=0,this._m11=0,this._m12=0,this._m00=e,this._m01=t,this._m02=n,this._m10=r,this._m11=o,this._m12=a}m00(){return this._m00}m01(){return this._m01}m02(){return this._m02}m10(){return this._m10}m11(){return this._m11}m12(){return this._m12}setM00(e){this._m00=e}setM01(e){this._m01=e}setM02(e){this._m02=e}setM10(e){this._m10=e}setM11(e){this._m11=e}setM12(e){this._m12=e}axisX(){return new E(this.m00(),this.m10())}axisY(){return new E(this.m01(),this.m11())}clone(){return new i(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12())}toAngle(){return Math.atan2(-this.m01(),this.m00())}scale1(){return new E(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))}hasPerpendicularAxes(e){return Math.abs(this.m00()*this.m10()+this.m01()*this.m11())<e}isAxisAligned(e){return Math.abs(this.m00())<e&&Math.abs(this.m11())<e||Math.abs(this.m01())<e&&Math.abs(this.m10())<e}isAxisAlignedScaleInvariant(e){let t=Math.sqrt(this._m00*this._m00+this._m10*this._m10)*e,n=Math.sqrt(this._m01*this._m01+this._m11*this._m11)*e;return Math.abs(this.m00())<t&&Math.abs(this.m11())<n||Math.abs(this.m01())<t&&Math.abs(this.m10())<n}valueEquals(e,t){return e==t||isNaN(e)&&isNaN(t)}equals1(e){return this.valueEquals(this._m00,e.m00())&&this.valueEquals(this._m01,e.m01())&&this.valueEquals(this._m02,e.m02())&&this.valueEquals(this._m10,e.m10())&&this.valueEquals(this._m11,e.m11())&&this.valueEquals(this._m12,e.m12())}equals2(e,t){return Math.abs(this._m00-e.m00())<t&&Math.abs(this._m01-e.m01())<t&&Math.abs(this._m02-e.m02())<t&&Math.abs(this._m10-e.m10())<t&&Math.abs(this._m11-e.m11())<t&&Math.abs(this._m12-e.m12())<t}translation(){return new E(this._m02,this._m12)}translate1(e){this.translate2(e.x(),e.y())}translate2(e,t){this._m02+=e*this.m00()+t*this.m01(),this._m12+=e*this.m10()+t*this.m11()}translatedBy1(e){return this.translate1(e),this}translatedBy2(e,t){return this.translate2(e,t),this}rotatedBy(e){return this.rotate(e),this}rotate(e){let t=Math.sin(e),n=Math.cos(e),r=n*this.m00()+t*this.m01(),o=n*this.m01()-t*this.m00(),a=n*this.m10()+t*this.m11(),s=n*this.m11()-t*this.m10();this._m00=r,this._m01=o,this._m10=a,this._m11=s}scale2(e){this.scale4(e,e)}scale3(e){this.scale4(e.x(),e.y())}scale4(e,t){this._m00*=e,this._m01*=t,this._m10*=e,this._m11*=t}skewX(e){let t=Math.tan(e);this._m01+=this._m00*t,this._m11+=this._m10*t}skewY(e){let t=Math.tan(e);this._m00+=this._m01*t,this._m10+=this._m10*t}scaledBy1(e){return this.scale3(e),this}scaledBy2(e){return this.scale2(e),this}scaledBy3(e,t){return this.scale4(e,t),this}multiply(e){let t=this.m00()*e.m00()+this.m01()*e.m10(),n=this.m00()*e.m01()+this.m01()*e.m11(),r=this.m00()*e.m02()+this.m01()*e.m12()+this.m02(),o=this.m10()*e.m00()+this.m11()*e.m10(),a=this.m10()*e.m01()+this.m11()*e.m11(),s=this.m10()*e.m02()+this.m11()*e.m12()+this.m12();this._m00=t,this._m01=n,this._m02=r,this._m10=o,this._m11=a,this._m12=s}rightMultiply(e){this.multiply(e)}leftMultiply(e){let t=this.m00()*e.m00()+this.m10()*e.m01(),n=this.m01()*e.m00()+this.m11()*e.m01(),r=this.m02()*e.m00()+this.m12()*e.m01()+e.m02(),o=this.m00()*e.m10()+this.m10()*e.m11(),a=this.m01()*e.m10()+this.m11()*e.m11(),s=this.m02()*e.m10()+this.m12()*e.m11()+e.m12();this._m00=t,this._m01=n,this._m02=r,this._m10=o,this._m11=a,this._m12=s}multipliedBy1(e){return this.multiply(e),this}multipliedBy2(e){return this.multipliedBy1(Nt.FrozenAffineTransform_new6(e))}invert(){let e=1/(this.m00()*this.m11()-this.m01()*this.m10());if(!isFinite(e))return!1;let t=this.m11()*e,n=-this.m01()*e,r=(this.m01()*this.m12()-this.m11()*this.m02())*e,o=-this.m10()*e,a=this.m00()*e,s=(this.m10()*this.m02()-this.m00()*this.m12())*e;return this._m00=t,this._m01=n,this._m02=r,this._m10=o,this._m11=a,this._m12=s,!0}inverse(){let e=this.clone(),t=e.invert();return e}transformPoint(e){let t=this.m00()*e.x()+this.m01()*e.y()+this.m02(),n=this.m10()*e.x()+this.m11()*e.y()+this.m12();return e.setX(t),e.setY(n),e}transformPoints(e){for(let t=0,n=e.length;t<n;t=t+1){let r=e[t],o=this.m00()*r.x()+this.m01()*r.y()+this.m02(),a=this.m10()*r.x()+this.m11()*r.y()+this.m12();r.setX(o),r.setY(a)}return e}transformDirection(e){let t=this.m00()*e.x()+this.m01()*e.y(),n=this.m10()*e.x()+this.m11()*e.y();return e.setX(t),e.setY(n),e}transformRect(e){if(e.isInvalid())return e.copyFrom(U.INVALID);if(!e.isFinite())return e.copyFrom(U.INFINITE);let t=new Tt;return t.include2(this.transformPoint(e.topLeft())),t.include2(this.transformPoint(e.topRight())),t.include2(this.transformPoint(e.bottomLeft())),t.include2(this.transformPoint(e.bottomRight())),t.buildTo(e),e}setTo(e,t,n,r,o,a){return this._m00=e,this._m01=t,this._m02=n,this._m10=r,this._m11=o,this._m12=a,this}copyFrom(e){return this._m00=e.m00(),this._m01=e.m01(),this._m02=e.m02(),this._m10=e.m10(),this._m11=e.m11(),this._m12=e.m12(),this}postTranslate(e){let t=i.new2();t.translate1(e),this.leftMultiply(t)}postRotate(e){let t=i.new2();t.rotate(e),this.leftMultiply(t)}postScale(e){let t=i.new2();t.scale3(e),this.leftMultiply(t)}toString(){return`AffineTransform(${this.m00()}, ${this.m01()}, ${this.m02()}, ${this.m10()}, ${this.m11()}, ${this.m12()})`}static new2(){return new i(1,0,0,0,1,0)}static new3(e){return new i(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12())}static new4(e){return new i(e.scale(),0,e.offset().x(),0,e.scale(),e.offset().y())}static translated(e,t){let n=i.new2();return n.translate2(e,t),n}},Nt;(s=>{function i(){return oe.new2()}s.FrozenAffineTransform_new1=i;function e(l){return l}s.FrozenAffineTransform_new2=e;function t(l){return oe.new3(l)}s.FrozenAffineTransform_new3=t;function n(l,d,c,p,u,h){return new oe(l,d,c,p,u,h)}s.FrozenAffineTransform_new4=n;function r(l){return oe.new4(l)}s.FrozenAffineTransform_new5=r;function o(l){return oe.new4(l)}s.FrozenAffineTransform_new6=o,s.FrozenAffineTransform_IDENTITY=i()})(Nt||(Nt={}));var ne;(c=>{function i(p){return p!="-1:-1"&&p!=""}c.isValid=i;function e(p,u){let h=t(p),f=t(u),_=At.int_compare(h.sessionID,f.sessionID);return _==0&&(_=At.int_compare(h.localID,f.localID)),_}c.compare=e;function t(p){let u=p.split(":");if(u.length==2){let h={};return h.sessionID=parseInt(u[0]),h.localID=parseInt(u[1]),h}return null}c.toFigGUID=t;function n(){return"-1:-1"}c.invalid=n;function r(p){if(p==null)return null;let u=t(p);return u==null?null:u.sessionID<0||u.localID<0?"-1:-1":p}c.fromString=r;function o(p,u){return p<0||u<0?"-1:-1":`${p}:${u}`}c._new=o;function a(p){return o(p.sessionID,p.localID)}c.fromFigGUID=a;function s(p,u){return p==u}c.equals=s;function l(p,u){if(p.length!=u.length)return!1;for(let h=0,f=p.length;h<f;h=h+1)if(p[h]!=u[h])return!1;return!0}c.isSamePath=l;function d(p){return p=="0:0"}c.isRoot=d})(ne||(ne={}));var dn;(u=>{function i(h,f){return Wn.string_compare(h,f)}u.compare=i;function e(h,f){return h==f}u.equals=e;function t(h){return h}u.toString=t;function n(h){return h.length>0}u.isValid=n;function r(h){let f=h,_=f.length-1,m=_;for(;m>=0;){let A=f.charCodeAt(m);if(A>u.LOWER+1)return f.slice(0,m)+String.fromCharCode(A-1);m=m-1}return f.slice(0,_)+String.fromCharCode(u.LOWER)+String.fromCharCode(u.UPPER)}u.before=r;function o(h){let f=h,_=f.length-1;for(;_>=0;){let m=f.charCodeAt(_);if(m<u.UPPER)return f.slice(0,_)+String.fromCharCode(m+1);_=_-1}return f+String.fromCharCode(u.LOWER+1)}u.after=o;function a(h){if(h==null||h==""||h.charCodeAt(h.length-1)==u.LOWER)return null;for(let f=0,_=h.length;f<_;f=f+1)if(h.charCodeAt(f)<u.LOWER||h.charCodeAt(f)>u.UPPER)return null;return h}u.fromString=a;function s(h,f){let _=h,m=f,A=_.length,y=m.length,S="",g=!1;for(let b=0,T=Math.max(A,y);b<T;b=b+1){let I=b<A?_.charCodeAt(b):u.LOWER,O=b<y&&!g?m.charCodeAt(b):u.UPPER;if(I==O)S+=String.fromCharCode(I);else if(O-I>1){S+=String.fromCharCode(I+O>>1),g=!1;break}else S+=String.fromCharCode(I),g=!0}return g&&(S+=String.fromCharCode(u.LOWER+u.UPPER>>1)),S}u.between=s,u.LOWER=32,u.UPPER=126,u.FIRST_POSITION=String.fromCharCode(u.LOWER+1),u.SECOND_POSITION=String.fromCharCode(u.LOWER+2)})(dn||(dn={}));var qn=class i{toString(){return`${this.id};${dn.toString(this.position)}`}equals(e){return ne.equals(this.id,e.id)&&dn.equals(this.position,e.position)}static fromString(e){let t=e.indexOf(";");if(t==-1)return null;let n=e.slice(0,t);if(n=="-1:-1")return null;let r=ne.fromString(n);return new i(r,dn.fromString(e.slice(t+1)))}constructor(e,t){this.id=e,this.position=t}};function Ke(i){let e=new Error(i);setTimeout(()=>{throw e},0)}function Zs(i){setTimeout(()=>{throw i},0)}function NE(i){let e=new Error(i);setTimeout(()=>{throw e},0)}function Q_(i){NE(i)}var su;(M=>{function i(Q,Y){M._p.setTo(0,0);for(let B=Q.start();$e.Command.isValid(B,Q);B=$e.Command.next(B,Q)){switch($e.Command.kind(B,Q)){case $e.Command.Kind.CLOSE:break;case $e.Command.Kind.MOVE_TO:{M._p3.setTo($e.Command.moveToX(B,Q),$e.Command.moveToY(B,Q)),M._p.copyFrom(M._p3);break}case $e.Command.Kind.LINE_TO:{M._p3.setTo($e.Command.lineToX(B,Q),$e.Command.lineToY(B,Q)),u(Y,M._p,M._p0,M._p3);break}case $e.Command.Kind.QUADRATIC_TO:{let te=M._p0.x(),j=M._p0.y(),ie=$e.Command.quadraticToFirstX(B,Q),de=$e.Command.quadraticToFirstY(B,Q),tt=$e.Command.quadraticToX(B,Q),bt=$e.Command.quadraticToY(B,Q);M._p1.setTo(ie+(te-ie)/3,de+(j-de)/3),M._p2.setTo(ie+(tt-ie)/3,de+(bt-de)/3),M._p3.setTo(tt,bt),u(Y,M._p,M._p0,M._p3),s(Y,M._p0,M._p1,M._p2,M._p3,0,0);break}case $e.Command.Kind.CUBIC_TO:{M._p1.setTo($e.Command.cubicToFirstX(B,Q),$e.Command.cubicToFirstY(B,Q)),M._p2.setTo($e.Command.cubicToSecondX(B,Q),$e.Command.cubicToSecondY(B,Q)),M._p3.setTo($e.Command.cubicToX(B,Q),$e.Command.cubicToY(B,Q)),u(Y,M._p,M._p0,M._p3),s(Y,M._p0,M._p1,M._p2,M._p3,0,0);break}default:break}M._p0.copyFrom(M._p3)}}M.compile=i;function e(Q){return Math.abs(Q)<M._EPSILON?0:Q}M._roundToZero=e;function t(Q,Y){return Q.squaredDistanceTo(Y)<M._EPSILON*M._EPSILON}M._approxEqual=t;function n(Q,Y,B){let te=(B.x()-Y.x())*(Y.y()-Q.y())-(B.y()-Y.y())*(Y.x()-Q.x());return te<0?-1:te>0?1:0}M._orientation=n;function r(Q,Y,B,te){return n(Q,Y,B)!=n(Q,Y,te)&&n(B,te,Q)!=n(B,te,Y)}M._linesIntersect=r;function o(Q,Y,B,te){let j=te.x()-Y.x(),ie=te.y()-Y.y(),de=B.x()-Y.x(),tt=B.y()-Y.y(),bt=Q.x()-Y.x(),ht=Q.y()-Y.y(),Ft=j*j+ie*ie,Gt=j*de+ie*tt,Ut=j*bt+ie*ht,vt=de*de+tt*tt,Vn=de*bt+tt*ht,Vt=Ft*vt-Gt*Gt;if(Vt==0)return!1;let sn=1/Vt,xt=(vt*Ut-Gt*Vn)*sn,mt=(Ft*Vn-Gt*Ut)*sn,_t=1e-4;return xt>=-_t&&mt>=-_t&&xt+mt<=1+_t}M._pointInTriangle=o;function a(Q,Y,B){return Q.x*(Y.y*B.z-Y.z*B.y)+Q.y*(Y.z*B.x-Y.x*B.z)+Q.z*(Y.x*B.y-Y.y*B.x)}M._dotCross=a;function s(Q,Y,B,te,j,ie,de){if(ie==0||de<4){let xt=j.x()-Y.x(),mt=j.y()-Y.y(),_t=(B.x()-Y.x())*mt-(B.y()-Y.y())*xt,Ze=(te.x()-Y.x())*mt-(te.y()-Y.y())*xt,Ct=3*_t-3*Ze,Ht=-4*_t+2*Ze,xe=_t,Dt=Ht*Ht-4*xe*Ct;if(Dt>0){let An=-Ht/(2*Ct),hn=Math.sqrt(Dt)/(2*Ct),Xt=An+hn,Me=An-hn;if(0<Xt&&Xt<1&&0<Me&&Me<1){let st=(Xt+Me)/2;for(let z=0;z<10;z=z+1){let Z=_t-Ze,ae=Ze-2*_t,pe=st*(st*(st*Z+ae)+_t),Te=st*(3*st*Z+2*ae)+_t;st-=pe/Te}let kt=Y.mixedWith(B,st),Ne=B.mixedWith(te,st),We=te.mixedWith(j,st),nt=kt.mixedWith(Ne,st),v=Ne.mixedWith(We,st),R=nt.mixedWith(v,st);s(Q,Y,kt,nt,R,1,de+1),s(Q,R,v,We,j,1,de+1),u(Q,Y,R,j);return}}}M._b0.setTo(Y.x(),Y.y(),1),M._b1.setTo(B.x(),B.y(),1),M._b2.setTo(te.x(),te.y(),1),M._b3.setTo(j.x(),j.y(),1);let tt=a(M._b0,M._b3,M._b2),bt=a(M._b1,M._b0,M._b3),ht=a(M._b2,M._b1,M._b0),Ft=tt-2*bt+3*ht,Gt=-bt+3*ht,Ut=3*ht,vt=1/Math.sqrt(Ft*Ft+Gt*Gt+Ut*Ut);Ft*=vt,Gt*=vt,Ut*=vt;let Vn=3*Gt*Gt-4*Ft*Ut,Vt=Ft*Ft*Vn;switch(Ft=e(Ft),Gt=e(Gt),Ut=e(Ut),Vt=e(Vt),t(M._b0,M._b1)&&t(M._b0,M._b2)&&t(M._b0,M._b3)?0:Vt<0?4:Vt>0?5:Ft==0&&Gt==0?Ut==0?1:2:Ft==0?3:Vn<0?4:5){case 5:{let xt=Math.sqrt(Math.max(0,9*Gt*Gt-12*Ft*Ut)),mt=3*Gt-xt,_t=6*Ft,Ze=3*Gt+xt,Ct=_t,Ht=_t-mt,xe=Ct-Ze;d(Q,Y,mt*Ze,mt*mt*mt,Ze*Ze*Ze,B,(3*mt*Ze-mt*Ct-_t*Ze)/3,mt*mt*(mt-_t),Ze*Ze*(Ze-Ct),te,(_t*(Ct-2*Ze)+mt*(3*Ze-2*Ct))/3,Ht*Ht*mt,xe*xe*Ze,j,Ht*xe,-Ht*Ht*Ht,-xe*xe*xe);break}case 4:{let xt=Math.sqrt(Math.max(0,4*Ft*Ut-3*Gt*Gt)),mt=Gt-xt,_t=2*Ft,Ze=Gt+xt,Ct=_t;if(ie!=2||de<4){let Dt=mt/_t,An=Ze/Ct,hn=M._EPSILON<Dt&&Dt<1-M._EPSILON,Xt=M._EPSILON<An&&An<1-M._EPSILON;if(hn&&Xt){l(Q,Y,B,te,j,Math.min(Dt,An),Math.max(Dt,An),de+1);return}if(hn){l(Q,Y,B,te,j,Dt,-1,de+1);return}if(Xt){l(Q,Y,B,te,j,An,-1,de+1);return}}let Ht=_t-mt,xe=Ct-Ze;d(Q,Y,mt*Ze,mt*mt*Ze,mt*Ze*Ze,B,(-mt*Ct-_t*Ze+3*mt*Ze)/3,-mt*(mt*(Ct-3*Ze)+2*_t*Ze)/3,-Ze*(mt*(2*Ct-3*Ze)+_t*Ze)/3,te,(_t*(Ct-2*Ze)+mt*(3*Ze-2*Ct))/3,(_t-mt)*(mt*(2*Ct-3*Ze)+_t*Ze)/3,(Ct-Ze)*(mt*(Ct-3*Ze)+2*_t*Ze)/3,j,Ht*xe,-Ht*Ht*xe,-Ht*xe*xe);break}case 3:{let xt=Ut,mt=3*Gt,_t=xt-mt;d(Q,Y,xt,xt*xt*xt,1,B,xt-mt/3,xt*xt*_t,1,te,xt-mt*(2/3),_t*_t*xt,1,j,_t,_t*_t*_t,1);break}case 2:{d(Q,Y,0,0,0,B,1/3,0,1/3,te,2/3,1/3,2/3,j,1,1,1);break}}}M._compileCubic=s;function l(Q,Y,B,te,j,ie,de,tt){let bt=Y.mixedWith(B,ie),ht=B.mixedWith(te,ie),Ft=te.mixedWith(j,ie),Gt=bt.mixedWith(ht,ie),Ut=ht.mixedWith(Ft,ie),vt=Gt.mixedWith(Ut,ie);if(u(Q,Y,vt,j),s(Q,Y,bt,Gt,vt,2,tt+1),de==-1){s(Q,vt,Ut,Ft,j,2,tt+1);return}let Vn=vt,Vt=Ut,sn=Ft,xt=j,mt=(de-ie)/(1-ie),_t=Vn.mixedWith(Vt,mt),Ze=Vt.mixedWith(sn,mt),Ct=sn.mixedWith(xt,mt),Ht=_t.mixedWith(Ze,mt),xe=Ze.mixedWith(Ct,mt),Dt=Ht.mixedWith(xe,mt);s(Q,Vn,_t,Ht,Dt,2,tt+1),s(Q,Dt,xe,Ct,xt,2,tt+1)}M._compileSubdividedCubic=l;function d(Q,Y,B,te,j,ie,de,tt,bt,ht,Ft,Gt,Ut,vt,Vn,Vt,sn){M._v0.set(Y,B,te,j),M._v1.set(ie,de,tt,bt),M._v2.set(ht,Ft,Gt,Ut),M._v3.set(vt,Vn,Vt,sn);let xt=(B+Vn)*(.9/2)+(de+Ft)*(.1/2),mt=(te+Vt)*(.9/2)+(tt+Gt)*(.1/2),_t=(j+sn)*(.9/2)+(bt+Ut)*(.1/2),Ze=xt*xt*xt-mt*_t>0,Ct=0,Ht=0;for(let hn=0;hn<4;hn=hn+1){let Xt=At.int_remainder(hn+1,4),Me=At.int_remainder(hn+2,4),st=At.int_remainder(hn+3,4),kt=M._v[Xt].xy,Ne=M._v[Me].xy,We=M._v[st].xy,nt=kt.distanceTo(Ne),v=Ne.distanceTo(We),R=We.distanceTo(kt),z=(nt+v+R)/2,Z=z*(z-nt)*(z-v)*(z-R);Z>Ct&&(Ct=Z,Ht=hn)}let xe=At.int_remainder(Ht+1,4),Dt=At.int_remainder(Ht+2,4),An=At.int_remainder(Ht+3,4);if(o(M._v[Ht].xy,M._v[xe].xy,M._v[Dt].xy,M._v[An].xy)){h(Q,M._v[xe],M._v[Dt],M._v[An],Ze);return}r(Y,ht,ie,vt)?Y.squaredDistanceTo(ht)<ie.squaredDistanceTo(vt)?(h(Q,M._v0,M._v1,M._v2,Ze),h(Q,M._v0,M._v2,M._v3,Ze)):(h(Q,M._v0,M._v1,M._v3,Ze),h(Q,M._v1,M._v2,M._v3,Ze)):r(Y,vt,ie,ht)?Y.squaredDistanceTo(vt)<ie.squaredDistanceTo(ht)?(h(Q,M._v0,M._v1,M._v3,!Ze),h(Q,M._v0,M._v3,M._v2,Ze)):(h(Q,M._v0,M._v1,M._v2,Ze),h(Q,M._v2,M._v1,M._v3,Ze)):Y.squaredDistanceTo(ie)<ht.squaredDistanceTo(vt)?(h(Q,M._v0,M._v2,M._v1,Ze),h(Q,M._v0,M._v1,M._v3,Ze)):(h(Q,M._v0,M._v2,M._v3,Ze),h(Q,M._v3,M._v2,M._v1,Ze))}M._appendQuad=d;function c(Q,Y,B){return Q.equals(Y)||Q.equals(B)||Y.equals(B)}M._isEmptyTriangle=c;function p(Q,Y,B,te,j,ie){Q.appendFloat(Y).appendFloat(B),Q.appendFloat(te).appendFloat(j).appendFloat(ie)}M._appendVertex=p;function u(Q,Y,B,te){c(Y,B,te)||(p(Q,Y.x(),Y.y(),.5,.5,.5),p(Q,B.x(),B.y(),.5,.5,.5),p(Q,te.x(),te.y(),.5,.5,.5))}M._appendTriangle1=u;function h(Q,Y,B,te,j){if(!c(Y.xy,B.xy,te.xy)){let ie=j?-1:1;p(Q,Y.xy.x(),Y.xy.y(),Y.k*ie,Y.l*ie,Y.m),p(Q,B.xy.x(),B.xy.y(),B.k*ie,B.l*ie,B.m),p(Q,te.xy.x(),te.xy.y(),te.k*ie,te.l*ie,te.m)}}M._appendTriangle2=h;class f{setTo(Y,B,te){this.x=Y,this.y=B,this.z=te}squaredDistanceTo(Y){let B=this.x-Y.x,te=this.y-Y.y,j=this.z-Y.z;return B*B+te*te+j*j}constructor(){this.x=0,this.y=0,this.z=0}}M.Vector3=f;class _{set(Y,B,te,j){this.xy=Y,this.k=B,this.l=te,this.m=j}constructor(){this.xy=null,this.k=0,this.l=0,this.m=0}}M.Vector5=_;let m;(te=>(te[te.INITIAL=0]="INITIAL",te[te.SUBDIVIDED_BECAUSE_OF_CROSSING=1]="SUBDIVIDED_BECAUSE_OF_CROSSING",te[te.SUBDIVIDED_BECAUSE_OF_LOOP=2]="SUBDIVIDED_BECAUSE_OF_LOOP"))(m=M.CompileState||(M.CompileState={}));let A;(de=>(de[de.POINT=0]="POINT",de[de.LINE=1]="LINE",de[de.QUADRATIC=2]="QUADRATIC",de[de.CUSP=3]="CUSP",de[de.LOOP=4]="LOOP",de[de.SERPENTINE=5]="SERPENTINE"))(A=M.SegmentClass||(M.SegmentClass={}));let y;(Y=>{function Q(B){return m[B]}Y.CompileState_toString=Q})(y=M.in_CompileState||(M.in_CompileState={}));let S;(Y=>{function Q(B){return A[B]}Y.SegmentClass_toString=Q})(S=M.in_SegmentClass||(M.in_SegmentClass={})),M._EPSILON=5e-4,M._p=E.new2(),M._p0=E.new2(),M._p1=E.new2(),M._p2=E.new2(),M._p3=E.new2(),M._b0=new f,M._b1=new f,M._b2=new f,M._b3=new f,M._v0=new _,M._v1=new _,M._v2=new _,M._v3=new _,M._v=[M._v0,M._v1,M._v2,M._v3]})(su||(su={}));var br=class i{constructor(){if(arguments.length==0)this._bytes=null,this._view=null,this._count=0,this._capacity=0,this._capacity=256,this._bytes=new Uint8Array(this._capacity),this._view=new DataView(this._bytes.buffer);else if(arguments.length==1){let e=arguments[0];this._bytes=null,this._view=null,this._count=0,this._capacity=0,this._bytes=e,this._count=this._capacity=e.length,this._view=new DataView(e.buffer,e.byteOffset,e.length)}}clear(){this._count=0}clone(){return new i(new Uint8Array(this.bytes()))}isEmpty(){return this._count==0}byteCount(){return this._count}bytes(){return this._bytes.subarray(0,this._count)}floatAt(e){return this._view.getFloat32(e,!0)}byteAt(e){return this._bytes[e]}appendFloat(e){return this._count+4>this._capacity&&this._grow(this._count+4),this._view.setFloat32(this._count,e,!0),this._count=this._count+4,this}appendByte(e){return this._count+1>this._capacity&&this._grow(this._count+1),this._bytes[this._count]=e,this._count=this._count+1,this}prependBytes(e){let t=e.byteCount();return this._count+t>this._capacity&&this._grow(this._count+t),this._bytes.set(this.bytes(),t),this._bytes.set(e.bytes()),this._count=this._count+t,this}appendBytes(e){let t=e.byteCount();return this._count+t>this._capacity&&this._grow(this._count+t),this._bytes.set(e.bytes(),this._count),this._count=this._count+t,this}setFloatAt(e,t){this._view.setFloat32(e,t,!0)}_grow(e){this._capacity=e*2;let t=new Uint8Array(this._capacity);this._bytes!=null&&t.set(this._bytes),this._bytes=t,this._view=new DataView(t.buffer)}},lu;(e=>{function i(t,n){if(t==null||n==null||t.byteCount()!=n.byteCount())return!1;for(let r=0,o=t.byteCount();r<o;r=r+1)if(t.byteAt(r)!=n.byteAt(r))return!1;return!0}e.FrozenDataArray_equals=i})(lu||(lu={}));var co=class i{constructor(){this._float=null,this._int=null,this._value=0,this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer)}reset(){this._value=0}value(){return this._value}hash1(e){this._float[0]=e,this._value=i.combine(this._value,this._int[0])}hash2(e){this._value=i.combine(this._value,e)}static combine(e,t){return t+-1640531527+(e<<6)+(e>>2)}};var cu=class{constructor(e,t){this.key=e,this.value=t}},wi=class{each(e){qt.IntMap_each(this._buckets,(t,n)=>{for(let r of n)e(r.key,r.value)})}getOrInsertFallback(e){let t=this._hash(e),n=qt.IntMap_get(this._buckets,t,null);if(n!=null){for(let o of n)if(this._equals(e,o.key))return o.value}else n=[],this._buckets.set(t,n);let r=this._fallback(e);return n.push(new cu(e,r)),r}get(e,t){let n=this._hash(e),r=qt.IntMap_get(this._buckets,n,null);if(r!=null){for(let o of r)if(this._equals(e,o.key))return o.value}return t}set(e,t){let n=this._hash(e),r=qt.IntMap_get(this._buckets,n,null);r==null&&(r=[],this._buckets.set(n,r));for(let o of r)if(this._equals(e,o.key)){o.value=t;return}r.push(new cu(e,t))}remove(e){let t=this._hash(e),n=qt.IntMap_get(this._buckets,t,null);if(n!=null){for(let r=0,o=n.length;r<o;r=r+1)if(this._equals(e,n[r].key)){n.splice(r,1),n.length==0&&this._buckets.delete(t);break}}}constructor(e,t,n){this._buckets=new Map,this._hash=e,this._equals=t,this._fallback=n}};var Fr=class Fr{constructor(e,t){this._rect=null,this._radii=null,this._hash=0,this._cachedBezier=null,this._rect=e,this._radii=t.clippedForRectOfBounds(e),Fr.hasher.reset(),Fr.hasher.hash1(this._rect.x()),Fr.hasher.hash1(this._rect.y()),Fr.hasher.hash1(this._rect.width()),Fr.hasher.hash1(this._rect.height()),Fr.hasher.hash1(this._radii.topLeft),Fr.hasher.hash1(this._radii.topRight),Fr.hasher.hash1(this._radii.bottomRight),Fr.hasher.hash1(this._radii.bottomLeft),this._hash=Fr.hasher.value()}radii(){return this._radii}bounds(){return this._rect}equals2(e){return e instanceof Fr?this.equals1(e):!1}equals1(e){return this._rect.equals(e._rect)&&this._radii.equals(e._radii)}clone(){return new Fr(this._rect.clone(),this._radii)}hash(){return this._hash}isRect(){return this._radii.isZeros()}canBeAnalyticallyAntialiased(){return N.supportsWebGLExtensionOESStandardDerivatives()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=Rt.fromRoundedRect3(this._rect.x(),this._rect.y(),this._rect.width(),this._rect.height(),this._radii.toList())),this._cachedBezier}asRoundedRectPath(){return this}static fromRect(e){return new Fr(e,uo.fromNodeRadius(0))}static fromRoundedRect(e){let t=e.vertexRadii()!=null?uo.fromList(e.vertexRadii()):e.nodeRadius()!=0?uo.fromNodeRadius(e.nodeRadius()):uo.ZEROS;return new Fr(e.rect(),t)}static isRoundedRectSupported(e){if(e.cornerSmoothing()!=0)return!1;let t=e.vertexRadii();if(t!=null){let n=Math.max(Math.max(t[0],t[1]),Math.max(t[2],t[3])),r=Math.min(e.width()/2,e.height()/2);if(n>r)return!1}return!0}};Fr.hasher=new co;var Pt=Fr,ea=class ea{constructor(e,t,n,r){this.topLeft=0,this.topRight=0,this.bottomRight=0,this.bottomLeft=0,this.topLeft=Math.max(e,0),this.topRight=Math.max(t,0),this.bottomRight=Math.max(n,0),this.bottomLeft=Math.max(r,0)}isZeros(){return this.topLeft==0&&this.topRight==0&&this.bottomRight==0&&this.bottomLeft==0}isUniform(){return this.topRight==this.topLeft&&this.bottomRight==this.topLeft&&this.bottomLeft==this.topLeft}equals(e){return this.topLeft==e.topLeft&&this.topRight==e.topRight&&this.bottomRight==e.bottomRight&&this.bottomLeft==e.bottomLeft}clippedForRectOfBounds(e){let t=Math.min(e.width()/2,e.height()/2);return new ea(Math.min(this.topLeft,t),Math.min(this.topRight,t),Math.min(this.bottomRight,t),Math.min(this.bottomLeft,t))}toList(){return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft]}static fromList(e){return new ea(e[0],e[1],e[2],e[3])}static fromNodeRadius(e){return new ea(e,e,e,e)}static fromRoundedRect(e){return e.vertexRadii()!=null?ea.fromList(e.vertexRadii()):ea.fromNodeRadius(e.nodeRadius())}};ea.ZEROS=new ea(0,0,0,0);var uo=ea;var C;(Y=>{function i(B){return B&255}Y.red=i;function e(B){return B>>8&255}Y.green=e;function t(B){return B>>16&255}Y.blue=t;function n(B){return B>>>24}Y.alpha=n;function r(B){return i(B)/255}Y.redF=r;function o(B){return e(B)/255}Y.greenF=o;function a(B){return t(B)/255}Y.blueF=a;function s(B){return n(B)/255}Y.alphaF=s;function l(B,te){return g(i(B),e(B),t(B),te)}Y.withAlpha=l;function d(B){let te=s(B);return b(r(B)*te,o(B)*te,a(B)*te,te)}Y.premultiplied=d;function c(B){let te=s(B);return b(r(B)/te,o(B)/te,a(B)/te,te)}Y.unpremultiplied=c;function p(B,te){return B&16777215|I(s(B)*te)<<24}Y.multiplyOpacity=p;function u(B){let te=1-s(B)+s(B)*r(B),j=1-s(B)+s(B)*o(B),ie=1-s(B)+s(B)*a(B);return b(te,j,ie,1)}Y.rgbaToRgb=u;function h(B){return`Color(${i(B)}, ${e(B)}, ${t(B)}, ${n(B)})`}Y.toString=h;function f(B){return n(B)==255}Y.isOpaque=f;function _(B){return"#"+H(i(B))+H(e(B))+H(t(B))}Y.toCSS=_;function m(B){return{red:r(B),green:o(B),blue:a(B),alpha:s(B)}}Y.toColorF=m;function A(B){return{r:i(B),g:e(B),b:t(B),a:n(B)}}Y.asInttoJSON=A;function y(B){return{r:r(B),g:o(B),b:a(B),a:s(B)}}Y.asFloattoJSON=y;function S(B,te,j){return g(B,te,j,255)}Y.new1=S;function g(B,te,j,ie){return B|te<<8|j<<16|ie<<24}Y.new2=g;function b(B,te,j,ie){return g(I(B),I(te),I(j),I(ie))}Y.new3=b;function T(B){return b(B.red,B.green,B.blue,B.alpha)}Y.fromColorF=T;function I(B){return B<0?0:B>=1?255:Math.round(B*255)|0}Y._clamp=I;function O(B,te,j){return b(r(B)+(r(te)-r(B))*j,o(B)+(o(te)-o(B))*j,a(B)+(a(te)-a(B))*j,s(B)+(s(te)-s(B))*j)}Y.mix=O;function w(B,te){let j=s(B),ie=s(te),de=j*(1-ie),tt=de+ie,bt=de/tt,ht=ie/tt;return b(r(B)*bt+r(te)*ht,o(B)*bt+o(te)*ht,a(B)*bt+a(te)*ht,tt)}Y.blend=w;function P(B,te){return b(r(B)*(1-s(te))+r(te),o(B)*(1-s(te))+o(te),a(B)*(1-s(te))+a(te),s(B)*(1-s(te))+s(te))}Y.over=P;function H(B){let te=B.toString(16);return(te.length==1?"0"+te:te).toUpperCase()}Y.asCSSComponent=H,Y.TRANSPARENT=g(0,0,0,0),Y.BLACK=S(0,0,0),Y.WHITE=S(255,255,255),Y.RED=S(255,0,0),Y.GREEN=S(0,255,0),Y.BLUE=S(0,0,255),Y.YELLOW=S(255,255,0),Y.CYAN=S(0,255,255),Y.MAGENTA=S(255,0,255)})(C||(C={}));var K_;(t=>{function i(){return[]}t.new1=i;function e(n){return n.slice()}t.new2=e})(K_||(K_={}));var rn;(S=>{function i(g){return g.length}S.FrozenList_count=i;function e(g){return g.length==0}S.FrozenList_isEmpty=e;function t(g,b){return g[b]}S.FrozenList_get=t;function n(g){return ce.List_last(g)}S.FrozenList_last=n;function r(g,b){return g.some(b)}S.FrozenList_any=r;function o(g,b){return g.filter(b)}S.FrozenList_filter=o;function a(g,b){g.forEach(b)}S.FrozenList_each=a;function s(g){return g[0]}S.FrozenList_first=s;function l(g,b){return g.map(b)}S.FrozenList_map=l;function d(g){return g.slice()}S.FrozenList_clone=d;function c(g,b,T){return g.slice(b,T)}S.FrozenList_slice=c;function p(g,b){let T=g.slice();return ce.List_appendOne(T,b),T}S.FrozenList_cloneAndAppendOne=p;function u(g,b){let T=g.slice();return ce.List_removeOne(T,b),T}S.FrozenList_cloneAndRemoveOne=u;function h(g,b,T){return ce.List_equalsWithComparison(g,b,T)}S.FrozenList_equals=h;function f(g,b,T){return ce.List_reduce(g,b,T)}S.FrozenList_reduce=f;function _(g,b){return g.indexOf(b)!=-1}S._in=_;function m(g,b){for(let T of g)if(b(T))return!0;return!1}S.FrozenList_contains=m;function A(g,b){let T=g.slice();return T.sort(b),T}S.FrozenList_sorted=A;function y(g,b){let T=g.slice();return T.push(b),T}S.FrozenList_cloneAndAppend=y})(rn||(rn={}));var q_="precision highp float;uniform mat3 u;attribute vec4 ha,jb;varying vec2 e;varying vec4 N;void main(){e=ha.zw,N=jb,gl_Position=vec4(u*vec3(ha.xy,1),0).xywz;}",Y_="precision highp float;varying vec2 e;varying vec4 N;void main(){gl_FragColor=N*min(1.,min(e.x,e.y));}",X_="precision highp float;uniform mat3 u;attribute vec4 ha;varying vec4 W;void main(){vec2 a=(u*vec3(ha.xy,1)).xy;W=vec4(a.xy,ha.zw),gl_Position=vec4(a,0,1);}",j_="precision highp float;uniform float bb;uniform vec2 Qa;uniform vec4 kb;varying vec4 W;const vec3 cb=vec3(.188235,.760784,1);bool lb(vec4 a,vec2 b){return a.z>=0.&&a.w>=0.&&clamp(b.x,a.x,a.x+a.z)==b.x&&clamp(b.y,a.y,a.y+a.w)==b.y;}void main(){vec2 b=W.xy,a=W.zw;gl_FragColor=lb(kb,b)?a.x<Qa.x||a.x>1.-Qa.x||a.y<Qa.y||a.y>1.-Qa.y?vec4(cb,1.*bb):vec4(cb,.5*bb):vec4(0);}",Z_="precision highp float;uniform mat3 u;attribute vec4 ha;varying vec4 W;void main(){vec2 a=(u*vec3(ha.xy,1)).xy;W=vec4(a.xy,ha.zw),gl_Position=vec4(a,0,1);}",$_="precision highp float;uniform sampler2D f;varying vec4 W;void main(){vec2 a=W.zw;a.y=1.-a.y,gl_FragColor=texture2D(f,a);}",J_="precision highp float;uniform vec4 s,Ma;attribute vec2 n;varying vec2 e;void main(){e=mix(Ma.xy,Ma.zw,n),gl_Position=vec4(mix(s.xy,s.zw,n)*2.-1.,0,1);}",eA="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform sampler2D f;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}void main(){gl_FragColor=O(texture2D(f,e));}",nm="precision highp float;uniform vec4 s,Ma;attribute vec2 n;varying vec2 e;void main(){e=mix(Ma.xy,Ma.zw,n),gl_Position=vec4(mix(s.xy,s.zw,n)*2.-1.,0,1);}",tA="precision highp float;uniform sampler2D f;varying vec2 e;void main(){gl_FragColor=texture2D(f,e);}",nA="precision highp float;uniform sampler2D f;uniform float db,ia;uniform vec4 I;varying vec2 e;void main(){vec2 b=e*vec2(db),c=floor(b-vec2(.5))+.5,a=c*ia,i=a+vec2(ia,0),m=a+vec2(0,ia),t=a+vec2(ia,ia);float D=texture2D(f,a).a,E=texture2D(f,i).a,J=texture2D(f,m).a,P=texture2D(f,t).a,X=float(D>0.),Y=float(E>0.),ua=float(J>0.),va=float(P>0.),d=b.x-c.x,g=1.-d,h=b.y-c.y,Ka=1.-h,Ya=(X*g+Y*d)*Ka+(ua*g+va*d)*h;gl_FragColor=Ya*I;}";var rA="precision highp float;uniform mat3 mb;uniform vec4 eb,fb;attribute vec2 n;varying vec2 e;void main(){e=mix(eb.xy,eb.zw,n),gl_Position=vec4((mb*vec3(mix(fb.xy,fb.zw,n),1)).xy,0,1);}",oA="precision highp float;uniform sampler2D f;uniform float q;uniform vec4 Ra;varying vec2 e;void main(){vec2 a=clamp(e,Ra.xy,Ra.zw);gl_FragColor=texture2D(f,a)*q;}",ac="precision highp float;attribute vec2 n;varying vec2 e;void main(){e=n,gl_Position=vec4(n*2.-1.,0,1);}",rm="precision highp float;uniform sampler2D f;uniform float q;varying vec2 e;void main(){gl_FragColor=texture2D(f,e)*q;}",iA="precision highp float;uniform sampler2D f;uniform float q;varying vec2 e;void main(){vec4 a=.25*(texture2D(f,e+vec2(-4.882813e-4,-4.882813e-4))+texture2D(f,e+vec2(4.882813e-4,-4.882813e-4))+texture2D(f,e+vec2(4.882813e-4,4.882813e-4))+texture2D(f,e+vec2(-4.882813e-4,4.882813e-4)));gl_FragColor=a*q;}",aA="precision highp float;uniform mat3 u;attribute vec2 n;attribute vec3 nb;varying vec3 wa;void main(){wa=nb,gl_Position=vec4(u*vec3(n,1),0).xywz;}",sA="precision highp float;varying vec3 wa;void main(){if(wa.x*wa.x*wa.x>wa.y*wa.z)discard;}",$r="precision highp float;uniform vec4 s;attribute vec2 n;varying vec2 e;void main(){e=mix(s.xy,s.zw,n),gl_Position=vec4(e*2.-1.,0,1);}",lA="precision highp float;uniform sampler2D f;uniform float v;uniform vec2 F;uniform vec4 y;varying vec2 e;void main(){vec2 a=clamp(e,y.xy,y.zw);float t=v;vec4 ua=texture2D(f,a)*t;float va=t;for(int m=1;m<32;m+=2){if(float(m)>v)break;float b=float(m),c=min(b+1.,v);vec2 d=a-F*b,g=a+F*b,h=a-F*c,i=a+F*c;float D=(v-b)*float(d==clamp(d,y.xy,y.zw)),E=(v-b)*float(g==clamp(g,y.xy,y.zw)),J=(v-c)*float(h==clamp(h,y.xy,y.zw)),P=(v-c)*float(i==clamp(i,y.xy,y.zw)),X=D+J,Y=E+P;vec2 Ka=(d*D+h*J)/X,Ya=(g*E+i*P)/Y;ua+=texture2D(f,Ka)*X+texture2D(f,Ya)*Y,va+=X+Y;}gl_FragColor=ua/va;}",cA="precision highp float;uniform sampler2D f;uniform float v;uniform vec2 F;varying vec2 e;void main(){float i=v;vec4 m=texture2D(f,e)*i;float t=i;for(int h=1;h<32;h+=2){if(float(h)>v)break;float a=float(h),b=min(a+1.,v);vec2 D=e-F*a,E=e+F*a,J=e-F*b,P=e+F*b;float c=v-a,d=v-b,g=c+d;vec2 X=(D*c+J*d)/g,Y=(E*c+P*d)/g;m+=g*(texture2D(f,X)+texture2D(f,Y)),t+=2.*g;}gl_FragColor=m/t;}",dA="precision highp float;uniform sampler2D f,k;uniform float q;uniform vec4 Sa,Ta;varying vec2 e;void main(){vec4 a=all(greaterThan(e,Sa.xy))&&all(lessThan(e,Sa.zw))?texture2D(f,e):vec4(0),b=all(greaterThan(e,Ta.xy))&&all(lessThan(e,Ta.zw))?texture2D(k,e):vec4(0);gl_FragColor=mix(a,b,q);}",uA="precision highp float;uniform mat3 u;uniform float Z;uniform vec4 s;attribute vec2 n;varying vec4 N;void main(){vec2 a=mix(s.xy-Z,s.zw+Z,n);N=(vec4(a,a)-s)/Z,gl_Position=vec4(u*vec3(a,1),0).xywz;}",pA="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform vec4 I;varying vec4 N;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}float K(float a){return a<-1.?0.:a<0.?.5*(a+1.)*(a+1.):a<1.?.5-.5*a*(a-2.):1.;}void main(){float a=(K(N.x)-K(N.z))*(K(N.y)-K(N.w));gl_FragColor=O(I*a);}",hA="precision highp float;uniform mat3 u;uniform float Z;uniform vec4 s;attribute vec2 n;varying vec2 e;void main(){vec2 b=(s.xy+s.zw)*.5,a=mix(s.xy-Z,s.zw+Z,n);e=(a-b)/Z,gl_Position=vec4(u*vec3(a,1),0).xywz;}",mA="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform float gb;uniform vec2 La;uniform vec4 I;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}float K(float a){return a<-1.?0.:a<0.?.5*(a+1.)*(a+1.):a<1.?.5-.5*a*(a-2.):1.;}float hb(float a){return max(0.,1.-abs(a));}float ob(float b,float h,float a,vec2 c){float d=min(c.y-a-abs(h),0.),g=c.x-a+sqrt(max(0.,a*a-d*d));vec2 i=vec2(b+g,b-g);return K(i.x)-K(i.y);}void main(){float c;if(all(lessThan(abs(e),La-vec2(gb+1.))))c=1.;else{float d=e.y-La.y,g=e.y+La.y,a=clamp(-1.,d,g),b=clamp(1.,d,g);if(a==b)c=0.;else{float i=(b-a)/4.,h=a+i*.5,m=0.,t=0.;for(int D=0;D<4;D++){float E=hb(h);t+=ob(e.x,e.y-h,gb,La)*E,m+=E,h+=i;}float J=(K(b)-K(a))/m;c=t*J;}}gl_FragColor=O(I*c);}",gA="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){gl_FragColor=texture2D(f,e)*texture2D(k,e).a;}",fA="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){vec3 a=texture2D(k,e).rgb,b=vec3(.299,.587,.114);float c=dot(a*a,b),d=sqrt(c);gl_FragColor=texture2D(f,e)*d*texture2D(k,e).a;}",_A="precision highp float;uniform sampler2D f,k,sa;varying vec2 e;void main(){vec3 a=texture2D(sa,e).rgb,b=vec3(.299,.587,.114);float c=dot(a*a,b),d=sqrt(c);gl_FragColor=mix(texture2D(k,e),texture2D(f,e),texture2D(sa,e).a*d);}",AA="precision highp float;uniform sampler2D f,k,sa;varying vec2 e;void main(){gl_FragColor=mix(texture2D(k,e),texture2D(f,e),texture2D(sa,e).a);}",SA="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){gl_FragColor=texture2D(f,e)*float(texture2D(k,e).a==0.);}",yA="precision highp float;uniform sampler2D f,k,sa;varying vec2 e;void main(){float a=texture2D(sa,e).a;gl_FragColor=mix(texture2D(k,e),texture2D(f,e)*float(a==0.),1.-a);}",bA="precision highp float;uniform sampler2D f;uniform vec4 I;varying vec2 e;void main(){gl_FragColor=float(texture2D(f,e).a>0.)*I;}",TA="precision highp float;uniform sampler2D f,k;uniform vec4 I;varying vec2 e;void main(){gl_FragColor=(1.-texture2D(f,e).a)*texture2D(k,e).a*I;}",IA="precision highp float;uniform sampler2D f,k;uniform vec4 I;varying vec2 e;void main(){float a=float(texture2D(k,e).a>0.);gl_FragColor=(1.-texture2D(f,e).a)*a*I;}",vA="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){if(texture2D(k,e).a==0.)discard;gl_FragColor=texture2D(f,e);}",EA="precision highp float;uniform mat3 u;attribute vec2 n;varying vec2 e;void main(){e=n,gl_Position=vec4(u*vec3(n,1),0).xywz;}",du="precision highp float;uniform float q;uniform vec4 I;void main(){gl_FragColor=I*q;}",sc="precision highp float;uniform mat3 u,_;attribute vec2 n;varying vec2 e;void main(){e=(_*vec3(n,1)).xy,gl_Position=vec4(u*vec3(n,1),0).xywz;}",om="precision highp float;uniform mat3 u,_,Ua;attribute vec2 n;varying vec2 e,xa;void main(){e=(_*vec3(n,1)).xy,xa=(Ua*vec3(n,1)).xy,gl_Position=vec4(u*vec3(n,1),0).xywz;}",CA="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f;uniform float q;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}void main(){vec2 a=aa(e);gl_FragColor=O(texture2D(f,a)*q);}",wA="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f,k;uniform float q,G;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}void main(){vec2 a=aa(e);vec4 b=mix(texture2D(f,a),texture2D(k,a),G);gl_FragColor=O(b*q);}",NA="precision highp float;uniform sampler2D f;uniform bool L,M;uniform float q;varying vec2 e;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=j(f,e);a.rgb*=a.a,gl_FragColor=a*q;}",RA="precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float q,G;varying vec2 e,xa;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=mix(j(f,e),j(k,xa),G);a.rgb*=a.a,gl_FragColor=a*q;}",OA="precision highp float;uniform sampler2D f;uniform bool L,M;uniform float q,ya,za,ba,ca,Aa,Ba,Ca;varying vec2 e;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=j(f,e);a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*q;}",FA="precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float q,G,ya,za,ba,ca,Aa,Ba,Ca;varying vec2 e,xa;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=mix(j(f,e),j(k,xa),G);a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*q;}",xA="precision highp float;uniform int l;uniform sampler2D f,k;uniform float q;varying vec2 e;float Na(vec3 a){return min(min(a.r,a.g),a.b);}float Za(vec3 a){return max(max(a.r,a.g),a.b);}float Va(vec3 a){return Za(a)-Na(a);}float Wa(vec3 a){return dot(a,vec3(.3,.59,.11));}vec3 _a(vec3 c,vec3 d){float b=Wa(d);vec3 a=c+(b-Wa(c));float g=Na(a),h=Za(a);a=g<0.?mix(vec3(b),a,b/(b-g)):h>1.?mix(vec3(b),a,(1.-b)/(h-b)):a;return a;}vec3 ib(vec3 a,vec3 b,vec3 g){float c=Va(a);vec3 d=vec3(0);if(c>0.){float h=Na(a),i=Va(b);d=(a-h)*i/c;}return _a(d,g);}void main(){vec4 m=texture2D(f,e)*q,t=texture2D(k,e);float c=m.a,a=t.a;vec3 b=t.rgb;if(c==0.)gl_FragColor=vec4(b,a);else{vec3 d=m.rgb,h=d*(1.-a)+b*(1.-c);if(l==2)h+=min(d*a,b*c);else if(l==3)h+=d*b;else if(l==4)h=max(vec3(0),d+b-c*a);else if(l==5){vec3 X=max(d*a,.003922),Y=(a-b)*c*step(.003922,a-b);h+=c*a*(1.-min(vec3(1),Y/X));}else if(l==6)h+=max(d*a,b*c);else if(l==7)h=d+b-d*b;else if(l==8)h=min(vec3(1),d+b);else if(l==9){vec3 ua=max(a*(c-d),.003922),va=b*c*step(.003922,b);h+=c*a*min(vec3(1),va/ua);}else if(l==10)h+=mix(c*a-2.*(a-b)*(c-d),2.*d*b,vec3(lessThanEqual(2.*b,vec3(a))));else if(l==12)h+=mix(2.*d*b,c*a-2.*(a-b)*(c-d),vec3(greaterThan(2.*d,vec3(c))));else if(l==13)h+=abs(b*c-d*a);else if(l==14)h+=d*a+b*c-2.*d*b;else{vec3 D=vec3(0),i=d,g=b;if(c>0.)i/=c;if(a>0.)g/=a;if(l==11){vec3 Ka=1.-g,J=(16.*g-12.)*g+3.,P=inversesqrt(g+1e-6)-1.,E=mix(J,P,vec3(greaterThan(g,vec3(.25))));E=mix(E,Ka,vec3(greaterThan(i,vec3(.5)))),D=g*(1.+E*(2.*i-1.));}else D=l==15?ib(i,g,g):l==16?ib(g,i,g):l==17?_a(i,g):l==18?_a(g,i):D;h+=c*a*D;}gl_FragColor=vec4(h,c+a-c*a);}}",PA="precision highp float;uniform mat3 u;attribute vec2 n;uniform vec2 Oa,fa;varying vec2 w;vec2 ta(in vec2 a){return (a-vec2(.5,.5))*Oa+vec2(.5,.5);}void main(){vec2 a=ta(n);w=a*fa,gl_Position=vec4(u*vec3(n,1),0).xywz;}",lc="precision highp float;uniform mat3 u,_;uniform float Ja;attribute vec2 n;uniform vec2 Oa,fa;varying vec2 w,ja,o,p;const vec2 Xa=vec2(.0625,.0625);void ab(vec2 a){vec2 b=1./fa/Ja;o=(_*vec3(a,1)).xy,p=(_*vec3(a+Xa*b,1)).xy-o;}vec2 ta(in vec2 a){return (a-vec2(.5,.5))*Oa+vec2(.5,.5);}void main(){vec2 a=ta(n);w=a*fa,ja=(_*vec3(a,1)).xy,ab(a),gl_Position=vec4(u*vec3(n,1),0).xywz;}",im="precision highp float;uniform mat3 u,_,Ua;uniform float Ja;attribute vec2 n;uniform vec2 Oa,fa;varying vec2 w,ja,o,z,p,C;const vec2 Xa=vec2(.0625,.0625);void ab(vec2 a){vec2 b=1./fa/Ja;o=(_*vec3(a,1)).xy,p=(_*vec3(a+Xa*b,1)).xy-o;}void pb(vec2 a){vec2 b=1./fa/Ja;z=(Ua*vec3(a,1)).xy,C=(Ua*vec3(a+Xa*b,1)).xy-z;}vec2 ta(in vec2 a){return (a-vec2(.5,.5))*Oa+vec2(.5,.5);}void main(){vec2 a=ta(n);w=a*fa,ja=(_*vec3(a,1)).xy,ab(a),pb(a),gl_Position=vec4(u*vec3(n,1),0).xywz;}",DA=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform float q;uniform int A;uniform vec2 Q,R;uniform vec4 I,S,T;varying vec2 w;float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){float a=H(w);gl_FragColor=I*q*a;}`,MA=`#extension GL_OES_standard_derivatives:enable
precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f;uniform float q;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,ja;float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){float a=H(w);vec2 b=aa(ja);gl_FragColor=O(texture2D(f,b)*q)*a;}`,LA=`#extension GL_OES_standard_derivatives:enable
precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f,k;uniform float q,G;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,ja;float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){float b=H(w);vec2 a=aa(ja);vec4 c=mix(texture2D(f,a),texture2D(k,a),G);gl_FragColor=O(c*q)*b;}`,BA=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f;uniform bool L,M;uniform float q;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,p;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*p)+j(f,o+la*p)+j(f,o+ma*p)+j(f,o+na*p)+j(f,o+oa*p)+j(f,o+pa*p)+j(f,o+qa*p)+j(f,o+ra*p))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 a=ga();a.rgb*=a.a,gl_FragColor=a*q*H(w);}`,VA=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float q,G;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,z,p,C;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*p)+j(f,o+la*p)+j(f,o+ma*p)+j(f,o+na*p)+j(f,o+oa*p)+j(f,o+pa*p)+j(f,o+qa*p)+j(f,o+ra*p))/8.;}vec4 Pa(){return (j(k,z+ka*C)+j(k,z+la*C)+j(k,z+ma*C)+j(k,z+na*C)+j(k,z+oa*C)+j(k,z+pa*C)+j(k,z+qa*C)+j(k,z+ra*C))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 b=ga(),c=Pa(),a=mix(b,c,G);a.rgb*=a.a,gl_FragColor=a*q*H(w);}`,kA=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f;uniform bool L,M;uniform float q,ya,za,ba,ca,Aa,Ba,Ca;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,p;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*p)+j(f,o+la*p)+j(f,o+ma*p)+j(f,o+na*p)+j(f,o+oa*p)+j(f,o+pa*p)+j(f,o+qa*p)+j(f,o+ra*p))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 a=ga();a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*q*H(w);}`,UA=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float q,G,ya,za,ba,ca,Aa,Ba,Ca;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,z,p,C;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*p)+j(f,o+la*p)+j(f,o+ma*p)+j(f,o+na*p)+j(f,o+oa*p)+j(f,o+pa*p)+j(f,o+qa*p)+j(f,o+ra*p))/8.;}vec4 Pa(){return (j(k,z+ka*C)+j(k,z+la*C)+j(k,z+ma*C)+j(k,z+na*C)+j(k,z+oa*C)+j(k,z+pa*C)+j(k,z+qa*C)+j(k,z+ra*C))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 b=ga(),c=Pa(),a=mix(b,c,G);a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*q*H(w);}`,Yt="f",Tr="k",$s="l",am="n",Pn="q",Ir="s",Tn="u",GA="v",HA="y",sm="A",zA="F",is="G",Ko="I",WA="L",QA="M",KA="Q",qA="R",YA="S",XA="T",lm="Z",di="_",cm="ba",dm="ca",jA="fa",uu="ha",ZA="ia",pu="sa",um="ya",pm="za",hm="Aa",mm="Ba",gm="Ca",fm="Ja",$A="La",hu="Ma",JA="Oa",eS="Qa",tS="Ra",nS="Sa",rS="Ta",mu="Ua",oS="bb",iS="db",aS="eb",sS="fb",lS="gb",_m="jb",cS="kb",dS="mb",uS="nb";var Jr=class i{recomposed(){let e=oe.new2();e.setM00(this.m00),e.setM01(this.m01),e.setM10(this.m10),e.setM11(this.m11),e.setM02(this.translation.x()),e.setM12(this.translation.y());let t=Math.PI/180*this.angleDegrees,n=Math.cos(t),r=Math.sin(t),o=oe.new2();return o.setM00(n),o.setM01(-r),o.setM10(r),o.setM11(n),e.multiply(o),e.setM00(e.m00()*this.scale.x()),e.setM01(e.m01()*this.scale.y()),e.setM10(e.m10()*this.scale.x()),e.setM11(e.m11()*this.scale.y()),e}static from(e){let t=new i,n=e.m00(),r=e.m10(),o=e.m01(),a=e.m11();t.translation=E.new3(e.translation()),t.scale=E.new3(e.scale1()),n*a-r*o<0&&(n<a?t.scale.setX(-t.scale.x()):t.scale.setY(-t.scale.y())),t.scale.x()!=0&&(n*=1/t.scale.x(),r*=1/t.scale.x()),t.scale.y()!=0&&(o*=1/t.scale.y(),a*=1/t.scale.y());let l=Math.atan2(r,n);if(l!=0){let d=-r,c=n,p=n,u=r,h=o,f=a;n=c*p+d*h,r=c*u+d*f,o=-d*p+c*h,a=-d*u+c*f}return t.angleDegrees=180/Math.PI*l,t.m00=n,t.m10=r,t.m01=o,t.m11=a,t}static lerp1(e,t,n){let r=i.from(e),o=i.from(t);return i.lerp2(r,o,n).recomposed()}static lerp2(e,t,n){(e.scale.x()<0&&t.scale.y()<0||e.scale.y()<0&&t.scale.x()<0)&&(e.scale.setX(-e.scale.x()),e.scale.setY(-e.scale.y()),e.angleDegrees+=e.angleDegrees<0?180:-180),e.angleDegrees==0&&(e.angleDegrees=360),t.angleDegrees==0&&(t.angleDegrees=360),Math.abs(e.angleDegrees-t.angleDegrees)>180&&(e.angleDegrees>t.angleDegrees?e.angleDegrees-=360:t.angleDegrees-=360);let r=new i;return r.translation=e.translation.multiply(1-n).add1(t.translation.multiply(n)),r.scale=e.scale.multiply(1-n).add1(t.scale.multiply(n)),r.angleDegrees=e.angleDegrees*(1-n)+t.angleDegrees*n,r.m00=e.m00*(1-n)+t.m00*n,r.m10=e.m10*(1-n)+t.m10*n,r.m01=e.m01*(1-n)+t.m01*n,r.m11=e.m11*(1-n)+t.m11*n,r}constructor(){this.translation=E.new2(),this.scale=E.new2(),this.angleDegrees=0,this.m00=0,this.m01=0,this.m10=0,this.m11=0}};var as;(t=>{function i(n){return n=="GRADIENT_LINEAR"||n=="GRADIENT_RADIAL"||n=="GRADIENT_ANGULAR"||n=="GRADIENT_DIAMOND"}t.isGradient=i;function e(n){return n=="GRADIENT_ANGULAR"}t.shouldWrap=e})(as||(as={}));var at=class{constructor(e,t){this.color=e,this.position=t}};at.COMPARE=(e,t)=>tn.double_compare(e.position,t.position),at.EQUALS=(e,t)=>e.color==t.color&&e.position==t.position;var cc=class cc{id(){return this._id}asSinglePaint(){return null}asVolatilePaint(){return null}debugString(){return""}isGradient(){switch(this.type()){case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":return!0}return!1}constructor(){this._id=cc._previousID=cc._previousID+1}};cc._previousID=0;var gu=cc,po=class po extends gu{constructor(t){super();this._type=null,this._color=C.TRANSPARENT,this._opacity=1,this._isEnabled=!0,this._colorStops=null,this._blendMode="NORMAL",this._image=null,this._imageThumbnail=null,this._video=null,this._videoPlaybackParams="",this._transform=Nt.FrozenAffineTransform_IDENTITY,this._rotationDeg=0,this._scalingFactor=1,this._imageScaleMode="STRETCH",this._filterColorAdjust=null,this._originalImageWidth=0,this._originalImageHeight=0,this._decodedImageIsReady=!1,this._decodedImageThumbnailIsReady=!1,this._type=t}type(){return this._type}color(){return this._color}opacity(){return this._opacity}isEnabled(){return this._isEnabled}isVolatile(){return!1}isVisible(){return this._isEnabled&&this._opacity>0}blendMode(){return this._blendMode}transform(){return this._transform}setIsEnabled(t){this._isEnabled=t}debugString(){return`SinglePaint id=${this._id} type=${this._type} blend=${this._blendMode} opacity=${this._opacity}${this._isEnabled?"":" [hidden]"}`}image(){return this._image}imageThumbnail(){return this._imageThumbnail}video(){return this._video}imageScaleMode(){return this._imageScaleMode}rotationDeg(){return this._rotationDeg}scalingFactor(){return this._scalingFactor}filterColorAdjust(){return this._filterColorAdjust}decodedImageIsReady(){return this._decodedImageIsReady}decodedImageThumbnailIsReady(){return this._decodedImageThumbnailIsReady}colorStops(){return this._colorStops}lastStopIsTransparent(){return this._colorStops.length!=0&&C.alpha(ce.List_last(this._colorStops).color)==0}isImageAvailable(){return this._image!=null&&this._image.isDecoded()}isImageThumbnailAvailable(){return this._image!=null&&this._image.isDecoded()}setType(t){this._type=t}setColor(t){this._color=t}setBlendMode(t){this._blendMode=t}setImage(t){this._image=t}setImageThumbnail(t){this._imageThumbnail=t}setVideo(t){this._video!=null&&t==null&&console.log(new Error().stack),this._video=t}videoPlaybackParams(t){this._videoPlaybackParams=t}setTransform(t){this._transform=t}setTransform1(t){this._transform=t.clone()}setImageScaleMode(t){this._imageScaleMode=t}setRotationDeg(t){this._rotationDeg=t}setScalingFactor(t){this._scalingFactor=t}setFilterColorAdjust(t){this._filterColorAdjust=t}setDecodedImageIsReady(t){this._decodedImageIsReady=t}setDecodedImageThumbnailIsReady(t){this._decodedImageThumbnailIsReady=t}setColorStops(t){this._colorStops=t}setColorStops1(t){this._colorStops=t.slice()}setOpacity(t){this._opacity=t}setOriginalImageWidth(t){this._originalImageWidth=t}setOriginalImageHeight(t){this._originalImageHeight=t}allocateBoundsToImageRatio(t,n){let r=E.new3(t);return this._rotationDeg!=0&&(oe.new2().rotatedBy(this._rotationDeg*(Math.PI/180)).transformPoint(n),n.makeAbs()),r.divideUpdate1(n),r}allocateImageSize(){let t=this._video!=null&&this._video.didLoad(this),n=this._image!=null&&this._image.isDecoded(),r=this._imageThumbnail!=null&&this._imageThumbnail.isDecoded();return t?this._video.size(this):n?new E(this._image.width(),this._image.height()):r?this._originalImageWidth!=0&&this._originalImageHeight!=0?new E(this._originalImageWidth,this._originalImageHeight):new E(this._imageThumbnail.width(),this._imageThumbnail.height()):null}allocateImageTransformForGeometrySize(t){let n=this._rotationDeg*(Math.PI/180),r=oe.new2(),o=this.allocateImageSize();o==null&&Ke("Trying to render image before it is loaded");let a=this.allocateBoundsToImageRatio(t,o);switch(this.imageScaleMode()){case"FILL":{r=r.translatedBy2(.5,.5).rotatedBy(-n).scaledBy3(a.x()/a.max1(),a.y()/a.max1()).translatedBy2(-.5,-.5);break}case"FIT":{r=r.translatedBy2(.5,.5).rotatedBy(-n).scaledBy3(a.x()/a.min1(),a.y()/a.min1()).translatedBy2(-.5,-.5);break}case"STRETCH":{r.copyFrom(this.transform());break}case"TILE":{r=r.translatedBy2(.5,.5).rotatedBy(-n).translatedBy2(-.5,-.5).scaledBy2(1/this.scalingFactor()).scaledBy1(a);break}}return r}decodedImage(){return this.image().isDecoded()?this.image():null}decodedImageThumbnail(){return this.imageThumbnail().isDecoded()?this.imageThumbnail():null}scalingFactorForImage(t){return this.image()==null||t==null||t.width()==0||this.image().width()==0?this.scalingFactor():this.scalingFactor()*(this.image().width()/t.width())}colorAdjustIsActive(){return this._filterColorAdjust!=null&&(this._filterColorAdjust.tint!=0||this._filterColorAdjust.vibrance!=0||this._filterColorAdjust.shadows!=0||this._filterColorAdjust.highlights!=0||this._filterColorAdjust.exposure!=0||this._filterColorAdjust.contrast!=0||this._filterColorAdjust.temperature!=0)}colorAdjustSetData(t){t.setUniformFloat(um,this._filterColorAdjust.tint),t.setUniformFloat(pm,this._filterColorAdjust.vibrance),t.setUniformFloat(cm,this._filterColorAdjust.shadows),t.setUniformFloat(dm,this._filterColorAdjust.highlights),t.setUniformFloat(hm,this._filterColorAdjust.exposure),t.setUniformFloat(gm,this._filterColorAdjust.contrast),t.setUniformFloat(mm,this._filterColorAdjust.temperature)}isEnabledAndVisible(){if(!this.isEnabled()||this.opacity()<=0)return!1;switch(this.type()){case"SOLID":return C.alpha(this.color())>0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let t=0,n=this.colorStops().length;t<n;t=t+1)if(C.alpha(this.colorStops()[t].color)>0)return!0;return!1}}return!0}hasAnyFullyTransparentAreas(){if(!this.isEnabled()||this.opacity()<=0)return!0;switch(this.type()){case"SOLID":return C.alpha(this.color())==0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let t=0,n=this.colorStops().length;t<n;t=t+1)if(C.alpha(this.colorStops()[t].color)==0)return!0;return!1}case"EMOJI":case"IMAGE":case"VIDEO":return!0}return!0}hasAnimatingMedia(){return this.image()!=null&&this.image().gif()!=null||this.video()!=null}optimized(){if(this.isGradient()&&this.colorStops().length!=0){let t=this.colorStops()[0].color;for(let n=1,r=this.colorStops().length;n<r;n=n+1)if(t!=this.colorStops()[n].color)return this;return po.create("SOLID",this.opacity(),this.blendMode(),this.isEnabled(),t)}return this}equals1(t){return t.isVolatile()?!1:this.equals2(t.asSinglePaint())}equals2(t){if(this._colorStops==null||t.colorStops()==null){if(this._colorStops==null!=(t.colorStops()==null))return!1}else if(!rn.FrozenList_equals(this._colorStops,t.colorStops(),at.EQUALS))return!1;if(this._transform==null||t.transform()==null){if(this._transform==null!=(t.transform()==null))return!1}else if(!this.transform().equals1(t.transform()))return!1;if(this._video==null||t.video()==null){if(this._video==null!=(t.video()==null))return!1}else if(this._video.hash()!=t.video().hash())return!1;if(this._image==null||t.image()==null){if(this._image==null!=(t.image()==null))return!1}else if(this._image.objectHash()!=t.image().objectHash())return!1;if(this._imageThumbnail==null||t.imageThumbnail()==null){if(this._imageThumbnail==null!=(t.imageThumbnail()==null))return!1}else if(this._imageThumbnail.objectHash()!=t.imageThumbnail().objectHash())return!1;return this._type==t.type()&&this._blendMode==t.blendMode()&&this._color==t.color()&&this._isEnabled==t.isEnabled()&&this._opacity==t.opacity()&&this._rotationDeg==t.rotationDeg()&&this._scalingFactor==t.scalingFactor()&&this._imageScaleMode==t.imageScaleMode()&&this._filterColorAdjust==t.filterColorAdjust()&&this._decodedImageIsReady==t.decodedImageIsReady()&&this._decodedImageThumbnailIsReady==t.decodedImageThumbnailIsReady()}clone(){return this.cloneAsSinglePaint()}cloneAsSinglePaint(){let t=new po(this._type);return t._blendMode=this._blendMode,t._color=this.color(),t._colorStops=this._colorStops,t._image=this._image,t._imageThumbnail=this._imageThumbnail,t._video=this._video,t._isEnabled=this._isEnabled,t._opacity=this._opacity,t._transform=this._transform,t._rotationDeg=this._rotationDeg,t._scalingFactor=this._scalingFactor,t._imageScaleMode=this._imageScaleMode,t._filterColorAdjust=this._filterColorAdjust,t._decodedImageIsReady=this._decodedImageIsReady,t._decodedImageThumbnailIsReady=this._decodedImageThumbnailIsReady,t._originalImageWidth=this._originalImageWidth,t._originalImageHeight=this._originalImageHeight,t}isOpaque(){if(this.opacity()<1||this.blendMode()!="NORMAL")return!1;switch(this.type()){case"SOLID":return C.isOpaque(this._color);case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{for(let t=0,n=this._colorStops.length;t<n;t=t+1){let r=this._colorStops[t];if(!C.isOpaque(r.color))return!1}return!0}case"EMOJI":case"IMAGE":case"VIDEO":return!1}return!1}flattenedStops(){let t=this._colorStops.slice();if(t.sort((n,r)=>tn.double_compare(n.position,r.position)),as.shouldWrap(this.type())&&t.length>=2){let n=t[0],r=ce.List_last(t);if(n.position>0)if(r.position<1){let o=C.mix(n.color,r.color,n.position/(1-r.position+n.position));t.unshift(new at(o,0)),t.push(new at(o,1))}else t.unshift(new at(r.color,0));else r.position<1&&t.push(new at(n.color,1))}return t}asSinglePaint(){return this}getCanvasSpaceUnclippedImageSize(t){if(!this.isImageAvailable()&&!this.isImageThumbnailAvailable())return ve.FrozenVector_ZERO;let n=this.allocateImageSize(),r=null;switch(this.imageScaleMode()){case"STRETCH":{r=t.divide1(this._transform.scale1());break}case"FILL":{let o=this.allocateBoundsToImageRatio(t,n);o.x()>o.y()?r=new E(t.x(),o.x()*this._image.height()):r=new E(o.y()*this._image.width(),t.y());break}case"FIT":{let o=this.allocateBoundsToImageRatio(t,n);o.x()>o.y()?r=new E(o.y()*this._image.width(),t.y()):r=new E(t.x(),o.x()*this._image.height());break}case"TILE":return ve.FrozenVector_ZERO;default:return console.warn(`Unimplemented imageScaleMode ${this.imageScaleMode()} in getCanvasSpaceUnclippedImageSize`),ve.FrozenVector_ZERO}return r}static create(t,n,r,o,a){let s=new po(t);return s.setOpacity(n),s.setBlendMode(r),s.setIsEnabled(o),s.setColor(a),s}static createSolid(t,n){return po.create("SOLID",n*C.alphaF(t),"NORMAL",!0,C.withAlpha(t,255))}static createLinearGradient(t){let n=po.create("GRADIENT_LINEAR",1,"NORMAL",!0,C.BLACK);return n.setColorStops1(t),n}static createRadialGradient(t){let n=po.create("GRADIENT_RADIAL",1,"NORMAL",!0,C.BLACK);return n.setColorStops1(t),n}static createAngularGradient(t){let n=po.create("GRADIENT_ANGULAR",1,"NORMAL",!0,C.BLACK);return n.setColorStops1(t),n}static createDiamondGradient(t){let n=po.create("GRADIENT_DIAMOND",1,"NORMAL",!0,C.BLACK);return n.setColorStops1(t),n}};po.TRANSPARENT=po.create("SOLID",0,"NORMAL",!0,C.BLACK),po.SOLID_BLACK=po.create("SOLID",1,"NORMAL",!0,C.BLACK);var se=po,dc=class i extends gu{constructor(t,n,r,o,a){super();this._from=null,this._to=null,this._getEasedT=null,this._fromCanvasSpaceNodeSize=null,this._toCanvasSpaceNodeSize=null,this._cachedFromTransform=null,this._cachedToTransform=null,this._cachedFromOffsetFromCenter=null,this._cachedToOffsetFromCenter=null,this._cachedFromImageOnCanvasSize=null,this._cachedToImageOnCanvasSize=null,this._from=t,this._to=n,this._getEasedT=r,this._fromCanvasSpaceNodeSize=o,this._toCanvasSpaceNodeSize=a,this._needsImageDimensionsForInterpolation()&&this._computeCachedImageDimensions()}_needsImageDimensionsForInterpolation(){return this.type()!="IMAGE"&&this.type()!="VIDEO"||!this._from.isImageAvailable()&&!this._from.isImageThumbnailAvailable()||!this._to.isImageAvailable()&&!this._to.isImageThumbnailAvailable()?!1:this._from.imageScaleMode()!="TILE"&&this._to.imageScaleMode()!="TILE"&&(this._from.imageScaleMode()=="STRETCH"||this._to.imageScaleMode()=="STRETCH"||this._from.imageScaleMode()!=this._to.imageScaleMode())}_computeCachedImageDimensions(){this.from().imageScaleMode()!="STRETCH"?(this._cachedFromTransform=this._from.allocateImageTransformForGeometrySize(this._fromCanvasSpaceNodeSize),this._cachedFromOffsetFromCenter=new E(0,0)):(this._cachedFromTransform=this.from().transform(),this._cachedFromOffsetFromCenter=new E(.5,.5).subtract1(this._cachedFromTransform.scale1().divide(2).add1(this._cachedFromTransform.translation()))),this.to().imageScaleMode()!="STRETCH"?(this._cachedToTransform=this._to.allocateImageTransformForGeometrySize(this._toCanvasSpaceNodeSize),this._cachedToOffsetFromCenter=new E(0,0)):(this._cachedToTransform=this.to().transform(),this._cachedToOffsetFromCenter=new E(.5,.5).subtract1(this._cachedToTransform.scale1().divide(2).add1(this._cachedToTransform.translation()))),this._cachedFromImageOnCanvasSize=this.from().getCanvasSpaceUnclippedImageSize(this._fromCanvasSpaceNodeSize),this._cachedToImageOnCanvasSize=this.to().getCanvasSpaceUnclippedImageSize(this._toCanvasSpaceNodeSize)}isEnabled(){return this._from.isEnabled()||this._to.isEnabled()}isVisible(){return this.isEnabled()&&(this._from.opacity()>0||this._to.opacity()>0)}isVolatile(){return!0}type(){return this._from.type()}blendMode(){return this._from.blendMode()}setIsEnabled(t){this._from.setIsEnabled(t),this._to.setIsEnabled(t)}isEnabledAndVisible(){return this._from.isEnabledAndVisible()||this._to.isEnabledAndVisible()}debugString(){return`VolatilePaint from=[${this._from.debugString()}] to=[${this._to.debugString()}]`}t(){return this._getEasedT()}from(){return this._from}to(){return this._to}color(){return C.mix(this._from.color(),this._to.color(),this._getEasedT())}isOpaque(){return this._from.isOpaque()&&this._to.isOpaque()}transform(){let t=new E(.5,.5),n=this._from.transform().clone().translatedBy1(t),r=this._to.transform().clone().translatedBy1(t);return Jr.lerp1(n,r,this.t()).translatedBy1(t.negative())}allocateImageTransformForGeometrySize(t){let n=oe.new2(),r=E.lerp(this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize,this.t());if(this.from().imageScaleMode()=="STRETCH"||this.to().imageScaleMode()=="STRETCH"||this.from().imageScaleMode()!=this.to().imageScaleMode()){(this._cachedFromTransform==null||this._cachedToTransform==null||this._cachedFromOffsetFromCenter==null||this._cachedToOffsetFromCenter==null||this._cachedFromImageOnCanvasSize==null||this._cachedToImageOnCanvasSize==null)&&this._computeCachedImageDimensions();let o=E.lerp(this._cachedFromImageOnCanvasSize,this._cachedToImageOnCanvasSize,this.t()),a=r.divide1(o),s=E.lerp(this._cachedFromOffsetFromCenter,this._cachedToOffsetFromCenter,this.t()),l=new E(.5,.5).subtract1(s).subtract1(a.divide(2)),d=tn.double_lerp(this._cachedFromTransform.toAngle(),this._cachedToTransform.toAngle(),this.t());return n.translatedBy1(l).rotatedBy(d).scaledBy1(a)}else{let o=this._from.allocateImageTransformForGeometrySize(r),a=this._to.allocateImageTransformForGeometrySize(r);return n.copyFrom(Jr.lerp1(o,a,this.t())),n}}opacity(){return tn.double_clamp(tn.double_lerp(this.from().opacity(),this.to().opacity(),this.t()),0,1)}colorAdjustIsActive(){return this._from.colorAdjustIsActive()||this._to.colorAdjustIsActive()}colorAdjustSetData(t){t.setUniformFloat(um,tn.double_clamp(tn.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().tint:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().tint:0,this.t()),-1,1)),t.setUniformFloat(pm,tn.double_clamp(tn.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().vibrance:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().vibrance:0,this.t()),-1,1)),t.setUniformFloat(cm,tn.double_clamp(tn.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().shadows:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().shadows:0,this.t()),-1,1)),t.setUniformFloat(dm,tn.double_clamp(tn.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().highlights:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().highlights:0,this.t()),-1,1)),t.setUniformFloat(hm,tn.double_clamp(tn.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().exposure:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().exposure:0,this.t()),-1,1)),t.setUniformFloat(gm,tn.double_clamp(tn.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().contrast:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().contrast:0,this.t()),-.3,.3)),t.setUniformFloat(mm,tn.double_clamp(tn.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().temperature:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().temperature:0,this.t()),-1,1))}equals1(t){return t.isVolatile()?this.equals2(t.asVolatilePaint()):!1}equals2(t){if(!t.isVolatile())return!1;let n=t;return this._from.equals2(n._from.asSinglePaint())&&this._to.equals2(n._to.asSinglePaint())&&this._getEasedT==n._getEasedT&&this._fromCanvasSpaceNodeSize.equals(n._fromCanvasSpaceNodeSize)&&this._toCanvasSpaceNodeSize.equals(n._toCanvasSpaceNodeSize)}clone(){return this.cloneAsVolatilePaint()}cloneAsVolatilePaint(){return new i(this._from.cloneAsSinglePaint(),this._to.cloneAsSinglePaint(),this._getEasedT,this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize)}hasAnyFullyTransparentAreas(){return this._from.hasAnyFullyTransparentAreas()&&this._to.hasAnyFullyTransparentAreas()}asVolatilePaint(){return this}eitherPaint(t){return t(this._from)||t(this._to)}static create(t,n,r,o,a){return new i(t,n,a,r,o)}},pS;(e=>e.FrozenPaint_EMPTY_LIST=[])(pS||(pS={}));var Oe;(W=>{function i(x,F){return[se.createSolid(x,F)]}W.createFromSolidColor=i;function e(x){return x}W.create1=e;function t(x){return x}W.create2=t;function n(x){return[x].slice()}W.fromPaint=n;function r(x){return x}W.asPaintList=r;function o(x){return x.length==0}W.isEmpty=o;function a(x){return x.length}W.count=a;function s(x,F){return x[F]}W.get=s;function l(x){return x[0]}W.first=l;function d(x){return ce.List_last(x)}W.last=d;function c(x){return x.slice()}W.clone=c;function p(x){let F=!1;for(let k=0,G=x.length;k<G;k=k+1)x[k].type()=="EMOJI"&&(F=!0);return F}W.hasEmoji=p;function u(x,F){return rn.FrozenList_equals(x,F,(k,G)=>k==null||G==null?k==null==(G==null):k.equals1(G))}W.equals=u;function h(x){return x.length==1?x[0]:null}W.onlyPaintOrNull=h;function f(x){let F=h(x);return F!=null&&F.type()=="SOLID"&&!F.isVolatile()?F:null}W.onlySolidPaintOrNull=f;function _(x){for(let F=0,k=x.length;F<k;F=F+1){let G=x.length-1-F;if(!x[G].isEnabledAndVisible())continue;let M=x[G];return M!=null&&M.type()=="SOLID"&&!M.isVolatile()&&M.asSinglePaint().isOpaque()?M:null}return null}W.firstPaintIfSolidAndOpaqueOrNull=_;function m(x){return x.length==1&&x[0].type()=="EMOJI"}W.isEmojiPaint=m;function A(x){for(let F=0,k=x.length;F<k;F=F+1){let G=x[F].asSinglePaint();if(G!=null){if(G.blendMode()!="NORMAL"&&G.blendMode()!="PASS_THROUGH")return!1}else{let M=x[F].asVolatilePaint();if(M!=null&&M.eitherPaint(Q=>Q.blendMode()!="NORMAL"&&Q.blendMode()!="PASS_THROUGH"))return!1}}return!0}W.isIsolated=A;function y(x){for(let F=0,k=x.length;F<k;F=F+1)if(x[F].isEnabledAndVisible())return!0;return!1}W.containsAtLeastOneVisiblePaint=y;function S(x){for(let F=0,k=x.length;F<k;F=F+1){let G=x[F].asSinglePaint(),M=x[F].asVolatilePaint();if(G==null&&M!=null&&M.isVisible()||G!=null&&G.isVisible()&&!G.hasAnyFullyTransparentAreas())return!0}return!1}W.containsAtLeastOneVisibleNotFullyTransparentPaint=S;function g(x){for(let F=0,k=x.length;F<k;F=F+1){if(!x[F].isEnabledAndVisible())continue;let G=x[F].asSinglePaint();if(G!=null){if(G.isOpaque())return!0}else{let M=x[F].asVolatilePaint();if(M!=null&&M.isOpaque())return!0}}return!1}W.containsAtLeastOneVisibleOpaquePaint=g;function b(x){for(let F=0,k=x.length;F<k;F=F+1){let G=x[F].asSinglePaint();if(G!=null){if(!G.isOpaque())return!0}else{let M=x[F].asVolatilePaint();if(M!=null&&!M.isOpaque())return!0}}return!1}W.containsAtLeastOneNonOpaquePaint=b;function T(x){for(let F=0,k=x.length;F<k;F=F+1){let G=x[F].asSinglePaint();if(G==null&&x[F].asVolatilePaint()!=null||!G.hasAnyFullyTransparentAreas())return!1}return!0}W.hasAnyFullyTransparentAreas=T;function I(x){for(let F=0,k=x.length;F<k;F=F+1){let G=x[F].asSinglePaint();if(G!=null){if(G.hasAnimatingMedia())return!0}else{let M=x[F].asVolatilePaint();if(M!=null&&M.eitherPaint(Q=>Q.hasAnimatingMedia()))return!0}}return!1}W.hasAnimatingMediaPaints=I;function O(x){for(let F=0,k=x.length;F<k;F=F+1)if(x[F].isVolatile())return!0;return!1}W.hasVolatilePaints=O;function w(x,F){var k,G;for(let M=0,Q=x.length;M<Q;M=M+1){let Y=x[M].asSinglePaint();(Y==null?void 0:Y.video())!=null&&F(Y);let B=x[M].asVolatilePaint();((k=B==null?void 0:B.to())==null?void 0:k.video())!=null&&F(B.to()),((G=B==null?void 0:B.from())==null?void 0:G.video())!=null&&F(B.from())}}W.forEachPaintWithVideo=w;function P(x){if(A(x))return[x].slice();let F=[],k="NORMAL",G=[];for(let M=0,Q=x.length;M<Q;M=M+1){let Y=x[M];(Y.blendMode()!=k||Y.blendMode()!="NORMAL")&&G.length!=0&&(F.push(G.slice()),G.length=0),k=Y.blendMode(),G.push(Y)}return G.length!=0&&F.push(G.slice()),F}W.isolatedPaints=P;function H(x){if(O(x))return x;if(x.length==2&&x[0].type()=="SOLID"&&ce.List_last(x).asSinglePaint().isGradient()){let k=x[0].asSinglePaint(),G=C.multiplyOpacity(k.color(),k.opacity()),M=ce.List_last(x).clone(),Q=[],Y=-1,B=!0,te=M.colorStops();for(let j=0,ie=te.length;j<ie;j=j+1){let de=te[j];if(Y>=0&&Y!=C.alpha(de.color)){B=!1;break}Y=C.alpha(de.color);let tt=C.multiplyOpacity(de.color,M.opacity());Q.push(new at(C.blend(G,tt),de.position))}if(B)return M.setOpacity(1),M.setColorStops1(Q),H([M].slice())}let F=x.length;for(let k=0;k<F;k=k+1){let G=x[k].asSinglePaint().optimized();if(G==x[k])continue;let M=x.slice().slice(0,k);for(M.push(G);(k=k+1)<F;)M.push(x[k].asSinglePaint().optimized());return M}return x}W.optimize=H,W.SOLID_BLACK=[se.createSolid(C.BLACK,1)],W.EMPTY=[]})(Oe||(Oe={}));var vr=class{constructor(e,t){this.a=e,this.b=t}};var qo=class qo{constructor(e,t,n){this.center=null,this.xRadius=0,this.yRadius=0,this._hash=0,this._cachedBezier=null,this.center=e,this.xRadius=t,this.yRadius=n,qo.hasher.reset(),qo.hasher.hash1(this.center.x()),qo.hasher.hash1(this.center.y()),qo.hasher.hash1(this.xRadius),qo.hasher.hash1(this.yRadius),this._hash=qo.hasher.value()}bounds(){return new U(this.center.x()-this.xRadius,this.center.y()-this.yRadius,this.xRadius*2,this.yRadius*2)}equals2(e){return e instanceof qo?this.equals1(e):!1}equals1(e){return this.center.equals(e.center)&&this.xRadius==e.xRadius&&this.yRadius==e.yRadius}clone(){return new qo(this.center.clone(),this.xRadius,this.yRadius)}hash(){return this._hash}isRect(){return!1}canBeAnalyticallyAntialiased(){return N.supportsWebGLExtensionOESStandardDerivatives()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=Rt.forEllipse(this.bounds())),this._cachedBezier}asRoundedRectPath(){return null}static fromBounds(e){return new qo(e.center(),e.width()/2,e.height()/2)}};qo.hasher=new co;var ui=qo;var ya=(u=>(u[u.NONE=0]="NONE",u[u.ZOOM_IN=1]="ZOOM_IN",u[u.ZOOM_OUT=2]="ZOOM_OUT",u[u.ZOOM_RESET=3]="ZOOM_RESET",u[u.ZOOM_TO_FIT=4]="ZOOM_TO_FIT",u[u.MIRROR_TAP=5]="MIRROR_TAP",u[u.CANVAS_MOUSE_DOWN=6]="CANVAS_MOUSE_DOWN",u[u.CANVAS_MOUSE_MOVE=7]="CANVAS_MOUSE_MOVE",u[u.CANVAS_MOUSE_DRAG=8]="CANVAS_MOUSE_DRAG",u[u.CANVAS_MOUSE_UP=9]="CANVAS_MOUSE_UP",u[u.CANVAS_TOUCH_DOWN=10]="CANVAS_TOUCH_DOWN",u[u.REQUEST_CANVAS_CHANGE=11]="REQUEST_CANVAS_CHANGE",u))(ya||{}),hS;(e=>{function i(t){return ya[t]}e.Action_toString=i})(hS||(hS={}));var wo=class{constructor(e){this._hashKey=null,this._keyByHash=new Map,this._valueByKeyHash=new Map,this._hashKey=e}count(){return this._keyByHash.size}_in(e){let t=this._hashKey(e);return this._keyByHash.has(t)}set(e,t){let n=this._hashKey(e);this._keyByHash.set(n,e),this._valueByKeyHash.set(n,t)}get1(e){let t=this._hashKey(e);return this._valueByKeyHash.get(t)}get(e,t){let n=this._hashKey(e);return Le.StringMap_get(this._valueByKeyHash,n,t)}remove(e){let t=this._hashKey(e);this._keyByHash.delete(t),this._valueByKeyHash.delete(t)}clear(){this._keyByHash=new Map,this._valueByKeyHash=new Map}keys(){return Array.from(this._keyByHash.values())}values(){return Array.from(this._valueByKeyHash.values())}each(e){this.keys().forEach(t=>{e(t,this.get1(t))})}isEmpty(){return this.count()==0}},ta=class{constructor(e){this._hash=null,this._hash=new wo(e)}add(e){this._hash.set(e,!0)}addList(e){for(let t of e)this.add(t)}_in(e){return this._hash._in(e)}remove(e){this._hash.remove(e)}count(){return this._hash.count()}asList(){return this._hash.keys()}each(e){this._hash.keys().forEach(e)}map(e){return this._hash.keys().map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of this._hash.keys())if(!e._in(t))return!1;return!0}};var Ot=(ee=>(ee[ee.MISSING__=0]="MISSING__",ee[ee.TEXT_ALIGN_HORIZONTAL=1]="TEXT_ALIGN_HORIZONTAL",ee[ee.TEXT_ALIGN_VERTICAL=2]="TEXT_ALIGN_VERTICAL",ee[ee.FONT_SIZE=3]="FONT_SIZE",ee[ee.TEXT_DATA=4]="TEXT_DATA",ee[ee.DERIVED_TEXT_DATA=5]="DERIVED_TEXT_DATA",ee[ee.HYPERLINK=6]="HYPERLINK",ee[ee.MENTION=7]="MENTION",ee[ee.VISIBLE=8]="VISIBLE",ee[ee.IS_BACKGROUND_ENABLED=9]="IS_BACKGROUND_ENABLED",ee[ee.IS_MASK=10]="IS_MASK",ee[ee.IS_MASK_OUTLINE__DEPRECATED=11]="IS_MASK_OUTLINE__DEPRECATED",ee[ee.IS_INTERNAL_ONLY=12]="IS_INTERNAL_ONLY",ee[ee.IS_FRAME_MASK_DISABLED=13]="IS_FRAME_MASK_DISABLED",ee[ee.IS_RESIZE_TO_FIT=14]="IS_RESIZE_TO_FIT",ee[ee.RECTANGLE_CORNER_RADII_INDEPENDENT=15]="RECTANGLE_CORNER_RADII_INDEPENDENT",ee[ee.INTERACTION_MAINTAINED__DEPRECATED=16]="INTERACTION_MAINTAINED__DEPRECATED",ee[ee.TRANSITION_PRESERVE_SCROLL__DEPRECATED=17]="TRANSITION_PRESERVE_SCROLL__DEPRECATED",ee[ee.TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED=18]="TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED",ee[ee.TYPE=19]="TYPE",ee[ee.HORIZONTAL_CONSTRAINT=20]="HORIZONTAL_CONSTRAINT",ee[ee.VERTICAL_CONSTRAINT=21]="VERTICAL_CONSTRAINT",ee[ee.BLEND_MODE=22]="BLEND_MODE",ee[ee.STROKE_ALIGN=23]="STROKE_ALIGN",ee[ee.RELATIVE_TRANSFORM=24]="RELATIVE_TRANSFORM",ee[ee.PARENT_INDEX=25]="PARENT_INDEX",ee[ee.CONNECTION_TYPE__DEPRECATED=26]="CONNECTION_TYPE__DEPRECATED",ee[ee.TRANSITION_TYPE__DEPRECATED=27]="TRANSITION_TYPE__DEPRECATED",ee[ee.EASING_TYPE__DEPRECATED=28]="EASING_TYPE__DEPRECATED",ee[ee.INTERACTION_TYPE__DEPRECATED=29]="INTERACTION_TYPE__DEPRECATED",ee[ee.NAVIGATION_TYPE__DEPRECATED=30]="NAVIGATION_TYPE__DEPRECATED",ee[ee.OVERLAY_POSITION_TYPE=31]="OVERLAY_POSITION_TYPE",ee[ee.OVERLAY_BACKGROUND_INTERACTION=32]="OVERLAY_BACKGROUND_INTERACTION",ee[ee.STYLE_TYPE=33]="STYLE_TYPE",ee[ee.OVERFLOW_DIRECTION=34]="OVERFLOW_DIRECTION",ee[ee.SCROLL_BEHAVIOR=35]="SCROLL_BEHAVIOR",ee[ee.MASK_TYPE=36]="MASK_TYPE",ee[ee.OPACITY=37]="OPACITY",ee[ee.BACKGROUND_OPACITY=38]="BACKGROUND_OPACITY",ee[ee.RECTANGLE_TOP_LEFT_CORNER_RADIUS=39]="RECTANGLE_TOP_LEFT_CORNER_RADIUS",ee[ee.RECTANGLE_TOP_RIGHT_CORNER_RADIUS=40]="RECTANGLE_TOP_RIGHT_CORNER_RADIUS",ee[ee.RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS=41]="RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS",ee[ee.RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS=42]="RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS",ee[ee.STROKE_WEIGHT=43]="STROKE_WEIGHT",ee[ee.CORNER_RADIUS=44]="CORNER_RADIUS",ee[ee.CORNER_SMOOTHING=45]="CORNER_SMOOTHING",ee[ee.TRANSITION_DURATION__DEPRECATED=46]="TRANSITION_DURATION__DEPRECATED",ee[ee.TRANSITION_TIMEOUT__DEPRECATED=47]="TRANSITION_TIMEOUT__DEPRECATED",ee[ee.INTERACTION_DURATION__DEPRECATED=48]="INTERACTION_DURATION__DEPRECATED",ee[ee.SIZE=49]="SIZE",ee[ee.OVERRIDE_KEY=50]="OVERRIDE_KEY",ee[ee.OVERRIDDEN_SYMBOL_ID=51]="OVERRIDDEN_SYMBOL_ID",ee[ee.INHERIT_FILL_STYLE_ID=52]="INHERIT_FILL_STYLE_ID",ee[ee.INHERIT_FILL_STYLE_ID_FOR_STROKE=53]="INHERIT_FILL_STYLE_ID_FOR_STROKE",ee[ee.INHERIT_FILL_STYLE_ID_FOR_BACKGROUND=54]="INHERIT_FILL_STYLE_ID_FOR_BACKGROUND",ee[ee.INHERIT_TEXT_STYLE_ID=55]="INHERIT_TEXT_STYLE_ID",ee[ee.INHERIT_EFFECT_STYLE_ID=56]="INHERIT_EFFECT_STYLE_ID",ee[ee.OVERLAY_RELATIVE_POSITION__DEPRECATED=57]="OVERLAY_RELATIVE_POSITION__DEPRECATED",ee[ee.BACKGROUND_PAINT_DATA=58]="BACKGROUND_PAINT_DATA",ee[ee.FILL_PAINT_DATA=59]="FILL_PAINT_DATA",ee[ee.STROKE_PAINT_DATA=60]="STROKE_PAINT_DATA",ee[ee.EFFECT_DATA=61]="EFFECT_DATA",ee[ee.NAME=62]="NAME",ee[ee.ARC_DATA=63]="ARC_DATA",ee[ee.BACKGROUND_COLOR=64]="BACKGROUND_COLOR",ee[ee.PROTOTYPE_BACKGROUND_COLOR=65]="PROTOTYPE_BACKGROUND_COLOR",ee[ee.PROTOTYPE_DEVICE=66]="PROTOTYPE_DEVICE",ee[ee.OVERLAY_BACKGROUND_APPEARANCE=67]="OVERLAY_BACKGROUND_APPEARANCE",ee[ee.EXPORT_SETTINGS_DATA=68]="EXPORT_SETTINGS_DATA",ee[ee.PROTOTYPE_START_NODE_ID=69]="PROTOTYPE_START_NODE_ID",ee[ee.CONNECTION_URL_DEPRECATED=70]="CONNECTION_URL_DEPRECATED",ee[ee.TRANSITION_NODE_ID_DEPRECATED=71]="TRANSITION_NODE_ID_DEPRECATED",ee[ee.VIDEO_PLAYBACK=72]="VIDEO_PLAYBACK",ee[ee.FILL_GEOMETRY=73]="FILL_GEOMETRY",ee[ee.STROKE_GEOMETRY=74]="STROKE_GEOMETRY",ee[ee.SYMBOL_DATA=75]="SYMBOL_DATA",ee[ee.COMPILED_VECTOR_DATA=76]="COMPILED_VECTOR_DATA",ee[ee.STACK_MODE=77]="STACK_MODE",ee[ee.STACK_REVERSE_Z_INDEX=78]="STACK_REVERSE_Z_INDEX",ee[ee.CONTAINER_SUPPORTS_FILL_STROKE_AND_CORNERS=79]="CONTAINER_SUPPORTS_FILL_STROKE_AND_CORNERS",ee[ee.KEY_TRIGGER__DEPRECATED=80]="KEY_TRIGGER__DEPRECATED",ee[ee.IS_STATE_GROUP=81]="IS_STATE_GROUP",ee[ee.PROTOTYPE_INTERACTIONS=82]="PROTOTYPE_INTERACTIONS",ee[ee.VOICE_EVENT_PHRASE__DEPRECATED=83]="VOICE_EVENT_PHRASE__DEPRECATED",ee[ee.PROTOTYPE_STARTING_POINT=84]="PROTOTYPE_STARTING_POINT",ee[ee.SHAPE_WITH_TEXT_TYPE=85]="SHAPE_WITH_TEXT_TYPE",ee[ee.INTERACTIVE_SLIDE_CONFIG_DATA=86]="INTERACTIVE_SLIDE_CONFIG_DATA",ee[ee.INTERACTIVE_SLIDE_PARTICIPANT_DATA=87]="INTERACTIVE_SLIDE_PARTICIPANT_DATA",ee[ee.SCROLL_OFFSET=88]="SCROLL_OFFSET",ee[ee.USED_AS_BASE_SCREEN=89]="USED_AS_BASE_SCREEN",ee[ee.CURRENT_VIEWPORT_SIZE=90]="CURRENT_VIEWPORT_SIZE",ee[ee.HAS_BEEN_LOADED=91]="HAS_BEEN_LOADED",ee[ee.STYLE_ID_FOR_FILL=92]="STYLE_ID_FOR_FILL",ee[ee.STYLE_ID_FOR_STROKE_FILL=93]="STYLE_ID_FOR_STROKE_FILL",ee[ee.STYLE_ID_FOR_TEXT=94]="STYLE_ID_FOR_TEXT",ee[ee.STYLE_ID_FOR_EFFECT=95]="STYLE_ID_FOR_EFFECT",ee[ee.STYLE_ID_FOR_GRID=96]="STYLE_ID_FOR_GRID",ee[ee.PHASE=97]="PHASE",ee[ee.END__=98]="END__",ee))(Ot||{});var Sn;(p=>{function i(u,h){let f=l();for(let _=0,m=u.length;_<m;_=_+1)n(f,u[_],h[_]);return f}p.new1=i;function e(u,h){return u.has(Ot[h])}p._in=e;function t(u,h){return Le.StringMap_get(u,Ot[h],null)}p.get1=t;function n(u,h,f){let _=Ot[h];p._remapKey.set(_,h),u.set(_,f)}p.set=n;function r(u,h,f){return Le.StringMap_get(u,Ot[h],f)}p.get=r;function o(u,h){u.delete(Ot[h])}p.remove=o;function a(u,h){Le.StringMap_each(u,(f,_)=>{h(p._remapKey.get(f),_)})}p.each=a;function s(u){let h=[];return Le.StringMap_each(u,(f,_)=>{h.push(`${f}=${$.toString(_)}`)}),`{${h.join(", ")}}`}p.toString=s;function l(){return new Map}p._new=l,p._remapKey=new Map,p.EMPTY=l()})(Sn||(Sn={}));var Yo;(o=>{function i(a,s){return Sn._in(a,s)}o._in=i;function e(a,s){return Sn.get1(a,s)}o.get1=e;function t(a,s,l){return Sn.get(a,s,l)}o.get=t;function n(a,s){Sn.each(a,s)}o.each=n;function r(a){return Sn.toString(a)}o.toString=r})(Yo||(Yo={}));var ba;(e=>{function i(t){return t!="NONE"&&t!="PRESENTATION"}e.hasDevice=i})(ba||(ba={}));var un;(r=>{function i(o){return o=="BOOLEAN_OPERATION"||o=="VECTOR"||o=="STAR"||o=="LINE"||o=="ELLIPSE"||o=="RECTANGLE"||o=="REGULAR_POLYGON"||o=="ROUNDED_RECTANGLE"||o=="TEXT"||o=="STAMP"||o=="WASHI_TAPE"}r.isGeometryLeaf=i;function e(o){return o=="FRAME"||o=="SYMBOL"||o=="INSTANCE"||o=="SECTION"||n(o)||o=="TABLE_CELL"||o=="SLIDE"}r.isFrameLike=e;function t(o){return o=="RECTANGLE"||o=="ROUNDED_RECTANGLE"||o=="ELLIPSE"||o=="STAMP"||e(o)}r.isRectOrEllipseLike=t;function n(o){return o=="STICKY"||o=="SHAPE_WITH_TEXT"||o=="CONNECTOR"||o=="CODE_BLOCK"||o=="MEDIA"||o=="SECTION_OVERLAY"||o=="TABLE"}r.isImmutableFrame=n})(un||(un={}));var Am=(t=>(t[t.STATIC_REGION=0]="STATIC_REGION",t[t.DYNAMIC_REGION=1]="DYNAMIC_REGION",t))(Am||{}),fu=class{path(){throw new Error("Not implemented")}bounds(){throw new Error("Not implemented")}geometryEquals(e){throw new Error("Not implemented")}constructor(e,t,n){this.type=e,this.windingRule=t,this.styleID=n}},Yn=class i extends fu{constructor(t,n,r,o){super(0,t,n);this._path=null,this._bounds=null,this._path=r,this._bounds=o}path(){return this._path}bounds(){return this._bounds}geometryEquals(t){return t instanceof i?t.windingRule==this.windingRule&&t.bounds().equals(this._bounds)&&t.path().equals2(this._path):!1}},uc=class extends fu{constructor(t,n,r,o){super(1,t,n);this._computePath=null,this._maxBounds=null,this._computePath=r,this._maxBounds=o}path(){return this._computePath()}bounds(){return this._maxBounds}geometryEquals(t){return t==this}},ho=class{constructor(e){this._overrideTable=null,this._overrideTable=e}get(e,t){if(this._overrideTable!=null&&this._overrideTable._in(e)){let n=this._overrideTable.styleByID1(e),r=n!=null?Yo.get(n,92,null):null,o=null;if(r!=null&&(o=t.findStyle($.asStyleId(r))),o==null){let s=n!=null?$.asGUID(Yo.get(n,52,null)):null;o=t.findNode1(s)}if(o!=null)return o.fillPaints();let a=n!=null?Yo.get(n,59,null):null;if(a!=null)return $.asPaintList(a)}return null}forEachPaint(e,t){var n;(n=this._overrideTable)==null||n.forEachFillPaint(e,t)}table(){return this._overrideTable}},Dn=class{geometryEquals(e){return ce.List_equalsWithComparison(this.regions,e.regions,(t,n)=>t.geometryEquals(n))}isRect(){return this.regions.length==1?Lt.getOrCreate(this.regions[0].path(),this.regions[0].windingRule).isRect():!1}toString(){return`Geometry(bounds: ${this.bounds} with ${this.regions.length} regions)`}constructor(e,t,n,r){this.regions=e,this.styleIDs=t,this.bounds=n,this.paintOverrides=r}},_u=class extends Dn{constructor(t,n,r,o,a){super(t,n,r,o);this.emojiCodepoints=a}},Mt=class i{static equals(e,t){if(e!=null&&t!=null&&e.guids.length==t.guids.length){for(let n=0,r=e.guids.length;n<r;n=n+1)if(!ne.equals(e.guids[n],t.guids[n]))return!1;return!0}return e==t}static equalsGUID(e,t){return e!=null&&t!=null&&e.guids.length==1?ne.equals(e.guids[0],t):e==null&&t==null}toString(){return`[${this.guids.map(e=>e).join(", ")}]`}startsWith(e){if(this.guids==null)return e.guids==null;if(this.guids.length<e.guids.length)return!1;for(let t=0,n=e.guids.length;t<n;t=t+1)if(!ne.equals(e.guids[t],this.guids[t]))return!1;return!0}slice1(e){return this.slice2(e,this.guids.length)}slice2(e,t){return new i(this.guids.slice(e,t))}cloneAndAppend(e){let t=this.guids.slice();return ce.List_append2(t,e.guids),new i(t)}static fromString(e){if(e!=null&&e.length>=2&&e.startsWith("[")&&e.endsWith("]")){let t=e.slice(1,e.length-1).split(","),n=[];for(let r of t){let o=ne.fromString(r.trim());if(o==null)return null;n.push(o)}return new i(n)}return null}constructor(e){this.guids=e}},No;(r=>{function i(o){return o}r.map=i;function e(o){let a=[];return o.each((s,l)=>{a.push(`
  `+s.toString()+": "+Sn.toString(l))}),a.join(", ")}r.toString=e;function t(){return new wo(o=>o.toString())}r._new=t;function n(o,a){let s=new wo(l=>l.toString());for(let l=0,d=o.length;l<d;l=l+1)s.set(o[l],a[l]);return s}r.new1=n})(No||(No={}));var pi=class{toString(){return`SymbolData(id=${this.masterID}, overrides=[${No.toString(this.instanceOverrides)}])`}constructor(e,t){this.masterID=e,this.instanceOverrides=t}},Js=class{constructor(e,t){this.value=e,this.units=t}},el=class{constructor(e,t,n){this.family=e,this.style=t,this.postscript=n}},tl=class{constructor(e,t){this.type=e,this.value=t}},Au=class{constructor(e,t,n,r){this.suffix=e,this.imageType=t,this.constraint=n,this.contentsOnly=r}},Xo=class i{static DEFAULT_FOR_TESTS(){return new i("DEFAULT_FLOW_FOR_TESTS","default flow for tests",dn.FIRST_POSITION)}constructor(e,t,n){this.name=e,this.description=t,this.position=n}},Su=class Su{size(){switch(this.rotation){case"NONE":return this.nonRotatedSize;case"CCW_90":return this.nonRotatedSize.flipped()}return this.nonRotatedSize}canvasSpaceImageSize(e){let t=e.nonRotatedImageSize.divide(e.scaleFactor);switch(this.rotation){case"NONE":return t;case"CCW_90":return t.flipped()}return t}canvasSpaceTopLeftOffset(e){let t=e.nonRotatedOffset,n=e.nonRotatedImageSize.divide(e.scaleFactor),r=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return t;case"CCW_90":return new E(t.y(),n.x()-r.x()-t.x())}return t}canvasSpaceFramePresetSize(e){let t=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return t;case"CCW_90":return t.flipped()}return t}os(){return this.presetIdentifier==null||this.presetIdentifier==""?0:this.presetIdentifier.indexOf("APPLE")!=-1?this.presetIdentifier.indexOf("MACBOOK")!=-1?4:2:this.presetIdentifier.indexOf("GOOGLE")!=-1?1:this.presetIdentifier.indexOf("MICROSOFT")!=-1?5:(console.error(`${this.presetIdentifier} OS could not be inferred`),0)}toString(){return`PrototypeDevice(${this.type}, ${this.size()}, ${this.presetIdentifier}, ${this.rotation})`}toJSON(){return{type:this.type,size:{x:this.size().x(),y:this.size().y()},presetIdentifier:this.presetIdentifier,rotation:this.rotation}}constructor(e,t,n,r){this.type=e,this.nonRotatedSize=t,this.presetIdentifier=n,this.rotation=r}};Su.DEFAULT=new Su("NONE",new E(0,0),null,"NONE");var er=Su,Ro=class{constructor(){if(arguments.length==0)this.backgroundType="NONE",this.backgroundColor=C.new3(0,0,0,.25);else if(arguments.length==2){let e=arguments[0],t=arguments[1];this.backgroundType="NONE",this.backgroundColor=C.new3(0,0,0,.25),this.backgroundType=e,this.backgroundColor=t}}},Xn=class{constructor(){if(arguments.length==0)this._styleByID=null,this._styleByID=new Map;else if(arguments.length==1){let e=arguments[0];this._styleByID=null,this._styleByID=e}}_in(e){return this._styleByID.has(e)}styleByID1(e){return this._styleByID.get(e)}forEachStyle(e){for(let t of Array.from(this._styleByID.keys()))e(t,this._styleByID.get(t))}styleByID2(){return this._styleByID}forEachFillPaint(e,t){this.forEachStyle((n,r)=>{let o=Yo.get(r,92,null),a=null;if(o!=null&&(a=e.findStyle($.asStyleId(o))),a==null){let s=r!=null?$.asGUID(Yo.get(r,52,null)):null;a=e.findNode1(s)}if(a!=null){let s=a.fillPaints();s!=null&&t(s)}else if(Yo._in(r,59)){let s=$.asPaintList(Yo.get(r,59,null));s!=null&&t(s)}})}};var ss=(t=>(t[t.ONE_FONT_SIZE=0]="ONE_FONT_SIZE",t[t.MULTIPLE_FONT_SIZES=1]="MULTIPLE_FONT_SIZES",t))(ss||{}),pc=class{constructor(e,t,n){this.exitingTransitionRoot=e,this.swappedStablePath=t,this.hotspotInExitingTree=n}},mS;(e=>{function i(t){return Am[t]}e.RegionType_toString=i})(mS||(mS={}));var gS;(e=>{function i(t){return ss[t]}e.NumFontSizes_toString=i})(gS||(gS={}));function hc(i){return!i.has(84)||i.prototypeStartingPoint()==null?!1:i.prototypeStartingPoint().name!=""||i.prototypeStartingPoint().description!=""||i.prototypeStartingPoint().position!=null&&dn.isValid(i.prototypeStartingPoint().position)}var Ni=class i{constructor(e,t,n,r){this._numFontSizes=0,this._hyperlinkBoxes=null,this._usedEmojiCodepoints=null,this._usedEmojiImages=null,this._numFontSizes=e,this._hyperlinkBoxes=t,this._usedEmojiCodepoints=n,this._usedEmojiImages=r}hasMixedFontSizes(){return this._numFontSizes==1}hyperlinkBoxes(){return this._hyperlinkBoxes}usedEmojiCodepoints(){return this._usedEmojiCodepoints}usedEmojiImages(){return this._usedEmojiImages}static forTests(e){return new i(0,[],e,[])}};var yu=class{constructor(e,t,n,r){this.ax=0,this.bx=0,this.cx=0,this.cy=0,this.by=0,this.ay=0,this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by}_sampleCurveX(e){return((this.ax*e+this.bx)*e+this.cx)*e}_sampleCurveY(e){return((this.ay*e+this.by)*e+this.cy)*e}_sampleCurveDerivativeX(e){return(3*this.ax*e+2*this.bx)*e+this.cx}_sampleCurveDerivativeY(e){return(3*this.ay*e+2*this.by)*e+this.cy}_solveCurveX(e,t){let n=0,r=0,o=0,a=0,s=0;o=e;for(let l=0;l<8;l=l+1){if(a=this._sampleCurveX(o)-e,Math.abs(a)<t)return o;if(s=this._sampleCurveDerivativeX(o),Math.abs(s)<1e-6)break;o=o-a/s}if(n=0,r=1,o=e,o<n)return n;if(o>r)return r;for(;n<r;){if(a=this._sampleCurveX(o),Math.abs(a-e)<t)return o;e>a?n=o:r=o,o=(r-n)*.5+n}return o}solve(e,t){return this._sampleCurveY(this._solveCurveX(e,t))}getYDerivativeForXValue(e,t){let n=this._solveCurveX(e,t),r=this._sampleCurveDerivativeX(n);return Math.abs(r)>0?this._sampleCurveDerivativeY(n)/r:this._sampleCurveDerivativeY(n)}},bu=class{constructor(e,t){this._bezier=null,this._bezierInverse=null,this._durationSeconds=0,this._bezier=this.bezierForEasingFunction(e),this._bezierInverse=this.inverseBezierForEasingFunction(e),this._durationSeconds=t}bezierForEasingFunction(e){return e==null||e.length!=4?null:new yu(e[0],e[1],e[2],e[3])}inverseBezierForEasingFunction(e){return e==null||e.length!=4?null:new yu(e[1],e[0],e[3],e[2])}_solveEpsilon(e){return 1/(200*e)}getYValueForXValue(e){if(this._bezier==null)return e;let t=this._solveEpsilon(this._durationSeconds);return this._bezier.solve(e,t)}getDerivative(e,t){if(this._bezier==null)return 1;let n=this._solveEpsilon(this._durationSeconds);return this._bezier.getYDerivativeForXValue(e,n)}invert(e){if(this._bezier==null)return e;let t=this._solveEpsilon(this._durationSeconds);return this._bezierInverse.solve(e,t)}};var Sm=class{constructor(e,t,n,r){this.m_w0=0,this.m_zeta=0,this.m_wd=0,this.m_A=0,this.m_B=0,this.m_w0=Math.sqrt(t/e),this.m_zeta=n/(2*Math.sqrt(t*e)),this.m_zeta<1?(this.m_wd=this.m_w0*Math.sqrt(1-this.m_zeta*this.m_zeta),this.m_A=1,this.m_B=(this.m_zeta*this.m_w0+-r)/this.m_wd):(this.m_A=1,this.m_B=-r+this.m_w0)}solve(e){return this.m_zeta<1?e=Math.exp(-e*this.m_zeta*this.m_w0)*(this.m_A*Math.cos(this.m_wd*e)+this.m_B*Math.sin(this.m_wd*e)):e=(this.m_A+this.m_B*e)*Math.exp(-e*this.m_w0),1-e}solveInverse(e){let t=0,n=0,r=Math.PI/this.m_w0,o=this.solve(r),a=0,s=.001,l=15;for(let d=0;d<l;d=d+1){a=(e-n)/(o-n)*(r-t)+t;let c=this.solve(a);if(Math.abs(c-e)<s)return a;c>e?(t=a,n=c):(r=a,o=c)}return a}},Tu=class{constructor(e,t){this._spring=null,this._durationSeconds=0,this._spring=this.convertFunctionToUnitSpring(e),this._durationSeconds=t}convertFunctionToUnitSpring(e){return e==null||e.length!=4?null:new Sm(e[0],e[1],e[2],e[3])}getYValueForXValue(e){if(this._spring==null)return e;let t=e*this._durationSeconds;return this._spring.solve(t)}getDerivative(e,t){return this._spring==null?1:t}invert(e){return this._spring==null?e:this._spring.solveInverse(e)/this._durationSeconds}};var _S=(t=>(t[t.BEZIER=0]="BEZIER",t[t.SPRING=1]="SPRING",t))(_S||{}),Zo=class Zo{static cleanCache(){if(this.easingFunctionCache){let n=[];for(var e of this.easingFunctionCache.entries())e[1].deref()===void 0&&n.push(e[0]);for(var t of n)this.easingFunctionCache.delete(t)}}static makeEasingFunctionWithEasingType(e,t,n,r=!0){this.cleanCache();let o=null;if(this.easingFunctionCacheFinalizer&&r){o=this.createCacheKey(e,t,this.getAnimationType(n));let s=this.easingFunctionCache.get(o);if(s!==void 0)return s.deref()}let a=new Zo(e,t,n);return this.easingFunctionCacheFinalizer&&r&&(this.easingFunctionCache.set(o,new WeakRef(a)),this.easingFunctionCacheFinalizer.register(a,[o,this.easingFunctionCache])),a}static makeEasingFunction(e,t,n=!0){return this.makeEasingFunctionWithEasingType(e,t,null,n)}static createCacheKey(e,t,n){let r=[];for(var o of e)r.push(o.toFixed(2));return r.push(";"),r.push(t.toFixed(2)),r.push(n),r.join()}static getAnimationType(e){return e=="GENTLE_SPRING"||e=="SPRING_PRESET_ONE"||e=="SPRING_PRESET_TWO"||e=="SPRING_PRESET_THREE"||e=="CUSTOM_SPRING"?1:0}constructor(e,t,n){this._easingFunction=e,this._animationType=Zo.getAnimationType(n),this._durationSeconds=t,this._createAnimationUnit(this._easingFunction),this.bounds=Zo.boundsForEasingFunction(this._easingFunction)}_createAnimationUnit(e){this._animationType==0?this._animationFunction=new bu(e,this._durationSeconds):this._animationType==1&&(this._animationFunction=new Tu(e,this._durationSeconds))}get(e){return this._animationFunction.getYValueForXValue(e)}getDerivative(e,t){return this._animationFunction.getDerivative(e,t)}invert(e){return this._animationFunction.invert(e)}static boundsForEasingFunction(e){if(e==null)return Jn.FrozenRect_new3(U.fromMinAndMax(0,0,1,1));let t=ve.FrozenVector_new4(0,0),n=ve.FrozenVector_new4(e[0],e[1]),r=ve.FrozenVector_new4(e[2],e[3]),o=ve.FrozenVector_new4(1,1),a=t.clone(),s=o.clone(),l=t.negative().add1(n),d=t.subtract1(n.multiply(2)).add1(r),c=t.negative().add1(n.multiply(3)).subtract1(r.multiply(3)).add1(o),p=d.multiply1(d).subtract1(c.multiply1(l));if(p.x()>0){p.setX(Math.sqrt(p.x()));for(let u of[(-d.x()-p.x())/c.x(),(-d.x()+p.x())/c.x()])if(u>0&&u<1){let h=1-u,f=h*h*h*t.x()+3*h*h*u*n.x()+3*h*u*u*r.x()+u*u*u*o.x();a.setX(Math.min(a.x(),f)),s.setX(Math.max(s.x(),f))}}if(p.y()>0){p.setY(Math.sqrt(p.y()));for(let u of[(-d.y()-p.y())/c.y(),(-d.y()+p.y())/c.y()])if(u>0&&u<1){let h=1-u,f=h*h*h*t.y()+3*h*h*u*n.y()+3*h*u*u*r.y()+u*u*u*o.y();a.setY(Math.min(a.y(),f)),s.setY(Math.max(s.y(),f))}}return U.fromMinAndMax(a.x(),a.y(),s.x(),s.y())}static easingValuesForPreset(e){switch(e){case"IN_CUBIC":return[.42,0,1,1];case"OUT_CUBIC":return[0,0,.58,1];case"INOUT_CUBIC":return[.42,0,.58,1];case"LINEAR":return[0,0,1,1];case"IN_BACK_CUBIC":return[.3,-.05,.7,-.5];case"OUT_BACK_CUBIC":return[.45,1.45,.8,1];case"INOUT_BACK_CUBIC":return[.7,-.4,.4,1.4];case"CUSTOM_CUBIC":return[0,0,.58,1];case"GENTLE_SPRING":return[1,100,15,0];case"SPRING_PRESET_ONE":return[1,300,20,0];case"SPRING_PRESET_TWO":return[1,600,15,0];case"SPRING_PRESET_THREE":return[1,80,20,0];case"CUSTOM_SPRING":return[1,100,15,0]}return[0,0,.58,1]}};typeof FinalizationRegistry=="function"?(Zo.easingFunctionCache=new Map,Zo.easingFunctionCallbackCleanup=e=>{e[1].delete(e[0])},Zo.easingFunctionCacheFinalizer=new FinalizationRegistry(Zo.easingFunctionCallbackCleanup)):(Zo.easingFunctionCache=null,Zo.easingFunctionCallbackCleanup=null,Zo.easingFunctionCacheFinalizer=null);var Vr=Zo,fS;(e=>{function i(t){return _S[t]}e.AnimationType_toString=i})(fS||(fS={}));var kn;(a=>{function i(s){return s=="PUSH_FROM_LEFT"||s=="PUSH_FROM_RIGHT"||s=="PUSH_FROM_TOP"||s=="PUSH_FROM_BOTTOM"}a.isPush=i;function e(s){return s=="MOVE_FROM_LEFT"||s=="MOVE_FROM_RIGHT"||s=="MOVE_FROM_TOP"||s=="MOVE_FROM_BOTTOM"}a.isMove=e;function t(s){return s=="SLIDE_FROM_LEFT"||s=="SLIDE_FROM_RIGHT"||s=="SLIDE_FROM_TOP"||s=="SLIDE_FROM_BOTTOM"}a.isSlide=t;function n(s){return s=="MOVE_OUT_TO_LEFT"||s=="MOVE_OUT_TO_RIGHT"||s=="MOVE_OUT_TO_TOP"||s=="MOVE_OUT_TO_BOTTOM"}a.isMoveOut=n;function r(s){return s=="SLIDE_OUT_TO_LEFT"||s=="SLIDE_OUT_TO_RIGHT"||s=="SLIDE_OUT_TO_TOP"||s=="SLIDE_OUT_TO_BOTTOM"}a.isSlideOut=r;function o(s){return i(s)||e(s)||n(s)||t(s)||r(s)}a.supportsSmartAnimate=o})(kn||(kn={}));var $o=class $o{constructor(e,t,n,r,o){this._id=null,this._event=null,this._actions=null,this._allActions=null,this._isDeleted=!1,this._stateManagementVersion=0,this._hoverLastHandledFrameNum=-1,this._id=e,this._event=t,this._actions=n,this._isDeleted=r,this._stateManagementVersion=o,this._allActions=this.getAllActions()}getAllActions(){let e=[];for(let t of this.actions())if(e.push(t),t.connectionType()=="CONDITIONAL")for(let n of t.conditionalActions())for(let r of n.actions())e.push(r);return e}id(){return this._id!=null?this._id:ne.invalid()}event(){return this._event!=null?this._event:eo.createDefault()}action(){return this._actions!=null&&this._actions.length!=0?new Se(this._actions[0]):null}actions(){return this._actions!=null?this._actions:[]}allActions(){return this._allActions!=null?this._allActions:[]}isDeleted(){return this._isDeleted}stateManagementVersion(){return this._stateManagementVersion}withEvent(e){return new $o(this._id,e,this._actions,this._isDeleted,this._stateManagementVersion)}withActions(e){return new $o(this._id,this._event,e,this._isDeleted,this._stateManagementVersion)}withStateManagementVersion(e){return new $o(this._id,this._event,this._actions,this._isDeleted,e)}isValid(){return this.event().interactionType()=="NONE"||this._actions==null||this._actions.length==0?!1:this.action()!=null&&this.action().value.connectionType()!="NONE"}apply(e){let t=this.action(),n=e.action(),r=[];t!=null&&n!=null?r=[t.value.apply(n.value)]:t!=null?r=[t.value]:n!=null&&(r=[n.value]);let o=this._event,a=e._event,s=null;return o!=null&&a!=null?s=o.apply(a):o!=null?s=o:a!=null&&(s=a),new $o(this._id,s,r,e._isDeleted,e._stateManagementVersion)}setHoverLastHandledFrameNum(e){this._hoverLastHandledFrameNum=e}getHoverLastHandledFrameNum(){return this._hoverLastHandledFrameNum}debugString(){let e="";return e+="PrototypeInteraction(",this._id!=null&&(e+=`id: ${this._id},`),this._event!=null&&(e+=`event: ${this._event.debugString()},`),this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=`isDeleted: ${this._isDeleted},`,e+=")",e}getAllActionsWithSpecificConnectionType(e){let t=[];for(let n of this.actions())if(n.connectionType()==e)t.push(n);else if(n.connectionType()=="CONDITIONAL")for(let r of n.conditionalActions())for(let o of r.actions())n.connectionType()==e&&t.push(n);return t}getAllActionsWithSpecificTransitionType(e){let t=[];for(let n of this.actions())if(n.transitionType()==e)t.push(n);else if(n.connectionType()=="CONDITIONAL")for(let r of n.conditionalActions())for(let o of r.actions())n.transitionType()==e&&t.push(n);return t}getAllValidTransitionActionsInInteraction(){let e=[];for(let t of this.actions())if(ne.isValid(t.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(t.connectionType())!=-1)e.push(t);else if(t.connectionType()=="CONDITIONAL")for(let n of t.conditionalActions())for(let r of n.actions())ne.isValid(t.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(t.connectionType())!=-1&&e.push(t);return e}interactionContainsTransitionAction(){for(let e of this.actions()){if(ne.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0;if(e.connectionType()=="CONDITIONAL"){for(let t of e.conditionalActions())for(let n of t.actions())if(ne.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0}}return!1}interactionContainsSpecificConnectionTypeAction(e){for(let t of this.actions()){if(t.connectionType()==e)return!0;if(t.connectionType()=="CONDITIONAL"){for(let n of t.conditionalActions())for(let r of n.actions())if(t.connectionType()==e)return!0}}return!1}getFirstActionInInteractionWithSpecificNavigation(e){for(let t of this.actions())if(t.navigationType()==e)return t;return null}static createDefault(){return new $o(ne.invalid(),eo.createDefault(),[],!1,0)}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:ne.equals(e._id,t._id)&&eo.equals(e._event,t._event)&&ce.List_equalsWithComparison(e._actions,t._actions,(n,r)=>tr.equals(n,r))&&e._isDeleted==t._isDeleted&&e._stateManagementVersion==t._stateManagementVersion}static applyInteractions(e,t){if(e==null&&t==null)return $o.EMPTY_LIST;if(e==null)return t;if(t==null)return e;let n=e.slice();return t.forEach(r=>{let o=!1;for(let a=0,s=e.length;a<s;a=a+1){let l=e[a];if(ne.equals(l.id(),r.id())){n[a]=l.apply(r),o=!0;break}}o||n.push(r)}),n.filter(r=>!r._isDeleted).slice()}static whichAncestorToSwapState(e,t,n){let r=e!=null?e.scene().findNode1(t):null,o=r==null?void 0:r.findContainingStateGroupOrSelf();if(o==null)return null;let a=e;for(;a!=null;){let s=null;a.type()=="INSTANCE"?s=e.scene().findNode1(a.symbolID()):n==$o.StateSwapPolicy.INCLUDE_SYMBOLS&&a.type()=="SYMBOL"&&(s=a);let l=s==null?void 0:s.findContainingStateGroupOrSelf();if(o==l)return a;a=a.parent()}return null}static whichInstanceToSwap(e,t){return $o.whichAncestorToSwapState(e,t,$o.StateSwapPolicy.INSTANCES_ONLY)}};$o.EMPTY_LIST=[];var jt=$o;(t=>{let i;(o=>(o[o.INCLUDE_SYMBOLS=0]="INCLUDE_SYMBOLS",o[o.INSTANCES_ONLY=1]="INSTANCES_ONLY"))(i=t.StateSwapPolicy||(t.StateSwapPolicy={}));let e;(r=>{function n(o){return t.StateSwapPolicy[o]}r.StateSwapPolicy_toString=n})(e=t.in_StateSwapPolicy||(t.in_StateSwapPolicy={}))})(jt||(jt={}));var ls=class ls{interactionType(){let e=this._interactionType!=null?this._interactionType:"ON_CLICK";return e=="NONE"?"ON_CLICK":e}interactionMaintained(){return this._interactionMaintained!=null?this._interactionMaintained.value:!1}interactionDuration(){return this._interactionDuration!=null&&this._interactionDuration.value>=0?this._interactionDuration.value:.3}keyTrigger(){return this._keyTrigger!=null?this._keyTrigger:{}}transitionTimeout(){return this._transitionTimeout!=null&&this._transitionTimeout.value>=0?this._transitionTimeout.value:.8}mediaHitTime(){return this._mediaHitTime!=null?this._mediaHitTime.value:0}withInteractionType(e){return new ls(e,this._interactionMaintained,this._interactionDuration,this._keyTrigger,this._transitionTimeout,this._mediaHitTime)}apply(e){let t=this._interactionType,n=this._interactionMaintained,r=this._interactionDuration,o=this._keyTrigger,a=this._transitionTimeout,s=this._mediaHitTime;return e._interactionType!=null&&(t=e._interactionType),e._interactionMaintained!=null&&(n=e._interactionMaintained),e._interactionDuration!=null&&(r=e._interactionDuration),e._keyTrigger!=null&&(o=e._keyTrigger),e._transitionTimeout!=null&&(a=e._transitionTimeout),e._mediaHitTime!=null&&(s=e._mediaHitTime),new ls(t,n,r,o,a,s)}debugString(){let e="";return e+="PrototypeEvent(",this._interactionType!=null&&(e+=`interactionType: ${this._interactionType},`),this._interactionMaintained!=null&&(e+=`interactionMaintained: ${this._interactionMaintained.value},`),this._interactionDuration!=null&&(e+=`interactionDuration: ${this._interactionDuration.value},`),this._keyTrigger!=null&&(e+=`keyTrigger: ${JSON.stringify(this._keyTrigger)},`),this._transitionTimeout!=null&&(e+=`transitionTimeout: ${this._transitionTimeout.value},`),this._mediaHitTime!=null&&(e+=`mediaHitTime: ${this._mediaHitTime.value},`),e+=")",e}static createDefault(){let e={};return e.keyCodes=[],e.triggerDevice="KEYBOARD",new ls("NONE",new Se(!1),new Se(0),e,new Se(0),new Se(0))}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:e._interactionType==t._interactionType&&Se.equals(e._interactionMaintained,t._interactionMaintained)&&Se.equals(e._interactionDuration,t._interactionDuration)&&ym.equals(e._keyTrigger,t._keyTrigger)&&Se.equals(e._transitionTimeout,t._transitionTimeout)}constructor(e,t,n,r,o,a){this._interactionType=e,this._interactionMaintained=t,this._interactionDuration=n,this._keyTrigger=r,this._transitionTimeout=o,this._mediaHitTime=a}};ls.NULL_EVENT=new ls(null,null,null,null,null,null);var eo=ls,mc=class mc{constructor(){if(arguments.length==1){let e=arguments[0];this._actions=null,this._condition=null,this._actions=e,this._condition=""}else if(arguments.length==2){let e=arguments[0],t=arguments[1];this._actions=null,this._condition=null,this._actions=e,this._condition=t}}actions(){return this._actions}condition(){return this._condition}debugString(){let e="";return e+="ConditionalActions(",this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=")",e}static createDefault(){return new mc([])}static equals(e,t){if(e==null!=(t==null))return!1;if(e==null)return!0;let n=ce.List_equalsWithComparison(e._actions,t._actions,(o,a)=>tr.equals(o,a)),r=e._condition==t._condition;return n&&r}};mc.NULL_CONDITIONAL_ACTIONS=new mc(null);var gc=mc,ur=class ur{constructor(e,t,n,r,o,a,s,l,d,c,p,u,h,f,_,m,A,y,S,g,b,T){this._transitionNodeID=null,this._transitionType=null,this._transitionDuration=null,this._easingType=null,this._easingFunctionValues=null,this._transitionShouldSmartAnimate=null,this._connectionType=null,this._connectionURL=null,this._overlayRelativePosition=null,this._navigationType=null,this._transitionPreserveScroll=null,this._extraScrollOffset=null,this._mediaAction=null,this._transitionResetVideoPosition=null,this._openUrlInNewTab=null,this._mediaSkipToTime=null,this._mediaSkipByAmount=null,this._transitionResetScrollPosition=null,this._conditionalActions=null,this._transitionResetInteractiveComponents=null,this._targetVariableID=null,this._targetVariableData=null,this.easingFunction=null,this._transitionNodeID=e,this._transitionType=t,this._transitionDuration=n,this._easingType=r,this._easingFunctionValues=o,this._transitionShouldSmartAnimate=a,this._connectionType=s,this._connectionURL=l,this._overlayRelativePosition=d,this._navigationType=c,this._transitionPreserveScroll=p,this.easingFunction=this.easingFunctionFromAction(),this._extraScrollOffset=u,this._mediaAction=h,this._transitionResetVideoPosition=f,this._openUrlInNewTab=_,this._mediaSkipToTime=m,this._mediaSkipByAmount=A,this._transitionResetScrollPosition=y,this._conditionalActions=S,this._transitionResetInteractiveComponents=g,this._targetVariableID=b,this._targetVariableData=T}transitionNodeID(){return this._connectionType==null||this.connectionType()=="INTERNAL_NODE"||this.connectionType()=="UPDATE_MEDIA_RUNTIME"?this._transitionNodeID!=null?this._transitionNodeID:ne.invalid():ne.invalid()}transitionType(){let e=this._transitionType!=null?this._transitionType:"INSTANT_TRANSITION";return this.navigationType()=="OVERLAY"&&(e=="FADE"||kn.isPush(e)||kn.isSlide(e))?"INSTANT_TRANSITION":e}transitionDuration(){return this.transitionType()=="INSTANT_TRANSITION"?0:this._transitionDuration!=null&&this._transitionDuration.value>=0?this._transitionDuration.value:.3}easingType(){return this._easingType!=null?this._easingType:"OUT_CUBIC"}easingFunctionValues(){switch(this.easingType()){case"CUSTOM_CUBIC":case"GENTLE_SPRING":case"SPRING_PRESET_ONE":case"SPRING_PRESET_TWO":case"SPRING_PRESET_THREE":case"CUSTOM_SPRING":return this._easingFunctionValues!=null?this._easingFunctionValues:Vr.easingValuesForPreset(this.easingType());default:break}return Vr.easingValuesForPreset(this.easingType())}transitionShouldSmartAnimate(){return this._transitionShouldSmartAnimate!=null?this._transitionShouldSmartAnimate.value:!1}connectionType(){return this._connectionType!=null?this._connectionType:"NONE"}connectionURL(){return this.connectionType()=="URL"?this._connectionURL:null}overlayRelativePosition(){return this._overlayRelativePosition!=null?this._overlayRelativePosition:E.new2()}navigationType(){return this._navigationType!=null?this._navigationType:"NAVIGATE"}mediaAction(){return this._mediaAction!=null?this._mediaAction:"PLAY"}transitionPreserveScroll(){return this.transitionType()=="SMART_ANIMATE"||kn.supportsSmartAnimate(this.transitionType())&&this.transitionShouldSmartAnimate()?!0:kn.isSlide(this.transitionType())||kn.isPush(this.transitionType())||kn.isMove(this.transitionType())?!1:this._transitionPreserveScroll!=null?this._transitionPreserveScroll.value:!1}transitionResetVideoPosition(){return this._transitionResetVideoPosition!=null?this._transitionResetVideoPosition.value:!1}transitionResetScrollPosition(){return this._transitionResetScrollPosition!=null?this._transitionResetScrollPosition.value:!1}transitionResetInteractiveComponents(){return this._transitionResetInteractiveComponents!=null?this._transitionResetInteractiveComponents.value:!1}openUrlInNewTab(){return this._openUrlInNewTab!=null?this._openUrlInNewTab.value:!0}extraScrollOffset(){return this._extraScrollOffset!=null?this._extraScrollOffset:E.new2()}mediaSkipToTime(){return this._mediaSkipToTime!=null&&this._mediaSkipToTime.value>=0?this._mediaSkipToTime.value:0}mediaSkipByAmount(){return this._mediaSkipByAmount!=null&&this._mediaSkipByAmount.value>=0?this._mediaSkipByAmount.value:5}conditionalActions(){return this._conditionalActions!=null?this._conditionalActions:[]}targetVariableID(){return this._targetVariableID}targetVariableData(){return this._targetVariableData}withTransitionNodeID(e){return new ur(e,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionType(e){return new ur(this._transitionNodeID,e,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionShouldSmartAnimate(e){return new ur(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,new Se(e),this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withConnectionType(e){return new ur(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,e,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withConnectionURL(e){return new ur(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,e,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withOverlayRelativePosition(e){return new ur(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,e,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withNavigationType(e){return new ur(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,e,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionPreserveScroll(e){return new ur(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,new Se(e),this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withMediaAction(e){return new ur(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,new Se(this.transitionPreserveScroll()),this._extraScrollOffset,e,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionResetVideoPosition(e){return new ur(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,new Se(e),this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withOpenUrlInNewTab(e){return new ur(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,new Se(e),this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionResetInteractiveComponents(e){return new ur(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,new Se(e),this._targetVariableID,this._targetVariableData)}withTransitionResetScrollPosition(e){return new ur(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,new Se(e),this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}easingFunctionFromAction(){var e;return Vr.makeEasingFunctionWithEasingType(this.easingFunctionValues(),this.transitionDuration(),this._easingType,(e=X)==null?void 0:e.viewerAnimationEasingCache())}apply(e){let t=this._transitionNodeID,n=this._transitionType,r=this._transitionDuration,o=this._easingType,a=this._easingFunctionValues,s=this._transitionShouldSmartAnimate,l=this._connectionType,d=this._connectionURL,c=this._overlayRelativePosition,p=this._navigationType,u=this._transitionPreserveScroll,h=this._extraScrollOffset,f=this._mediaAction,_=this._transitionResetVideoPosition,m=this._openUrlInNewTab,A=this._mediaSkipToTime,y=this._mediaSkipByAmount,S=this._transitionResetScrollPosition,g=this._conditionalActions,b=this._transitionResetInteractiveComponents,T=this._targetVariableID,I=this._targetVariableData;return e._transitionNodeID!=null&&(t=e._transitionNodeID),e._transitionType!=null&&(n=e._transitionType),e._transitionDuration!=null&&(r=e._transitionDuration),e._easingType!=null&&(o=e._easingType),e._easingFunctionValues!=null&&(a=e._easingFunctionValues),e._transitionShouldSmartAnimate!=null&&(s=e._transitionShouldSmartAnimate),e._connectionType!=null&&(l=e._connectionType),e._connectionURL!=null&&(d=e._connectionURL),e._overlayRelativePosition!=null&&(c=e._overlayRelativePosition),e._navigationType!=null&&(p=e._navigationType),e._transitionPreserveScroll!=null&&(u=e._transitionPreserveScroll),e._extraScrollOffset!=null&&(h=e._extraScrollOffset),e._mediaAction!=null&&(f=e._mediaAction),e._transitionResetVideoPosition!=null&&(_=e._transitionResetVideoPosition),e._openUrlInNewTab!=null&&(m=e._openUrlInNewTab),e._mediaSkipToTime!=null&&(A=e._mediaSkipToTime),e._mediaSkipByAmount!=null&&(y=e._mediaSkipByAmount),e._transitionResetScrollPosition!=null&&(S=e._transitionResetScrollPosition),e._conditionalActions!=null&&(g=e._conditionalActions),e._transitionResetInteractiveComponents!=null&&(b=e._transitionResetInteractiveComponents),e._targetVariableID!=null&&(T=e._targetVariableID),e._targetVariableData!=null&&(I=e._targetVariableData),new ur(t,n,r,o,a,s,l,d,c,p,u,h,f,_,m,A,y,S,g,b,T,I)}debugString(){let e="";return e+="PrototypeAction(",this._transitionNodeID!=null&&(e+=`transitionNodeID: ${this._transitionNodeID},`),this._transitionType!=null&&(e+=`transitionType: ${this._transitionType},`),this._transitionDuration!=null&&(e+=`transitionDuration: ${this._transitionDuration.value},`),this._easingType!=null&&(e+=`easingType: ${this._easingType},`),this._easingFunctionValues!=null&&(e+=`easingFunctionValues: ${this._easingFunctionValues.map(t=>t.toString()).join(",")},`),this._transitionShouldSmartAnimate!=null&&(e+=`transitionShouldSmartAnimate: ${this._transitionShouldSmartAnimate.value},`),this._connectionType!=null&&(e+=`connectionType: ${this._connectionType},`),this._connectionURL!=null&&(e+=`connectionURL: ${Wn.string_toString(this._connectionURL)},`),this._overlayRelativePosition!=null&&(e+=`overlayRelativePosition: ${this._overlayRelativePosition},`),this._navigationType!=null&&(e+=`navigationType: ${this._navigationType},`),this._transitionPreserveScroll!=null&&(e+=`transitionPreserveScroll: ${this._transitionPreserveScroll.value},`),this._extraScrollOffset!=null&&(e+=`extraScrollOffset: ${this._extraScrollOffset},`),this._mediaAction!=null&&(e+=`mediaAction: ${this._mediaAction},`),this._transitionResetVideoPosition!=null&&(e+=`transitionResetVideoPosition: ${this._transitionResetVideoPosition.value},`),this._openUrlInNewTab!=null&&(e+=`openUrlInNewTab: ${this._openUrlInNewTab.value},`),this._mediaSkipToTime!=null&&(e+=`mediaSkipToTime: ${this._mediaSkipToTime.value},`),this._mediaSkipByAmount!=null&&(e+=`mediaSkipByAmount: ${this._mediaSkipByAmount.value},`),this._transitionResetScrollPosition!=null&&(e+=`transitionResetScrollPosition: ${this._transitionResetScrollPosition.value},`),this._conditionalActions!=null&&(e+=`conditionalActions: ${this._conditionalActions[0].debugString()},`),this._transitionResetInteractiveComponents!=null&&(e+=`transitionResetInteractiveComponents: ${this._transitionResetInteractiveComponents.value},`),e+=")",e}static createDefault(){return new ur(ne.invalid(),"INSTANT_TRANSITION",new Se(0),"IN_CUBIC",Vr.easingValuesForPreset("IN_CUBIC"),new Se(!1),"NONE",null,new E(0,0),"NAVIGATE",new Se(!1),new E(0,0),"PLAY",new Se(!1),new Se(!0),new Se(0),new Se(5),new Se(!1),[],new Se(!1),null,null)}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:ne.equals(e._transitionNodeID,t._transitionNodeID)&&e._transitionType==t._transitionType&&Se.equals(e._transitionDuration,t._transitionDuration)&&e._easingType==t._easingType&&ce.List_equalsWithComparison(e._easingFunctionValues,t._easingFunctionValues,(n,r)=>Math.abs(n-r)<1e-6)&&Se.equals(e._transitionShouldSmartAnimate,t._transitionShouldSmartAnimate)&&e._connectionType==t._connectionType&&e._connectionURL==t._connectionURL&&E.equals_(e._overlayRelativePosition,t._overlayRelativePosition)&&e._navigationType==t._navigationType&&Se.equals(e._transitionPreserveScroll,t._transitionPreserveScroll)&&Se.equals(e._transitionResetVideoPosition,t._transitionResetVideoPosition)&&Se.equals(e._openUrlInNewTab,t._openUrlInNewTab)&&E.equals_(e._extraScrollOffset,t._extraScrollOffset)&&e._mediaAction==t._mediaAction&&Se.equals(e._mediaSkipToTime,t._mediaSkipToTime)&&Se.equals(e._mediaSkipByAmount,t._mediaSkipByAmount)&&Se.equals(e._transitionResetScrollPosition,t._transitionResetScrollPosition)&&ce.List_equalsWithComparison(e._conditionalActions,t._conditionalActions,(n,r)=>gc.equals(n,r))&&Se.equals(e._transitionResetInteractiveComponents,t._transitionResetInteractiveComponents)}};ur.NULL_ACTION=new ur(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[],null,null,null);var tr=ur,ym;(e=>{function i(t,n){return t==null!=(n==null)?!1:t==null?!0:ce.List_equalsWithComparison(t.keyCodes,n.keyCodes,(r,o)=>r==o)&&t.triggerDevice==n.triggerDevice}e.equals=i})(ym||(ym={}));var Jo=class i{constructor(e,t,n,r,o,a,s,l){this._styleOverrideTable=null,this._characters=null,this._lines=null,this._characterStyleIds=null,this._numFontSizesDEPRECATED=0,this._hyperlinkBoxesDEPRECATED=null,this._usedEmojiCodepointsDEPRECATED=null,this._usedEmojiImagesDEPRECATED=null,this._styleOverrideTable=e,this._numFontSizesDEPRECATED=t,this._hyperlinkBoxesDEPRECATED=n,this._characters=r,this._lines=o,this._characterStyleIds=a,this._usedEmojiCodepointsDEPRECATED=s,this._usedEmojiImagesDEPRECATED=l}characters(){return this._characters}characterStyleIds(){return this._characterStyleIds}lines(){return this._lines}styleOverrideTable(){return this._styleOverrideTable}hasMixedFontSizesDEPRECATED(){return this._numFontSizesDEPRECATED==1}hyperlinkBoxesDEPRECATED(){return this._hyperlinkBoxesDEPRECATED}usedEmojiCodepointsDEPRECATED(){return this._usedEmojiCodepointsDEPRECATED}usedEmojiImagesDEPRECATED(){return this._usedEmojiImagesDEPRECATED}static forTests1(){return new i(new Xn,0,[],"",[],[],[],[])}static forTests2(e){return new i(e,0,[],"",[],[],[],[])}static forTests3(e){return new i(new Xn,0,[],"",[],[],e,[])}},nl=class{constructor(e){this.paintOverrides=null,this.styleOverrideTable=null,this.paintOverrides=new ho(e),this.styleOverrideTable=e}};var $;(rc=>{function i(K){try{if(t(K))return K.toString();if(n(K))return x(K).toString();if(r(K))return F(K).toString();if(s(K))return Wn.string_toString(K);if(o(K))return K.toString();if(ts(K))return M(K).toString();if(l(K))return K.toString();if(h(K)){let mn=K;return`${mn.family} ${mn.style}`}if(f(K)){let mn=K;return`${mn.value} ${mn.units}`}if(_(K))return K.toString();if(b(K))return K.toString();if(m(K))return K.toString();if(d(K))return K.length===0?"[]":K[0]instanceof jt?`[${K.map(wv=>wv.debugString()).join(",")}]`:"[...]"}catch{}return"?"}rc.toString=i;function e(K,mn){return t(K)&&t(mn)?K.equals1(mn):l(K)&&l(mn)?K.equals(mn):(n(K)||r(K)||s(K)||ts(K),K==mn)}rc.equals=e;function t(K){return K instanceof oe}rc.isAffineTransform=t;function n(K){return typeof K=="boolean"}rc.isBool=n;function r(K){return typeof K=="number"}rc.isDouble=r;function o(K){return K instanceof Mt}rc.isGUIDPath=o;function a(K){return K.guid!==void 0&&K.ref!==void 0}rc.isStyleId=a;function s(K){return typeof K=="string"}rc.isString=s;function l(K){return K instanceof E}rc.isVector=l;function d(K){return K instanceof Array}rc.isList=d;function c(K){return K instanceof Jo}rc.isTextData=c;function p(K){return K instanceof Ni}rc.isDerivedTextData=p;function u(K){return K instanceof nl}rc.isVectorData=u;function h(K){return K instanceof el}rc.isFontName=h;function f(K){return K instanceof Js}rc.isNumber=f;function _(K){return K instanceof qn}rc.isParentIndex=_;function m(K){return K instanceof Dn}rc.isGeometry=m;function A(K){return typeof K=="string"}rc.isGUID=A;function y(K){return typeof K=="string"}rc.isScrollDirection=y;function S(K){return K instanceof er}rc.isPrototypeDevice=S;function g(K){return K instanceof Xo}rc.isPrototypeStartingPoint=g;function b(K){return K instanceof pi}rc.isSymbolData=b;function T(K){return typeof K=="string"}rc.isPosition=T;function I(K){return typeof K=="string"}rc.isScrollBehavior=I;function O(K){return typeof K=="string"}rc.isNavigationType=O;function w(K){return typeof K=="string"}rc.isOverlayPositionType=w;function P(K){return typeof K=="string"}rc.isOverlayBackgroundInteraction=P;function H(K){return K instanceof Ro}rc.isOverlayBackgroundAppearance=H;function re(K){return typeof K=="string"}rc.isShapeWithTextType=re;function q(K){return K.autoplay!==void 0&&K.mediaLoop!==void 0&&K.muted!==void 0}rc.isVideoPlayback=q;function W(K){return K}rc.asAffineTransform=W;function x(K){return!!K}rc.asBool=x;function F(K){return+K}rc.asDouble=F;function k(K){return K}rc.asGUIDPath=k;function G(K){return K}rc.asStyleId=G;function M(K){return K|0}rc.asInt=M;function Q(K){return K}rc.asString=Q;function Y(K,mn){return s(K)?K:mn}rc.asStringEnum=Y;function B(K){return K}rc.asVector=B;function te(K){return K}rc.asPaintList=te;function j(K){return K}rc.asPaintData=j;function ie(K){return K}rc.asEffectList=ie;function de(K){return K}rc.asExportSettingsList=de;function tt(K){return K}rc.asTextData=tt;function bt(K){return K}rc.asDerivedTextData=bt;function ht(K){return K}rc.asVectorData=ht;function Ft(K){return K}rc.asFontName=Ft;function Gt(K){return K}rc.asNumber=Gt;function Ut(K){return K}rc.asParentIndex=Ut;function vt(K){return K}rc.asGeometry=vt;function Vn(K){return K}rc.asGUID=Vn;function Vt(K){return K}rc.asSymbolData=Vt;function sn(K){return K}rc.asScrollDirection=sn;function xt(K){return K}rc.asPrototypeStartingPoint=xt;function mt(K){return K}rc.asPrototypeDevice=mt;function _t(K){return K}rc.asPosition=_t;function Ze(K){return K}rc.asScrollBehavior=Ze;function Ct(K){return K}rc.asNavigationType=Ct;function Ht(K){return K}rc.asOverlayPositionType=Ht;function xe(K){return K}rc.asOverlayBackgroundInteraction=xe;function Dt(K){return K}rc.asOverlayBackgroundAppearance=Dt;function An(K){return K}rc.asArcData=An;function hn(K){return K}rc.asShapeWithTextType=hn;function Xt(K){return K}rc.asPrototypeInteractionList=Xt;function Me(K){return K}rc.asVideoPlayback=Me;function st(K){return K}rc.new1=st;function kt(K){return K!=null?K.clone():null}rc.new2=kt;function Ne(K){return K}rc.new3=Ne;function We(K){return K}rc.new4=We;function nt(K){return K}rc.new5=nt;function v(K){return K}rc.new6=v;function R(K){return K}rc.new7=R;function z(K){return K}rc.new8=z;function Z(K){return K}rc.new9=Z;function ae(K){return K!=null?K.clone():null}rc.new10=ae;function pe(K){return K}rc.new11=pe;function Te(K){return K!=null?K.slice():null}rc.new12=Te;function De(K){return K!=null?K.map(mn=>mn.clone()):null}rc.new13=De;function St(K){return K!=null?K.map(mn=>mn.clone()):null}rc.new14=St;function ot(K){return K!=null?K.map(mn=>mn.clone()):null}rc.new15=ot;function Ge(K){return K!=null?K.map(mn=>mn.clone()):null}rc.new16=Ge;function D(K){return K}rc.new17=D;function V(K){return K!=null?K.slice():null}rc.new18=V;function J(K){return K!=null?K.map(mn=>mn.clone()):null}rc.new19=J;function le(K){return K}rc.new20=le;function ue(K){return K}rc.new21=ue;function ge(K){return K}rc.new22=ge;function fe(K){return K}rc.new23=fe;function Re(K){return K}rc.new24=Re;function me(K){return K}rc.new25=me;function Ae(K){return K}rc.new26=Ae;function qe(K){return K}rc.new27=qe;function Pe(K){return K}rc.new28=Pe;function Ve(K){return K}rc.new29=Ve;function lt(K){return K}rc.new30=lt;function He(K){return K}rc.new31=He;function Je(K){return K}rc.new32=Je;function ct(K){return K}rc.new33=ct;function Ue(K){return K}rc.new34=Ue;function ee(K){return K}rc.new35=ee;function zn(K){return K}rc.new36=zn;function xn(K){return K}rc.new37=xn;function ao(K){return K}rc.new38=ao;function Zi(K){return K}rc.new39=Zi;function Wo(K){return K}rc.new40=Wo;function ci(K){return K}rc.new41=ci;function Aa(K){return K}rc.new42=Aa;function Sa(K){return K}rc.new43=Sa;function qs(K){return K}rc.new44=qs;function NN(K){return K}rc.new45=NN;function RN(K){return K}rc.new46=RN;function ON(K){return K}rc.new47=ON;function FN(K){return K}rc.new48=FN;function xN(K){return K}rc.new49=xN;function PN(K){return K}rc.new50=PN,rc.ZERO_VECTOR=ve.FrozenVector_new1(),rc.IDENTITY_TRANSFORM=Nt.FrozenAffineTransform_new1(),rc.EMPTY_PAINT_LIST=[],rc.EMPTY_EFFECT_LIST=[],rc.DEFAULT_ARC_DATA={startingAngle:0,endingAngle:2*Math.PI,innerRadius:0}})($||($={}));var $t=class i{static getEventEmitter(){return i._eventEmitter||(i._eventEmitter=new i),i._eventEmitter}constructor(){this._callbacks=new Map,this.on=(e,t)=>{ce.List_appendOne(this._list(e),t)},this.off=(e,t)=>{ce.List_removeOne(this._list(e),t)},this.trigger=(e,t)=>{let n=this._list(e).slice();for(let r of n)r(t)}}_list(e){return this._callbacks.has(e)?this._callbacks.get(e):(this._callbacks.set(e,[]),this._callbacks.get(e))}};(t=>{class i{constructor(){this._emitter=t.getEventEmitter()}handleAction(r,o){switch(r){case 5:{this._emitter.trigger("mirror-tap",null);break}case 6:{this._emitter.trigger("canvasMouseDown",$.asVector(o).toJSON());break}case 7:{this._emitter.trigger("canvasMouseMove",$.asVector(o).toJSON());break}case 8:{this._emitter.trigger("canvasMouseDrag",$.asVector(o).toJSON());break}case 9:{this._emitter.trigger("canvasMouseUp",$.asVector(o).toJSON());break}case 10:{this._emitter.trigger("canvasTouchDown",$.asVector(o).toJSON());break}}}}t.ActionHandler=i;class e{constructor(r){this._emitter=t.getEventEmitter();this._state=r,this._visible=!1}onFrame(){let r=this._state.baseScreenNode()!=null;this._visible!=r&&(this._visible=r,this._emitter.trigger("baseScreenVisibilityChange",this._visible))}}t.AppHandler=e})($t||($t={}));var Un=class{static didEncounterNestedBBInvisible(){this.encounteredNestedBBInvisible||(this.encounteredNestedBBInvisible=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterNestedBBNotInDirtyNodes(){this.encounteredNestedBBNotInDirtyNodes||(this.encounteredNestedBBNotInDirtyNodes=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterRoundedRectOptimization(){this.encounteredRoundedRectOptimization||(this.encounteredRoundedRectOptimization=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterDebounceScrollHover(){this.encounteredDebounceScrollHover||(this.encounteredDebounceScrollHover=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterFramebufferSwitchBudget(){this.encounteredFramebufferSwitchBudget||(this.encounteredFramebufferSwitchBudget=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterSmartAnimateCacheTransform(){this.encounteredSmartAnimateCacheTransform||(this.encounteredSmartAnimateCacheTransform=!0),this.logIfWithinLoggingTimeFrame()}static didEncounterCullTreesDuringTilePrioritization(){this.encounteredCullTreesDuringTilePrioritization||(this.encounteredCullTreesDuringTilePrioritization=!0),this.logIfWithinLoggingTimeFrame()}static logIfWithinLoggingTimeFrame(){X.optimizationExposureLogging()&&Date.now()-this.MIN_LOG_PERIODICITY_MS>this.lastLoggedTimeMs&&this.logAndClearEventFlags()}static logAndClearEventFlags(){let e=new Map;this.encounteredRoundedRectOptimization&&e.set("rndMask",X.roundedMaskOptimization()),this.encounteredDebounceScrollHover&&e.set("dbnce",X.debounceMouseMoveScrolling()),this.encounteredFramebufferSwitchBudget&&e.set("framebuffer",X.enableFramebufferSwitchBudget()),this.encounteredSmartAnimateCacheTransform&&e.set("abstransform",X.smartAnimateCacheTransform()),this.encounteredCullTreesDuringTilePrioritization&&e.set("culltrees",X.cullTreesDuringTilePrioritization()),this.encounteredNestedBBNotInDirtyNodes&&e.set("nestedBBNotDirty",X.viewerSkipNotDirtyTreeOpt()),this.encounteredNestedBBInvisible&&e.set("nestedBBInvis",X.viewerSkipInvisibleTreeOpt()),$t.getEventEmitter().trigger("optimExpos",e),this.encounteredRoundedRectOptimization=!1,this.encounteredDebounceScrollHover=!1,this.encounteredFramebufferSwitchBudget=!1,this.encounteredSmartAnimateCacheTransform=!1,this.encounteredCullTreesDuringTilePrioritization=!1,this.encounteredNestedBBNotInDirtyNodes=!1,this.encounteredNestedBBInvisible=!1,this.lastLoggedTimeMs=Date.now()}};Un.MIN_LOG_PERIODICITY_MS=15e3,Un.lastLoggedTimeMs=-1,Un.encounteredRoundedRectOptimization=!1,Un.encounteredDebounceScrollHover=!1,Un.encounteredFramebufferSwitchBudget=!1,Un.encounteredSmartAnimateCacheTransform=!1,Un.encounteredCullTreesDuringTilePrioritization=!1,Un.encounteredNestedBBNotInDirtyNodes=!1,Un.encounteredNestedBBInvisible=!1;var bm=class{constructor(e,t,n,r){this.key=e,this.value=t,this.prev=n,this.next=r,this.lastUsedGeneration=0}},rl=class{constructor(){if(arguments.length==1){let e=arguments[0];this._nodeByKey=new Map,this._maxElements=0,this._size=0,this._head=null,this._tail=null,this._afterEvict=null,this._generation=1,this._maxElements=e}else if(arguments.length==2){let e=arguments[0],t=arguments[1];this._nodeByKey=new Map,this._maxElements=0,this._size=0,this._head=null,this._tail=null,this._afterEvict=null,this._generation=1,this._maxElements=e,this._afterEvict=t}}maximumCapacity(){return this._maxElements}atMaximumCapacity(){return this._size==this._maxElements}increaseCapacity(e){this._maxElements=this._maxElements+e}capacityUsedForGeneration(){return this.atMaximumCapacity()?this._tail.lastUsedGeneration==this._generation:!1}incrementGeneration(){if(this._generation===Number.MAX_SAFE_INTEGER-1){this._generation=1;for(let e of Array.from(this._nodeByKey.keys()))this._nodeByKey.get(e).lastUsedGeneration=0}else this._generation=this._generation+1}keys(){return Array.from(this._nodeByKey.keys())}_in(e){return this._nodeByKey.has(e)?(this._moveElemToHead(this._nodeByKey.get(e)),!0):!1}count(){return this._size}get1(e){return this._moveElemToHead(this._nodeByKey.get(e)),this._nodeByKey.get(e).value}get(e,t){let n=Le.StringMap_get(this._nodeByKey,e,null);return n==null?t:(this._moveElemToHead(n),n.value)}tailElement(){return this._tail.value}set(e,t){let n=Le.StringMap_get(this._nodeByKey,e,null);if(n!=null)this._moveElemToHead(n),n.value=t;else if(n=new bm(e,t,null,null),this._addElemAsHead(n),this._nodeByKey.set(e,n),this._size=this._size+1,this._size>this._maxElements){let r=this._tail.value,o=this._tail.key;this.remove(this._tail.key),this._afterEvict!=null&&this._afterEvict(o,r)}}remove(e){let t=Le.StringMap_get(this._nodeByKey,e,null);t!=null&&(this._nodeByKey.delete(t.key),this._removeFromList(t),this._size=this._size-1)}removeValue(e){let t=[];Le.StringMap_each(this._nodeByKey,(n,r)=>{r.value==e&&t.push(n)}),t.forEach(n=>{this.remove(n)})}makeLeastRecent(e){let t=Le.StringMap_get(this._nodeByKey,e,null);t!=null&&(this._removeFromList(t),this._addElemAsTail(t))}_moveElemToHead(e){this._removeFromList(e),this._addElemAsHead(e)}_removeFromList(e){let t=e.prev,n=e.next;t!=null&&(t.next=n),n!=null&&(n.prev=t),e==this._tail&&(this._tail=t),e==this._head&&(this._head=n),e.next=e.prev=null}_addElemAsHead(e){this._head==null?this._head=this._tail=e:(e.prev=null,e.next=this._head,e.next.prev=e,this._head=e),this._head.lastUsedGeneration=this._generation}_addElemAsTail(e){this._tail==null?this._tail=this._head=e:(e.next=null,e.prev=this._tail,e.prev.next=e,this._tail=e),this._tail.lastUsedGeneration=0}};var mo=class mo{static numInitialTextures(){return Xe.isMobile(Xe.current())||Xe.current()==4&&navigator.maxTouchPoints>0||wt.forceMobileOptimizations()?3:6}static numInitialTiles(e){return mo.numInitialTextures()*e*e}_createNewTexture(){let e=N.in_Context.Context_createTexture1(this._context,N.TextureFormat.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP,this._tilesPerSide*mo.TILE_SIZE,this._tilesPerSide*mo.TILE_SIZE,"TileAtlas"),t=this._context.createFramebuffer(e,null,"Tile Atlas");this._tileCacheFramebuffers.push(t)}allocateTile(){let e=`tile${this._tileIdCounter}`;this._tileIdCounter=this._tileIdCounter+1,this._tilesLRU.capacityUsedForGeneration()&&(this._createNewTexture(),this._tilesLRU.increaseCapacity(this._tilesPerSide*this._tilesPerSide),console.warn("allocated new texture in the atlas to handle demand for current frame"));let t=this._tilesLRU.atMaximumCapacity()?this._tilesLRU.tailElement().tileIndex:this._tilesLRU.count();return this._tilesLRU.set(e,new mo.CachedTileMetadata(t,!1,this._context.maxTextureSize())),e}maximumCapacity(){return this._tilesLRU.maximumCapacity()}prepareForNewFrame(){this._tilesLRU.incrementGeneration()}totalVRAM(){let e=0;for(let t of this._tileCacheFramebuffers)e=e+N.in_Texture.Texture_totalVRAM(t.colorTexture());return e}tilesPerTexture(){return this._tilesPerSide*this._tilesPerSide}tileIsStillValid(e){return this._tilesLRU._in(e)}framebufferForTile(e){let t=this._tilesLRU.get1(e).tileIndex;return this._tileCacheFramebuffers[t/(this._tilesPerSide*this._tilesPerSide)|0]}devalueTile(e){this._tilesLRU.makeLeastRecent(e)}getTexture(e){return this._tileCacheFramebuffers[e].colorTexture()}viewportForTile(e,t){let n=this._tilesLRU.get1(e).tileIndex,r=At.int_remainder(n,this._tilesPerSide),o=At.int_remainder(n/this._tilesPerSide|0,this._tilesPerSide);t.setTo1(r*mo.TILE_SIZE,o*mo.TILE_SIZE,mo.TILE_SIZE,mo.TILE_SIZE)}clearCache(){let t=this._tileCacheFramebuffers.length*this._tilesPerSide*this._tilesPerSide;this._tilesLRU=new rl(t,this._afterEvictOrNull)}constructor(e,t){this._afterEvictOrNull=null,this._tileIdCounter=0,this._tilesLRU=null,this._tilesPerSide=0,this._tileCacheFramebuffers=[],this._context=null,this._afterEvictOrNull=t,this._tilesPerSide=e.maxTextureSize()/mo.TILE_SIZE|0,this._tilesLRU=new rl(mo.numInitialTiles(this._tilesPerSide),this._afterEvictOrNull),e.addContextResetHandler(()=>{this.clearCache()}),this._context=e;for(let n=0,r=mo.numInitialTextures();n<r;n=n+1)this._createNewTexture()}};mo.TILE_SIZE=512;var gn=mo;(e=>{class i{cacheViewport(){let n=this.maxTextureSize/e.TILE_SIZE|0,r=At.int_remainder(this.tileIndex,n),o=At.int_remainder(this.tileIndex/n|0,n);return new U(r*e.TILE_SIZE,o*e.TILE_SIZE,e.TILE_SIZE,e.TILE_SIZE)}constructor(n,r,o){this.tileIndex=0,this.isValid=!1,this.includesBackgroundColor=!1,this.maxTextureSize=0,this.tileIndex=n,this.includesBackgroundColor=r,this.isValid=!0,this.maxTextureSize=o}}e.CachedTileMetadata=i})(gn||(gn={}));var rv=$a(AS());var Mn;(p=>{function i(u,h){p.current.set(u,$.new8(h))}p.track1=i;function e(u,h){if(p.current.set(u,$.new7(h)),!p.maximum.has(u))p.maximum.set(u,p.current.get(u));else{let f=p.maximum.get(u);p.maximum.set(u,Math.max(f,p.current.get(u)))}}p.track2=e;function t(u,h){if(p.current.set(u,$.new4(h)),!p.maximum.has(u))p.maximum.set(u,p.current.get(u));else{let f=p.maximum.get(u);p.maximum.set(u,Math.max(f,p.current.get(u)))}}p.track3=t;function n(u,h){if(p.current.has(u)?p.current.set(u,$.new4($.asDouble(p.current.get(u))+h)):p.current.set(u,$.new4(h)),!p.maximum.has(u))p.maximum.set(u,p.current.get(u));else{let f=p.maximum.get(u);p.maximum.set(u,Math.max(f,p.current.get(u)))}}p.increment=n;function r(u,h){let f=$.new7(h);if(p.current.set(u,f),!p.maximum.has(u))p.maximum.set(u,p.current.get(u));else{let _=p.maximum.get(u);p.maximum.set(u,Math.max(_,f))}}p.trackInReleaseBuilds=r;function o(u,h){if(p.current.has(u)?p.current.set(u,$.new4($.asDouble(p.current.get(u))+h)):p.current.set(u,$.new4(h)),!p.maximum.has(u))p.maximum.set(u,p.current.get(u));else{let f=p.maximum.get(u);p.maximum.set(u,Math.max(f,p.current.get(u)))}return $.asDouble(p.current.get(u))|0}p.incrementInReleaseBuilds=o;function a(u){return p.current.has(u)?p.current.get(u):$.new7(0)}p.getStat=a;function s(u){return p.maximum.has(u)?p.maximum.get(u):$.new7(0)}p.getMax=s;function l(){let u=window.performance.memory;u&&u.jsHeapSizeLimit&&u.usedJSHeapSize&&(e("JS Heap size (MB)",u.jsHeapSizeLimit/(1024*1024)|0),e("Used Heap size (MB)",u.usedJSHeapSize/(1024*1024)|0));let h={};for(let f of Array.from(p.current.keys())){let _=p.current.get(f);$.isDouble(_)?h[f]=Math.round($.asDouble(_)*100)/100:h[f]=$.toString(p.current.get(f))}return h}p.getStatsForDebugging=l,p.current=new Map,p.maximum=new Map})(Mn||(Mn={}));var Ri=null,kr=!1,na=!1;function SS(){na=!0}var yS=(l=>(l[l.ROTATE_0=0]="ROTATE_0",l[l.ROTATE_90=1]="ROTATE_90",l[l.ROTATE_180=2]="ROTATE_180",l[l.ROTATE_270=3]="ROTATE_270",l[l.FLIP_ROTATE_0=4]="FLIP_ROTATE_0",l[l.FLIP_ROTATE_90=5]="FLIP_ROTATE_90",l[l.FLIP_ROTATE_180=6]="FLIP_ROTATE_180",l[l.FLIP_ROTATE_270=7]="FLIP_ROTATE_270",l))(yS||{}),Iu;(u=>{function i(h,f){if(f.value+1>h.length)return null;let _=new Se(h[f.value]);return f.value=f.value+1,_}u._read8=i;function e(h,f,_){if(f.value+2>h.length)return null;let m=h[f.value],A=h[f.value+1];return f.value=f.value+2,new Se(_==1?m|A<<8:A|m<<8)}u._read16=e;function t(h,f,_){if(f.value+2>h.length)return null;let m=h[f.value],A=h[f.value+1],y=h[f.value+2],S=h[f.value+3];return f.value=f.value+4,new Se(_==1?m|A<<8|y<<16|S<<24:S|y<<8|A<<16|m<<24)}u._read32=t;function n(h){let f=[255,216,255];if(h.length<f.length)return null;for(let m=0,A=f.length;m<A;m=m+1)if(f[m]!=h[m])return null;let _=new Se(2);for(;_.value+4<=h.length;){let m=e(h,_,0);if(m==null||m.value>>8!=255)return null;let A=e(h,_,0);if(A==null||A.value<2)return null;if(_.value=_.value-2,m.value==65505){let y=r(h,_.value);if(y!=null)return y}_.value=_.value+A.value}return null}u.readFromJPEG=n;function r(h,f){let _=new Se(f),m=e(h,_,0);if(m==null||m.value<6)return null;let A=t(h,_,0);if(A==null||A.value!=1165519206)return null;let y=e(h,_,0);if(y==null||y.value!=0)return null;let S=t(h,_,0);if(S==null||S.value!=1229531648&&S.value!=1296891946)return null;let b=S.value==1229531648?1:0,T=t(h,_,b);if(T==null)return null;_.value=_.value+T.value-8;let I=e(h,_,b);if(I==null)return null;let O=I.value,w=-1;for(let P=0;P<O;P=P+1){let H=e(h,_,b);if(H==null)break;let re=H.value,q=e(h,_,b);if(q==null)break;let W=q.value,x=t(h,_,b);if(x==null)break;let F=x.value,k=new Se(_.value);if(_.value=_.value+4,!(re!=u.EXIF_TAG_ORIENTATION||F!=1)){if(W==u.EXIF_FORMAT_BYTE){let G=i(h,k);if(G==null)return null;w=G.value}else if(W==u.EXIF_FORMAT_SHORT){let G=e(h,k,b);if(G==null)return null;w=G.value}else if(W==u.EXIF_FORMAT_LONG||W==u.EXIF_FORMAT_SLONG){let G=t(h,k,b);if(G==null)return null;w=G.value}else continue;switch(w){case 1:return new Se(0);case 6:return new Se(1);case 3:return new Se(2);case 8:return new Se(3);case 2:return new Se(4);case 5:return new Se(5);case 4:return new Se(6);case 7:return new Se(7)}}}return null}u._decodeExifOrientation=r;let o;(_=>(_[_.BIG=0]="BIG",_[_.LITTLE=1]="LITTLE"))(o=u.Endianness||(u.Endianness={}));let a;(f=>{function h(_){return o[_]}f.Endianness_toString=h})(a=u.in_Endianness||(u.in_Endianness={})),u.EXIF_TAG_ORIENTATION=274,u.EXIF_FORMAT_BYTE=1,u.EXIF_FORMAT_SHORT=3,u.EXIF_FORMAT_LONG=4,u.EXIF_FORMAT_SLONG=9})(Iu||(Iu={}));var fc;(n=>{function i(r){switch(r){case 0:case 4:return 0;case 1:case 5:return 90;case 2:case 6:return 180;case 3:case 7:return 270;default:return 0}}n.ImageOrientation_rotationDegrees=i;function e(r){return r==4||r==5||r==6||r==7}n.ImageOrientation_shouldFlip=e;function t(r){return yS[r]}n.ImageOrientation_toString=t})(fc||(fc={}));var _c;(W=>{function i(x){return x<0?0:x>255?255:x}W._clip=i;function e(x){return i(x+64>>7)}W._CF=e;function t(x,F){let k=0,G=x[F+4]<<11,M=x[F+6],Q=x[F+2],Y=x[F+1],B=x[F+7],te=x[F+5],j=x[F+3],ie=0;if(!(G|M|Q|Y|B|te|j)){let de=x[F]<<3;x[F]=de,x[F+1]=de,x[F+2]=de,x[F+3]=de,x[F+4]=de,x[F+5]=de,x[F+6]=de,x[F+7]=de;return}k=(x[F]<<11)+128,ie=W._W7*(Y+B),Y=ie+(W._W1-W._W7)*Y,B=ie-(W._W1+W._W7)*B,ie=W._W3*(te+j),te=ie-(W._W3-W._W5)*te,j=ie-(W._W3+W._W5)*j,ie=k+G,k=k-G,G=W._W6*(Q+M),M=G-(W._W2+W._W6)*M,Q=G+(W._W2-W._W6)*Q,G=Y+te,Y=Y-te,te=B+j,B=B-j,j=ie+Q,ie=ie-Q,Q=k+M,k=k-M,M=181*(Y+B)+128>>8,Y=181*(Y-B)+128>>8,x[F]=j+G>>8,x[F+1]=Q+M>>8,x[F+2]=k+Y>>8,x[F+3]=ie+te>>8,x[F+4]=ie-te>>8,x[F+5]=k-Y>>8,x[F+6]=Q-M>>8,x[F+7]=j-G>>8}W._rowInverseDCT=t;function n(x,F,k,G,M){let Q=0,Y=x[F+8*4]<<8,B=x[F+8*6],te=x[F+8*2],j=x[F+8*1],ie=x[F+8*7],de=x[F+8*5],tt=x[F+8*3],bt=0;if(!(Y|B|te|j|ie|de|tt)){let ht=i((x[F]+32>>6)+128);for(let Ft=8;Ft!=0;Ft=Ft-1)k[G]=ht,G=G+M;return}Q=(x[F]<<8)+8192,bt=W._W7*(j+ie)+4,j=bt+(W._W1-W._W7)*j>>3,ie=bt-(W._W1+W._W7)*ie>>3,bt=W._W3*(de+tt)+4,de=bt-(W._W3-W._W5)*de>>3,tt=bt-(W._W3+W._W5)*tt>>3,bt=Q+Y,Q=Q-Y,Y=W._W6*(te+B)+4,B=Y-(W._W2+W._W6)*B>>3,te=Y+(W._W2-W._W6)*te>>3,Y=j+de,j=j-de,de=ie+tt,ie=ie-tt,tt=bt+te,bt=bt-te,te=Q+B,Q=Q-B,B=181*(j+ie)+128>>8,j=181*(j-ie)+128>>8,k[G]=i((tt+Y>>14)+128),G=G+M,k[G]=i((te+B>>14)+128),G=G+M,k[G]=i((Q+j>>14)+128),G=G+M,k[G]=i((bt+de>>14)+128),G=G+M,k[G]=i((bt-de>>14)+128),G=G+M,k[G]=i((Q-j>>14)+128),G=G+M,k[G]=i((te-B>>14)+128),G=G+M,k[G]=i((tt-Y>>14)+128)}W._colInverseDCT=n;let r;(Q=>(Q[Q.OK=0]="OK",Q[Q.NO_JPEG=1]="NO_JPEG",Q[Q.UNSUPPORTED=2]="UNSUPPORTED",Q[Q.SYNTAX_ERROR=3]="SYNTAX_ERROR",Q[Q.FINISHED=4]="FINISHED"))(r=W.Result||(W.Result={}));class o{upsampleH(){let F=this.width-3,k=0,G=0,M=new Uint8Array(this.width*this.height*2);for(let Q=this.height;Q!=0;Q=Q-1){M[G]=e(W._CF2A*this.pixels[k]+W._CF2B*this.pixels[k+1]),M[G+1]=e(W._CF3X*this.pixels[k]+W._CF3Y*this.pixels[k+1]+W._CF3Z*this.pixels[k+2]),M[G+2]=e(W._CF3A*this.pixels[k]+W._CF3B*this.pixels[k+1]+W._CF3C*this.pixels[k+2]);for(let Y=0;Y<F;Y=Y+1)M[G+Y*2+3]=e(W._CF4A*this.pixels[k+Y]+W._CF4B*this.pixels[k+Y+1]+W._CF4C*this.pixels[k+Y+2]+W._CF4D*this.pixels[k+Y+3]),M[G+Y*2+4]=e(W._CF4D*this.pixels[k+Y]+W._CF4C*this.pixels[k+Y+1]+W._CF4B*this.pixels[k+Y+2]+W._CF4A*this.pixels[k+Y+3]);k=k+this.stride,G=G+this.width*2,M[G+-3]=e(W._CF3A*this.pixels[k-1]+W._CF3B*this.pixels[k-2]+W._CF3C*this.pixels[k-3]),M[G+-2]=e(W._CF3X*this.pixels[k-1]+W._CF3Y*this.pixels[k-2]+W._CF3Z*this.pixels[k-3]),M[G+-1]=e(W._CF2A*this.pixels[k-1]+W._CF2B*this.pixels[k-2])}this.width<<=1,this.stride=this.width,this.pixels=M}upsampleV(){let F=this.width,k=this.stride,G=k+k,M=new Uint8Array(this.width*this.height*2);for(let Q=0;Q<F;Q=Q+1){let Y=Q,B=Q;M[B]=e(W._CF2A*this.pixels[Y]+W._CF2B*this.pixels[Y+k]),B=B+F,M[B]=e(W._CF3X*this.pixels[Y]+W._CF3Y*this.pixels[Y+k]+W._CF3Z*this.pixels[Y+G]),B=B+F,M[B]=e(W._CF3A*this.pixels[Y]+W._CF3B*this.pixels[Y+k]+W._CF3C*this.pixels[Y+G]),B=B+F,Y=Y+k;for(let te=this.height-3;te!=0;te=te-1)M[B]=e(W._CF4A*this.pixels[Y+-k]+W._CF4B*this.pixels[Y]+W._CF4C*this.pixels[Y+k]+W._CF4D*this.pixels[Y+G]),B=B+F,M[B]=e(W._CF4D*this.pixels[Y+-k]+W._CF4C*this.pixels[Y]+W._CF4B*this.pixels[Y+k]+W._CF4A*this.pixels[Y+G]),B=B+F,Y=Y+k;Y=Y+k,M[B]=e(W._CF3A*this.pixels[Y]+W._CF3B*this.pixels[Y-k]+W._CF3C*this.pixels[Y-G]),B=B+F,M[B]=e(W._CF3X*this.pixels[Y]+W._CF3Y*this.pixels[Y-k]+W._CF3Z*this.pixels[Y-G]),B=B+F,M[B]=e(W._CF2A*this.pixels[Y]+W._CF2B*this.pixels[Y-k])}this.height<<=1,this.stride=this.width,this.pixels=M}constructor(){this.id=0,this.ssx=0,this.ssy=0,this.width=0,this.height=0,this.stride=0,this.quantizationTableIndex=0,this.acTableIndex=0,this.dcTableIndex=0,this.dcPred=0,this.pixels=null}}W.Component=o;class a{constructor(){}}W.Stop=a;let s;(j=>(j[j.NONE=0]="NONE",j[j.ROTATE_0=1]="ROTATE_0",j[j.FLIP_ROTATE_0=2]="FLIP_ROTATE_0",j[j.ROTATE_180=3]="ROTATE_180",j[j.FLIP_ROTATE_180=4]="FLIP_ROTATE_180",j[j.FLIP_ROTATE_90=5]="FLIP_ROTATE_90",j[j.ROTATE_90=6]="ROTATE_90",j[j.FLIP_ROTATE_270=7]="FLIP_ROTATE_270",j[j.ROTATE_270=8]="ROTATE_270"))(s=W.Orientation||(W.Orientation={}));class l{constructor(){this._bitBuffer=0,this._bitCount=0,this._block=new Int32Array(64),this._bytes=null,this._componentCount=0,this._components=[],this._error=0,this._exifOrientation=1,this._height=0,this._heightInMacroBlocks=0,this._huffmanTable=[],this._length=0,this._macroBlockSizeX=0,this._macroBlockSizeY=0,this._offset=0,this._quantizationTable=[],this._restartInterval=0,this._rgb=null,this._size=0,this._width=0,this._widthInMacroBlocks=0,this._getVLC_code=0;for(let F=0;F<4;F=F+1)this._quantizationTable.push(new Uint8Array(64)),this._huffmanTable.push(new Uint16Array(65536)),this._components.push(new o)}_throw(F){throw this._error=F,new a}_showBits(F){if(F==0)return 0;for(;this._bitCount<F;){if(this._size<=0){this._bitBuffer=this._bitBuffer<<8|255,this._bitCount=this._bitCount+8;continue}let k=this._bytes[this._offset];if(this._offset=this._offset+1,this._size=this._size-1,this._bitCount=this._bitCount+8,this._bitBuffer=this._bitBuffer<<8|k,k==255){this._size==0&&this._throw(3);let G=this._bytes[this._offset];this._offset=this._offset+1,this._size=this._size-1,G==217?this._size=0:G!=0&&G!=255&&((G&248)!=208&&this._throw(3),this._bitBuffer=this._bitBuffer<<8|G,this._bitCount=this._bitCount+8)}}return this._bitBuffer>>this._bitCount-F&(1<<F)-1}_skipBits(F){this._bitCount<F&&this._showBits(F),this._bitCount=this._bitCount-F}_getBits(F){let k=this._showBits(F);return this._skipBits(F),k}_byteAlign(){this._bitCount&=248}_skip(F){this._offset=this._offset+F,this._size=this._size-F,this._length=this._length-F,this._size<0&&this._throw(3)}_decodeBig16(F){return this._bytes[F]<<8|this._bytes[F+1]}_decodeBig32(F){return this._bytes[F]<<24|this._bytes[F+1]<<16|this._bytes[F+2]<<8|this._bytes[F+3]}_decode16(F,k){return k==l.Endianness.LITTLE?this._bytes[F]|this._bytes[F+1]<<8:this._decodeBig16(F)}_decode32(F,k){return k==l.Endianness.LITTLE?this._bytes[F]|this._bytes[F+1]<<8|this._bytes[F+2]<<16|this._bytes[F+3]<<24:this._decodeBig32(F)}_decodeLength(){this._size<2&&this._throw(3),this._length=this._decodeBig16(this._offset),this._length>this._size&&this._throw(3),this._skip(2)}_skipMarker(){this._decodeLength(),this._skip(this._length)}_decodeSOF(){let F=0,k=0,G=null;this._decodeLength(),this._length<9&&this._throw(3),this._bytes[this._offset]!=8&&this._throw(2),this._height=this._decodeBig16(this._offset+1),this._width=this._decodeBig16(this._offset+3),this._componentCount=this._bytes[this._offset+5],this._skip(6),this._componentCount!=1&&this._componentCount!=3&&this._throw(2),this._length<this._componentCount*3&&this._throw(3);for(let M=0;M<this._componentCount;M=M+1)G=this._components[M],G.id=this._bytes[this._offset],G.ssx=this._bytes[this._offset+1]>>4,G.ssy=this._bytes[this._offset+1]&15,G.quantizationTableIndex=this._bytes[this._offset+2],(G.ssx==0||G.ssy==0||G.quantizationTableIndex&252)&&this._throw(3),(G.ssx&G.ssx-1||G.ssy&G.ssy-1)&&this._throw(2),this._skip(3),G.ssx>F&&(F=G.ssx),G.ssy>k&&(k=G.ssy);this._componentCount==1&&(G=this._components[0],G.ssx=G.ssy=F=k=1),this._macroBlockSizeX=F<<3,this._macroBlockSizeY=k<<3,this._widthInMacroBlocks=(this._width+this._macroBlockSizeX-1)/this._macroBlockSizeX|0,this._heightInMacroBlocks=(this._height+this._macroBlockSizeY-1)/this._macroBlockSizeY|0;for(let M=0;M<this._componentCount;M=M+1)G=this._components[M],G.width=(this._width*G.ssx+F-1)/F|0,G.height=(this._height*G.ssy+k-1)/k|0,G.stride=this._widthInMacroBlocks*this._macroBlockSizeX*G.ssx/F|0,(G.width<3&&G.ssx!=F||G.height<3&&G.ssy!=k)&&this._throw(2),G.pixels=new Uint8Array(G.stride*(this._heightInMacroBlocks*this._macroBlockSizeY*G.ssy/k|0));this._rgb=new Uint8Array(this._width*this._height*3),this._skip(this._length)}_decodeDHT(){for(this._decodeLength();this._length>=17;){let F=this._bytes[this._offset];F&236&&this._throw(3),F&2&&this._throw(2),F=(F|F>>3)&3;let k=new Uint8Array(16);for(let B=1;B<=16;B=B+1)k[B-1]=this._bytes[this._offset+B];this._skip(17);let G=this._huffmanTable[F],M=0,Q=65536,Y=65536;for(let B=1;B<=16;B=B+1){Y>>=1;let te=k[B-1];if(te!=0){this._length<te&&this._throw(3),Q=Q-(te<<16-B),Q<0&&this._throw(3);for(let j=0;j<te;j=j+1){let ie=this._bytes[this._offset+j];for(let de=Y;de!=0;de=de-1)M<65536&&(G[M]=B<<8|ie,M=M+1)}this._skip(te)}}for(;Q!=0;)Q=Q-1,M<65536&&(G[M]=G[M]&65280,M=M+1)}this._length!=0&&this._throw(3)}_decodeDQT(){for(this._decodeLength();this._length>=65;){let F=this._bytes[this._offset];F&252&&this._throw(3);let k=this._quantizationTable[F];for(let G=0;G<64;G=G+1)k[G]=this._bytes[this._offset+G+1];this._skip(65)}this._length!=0&&this._throw(3)}_decodeDRI(){this._decodeLength(),this._length<2&&this._throw(3),this._restartInterval=this._decodeBig16(this._offset),this._skip(this._length)}_getVLC(F){let k=this._showBits(16),G=F[k]>>8;return G==0&&this._throw(3),this._skipBits(G),k=F[k]&255,this._getVLC_code=k,G=k&15,G==0?0:(k=this._getBits(G),k<1<<G-1&&(k=k+((-1<<G)+1)),k)}_decodeBlock(F,k){let G=0;for(this._block=new Int32Array(64),F.dcPred=F.dcPred+this._getVLC(this._huffmanTable[F.dcTableIndex]),this._block[0]=F.dcPred*this._quantizationTable[F.quantizationTableIndex][0];G<63;){let M=this._getVLC(this._huffmanTable[F.acTableIndex]);if(this._getVLC_code==0)break;!(this._getVLC_code&15)&&this._getVLC_code!=240&&this._throw(3),G=G+((this._getVLC_code>>4)+1),G>63&&this._throw(3),this._block[W._zigZagTable[G]]=M*this._quantizationTable[F.quantizationTableIndex][G]}for(let M=0;M<64;M=M+8)t(this._block,M);for(let M=0;M<8;M=M+1)n(this._block,M,F.pixels,k+M,F.stride)}_decodeScan(){let F=this._restartInterval,k=0;this._decodeLength(),this._length<4+2*this._componentCount&&this._throw(3),this._bytes[this._offset]!=this._componentCount&&this._throw(2),this._skip(1);for(let G=0;G<this._componentCount;G=G+1){let M=this._components[G];this._bytes[this._offset]!=M.id&&this._throw(3),this._bytes[this._offset+1]&238&&this._throw(3),M.dcTableIndex=this._bytes[this._offset+1]>>4,M.acTableIndex=this._bytes[this._offset+1]&1|2,this._skip(2)}(this._bytes[this._offset]!=0||this._bytes[this._offset+1]!=63||this._bytes[this._offset+2]!=0)&&this._throw(2),this._skip(this._length);for(let G=0;G<this._heightInMacroBlocks;G=G+1)for(let M=0;M<this._widthInMacroBlocks;M=M+1){if((M!=0||G!=0)&&this._restartInterval!=0&&(F=F-1,F==0)){this._byteAlign();let Q=this._getBits(16);((Q&65528)!=65488||(Q&7)!=k)&&this._throw(3),k=k+1&7,F=this._restartInterval;for(let Y=0;Y<4;Y=Y+1)this._components[Y].dcPred=0}for(let Q=0;Q<this._componentCount;Q=Q+1){let Y=this._components[Q];for(let B=0;B<Y.ssy;B=B+1)for(let te=0;te<Y.ssx;te=te+1)this._decodeBlock(Y,(G*Y.ssy+B)*Y.stride+M*Y.ssx+te<<3)}}this._error=4}_decodeEXIF(){if(this._decodeLength(),this._length<6||this._decodeBig32(this._offset)!=1165519206||this._decodeBig16(this._offset+4)!=0){this._skip(this._length);return}this._skip(6);let F=this._offset;this._length<8&&this._throw(3);let k=this._decodeBig32(F),G=k==1229531648?l.Endianness.LITTLE:l.Endianness.BIG;G==l.Endianness.BIG&&k!=1296891946&&this._throw(3);let M=274,Q=1,Y=3,B=4,te=9,j=F+this._decode32(F+4,G),ie=this._decode16(j,G);j=j+2;for(let de=0,tt=ie;de<tt;de=de+1){let bt=this._decode16(j,G),ht=this._decode16(j+2,G),Ft=this._decode32(j+4,G);if(j=j+8,bt==M&&Ft==1){this._exifOrientation=0,ht==Q?this._exifOrientation=this._bytes[j]:ht==Y?this._exifOrientation=this._decode16(j,G):(ht==B||ht==te)&&(this._exifOrientation=this._decode32(j,G)),(this._exifOrientation<1||this._exifOrientation>8)&&(this._exifOrientation=1);break}j=j+4}this._skip(this._length)}_convert(){for(let G=0;G<this._componentCount;G=G+1){let M=this._components[G];for(;M.width<this._width||M.height<this._height;)M.width<this._width&&M.upsampleH(),M.height<this._height&&M.upsampleV()}let F=this._components[0],k=this._rgb;if(this._componentCount==1){let G=0,M=0;for(let Q=this._height;Q!=0;Q=Q-1){for(let Y=0;Y<this._width;Y=Y+1){let B=F.pixels[M+Y];k[G]=B,k[G+1]=B,k[G+2]=B,G=G+3}M=M+F.stride}}else{let G=this._components[1],M=this._components[2],Q=0,Y=0,B=0,te=0;for(let j=this._height;j!=0;j=j-1){for(let ie=0;ie<this._width;ie=ie+1){let de=F.pixels[Y+ie]<<8,tt=G.pixels[B+ie]-128,bt=M.pixels[te+ie]-128;k[Q]=i(de+359*bt+128>>8),k[Q+1]=i(de-88*tt-183*bt+128>>8),k[Q+2]=i(de+454*tt+128>>8),Q=Q+3}Y=Y+F.stride,B=B+G.stride,te=te+M.stride}}}_orient(){if(this._exifOrientation==1)return;let F=this._width,k=this._height,G=this._exifOrientation>=5,M=G?k:F,Q=G?F:k,Y=this._rgb,B=new Uint8Array(M*Q*3);for(let te=0,j=0;te<k;te=te+1){let ie=0,de=0;switch(this._exifOrientation){case 2:{ie=te*M+M-1,de=-1;break}case 3:{ie=(k-te-1)*M+M-1,de=-1;break}case 4:{ie=(k-te-1)*M,de=1;break}case 5:{ie=te,de=M;break}case 6:{ie=k-te-1,de=M;break}case 7:{ie=k-te-1+M*(Q-1),de=-M;break}case 8:{ie=te+M*(Q-1),de=-M;break}}ie=ie*3,de=de*3;for(let tt=0;tt<F;tt=tt+1,j=j+3)B[ie]=Y[j],B[ie+1]=Y[j+1],B[ie+2]=Y[j+2],ie=ie+de}this._width=M,this._height=Q,this._rgb=B}decodeBytes(F){try{for(this._bytes=F,this._offset=0,this._size=F.length,(this._size<2||this._bytes[0]!=255||this._bytes[1]!=216)&&this._throw(1),this._skip(2);this._error==0;){(this._size<2||this._bytes[this._offset]!=255)&&this._throw(3),this._skip(2);let k=this._bytes[this._offset-1];k==192?this._decodeSOF():k==196?this._decodeDHT():k==219?this._decodeDQT():k==221?this._decodeDRI():k==218?this._decodeScan():k==225?this._decodeEXIF():k==254?this._skipMarker():(k&240)==224?this._skipMarker():this._throw(2)}this._error!=4?this._error=3:(this._convert(),this._orient(),this._error=0)}catch{}return this._error}width(){return this._width}height(){return this._height}rgb(){return this._rgb}}W.Decoder=l,(k=>{let x;(Q=>(Q[Q.BIG=0]="BIG",Q[Q.LITTLE=1]="LITTLE"))(x=k.Endianness||(k.Endianness={}));let F;(M=>{function G(Q){return k.Endianness[Q]}M.Endianness_toString=G})(F=k.in_Endianness||(k.in_Endianness={}))})(l=W.Decoder||(W.Decoder={}));let d;(F=>{function x(k){return r[k]}F.Result_toString=x})(d=W.in_Result||(W.in_Result={}));let c;(F=>{function x(k){return s[k]}F.Orientation_toString=x})(c=W.in_Orientation||(W.in_Orientation={})),W._zigZagTable=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],W._W1=2841,W._W2=2676,W._W3=2408,W._W5=1609,W._W6=1108,W._W7=565,W._CF4A=-9,W._CF4B=111,W._CF4C=29,W._CF4D=-3,W._CF3A=28,W._CF3B=109,W._CF3C=-9,W._CF3X=104,W._CF3Y=27,W._CF3Z=-3,W._CF2A=139,W._CF2B=-11})(_c||(_c={}));var vm;(e=>{function i(t,n){let r=Array.from(t);return ce.List_append2(r,Array.from(n)),new Uint8Array(r)}e.concat=i})(vm||(vm={}));var bS;(e=>{function i(t,n){if(t.byteLength!=n.byteLength)return!1;for(let r=0,o=t.byteLength;r<o;r=r+1)if(t[r]!=n[r])return!1;return!0}e.Uint8Array_equals=i})(bS||(bS={}));var vu;(e=>{function i(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}e.DataView_new1=i})(vu||(vu={}));var Eu=class{seconds(){return ns.Performance_now(Zr().performance)/1e3}milliseconds(){return ns.Performance_now(Zr().performance)}constructor(){}};var Ta=class{reset(){this._seconds=0}advanceSeconds(e){this._seconds+=e}seconds(){return this._seconds}milliseconds(){return this._seconds*1e3}constructor(){this._seconds=0}},Qe;(a=>{function i(s){a._implementations.push(s)}a.dangerouslyPushMockTime=i;function e(){if(a._implementations.length==1)throw new Error("Popping last time implementation");ce.List_removeLast(a._implementations)}a.popMockTime=e;function t(){return ce.List_last(a._implementations).seconds()}a.seconds=t;function n(){return ce.List_last(a._implementations).milliseconds()}a.milliseconds=n;function r(s){let l=t(),d=t();for(;d-l<s;)d=t()}a.spin=r,a._implementations=[new Eu]})(Qe||(Qe={}));var cs=class{elapsedSeconds(){return Qe.seconds()-this._start}reset(){this._start=Qe.seconds()}constructor(){this._start=Qe.seconds()}};function cl(i){let e=i.length;for(;--e>=0;)i[e]=0}var RE=0,ay=1,OE=2,FE=3,xE=258,Ym=29,xc=256,vc=xc+1+Ym,al=30,Xm=19,sy=2*vc+1,ds=15,Em=16,PE=7,jm=256,ly=16,cy=17,dy=18,km=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Fu=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),DE=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),uy=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ME=512,oa=new Array((vc+2)*2);cl(oa);var bc=new Array(al*2);cl(bc);var Ec=new Array(ME);cl(Ec);var Cc=new Array(xE-FE+1);cl(Cc);var Zm=new Array(Ym);cl(Zm);var xu=new Array(al);cl(xu);function Cm(i,e,t,n,r){this.static_tree=i,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=r,this.has_stree=i&&i.length}var py,hy,my;function wm(i,e){this.dyn_tree=i,this.max_code=0,this.stat_desc=e}var gy=i=>i<256?Ec[i]:Ec[256+(i>>>7)],wc=(i,e)=>{i.pending_buf[i.pending++]=e&255,i.pending_buf[i.pending++]=e>>>8&255},go=(i,e,t)=>{i.bi_valid>Em-t?(i.bi_buf|=e<<i.bi_valid&65535,wc(i,i.bi_buf),i.bi_buf=e>>Em-i.bi_valid,i.bi_valid+=t-Em):(i.bi_buf|=e<<i.bi_valid&65535,i.bi_valid+=t)},Fi=(i,e,t)=>{go(i,t[e*2],t[e*2+1])},fy=(i,e)=>{let t=0;do t|=i&1,i>>>=1,t<<=1;while(--e>0);return t>>>1},LE=i=>{i.bi_valid===16?(wc(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=i.bi_buf&255,i.bi_buf>>=8,i.bi_valid-=8)},BE=(i,e)=>{let t=e.dyn_tree,n=e.max_code,r=e.stat_desc.static_tree,o=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,s=e.stat_desc.extra_base,l=e.stat_desc.max_length,d,c,p,u,h,f,_=0;for(u=0;u<=ds;u++)i.bl_count[u]=0;for(t[i.heap[i.heap_max]*2+1]=0,d=i.heap_max+1;d<sy;d++)c=i.heap[d],u=t[t[c*2+1]*2+1]+1,u>l&&(u=l,_++),t[c*2+1]=u,!(c>n)&&(i.bl_count[u]++,h=0,c>=s&&(h=a[c-s]),f=t[c*2],i.opt_len+=f*(u+h),o&&(i.static_len+=f*(r[c*2+1]+h)));if(_!==0){do{for(u=l-1;i.bl_count[u]===0;)u--;i.bl_count[u]--,i.bl_count[u+1]+=2,i.bl_count[l]--,_-=2}while(_>0);for(u=l;u!==0;u--)for(c=i.bl_count[u];c!==0;)p=i.heap[--d],!(p>n)&&(t[p*2+1]!==u&&(i.opt_len+=(u-t[p*2+1])*t[p*2],t[p*2+1]=u),c--)}},_y=(i,e,t)=>{let n=new Array(ds+1),r=0,o,a;for(o=1;o<=ds;o++)r=r+t[o-1]<<1,n[o]=r;for(a=0;a<=e;a++){let s=i[a*2+1];s!==0&&(i[a*2]=fy(n[s]++,s))}},VE=()=>{let i,e,t,n,r,o=new Array(ds+1);for(t=0,n=0;n<Ym-1;n++)for(Zm[n]=t,i=0;i<1<<km[n];i++)Cc[t++]=n;for(Cc[t-1]=n,r=0,n=0;n<16;n++)for(xu[n]=r,i=0;i<1<<Fu[n];i++)Ec[r++]=n;for(r>>=7;n<al;n++)for(xu[n]=r<<7,i=0;i<1<<Fu[n]-7;i++)Ec[256+r++]=n;for(e=0;e<=ds;e++)o[e]=0;for(i=0;i<=143;)oa[i*2+1]=8,i++,o[8]++;for(;i<=255;)oa[i*2+1]=9,i++,o[9]++;for(;i<=279;)oa[i*2+1]=7,i++,o[7]++;for(;i<=287;)oa[i*2+1]=8,i++,o[8]++;for(_y(oa,vc+1,o),i=0;i<al;i++)bc[i*2+1]=5,bc[i*2]=fy(i,5);py=new Cm(oa,km,xc+1,vc,ds),hy=new Cm(bc,Fu,0,al,ds),my=new Cm(new Array(0),DE,0,Xm,PE)},Ay=i=>{let e;for(e=0;e<vc;e++)i.dyn_ltree[e*2]=0;for(e=0;e<al;e++)i.dyn_dtree[e*2]=0;for(e=0;e<Xm;e++)i.bl_tree[e*2]=0;i.dyn_ltree[jm*2]=1,i.opt_len=i.static_len=0,i.sym_next=i.matches=0},Sy=i=>{i.bi_valid>8?wc(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0},TS=(i,e,t,n)=>{let r=e*2,o=t*2;return i[r]<i[o]||i[r]===i[o]&&n[e]<=n[t]},Nm=(i,e,t)=>{let n=i.heap[t],r=t<<1;for(;r<=i.heap_len&&(r<i.heap_len&&TS(e,i.heap[r+1],i.heap[r],i.depth)&&r++,!TS(e,n,i.heap[r],i.depth));)i.heap[t]=i.heap[r],t=r,r<<=1;i.heap[t]=n},IS=(i,e,t)=>{let n,r,o=0,a,s;if(i.sym_next!==0)do n=i.pending_buf[i.sym_buf+o++]&255,n+=(i.pending_buf[i.sym_buf+o++]&255)<<8,r=i.pending_buf[i.sym_buf+o++],n===0?Fi(i,r,e):(a=Cc[r],Fi(i,a+xc+1,e),s=km[a],s!==0&&(r-=Zm[a],go(i,r,s)),n--,a=gy(n),Fi(i,a,t),s=Fu[a],s!==0&&(n-=xu[a],go(i,n,s)));while(o<i.sym_next);Fi(i,jm,e)},Um=(i,e)=>{let t=e.dyn_tree,n=e.stat_desc.static_tree,r=e.stat_desc.has_stree,o=e.stat_desc.elems,a,s,l=-1,d;for(i.heap_len=0,i.heap_max=sy,a=0;a<o;a++)t[a*2]!==0?(i.heap[++i.heap_len]=l=a,i.depth[a]=0):t[a*2+1]=0;for(;i.heap_len<2;)d=i.heap[++i.heap_len]=l<2?++l:0,t[d*2]=1,i.depth[d]=0,i.opt_len--,r&&(i.static_len-=n[d*2+1]);for(e.max_code=l,a=i.heap_len>>1;a>=1;a--)Nm(i,t,a);d=o;do a=i.heap[1],i.heap[1]=i.heap[i.heap_len--],Nm(i,t,1),s=i.heap[1],i.heap[--i.heap_max]=a,i.heap[--i.heap_max]=s,t[d*2]=t[a*2]+t[s*2],i.depth[d]=(i.depth[a]>=i.depth[s]?i.depth[a]:i.depth[s])+1,t[a*2+1]=t[s*2+1]=d,i.heap[1]=d++,Nm(i,t,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],BE(i,e),_y(t,l,i.bl_count)},vS=(i,e,t)=>{let n,r=-1,o,a=e[0*2+1],s=0,l=7,d=4;for(a===0&&(l=138,d=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)o=a,a=e[(n+1)*2+1],!(++s<l&&o===a)&&(s<d?i.bl_tree[o*2]+=s:o!==0?(o!==r&&i.bl_tree[o*2]++,i.bl_tree[ly*2]++):s<=10?i.bl_tree[cy*2]++:i.bl_tree[dy*2]++,s=0,r=o,a===0?(l=138,d=3):o===a?(l=6,d=3):(l=7,d=4))},ES=(i,e,t)=>{let n,r=-1,o,a=e[0*2+1],s=0,l=7,d=4;for(a===0&&(l=138,d=3),n=0;n<=t;n++)if(o=a,a=e[(n+1)*2+1],!(++s<l&&o===a)){if(s<d)do Fi(i,o,i.bl_tree);while(--s!==0);else o!==0?(o!==r&&(Fi(i,o,i.bl_tree),s--),Fi(i,ly,i.bl_tree),go(i,s-3,2)):s<=10?(Fi(i,cy,i.bl_tree),go(i,s-3,3)):(Fi(i,dy,i.bl_tree),go(i,s-11,7));s=0,r=o,a===0?(l=138,d=3):o===a?(l=6,d=3):(l=7,d=4)}},kE=i=>{let e;for(vS(i,i.dyn_ltree,i.l_desc.max_code),vS(i,i.dyn_dtree,i.d_desc.max_code),Um(i,i.bl_desc),e=Xm-1;e>=3&&i.bl_tree[uy[e]*2+1]===0;e--);return i.opt_len+=3*(e+1)+5+5+4,e},UE=(i,e,t,n)=>{let r;for(go(i,e-257,5),go(i,t-1,5),go(i,n-4,4),r=0;r<n;r++)go(i,i.bl_tree[uy[r]*2+1],3);ES(i,i.dyn_ltree,e-1),ES(i,i.dyn_dtree,t-1)},GE=i=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&i.dyn_ltree[t*2]!==0)return 0;if(i.dyn_ltree[9*2]!==0||i.dyn_ltree[10*2]!==0||i.dyn_ltree[13*2]!==0)return 1;for(t=32;t<xc;t++)if(i.dyn_ltree[t*2]!==0)return 1;return 0},CS=!1,HE=i=>{CS||(VE(),CS=!0),i.l_desc=new wm(i.dyn_ltree,py),i.d_desc=new wm(i.dyn_dtree,hy),i.bl_desc=new wm(i.bl_tree,my),i.bi_buf=0,i.bi_valid=0,Ay(i)},yy=(i,e,t,n)=>{go(i,(RE<<1)+(n?1:0),3),Sy(i),wc(i,t),wc(i,~t),t&&i.pending_buf.set(i.window.subarray(e,e+t),i.pending),i.pending+=t},zE=i=>{go(i,ay<<1,3),Fi(i,jm,oa),LE(i)},WE=(i,e,t,n)=>{let r,o,a=0;i.level>0?(i.strm.data_type===2&&(i.strm.data_type=GE(i)),Um(i,i.l_desc),Um(i,i.d_desc),a=kE(i),r=i.opt_len+3+7>>>3,o=i.static_len+3+7>>>3,o<=r&&(r=o)):r=o=t+5,t+4<=r&&e!==-1?yy(i,e,t,n):i.strategy===4||o===r?(go(i,(ay<<1)+(n?1:0),3),IS(i,oa,bc)):(go(i,(OE<<1)+(n?1:0),3),UE(i,i.l_desc.max_code+1,i.d_desc.max_code+1,a+1),IS(i,i.dyn_ltree,i.dyn_dtree)),Ay(i),n&&Sy(i)},QE=(i,e,t)=>(i.pending_buf[i.sym_buf+i.sym_next++]=e,i.pending_buf[i.sym_buf+i.sym_next++]=e>>8,i.pending_buf[i.sym_buf+i.sym_next++]=t,e===0?i.dyn_ltree[t*2]++:(i.matches++,e--,i.dyn_ltree[(Cc[t]+xc+1)*2]++,i.dyn_dtree[gy(e)*2]++),i.sym_next===i.sym_end),KE=HE,qE=yy,YE=WE,XE=QE,jE=zE,ZE={_tr_init:KE,_tr_stored_block:qE,_tr_flush_block:YE,_tr_tally:XE,_tr_align:jE},$E=(i,e,t,n)=>{let r=i&65535|0,o=i>>>16&65535|0,a=0;for(;t!==0;){a=t>2e3?2e3:t,t-=a;do r=r+e[n++]|0,o=o+r|0;while(--a);r%=65521,o%=65521}return r|o<<16|0},Nc=$E,JE=()=>{let i,e=[];for(var t=0;t<256;t++){i=t;for(var n=0;n<8;n++)i=i&1?3988292384^i>>>1:i>>>1;e[t]=i}return e},e0=new Uint32Array(JE()),t0=(i,e,t,n)=>{let r=e0,o=n+t;i^=-1;for(let a=n;a<o;a++)i=i>>>8^r[(i^e[a])&255];return i^-1},Er=t0,hs={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},dl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:n0,_tr_stored_block:Gm,_tr_flush_block:r0,_tr_tally:Ea,_tr_align:o0}=ZE,{Z_NO_FLUSH:Ca,Z_PARTIAL_FLUSH:i0,Z_FULL_FLUSH:a0,Z_FINISH:ei,Z_BLOCK:wS,Z_OK:xr,Z_STREAM_END:NS,Z_STREAM_ERROR:xi,Z_DATA_ERROR:s0,Z_BUF_ERROR:Rm,Z_DEFAULT_COMPRESSION:l0,Z_FILTERED:c0,Z_HUFFMAN_ONLY:Cu,Z_RLE:d0,Z_FIXED:u0,Z_DEFAULT_STRATEGY:p0,Z_UNKNOWN:h0,Z_DEFLATED:Mu}=dl,m0=9,g0=15,f0=8,_0=29,A0=256,Hm=A0+1+_0,S0=30,y0=19,b0=2*Hm+1,T0=15,Zt=3,va=258,Pi=va+Zt+1,I0=32,sl=42,$m=57,zm=69,Wm=73,Qm=91,Km=103,us=113,Sc=666,to=1,ul=2,ms=3,pl=4,v0=3,ps=(i,e)=>(i.msg=hs[e],e),RS=i=>i*2-(i>4?9:0),Ia=i=>{let e=i.length;for(;--e>=0;)i[e]=0},E0=i=>{let e,t,n,r=i.w_size;e=i.hash_size,n=e;do t=i.head[--n],i.head[n]=t>=r?t-r:0;while(--e);e=r,n=e;do t=i.prev[--n],i.prev[n]=t>=r?t-r:0;while(--e)},C0=(i,e,t)=>(e<<i.hash_shift^t)&i.hash_mask,wa=C0,Oo=i=>{let e=i.state,t=e.pending;t>i.avail_out&&(t=i.avail_out),t!==0&&(i.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),i.next_out),i.next_out+=t,e.pending_out+=t,i.total_out+=t,i.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},Fo=(i,e)=>{r0(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,e),i.block_start=i.strstart,Oo(i.strm)},pn=(i,e)=>{i.pending_buf[i.pending++]=e},Ac=(i,e)=>{i.pending_buf[i.pending++]=e>>>8&255,i.pending_buf[i.pending++]=e&255},qm=(i,e,t,n)=>{let r=i.avail_in;return r>n&&(r=n),r===0?0:(i.avail_in-=r,e.set(i.input.subarray(i.next_in,i.next_in+r),t),i.state.wrap===1?i.adler=Nc(i.adler,e,r,t):i.state.wrap===2&&(i.adler=Er(i.adler,e,r,t)),i.next_in+=r,i.total_in+=r,r)},by=(i,e)=>{let t=i.max_chain_length,n=i.strstart,r,o,a=i.prev_length,s=i.nice_match,l=i.strstart>i.w_size-Pi?i.strstart-(i.w_size-Pi):0,d=i.window,c=i.w_mask,p=i.prev,u=i.strstart+va,h=d[n+a-1],f=d[n+a];i.prev_length>=i.good_match&&(t>>=2),s>i.lookahead&&(s=i.lookahead);do if(r=e,!(d[r+a]!==f||d[r+a-1]!==h||d[r]!==d[n]||d[++r]!==d[n+1])){n+=2,r++;do;while(d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&d[++n]===d[++r]&&n<u);if(o=va-(u-n),n=u-va,o>a){if(i.match_start=e,a=o,o>=s)break;h=d[n+a-1],f=d[n+a]}}while((e=p[e&c])>l&&--t!==0);return a<=i.lookahead?a:i.lookahead},ll=i=>{let e=i.w_size,t,n,r;do{if(n=i.window_size-i.lookahead-i.strstart,i.strstart>=e+(e-Pi)&&(i.window.set(i.window.subarray(e,e+e-n),0),i.match_start-=e,i.strstart-=e,i.block_start-=e,i.insert>i.strstart&&(i.insert=i.strstart),E0(i),n+=e),i.strm.avail_in===0)break;if(t=qm(i.strm,i.window,i.strstart+i.lookahead,n),i.lookahead+=t,i.lookahead+i.insert>=Zt)for(r=i.strstart-i.insert,i.ins_h=i.window[r],i.ins_h=wa(i,i.ins_h,i.window[r+1]);i.insert&&(i.ins_h=wa(i,i.ins_h,i.window[r+Zt-1]),i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++,i.insert--,!(i.lookahead+i.insert<Zt)););}while(i.lookahead<Pi&&i.strm.avail_in!==0)},Ty=(i,e)=>{let t=i.pending_buf_size-5>i.w_size?i.w_size:i.pending_buf_size-5,n,r,o,a=0,s=i.strm.avail_in;do{if(n=65535,o=i.bi_valid+42>>3,i.strm.avail_out<o||(o=i.strm.avail_out-o,r=i.strstart-i.block_start,n>r+i.strm.avail_in&&(n=r+i.strm.avail_in),n>o&&(n=o),n<t&&(n===0&&e!==ei||e===Ca||n!==r+i.strm.avail_in)))break;a=e===ei&&n===r+i.strm.avail_in?1:0,Gm(i,0,0,a),i.pending_buf[i.pending-4]=n,i.pending_buf[i.pending-3]=n>>8,i.pending_buf[i.pending-2]=~n,i.pending_buf[i.pending-1]=~n>>8,Oo(i.strm),r&&(r>n&&(r=n),i.strm.output.set(i.window.subarray(i.block_start,i.block_start+r),i.strm.next_out),i.strm.next_out+=r,i.strm.avail_out-=r,i.strm.total_out+=r,i.block_start+=r,n-=r),n&&(qm(i.strm,i.strm.output,i.strm.next_out,n),i.strm.next_out+=n,i.strm.avail_out-=n,i.strm.total_out+=n)}while(a===0);return s-=i.strm.avail_in,s&&(s>=i.w_size?(i.matches=2,i.window.set(i.strm.input.subarray(i.strm.next_in-i.w_size,i.strm.next_in),0),i.strstart=i.w_size,i.insert=i.strstart):(i.window_size-i.strstart<=s&&(i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,i.insert>i.strstart&&(i.insert=i.strstart)),i.window.set(i.strm.input.subarray(i.strm.next_in-s,i.strm.next_in),i.strstart),i.strstart+=s,i.insert+=s>i.w_size-i.insert?i.w_size-i.insert:s),i.block_start=i.strstart),i.high_water<i.strstart&&(i.high_water=i.strstart),a?pl:e!==Ca&&e!==ei&&i.strm.avail_in===0&&i.strstart===i.block_start?ul:(o=i.window_size-i.strstart,i.strm.avail_in>o&&i.block_start>=i.w_size&&(i.block_start-=i.w_size,i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,o+=i.w_size,i.insert>i.strstart&&(i.insert=i.strstart)),o>i.strm.avail_in&&(o=i.strm.avail_in),o&&(qm(i.strm,i.window,i.strstart,o),i.strstart+=o,i.insert+=o>i.w_size-i.insert?i.w_size-i.insert:o),i.high_water<i.strstart&&(i.high_water=i.strstart),o=i.bi_valid+42>>3,o=i.pending_buf_size-o>65535?65535:i.pending_buf_size-o,t=o>i.w_size?i.w_size:o,r=i.strstart-i.block_start,(r>=t||(r||e===ei)&&e!==Ca&&i.strm.avail_in===0&&r<=o)&&(n=r>o?o:r,a=e===ei&&i.strm.avail_in===0&&n===r?1:0,Gm(i,i.block_start,n,a),i.block_start+=n,Oo(i.strm)),a?ms:to)},Om=(i,e)=>{let t,n;for(;;){if(i.lookahead<Pi){if(ll(i),i.lookahead<Pi&&e===Ca)return to;if(i.lookahead===0)break}if(t=0,i.lookahead>=Zt&&(i.ins_h=wa(i,i.ins_h,i.window[i.strstart+Zt-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),t!==0&&i.strstart-t<=i.w_size-Pi&&(i.match_length=by(i,t)),i.match_length>=Zt)if(n=Ea(i,i.strstart-i.match_start,i.match_length-Zt),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=Zt){i.match_length--;do i.strstart++,i.ins_h=wa(i,i.ins_h,i.window[i.strstart+Zt-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(--i.match_length!==0);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=wa(i,i.ins_h,i.window[i.strstart+1]);else n=Ea(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(n&&(Fo(i,!1),i.strm.avail_out===0))return to}return i.insert=i.strstart<Zt-1?i.strstart:Zt-1,e===ei?(Fo(i,!0),i.strm.avail_out===0?ms:pl):i.sym_next&&(Fo(i,!1),i.strm.avail_out===0)?to:ul},ol=(i,e)=>{let t,n,r;for(;;){if(i.lookahead<Pi){if(ll(i),i.lookahead<Pi&&e===Ca)return to;if(i.lookahead===0)break}if(t=0,i.lookahead>=Zt&&(i.ins_h=wa(i,i.ins_h,i.window[i.strstart+Zt-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=Zt-1,t!==0&&i.prev_length<i.max_lazy_match&&i.strstart-t<=i.w_size-Pi&&(i.match_length=by(i,t),i.match_length<=5&&(i.strategy===c0||i.match_length===Zt&&i.strstart-i.match_start>4096)&&(i.match_length=Zt-1)),i.prev_length>=Zt&&i.match_length<=i.prev_length){r=i.strstart+i.lookahead-Zt,n=Ea(i,i.strstart-1-i.prev_match,i.prev_length-Zt),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=r&&(i.ins_h=wa(i,i.ins_h,i.window[i.strstart+Zt-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(--i.prev_length!==0);if(i.match_available=0,i.match_length=Zt-1,i.strstart++,n&&(Fo(i,!1),i.strm.avail_out===0))return to}else if(i.match_available){if(n=Ea(i,0,i.window[i.strstart-1]),n&&Fo(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return to}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(n=Ea(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<Zt-1?i.strstart:Zt-1,e===ei?(Fo(i,!0),i.strm.avail_out===0?ms:pl):i.sym_next&&(Fo(i,!1),i.strm.avail_out===0)?to:ul},w0=(i,e)=>{let t,n,r,o,a=i.window;for(;;){if(i.lookahead<=va){if(ll(i),i.lookahead<=va&&e===Ca)return to;if(i.lookahead===0)break}if(i.match_length=0,i.lookahead>=Zt&&i.strstart>0&&(r=i.strstart-1,n=a[r],n===a[++r]&&n===a[++r]&&n===a[++r])){o=i.strstart+va;do;while(n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&r<o);i.match_length=va-(o-r),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=Zt?(t=Ea(i,1,i.match_length-Zt),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(t=Ea(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),t&&(Fo(i,!1),i.strm.avail_out===0))return to}return i.insert=0,e===ei?(Fo(i,!0),i.strm.avail_out===0?ms:pl):i.sym_next&&(Fo(i,!1),i.strm.avail_out===0)?to:ul},N0=(i,e)=>{let t;for(;;){if(i.lookahead===0&&(ll(i),i.lookahead===0)){if(e===Ca)return to;break}if(i.match_length=0,t=Ea(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,t&&(Fo(i,!1),i.strm.avail_out===0))return to}return i.insert=0,e===ei?(Fo(i,!0),i.strm.avail_out===0?ms:pl):i.sym_next&&(Fo(i,!1),i.strm.avail_out===0)?to:ul};function Oi(i,e,t,n,r){this.good_length=i,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=r}var yc=[new Oi(0,0,0,0,Ty),new Oi(4,4,8,4,Om),new Oi(4,5,16,8,Om),new Oi(4,6,32,32,Om),new Oi(4,4,16,16,ol),new Oi(8,16,32,32,ol),new Oi(8,16,128,128,ol),new Oi(8,32,128,256,ol),new Oi(32,128,258,1024,ol),new Oi(32,258,258,4096,ol)],R0=i=>{i.window_size=2*i.w_size,Ia(i.head),i.max_lazy_match=yc[i.level].max_lazy,i.good_match=yc[i.level].good_length,i.nice_match=yc[i.level].nice_length,i.max_chain_length=yc[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=Zt-1,i.match_available=0,i.ins_h=0};function O0(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Mu,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(b0*2),this.dyn_dtree=new Uint16Array((2*S0+1)*2),this.bl_tree=new Uint16Array((2*y0+1)*2),Ia(this.dyn_ltree),Ia(this.dyn_dtree),Ia(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(T0+1),this.heap=new Uint16Array(2*Hm+1),Ia(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Hm+1),Ia(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Pc=i=>{if(!i)return 1;let e=i.state;return!e||e.strm!==i||e.status!==sl&&e.status!==$m&&e.status!==zm&&e.status!==Wm&&e.status!==Qm&&e.status!==Km&&e.status!==us&&e.status!==Sc?1:0},Iy=i=>{if(Pc(i))return ps(i,xi);i.total_in=i.total_out=0,i.data_type=h0;let e=i.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?$m:e.wrap?sl:us,i.adler=e.wrap===2?0:1,e.last_flush=-2,n0(e),xr},vy=i=>{let e=Iy(i);return e===xr&&R0(i.state),e},F0=(i,e)=>Pc(i)||i.state.wrap!==2?xi:(i.state.gzhead=e,xr),Ey=(i,e,t,n,r,o)=>{if(!i)return xi;let a=1;if(e===l0&&(e=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),r<1||r>m0||t!==Mu||n<8||n>15||e<0||e>9||o<0||o>u0||n===8&&a!==1)return ps(i,xi);n===8&&(n=9);let s=new O0;return i.state=s,s.strm=i,s.status=sl,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+Zt-1)/Zt),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=(s.lit_bufsize-1)*3,s.level=e,s.strategy=o,s.method=t,vy(i)},x0=(i,e)=>Ey(i,e,Mu,g0,f0,p0),P0=(i,e)=>{if(Pc(i)||e>wS||e<0)return i?ps(i,xi):xi;let t=i.state;if(!i.output||i.avail_in!==0&&!i.input||t.status===Sc&&e!==ei)return ps(i,i.avail_out===0?Rm:xi);let n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(Oo(i),i.avail_out===0)return t.last_flush=-1,xr}else if(i.avail_in===0&&RS(e)<=RS(n)&&e!==ei)return ps(i,Rm);if(t.status===Sc&&i.avail_in!==0)return ps(i,Rm);if(t.status===sl&&t.wrap===0&&(t.status=us),t.status===sl){let r=Mu+(t.w_bits-8<<4)<<8,o=-1;if(t.strategy>=Cu||t.level<2?o=0:t.level<6?o=1:t.level===6?o=2:o=3,r|=o<<6,t.strstart!==0&&(r|=I0),r+=31-r%31,Ac(t,r),t.strstart!==0&&(Ac(t,i.adler>>>16),Ac(t,i.adler&65535)),i.adler=1,t.status=us,Oo(i),t.pending!==0)return t.last_flush=-1,xr}if(t.status===$m){if(i.adler=0,pn(t,31),pn(t,139),pn(t,8),t.gzhead)pn(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),pn(t,t.gzhead.time&255),pn(t,t.gzhead.time>>8&255),pn(t,t.gzhead.time>>16&255),pn(t,t.gzhead.time>>24&255),pn(t,t.level===9?2:t.strategy>=Cu||t.level<2?4:0),pn(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(pn(t,t.gzhead.extra.length&255),pn(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(i.adler=Er(i.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=zm;else if(pn(t,0),pn(t,0),pn(t,0),pn(t,0),pn(t,0),pn(t,t.level===9?2:t.strategy>=Cu||t.level<2?4:0),pn(t,v0),t.status=us,Oo(i),t.pending!==0)return t.last_flush=-1,xr}if(t.status===zm){if(t.gzhead.extra){let r=t.pending,o=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+o>t.pending_buf_size;){let s=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+s),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>r&&(i.adler=Er(i.adler,t.pending_buf,t.pending-r,r)),t.gzindex+=s,Oo(i),t.pending!==0)return t.last_flush=-1,xr;r=0,o-=s}let a=new Uint8Array(t.gzhead.extra);t.pending_buf.set(a.subarray(t.gzindex,t.gzindex+o),t.pending),t.pending+=o,t.gzhead.hcrc&&t.pending>r&&(i.adler=Er(i.adler,t.pending_buf,t.pending-r,r)),t.gzindex=0}t.status=Wm}if(t.status===Wm){if(t.gzhead.name){let r=t.pending,o;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>r&&(i.adler=Er(i.adler,t.pending_buf,t.pending-r,r)),Oo(i),t.pending!==0)return t.last_flush=-1,xr;r=0}t.gzindex<t.gzhead.name.length?o=t.gzhead.name.charCodeAt(t.gzindex++)&255:o=0,pn(t,o)}while(o!==0);t.gzhead.hcrc&&t.pending>r&&(i.adler=Er(i.adler,t.pending_buf,t.pending-r,r)),t.gzindex=0}t.status=Qm}if(t.status===Qm){if(t.gzhead.comment){let r=t.pending,o;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>r&&(i.adler=Er(i.adler,t.pending_buf,t.pending-r,r)),Oo(i),t.pending!==0)return t.last_flush=-1,xr;r=0}t.gzindex<t.gzhead.comment.length?o=t.gzhead.comment.charCodeAt(t.gzindex++)&255:o=0,pn(t,o)}while(o!==0);t.gzhead.hcrc&&t.pending>r&&(i.adler=Er(i.adler,t.pending_buf,t.pending-r,r))}t.status=Km}if(t.status===Km){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(Oo(i),t.pending!==0))return t.last_flush=-1,xr;pn(t,i.adler&255),pn(t,i.adler>>8&255),i.adler=0}if(t.status=us,Oo(i),t.pending!==0)return t.last_flush=-1,xr}if(i.avail_in!==0||t.lookahead!==0||e!==Ca&&t.status!==Sc){let r=t.level===0?Ty(t,e):t.strategy===Cu?N0(t,e):t.strategy===d0?w0(t,e):yc[t.level].func(t,e);if((r===ms||r===pl)&&(t.status=Sc),r===to||r===ms)return i.avail_out===0&&(t.last_flush=-1),xr;if(r===ul&&(e===i0?o0(t):e!==wS&&(Gm(t,0,0,!1),e===a0&&(Ia(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),Oo(i),i.avail_out===0))return t.last_flush=-1,xr}return e!==ei?xr:t.wrap<=0?NS:(t.wrap===2?(pn(t,i.adler&255),pn(t,i.adler>>8&255),pn(t,i.adler>>16&255),pn(t,i.adler>>24&255),pn(t,i.total_in&255),pn(t,i.total_in>>8&255),pn(t,i.total_in>>16&255),pn(t,i.total_in>>24&255)):(Ac(t,i.adler>>>16),Ac(t,i.adler&65535)),Oo(i),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?xr:NS)},D0=i=>{if(Pc(i))return xi;let e=i.state.status;return i.state=null,e===us?ps(i,s0):xr},M0=(i,e)=>{let t=e.length;if(Pc(i))return xi;let n=i.state,r=n.wrap;if(r===2||r===1&&n.status!==sl||n.lookahead)return xi;if(r===1&&(i.adler=Nc(i.adler,e,t,0)),n.wrap=0,t>=n.w_size){r===0&&(Ia(n.head),n.strstart=0,n.block_start=0,n.insert=0);let l=new Uint8Array(n.w_size);l.set(e.subarray(t-n.w_size,t),0),e=l,t=n.w_size}let o=i.avail_in,a=i.next_in,s=i.input;for(i.avail_in=t,i.next_in=0,i.input=e,ll(n);n.lookahead>=Zt;){let l=n.strstart,d=n.lookahead-(Zt-1);do n.ins_h=wa(n,n.ins_h,n.window[l+Zt-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++;while(--d);n.strstart=l,n.lookahead=Zt-1,ll(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=Zt-1,n.match_available=0,i.next_in=a,i.input=s,i.avail_in=o,n.wrap=r,xr},L0=x0,B0=Ey,V0=vy,k0=Iy,U0=F0,G0=P0,H0=D0,z0=M0,W0="pako deflate (from Nodeca project)",Tc={deflateInit:L0,deflateInit2:B0,deflateReset:V0,deflateResetKeep:k0,deflateSetHeader:U0,deflate:G0,deflateEnd:H0,deflateSetDictionary:z0,deflateInfo:W0},Q0=(i,e)=>Object.prototype.hasOwnProperty.call(i,e),K0=function(i){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let n in t)Q0(t,n)&&(i[n]=t[n])}}return i},q0=i=>{let e=0;for(let n=0,r=i.length;n<r;n++)e+=i[n].length;let t=new Uint8Array(e);for(let n=0,r=0,o=i.length;n<o;n++){let a=i[n];t.set(a,r),r+=a.length}return t},Lu={assign:K0,flattenChunks:q0},Cy=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Cy=!1}var Rc=new Uint8Array(256);for(let i=0;i<256;i++)Rc[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;Rc[254]=Rc[254]=1;var Y0=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let e,t,n,r,o,a=i.length,s=0;for(r=0;r<a;r++)t=i.charCodeAt(r),(t&64512)===55296&&r+1<a&&(n=i.charCodeAt(r+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),r++)),s+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(s),o=0,r=0;o<s;r++)t=i.charCodeAt(r),(t&64512)===55296&&r+1<a&&(n=i.charCodeAt(r+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),r++)),t<128?e[o++]=t:t<2048?(e[o++]=192|t>>>6,e[o++]=128|t&63):t<65536?(e[o++]=224|t>>>12,e[o++]=128|t>>>6&63,e[o++]=128|t&63):(e[o++]=240|t>>>18,e[o++]=128|t>>>12&63,e[o++]=128|t>>>6&63,e[o++]=128|t&63);return e},X0=(i,e)=>{if(e<65534&&i.subarray&&Cy)return String.fromCharCode.apply(null,i.length===e?i:i.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(i[n]);return t},j0=(i,e)=>{let t=e||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,e));let n,r,o=new Array(t*2);for(r=0,n=0;n<t;){let a=i[n++];if(a<128){o[r++]=a;continue}let s=Rc[a];if(s>4){o[r++]=65533,n+=s-1;continue}for(a&=s===2?31:s===3?15:7;s>1&&n<t;)a=a<<6|i[n++]&63,s--;if(s>1){o[r++]=65533;continue}a<65536?o[r++]=a:(a-=65536,o[r++]=55296|a>>10&1023,o[r++]=56320|a&1023)}return X0(o,r)},Z0=(i,e)=>{e=e||i.length,e>i.length&&(e=i.length);let t=e-1;for(;t>=0&&(i[t]&192)===128;)t--;return t<0||t===0?e:t+Rc[i[t]]>e?t:e},Oc={string2buf:Y0,buf2string:j0,utf8border:Z0};function $0(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var wy=$0,Ny=Object.prototype.toString,{Z_NO_FLUSH:J0,Z_SYNC_FLUSH:eC,Z_FULL_FLUSH:tC,Z_FINISH:nC,Z_OK:Pu,Z_STREAM_END:rC,Z_DEFAULT_COMPRESSION:oC,Z_DEFAULT_STRATEGY:iC,Z_DEFLATED:aC}=dl;function Dc(i){this.options=Lu.assign({level:oC,method:aC,chunkSize:16384,windowBits:15,memLevel:8,strategy:iC},i||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new wy,this.strm.avail_out=0;let t=Tc.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==Pu)throw new Error(hs[t]);if(e.header&&Tc.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=Oc.string2buf(e.dictionary):Ny.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=Tc.deflateSetDictionary(this.strm,n),t!==Pu)throw new Error(hs[t]);this._dict_set=!0}}Dc.prototype.push=function(i,e){let t=this.strm,n=this.options.chunkSize,r,o;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?nC:J0,typeof i=="string"?t.input=Oc.string2buf(i):Ny.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(o===eC||o===tC)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(r=Tc.deflate(t,o),r===rC)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),r=Tc.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Pu;if(t.avail_out===0){this.onData(t.output);continue}if(o>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};Dc.prototype.onData=function(i){this.chunks.push(i)};Dc.prototype.onEnd=function(i){i===Pu&&(this.result=Lu.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function Jm(i,e){let t=new Dc(e);if(t.push(i,!0),t.err)throw t.msg||hs[t.err];return t.result}function sC(i,e){return e=e||{},e.raw=!0,Jm(i,e)}function lC(i,e){return e=e||{},e.gzip=!0,Jm(i,e)}var cC=Dc,dC=Jm,uC=sC,pC=lC,hC=dl,mC={Deflate:cC,deflate:dC,deflateRaw:uC,gzip:pC,constants:hC},wu=16209,gC=16191,fC=function(e,t){let n,r,o,a,s,l,d,c,p,u,h,f,_,m,A,y,S,g,b,T,I,O,w,P,H=e.state;n=e.next_in,w=e.input,r=n+(e.avail_in-5),o=e.next_out,P=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),l=H.dmax,d=H.wsize,c=H.whave,p=H.wnext,u=H.window,h=H.hold,f=H.bits,_=H.lencode,m=H.distcode,A=(1<<H.lenbits)-1,y=(1<<H.distbits)-1;e:do{f<15&&(h+=w[n++]<<f,f+=8,h+=w[n++]<<f,f+=8),S=_[h&A];t:for(;;){if(g=S>>>24,h>>>=g,f-=g,g=S>>>16&255,g===0)P[o++]=S&65535;else if(g&16){b=S&65535,g&=15,g&&(f<g&&(h+=w[n++]<<f,f+=8),b+=h&(1<<g)-1,h>>>=g,f-=g),f<15&&(h+=w[n++]<<f,f+=8,h+=w[n++]<<f,f+=8),S=m[h&y];n:for(;;){if(g=S>>>24,h>>>=g,f-=g,g=S>>>16&255,g&16){if(T=S&65535,g&=15,f<g&&(h+=w[n++]<<f,f+=8,f<g&&(h+=w[n++]<<f,f+=8)),T+=h&(1<<g)-1,T>l){e.msg="invalid distance too far back",H.mode=wu;break e}if(h>>>=g,f-=g,g=o-a,T>g){if(g=T-g,g>c&&H.sane){e.msg="invalid distance too far back",H.mode=wu;break e}if(I=0,O=u,p===0){if(I+=d-g,g<b){b-=g;do P[o++]=u[I++];while(--g);I=o-T,O=P}}else if(p<g){if(I+=d+p-g,g-=p,g<b){b-=g;do P[o++]=u[I++];while(--g);if(I=0,p<b){g=p,b-=g;do P[o++]=u[I++];while(--g);I=o-T,O=P}}}else if(I+=p-g,g<b){b-=g;do P[o++]=u[I++];while(--g);I=o-T,O=P}for(;b>2;)P[o++]=O[I++],P[o++]=O[I++],P[o++]=O[I++],b-=3;b&&(P[o++]=O[I++],b>1&&(P[o++]=O[I++]))}else{I=o-T;do P[o++]=P[I++],P[o++]=P[I++],P[o++]=P[I++],b-=3;while(b>2);b&&(P[o++]=P[I++],b>1&&(P[o++]=P[I++]))}}else if(g&64){e.msg="invalid distance code",H.mode=wu;break e}else{S=m[(S&65535)+(h&(1<<g)-1)];continue n}break}}else if(g&64)if(g&32){H.mode=gC;break e}else{e.msg="invalid literal/length code",H.mode=wu;break e}else{S=_[(S&65535)+(h&(1<<g)-1)];continue t}break}}while(n<r&&o<s);b=f>>3,n-=b,f-=b<<3,h&=(1<<f)-1,e.next_in=n,e.next_out=o,e.avail_in=n<r?5+(r-n):5-(n-r),e.avail_out=o<s?257+(s-o):257-(o-s),H.hold=h,H.bits=f},il=15,OS=852,FS=592,xS=0,Fm=1,PS=2,_C=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),AC=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),SC=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),yC=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),bC=(i,e,t,n,r,o,a,s)=>{let l=s.bits,d=0,c=0,p=0,u=0,h=0,f=0,_=0,m=0,A=0,y=0,S,g,b,T,I,O=null,w,P=new Uint16Array(il+1),H=new Uint16Array(il+1),re=null,q,W,x;for(d=0;d<=il;d++)P[d]=0;for(c=0;c<n;c++)P[e[t+c]]++;for(h=l,u=il;u>=1&&P[u]===0;u--);if(h>u&&(h=u),u===0)return r[o++]=1<<24|64<<16|0,r[o++]=1<<24|64<<16|0,s.bits=1,0;for(p=1;p<u&&P[p]===0;p++);for(h<p&&(h=p),m=1,d=1;d<=il;d++)if(m<<=1,m-=P[d],m<0)return-1;if(m>0&&(i===xS||u!==1))return-1;for(H[1]=0,d=1;d<il;d++)H[d+1]=H[d]+P[d];for(c=0;c<n;c++)e[t+c]!==0&&(a[H[e[t+c]]++]=c);if(i===xS?(O=re=a,w=20):i===Fm?(O=_C,re=AC,w=257):(O=SC,re=yC,w=0),y=0,c=0,d=p,I=o,f=h,_=0,b=-1,A=1<<h,T=A-1,i===Fm&&A>OS||i===PS&&A>FS)return 1;for(;;){q=d-_,a[c]+1<w?(W=0,x=a[c]):a[c]>=w?(W=re[a[c]-w],x=O[a[c]-w]):(W=32+64,x=0),S=1<<d-_,g=1<<f,p=g;do g-=S,r[I+(y>>_)+g]=q<<24|W<<16|x|0;while(g!==0);for(S=1<<d-1;y&S;)S>>=1;if(S!==0?(y&=S-1,y+=S):y=0,c++,--P[d]===0){if(d===u)break;d=e[t+a[c]]}if(d>h&&(y&T)!==b){for(_===0&&(_=h),I+=p,f=d-_,m=1<<f;f+_<u&&(m-=P[f+_],!(m<=0));)f++,m<<=1;if(A+=1<<f,i===Fm&&A>OS||i===PS&&A>FS)return 1;b=y&T,r[b]=h<<24|f<<16|I-o|0}}return y!==0&&(r[I+y]=d-_<<24|64<<16|0),s.bits=h,0},Ic=bC,TC=0,Ry=1,Oy=2,{Z_FINISH:DS,Z_BLOCK:IC,Z_TREES:Nu,Z_OK:gs,Z_STREAM_END:vC,Z_NEED_DICT:EC,Z_STREAM_ERROR:ti,Z_DATA_ERROR:Fy,Z_MEM_ERROR:xy,Z_BUF_ERROR:CC,Z_DEFLATED:MS}=dl,Bu=16180,LS=16181,BS=16182,VS=16183,kS=16184,US=16185,GS=16186,HS=16187,zS=16188,WS=16189,Du=16190,ra=16191,xm=16192,QS=16193,Pm=16194,KS=16195,qS=16196,YS=16197,XS=16198,Ru=16199,Ou=16200,jS=16201,ZS=16202,$S=16203,JS=16204,ey=16205,Dm=16206,ty=16207,ny=16208,Ln=16209,Py=16210,Dy=16211,wC=852,NC=592,RC=15,OC=RC,ry=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function FC(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var fs=i=>{if(!i)return 1;let e=i.state;return!e||e.strm!==i||e.mode<Bu||e.mode>Dy?1:0},My=i=>{if(fs(i))return ti;let e=i.state;return i.total_in=i.total_out=e.total=0,i.msg="",e.wrap&&(i.adler=e.wrap&1),e.mode=Bu,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(wC),e.distcode=e.distdyn=new Int32Array(NC),e.sane=1,e.back=-1,gs},Ly=i=>{if(fs(i))return ti;let e=i.state;return e.wsize=0,e.whave=0,e.wnext=0,My(i)},By=(i,e)=>{let t;if(fs(i))return ti;let n=i.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?ti:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,Ly(i))},Vy=(i,e)=>{if(!i)return ti;let t=new FC;i.state=t,t.strm=i,t.window=null,t.mode=Bu;let n=By(i,e);return n!==gs&&(i.state=null),n},xC=i=>Vy(i,OC),oy=!0,Mm,Lm,PC=i=>{if(oy){Mm=new Int32Array(512),Lm=new Int32Array(32);let e=0;for(;e<144;)i.lens[e++]=8;for(;e<256;)i.lens[e++]=9;for(;e<280;)i.lens[e++]=7;for(;e<288;)i.lens[e++]=8;for(Ic(Ry,i.lens,0,288,Mm,0,i.work,{bits:9}),e=0;e<32;)i.lens[e++]=5;Ic(Oy,i.lens,0,32,Lm,0,i.work,{bits:5}),oy=!1}i.lencode=Mm,i.lenbits=9,i.distcode=Lm,i.distbits=5},ky=(i,e,t,n)=>{let r,o=i.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(e.subarray(t-o.wsize,t),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>n&&(r=n),o.window.set(e.subarray(t-n,t-n+r),o.wnext),n-=r,n?(o.window.set(e.subarray(t-n,t),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0},DC=(i,e)=>{let t,n,r,o,a,s,l,d,c,p,u,h,f,_,m=0,A,y,S,g,b,T,I,O,w=new Uint8Array(4),P,H,re=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(fs(i)||!i.output||!i.input&&i.avail_in!==0)return ti;t=i.state,t.mode===ra&&(t.mode=xm),a=i.next_out,r=i.output,l=i.avail_out,o=i.next_in,n=i.input,s=i.avail_in,d=t.hold,c=t.bits,p=s,u=l,O=gs;e:for(;;)switch(t.mode){case Bu:if(t.wrap===0){t.mode=xm;break}for(;c<16;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(t.wrap&2&&d===35615){t.wbits===0&&(t.wbits=15),t.check=0,w[0]=d&255,w[1]=d>>>8&255,t.check=Er(t.check,w,2,0),d=0,c=0,t.mode=LS;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((d&255)<<8)+(d>>8))%31){i.msg="incorrect header check",t.mode=Ln;break}if((d&15)!==MS){i.msg="unknown compression method",t.mode=Ln;break}if(d>>>=4,c-=4,I=(d&15)+8,t.wbits===0&&(t.wbits=I),I>15||I>t.wbits){i.msg="invalid window size",t.mode=Ln;break}t.dmax=1<<t.wbits,t.flags=0,i.adler=t.check=1,t.mode=d&512?WS:ra,d=0,c=0;break;case LS:for(;c<16;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(t.flags=d,(t.flags&255)!==MS){i.msg="unknown compression method",t.mode=Ln;break}if(t.flags&57344){i.msg="unknown header flags set",t.mode=Ln;break}t.head&&(t.head.text=d>>8&1),t.flags&512&&t.wrap&4&&(w[0]=d&255,w[1]=d>>>8&255,t.check=Er(t.check,w,2,0)),d=0,c=0,t.mode=BS;case BS:for(;c<32;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}t.head&&(t.head.time=d),t.flags&512&&t.wrap&4&&(w[0]=d&255,w[1]=d>>>8&255,w[2]=d>>>16&255,w[3]=d>>>24&255,t.check=Er(t.check,w,4,0)),d=0,c=0,t.mode=VS;case VS:for(;c<16;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}t.head&&(t.head.xflags=d&255,t.head.os=d>>8),t.flags&512&&t.wrap&4&&(w[0]=d&255,w[1]=d>>>8&255,t.check=Er(t.check,w,2,0)),d=0,c=0,t.mode=kS;case kS:if(t.flags&1024){for(;c<16;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}t.length=d,t.head&&(t.head.extra_len=d),t.flags&512&&t.wrap&4&&(w[0]=d&255,w[1]=d>>>8&255,t.check=Er(t.check,w,2,0)),d=0,c=0}else t.head&&(t.head.extra=null);t.mode=US;case US:if(t.flags&1024&&(h=t.length,h>s&&(h=s),h&&(t.head&&(I=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(o,o+h),I)),t.flags&512&&t.wrap&4&&(t.check=Er(t.check,n,h,o)),s-=h,o+=h,t.length-=h),t.length))break e;t.length=0,t.mode=GS;case GS:if(t.flags&2048){if(s===0)break e;h=0;do I=n[o+h++],t.head&&I&&t.length<65536&&(t.head.name+=String.fromCharCode(I));while(I&&h<s);if(t.flags&512&&t.wrap&4&&(t.check=Er(t.check,n,h,o)),s-=h,o+=h,I)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=HS;case HS:if(t.flags&4096){if(s===0)break e;h=0;do I=n[o+h++],t.head&&I&&t.length<65536&&(t.head.comment+=String.fromCharCode(I));while(I&&h<s);if(t.flags&512&&t.wrap&4&&(t.check=Er(t.check,n,h,o)),s-=h,o+=h,I)break e}else t.head&&(t.head.comment=null);t.mode=zS;case zS:if(t.flags&512){for(;c<16;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(t.wrap&4&&d!==(t.check&65535)){i.msg="header crc mismatch",t.mode=Ln;break}d=0,c=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),i.adler=t.check=0,t.mode=ra;break;case WS:for(;c<32;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}i.adler=t.check=ry(d),d=0,c=0,t.mode=Du;case Du:if(t.havedict===0)return i.next_out=a,i.avail_out=l,i.next_in=o,i.avail_in=s,t.hold=d,t.bits=c,EC;i.adler=t.check=1,t.mode=ra;case ra:if(e===IC||e===Nu)break e;case xm:if(t.last){d>>>=c&7,c-=c&7,t.mode=Dm;break}for(;c<3;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}switch(t.last=d&1,d>>>=1,c-=1,d&3){case 0:t.mode=QS;break;case 1:if(PC(t),t.mode=Ru,e===Nu){d>>>=2,c-=2;break e}break;case 2:t.mode=qS;break;case 3:i.msg="invalid block type",t.mode=Ln}d>>>=2,c-=2;break;case QS:for(d>>>=c&7,c-=c&7;c<32;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if((d&65535)!==(d>>>16^65535)){i.msg="invalid stored block lengths",t.mode=Ln;break}if(t.length=d&65535,d=0,c=0,t.mode=Pm,e===Nu)break e;case Pm:t.mode=KS;case KS:if(h=t.length,h){if(h>s&&(h=s),h>l&&(h=l),h===0)break e;r.set(n.subarray(o,o+h),a),s-=h,o+=h,l-=h,a+=h,t.length-=h;break}t.mode=ra;break;case qS:for(;c<14;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(t.nlen=(d&31)+257,d>>>=5,c-=5,t.ndist=(d&31)+1,d>>>=5,c-=5,t.ncode=(d&15)+4,d>>>=4,c-=4,t.nlen>286||t.ndist>30){i.msg="too many length or distance symbols",t.mode=Ln;break}t.have=0,t.mode=YS;case YS:for(;t.have<t.ncode;){for(;c<3;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}t.lens[re[t.have++]]=d&7,d>>>=3,c-=3}for(;t.have<19;)t.lens[re[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,P={bits:t.lenbits},O=Ic(TC,t.lens,0,19,t.lencode,0,t.work,P),t.lenbits=P.bits,O){i.msg="invalid code lengths set",t.mode=Ln;break}t.have=0,t.mode=XS;case XS:for(;t.have<t.nlen+t.ndist;){for(;m=t.lencode[d&(1<<t.lenbits)-1],A=m>>>24,y=m>>>16&255,S=m&65535,!(A<=c);){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(S<16)d>>>=A,c-=A,t.lens[t.have++]=S;else{if(S===16){for(H=A+2;c<H;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(d>>>=A,c-=A,t.have===0){i.msg="invalid bit length repeat",t.mode=Ln;break}I=t.lens[t.have-1],h=3+(d&3),d>>>=2,c-=2}else if(S===17){for(H=A+3;c<H;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}d>>>=A,c-=A,I=0,h=3+(d&7),d>>>=3,c-=3}else{for(H=A+7;c<H;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}d>>>=A,c-=A,I=0,h=11+(d&127),d>>>=7,c-=7}if(t.have+h>t.nlen+t.ndist){i.msg="invalid bit length repeat",t.mode=Ln;break}for(;h--;)t.lens[t.have++]=I}}if(t.mode===Ln)break;if(t.lens[256]===0){i.msg="invalid code -- missing end-of-block",t.mode=Ln;break}if(t.lenbits=9,P={bits:t.lenbits},O=Ic(Ry,t.lens,0,t.nlen,t.lencode,0,t.work,P),t.lenbits=P.bits,O){i.msg="invalid literal/lengths set",t.mode=Ln;break}if(t.distbits=6,t.distcode=t.distdyn,P={bits:t.distbits},O=Ic(Oy,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,P),t.distbits=P.bits,O){i.msg="invalid distances set",t.mode=Ln;break}if(t.mode=Ru,e===Nu)break e;case Ru:t.mode=Ou;case Ou:if(s>=6&&l>=258){i.next_out=a,i.avail_out=l,i.next_in=o,i.avail_in=s,t.hold=d,t.bits=c,fC(i,u),a=i.next_out,r=i.output,l=i.avail_out,o=i.next_in,n=i.input,s=i.avail_in,d=t.hold,c=t.bits,t.mode===ra&&(t.back=-1);break}for(t.back=0;m=t.lencode[d&(1<<t.lenbits)-1],A=m>>>24,y=m>>>16&255,S=m&65535,!(A<=c);){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(y&&!(y&240)){for(g=A,b=y,T=S;m=t.lencode[T+((d&(1<<g+b)-1)>>g)],A=m>>>24,y=m>>>16&255,S=m&65535,!(g+A<=c);){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}d>>>=g,c-=g,t.back+=g}if(d>>>=A,c-=A,t.back+=A,t.length=S,y===0){t.mode=ey;break}if(y&32){t.back=-1,t.mode=ra;break}if(y&64){i.msg="invalid literal/length code",t.mode=Ln;break}t.extra=y&15,t.mode=jS;case jS:if(t.extra){for(H=t.extra;c<H;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}t.length+=d&(1<<t.extra)-1,d>>>=t.extra,c-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=ZS;case ZS:for(;m=t.distcode[d&(1<<t.distbits)-1],A=m>>>24,y=m>>>16&255,S=m&65535,!(A<=c);){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(!(y&240)){for(g=A,b=y,T=S;m=t.distcode[T+((d&(1<<g+b)-1)>>g)],A=m>>>24,y=m>>>16&255,S=m&65535,!(g+A<=c);){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}d>>>=g,c-=g,t.back+=g}if(d>>>=A,c-=A,t.back+=A,y&64){i.msg="invalid distance code",t.mode=Ln;break}t.offset=S,t.extra=y&15,t.mode=$S;case $S:if(t.extra){for(H=t.extra;c<H;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}t.offset+=d&(1<<t.extra)-1,d>>>=t.extra,c-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){i.msg="invalid distance too far back",t.mode=Ln;break}t.mode=JS;case JS:if(l===0)break e;if(h=u-l,t.offset>h){if(h=t.offset-h,h>t.whave&&t.sane){i.msg="invalid distance too far back",t.mode=Ln;break}h>t.wnext?(h-=t.wnext,f=t.wsize-h):f=t.wnext-h,h>t.length&&(h=t.length),_=t.window}else _=r,f=a-t.offset,h=t.length;h>l&&(h=l),l-=h,t.length-=h;do r[a++]=_[f++];while(--h);t.length===0&&(t.mode=Ou);break;case ey:if(l===0)break e;r[a++]=t.length,l--,t.mode=Ou;break;case Dm:if(t.wrap){for(;c<32;){if(s===0)break e;s--,d|=n[o++]<<c,c+=8}if(u-=l,i.total_out+=u,t.total+=u,t.wrap&4&&u&&(i.adler=t.check=t.flags?Er(t.check,r,u,a-u):Nc(t.check,r,u,a-u)),u=l,t.wrap&4&&(t.flags?d:ry(d))!==t.check){i.msg="incorrect data check",t.mode=Ln;break}d=0,c=0}t.mode=ty;case ty:if(t.wrap&&t.flags){for(;c<32;){if(s===0)break e;s--,d+=n[o++]<<c,c+=8}if(t.wrap&4&&d!==(t.total&4294967295)){i.msg="incorrect length check",t.mode=Ln;break}d=0,c=0}t.mode=ny;case ny:O=vC;break e;case Ln:O=Fy;break e;case Py:return xy;case Dy:default:return ti}return i.next_out=a,i.avail_out=l,i.next_in=o,i.avail_in=s,t.hold=d,t.bits=c,(t.wsize||u!==i.avail_out&&t.mode<Ln&&(t.mode<Dm||e!==DS))&&ky(i,i.output,i.next_out,u-i.avail_out),p-=i.avail_in,u-=i.avail_out,i.total_in+=p,i.total_out+=u,t.total+=u,t.wrap&4&&u&&(i.adler=t.check=t.flags?Er(t.check,r,u,i.next_out-u):Nc(t.check,r,u,i.next_out-u)),i.data_type=t.bits+(t.last?64:0)+(t.mode===ra?128:0)+(t.mode===Ru||t.mode===Pm?256:0),(p===0&&u===0||e===DS)&&O===gs&&(O=CC),O},MC=i=>{if(fs(i))return ti;let e=i.state;return e.window&&(e.window=null),i.state=null,gs},LC=(i,e)=>{if(fs(i))return ti;let t=i.state;return t.wrap&2?(t.head=e,e.done=!1,gs):ti},BC=(i,e)=>{let t=e.length,n,r,o;return fs(i)||(n=i.state,n.wrap!==0&&n.mode!==Du)?ti:n.mode===Du&&(r=1,r=Nc(r,e,t,0),r!==n.check)?Fy:(o=ky(i,e,t,t),o?(n.mode=Py,xy):(n.havedict=1,gs))},VC=Ly,kC=By,UC=My,GC=xC,HC=Vy,zC=DC,WC=MC,QC=LC,KC=BC,qC="pako inflate (from Nodeca project)",ia={inflateReset:VC,inflateReset2:kC,inflateResetKeep:UC,inflateInit:GC,inflateInit2:HC,inflate:zC,inflateEnd:WC,inflateGetHeader:QC,inflateSetDictionary:KC,inflateInfo:qC};function YC(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var XC=YC,Uy=Object.prototype.toString,{Z_NO_FLUSH:jC,Z_FINISH:ZC,Z_OK:Fc,Z_STREAM_END:Bm,Z_NEED_DICT:Vm,Z_STREAM_ERROR:$C,Z_DATA_ERROR:iy,Z_MEM_ERROR:JC}=dl;function Mc(i){this.options=Lu.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(i&&i.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new wy,this.strm.avail_out=0;let t=ia.inflateInit2(this.strm,e.windowBits);if(t!==Fc)throw new Error(hs[t]);if(this.header=new XC,ia.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Oc.string2buf(e.dictionary):Uy.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=ia.inflateSetDictionary(this.strm,e.dictionary),t!==Fc)))throw new Error(hs[t])}Mc.prototype.push=function(i,e){let t=this.strm,n=this.options.chunkSize,r=this.options.dictionary,o,a,s;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?ZC:jC,Uy.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),o=ia.inflate(t,a),o===Vm&&r&&(o=ia.inflateSetDictionary(t,r),o===Fc?o=ia.inflate(t,a):o===iy&&(o=Vm));t.avail_in>0&&o===Bm&&t.state.wrap>0&&i[t.next_in]!==0;)ia.inflateReset(t),o=ia.inflate(t,a);switch(o){case $C:case iy:case Vm:case JC:return this.onEnd(o),this.ended=!0,!1}if(s=t.avail_out,t.next_out&&(t.avail_out===0||o===Bm))if(this.options.to==="string"){let l=Oc.utf8border(t.output,t.next_out),d=t.next_out-l,c=Oc.buf2string(t.output,l);t.next_out=d,t.avail_out=n-d,d&&t.output.set(t.output.subarray(l,l+d),0),this.onData(c)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(o===Fc&&s===0)){if(o===Bm)return o=ia.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Mc.prototype.onData=function(i){this.chunks.push(i)};Mc.prototype.onEnd=function(i){i===Fc&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Lu.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function eg(i,e){let t=new Mc(e);if(t.push(i),t.err)throw t.msg||hs[t.err];return t.result}function e1(i,e){return e=e||{},e.raw=!0,eg(i,e)}var t1=Mc,n1=eg,r1=e1,o1=eg,i1=dl,a1={Inflate:t1,inflate:n1,inflateRaw:r1,ungzip:o1,constants:i1},{Deflate:Cx,deflate:wx,deflateRaw:s1,gzip:Nx}=mC,{Inflate:Rx,inflate:Ox,inflateRaw:l1,ungzip:Fx}=a1;var Gy=s1;var Hy=l1;var Di;(t=>{function i(n){return Hy(n)}t.inflateRaw=i;function e(n){return Gy(n)}t.deflateRaw=e})(Di||(Di={}));var Vu;(n=>{class i{constructor(){}}n.Error=i;let r=class r{_decode(a){for(this._count=a.length,this._view=vu.DataView_new1(a),(this._readInt()!=r._ID(137,80,78,71)||this._readInt()!=r._ID(13,10,26,10))&&r._fail();this._offset+12<=this._count;){let s=this._offset,l=this._readInt(),d=this._readInt(),c=s+8,p=c+l;switch(s+12+l>this._count&&(console.error("truncated png image"),r._fail()),d){case r._ID(73,72,68,82):{let u=this._readInt(),h=this._readInt(),f=this._readByte(),_=this._readByte(),m=this._readByte(),A=this._readByte(),y=this._readByte(),S=u<=0||h<=0||m!=0||A!=0||y!=0&&y!=1;if(!S)switch(_){case r.COLOR_TYPE_GRAY:{S=f!=1&&f!=2&&f!=4&&f!=8&&f!=16;break}case r.COLOR_TYPE_INDEXED:{S=f!=1&&f!=2&&f!=4&&f!=8;break}case r.COLOR_TYPE_RGB:case r.COLOR_TYPE_GRAY_ALPHA:case r.COLOR_TYPE_RGBA:{S=f!=8&&f!=16;break}default:{S=!0;break}}S&&(console.error("invalid png header"),r._fail()),this._width=u,this._height=h,this._bitDepth=f,this._colorType=_,this._isInterlaced=y==1;break}case r._ID(80,76,84,69):{this._palette=a.subarray(c,p),(l<3||l>256*3||At.int_remainder(l,3)!=0)&&(console.error("invalid palette in png image"),r._fail());break}case r._ID(73,68,65,84):{this._dataStreamChunks.push(a.subarray(c,p)),this._dataStreamCount=this._dataStreamCount+l;break}case r._ID(116,82,78,83):{this._transparency=a.subarray(c,p);break}case r._ID(73,69,78,68):return n.DEBUG_LOG&&console.log(`png header: ${this._width}x${this._height}, ${this._bitDepth} bits per sample, `+new Map([[r.COLOR_TYPE_GRAY,"gray"],[r.COLOR_TYPE_RGB,"rgb"],[r.COLOR_TYPE_INDEXED,"indexed"],[r.COLOR_TYPE_GRAY_ALPHA,"gray_alpha"],[r.COLOR_TYPE_RGBA,"rgba"]]).get(this._colorType)+(this._isInterlaced?", interlaced":", non_interlaced")),this._decodeImage();default:{n.DEBUG_LOG&&console.warn(`unsupported png chunk '${Wn.string_fromCodePoints([d>>>24,d>>16&255,d>>8&255,d&255])}'`);break}}this._offset=s+l+12}return r._fail(),null}_readInt(){return this._offset=this._offset+4,this._offset>this._count&&(console.error("truncated png image"),r._fail()),this._view.getInt32(this._offset-4)}_readByte(){return this._offset=this._offset+1,this._offset>this._count&&(console.error("truncated png image"),r._fail()),this._view.getUint8(this._offset-1)}_decompressStream(){let a=new Uint8Array(this._dataStreamCount),s=0;for(let d of this._dataStreamChunks)a.set(d,s),s=s+d.length;let l=null;try{l=Di.inflateRaw(a.subarray(2))}catch{console.error("invalid zip stream in png image"),r._fail()}return l}_decodeImage(){(this._width<=0||this._height<=0||this._dataStreamCount==0)&&(console.error("incomplete png image"),r._fail());let a=this._decompressStream(),s=this._colorType==r.COLOR_TYPE_GRAY_ALPHA?2:this._colorType==r.COLOR_TYPE_RGB?3:this._colorType==r.COLOR_TYPE_RGBA?4:1,l=this._bitDepth*s,d=l+7>>3,c=this._width*l+7>>3,p=new Uint8Array(c*this._height),u=0;a.length!=(c+1)*this._height&&(console.error("invalid decompressed png stream"),r._fail());for(let _=0,m=this._height;_<m;_=_+1){let A=_*c,y=A-d,S=A-c,g=S-d,b=a[u];switch(u=u+1,b){case r.FILTER_TYPE_NONE:{p.set(a.subarray(u,u+c),A),u=u+c;break}case r.FILTER_TYPE_SUB:{for(let T=0,I=c;T<I;T=T+1)p[A+T]=a[u]+(T<d?0:p[y+T]),u=u+1;break}case r.FILTER_TYPE_UP:{for(let T=0,I=c;T<I;T=T+1)p[A+T]=a[u]+(_==0?0:p[S+T]),u=u+1;break}case r.FILTER_TYPE_AVERAGE:{for(let T=0,I=c;T<I;T=T+1){let O=T<d?0:p[y+T],w=_==0?0:p[S+T];p[A+T]=a[u]+(O+w>>1),u=u+1}break}case r.FILTER_TYPE_PAETH:{for(let T=0,I=c;T<I;T=T+1){let O=T<d?0:p[y+T],w=_==0?0:p[S+T],P=T<d||_==0?0:p[g+T],H=O+w-P,re=Math.abs(H-O),q=Math.abs(H-w),W=Math.abs(H-P);p[A+T]=a[u]+(re<=q&&re<=W?O:q<=W?w:P),u=u+1}break}default:{console.error(`invalid png filter type ${b}`),r._fail();break}}}if(this._bitDepth==16){let _=new Uint8Array(p.length>>1);for(let m=0,A=_.length;m<A;m=m+1)_[m]=p[m*2];p=_,l>>=1,d>>=1,c>>=1,this._bitDepth=8}let h=this._width*this._height*4,f=s==4?p:new Uint8Array(h);switch(s){case 1:{let _=0,m=0,A=(1<<l)-1,y=A==1?255:255/A|0,S=this._colorType==r.COLOR_TYPE_INDEXED,g=this._palette,b=g!=null?g.length:0,T=this._transparency,I=T!=null?T.length:0;for(let O=0,w=this._height;O<w;O=O+1){let P=0,H=0;for(let re=0,q=this._width;re<q;re=re+1){P==0&&(H=p[_],P=8,_=_+1),P=P-l;let W=H>>P&A;if(S){let x=W*3;x>b-3&&(console.error(`invalid palette index ${W} in png image`),r._fail()),f[m]=g[x],f[m+1]=g[x+1],f[m+2]=g[x+2]}else W=W*y,f[m]=W,f[m+1]=W,f[m+2]=W;f[m+3]=S&&W<I?T[W]:255,m=m+4}}break}case 2:{for(let _=0,m=0;m<h;_=_+2,m=m+4){let A=p[_];f[m]=A,f[m+1]=A,f[m+2]=A,f[m+3]=p[_+1]}break}case 3:{for(let _=0,m=0;m<h;_=_+3,m=m+4){let A=p[_],y=p[_+1],S=p[_+2];f[m]=A,f[m+1]=y,f[m+2]=S,f[m+3]=255}break}}return new yn(0,this._width,this._height,f)}static _fail(){throw new i}static _ID(a,s,l,d){return a<<24|s<<16|l<<8|d}static decodeBytes(a){return new r()._decode(a)}constructor(){this._count=0,this._offset=0,this._palette=null,this._transparency=null,this._view=null,this._dataStreamChunks=[],this._dataStreamCount=0,this._width=0,this._height=0,this._bitDepth=0,this._colorType=0,this._isInterlaced=!1}};r.COLOR_TYPE_GRAY=0,r.COLOR_TYPE_RGB=2,r.COLOR_TYPE_INDEXED=3,r.COLOR_TYPE_GRAY_ALPHA=4,r.COLOR_TYPE_RGBA=6,r.FILTER_TYPE_NONE=0,r.FILTER_TYPE_SUB=1,r.FILTER_TYPE_UP=2,r.FILTER_TYPE_AVERAGE=3,r.FILTER_TYPE_PAETH=4;let e=r;n.Decoder=r,n.DEBUG_LOG=!1})(Vu||(Vu={}));var tg=(n=>(n[n.PENDING=0]="PENDING",n[n.FULFILLED=1]="FULFILLED",n[n.REJECTED=2]="REJECTED",n))(tg||{}),fo=class{constructor(){this._state=0,this._promise=null,this._resolve=null,this._reject=null,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}realPromise(){return this._promise}then1(e){this.then2(e,null)}then2(e,t){this._promise.then(e,t)}resolve(e){return this._state==0&&(this._state=1,this._resolve(e)),this}reject(e){return this._state==0&&(this._state=2,this._reject(e)),this}state(){return this._state}},ku=class ku{constructor(){}};ku.VOID=new ku;var pr=ku,zy;(e=>{function i(t){return tg[t]}e.PromiseState_toString=i})(zy||(zy={}));function Uu(i){Promise.resolve(pr.VOID).then(e=>{i()})}var qy=(r=>(r[r.UNSENT=0]="UNSENT",r[r.SENT=1]="SENT",r[r.CANCELED=2]="CANCELED",r[r.COMPLETE=3]="COMPLETE",r))(qy||{}),Bc=(t=>(t[t.STRING=0]="STRING",t[t.BYTES=1]="BYTES",t))(Bc||{}),Lc=class{constructor(e){this.status=e}},Ur=class{state(){return this._state}get(){return this.send3("GET")}put(){return this.send3("PUT")}head(){return this.send3("HEAD")}setProgressCallback(e){this._progressCallback=e}header(e,t){return this._headers.set(e,t),this}format(e){return this._format=e,this}send1(e,t,n){if(2==0)return this.send3(e);if(Ji==3){this._blob=t;for(let r of Array.from(n.keys()))this._headers.set(r,n.get(r));return this.send3(e)}else throw new Error("unimplemented")}send2(e,t){if(2==0)return this.send3(e);if(Ji==3)return this._blob=t,this.send3(e);throw new Error("unimplemented")}send3(e){if(2==0)return new Promise((t,n)=>{if(Ky==null){n(new Lc(0));return}let r=Ky(this._url);if(r==200){let o=new Gu;o.status=200,t(o)}else n(new Lc(r))});if(Ji==3){this._xhr.open(e,this._url);let t=null,n=null,r=new Promise((o,a)=>{t=o,n=a});r.then(null,o=>{this.cancel()});for(let o of Array.from(this._headers.keys()))this._xhr.setRequestHeader(o,this._headers.get(o));switch(this._format){case 1:{this._xhr.responseType="arraybuffer";break}}return this._xhr.onload=()=>{if(this._state==2)return;let o=new Gu;switch(o.status=this._xhr.status,o.contentType=this._xhr.getResponseHeader("Content-Type"),this._format){case 0:{o.text=this._xhr.response;break}case 1:{o.bytes=new Uint8Array(this._xhr.response);break}}t(o)},this._xhr.onprogress=o=>{this._state!=2&&this._progressCallback!=null&&o.lengthComputable&&this._progressCallback(o.loaded/o.total)},this._xhr.onloadend=()=>{n(new Lc(this._xhr.status))},this._formData!=null?this._xhr.send(this._formData):this._xhr.send(this._blob),this._state=1,r}else throw new Error("unimplemented")}cancel(){if(2!=0)if(Ji==3)this._state==1&&this._xhr.abort(),(this._state==0||this._state==1)&&(this._state=2);else throw new Error("unimplemented")}constructor(e){this._url=e,this._method=null,this._headers=new Map,this._state=0,this._format=0,this._progressCallback=null,this._xhr=new XMLHttpRequest,this._formData=null,this._blob=null}},Gu=class{mimeType(){let e=this.contentType!=null?this.contentType.indexOf(";"):-1;return e!=-1?this.contentType.slice(0,e):this.contentType}wasSuccessful(){return this.status>=200&&this.status<=299}constructor(){this.status=0,this.contentType=null,this.text=null,this.bytes=null}},Wy;(e=>{function i(t){return qy[t]}e.HTTPRequestState_toString=i})(Wy||(Wy={}));var Qy;(e=>{function i(t){return Bc[t]}e.HTTPRequestFormat_toString=i})(Qy||(Qy={}));var Ky=null;var _s=class i{constructor(e){this._worker=null,this._queue=[],this._workerFailedToDownload=!1,this.onmessage=null,this.mainThreadFallback=null;let t=()=>{this._workerFailedToDownload=!0,this.mainThreadFallback!=null&&console.warn(`failed to download worker code from ${e}, falling back to running it on the main thread (this is slower)`);for(let n of this._queue)this.postMessage2(n.message,n.transfer)};new Ur(e).get().then(n=>{if(n.wasSuccessful()){try{this._worker=new Worker(URL.createObjectURL(new Blob([n.text])))}catch{t();return}this._worker.onmessage=r=>{this.onmessage!=null&&this.onmessage(r)};for(let r of this._queue)this.postMessage2(r.message,r.transfer)}else t()},n=>{t()})}postMessage1(e){this.postMessage2(e,null)}postMessage2(e,t){this._workerFailedToDownload?this.mainThreadFallback!=null&&this.onmessage!=null&&setTimeout(()=>{this.onmessage({data:this.mainThreadFallback(e)})},0):this._worker==null?this._queue.push(new i.Item(e,t)):t!=null?this._worker.postMessage(e,t):this._worker.postMessage(e)}};(e=>{class i{constructor(n,r){this.message=n,this.transfer=r}}e.Item=i})(_s||(_s={}));var Ye=class Ye{constructor(){if(arguments[0]==0){let[,e,t,n]=arguments;this.width=0,this.height=0,this.pixels=null,this.gif=null,this.width=e,this.height=t,this.pixels=new Ye.Pixels(0,n)}else if(arguments[0]==1){let[,e]=arguments;this.width=0,this.height=0,this.pixels=null,this.gif=null,this.width=e.width,this.height=e.height,this.pixels=new Ye.Pixels(1,e)}else if(arguments[0]==2){let[,e,t,n]=arguments;this.width=0,this.height=0,this.pixels=null,this.gif=null,this.width=e,this.height=t,this.pixels=new Ye.Pixels(2,n)}else if(arguments[0]==3){let[,e,t,n]=arguments;this.width=0,this.height=0,this.pixels=null,this.gif=null,this.width=e,this.height=t,this.pixels=null,this.gif=n}}static isPowerOf2(e){return e!=0&&(e&e-1)==0}static nextPowerOf2(e){return e=e-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e=e+1,e}isGIF(){return this.gif!=null}pixelAtIndex(e,t){if(e<0||e>=this.width||t<0||t>=this.height)return C.TRANSPARENT;if(this.pixels.array!=null){let n=this.pixels.array,r=t*this.width*4+e*4,o=n[r],a=n[r+1],s=n[r+2],l=n[r+3];return C.new2(o,a,s,l)}else{if(this.pixels.img!=null)throw new Error("pixelAtIndex not implemented for image-based buffers");{let n=lo.HTMLCanvasElement_getContext2D(this.pixels.canvas).getImageData(e,t,1,1).data;return C.new2(n[0],n[1],n[2],n[3])}}}expandToPowerOfTwo(){if(this.isGIF())return console.warn("ImageBuffer#expandToPowerOfTwo: unimplemented for GIF resources"),this;if(this.pixels.array!=null){let e=this.pixels.array,t=Ye.nextPowerOf2(this.width),n=Ye.nextPowerOf2(this.height),r=new Uint8Array(t*n*4);for(let o=0;o<t;o=o+1)for(let a=0;a<n;a=a+1)for(let s=0;s<4;s=s+1)r[s+(o+a*t)*4]=o<this.width&&a<this.height?e[s+(o+a*this.width)*4]:0;return new Ye(0,t,n,r)}else{if(this.pixels.img!=null)throw new Error("expandToPowerOfTwo not implemented for image-based buffers");{let e=document.createElement("canvas");return e.width=Ye.nextPowerOf2(this.width),e.height=Ye.nextPowerOf2(this.height),lo.HTMLCanvasElement_getContext2D(e).drawImage(this.pixels.canvas,0,0,this.pixels.canvas.width,this.pixels.canvas.height),new Ye(1,e)}}}static initialize(){var e;Ye._worker==null&&(Ye._worker=new _s((e=wt.getWorkerURL())!=null?e:"ts-imagedecoder.js"),Ye._worker.mainThreadFallback=t=>Ye.handleWorkerEvent(t),Ye._worker.onmessage=t=>{let n=t.data;if(n==null){console.log("No data received from image decode worker");return}let r=qt.IntMap_get(Ye._pendingRequests,n.id,null);if(r==null)return;if(Ye._pendingRequests.delete(n.id),n.width>0&&n.height>0&&n.pixels!=null){let p=new Ye(0,n.width,n.height,n.pixels);Ye.dimensionsNeedDownsizing(n.width,n.height,Ye.computeMaxRes())&&(console.log("downsampling after worker"),p=Ye._downsampleBilinear(p,Ye.getMaxRes())),console.log(`image decode succeeded, got ${p.width}x${p.height} image`),r.resolve(p);return}else if(n.width>0&&n.height>0&&n.gif!=null){let p=new Ye(3,n.width,n.height,n.gif);console.log(`GIF decode succeeded, got ${p.width}x${p.height} image`),r.resolve(p);return}console.log("image decode failed, falling back to the browser's image decoder instead");let o=jr.HTMLDocument_createElementImage(document),a=Iu.readFromJPEG(r.bytes),s=a!=null?fc.ImageOrientation_rotationDegrees(a.value):0,l=a!=null?fc.ImageOrientation_shouldFlip(a.value):!1,d=URL.createObjectURL(new Blob([r.bytes]));o.onerror=()=>{URL.revokeObjectURL(d),r.reject()};let c=()=>{URL.revokeObjectURL(d);let p=Ye._context!=null?Ye._context:Ye._context=lo.HTMLCanvasElement_getContext2D(jr.HTMLDocument_createElementCanvas(document)),u=p.canvas;if(o.width>0&&o.height>0){console.log(`image decode fallback succeeded, got ${o.width}x${o.height} image`);let h=s==0||s==180?o.width:o.height,f=s==0||s==180?o.height:o.width;u.width=h,u.height=f,p.save(),l&&(p.translate(u.width,0),p.scale(-1,1)),s==90?(p.translate(h,0),p.rotate(s*Math.PI/180)):s==180?(p.translate(h/2|0,f/2|0),p.rotate(s*Math.PI/180),p.translate(-h/2|0,-f/2|0)):s==270&&(p.translate(0,f),p.rotate(s*Math.PI/180)),p.drawImage(o,0,0,o.width,o.height),p.restore();let _=new Ye(0,h,f,new Uint8Array(p.getImageData(0,0,h,f).data.buffer));Ye.dimensionsNeedDownsizing(h,f,Ye.computeMaxRes())&&(_=Ye._downsampleBilinear(_,Ye.getMaxRes())),r.resolve(_);return}console.log("image decode fallback failed, giving up"),r.reject()};o.onload=()=>{X.htmlImageDecodeMethodIsPresent()?o.decode().then(p=>{c()},p=>{jn.trackImageDecodeFailure("Slow decode fallback decode"),c()}):c()},o.src=d})}static setRamInUse(e){Ye._ramInUse=e}static setVRamInUse(e){Ye._vramInUse=e}static setMaxRes(e){Ye._maxRes=e}static getMaxRes(){return Ye._maxRes}static computeMaxRes(){if(!(Xe.isMobile(Xe.current())||Xe.current()==4&&navigator.maxTouchPoints>0||wt.forceMobileOptimizations()))return Ye._maxRes;let e=2048;return Ye._vramInUse>200||Ye._ramInUse>200?e=256:Ye._vramInUse>150||Ye._ramInUse>150?e=512:(Ye._vramInUse>100||Ye._ramInUse>100)&&(e=1024),e!=Ye._maxRes&&(Ye._maxRes=e),e}static decodeImageBuffer(e,t){return e=new Uint8Array(e),new Promise((n,r)=>{Ye.initialize(),Ye._worker.postMessage1(new ng(Ye._nextID,e,Ye.computeMaxRes(),t)),Ye._pendingRequests.set(Ye._nextID,new Ye.PendingRequest(e,n,()=>{r(new pr)})),Ye._nextID=Ye._nextID+1})}static dimensionsNeedDownsizing(e,t,n){return n<=0||e<=Ye._maxRes&&t<=Ye._maxRes&&(e<13||t<13)||e*t<n*n*.5?!1:e>n||t>n}static handleWorkerEvent(e){var n;let t=null;if(e.isGIF)t=Mi.Decoder.decodeBytes(e.bytes);else{try{t=Vu.Decoder.decodeBytes(e.bytes)}catch{}t==null&&(t=Ye._decodeJPEG(e.bytes)),t!=null&&Ye.dimensionsNeedDownsizing(t.width,t.height,e.maxRes)&&(t=Ye._downsampleBilinear(t,e.maxRes))}return new rg(e.id,t!=null?t.width:0,t!=null?t.height:0,t!=null?(n=t.pixels)==null?void 0:n.array:null,t!=null?t.gif:null)}static _decodeJPEG(e){let t=new _c.Decoder;if(t.decodeBytes(e)!=_c.Result.OK)return null;let n=t.width(),r=t.height(),o=t.rgb(),a=new Uint8Array(n*r*4),s=0,l=0;for(let d=0,c=n*r;d<c;d=d+1)a[l]=o[s],a[l+1]=o[s+1],a[l+2]=o[s+2],a[l+3]=255,s=s+3,l=l+4;return new Ye(0,n,r,a)}static redIndex(e,t,n){return(t*n+e)*4}static _downsampleBilinear(e,t){let n=Math.max(e.width,e.height);if(n<=0||t<=0)return e;let r=t/n,o=1/r,a=e.width*r|0,s=e.height*r|0,l=new Uint8Array(a*s*4),d=e.pixels.array;for(let c=0;c<s;c=c+1){let p=o*c,u=p-(p|0),h=c*a*4;for(let f=0;f<a;f=f+1){let _=o*f,m=_-(_|0),A=Ye.redIndex(f*o|0,c*o|0,e.width),y=d[A],S=d[A+1],g=d[A+2],b=d[A+3];f<a-1&&(A=Ye.redIndex((f*o|0)+1,c*o|0,e.width));let T=d[A],I=d[A+1],O=d[A+2],w=d[A+3];c<s-1?A=Ye.redIndex(f*o|0,(c*o|0)+1,e.width):A=Ye.redIndex(f*o|0,c*o|0,e.width);let P=d[A],H=d[A+1],re=d[A+2],q=d[A+3];c<s-1&&f<a-1&&(A=Ye.redIndex((f*o|0)+1,(c*o|0)+1,e.width));let W=d[A],x=d[A+1],F=d[A+2],k=d[A+3],G=1-m,M=1-u;l[h]=(y*G+T*m)*M+(P*G+W*m)*u|0,l[h+1]=(S*G+I*m)*M+(H*G+x*m)*u|0,l[h+2]=(g*G+O*m)*M+(re*G+F*m)*u|0,l[h+3]=(b*G+w*m)*M+(q*G+k*m)*u|0,h=h+4}}return new Ye(0,a,s,l)}};Ye._pendingRequests=new Map,Ye._worker=null,Ye._nextID=0,Ye._context=null,Ye._handleResponse=null,Ye._ramInUse=0,Ye._vramInUse=0,Ye._maxRes=4096;var yn=Ye;(t=>{class i{constructor(){if(arguments[0]==0){let[,r]=arguments;this.array=null,this.canvas=null,this.img=null,this.array=r}else if(arguments[0]==1){let[,r]=arguments;this.array=null,this.canvas=null,this.img=null,this.canvas=r}else if(arguments[0]==2){let[,r]=arguments;this.array=null,this.canvas=null,this.img=null,this.img=r}}}t.Pixels=i;class e{constructor(r,o,a){this.bytes=r,this.resolve=o,this.reject=a}}t.PendingRequest=e})(yn||(yn={}));var Na=(t=>(t[t.ANIMATED=0]="ANIMATED",t[t.STATIC_IMAGE=1]="STATIC_IMAGE",t))(Na||{}),ng=class{constructor(e,t,n,r){this.id=0,this.bytes=null,this.maxRes=0,this.isGIF=!1,this.id=e,this.bytes=t,this.maxRes=n,this.isGIF=r==0}},rg=class i{static empty(e){return new i(e,0,0,null,null)}constructor(e,t,n,r,o){this.id=e,this.width=t,this.height=n,this.pixels=r,this.gif=o}},jy=(r=>(r[r.UNLOADED=0]="UNLOADED",r[r.LOADING=1]="LOADING",r[r.LOADED=2]="LOADED",r[r.FAILED=3]="FAILED",r))(jy||{}),Yy;(e=>{function i(t){return Na[t]}e.ImageType_toString=i})(Yy||(Yy={}));var Xy;(e=>{function i(t){return jy[t]}e.ImageWorkerState_toString=i})(Xy||(Xy={}));var og=class{constructor(e){this._byteLength=0,this._cachedPx=null,this._cachedFrameIdx=null,this._byteLength=e,this._cachedPx=new Uint8Array(this._byteLength)}save(e,t){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(this._cachedPx.set(t),this._cachedFrameIdx=new Se(e))}saveEmpty(e){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(e!=0&&Ke("Saving empty frame for idx \u2260 0"),this._cachedPx.fill(0),this._cachedFrameIdx=new Se(e))}getLastNonDisposedFrame(){return this._cachedFrameIdx==null&&Ke("Attempting to get cached non-disposed frame while cache index has not been set"),this._cachedPx}},ni=class ni{constructor(e){this._width=0,this._height=0,this._frameCount=0,this._loopCount=0,this._currentLoop=0,this._frameByteLength=0,this._buf=null,this._frameInfos=null,this._startedPlayingMs=-1,this._currentFrame=-1,this._desiredFrameStartTimeMs=0,this._currentFramePx=null,this._prevDisposal=0,this._needPreviousFrame=!1,this._previousFrameCache=null,this._width=e.width,this._height=e.height,this._frameCount=e.frameCount,this._loopCount=e.loopCount,this._frameByteLength=this._width*this._height*4,this._buf=e.buf,this._frameInfos=e.frameInfos,this._currentFramePx=new Uint8Array(this._frameByteLength),this._needPreviousFrame=e.needLastNonDisposed,this._needPreviousFrame&&(this._previousFrameCache=new og(this._frameByteLength))}width(){return this._width}height(){return this._height}frameCount(){return this._frameCount}loopCount(){return this._loopCount}loopsForever(){return this._loopCount==0}frameInfo(e){return(e<0||e>=this._frameInfos.length)&&ni.fail("Frame index out of range."),this._frameInfos[e]}_shouldAdvance(){if(!this.loopsForever()&&this._currentFrame==this._frameCount-1&&(this._loopCount==-1||this._loopCount==this._currentLoop))return ni.ShouldAdvance.NO;if(this._startedPlayingMs<0)return this._startedPlayingMs=Qe.milliseconds(),ni.ShouldAdvance.ONCE;let e=this.loopsForever()?ni.ShouldAdvance.UNTIL_CAUGHT_UP:ni.ShouldAdvance.ONCE;return Qe.milliseconds()-this._startedPlayingMs>=this._desiredFrameStartTimeMs?e:ni.ShouldAdvance.NO}_advanceFrame(){this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=At.int_remainder(this._currentFrame,this._frameCount));let e=this.frameInfo(this._currentFrame).delay*10;return e<=10&&(e=100),this._desiredFrameStartTimeMs+=e,this._blitFrame()}nextFrameIfNecessary(){let e=this._shouldAdvance();if(e==ni.ShouldAdvance.NO)return null;let t=Qe.milliseconds(),n=this._advanceFrame();if(e==ni.ShouldAdvance.UNTIL_CAUGHT_UP)for(;this._shouldAdvance()!=ni.ShouldAdvance.NO;){if(Qe.milliseconds()-t>=16){this._desiredFrameStartTimeMs=Qe.milliseconds()+this.frameInfo(this._currentFrame).delay*10-this._startedPlayingMs;break}n=this._advanceFrame()}return n}nextFrameForTesting(){return this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=At.int_remainder(this._currentFrame,this._frameCount)),this._blitFrame()}restart(){this._startedPlayingMs=-1,this._desiredFrameStartTimeMs=0,this._currentFrame=-1,this._currentLoop=0}toString(){let e=r=>"["+r.map(o=>`${o}`).join(", ")+"]",t=this._loopCount==0?"infinite":`${this._loopCount}`,n=this._frameInfos.map(r=>r.disposal);return ce.List_removeDuplicates(n),`GIF
 size: ${this._width} x ${this._height}
 loopCount: ${t}
 frameCount: ${this._frameCount}
 disposals: ${e(n)}`}_forEachRowIndexPairInSubrect(e,t){for(let n=e.y,r=e.y+e.height;n<r;n=n+1){let o=this.width()*4*n;t(o+e.x*4,o+(e.x+e.width)*4)}}_clearLastFrameToBackground(){let e=this._currentFrame>0?this._frameInfos[this._currentFrame-1]:null;e==null||e.width==this.width()&&e.height==this.height()?this._currentFramePx.fill(0):this._forEachRowIndexPairInSubrect(e,(t,n)=>{this._currentFramePx.subarray(t,n).fill(0)})}_blitFrame(){let e=this._frameInfos[this._currentFrame];if(this._currentFrame==0)this._clearLastFrameToBackground();else switch(this._prevDisposal){case 0:case 1:break;case 2:{this._clearLastFrameToBackground();break}case 3:{let f=this._currentFrame>0?this._currentFrame-1:this._frameCount-1,_=this._frameInfos[f],m=this._previousFrameCache.getLastNonDisposedFrame();_==null||m==null?this._clearLastFrameToBackground():_.width==this.width()&&_.height==this.height()?this._currentFramePx.set(m):this._forEachRowIndexPairInSubrect(_,(A,y)=>{let S=this._currentFramePx.subarray(A,y),g=m.subarray(A,y);S.set(g)});break}default:{console.error(`Disposal flag ${this._prevDisposal} not recognized`);break}}let t=e.width*e.height,n=new Uint8Array(t);this._LZWOutputIndexStream(this._buf,e.dataOffset,n,t);let r=e.paletteOffset,o=e.transparentIndex,a=e.width,s=this.width()-a,l=a,d=(e.y*this.width()+e.x)*4,c=((e.y+e.height)*this.width()-(this.width()-e.width-e.x))*4,p=d,u=s*4;e.interlaced&&(u=u+this.width()*4*7);let h=8;for(let f=0,_=n.length;f<_;f=f+1){let m=n[f];if(l==0&&(p=p+u,l=a,p>=c&&(u=s*4+this.width()*4*(h-1),p=d+(a+s)*(h<<1),h>>=1)),m==o)p=p+4;else{let A=this._buf[r+m*3],y=this._buf[r+m*3+1],S=this._buf[r+m*3+2];this._currentFramePx[(p=p+1)+-1]=A,this._currentFramePx[(p=p+1)+-1]=y,this._currentFramePx[(p=p+1)+-1]=S,this._currentFramePx[(p=p+1)+-1]=255}l=l-1}return this._prevDisposal=e.disposal,this._needPreviousFrame&&(this._prevDisposal<2?this._previousFrameCache.save(this._currentFrame,this._currentFramePx):this._currentFrame==0&&this._previousFrameCache.saveEmpty(this._currentFrame)),this._currentFramePx}_LZWOutputIndexStream(e,t,n,r){let o=e[(t=t+1)+-1],a=1<<o,s=a+1,l=s+1,d=o+1,c=(1<<d)-1,p=0,u=0,h=0,f=e[(t=t+1)+-1],_=new Int32Array(4096),m=-1;for(;;){for(;p<16&&f!=0;)u|=e[(t=t+1)+-1]<<p,p=p+8,f==1?f=e[(t=t+1)+-1]:f=f-1;if(p<d)break;let A=u&c;if(u>>=d,p=p-d,A==a){l=s+1,d=o+1,c=(1<<d)-1,m=-1;continue}else if(A==s)break;let y=A<l?A:m,S=0,g=y;for(;g>a;)g=_[g]>>8,S=S+1;let b=g;if(h+S+(y!=A?1:0)>r){console.warn("Warning, gif stream longer than expected.");return}n[(h=h+1)+-1]=b,h=h+S;let I=h;for(y!=A&&(n[(h=h+1)+-1]=b),g=y;(S=S-1)- -1!=0;)g=_[g],n[I=I-1]=g&255,g>>=8;m!=-1&&l<4096&&(_[(l=l+1)+-1]=m<<8|b,l>=c+1&&d<12&&(d=d+1,c=c<<1|1)),m=A}if(h!=r){console.warn("Warning, gif stream shorter than expected.");return}}decodedSize(){return this._buf.length}static fail(e){throw new Error(e)}};ni.DEBUG_LOG=!1;var Mi=ni;(o=>{let i;(d=>(d[d.ONCE=0]="ONCE",d[d.UNTIL_CAUGHT_UP=1]="UNTIL_CAUGHT_UP",d[d.NO=2]="NO"))(i=o.ShouldAdvance||(o.ShouldAdvance={}));class e{constructor(s,l,d,c,p,u,h){this.width=s,this.height=l,this.frameCount=d,this.loopCount=c,this.buf=p,this.frameInfos=u,this.needLastNonDisposed=h}}o.DecodeResult=e;class t{toString(){return`Frame [x=${this.x}, y=${this.y}] [w=${this.width}, h=${this.height}] [delay=${this.delay}] [localPalette=${this.hasLocalPalette}] [interlaced=${this.interlaced}]`}constructor(s,l,d,c,p,u,h,f,_,m,A,y,S){this.x=s,this.y=l,this.width=d,this.height=c,this.hasLocalPalette=p,this.paletteOffset=u,this.paletteSize=h,this.dataOffset=f,this.dataLength=_,this.transparentIndex=m,this.interlaced=A,this.delay=y,this.disposal=S}}o.Frame=t;class n{_decode(s){let l=0;(s[(l=l+1)+-1]!=71||s[(l=l+1)+-1]!=73||s[(l=l+1)+-1]!=70||s[(l=l+1)+-1]!=56||(s[(l=l+1)+-1]+1&253)!=56||s[(l=l+1)+-1]!=97)&&o.fail("Invalid GIF 87a/89a header.");let d=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,c=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,p=s[(l=l+1)+-1],u=!!(p>>7),f=1<<(p&7)+1;l=l+1,l=l+1;let _=0,m=0;u&&(_=l,m=f,l=l+f*3);let A=!0,y=[],S=!1,g=0,b=256,T=0,I=-1,O=!0;e:for(;A&&l<s.length;)switch(s[(l=l+1)+-1]){case 33:{switch(s[(l=l+1)+-1]){case 255:{if(s[l]!=11||s[l+1]==78&&s[l+2]==69&&s[l+3]==84&&s[l+4]==83&&s[l+5]==67&&s[l+6]==65&&s[l+7]==80&&s[l+8]==69&&s[l+9]==50&&s[l+10]==46&&s[l+11]==48&&s[l+12]==3&&s[l+13]==1&&s[l+16]==0)l=l+14,I=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,l=l+1;else for(l=l+12;;){let w=s[(l=l+1)+-1];if(w>=0||o.fail("Invalid block size"),w==0)break;l=l+w}break}case 249:{(s[(l=l+1)+-1]!=4||s[l+4]!=0)&&o.fail("Invalid graphics extension block.");let w=s[(l=l+1)+-1];g=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,b=s[(l=l+1)+-1],w&1||(b=256),T=w>>2&7,!S&&T==3&&(S=!0),w>>1&1,l=l+1;break}case 254:case 1:{for(;;){let w=s[(l=l+1)+-1];if(w>=0||o.fail("Invalid block size"),w==0)break;l=l+w}break}default:{let w=s[l-1].toString(16);o.fail(`Unknown graphic control label: 0x${w}`);break}}break}case 44:{let w=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,P=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,H=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,re=s[(l=l+1)+-1]|s[(l=l+1)+-1]<<8,q=s[(l=l+1)+-1],W=!!(q>>7),x=q>>6&1,k=1<<(q&7)+1,G=_,M=m,Q=!1;W&&(Q=!0,G=l,M=k,l=l+k*3);let Y=l,B=!1;for(l=l+1;;){let te=s[(l=l+1)+-1];if(te===void 0){B=!0;break}if(te>=0||o.fail("Invalid block size"),te==0)break;l=l+te}B||y.push(new o.Frame(w,P,H,re,Q,G,M,Y,l-Y,b,!!x,g,T)),(H==d&&re==c||!Q||g>0)&&(O=!1);break}case 59:{A=!1;break e}default:{let w=s[l-1].toString(16);o.fail(`Unknown gif block: 0x${w}`);break}}if(O){let w="May have encountered multi-image/single-canvas GIF";w+=`
  GIF metadata: [${d} x ${c}], loopCount=${I}, disposal=${T}`;for(let P of y)w+=`
    ${P}`;console.warn(w)}return new o.DecodeResult(d,c,y.length,I,s,y,S)}static decodeBytes(s){{let l=new o.Decoder()._decode(s);return new yn(3,l.width,l.height,l)}}constructor(){}}o.Decoder=n;let r;(s=>{function a(l){return o.ShouldAdvance[l]}s.ShouldAdvance_toString=a})(r=o.in_ShouldAdvance||(o.in_ShouldAdvance={}))})(Mi||(Mi={}));var Vc=(r=>(r[r.NONE=0]="NONE",r[r.FETCHING=1]="FETCHING",r[r.DECODED=2]="DECODED",r[r.FAILED=3]="FAILED",r))(Vc||{}),Hu=(t=>(t[t.CANVAS_ONLY=0]="CANVAS_ONLY",t[t.ANY=1]="ANY",t))(Hu||{}),zu=(n=>(n[n.FETCH=0]="FETCH",n[n.DECODE=1]="DECODE",n[n.ABORT=2]="ABORT",n))(zu||{}),Pr=class Pr{width(){return this.texture()!=null?this.texture().width():this._decodedData!=null?this._decodedData.width:0}height(){return this.texture()!=null?this.texture().height():this._decodedData!=null?this._decodedData.height:0}constructor(e,t,n,r){this._compressedData=null,this._url=null,this._downloadUrl=null,this._hash=null,this._allowDownscaling=!0,this._imageType=1,this._gif=null,this._fetchAndDecodePromise=null,this._decodedData=null,this._texture=null,this._url=e,this._downloadUrl=e,this._imageType=t,this._hash=n,this._allowDownscaling=r,n!=null&&!kr&&wt.getImageBatchURL()!=null&&eb(n)}primeWithCompressedData(e){this._compressedData=e,this._downloadUrl=URL.createObjectURL(new Blob([this._compressedData]))}imageType(){return this._imageType}isGIF(){return this._imageType==0}gif(){return this._gif}url(){return this._url}hash(){return this._hash}state(){return this.isDecoded()?2:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==2?3:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==0?1:0}loadDidFail(){return this.state()==3}_fetchImageBytesForSlowDecode(){let e=new fo;return this._compressedData!=null?e.resolve(this._compressedData):new Ur(this._downloadUrl).format(1).get().then(t=>{t.wasSuccessful()?e.resolve(t.bytes):(console.error(`failed to fetch image '${this}'`),e.reject(0))},t=>{e.reject(0)}),e}decodedData(){return this._decodedData}texture(){return this._texture}setTexture(e){this._texture=e}isDecoded(){return this._gif!=null||this._decodedData!=null||this._texture!=null}fetchAndDecode(e,t,n){if(this._decodedData!=null){t(this._decodedData);return}let r=this._fetchAndDecodePromise!=null;r||(this._fetchAndDecodePromise=new fo),this._fetchAndDecodePromise.then2(t,n),!r&&(this._hash==null||wt.getImageBatchURL()==null?this._fetchAndDecode(e):eb(this._hash).then2(o=>{this._fetchAndDecodePromise!=null&&(this._downloadUrl=o,this._fetchAndDecode(e))},o=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(o)}))}_fetchAndDecode(e){this._canUseFastFetchAndDecode()?this._fastFetchAndDecode(e):this._slowFetchAndDecode()}_canUseFastFetchAndDecode(){return Pr.browserSupportsFastImageDecoding()&&this._imageType==1}_fetchHTMLImageObject(){let e=new fo,t=jr.HTMLDocument_createElementImage(document);return t.crossOrigin="anonymous",t.src=this._downloadUrl,t.onload=()=>{e.resolve(t)},t.onerror=()=>{e.reject(0)},e}_fastFetchAndDecode(e){this._fetchHTMLImageObject().then2(t=>{this._fetchAndDecodePromise!=null&&t.decode().then(n=>{if(this._fetchAndDecodePromise==null)return;if(e!=0){this._handleDecodeSuccess(new yn(2,t.naturalWidth,t.naturalHeight,t));return}let r=document.createElement("canvas");if(!(this._allowDownscaling&&(Xe.isMobile(Xe.current())||Xe.current()==4&&navigator.maxTouchPoints>0||wt.forceMobileOptimizations())))r.width=t.naturalWidth,r.height=t.naturalHeight;else{let s=Math.max(t.naturalWidth,t.naturalHeight),d=Math.min(2048,s)/s;r.width=Math.round(t.naturalWidth*d)|0,r.height=Math.round(t.naturalHeight*d)|0}let a=lo.HTMLCanvasElement_getContext2D(r);a==null?(Pr.trackImageDecodeFailure("Canvas context creation failed"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(1)):(a.drawImage(t,0,0,r.width,r.height),this._handleDecodeSuccess(new yn(1,r)))},n=>{Pr.trackImageDecodeFailure("Image.decode"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(1)})},t=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(0)})}_handleDecodeSuccess(e){this._fetchAndDecodePromise!=null&&(this._decodedData=e,this._imageType==0?(this._gif=new Mi(e.gif),yn.setRamInUse(Mn.incrementInReleaseBuilds("Decoded image data in RAM (MB)",1*this._gif.decodedSize()/(1024*1024)))):yn.setRamInUse(Mn.incrementInReleaseBuilds("Decoded image data in RAM (MB)",1*e.width*e.height*4/(1024*1024))),this._fetchAndDecodePromise.resolve(e),Mn.increment("# Decoded images",1))}_slowFetchAndDecode(){this._fetchImageBytesForSlowDecode().then2(e=>{this._fetchAndDecodePromise!=null&&yn.decodeImageBuffer(e,this._imageType).then(t=>{this._handleDecodeSuccess(t)},t=>{Pr.trackImageDecodeFailure("unknown"),console.error(`failed to load image '${this}'`),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(1)})},e=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(e)})}freeMemoryForDecodedData(){let e=!1;return this._decodedData!=null&&(Mn.increment("# Decoded images",-1),yn.setRamInUse(Mn.incrementInReleaseBuilds("Decoded image data in RAM (MB)",-1*this.width()*this.height()*4/(1024*1024))),this._decodedData=null,e=!0),e}freeMemoryForDecodedDataAndTexture(){let e=!1;return this.freeMemoryForDecodedData(),this._gif!=null&&(yn.setRamInUse(Mn.incrementInReleaseBuilds("Decoded image data in RAM (MB)",-1*this._gif.decodedSize()/(1024*1024))),this._gif=null,e=!0),this.texture()!=null&&(this.texture().deleteTexture(),this.setTexture(null),e=!0),this._fetchAndDecodePromise!=null&&(this._fetchAndDecodePromise.reject(2),this._fetchAndDecodePromise=null,e=!0),e}objectHash(){return`ImageResourceImpl(${this._url}, ${Na[this._imageType]})`}toString(){return`ImageResourceImpl(${this._url}, ${Na[this._imageType]})`}static browserSupportsFastImageDecoding(){return(Xe.chrome()&&X.isBrowserVersionAtLeast("81")||Xe.firefox()&&X.isBrowserVersionAtLeast("77")||Xe.safari()&&!Xe.ios()&&X.isBrowserVersionAtLeast("13.1")||Xe.safari()&&Xe.ios()&&X.isBrowserVersionAtLeast("13.4")||Xe.safari()&&Xe.ios()&&X.isOSVersionAtLeast("13.4.1"))&&X.htmlImageDecodeMethodIsPresent()}static getEmojiImageUrl(e){let t=e.map(a=>a.toString(16)).join("-"),n=X.getFeatureFlags().fontIndex220528&&X.getFeatureFlags().fontIndexEmoji,r=X.getFeatureFlags().fontIndexEmojiLowRes;return(n?r?"https://static.figma.com/emoji/4/64/":"https://static.figma.com/emoji/4/160/":"https://static.figma.com/emoji/1/64/")+t+".png"}static createEmojiImage1(e){let t=e.map(n=>n.toString(16)).join("-");return Pr.createEmojiImage2(t)}static createEmojiImage2(e){let t=X.getFeatureFlags().fontIndex220528&&X.getFeatureFlags().fontIndexEmoji,n=X.getFeatureFlags().fontIndexEmojiLowRes,o=(t?n?"https://static.figma.com/emoji/4/64/":"https://static.figma.com/emoji/4/160/":"https://static.figma.com/emoji/1/64/")+e+".png";return new Pr(o,1,null,!0)}static createDeviceImage(e){let t=e.url,n=Zr().INITIAL_OPTIONS,r=n?n.cluster_name:"missing-cluster",o=t+`?cachebreaker=${r}`;return new Pr(o,1,null,!1)}static createImage(e,t,n){let r=Pr.bytesToHex(e),o=wt.getImagePrefixURL(),s=`${o.endsWith("/")?o:o+"/"}${r}`,l=new Pr(s,n,r,!0);return t!=null&&l.primeWithCompressedData(t),l}static bytesToHex(e){let t="";for(let n=0,r=e.length;n<r;n=n+1)t+=(e[n]|256).toString(16).slice(-2);return t}static hexToBytes(e){let t=[];for(let n=0;n<e.length;n=n+2)t.push(parseInt(e.substr(n,2),16));return new Uint8Array(t)}static trackImageDecodeFailure(e){Pr.numDecodeFailuresLogged>=Pr.LOG_MAX_DECODE_FAILURES||(Be.trackEvent1("image_decode_failed",new Map([["reason",e]])),Pr.numDecodeFailuresLogged=Pr.numDecodeFailuresLogged+1)}};Pr.LOG_MAX_DECODE_FAILURES=3,Pr.numDecodeFailuresLogged=0;var jn=Pr,Zy;(e=>{function i(t){return Vc[t]}e.ImageState_toString=i})(Zy||(Zy={}));var $y;(e=>{function i(t){return Hu[t]}e.DecodeOutput_toString=i})($y||($y={}));var Jy;(e=>{function i(t){return zu[t]}e.ImageFailure_toString=i})(Jy||(Jy={}));function d1(){let i=wt.getImageBatchURL(),e=ag;ag=[],ig=0;let t=r=>{let o=new Ur(i),a=new Map,s=Zr().INITIAL_OPTIONS.user_data;s&&a.set("x-figma-user-id",s.id),o.send1("POST",new Blob([JSON.stringify({sha1s:r})],{type:"application/json"}),a).then(d=>{if(!d.wasSuccessful()){for(let u of r){let h=i+":"+u;ri.has(h)&&ri.get(h).reject(0)}return}let p=JSON.parse(d.text).meta.s3_urls;for(let u of Object.keys(p)){let h=i+":"+u;if(ri.has(h)){let f=ri.get(h);f.state()==0&&f.resolve(p[u])}}for(let u of r)if(!(u in p)){let h=i+":"+u;ri.has(h)&&ri.get(h).reject(0)}},d=>{for(let c of r){let p=i+":"+c;ri.has(p)&&ri.get(p).reject(0)}})},n=200;for(let r=0;r<=((e.length-1)/n|0);r=r+1){let o=e.slice(r*n,Math.min((r+1)*n,e.length));t(o)}}function eb(i){let e=wt.getImageBatchURL()+":"+i;return ri.has(e)||(ag.push(i),ri.set(e,new fo),ig==0&&(ig=setTimeout(()=>{d1()},0))),ri.get(e)}var ig=0,ag=[],ri=new Map;var hr;(r=>{function i(o){return o!="NONE"}r.hasOverflow=i;function e(o){return o=="HORIZONTAL"||o=="BOTH"}r.scrollsHorizontally=e;function t(o){return o=="VERTICAL"||o=="BOTH"}r.scrollsVertically=t;function n(o,a){switch(o){case"VERTICAL":return Math.abs(a.y());case"HORIZONTAL":return Math.abs(a.x());case"BOTH":return Math.abs(a.length());default:break}return 0}r.getDirectionSimilarity=n})(hr||(hr={}));var sg;(e=>{function i(t){let n=t,r=t.parent(),o=new E(0,0);for(;r!=null&&r.type()!="CANVAS";){let a=r.scrollDirection()!="NONE"&&r.has(88),s=n.isFixed();a&&!s&&o.addUpdate1(r.scrollOffset()),n=r,r=r.parent()}return o}e.cumulativeScrollOffsetOfAncestors=i})(sg||(sg={}));function tb(i){switch(i){case"VERTICAL":return new E(0,1);case"HORIZONTAL":return new E(1,0);case"BOTH":{let e=new E(1,1);return e.divide(e.length())}default:break}return E.new2()}var Li;(s=>{function i(l,d,c,p,u){let h=l.stickyNodeInitialTopPosition,f=l.overflowingAncestorInitialTopPosition,_=h-f;if(p)return c.y()>_?ve.FrozenVector_new4(c.x(),_):c;{if(u)return ve.FrozenVector_new4(0,0);let m=d(),A=l.stickyNodeHeight,y=l.parentNodeHeight,S=l.parentNodeInitialTopPosition,b=h-S+A,T=y-b,I=m.y()>_&&m.y()<=_+T,O=m.y()>_+T;return I?ve.FrozenVector_new4(0,_-m.y()):O?ve.FrozenVector_new4(0,-T):ve.FrozenVector_new4(0,0)}}s.getRelativeScrollTranslationOfStickyScrollingNodeFromBounds=i;function e(l){let d=l.parent();if(d==null)return ve.FrozenVector_new4(0,0);let c=d.isFixed()&&d.parent()!=null&&d.parent().has(88);if(l.isStandardScrolling()&&d.has(88))return d.scrollOffset();if(l.isStickyScrolling()){let p=l.parent(),u=!0;for(;p!=null&&!p.has(88);)u=!1,p=p.parent();if(p==null)return ve.FrozenVector_new4(0,0);let h=l.absoluteTransform().m12(),f=l.size().y(),_=d.absoluteTransform().m12(),m=d.size().y(),A=p.absoluteTransform().m12(),y=new a(h,f,_,m,A);return i(y,()=>n(d),d.scrollOffset(),u,c)}return ve.FrozenVector_new4(0,0)}s.getScrollTranslationOfNodeRelativeToParent1=e;function t(l){let d=l.parent();if(d==null)return ve.FrozenVector_new4(0,0);let c=u=>u.scrollDirection()!="NONE"&&u.hasOverflowingContentInScrollDirection(),p=d.isFixed()&&d.parent()!=null&&c(d.parent());if(l.isStandardScrolling()&&c(d))return d.scrollOffset();if(l.isStickyScrolling()){let u=l.parent(),h=!0;for(;u!=null&&!c(u);)h=!1,u=u.parent();if(u==null)return ve.FrozenVector_new4(0,0);let f=l.absoluteTransform().m12(),_=l.size().y(),m=d.absoluteTransform().m12(),A=d.size().y(),y=u.absoluteTransform().m12(),S=new a(f,_,m,A,y);return i(S,()=>r(d),d.scrollOffset(),h,p)}return ve.FrozenVector_new4(0,0)}s.getScrollTranslationOfNodeRelativeToParent2=t;function n(l){let d=ve.FrozenVector_new4(0,0),c=l;for(;c!=null&&(!c.has(88)||c==l);){let p=e(c);d=d.add1(p),c=c.parent()}return d}s.getScrollTranslationOfNodeRelativeToOverflowingAncestor1=n;function r(l){let d=u=>u.scrollDirection()!="NONE"&&u.hasOverflowingContentInScrollDirection(),c=ve.FrozenVector_new4(0,0),p=l;for(;p!=null&&(!d(p)||p==l);){let u=t(p);c=c.add1(u),p=p.parent()}return c}s.getScrollTranslationOfNodeRelativeToOverflowingAncestor2=r;function o(l){let d=new E(0,0),c=l.parent();if(l.isStandardScrolling()&&c.has(88))d.addUpdate1(c.scrollOffset());else if(l.isStickyScrolling()&&c.has(88)){let p=l.absoluteTransform().m12()-c.absoluteTransform().m12(),u=Math.min(p,c.scrollOffset().y()),h=new E(c.scrollOffset().x(),u);d.addUpdate1(h)}return d}s.getScrollOffsetOfNodeFromParent_DEPRECATED=o;class a{constructor(d,c,p,u,h){this.stickyNodeInitialTopPosition=d,this.stickyNodeHeight=c,this.parentNodeInitialTopPosition=p,this.parentNodeHeight=u,this.overflowingAncestorInitialTopPosition=h}}s.StickyScrollBounds=a})(Li||(Li={}));var Bi=(t=>(t[t.APPLY_SCROLLING_AND_CLIPPING=0]="APPLY_SCROLLING_AND_CLIPPING",t[t.APPLY_SCROLLING=1]="APPLY_SCROLLING",t))(Bi||{}),kc=(n=>(n[n.BASE_SCREEN=0]="BASE_SCREEN",n[n.OVERLAY_OR_SUBLAYER=1]="OVERLAY_OR_SUBLAYER",n[n.DETERMINE_USING_NODE_FIELDS=2]="DETERMINE_USING_NODE_FIELDS",n))(kc||{}),Wu=class{constructor(e){this._node=null,this._overrideRole=null,this._node=e}overrideRole(e){this._overrideRole=new Se(e)}clearRoleOverride(){this._overrideRole=null}_role(){return this._overrideRole!=null?this._overrideRole.value:2}canvasSpaceContentBounds(){return this.scrollDirection()=="NONE"?this._node.canvasSpaceRenderedBounds():this._scrollableContentBounds()}defaultScrollOffset(){return this._node.canvasSpaceBoundingBox().topLeft().subtract1(this.canvasSpaceContentBounds().topLeft())}minScrollOffsetX(){return-this.defaultScrollOffset().x()}minScrollOffsetY(){return-this.defaultScrollOffset().y()}maxScrollOffsetX(){return Math.max(this.minScrollOffsetX(),this.canvasSpaceContentBounds().right()-this._node.canvasSpaceBoundingBox().right())}maxScrollOffsetY(){return Math.max(this.minScrollOffsetY(),this.canvasSpaceContentBounds().bottom()-this._node.canvasSpaceBoundingBox().bottom())}hasOverflowingContentInXDirection(){return hr.scrollsHorizontally(this.scrollDirection())&&this.canvasSpaceContentBounds().width()>this._node.canvasSpaceBoundingBox().width()}hasOverflowingContentInYDirection(){return hr.scrollsVertically(this.scrollDirection())&&this.canvasSpaceContentBounds().height()>this._node.canvasSpaceBoundingBox().height()}shouldResizeToFitViewport(){return(this._role()==2?this._node.isTopLevel():this._role()==0)&&!this._node.isTooRotatedToScroll()}nodeSize(){if(this.shouldResizeToFitViewport()){let e=this._node.findContainingCanvasOrParent(),t=e.prototypeDevice(),n=e.currentViewportSize(),r=t.type=="NONE"||t.type=="PRESENTATION"?n:t.size();return new E(Math.min(this._node.fullSize().x(),r.x()),Math.min(this._node.fullSize().y(),r.y()))}else return this._node.fullSize()}nodeSpaceScrollableContentBounds(){let e=this._node.fullSize(),t=U.new2();if((this._role()==2?this._node.isTopLevel():this._role()==0)?!hr.hasOverflow(this._node.overflowDirection()):!this._node.isFrameMaskDisabled()&&this.scrollDirection()=="NONE")t.setTo1(0,0,e.x(),e.y());else{let o=this._node.canvasSpaceBoundingBox().topLeft();t.setTo1(o.x(),o.y(),e.x(),e.y());for(let a=0,s=this._node.childCount();a<s;a=a+1){let l=this._node.childAt1(a);l.isFixed()||(kr?t.expandToInclude(l.canvasSpaceBoundingBox()):t.expandToInclude(l.canvasSpaceScrollingBounds()))}t.setX(t.x()-o.x()),t.setY(t.y()-o.y()),this._node.overflowDirection()=="VERTICAL"?(t.setX(0),t.setWidth(e.x())):this._node.overflowDirection()=="HORIZONTAL"?(t.setY(0),t.setHeight(e.y())):this._node.overflowDirection()=="BOTH"}return t}_scrollableContentBounds(){let e=this.nodeSpaceScrollableContentBounds();return e.transformInto1(e,this._node.absoluteTransform()),e}scrollDirection(){let e=this._role()==2?$.asBool(this._node.get1(89,$.new3(!1))):this._role()==0;return this._node.constrainsAnchoredChildren()?this._node.isTopLevel()&&e?"BOTH":this._node.overflowDirection():"NONE"}scrollDirectionWithScrollableContent(){let e=this.scrollDirection(),t=this.canvasSpaceContentBounds(),n=this._node.canvasSpaceBoundingBox(),r=hr.scrollsVertically(e)&&t.height()>n.height(),o=hr.scrollsHorizontally(e)&&t.width()>n.width();return r&&o?"BOTH":r?"VERTICAL":o?"HORIZONTAL":"NONE"}hasScrollableParent(){let e=this._node.parent();return!(e==null||e.overflowDirection()=="NONE"&&!(e.isTopLevel()&&e.type()=="FRAME"))}isFixed(){return this.hasScrollableParent()?this._node.scrollBehavior()=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME":!1}isStickyScrolling(){return!X.getFeatureFlags().prototypeTemporaryStickyScroll&&!this.hasScrollableParent()?!1:this._node.scrollBehavior()=="STICKY_SCROLLS"}isStandardScrolling(){return!this.isFixed()&&!this.isStickyScrolling()}scrollAndClipBoundsBySelfAndAncestors(e,t){let n=e.clone(),r=this._node;for(;r.parent()!=null;){let o=X.getFeatureFlags().prototypeTemporaryStickyScroll?Li.getScrollTranslationOfNodeRelativeToParent1(r):Li.getScrollOffsetOfNodeFromParent_DEPRECATED(r);n.translate2(o.negative());let a=r.parent();a.clipsToBoundingRectangle()&&t==0&&n.intersectWith(a.canvasSpaceBoundingBox()),r=a}return n}canvasSpaceScrolledBounds(e){return this.scrollAndClipBoundsBySelfAndAncestors(this._node.canvasSpaceBoundingBox(),e)}canvasSpaceScrolledInteractiveBounds(e){let t=X.getFeatureFlags().mergeInteractiveBounds?this._node.canvasSpacePreviewBounds():this._node.canvasSpaceInteractiveBounds();return this.scrollAndClipBoundsBySelfAndAncestors(t,e)}scrollsInPreferredDirection(e){switch(e){case"HORIZONTAL":return hr.scrollsHorizontally(this.scrollDirection());case"VERTICAL":return hr.scrollsVertically(this.scrollDirection());case"BOTH":return this.scrollDirection()!="NONE"}return!1}hasOverflowingContentInScrollDirection(){let e=this.canvasSpaceContentBounds(),t=this._node.canvasSpaceBoundingBox();return hr.scrollsHorizontally(this.scrollDirection())&&e.width()>t.width()||hr.scrollsVertically(this.scrollDirection())&&e.height()>t.height()}},nb;(e=>{function i(t){return Bi[t]}e.BoundsTransformationStrategy_toString=i})(nb||(nb={}));var rb;(e=>{function i(t){return kc[t]}e.FrameRole_toString=i})(rb||(rb={}));var u1=["APPLE_IPHONE_14_PRO","APPLE_IPHONE_14_PLUS","APPLE_IPHONE_15","APPLE_WATCH_45MM"],ob=i=>u1.some(e=>i.startsWith(e));var sa;(d=>{function i(){let c=lo.HTMLCanvasElement_getContextWebGL1(jr.HTMLDocument_createElementCanvas(document));if(c==null)return!1;let p=c.canvas;document.body.appendChild(p);let u=c.createProgram(),h=c.createShader(c.VERTEX_SHADER);c.shaderSource(h,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),c.compileShader(h),c.attachShader(u,h);let f=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(f,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0., 0., 0., 1.);
        }
      `),c.compileShader(f),c.attachShader(u,f),c.bindAttribLocation(u,0,"pos"),c.linkProgram(u);let _=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,_);let m=new Float32Array([0,0,1,0,0,1,1,1]);c.bufferData(c.ARRAY_BUFFER,m.length*4,c.DYNAMIC_DRAW),c.bufferSubData(c.ARRAY_BUFFER,0,m),c.enableVertexAttribArray(0),c.vertexAttribPointer(0,2,c.FLOAT,!1,8,0),c.canvas.width=10,c.canvas.height=1;let A=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,A);let y=c.createTexture();c.bindTexture(c.TEXTURE_2D,y),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.bindTexture(c.TEXTURE_2D,y),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.canvas.width,c.canvas.height,0,c.RGBA,c.UNSIGNED_BYTE,null),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,y,0),c.useProgram(u),c.bindFramebuffer(c.FRAMEBUFFER,A),c.viewport(0,0,c.canvas.width/2|0,c.canvas.height),c.drawArrays(c.TRIANGLE_STRIP,0,4),c.bindFramebuffer(c.FRAMEBUFFER,null),c.viewport(0,0,c.canvas.width/2|0,c.canvas.height),c.drawArrays(c.TRIANGLE_STRIP,0,4);let S=new Uint8Array(4);return c.readPixels((c.canvas.width/2|0)+2,0,1,1,c.RGBA,c.UNSIGNED_BYTE,S),document.body.removeChild(p),S[3]!=0}d._featureDetectViewportBug=i;function e(){let c=lo.HTMLCanvasElement_getContextWebGL1(jr.HTMLDocument_createElementCanvas(document));if(c==null)return!1;let p=c.canvas;document.body.appendChild(p),c.canvas.width=1,c.canvas.height=1;let u=c.createTexture();c.bindTexture(c.TEXTURE_2D,u),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.bindTexture(c.TEXTURE_2D,u),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.canvas.width,c.canvas.height,0,c.RGBA,c.UNSIGNED_BYTE,null),c.bindTexture(c.TEXTURE_2D,u);let h=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,h),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,u,0);let f=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,f),c.bufferData(c.ARRAY_BUFFER,32,c.DYNAMIC_DRAW),c.bufferSubData(c.ARRAY_BUFFER,0,new Float32Array([1,1,1,-1,-1,1,-1,-1])),c.vertexAttribPointer(0,2,c.FLOAT,!1,8,0),c.enableVertexAttribArray(0),c.bindBuffer(c.ARRAY_BUFFER,f);let _=c.createProgram(),m=c.createShader(c.VERTEX_SHADER);c.shaderSource(m,`
        precision highp float;
        attribute vec2 pos;
        varying vec2 uv;
        void main(){
          uv = (pos + vec2(1.0)) / 2.0;
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),c.compileShader(m),c.attachShader(_,m);let A=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(A,`
        precision highp float;
        uniform sampler2D texture;
        varying vec2 uv;
        void main(){
          gl_FragColor=texture2D(texture, uv);
        }
      `),c.compileShader(A),c.attachShader(_,A),c.linkProgram(_);let y=c.createProgram(),S=c.createShader(c.VERTEX_SHADER);c.shaderSource(S,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos,0.,1.);
        }
      `),c.compileShader(S),c.attachShader(y,S);let g=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(g,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0.,0.,1.,1.);
        }
      `),c.compileShader(g),c.attachShader(y,g),c.bindAttribLocation(y,0,"pos"),c.linkProgram(y),c.clearColor(1,0,0,1),c.bindFramebuffer(c.FRAMEBUFFER,h),c.useProgram(y),c.drawArrays(c.TRIANGLE_STRIP,0,4),c.bindFramebuffer(c.FRAMEBUFFER,null),c.useProgram(_),c.drawArrays(c.TRIANGLE_STRIP,0,4),c.bindFramebuffer(c.FRAMEBUFFER,h),c.clear(c.COLOR_BUFFER_BIT),c.bindFramebuffer(c.FRAMEBUFFER,null),c.useProgram(_),c.drawArrays(c.TRIANGLE_STRIP,0,4);let b=new Uint8Array(4);return c.readPixels(0,0,1,1,c.RGBA,c.UNSIGNED_BYTE,b),document.body.removeChild(p),b[0]!=255}d._featureDetectDrawClearReorderingBug=e;function t(){return d._hasViewportBug==null?(Ke("Called hasViewportBug before running feature detection"),!1):d._hasViewportBug.value}d.hasViewportBug=t;function n(){return d._hasDrawClearReorderingBug==null?(Ke("Called hasDrawClearReorderingBug before running feature detection"),!1):d._hasDrawClearReorderingBug.value}d.hasDrawClearReorderingBug=n;function r(){return d._hasUnexpectedCompositingBug==null?(Ke("Called hasDrawClearReorderingBug before running feature detection"),!1):d._hasUnexpectedCompositingBug.value}d.hasUnexpectedCompositingBug=r;function o(){d._hasViewportBug=new Se(i()),t()&&console.warn("GPUBugs: device has buggy implementation of gl.viewport. Will apply workarounds."),d._hasDrawClearReorderingBug=new Se(e()),n()&&console.warn("GPUBugs: Device may re-order draw/clear commands. Will apply workarounds.");let c=navigator.userAgent,p=(c.indexOf("iPhone OS 14_0")|0)!=-1,u=(c.indexOf("iPhone OS 14_1")|0)!=-1,h=p||u,f=(c.indexOf("iPad; CPU OS 14_0")|0)!=-1,_=(c.indexOf("iPad; CPU OS 14_1")|0)!=-1,m=f||_,y=(c.indexOf("Version/14")|0)!=-1&&(c.indexOf("Safari")|0)!=-1&&(navigator.maxTouchPoints|0)>0;d._hasUnexpectedCompositingBug=new Se(h||m||y)}d.detect=o,d._hasViewportBug=null,d._hasDrawClearReorderingBug=null,d._hasUnexpectedCompositingBug=null})(sa||(sa={}));var Uc=class{constructor(e,t,n,r){this._delayFrames=0,this._onChange=null,this._equals=null,this._nextUpdateAfterFrameCount=-1,this._value=null,this._queuedValue=null,this._delayFrames=t,this._equals=n,this._onChange=r,e(this)}onFrame(){this._nextUpdateAfterFrameCount>0&&(this._nextUpdateAfterFrameCount=this._nextUpdateAfterFrameCount-1,this._nextUpdateAfterFrameCount<=0&&(this._value=this._queuedValue,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1,this._onChange()))}_updateQueuedValue(e){this._queuedValue=new Se(e),this._nextUpdateAfterFrameCount=this._delayFrames}hasQueuedValue(){return this._queuedValue!=null}queueValue(e){if(this._value==null){this._value=new Se(e),this._onChange();return}if(this._queuedValue!=null){if(this._equals(this._queuedValue.value,e))return;this._updateQueuedValue(e);return}else this._equals(this._value.value,e)||this._updateQueuedValue(e)}getValue(){return this._value.value}clear(){this._value=null,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1}unregister(e){e(this)}};function Gc(i,e){let t=new WeakMap,n=null;return r=>{let o=e(r);if(o===null)return n==null&&(n=new Se(i(r))),n.value;if(t.has(o))return t.get(o);let a=i(r);return t.set(o,a),a}}function lg(i){return Gc(i,e=>e)}function p1(i,e,t){let n=Gc(r=>Gc(o=>i(r,o),t),e);return(r,o)=>n(r)(o)}function ib(i,e,t,n){let r=p1((o,a)=>Gc(s=>i(o,a,s),n),e,t);return(o,a,s)=>r(o,a)(s)}function cg(i,e,t,n,r){let o=ib((a,s,l)=>Gc(d=>i(a,s,l,d),r),e,t,n);return(a,s,l,d)=>o(a,s,l)(d)}var nr=class{add(e){this._observers=rn.FrozenList_cloneAndAppendOne(this._observers,e)}remove(e){this._observers=rn.FrozenList_cloneAndRemoveOne(this._observers,e)}forEach(e){let t=this._observers;t.forEach(n=>{(t==this._observers||this._observers.indexOf(n)!=-1)&&e(n)})}constructor(){this._observers=[]}};var _o=class i{constructor(e,t){this._offset=null,this._scale=0,this._offset=e,this._scale=t}offset(){return this._offset}scale(){return this._scale}setOffset(e){this._offset=e}setScale(e){this._scale=e}clone(){return new i(this.offset(),this.scale())}equals(e){return this._offset.equals(e.offset())&&this._scale==e.scale()}translate1(e,t){this._offset.setX(this._offset.x()+e*this._scale),this._offset.setY(this._offset.y()+t*this._scale)}translate2(e){this.translate1(e.x(),e.y())}translatedBy1(e){return this.translatedBy2(e.x(),e.y())}translatedBy2(e,t){return this.translate1(e,t),this}scaledBy(e){return this._scale=this._scale*e,this}multiply(e){this._offset=this._offset.add1(e.offset().multiply(this._scale)),this._scale=this._scale*e.scale()}multipliedBy(e){return this.multiply(e),this}transformRect(e){if(e.isInvalid())return e.copyFrom(U.INVALID);if(!e.isFinite())return e.copyFrom(U.INFINITE);let t=new Tt;return t.include2(this.transformPoint(e.topLeft())),t.include2(this.transformPoint(e.bottomRight())),t.buildTo(e),e}inverseTransformRect(e){if(e.isInvalid())return e.copyFrom(U.INVALID);if(!e.isFinite())return e.copyFrom(U.INFINITE);let t=new Tt;return t.include2(this.inverseTransformPoint(e.topLeft())),t.include2(this.inverseTransformPoint(e.bottomRight())),t.buildTo(e),e}transformPoint(e){return e.multiplyUpdate(this._scale),e.addUpdate1(this._offset),e}inverseTransformPoint(e){return e.subtractUpdate1(this._offset),e.divideUpdate(this._scale),e}transformDirection(e){return e.multiplyUpdate(this._scale),e}inverseTransformDirection(e){return e.divideUpdate(this._scale),e}invert(){let e=1/this.scale();return isNaN(e)?!1:(this._offset=this._offset.negative().multiply(e),this._scale=e,!0)}copyFrom(e){return this._offset.copyFrom(e.offset()),this._scale=e.scale(),this}toString(){return`SimpleTransform({${this.offset().x()}, ${this.offset().y()}}, ${this.scale()})`}static new2(){return new i(E.new2(),1)}static new3(e){return new i(e.offset(),e.scale())}},ab;(o=>{function i(){return _o.new2()}o.FrozenSimpleTransform_new1=i;function e(a){return a}o.FrozenSimpleTransform_new2=e;function t(a){return _o.new3(a)}o.FrozenSimpleTransform_new3=t;function n(a,s){return new _o(a,s)}o.FrozenSimpleTransform_new4=n,o.FrozenSimpleTransform_IDENTITY=i()})(ab||(ab={}));var Qu=class{equals(e){return this.url==e.url&&this.scaleFactor==e.scaleFactor&&this.nonRotatedImageSize.equals(e.nonRotatedImageSize)&&this.nonRotatedOffset.equals(e.nonRotatedOffset)&&this.nonRotatedFramePresetSize.equals(e.nonRotatedFramePresetSize)}constructor(e,t,n,r,o){this.url=e,this.scaleFactor=t,this.nonRotatedImageSize=n,this.nonRotatedOffset=r,this.nonRotatedFramePresetSize=o}},oi=class oi{static deserializeVector(e){return new E(e.x,e.y)}static initialize(){let e=wt.getDeviceInfoByIdentifier();if(e!==null){oi._infoByIdentifier=new Map;for(let t in e){let n=e[t];oi._infoByIdentifier.set(t,new Qu(n.url,n.scaleFactor,oi.deserializeVector(n.imageSize),oi.deserializeVector(n.offset),oi.deserializeVector(n.framePresetSize)))}}}static infoForDevice(e){return oi._infoByIdentifier==null||e==null||e.type!="PRESET"?null:Le.StringMap_get(oi._infoByIdentifier,e.presetIdentifier,null)}static adjustNodeBoundsForDevice(e,t){let n=oi.infoForDevice(t);if(n==null)return e;let r=t.canvasSpaceTopLeftOffset(n),o=t.canvasSpaceImageSize(n),a=e.clone();return a.setX(e.x()-r.x()),a.setY(e.y()-r.y()),a.setWidth(o.x()),a.setHeight(o.y()),a}static canvasSpaceContentSize(e,t){let n=oi.infoForDevice(t);return n==null?e:t.canvasSpaceImageSize(n)}clearOnContextReset(){for(let e of Array.from(this._imageByURL.keys()))this._imageByURL.delete(e)}getImage(e,t){this._imageByURL.has(e.url)||this._imageByURL.set(e.url,jn.createDeviceImage(e));let n=this._imageByURL.get(e.url);return n.texture()==null&&n.fetchAndDecode(0,r=>{let o=N.in_Context.Context_createTexture1(t,N.TextureFormat.RGBA_LINEAR_CLAMP,1,1,"DeviceImage");n.setTexture(o);let a=r.expandToPowerOfTwo();n.texture().resize1(a.width,a.height,a,!0)},r=>{}),n}constructor(){this._imageByURL=new Map}};oi._infoByIdentifier=null;var Gr=oi;var la=(y=>(y[y.NONE=0]="NONE",y[y.WINDOW_VISIBILITY=1]="WINDOW_VISIBILITY",y[y.WINDOW_RESIZE=2]="WINDOW_RESIZE",y[y.WINDOW_FRAME=3]="WINDOW_FRAME",y[y.MOUSE_MOVE=4]="MOUSE_MOVE",y[y.MOUSE_PRESS=5]="MOUSE_PRESS",y[y.MOUSE_DRAG=6]="MOUSE_DRAG",y[y.MOUSE_RELEASE=7]="MOUSE_RELEASE",y[y.MOUSE_SCROLL=8]="MOUSE_SCROLL",y[y.MOUSE_DROP=9]="MOUSE_DROP",y[y.MOUSE_LEAVE=10]="MOUSE_LEAVE",y[y.TOUCH_PRESS=11]="TOUCH_PRESS",y[y.TOUCH_DRAG=12]="TOUCH_DRAG",y[y.TOUCH_RELEASE=13]="TOUCH_RELEASE",y[y.KEY_PRESS=14]="KEY_PRESS",y[y.KEY_RELEASE=15]="KEY_RELEASE",y[y.GAMEPAD_DOWN=16]="GAMEPAD_DOWN",y[y.ON_MEDIA_HIT=17]="ON_MEDIA_HIT",y))(la||{}),xo=class{type(){return this._type}target(){return this._target}modifiers(){return this._modifiers}asMouseEvent(){return null}asTouchEvent(){return null}asKeyEvent(){return null}asGamepadEvent(){return null}isAccepted(){return this._isAccepted}accept(){this._isAccepted=!0}constructor(e,t,n){this._type=e,this._target=t,this._modifiers=n,this._isAccepted=!1}},ug=(t=>(t[t.MOUSE=0]="MOUSE",t[t.TOUCH=1]="TOUCH",t))(ug||{}),As=class i extends xo{constructor(t,n,r,o,a,s,l,d){super(t,n,r);this._type=t;this._target=n;this._modifiers=r;this.locationInWindow=o,this.previousLocationInWindow=a,this.scrollDelta=s,this.clickCount=l,this.droppedFiles=d}interactionType(){return 0}asMouseEvent(){return this}interactionCount(){return 1}locationInView(t){let n=t.absoluteBounds();return new E(this.locationInWindow.x()-n.x(),this.locationInWindow.y()-n.y())}previousLocationInView(t){let n=t.absoluteBounds();return new E(this.previousLocationInWindow.x()-n.x(),this.previousLocationInWindow.y()-n.y())}delta(){return this.locationInWindow.subtract1(this.previousLocationInWindow)}clone(){return new i(this.type(),this.target(),this.modifiers(),this.locationInWindow,this.previousLocationInWindow,this.scrollDelta,this.clickCount,this.droppedFiles)}},hl=class{locationInView(e){let t=e.absoluteBounds();return new E(this.locationInWindow.x()-t.x(),this.locationInWindow.y()-t.y())}previousLocationInView(e){let t=e.absoluteBounds();return new E(this.previousLocationInWindow.x()-t.x(),this.previousLocationInWindow.y()-t.y())}constructor(e,t,n,r){this.id=e,this.originalTarget=t,this.locationInWindow=n,this.previousLocationInWindow=r}},dg=class{constructor(e,t,n){this.centroid=e,this.distance=t,this.count=n}},Ss=class i extends xo{constructor(t,n,r,o,a){super(t,n,r);this._type=t;this._target=n;this._modifiers=r;this.touches=o,this.allTouches=a,this.scrollDelta=null}interactionType(){return 1}asTouchEvent(){return this}interactionCount(){return this.touches.length}locationInView(t){return this.touches[0].locationInView(t)}previousLocationInView(t){return this.touches[0].previousLocationInView(t)}summaryInView(t){return t==null?i._summarizeTouches(this.touches,n=>n.locationInWindow):i._summarizeTouches(this.touches,n=>n.locationInView(t))}previousSummaryInView(t){return t==null?i._summarizeTouches(this.touches,n=>n.previousLocationInWindow):i._summarizeTouches(this.touches,n=>n.previousLocationInView(t))}delta(){return this.summaryInView(null).centroid.subtract1(this.previousSummaryInView(null).centroid)}static _summarizeTouches(t,n){let r=E.new2(),o=0;if(t.length!=0){for(let a of t)r.addUpdate1(n(a));r.divideUpdate(t.length);for(let a of t)o+=n(a).distanceTo(r);o/=t.length}return new dg(r,o,t.length)}},ys=class extends xo{constructor(t,n,r,o,a){super(t,n,r);this._type=t;this._target=n;this._modifiers=r;this.key=o,this.isRepeat=a}asKeyEvent(){return this}},Ku=class extends xo{constructor(t,n,r,o,a){super(t,n,r);this._type=t;this._target=n;this._modifiers=r;this.button=o,this.controllerType=a}asGamepadEvent(){return this}},rr;(n=>{function i(r){return r.length}n.handlerCount=i;function e(r,o){ce.List_appendOne(r,o)}n.addUpdate=e;function t(r,o){ce.List_removeOne(r,o)}n.subtractUpdate=t})(rr||(rr={}));var Jt;(T=>{function i(I){return g(I,1)}T.windowVisibility=i;function e(I){return g(I,2)}T.windowResize=e;function t(I){return g(I,3)}T.windowFrame=t;function n(I){return g(I,4)}T.mouseMove=n;function r(I){return g(I,5)}T.mousePress=r;function o(I){return g(I,6)}T.mouseDrag=o;function a(I){return g(I,7)}T.mouseRelease=a;function s(I){return g(I,8)}T.mouseScroll=s;function l(I){return g(I,9)}T.mouseDrop=l;function d(I){return g(I,10)}T.mouseLeave=d;function c(I){return g(I,11)}T.touchPress=c;function p(I){return g(I,12)}T.touchDrag=p;function u(I){return g(I,13)}T.touchRelease=u;function h(I){return g(I,14)}T.keyPress=h;function f(I){return g(I,15)}T.keyRelease=f;function _(I){return g(I,16)}T.gamepadDown=_;function m(I,O,w){ce.List_appendOne(g(I,O),w)}T.on=m;function A(I,O,w){let P=S(I,O);P!=null&&ce.List_removeOne(P,w)}T.off=A;function y(I,O){let w=S(I,O.type());if(w!=null){for(let P of w)if(P(O),O.isAccepted())break}}T.trigger=y;function S(I,O){return qt.IntMap_get(I,O,null)}T._handlers=S;function g(I,O){let w=qt.IntMap_get(I,O,null);return w==null&&(w=[],I.set(O,w)),w}T._createHandlers=g;function b(){return new Map}T._new=b})(Jt||(Jt={}));var sb;(e=>{function i(){return new Map}e._new=i})(sb||(sb={}));var qu;(t=>{function i(n){return Le.StringMap_get(t._triggerDeviceMap,n,"UNKNOWN_CONTROLLER")}t.stringToTriggerDevice=i,t._triggerDeviceMap=new Map([["KEYBOARD","KEYBOARD"],["UNKNOWN_CONTROLLER","UNKNOWN_CONTROLLER"],["XBOX_ONE","XBOX_ONE"],["PS4","PS4"],["SWITCH_PRO","SWITCH_PRO"]])})(qu||(qu={}));var ml;(t=>{function i(n,r,o,a){return qt.IntMap_get(n,r<<8|o,a)}t.KeyShortcutMap_get=i;function e(n,r,o,a){n.set(r<<8|o,a)}t.KeyShortcutMap_set=e})(ml||(ml={}));var Ra;(l=>{function i(d){return d==1||d==2||d==3}l.ViewerEventType_isWindowEventType=i;function e(d){return d==4||d==5||d==6||d==7||d==8||d==9||d==10}l.ViewerEventType_isMouseEventType=e;function t(d){return d==11||d==12||d==13}l.ViewerEventType_isTouchEventType=t;function n(d){return d==14||d==15}l.ViewerEventType_isKeyEventType=n;function r(d){return d==11||d==13||d==5||d==7||d==8||d==9}l.ViewerEventType_isTypeToBeBlockedByDeviceFrame=r;function o(d){return Le.StringMap_get(l.ViewerEventType__eventTypeFromString,d,0)}l.ViewerEventType_fromString=o;function a(d){return la[d]}l.ViewerEventType_toString=a,l.ViewerEventType__eventTypeFromString=new Map([["NONE",0],["WINDOW_VISIBILITY",1],["WINDOW_RESIZE",2],["WINDOW_FRAME",3],["MOUSE_MOVE",4],["MOUSE_PRESS",5],["MOUSE_DRAG",6],["MOUSE_RELEASE",7],["MOUSE_SCROLL",8],["MOUSE_DROP",9],["MOUSE_LEAVE",10],["TOUCH_PRESS",11],["TOUCH_DRAG",12],["TOUCH_RELEASE",13],["KEY_PRESS",14],["KEY_RELEASE",15],["GAMEPAD_DOWN",16]])})(Ra||(Ra={}));var lb;(e=>{function i(t){return ug[t]}e.InteractionType_toString=i})(lb||(lb={}));var Hc;(t=>{function i(n){return n>=105&&n<=108}t.Key_isModifier=i;function e(n){return qt.IntMap_get(m1,n,[0])}t.Key_keyToKeyCode=e})(Hc||(Hc={}));var bs;(e=>{function i(){return Xe.current()==4?2:8}e.Modifiers_currentPlatformModifier=i})(bs||(bs={}));function h1(i){let e=new Map;return qt.IntMap_each(i,(t,n)=>{let r=n;if(e.has(r)){e.get(r).push(t);return}e.set(r,[t])}),e}var pg=new Map([[8,1],[9,2],[10,3],[13,3],[16,107],[17,108],[18,105],[19,5],[20,6],[27,7],[32,8],[33,9],[34,10],[35,11],[36,12],[37,13],[38,14],[39,15],[40,16],[44,17],[45,18],[46,19],[48,20],[49,21],[50,22],[51,23],[52,24],[53,25],[54,26],[55,27],[56,28],[57,29],[59,90],[61,93],[63,30],[65,31],[66,32],[67,33],[68,34],[69,35],[70,36],[71,37],[72,38],[73,39],[74,40],[75,41],[76,42],[77,43],[78,44],[79,45],[80,46],[81,47],[82,48],[83,49],[84,50],[85,51],[86,52],[87,53],[88,54],[89,55],[90,56],[91,106],[92,106],[93,57],[96,58],[97,59],[98,60],[99,61],[100,62],[101,63],[102,64],[103,65],[104,66],[105,67],[106,68],[107,69],[109,70],[110,71],[111,72],[112,76],[113,77],[114,78],[115,79],[116,80],[117,81],[118,82],[119,83],[120,84],[121,85],[122,86],[123,87],[144,88],[145,89],[173,91],[186,90],[187,93],[188,94],[189,91],[190,95],[191,96],[192,104],[219,99],[220,100],[221,101],[222,98],[224,106]]),m1=h1(pg);function g1(){let i=new Map,e=window.location.search;if(e.length==0)return i;e=e.slice(1);for(let t of e.split("&")){let n=t.split("=");n.length==2&&i.set(n[0],n[1])}return i}function mr(){if(!cb){cb=!0;let i=g1(),e=Le.StringMap_get(i,"force-dpr",null);if(e!=null){let t=+parseFloat(e);isNaN(t)||(hg=new Se(fn.Math_clamp1(t,.1,4)))}}return hg!=null?hg.value:window.devicePixelRatio}var cb=!1,hg=null;var pb=(n=>(n[n.MIN_MIN=0]="MIN_MIN",n[n.MIN_MAX=1]="MIN_MAX",n[n.MAX_MAX=2]="MAX_MAX",n))(pb||{}),Wc=(n=>(n[n.NONE=0]="NONE",n[n.POINTER=1]="POINTER",n[n.TOUCH=2]="TOUCH",n))(Wc||{}),Vi=class Vi{parent(){return this._parent}window(){return this._window}children(){return this._children}events(){return this._events}focus(){this._window.setFocusedView(this)}absoluteBounds(){if(this._cachedAbsoluteBounds!=null)return this._cachedAbsoluteBounds;let e=null;if(this.parent()!=null)e=this.parent().absoluteBounds();else if(this==this.window().root())e=new U(0,0,this.window().width(),this.window().height());else return null;let t=e.width()|0,n=e.height()|0,r=this._minX+(this._alignX==2?t:0),o=this._maxX+(this._alignX!=0?t:0),a=this._minY+(this._alignY==2?n:0),s=this._maxY+(this._alignY!=0?n:0);return this._cachedAbsoluteBounds=new U(e.x()+r,e.y()+a,Math.max(0,o-r),Math.max(0,s-a)),e}viewFromPoint(e){let t=this.children().length;for(let n=0,r=t;n<r;n=n+1){let o=this.children()[t-n-1];if(o.absoluteBounds().contains2(e))return o.viewFromPoint(e)}return this}invalidateBounds(){this.forSelfAndDescendents(e=>{e._cachedAbsoluteBounds=null})}isEqualToOrParentOf(e){for(;e!=null;){if(e==this)return!0;e=e.parent()}return!1}selfAndParents(){let e=[];for(let t=this;t!=null;t=t.parent())e.push(t);return e}selfAndChildren(){let e=[],t=[this];for(;t.length!=0;){let n=t.pop(),r=n.children().length;e.push(n);for(let o=0,a=r;o<a;o=o+1)t.push(n.children()[r-o-1])}return e}setLayout(e,t,n,r,o,a){(this._alignX!=e||this._minX!=t||this._maxX!=n||this._alignY!=r||this._minY!=o||this._maxY!=a)&&(this._alignX=e,this._minX=t,this._maxX=n,this._alignY=r,this._minY=o,this._maxY=a,this._handleLayoutChange(),this.invalidateBounds())}setParent(e){if(e==this._parent)return;this._parent!=null&&ce.List_removeOne(this._parent.children(),this),e!=null&&e.children().push(this),this._handleParentChange(this._parent,e),this._parent=e,this.invalidateBounds();let t=e==null?void 0:e._window;this._window!=t&&this.forSelfAndDescendents(n=>{n._window=t})}forSelfAndDescendents(e){e(this);for(let t of this.children())t.forSelfAndDescendents(e)}setCursor(e){Vi._appendCursorStyleIfNecessary(),e!=this._cursor&&(this._element.classList.remove(Vi._cssCursorClassName(this._cursor)),this._cursor=e,this._element.classList.add(Vi._cssCursorClassName(this._cursor)))}cursor(){return this._cursor}element(){return this._element==null&&(this._element=document.createElement("div"),this._element.style.position="absolute",this._handleLayoutChange()),this._element}becomeRoot(e){this._window=e}_handleParentChange(e,t){t!=null&&t._element!=null?t._element.appendChild(this.element()):e._element!=null&&e._element.removeChild(this.element())}_handleLayoutChange(){if(this._element!=null){let e=this._element.style;e.left=this._alignX==2?"auto":this._minX.toString()+"px",e.top=this._alignY==2?"auto":this._minY.toString()+"px",e.right=this._alignX==0?"auto":this._maxX.toString()+"px",e.bottom=this._alignY==0?"auto":this._maxY.toString()+"px",e.width=this._alignX==1?"auto":(this._maxX-this._minX).toString()+"px",e.height=this._alignY==1?"auto":(this._maxY-this._minY).toString()+"px"}}static _appendCursorStyleIfNecessary(){if(Vi._cursorStyle!=null)return;let e=(c,p,u,h)=>`
      cursor: url("${u}"), auto; /* Edge, IE */
      cursor: url("${c}") 30 30, pointer; /* Legacy */
      cursor: url("${h}") 30 30, pointer; /* FF */
      cursor: -webkit-image-set(url("${c}") 1x, url("${p}") 2x) 30 30, pointer; /* Webkit */
      `,t="/images/viewer/cursor-touch.png",n="/images/viewer/cursor-touch.cur",r="/images/viewer/cursor-touch@2x.png",o="/images/viewer/cursor-touch.svg",a="/images/viewer/cursor-touch-down.png",s="/images/viewer/cursor-touch-down.cur",l="/images/viewer/cursor-touch-down@2x.png",d="/images/viewer/cursor-touch-down.svg";Vi._cursorStyle=document.createElement("style"),Vi._cursorStyle.textContent=`
    .cursor-default {
      cursor: default;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .cursor-touch {
      ${e(t,r,n,o)}
    }

    .cursor-touch:active {
      ${e(a,l,s,d)}
    }

    /*
      We provide a mechanism for the app outside of the viewer to disable all
      viewer cursors. This is useful e.g. in comments mode where the containing
      react application is responsible for setting the cursor instead of code
      inside the viewer library. To use this, the containing application would
      add the viewer-cursors-disabled class to the HTMLElement that hosts the
      viewer canvas.
    */

    .viewer-cursors-disabled .cursor-default {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-pointer {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-touch {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-touch:active {
      cursor: inherit;
    }
`,document.head.appendChild(Vi._cursorStyle)}static _cssCursorClassName(e){switch(e){case 0:return"cursor-default";case 1:return"cursor-pointer";case 2:return"cursor-touch"}return null}constructor(){this._parent=null,this._window=null,this._children=[],this._events=Jt._new(),this._alignX=1,this._minX=0,this._maxX=0,this._alignY=1,this._minY=0,this._maxY=0,this._cachedAbsoluteBounds=null,this._element=null,this._cursor=0}};Vi._cursorStyle=null;var zc=Vi,mg=class{name(){return this._file.name}mimeType(){return this._file.type}bytes(){return this._promise==null&&(this._promise=new Promise((e,t)=>{let n=new FileReader;n.onload=()=>{e(new Uint8Array(nu.FileReader_resultAsArrayBuffer(n)))},n.onloadend=()=>{t(pr.VOID)},n.readAsArrayBuffer(this._file)})),this._promise}constructor(e){this._file=e,this._promise=null}},Yu=class{constructor(e,t,n,r){this._root=null,this._width=0,this._height=0,this._devicePixelRatio=0,this._eventHandlersBefore=Jt._new(),this._eventHandlersAfter=Jt._new(),this._isInlinePreviewCallback=r,this._events=Jt._new(),this._afterNotifyCallback=null,this._isActive=!0,this._focusedView=null,this._containerElement=null,this._disableOwnOnFrameCallback=!1,this._internalOnFrameID=0,this.forceFrame=null,this.internalOnFrame=null,this._containerElement=e,this._disableOwnOnFrameCallback=n,this._root=new zc,this._root.becomeRoot(this);let o=null,a=null,s=null,l=null,d=null,c=null,p=document,u=window,h=this.root().element(),f=x=>{Qo.Event_preventDefault(x)},_=(x,F)=>{en.EventTarget_removeEventListener3(x,"mousemove",a),en.EventTarget_removeEventListener3(x,"mouseup",s),en.EventTarget_removeEventListener5(x,"touchmove",d),en.EventTarget_removeEventListener5(x,"touchend",c),en.EventTarget_addEventListener4(F,"mousemove",a),en.EventTarget_addEventListener4(F,"mouseup",s),en.EventTarget_addEventListener6(F,"touchmove",d),en.EventTarget_addEventListener6(F,"touchend",c)};this.forceFrame=()=>{this._resize(),Jt.trigger(this.events(),new xo(3,this.root(),0))},this.internalOnFrame=()=>{this._resize();try{Jt.trigger(this.events(),new xo(3,this.root(),0))}catch(x){Zs(x)}this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))};let m=()=>{this._isActive=!p.hidden,Jt.trigger(this.events(),new xo(1,this.root(),0)),_(p,h)},A=x=>{let F=(x.altKey?1:0)|(x.metaKey?2:0)|(x.shiftKey?4:0)|(x.ctrlKey?8:0);return bs.Modifiers_currentPlatformModifier()&F?F|16:F},y=(x,F)=>{for(let k=this.root().element();k!=null;k=k.offsetParent)x=x-k.offsetLeft,F=F-k.offsetTop;return new E(x,F)},S=0,g=0,b=0,T=0,I=x=>{let F=0,k=ns.Performance_now(u.performance);return F=1,T!=0&&k-T<500&&Math.abs(x.pageX-S)<4&&Math.abs(x.pageY-g)<4&&(F=b+1),S=x.pageX,g=x.pageY,b=F,T=k,F},O=null,w=null,P=!1,H=(x,F,k,G)=>{let M=y(x.pageX,x.pageY),Q=w!=null?w:this.root().viewFromPoint(M),Y=new As(F==4&&P?6:F,Q,A(x),M,O!=null?O:M,k,F==5?I(x):0,G);O=M,this.notify(Y),Y.isAccepted()&&(Y.type()==5&&x.button==0||Qo.Event_preventDefault(x),F==5&&(w=Q)),F==5?P=!0:F==7&&(w=null,P=!1)},re=new Map,q=(x,F)=>{let k=new Map,G=[];Array.from(re.values()).forEach(Q=>{ce.List_appendOne(G,Q.originalTarget)});let M=ou.TouchEvent_touches(x).map(Q=>{let Y=Q.identifier,B=y(Q.pageX,Q.pageY),te=qt.IntMap_get(re,Y,null),j=te!=null?te.originalTarget:this.root().viewFromPoint(B),ie=new hl(Y,j,B,te!=null?te.locationInWindow:B);return k.set(Y,ie),ce.List_appendOne(G,j),ie});re=k;for(let Q of G){let Y=new Ss(F,Q,A(x),M.filter(B=>B.originalTarget==Q),M);this.notify(Y),Y.isAccepted()&&Qo.Event_preventDefault(x)}},W=(x,F)=>{let k=qt.IntMap_get(pg,x.which,0),G=A(x),M=(bs.Modifiers_currentPlatformModifier()&G)!=0&&(k==91||k==93||k==20),Q=this.focusedView();M&&Qo.Event_preventDefault(x);let Y=B=>{for(;B!==p;){if(B.className.split(" ").indexOf("viewer-forward-keyevents")!=-1)return!0;B=B.parentNode}return!1};if((M||p.activeElement==null||p.activeElement==p.body||Y(p.activeElement))&&k!=0&&Q!=null){let B=new ys(F,Q,G,k,!1);this.notify(B),(B.isAccepted()||k==1)&&(Qo.Event_preventDefault(x),x.stopPropagation())}};if(o=x=>{_(h,p),H(x,5,null,null),window.focus(),document.activeElement!=null&&document.activeElement.blur()},a=x=>{H(x,4,null,null)},s=x=>{_(p,h),H(x,7,null,null)},l=x=>{q(x,11)},d=x=>{q(x,12)},c=x=>{q(x,13)},en.EventTarget_addEventListener3(p,"keydown",x=>{W(x,14)}),en.EventTarget_addEventListener3(p,"keyup",x=>{W(x,15)}),en.EventTarget_addEventListener7(h,"wheel",x=>{let F=x.deltaMode,k=F==x.DOM_DELTA_LINE?10:F==x.DOM_DELTA_PAGE?100:1;H(x,8,new E(x.deltaX*k,x.deltaY*k),null)}),en.EventTarget_addEventListener14(p,"wheel",x=>{x.ctrlKey&&Qo.Event_preventDefault(x)},{passive:!1}),en.EventTarget_addEventListener5(p,"drop",x=>{Qo.Event_preventDefault(x),H(x,9,null,ru.DataTransfer_files(x.dataTransfer).map(F=>new mg(F)))}),en.EventTarget_addEventListener4(p,"mouseenter",x=>{O=null}),en.EventTarget_addEventListener4(h,"mouseleave",x=>{H(x,10,null,null)}),t!=null){let x=t;x.onPress(F=>{let k=new Ku(16,this.root(),0,F.buttons[0],qu.stringToTriggerDevice(F.controllerType));this.notifyAll(k)}),x.start()}en.EventTarget_addEventListener1(u,"resize",()=>{this._resize()}),en.EventTarget_addEventListener1(u,"visibilitychange",m),en.EventTarget_addEventListener2(h,"contextmenu",f),en.EventTarget_addEventListener4(h,"mousedown",o),en.EventTarget_addEventListener6(h,"touchstart",l),en.EventTarget_addEventListener2(p,"dragenter",f),en.EventTarget_addEventListener2(p,"dragover",f),this._containerElement!=null&&this._containerElement.appendChild(h),this._focusedView=this.root(),m(),this._resize(),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}root(){return this._root}width(){return this._width}height(){return this._height}size(){return new E(this._width,this._height)}isActive(){return this._isActive}focusedView(){return this._focusedView}devicePixelRatio(){return this._devicePixelRatio}eventsBefore(){return this._eventHandlersBefore}eventsAfter(){return this._eventHandlersAfter}events(){return this._events}setAfterNotify(e){this._afterNotifyCallback=e}clearAfterNotify(){this._afterNotifyCallback=null}_afterNotify(e){this._afterNotifyCallback!=null&&this._afterNotifyCallback(e)}notify(e){let t=e.target().selfAndParents();if(Jt.trigger(this._eventHandlersBefore,e),e.isAccepted()){this._afterNotify(e);return}for(let n of t)if(Jt.trigger(n.events(),e),e.isAccepted()){this._afterNotify(e);return}Jt.trigger(this._eventHandlersAfter,e),this._afterNotify(e)}notifyAll(e){let t=e.target().selfAndChildren();if(Jt.trigger(this._eventHandlersBefore,e),!e.isAccepted()){for(let n of t)if(Jt.trigger(n.events(),e),e.isAccepted())return;Jt.trigger(this._eventHandlersAfter,e)}}dangerouslyDisableOnFrameCallbackForTesting(){this._disableOwnOnFrameCallback=!0}_resize(){if(this._containerElement==null)return;let e=document.body,t=this._isInlinePreviewCallback()?this._containerElement.getBoundingClientRect().width:this._containerElement==e?window.innerWidth:this._containerElement.clientWidth,n=this._isInlinePreviewCallback()?this._containerElement.getBoundingClientRect().height:this._containerElement==e?window.innerHeight:this._containerElement.clientHeight,r=mr();(this._width!=t||this._height!=n||this._devicePixelRatio!=r)&&(this._width=t,this._height=n,this._devicePixelRatio=r,this.root().invalidateBounds(),this.notifyAll(new xo(2,this.root(),0)))}setFocusedView(e){this._focusedView=e}createDiv(){return document.createElement("div")}setNewContainerElement(e){if(e==null)throw new Error("Can't mount the viewer in a null DOM node");this._containerElement=e,e.appendChild(this.root().element()),this._resize(),this._internalOnFrameID!=0&&cancelAnimationFrame(this._internalOnFrameID),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}},db;(e=>{function i(t){return pb[t]}e.ViewAlign_toString=i})(db||(db={}));var ub;(e=>{function i(t){return Wc[t]}e.Cursor_toString=i})(ub||(ub={}));var ju=(n=>(n[n.BOUNCING=0]="BOUNCING",n[n.CLAMPING=1]="CLAMPING",n[n.DEFAULT=2]="DEFAULT",n))(ju||{});function fg(i){switch(i){case 2:case 4:return 0;case 1:case 3:case 5:return 1;default:return 2}}var gl=class{createBallisticScrollSimulation(e,t,n,r,o,a){return null}applyOverscrollBehavior(e,t,n,r){return t}constructor(){}},Al=(r=>(r[r.FRICTION=0]="FRICTION",r[r.SPRING=1]="SPRING",r[r.FIXED=2]="FIXED",r[r.CURVE=3]="CURVE",r))(Al||{}),Oa=class{constructor(){this._startTime=0,this._startTime=Qe.seconds()}endPos(){return new E(this._xSimulation().endPos(),this._ySimulation().endPos())}pos1(){return this.pos2(this.elapsed())}pos2(e){return new E(this._xSimulation().pos(e),this._ySimulation().pos(e))}dPos(e){return new E(this._xSimulation().dPos(e),this._ySimulation().dPos(e))}elapsed(){return Qe.seconds()-this._startTime}isDone1(){return this.isDone2(this.elapsed())}isOverscrolled(){return!1}isDone2(e){return this._xSimulation().isDone(e)&&this._ySimulation().isDone(e)}xSimulation(e){return this._xSimulation().typeAt(e)}ySimulation(e){return this._ySimulation().typeAt(e)}},Qc=class Qc{static withDampingRatio(e,t,n){return new Qc(e,t,n*2*Math.sqrt(e*t))}constructor(e,t,n){this.mass=e,this.stiffness=t,this.damping=n}};Qc.DEFAULT_SPRING=Qc.withDampingRatio(.5,100,1.1);var fl=Qc,_l=class{constructor(e,t){this.velocity=e,this.distance=t}},hb;(e=>{function i(t){return ju[t]}e.ScrollPhysicsType_toString=i})(hb||(hb={}));var mb;(e=>{function i(t){return Al[t]}e.SimulationType_toString=i})(mb||(mb={}));function _g(){return typeof window<"u"&&typeof mr()=="number"?new _l(1/(.05*mr()),1/mr()):new _l(1/.05,1)}var Sl=class{constructor(){if(arguments.length==2){let e=arguments[0],t=arguments[1];this._pos=0,this._velocity=0,this._vSign=0,this._duration=0,this._distance=0,this._friction=.015,this._initialVelocityPenetration=3.065,this._decelerationRate=Math.log(.78)/Math.log(.9),this._pos=e,this._velocity=t,this._vSign=Math.abs(this._velocity)/this._velocity|0,this._duration=this._flingDuration(t),this._distance=Math.abs(t*this._duration/this._initialVelocityPenetration)}else if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this._pos=0,this._velocity=0,this._vSign=0,this._duration=0,this._distance=0,this._friction=.015,this._initialVelocityPenetration=3.065,this._decelerationRate=Math.log(.78)/Math.log(.9),this._pos=e,this._velocity=t,this._vSign=Math.abs(this._velocity)/this._velocity|0,this._duration=n,this._distance=Math.abs(t*this._duration/this._initialVelocityPenetration)}}duration(){return this._duration}pos(e){if(this._duration==0)return this._pos;let t=fn.Math_clamp1(e/this._duration,0,1);return this._pos+this._distance*this._flingDistancePenetration(t)*this._vSign}dPos(e){if(this._duration==0)return this._velocity;let t=fn.Math_clamp1(e/this._duration,0,1);return this._distance*this._flingVelocityPenetration(t)*this._vSign/this._duration}isDone(e){return e>=this._duration}endPos(){return this._pos+this._distance}_decelerationForFriction(e){return e*61774.04968}_flingDuration(e){let t=this._friction*this._decelerationForFriction(.84),n=Math.log(.35*Math.abs(e)/t);return Math.exp(n/(this._decelerationRate-1))}_flingDistancePenetration(e){return 1.2*e*e*e-3.27*e*e+this._initialVelocityPenetration*e}_flingVelocityPenetration(e){return 3.6*e*e-6.54*e+this._initialVelocityPenetration}},Kc=class{constructor(){if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._drag=0,this._dragLog=0,this._p=0,this._v=0,this._tolerance=null,this._drag=e,this._dragLog=Math.log(e),this._p=t,this._v=n,this._tolerance=r}else if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this._drag=0,this._dragLog=0,this._p=0,this._v=0,this._tolerance=null,this._drag=e,this._dragLog=Math.log(e),this._p=t,this._v=n,this._tolerance=_g()}}pos(e){return this._p+this._v*Math.pow(this._drag,e)/this._dragLog-this._v/this._dragLog}dPos(e){return this._v*Math.pow(this._drag,e)}endPos(){return this._p-this._v/this._dragLog}timeAtPos(e){if(e==this._p)return 0;let t=this.endPos();return this._v==0||(this._v>0?e<this._p||e>t:e>this._p||e<t)?1/0:Math.log(this._dragLog*(e-this._p)/this._v+1)/this._dragLog}isDone(e){return Math.abs(this.dPos(e))<this._tolerance.velocity}},Fa=class{constructor(){if(arguments.length==5){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3],o=arguments[4];this._r1=0,this._r2=0,this._c1=0,this._c2=0,this._end=0,this._tolerance=null;let a=t-n,s=e.damping*e.damping-4*e.mass*e.stiffness;this._r1=(-e.damping-Math.sqrt(s))/(2*e.mass),this._r2=(-e.damping+Math.sqrt(s))/(2*e.mass),this._c2=(-(a*this._r1)+r)/(this._r2-this._r1),this._c1=a-this._c2,this._end=n,this._tolerance=o}else if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._r1=0,this._r2=0,this._c1=0,this._c2=0,this._end=0,this._tolerance=null;let o=t-n,a=e.damping*e.damping-4*e.mass*e.stiffness;this._r1=(-e.damping-Math.sqrt(a))/(2*e.mass),this._r2=(-e.damping+Math.sqrt(a))/(2*e.mass),this._c2=(-(o*this._r1)+r)/(this._r2-this._r1),this._c1=o-this._c2,this._end=n,this._tolerance=_g()}}endPos(){return this._end}pos(e){return this._end+this._c1*Math.pow(Math.E,this._r1*e)+this._c2*Math.pow(Math.E,this._r2*e)}dPos(e){return this._c1*this._r1*Math.pow(Math.E,this._r1*e)+this._c2*this._r2*Math.pow(Math.E,this._r2*e)}isDone(e){return Math.abs(this.pos(e)-this._end)<=this._tolerance.distance&&Math.abs(this.dPos(e))<=this._tolerance.velocity}},Ts=class{pos(e){return this._c}dPos(e){return 0}isDone(e){return!0}endPos(){return this._c}constructor(e){this._c=e}};var qc=class{applyOverscrollBehavior(e,t,n,r){let o=e.subtract1(n),s=e.subtract1(t).divide1(r).makeAbs(),l=this._frictionFactor2(s);return n.add1(l.multiply1(o))}_frictionFactor1(e){return e==0?1:.52*Math.pow(1-e,2)}_frictionFactor2(e){return new E(this._frictionFactor1(e.x()),this._frictionFactor1(e.y()))}createBallisticScrollSimulation(e,t,n,r,o,a){return new yl(e,t,n,r,o,a)}constructor(){}},yl=class extends Oa{constructor(t,n,r,o,a,s){super();this._xSim=null,this._ySim=null;let l=fl.DEFAULT_SPRING;this._xSim=new Zu(t.x(),n.x(),r,o,l),this._ySim=new Zu(t.y(),n.y(),a,s,l)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}isOverscrolled(){return this._xSimulation().typeAt(this.elapsed())==1||this._ySimulation().typeAt(this.elapsed())==1}},Zu=class{constructor(e,t,n,r,o){if(this._frictionSimulationIOS=null,this._springSimulation=null,this._fixedSolution=null,this._startTime=0,this._springTime=0,this._timeOffset=0,e<n)this._springSimulation=new Fa(o,e,n,t),this._springTime=-1/0;else if(e>r)this._springSimulation=new Fa(o,e,r,t),this._springTime=-1/0;else if(t==0)this._fixedSolution=new Ts(e);else{this._frictionSimulationIOS=new Kc(f1,e,t);let a=this._frictionSimulationIOS.endPos();t>0&&a>r?(this._springTime=this._frictionSimulationIOS.timeAtPos(r),this._springSimulation=new Fa(o,r,r,Math.min(this._frictionSimulationIOS.dPos(this._springTime),gb))):t<0&&a<n?(this._springTime=this._frictionSimulationIOS.timeAtPos(n),this._springSimulation=new Fa(o,n,n,Math.min(this._frictionSimulationIOS.dPos(this._springTime),gb))):this._springTime=1/0}}_simulation(e){return this._fixedSolution!=null?this._fixedSolution:e>this._springTime?(this._timeOffset=isFinite(this._springTime)?this._springTime:0,this._springSimulation):(this._timeOffset=0,this._frictionSimulationIOS)}typeAt(e){return this._fixedSolution!=null?2:e<=this._springTime?0:1}endPos(){return this._fixedSolution!=null?this._fixedSolution.pos(0):isFinite(this._springTime)||this._springTime<0?this._springSimulation.endPos():this._frictionSimulationIOS.endPos()}pos(e){return this._simulation(e).pos(e-this._timeOffset)}dPos(e){return this._simulation(e).dPos(e-this._timeOffset)}isDone(e){return this._simulation(e).isDone(e-this._timeOffset)}},gb=5e3,f1=.135;var Yc=class{createBallisticScrollSimulation(e,t,n,r,o,a){return new Ag(e,t,n,r,o,a)}applyOverscrollBehavior(e,t,n,r){return t}constructor(){}},Ag=class extends Oa{constructor(t,n,r,o,a,s){super();if(this._xSim=null,this._ySim=null,Math.abs(n.x())>Math.abs(n.y())){this._xSim=new bl(t.x(),n.x(),r,o);let l=Math.abs(n.y())>=fb?n.y():0;this._ySim=new bl(t.y(),l,a,s,this._xSimulation().duration())}else{this._ySim=new bl(t.y(),n.y(),a,s);let l=Math.abs(n.x())>=fb?n.x():0;this._xSim=new bl(t.x(),l,r,o,this._ySimulation().duration())}}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},bl=class{constructor(){if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._startTime=0,this._simulation=null,this._min=0,this._max=0,this._duration=-1/0,this._min=n,this._max=r,t==0?this._simulation=new Ts(e):(this._simulation=new Sl(e,t),this._duration=this._simulation.duration()),this._startTime=Qe.seconds()}else if(arguments.length==5){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3],o=arguments[4];this._startTime=0,this._simulation=null,this._min=0,this._max=0,this._duration=-1/0,this._min=n,this._max=r,t==0?this._simulation=new Ts(e):this._simulation=new Sl(e,t,o),this._startTime=Qe.seconds()}}duration(){return this._duration}pos(e){let t=this._simulation.pos(e);return t<=this._min?this._min:t>=this._max?this._max:t}dPos(e){return this._simulation.dPos(e)}endPos(){return this._simulation.endPos()}isDone(e){if(this._simulation.isDone(e))return!0;let t=this.pos(e);return t>=this._max||t<=this._min}elapsed(){return Qe.seconds()-this._startTime}typeAt(e){return 0}},fb=50;var Xc=class extends Oa{constructor(t,n,r,o){super();this._xSim=null,this._ySim=null,this._xSim=new $u(t.x(),n.x(),r,o),this._ySim=new $u(t.y(),n.y(),r,o)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},$u=class{constructor(e,t,n,r){this._begin=0,this._end=0,this._duration=0,this._curve=null,this._begin=e,this._end=t,this._duration=n,this._curve=r}pos(e){let t=fn.Math_clamp1(e/this._duration,0,1);return t==0?this._begin:t==1?this._end:this._begin+(this._end-this._begin)*this._curve.get(t)}dPos(e){return(this.pos(e+.001)-this.pos(e-.001))/(2*.001)}endPos(){return this._end}isDone(e){return e>this._duration}typeAt(e){return 3}};var jc;(a=>{function i(s,l,d){s.set(l,d)}a.Map_set1=i;function e(s,l){return s.get(l)}a.Map_get1=e;function t(s,l,d){let c=s.get(l);return c!==void 0?c:d}a.Map_getOrDefault=t;function n(s){return Array.from(s.keys())}a.Map_keys=n;function r(s){return Array.from(s.values())}a.Map_values=r;function o(s,l){let d=new Map;for(let c=0,p=s.length;c<p;c=c+1)d.set(s[c],l[c]);return d}a.Map_new1=o})(jc||(jc={}));var _b;(n=>{function i(r,o){return r.get(o)}n.WeakMap_get1=i;function e(r,o,a){r.set(o,a)}n.WeakMap_set1=e;function t(r,o){let a=new WeakMap;for(let s=0,l=r.length;s<l;s=s+1)a.set(r[s],o[s]);return a}n.WeakMap_new1=t})(_b||(_b={}));var Cr=class i{add(e){this._hash.set(e,!0)}_in(e){return this._hash.has(e)}remove(e){this._hash.delete(e)}count(){return this._hash.size}asList(){return Array.from(this._hash.keys())}each(e){Array.from(this._hash.keys()).forEach(e)}map(e){return Array.from(this._hash.keys()).map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of Array.from(this._hash.keys()))if(!e._in(t))return!1;return!0}static fromList(e){let t=new i;for(let n of e)t.add(n);return t}constructor(){this._hash=new Map}};var In;(t=>{let i;(l=>(l[l.NON_RENDERABLE=0]="NON_RENDERABLE",l[l.RENDERABLE_GEOMETRY=1]="RENDERABLE_GEOMETRY",l[l.RENDERABLE_TEXT=2]="RENDERABLE_TEXT",l[l.RENDERABLE_GROUP=3]="RENDERABLE_GROUP",l[l.CUSTOM_RENDER_TREE=4]="CUSTOM_RENDER_TREE"))(i=t.RenderableContentType||(t.RenderableContentType={}));let e;(r=>{function n(o){return t.RenderableContentType[o]}r.RenderableContentType_toString=n})(e=t.in_RenderableContentType||(t.in_RenderableContentType={}))})(In||(In={}));var Sg;(e=>{function i(){return new Map}e._new=i})(Sg||(Sg={}));var Is=class{toString(){return this.name+" "+this.relativeChildIndex.toString()}toStringWithPrefix(e){let t=e?this.name.split("/")[0]:this.name;return t=t.trim(),t+" "+this.relativeChildIndex.toString()}constructor(e,t){this.name=e,this.relativeChildIndex=t}},Ju=class i{getData(e,t){let n=this.getAllDataForNode(e);return n!=null&&n.has(t)?n.get(t):null}getAllDataForNode(e){let t=this.getSubTrie(e);return t!=null?t.cache:null}insert(e,t,n){if(e.length==0){this.cache.set(t,n);return}let r=e[0].toString(),o=e.slice(1,e.length);this.children.has(r)||this.children.set(r,new i),this.children.get(r).insert(o,t,n)}remove(e,t){if(e.length==0){this.cache.delete(t);return}let n=e[0].toString(),r=e.slice(1,e.length);this.children.has(n)||this.children.set(n,new i),this.children.get(n).remove(r,t)}forEach(e){for(let t of Array.from(this.cache.keys()))e(this.cache.get(t));for(let t of Array.from(this.children.keys()))this.children.get(t).forEach(e)}getSubTrie(e){if(e.length==0)return this;let t=e[0].toString();return this.children.has(t)?this.children.get(t).getSubTrie(e.slice(1,e.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let t of Array.from(this.cache.keys()))e!=null&&e(this.cache.get(t));for(let t of Array.from(this.children.keys()))this.children.get(t).uninitialize2(e),this.children.delete(t)}toString1(){return this.toString2(null)}toString2(e){let t=this.toStringHelper(e),n="";for(let r of t)n=n+`${r}
`;return n}toStringHelper(e){let t=[];for(let n of Array.from(this.cache.keys()))t.push(e==null?n:`${n}: ${e(this.cache.get(n))}`);for(let n of Array.from(this.children.keys())){let r=this.children.get(n).toStringHelper(e);for(let o of r)t.push(`${n}/${o}`)}return t}constructor(){this.cache=Sg._new(),this.children=new Map}},xa=class{getData(e,t){if(e.length==0)return null;let n=this._shouldUseTLFStorage(e)?this._getSSTDataCacheFromTLFStorage(e):this._getSSTDataCacheFromLowerNodeStorage(this._getNodesToTraverse(e));return n!=null&&n.has(t)?n.get(t):null}getAllDataForNode(e){return e.length==0?null:this._shouldUseTLFStorage(e)?this._getSSTDataCacheFromTLFStorage(e):this._getSSTDataCacheFromLowerNodeStorage(this._getNodesToTraverse(e))}_getSSTDataCacheFromTLFStorage(e){let t=e[0].toString();return this.tlfNodeStorage.has(t)?this.tlfNodeStorage.get(t).getAllDataForNode([]):null}_getSSTDataCacheFromLowerNodeStorage(e){let t=this._getFirstNodeName(e);return this.lowerNodeStorage.has(t)?this.lowerNodeStorage.get(t).getAllDataForNode(e.slice(1,e.length)):null}insert(e,t,n){e.length!=0&&(this._shouldUseTLFStorage(e)?this._insertIntoTLFStorage(e,t,n):this._insertIntoLowerNodeStorage(this._getNodesToTraverse(e),t,n))}remove(e,t){e.length!=0&&(this._shouldUseTLFStorage(e)?this._deleteFromTLFStorage(e,t):this._deleteFromLowerNodeStorage(this._getNodesToTraverse(e),t))}_deleteFromTLFStorage(e,t){let n=e[0].toString();this.tlfNodeStorage.has(n)&&this.tlfNodeStorage.get(n).remove(e.slice(1,e.length),t)}_deleteFromLowerNodeStorage(e,t){let n=this._getFirstNodeName(e);this.lowerNodeStorage.has(n)&&this.lowerNodeStorage.get(n).remove(e.slice(1,e.length),t)}_insertIntoTLFStorage(e,t,n){let r=e[0].toString();this.tlfNodeStorage.has(r)||this.tlfNodeStorage.set(r,new Ju),this.tlfNodeStorage.get(r).insert(e.slice(1,e.length),t,n)}_insertIntoLowerNodeStorage(e,t,n){let r=this._getFirstNodeName(e);this.lowerNodeStorage.has(r)||this.lowerNodeStorage.set(r,new Ju),this.lowerNodeStorage.get(r).insert(e.slice(1,e.length),t,n)}forEach(e){for(let t of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(t).forEach(e);for(let t of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(t).forEach(e)}getSubTrie(e){if(e.length==0)return this;if(this._shouldUseTLFStorage(e))return this.tlfNodeStorage.has(e[0].toString())?this.tlfNodeStorage.get(e[0].toString()):null;let t=this._getNodesToTraverse(e),n=this._getFirstNodeName(t);return this.lowerNodeStorage.has(n)?this.lowerNodeStorage.get(n).getSubTrie(t.slice(1,t.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let t of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(t).uninitialize2(e),this.tlfNodeStorage.delete(t);for(let t of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(t).uninitialize2(e),this.lowerNodeStorage.delete(t)}toString1(){return this.toString2(null)}toString2(e){let t=this._toStringHelper(e),n="";for(let r of t)n=n+`${r}
`;return n}_toStringHelper(e){let t=[];for(let n of Array.from(this.lowerNodeStorage.keys())){let r=this.lowerNodeStorage.get(n).toStringHelper(e);for(let o of r)t.push(`*/${n}/${o}`)}for(let n of Array.from(this.tlfNodeStorage.keys())){let r=this.tlfNodeStorage.get(n).toStringHelper(e);for(let o of r)t.push(`[TLF]/${n}/${o}`)}return t}_shouldUseTLFStorage(e){return!X.getFeatureFlags().prototypeStateManagement&&e.length==1}_getFirstNodeName(e){return e.length==1||!X.getFeatureFlags().prototypeStateManagement?e[0].toStringWithPrefix(X.getFeatureFlags().prototypeStateManagement):yg.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING}_getNodesToTraverse(e){return X.getFeatureFlags().prototypeStateManagement?e:e.slice(1,e.length)}constructor(){this.lowerNodeStorage=new Map,this.tlfNodeStorage=new Map}},wn;(l=>{function i(){l._cachedNodePaths.clear()}l.clearCachedNodePaths=i;function e(d){if(d==null)return[];if(l._cachedNodePaths.has(d.uniqueIdentifier()))return l._cachedNodePaths.get(d.uniqueIdentifier());let c=d.getSemanticNodePath();return l._cachedNodePaths.set(d.uniqueIdentifier(),c),c}l.getSemanticNodePath=e;function t(d){return d.type()=="FRAME"||d.type()=="INSTANCE"}l._isValidTLFType=t;function n(d){return d.isTopLevel()&&t(d)}l._isValidSemanticTLF=n;function r(d){if(d.isTopLevel()&&!t(d))return[];let c=[],p=!0;for(let u=d.clone();p&&u!=null;u=u.parent())c.splice(0,0,new Is(u.name(),X.getFeatureFlags().prototypeStateManagement?o(u):0)),n(u)&&(p=!1);return c}l.getSemanticNodePathHelper=r;function o(d){if(n(d)||d.parent()==null)return 0;let c=d.parent().clone(),p=[],u=c.childCount();for(let h=0;h<u;h=h+1){let f=c.clone();f.moveToChildAt(h),f.name()==d.name()&&p.push(f.uniqueIdentifier())}return p.indexOf(d.uniqueIdentifier())}l.getRelativeChildIndex=o,l.DEFAULT_STORAGE_KEY="storage_key",l._cachedNodePaths=new Map})(wn||(wn={}));var Ab;(l=>{function i(d){return d}l.SSTDataCache_asMap=i;function e(d){return Array.from(d.keys())}l.SSTDataCache_keys=e;function t(d,c){return d.has(c)}l.SSTDataCache_has=t;function n(d){return d.size}l.SSTDataCache_size=n;function r(d,c){d.delete(c)}l.remove=r;function o(d,c){return d.get(c)}l.SSTDataCache_get=o;function a(d,c,p){d.set(c,p)}l.SSTDataCache_set=a;function s(d,c){d.forEach(c)}l.SSTDataCache_forEach=s})(Ab||(Ab={}));var yg;(e=>e.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING="TLF Placeholder")(yg||(yg={}));var nn=class i{constructor(){if(arguments.length==1){let e=arguments[0];this.node=null,this._overlayRenderData=null,this.node=e}else if(arguments.length==2){let e=arguments[0],t=arguments[1];this.node=null,this._overlayRenderData=null,this.node=e,this._overlayRenderData=t}}clone(){return new i(this.node,this.overlayRenderData())}setNode(e){this.node=e}moveToChildAt(e){this.node=this.node.childAt2(e,!0)}moveToParent(){this.node=this.node.parent()}isRoot(){return this.node.parent()==null}indexInParent(){return this.node.indexInParent()}renderableContentType(){switch(this.node.type()){case"NONE":case"DOCUMENT":case"SLICE":case"INTERACTIVE_SLIDE_ELEMENT":return In.RenderableContentType.NON_RENDERABLE;case"CANVAS":case"GROUP":case"FRAME":case"SYMBOL":case"INSTANCE":case"STICKY":case"CODE_BLOCK":case"MEDIA":case"SECTION_OVERLAY":case"WIDGET":case"SHAPE_WITH_TEXT":case"CONNECTOR":case"SECTION":case"TABLE":case"TABLE_CELL":case"SLIDE":return In.RenderableContentType.RENDERABLE_GROUP;case"BOOLEAN_OPERATION":case"ELLIPSE":case"LINE":case"RECTANGLE":case"REGULAR_POLYGON":case"ROUNDED_RECTANGLE":case"STAR":case"VECTOR":case"HIGHLIGHT":case"STAMP":case"WASHI_TAPE":return In.RenderableContentType.RENDERABLE_GEOMETRY;case"TEXT":return In.RenderableContentType.RENDERABLE_TEXT}return Ke("Unhandled scene node type while getting cursor renderable content type"),In.RenderableContentType.NON_RENDERABLE}isFrameLike(){return un.isFrameLike(this.type())}isTopLevel(){return this.node.isTopLevel()}willChange(){return 0}shouldOptimizeShadowForAnimation(e){return!1}paintsDebugString(){return`SceneCursor ${this.node.paintsDebugString()}`}customRenderTree(e){return null}name(){return this.node.name()}scene(){return this.node.scene()}parent(){return this.node.parent()!=null?new i(this.node.parent()):null}blendMode(){return this.node.blendMode()}opacity(){return this.node.opacity()}visible(){return this.node.visible()}isVisibleMask(){return this.node.visible()&&this.node.isMask()}maskType(){return this.node.maskType()}isSpreadEligibleNode(){return this.node.isSpreadEligibleNode()}type(){return this.node.type()}childCount(){return this.node.childCount()}absoluteTransform(){return this.node!=null?this.node.absoluteTransform():Nt.FrozenAffineTransform_IDENTITY}maxTransformScale(){return 1}clipsChildren(){return this.node.clipsToBoundingRectangle()}stopsMaskPropagation(){return this.node.isMask()||this.node.clipsToBoundingRectangle()}arcData(){return this.node.arcData()}roundedRectInfo(){return this.node.roundedRectInfo()}fillGeometry(){return this.node.fillGeometry()}strokeGeometry(){return this.node.strokeGeometry()}fillGeometryForSpread(e,t,n){return this.node.fillGeometryForSpread(e,t,n)}strokeGeometryForSpread(e,t,n,r){return this.node.strokeGeometryForSpread(e,t,n,r)}size(){return this.node.size()}strokeAlign(){return this.node.strokeAlign()}strokeWeight(){return this.node.strokeWeight()}id(){return this.node.id()}uniqueIdentifier(){return this.node.id()}isInsideOutlineMask(){return this.node.isInsideOutlineMask()}textData(){return this.node.textData()}derivedTextData(){return this.node.derivedTextData()}textGeometry(){return this.node.textGeometry()}getCachedRenderTree(){return this.node.getCachedRenderTree()}renderTree(){return this.node.renderTree1()}renderTreeWithoutBackgroundBlurs(){return this.node.renderTreeWithoutBackgroundBlurs()}renderTreeForShadowRoot(){return this.node.renderTreeForShadowRoot1()}renderTreeForShadowDescendant(){return this.node.renderTreeForShadowDescendant1()}renderTreeForKnockoutShadowRoot(){return this.node.renderTreeForKnockoutShadowRoot1()}renderTreeForKnockoutShadowDescendant(){return this.node.renderTreeForKnockoutShadowDescendant1()}isFixed(){return this.node.isFixed()}isStandardScrolling(){return this.node.isStandardScrolling()}isStickyScrolling(){return this.node.isStickyScrolling()}scrollOffset(){return this.node.scrollOffset()}scrollDirection(){return this.node.scrollDirection()}hasOverflowingContentInScrollDirection(){return this.node.hasOverflowingContentInScrollDirection()}effects(){return this.node.effects()}fillPaints(){return this.node.fillPaints()}strokePaints(){return this.node.strokePaints()}fillPaintsToRender(){return this.node.fillPaintsToRender()}videoPlayback(){return this.node.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this.node.containerSupportsFillStrokeAndCorners()}isGroup(){return this.node.isGroup()}hasNonZeroStrokeWeight(){return this.node.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this.node.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this.node.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this.node.overrideKey()}getSemanticNodePath(){return wn.getSemanticNodePathHelper(this)}hasBackgroundBlurs(){return this.node.hasBackgroundBlurs()}overlayRenderData(){return this._overlayRenderData}};var ca=class i{startAnimation(e,t){this._animationCurve=e,this._animationStartTime=Qe.seconds(),this._animationEndTime=this._animationStartTime+t}animationProgress(){let e=(Qe.seconds()-this._animationStartTime)/(this._animationEndTime-this._animationStartTime);return this._animationCurve==i.Curve.EASE_IN_OUT?e*=e*e*(e*(e*6-15)+10):(e=1-e,e=1-e*e*e*e*e),Math.min(e,1)}constructor(){this._animationCurve=i.Curve.EASE_IN_OUT,this._animationStartTime=0,this._animationEndTime=0}};(t=>{let i;(o=>(o[o.EASE_IN_OUT=0]="EASE_IN_OUT",o[o.DECAY=1]="DECAY"))(i=t.Curve||(t.Curve={}));let e;(r=>{function n(o){return t.Curve[o]}r.Curve_toString=n})(e=t.in_Curve||(t.in_Curve={}))})(ca||(ca={}));var Zc=(t=>(t[t.NOT_ANIMATED=0]="NOT_ANIMATED",t[t.ANIMATED=1]="ANIMATED",t))(Zc||{}),Tb=(t=>(t[t.SNAP_VIEWPORT_TO_PIXEL_VIEW_SPACE=0]="SNAP_VIEWPORT_TO_PIXEL_VIEW_SPACE",t[t.DISABLE_VIEWPORT_PIXEL_ADJUSTMENT=1]="DISABLE_VIEWPORT_PIXEL_ADJUSTMENT",t))(Tb||{}),$c=(t=>(t[t.RESET=0]="RESET",t[t.PRESERVE=1]="PRESERVE",t))($c||{}),Ao=class Ao{zoomScale(){return this._boundsMapping.viewPixelsPerCanvasPixel()}viewSpaceBounds(){return this._boundsMapping.viewSpaceBounds()}resetStateForTests(){this._boundsMapping=new ep,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._dummyOffset=E.new2(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._boundsOfDevicePreview=U.new2(),this._minZoom=0,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=E.new2(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=U.new2()}pixelSpaceBounds(e){let t=this.viewSpaceBounds();return new U(t.left()*e,t.top()*e,t.width()*e,t.height()*e)}_clampingBoundsForCanvasSpaceOffset(){return this._boundsMapping.clampingBoundsForCanvasSpaceOffset()}copyFrom(e){this._boundsMapping=e._boundsMapping.clone(),this._boundsOfDevicePreview.copyFrom(e._boundsOfDevicePreview),this._isInvalid=e._isInvalid,this._minZoom=e._minZoom,this._scrollPadding=e._scrollPadding}offsetX(){return this.offset().x()}offsetY(){return this.offset().y()}offset(){return this._boundsMapping.canvasSpaceOrigin().negative()}_setCanvasSpaceOffsetTo(e){this._boundsMapping.setCanvasSpaceOriginTo(e.negative())}canvasSpaceToViewSpace1(){return X.isInlinePreview()?this.canvasSpaceToViewSpace2(1):this.canvasSpaceToViewSpace2(0)}canvasSpaceToViewSpace2(e){return this._boundsMapping.canvasSpaceToViewSpace(e)}viewSpaceToCanvasSpace1(){return X.isInlinePreview()?this._boundsMapping.viewSpaceToCanvasSpace(1):this._boundsMapping.viewSpaceToCanvasSpace(0)}viewSpaceToCanvasSpace2(e){return this._boundsMapping.viewSpaceToCanvasSpace(e)}viewSpaceToClipSpace(){let e=oe.new2().copyFrom(Nt.FrozenAffineTransform_IDENTITY);return e.copyFrom(Nt.FrozenAffineTransform_IDENTITY),e.scale4(1,-1),e.translate2(-1,-1),e.scale4(2/this.viewSpaceBounds().width(),2/this.viewSpaceBounds().height()),e}canvasSpaceToClipSpace1(){return X.isInlinePreview()?this.canvasSpaceToClipSpace2(1):this.canvasSpaceToClipSpace2(0)}canvasSpaceToClipSpace2(e){let t=this.viewSpaceToClipSpace();return t.multipliedBy2(this.canvasSpaceToViewSpace2(e)),t}computeCanvasSpaceBounds1(e){X.isInlinePreview()?this.computeCanvasSpaceBounds2(e,1):this.computeCanvasSpaceBounds2(e,0)}computeCanvasSpaceBounds2(e,t){this._boundsMapping.computeCanvasSpaceBounds(e,t)}isInvalid(){return this._isInvalid}invalidate(){this._isInvalid=!0}setBounds(e){(this.viewSpaceBounds()==null||!this.viewSpaceBounds().equals(e))&&(this._boundsMapping.setViewSpaceBounds(e),this._isInvalid=!0)}_setCamera1(e,t,n,r){e==1?this._setCameraWithAnimation(t,n,ca.Curve.EASE_IN_OUT,r):(this._isAnimating=!1,(!this.offset().equals(t)||this.zoomScale()!=n)&&(this._setCanvasSpaceOffsetTo(t),this._boundsMapping.setViewPixelsPerCanvasPixel(n),this._isInvalid=!0))}_setCamera2(e,t,n){this._setCamera1(e,t,n,Ao.ANIMATION_DURATION)}_setCameraWithAnimation(e,t,n,r){this._animationManager.startAnimation(n,r),this._animationOffsetStart=this.offset().clone(),this._animationOffsetEnd=e.clone(),this._animationZoomScaleStart=this.zoomScale(),this._animationZoomScaleEnd=this._clampedZoomScale(t),this._calculateBoundsForClamping(this._animationZoomScaleEnd,this._animationEndBounds),this._clampedAnimationOffsetEnd.setTo(fn.Math_clamp1(e.x(),this._animationEndBounds.left(),this._animationEndBounds.right()),fn.Math_clamp1(e.y(),this._animationEndBounds.top(),this._animationEndBounds.bottom())),this._isAnimating=!0,this._isInvalid=!0}_clampCameraOffset(){if(!this._useClamping)return;this._dummyOffset.copyFrom(this.offset()),this._updateBoundsForClamping(),this._setCanvasSpaceOffsetTo(this._dummyOffset);let e=fn.Math_clamp1(this.offsetX(),this._clampingBoundsForCanvasSpaceOffset().left(),this._clampingBoundsForCanvasSpaceOffset().right()),t=fn.Math_clamp1(this.offsetY(),this._clampingBoundsForCanvasSpaceOffset().top(),this._clampingBoundsForCanvasSpaceOffset().bottom()),n=1e-6;if(Math.abs(this.offsetX()-e)>n||Math.abs(this.offsetY()-t)>n)if(this._isAnimating&&this._animationZoomScaleStart==this._animationZoomScaleEnd)this.offsetX()!=e&&(this._animationOffsetStart=new E(e,this._animationOffsetStart.y()),this._animationOffsetEnd=new E(e,this._animationOffsetEnd.y()),this._setCanvasSpaceOffsetTo(new E(e,this.offset().y()))),this.offsetY()!=t&&(this._animationOffsetStart=new E(this._animationOffsetStart.x(),t),this._animationOffsetEnd=new E(this._animationOffsetEnd.x(),t),this._setCanvasSpaceOffsetTo(new E(this.offset().x(),t))),this._animationOffsetStart.equals(this._animationOffsetEnd)&&(this._isAnimating=!1);else if(this._isAnimating){if(this._alreadySetAnimationClamp)return;this._animationOffsetStart=this.offset(),this._animationOffsetEnd=this._clampedAnimationOffsetEnd,this._alreadySetAnimationClamp=!0}else this._setCamera2(0,new E(e,t),this.zoomScale());this.zoomScale()<this._minZoom&&this._boundsMapping.setViewPixelsPerCanvasPixel(this._minZoom)}setCameraZoom(e,t){let n=e==1&&this._isAnimating;this._setCamera2(e,n?this._animationOffsetEnd:this.offset(),t)}adjustCameraZoom1(e,t){let n=e==1&&this._isAnimating;this._setCamera2(e,n?this._animationOffsetEnd:this.offset(),(n?this._animationZoomScaleEnd:this.zoomScale())*t)}adjustCameraZoom2(e,t,n){let r=e==1&&this._isAnimating;this._setCamera1(e,r?this._animationOffsetEnd:this.offset(),(r?this._animationZoomScaleEnd:this.zoomScale())*t,n)}adjustCameraZoomRounded(e,t){let n=e==1&&this._isAnimating;this.setCameraZoom(1,Math.pow(2,Math.round(Math.log((n?this._animationZoomScaleEnd:this.zoomScale())*t)/Math.log(2))))}setCameraOffset1(e,t){this.setCameraOffset2(e,t,Ao.ANIMATION_DURATION)}setCameraOffset2(e,t,n){let r=e==1&&this._isAnimating;this._setCamera1(e,t,r?this._animationZoomScaleEnd:this.zoomScale(),n),this._clampCameraOffset()}panCamera(e){this._setCamera2(0,this.offset().add1(e.divide(this.zoomScale())),this.zoomScale()),this._clampCameraOffset()}flingCameraOffset(e,t){this._setCameraWithAnimation((this._isAnimating?this._animationOffsetEnd:this.offset()).add1(e.divide(this.zoomScale())),this._isAnimating?this._animationZoomScaleEnd:this.zoomScale(),ca.Curve.DECAY,t),this._clampCameraOffset()}adjustCameraZoomWithPin(e,t){let n=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add1(t.subtract1(this.viewSpaceBounds().size().divide(2)).multiply(1/n-1/this.zoomScale())),n),this._clampCameraOffset()}adjustCameraZoomAndOffset(e,t,n){let r=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add1(n.subtract1(this.viewSpaceBounds().size().divide(2)).divide(r)).subtract1(t.subtract1(this.viewSpaceBounds().size().divide(2)).divide(this.zoomScale())),r),this._clampCameraOffset()}zoomToFit1(e,t,n){this._zoomToFit(e,t,Ao.ZOOM_TO_FIT_PADDING,n)}zoomToFit2(e,t){this._zoomToFit(e,t,Ao.ZOOM_TO_FIT_PADDING,Ao.ANIMATION_DURATION)}zoomToFitExactly(e,t){this._zoomToFit(e,t,0,Ao.ANIMATION_DURATION)}_zoomToFit(e,t,n,r){t.isEmpty()||(this._setCamera1(e,t.center().negative(),this.viewSpaceBounds().size().subtract(2*n).divide1(t.size()).min1(),r),this._clampCameraOffset())}prepareForRendering(){if(this._isAnimating){let e=this._animationManager.animationProgress();e>=1?(this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.clone()),this._boundsMapping.setViewPixelsPerCanvasPixel(this._animationZoomScaleEnd),this._isAnimating=!1,this._alreadySetAnimationClamp=!1):(this._boundsMapping.setViewPixelsPerCanvasPixel(1/(1/this._animationZoomScaleStart+(1/this._animationZoomScaleEnd-1/this._animationZoomScaleStart)*e)),this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.subtract1(this._animationOffsetStart).multiply(e).add1(this._animationOffsetStart)))}this._isInvalid=this._isAnimating}getScaleFactorForCurrentTlf(e,t,n){let r=Gr.canvasSpaceContentSize(e,n);if(r.x()===0||r.y()===0)return 1;switch(t){case 5:return r.x()>this.viewSpaceBounds().width()?this.viewSpaceBounds().width()/r.x():1;case 6:return this.viewSpaceBounds().width()/r.x();case 2:case 1:{let o=1/Math.max(r.x()/this.viewSpaceBounds().width(),r.y()/this.viewSpaceBounds().height());return t==2&&(o=Math.min(o,1)),o=Math.ceil(o*e.y())/e.y(),o}case 3:return 1;case 0:return 1;case 4:return 0;default:return 1}}_clampedZoomScale(e){let t=Math.max(this._minZoom,Ao.ZOOM_MIN);return Math.max(t,Math.min(e,Ao.ZOOM_MAX))}setScrollPadding(e){this._scrollPadding=e}previewBoundsIncludingDeviceFrame(e,t,n){return n!=null&&ba.hasDevice(n.type)?Gr.adjustNodeBoundsForDevice(e,n):X.isInlinePreview()?e:t}_snapOffsetToPixelGrid(e,t){let n=e.add1(t).multiply(this.zoomScale()*2);n.setX(Math.floor(n.x())),n.setY(Math.floor(n.y()));let r=n.divide(this.zoomScale()*2).subtract1(t);return t.add1(r.subtract1(e))}_calculateBoundsForClamping(e,t){let n=this._boundsOfDevicePreview.isInvalid()?U.new2():this._boundsOfDevicePreview,r=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[2])/e,n.width()/2),o=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[3])/e,n.height()/2),a=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[0])/e,n.width()/2),s=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[1])/e,n.height()/2),l=-n.right()+r,d=-n.bottom()+o,c=-n.left()-a,p=-n.top()-s,u=c-l,h=p-d;t.setTo1(l,d,u,h)}_updateBoundsForClamping(){let e=U.new2();this._calculateBoundsForClamping(this.zoomScale(),e),this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(e)}updateForBaseScreen(e,t,n){this.updateForCurrentPreview(e==null?void 0:e.canvasSpaceBoundingBox(),e==null?void 0:e.canvasSpacePreviewBounds(),t,n)}updateForCurrentPreview(e,t,n,r){if(t==null||e==null){this._useClamping=!1;return}switch(this._boundsOfDevicePreview.copyFrom(this.previewBoundsIncludingDeviceFrame(e,t,r)),this._minZoom=this.getScaleFactorForCurrentTlf(t.size(),n,r),n){case 4:{this._useClamping=!1;break}case 3:case 5:case 0:case 6:{this._useClamping=!0,this._updateBoundsForClamping(),this._clampCameraOffset();let o=r!=null&&r.type!="NONE";vs.FitMode_userCanManuallyZoom(n,o)||this.setCameraZoom(0,this._minZoom);break}case 1:case 2:{this._useClamping=!0;let o=this._snapOffsetToPixelGrid(t.topLeft(),this._boundsOfDevicePreview.center().negative());this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(new U(o.x(),o.y(),0,0)),this._setCamera2(0,o,this._minZoom);break}}}constructor(){this._boundsMapping=new ep,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._boundsOfDevicePreview=U.new2(),this._dummyOffset=E.new2(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._minZoom=0,this._animationManager=new ca,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=E.new2(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=U.new2()}};Ao.ZOOM_MIN=Math.pow(2,-6),Ao.ZOOM_MAX=Math.pow(2,8),Ao.ZOOM_TO_FIT_PADDING=50,Ao.ANIMATION_DURATION=.2;var hi=Ao,ep=class i{canvasSpaceOrigin(){return this._defaultCanvasSpaceOrigin().add1(this._canvasSpaceOriginDelta)}setCanvasSpaceOriginTo(e){this._canvasSpaceOriginDelta=e.subtract1(this._defaultCanvasSpaceOrigin())}viewSpaceBounds(){return this._viewSpaceBounds}setViewSpaceBounds(e){this._viewSpaceBounds=e}viewPixelsPerCanvasPixel(){return this._viewPixelsPerCanvasPixel}setViewPixelsPerCanvasPixel(e){this._viewPixelsPerCanvasPixel=e}clampingBoundsForCanvasSpaceOffset(){return this._clampingBoundsForCanvasSpaceOffset}setClampingBoundsForCanvasSpaceOffset(e){this._clampingBoundsForCanvasSpaceOffset.copyFrom(e)}canvasSpaceToViewSpace(e){let t=_o.new2().translatedBy2(this._viewSpaceBounds.width()/2,this._viewSpaceBounds.height()/2).scaledBy(this._viewPixelsPerCanvasPixel).translatedBy1(this.canvasSpaceOrigin().negative()),n=_o.new2();if(e==0){let r=E.new3(this.canvasSpaceOrigin()).rounded(),o=t.transformPoint(r),a=-(o.x()-Math.floor(o.x())),s=-(o.y()-Math.floor(o.y()));n.translate1(a,s)}return n.multiply(t),n}viewSpaceToCanvasSpace(e){let t=this.canvasSpaceToViewSpace(e).clone();return t.invert(),t}computeCanvasSpaceBounds(e,t){this._viewSpaceBounds.transformInto2(e,this.viewSpaceToCanvasSpace(t))}_defaultCanvasSpaceOrigin(){return this._clampingBoundsForCanvasSpaceOffset!=null?this._clampingBoundsForCanvasSpaceOffset.bottomRight().negative():ve.FrozenVector_ZERO}clone(){let e=new i;return e._canvasSpaceOriginDelta=this._canvasSpaceOriginDelta.clone(),e._viewPixelsPerCanvasPixel=this._viewPixelsPerCanvasPixel,e._viewSpaceBounds=this._viewSpaceBounds.clone(),e._clampingBoundsForCanvasSpaceOffset=this._clampingBoundsForCanvasSpaceOffset.clone(),e}constructor(){this._canvasSpaceOriginDelta=E.new2(),this._viewPixelsPerCanvasPixel=1,this._viewSpaceBounds=null,this._clampingBoundsForCanvasSpaceOffset=U.new2()}},Sb;(e=>{function i(t){return Zc[t]}e.ViewportUpdateType_toString=i})(Sb||(Sb={}));var yb;(e=>{function i(t){return Tb[t]}e.ViewportPixelAdjustment_toString=i})(yb||(yb={}));var bb;(e=>{function i(t){return $c[t]}e.StatePreserveType_toString=i})(bb||(bb={}));var Jc=class i{static getStateGroupID(e){var r;let t=e!=null?e.scene().findNode1(e==null?void 0:e.symbolID()):null,n=(r=t==null?void 0:t.findContainingStateGroupOrSelf())==null?void 0:r.id();return n==null?ne.invalid():n}constructor(e,t,n){this._appState=null,this._prototypeState=null,this._semanticChangeHistoryStorage=new xa,this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set,this._swapStateCallback=null,this._appState=e,this._prototypeState=t,this._swapStateCallback=n,X.getFeatureFlags().prototypeStateManagement&&(this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this))}getComponentHistory(e,t){if(e.length==0)return[];let n=this._semanticChangeHistoryStorage.getData(e,t);return n==null?[]:n}setComponentHistory(e,t,n){this._semanticChangeHistoryStorage.insert(e,t,n)}handleStateChangeCommitted(e,t){}_transferChildComponentStates(e){e!=null&&e.forEachChild(t=>{this._setInstanceChangeHistory(t),this._transferChildComponentStates(t)})}_hasStateToTranfer(e,t){return t.length>0&&e.symbolID()!=ce.List_last(t).newStateId()}_setInstanceChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let t=wn.getSemanticNodePath(new nn(e)),n=this.getComponentHistory(t,i.getStateGroupID(e)),r=this._prototypeState.getStateMachineOrNull(e.stablePath());r!=null&&this._hasStateToTranfer(e,n)&&!this._stateAlreadyManagedByVariables(e)&&(r.setChangeHistory(n),this._swapStateCallback(e.stablePath(),ce.List_last(n).newStateId(),0),Be.trackDefinedEvent("prototype.viewer_interaction_state_transferred",new Map))}}_resetChildComponentStates(e,t){e!=null&&e.forEachChild(n=>{this._clearInstanceChangeHistory(n,t),this._resetChildComponentStates(n,t)})}_nodeIsInstance(e){return e!=null&&e.type()=="INSTANCE"}_nodeHasStoredState(e,t){let n=L._prototypeLib;return!t&&n!=null&&this._nodeIsInstance(e)?n.nodeHasLocalSymbolChanges(e.id()):!1}_clearInstanceChangeHistory(e,t){var n,r;if(e!=null&&(this._isInteractiveComponent(e)||this._nodeHasStoredState(e,t))&&!this._stateAlreadyManagedByVariables(e)){Be.trackDefinedEvent("prototype.viewer_interaction_state_reset",new Map),t?(n=L._prototypeLib)==null||n.resetLocalNestedInstanceChanges([e.id()]):(r=L._prototypeLib)==null||r.resetLocalInstanceChanges([e.id()]);let o=wn.getSemanticNodePath(new nn(e));this._semanticChangeHistoryStorage.remove(o,i.getStateGroupID(e))}}_hasStateToStore(e,t,n){if(t==null||t.length==0)return!1;if(n==null||n.length==0)return!0;let r=ce.List_last(n);return e.symbolID()!=r.newStateId()}_storeChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let t=this._prototypeState.getStateMachineOrNull(e.stablePath());if(t!=null){let n=wn.getSemanticNodePath(new nn(e)),r=i.getStateGroupID(e),o=this.getComponentHistory(n,r),a=t.changeHistory();this._hasStateToStore(e,a,o)&&!this._stateAlreadyManagedByVariables(e)&&this.setComponentHistory(n,r,a)}}}_storeChangeHistoryForChildren(e){e!=null&&e.forEachChild(t=>{this._storeChangeHistory(t),this._storeChangeHistoryForChildren(t)})}_semanticPathToString(e){let t=wn.getSemanticNodePath(new nn(e)),n=":/:",r=i.getStateGroupID(e);return t.length==1?t[0].toStringWithPrefix(!0):ce.List_reduce(t,(o,a,s)=>s==0?o:o+a.toString()+n,"")+n+r}_recordInteraction(e,t){if(t.transitionParameters.navigationType=="SWAP_STATE"&&!Kt.TransitionAction_isTransientAction(t.cause)){let n=this._appState.scene().findNode3(e);if(n==null)return;let r=this._semanticPathToString(n);this._semanticPathInteracted.add(r)}}_semanticPathHasBeenInteractedWith(e){return this._semanticPathInteracted.has(this._semanticPathToString(e))}_nodeHasBeenInteractedWith(e){return i.getStateGroupID(e)!=ne.invalid()?this._semanticPathHasBeenInteractedWith(e):!1}_isInteractiveComponent(e){return this._nodeIsInstance(e)?i.getStateGroupID(e)!=ne.invalid():!1}_stateAlreadyManagedByVariables(e){return e!=null&&e.getBoundVariables().componentProperties}handleStateChangeAborted(e){}handleStateChangeInitiated(e){if(e.stateManagementVersion()==1){let t=e.oldStateAndOverlays.topId(),n=e.newStateAndOverlays.topId(),r=this._appState.scene().findNode1(t),o=this._appState.scene().findNode1(n);this._storeChangeHistory(r),this._storeChangeHistoryForChildren(r),e.resetInteractiveComponents()==0?(this._clearInstanceChangeHistory(o,!1),this._resetChildComponentStates(o,!1)):(this._setInstanceChangeHistory(o),this._transferChildComponentStates(o))}}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._semanticChangeHistoryStorage.uninitialize1(),this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set}handleHsmAborted(e,t){}handleHsmCommitted(e,t,n){t.stateManagementVersion()==1&&this._recordInteraction(e,t)}handleHsmRequested(e,t){if(t.stateManagementVersion()==1){let n=this._appState.scene().findNode3(e);this._storeChangeHistoryForChildren(n)}}handleHsmInitiated(e,t){if(t.stateManagementVersion()==1){let n=this._appState.scene().findNode3(e);t.resetInteractiveComponents()!=0?this._transferChildComponentStates(n):this._resetChildComponentStates(n,!0)}}debugString(){return this._semanticChangeHistoryStorage.toString2(e=>{var r;let t="",n=Math.max(e.length-4,0);n!=0&&(t="..., ");for(let o=n,a=e.length;o<a;o=o+1){let s=e[o];t+=`${(r=s==null?void 0:s.oldStateId())!=null?r:"null"}->${s==null?void 0:s.newStateId()}`,o!=e.length-1&&(t+=", ")}return t})}};var Hr;(t=>{function i(n){return n!=-1}t.WeakHandle_isValid=i;function e(n){return n}t.WeakHandle_toInt=e})(Hr||(Hr={}));var bg;(t=>{function i(){return ne._new(-1,t._nextLocalID=t._nextLocalID+1)}t.generateId=i,t._nextLocalID=0})(bg||(bg={}));var tp;(t=>{function i(n){return ne._new(n,t._nextLocalID=t._nextLocalID+1)}t.make=i,t._nextLocalID=0})(tp||(tp={}));var Es=class i{constructor(){this.assertEquals=AssertLib.strictEqual,this.trackingCalls=[],this._uninstall=null,this._uninstall=Be.mockTrackEvent((e,t,n)=>{this.trackingCalls.push(new i.TrackingPayload(e,t,n))})}uninstall(){this._uninstall()}expectTrackToHaveBeenCalledWith1(e,t){this.expectTrackToHaveBeenCalledWith2(e,t,{})}expectTrackToHaveBeenCalledWith2(e,t,n){this.trackingCalls.some(r=>r.equalsWithSubsetOfArgs(new i.TrackingPayload(e,t,n)))}};(e=>{class i{equalsWithSubsetOfArgs(n){if(this.name!=n.name)return!1;for(let r of Object.keys(n.args))if(n.args[r]!==this.args[r])return!1;for(let r of Object.keys(n.options))if(n.options[r]!==this.options[r])return!1;return!0}constructor(n,r,o){this.name=n,this.args=r,this.options=o}}e.TrackingPayload=i})(Es||(Es={}));function or(i){if(!L.isTestingEnv())throw new Error(i)}function A1(i){Tl=Tl+1;let e=ne._new(1,Tl);for(let t=0,n=i.totalNodeCount();t<n&&i.findNode1(e)!=null;t=t+1)Tl=Tl+1,e=ne._new(1,Tl);return e}function Dr(i,e){let t=i.scene().createNode1(A1(i.scene()));return t.setVisible(!0),t.setOpacity(1),t.setType(e),e!="CANVAS"&&e!="DOCUMENT"&&(t.setRelativeTransform(oe.new2()),t.setSize(new E(100,100))),i.appendChild(t),t}function dt(i,e){return Gn(i,e,C.BLACK)}function So(i,e,t){let n=Dr(i,"FRAME");return n.setName(e),n.setBackgroundOpacity(1),n.setIsBackgroundEnabled(!0),n.setIsFrameMaskDisabled(!1),n.setIsResizeToFit(!1),n.setContainerSupportsFillStrokeAndCorners(!0),n.setTestOnlyFillPaints2([t]),n}function Cs(i,e,t,n,r){let o=Dr(i,"FRAME");return o.setName(e),o.setBackgroundOpacity(1),o.setIsBackgroundEnabled(!0),o.setIsFrameMaskDisabled(!1),o.setIsResizeToFit(!1),o.setContainerSupportsFillStrokeAndCorners(!0),o.setTestOnlyFillPaints(t),o.setTestOnlyStrokeGeometry(new Dn([new Yn("NONZERO",0,Rt.forCenterStrokeAroundRect(r,10),r)],null,r,null)),o.setTestOnlyStrokePaints(n),o}function Gn(i,e,t){let n=new se("SOLID");return n.setColor(t),n.setOpacity(1),n.setIsEnabled(!0),So(i,e,n)}function Ib(i,e){let t=se.createLinearGradient([new at(C.new3(1,.5,0,1),.25),new at(C.new3(0,.5,1,1),.75)]);return So(i,e,t)}function mi(i){let e=Dr(i,"FRAME");return e.setName("Group"),e.setBackgroundOpacity(1),Ma(e,!1),e.setIsResizeToFit(!0),e}function Il(i){let e=Dr(i,"BOOLEAN_OPERATION");return e.setName("Boolean Operation"),e.setBackgroundOpacity(1),e.setIsBackgroundEnabled(!1),e.setIsResizeToFit(!0),e}function da(i,e){let t=mi(i);return t.setName(e),t}function ut(i){return dt(i,"Frame")}function vb(i){return Dr(i,"VECTOR")}function Mr(i){return Dr(i,"RECTANGLE")}function rt(i,e){let t=Mr(i);return t.setName(e),t}function Eb(i,e){let t=Dr(i,"ROUNDED_RECTANGLE");return t.setCornerRadius(e),t}function np(i){return Dr(i,"TEXT")}function S1(i,e){let t=np(i);return t.setName(e),t}function gi(i){return Dr(i,"SYMBOL")}function Da(i,e){let t=Dr(i,"INSTANCE");return t.setTestOnlySymbolData(new pi(e.id(),No.new1([],[]))),t}function ii(i){let e=new U(0,0,i.width(),i.height()),t=new Yn("NONZERO",0,Pt.fromRect(e),e);return new Dn([t],null,t.bounds(),new ho(new Xn))}function Cb(i,e){let t=new Yn("NONZERO",0,Rt.fromRoundedRect1(new os(2,U.new3(i),e,null,0)),i);return new Dn([t],null,t.bounds(),new ho(new Xn))}function wb(i){let e=Rt.new2();e.moveTo1(i.topLeft().x(),i.topLeft().y()).lineTo(i.topRight().x(),i.topRight().y()).lineTo(i.bottomLeft().x(),i.bottomLeft().y()).close();let t=new Yn("NONZERO",0,e,i);return new Dn([t],null,t.bounds(),new ho(new Xn))}function Nb(i){let e=[];Tt.INSTANCE.reset();for(let t of i)e.push(new Yn("NONZERO",0,Rt.fromRect(t),t)),Tt.INSTANCE.include3(t);return new Dn(e,null,Tt.INSTANCE.build(),new ho(new Xn))}function vl(i,e){Tg(i,e.id())}function Tg(i,e){let t=i.prototypeInteractions().length==0?jt.createDefault():i.prototypeInteractions()[0],n=t.action()!=null?t.action().value:tr.createDefault();i.setTestOnlyPrototypeInteractions([t.withActions([n.withTransitionNodeID(e).withConnectionType("INTERNAL_NODE")])].slice())}function Hn(i,e,t,n,r){return rp(i,e,t,n,r,!1)}function rp(i,e,t,n,r,o){switch(r){case"NAVIGATE":{vl(i,e);break}case"OVERLAY":{ed(i,e);break}case"SWAP":{vg(i,e);break}case"SWAP_STATE":{y1(i,e);break}}let a=i.prototypeInteractions()[0];return i.setTestOnlyPrototypeInteractions([a.withEvent(a.event().withInteractionType(t)).withActions([a.action().value.withTransitionType(n).withTransitionShouldSmartAnimate(o)]).withStateManagementVersion(X.getFeatureFlags().prototypeStateManagement?1:0)].slice()),i.prototypeInteractions()[0]}function op(i){let e=i.prototypeInteractions().length==0?jt.createDefault():i.prototypeInteractions()[0],t=e.action()!=null?e.action().value:tr.createDefault();i.setTestOnlyPrototypeInteractions([e.withActions([t.withConnectionType("BACK")])].slice())}function ed(i,e){Ig(i,e,E.new2())}function Ig(i,e,t){let n=i.prototypeInteractions().length==0?jt.createDefault():i.prototypeInteractions()[0],r=n.action()!=null?n.action().value:tr.createDefault();i.setTestOnlyPrototypeInteractions([n.withActions([r.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withOverlayRelativePosition(t).withNavigationType("OVERLAY")])].slice())}function vg(i,e){let t=i.prototypeInteractions().length==0?jt.createDefault():i.prototypeInteractions()[0],n=t.action()!=null?t.action().value:tr.createDefault();i.setTestOnlyPrototypeInteractions([t.withActions([n.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP")])].slice())}function y1(i,e){let t=i.prototypeInteractions().length==0?jt.createDefault():i.prototypeInteractions()[0],n=t.action()!=null?t.action().value:tr.createDefault();i.setTestOnlyPrototypeInteractions([t.withActions([n.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP_STATE")])].slice())}function Eg(i){let e=i.prototypeInteractions().length==0?jt.createDefault():i.prototypeInteractions()[0],t=e.action()!=null?e.action().value:tr.createDefault();i.setTestOnlyPrototypeInteractions([e.withActions([t.withConnectionType("CLOSE")])].slice())}function ip(i,e){let t=i.prototypeInteractions().length==0?jt.createDefault():i.prototypeInteractions()[0];i.setTestOnlyPrototypeInteractions([t.withEvent(t.event().withInteractionType(e))].slice())}function je(i,e,t){let n=oe.new2();n.translate1(e),i.setRelativeTransform(n),i.setSize(t)}function he(i,e){let t=rt(i,e);return t.setTestOnlyFillPaints([se.createSolid(C.RED,1)]),t.setTestOnlyFillGeometry(ii(U.new4(new E(0,0),t.size()))),t}function zt(i,e,t,n){let r=rt(i,e);return r.setTestOnlyFillPaints([se.createSolid(t,n)]),r.setTestOnlyFillGeometry(ii(U.new4(new E(0,0),r.size()))),r}function ap(i,e,t){let n=rt(i,e);return n.setTestOnlyFillPaints3(t),n.setTestOnlyFillGeometry(ii(U.new4(new E(0,0),n.size()))),n}function td(i,e,t){let n=rt(i,e);return n.setSize(t),n.setTestOnlyFillPaints(Oe.fromPaint(new se("IMAGE"))),n.setTestOnlyFillGeometry(ii(U.new4(new E(0,0),n.size()))),n}function Cg(i,e,t){let n=Dr(i,"VECTOR");return n.setName(e),n.setSize(t),n.setTestOnlyFillPaints(Oe.fromPaint(new se("IMAGE"))),n.setTestOnlyFillGeometry(wb(U.new4(new E(0,0),n.size()))),n}function Lr(i,e,t,n,r){let o=rt(i,e);return o.setSize(r),o.setTestOnlyFillPaints([se.createSolid(t,n)]),o.setTestOnlyFillGeometry(ii(U.new4(new E(0,0),o.size()))),o}function wg(i,e,t,n,r){let o=Dr(i,"VECTOR");return o.setName(e),o.setSize(r),o.setTestOnlyFillPaints([se.createSolid(t,n)]),o.setTestOnlyFillGeometry(wb(U.new4(new E(0,0),o.size()))),o}function Rb(i,e){let t=S1(i,e);return t.setTestOnlyFillPaints([se.createSolid(C.RED,1)]),t.setTestOnlyTextData(Jo.forTests1()),t}function Ng(i){sp(i,[])}function sp(i,e){if(or("Should only be used in tests"),L._prototypeLib==null)throw new Error("Expected PrototypeLib to be initialized");let t=[i],n=[];for(let a=0,s=e.length;a<s;a=a+1){let l={};l.bytes=e[a],n.push(l)}let r={type:"NODE_CHANGES",sessionID:0,ackID:0,blobs:n,nodeChanges:t},o=be.schema.encodeMessage(r);L._prototypeLib.applyLocalNodeChangesForTests(o)}function Ma(i,e){if(or("Writing to paints is only supported in tests because it's not fully implemented"),un.isFrameLike(i.type())){let t=[],n=i.fillPaints();if(n!=null)for(let r=0,o=n.length;r<o;r=r+1){let a=n[r].clone();a.setIsEnabled(e),t.push(a)}i.setTestOnlyFillPaints(t)}else i.setIsBackgroundEnabled(!1)}var Tl=0;var lp=class{textAlignHorizontal(){L._prototypeLib.prepareCppNodeForAccess(this);let e=L._prototypeLib.nodeTsApiGenerated().getTextAlignHorizontal(2);return be.schema.TextAlignHorizontal[e]}setTextAlignHorizontal(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=be.schema.TextAlignHorizontal[e];L._prototypeLib.nodeTsApiGenerated().setTextAlignHorizontal(t,2)}textAlignVertical(){L._prototypeLib.prepareCppNodeForAccess(this);let e=L._prototypeLib.nodeTsApiGenerated().getTextAlignVertical(2);return be.schema.TextAlignVertical[e]}setTextAlignVertical(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=be.schema.TextAlignVertical[e];L._prototypeLib.nodeTsApiGenerated().setTextAlignVertical(t,2)}fontSize(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getFontSize(2)}setFontSize(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setFontSize(t,2)}visible(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getVisible(2)}setVisible(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setVisible(t,2)}isBackgroundEnabled(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getBackgroundEnabled(2)}setIsBackgroundEnabled(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setBackgroundEnabled(t,2)}isMask(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getIsMask(2)}setIsMask(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setIsMask(t,2)}isMaskOutline_DEPRECATED(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getIsMaskOutline_DEPRECATED(2)}setIsMaskOutline_DEPRECATED(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setIsMaskOutline_DEPRECATED(t,2)}isInternalOnly(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getIsInternalOnly(2)}setIsInternalOnly(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setIsInternalOnly(t,2)}isFrameMaskDisabled(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getIsFrameClippingDisabled(2)}setIsFrameMaskDisabled(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setIsFrameClippingDisabled(t,2)}isResizeToFit(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getResizeToFit(2)}setIsResizeToFit(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setResizeToFit(t,2)}rectangleCornerRadiiIndependent(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getRectangleCornerRadiiIndependent(2)}setRectangleCornerRadiiIndependent(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setRectangleCornerRadiiIndependent(t,2)}horizontalConstraint(){L._prototypeLib.prepareCppNodeForAccess(this);let e=L._prototypeLib.nodeTsApiGenerated().getHorizontalConstraint(2);return be.schema.ConstraintType[e]}setHorizontalConstraint(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=be.schema.ConstraintType[e];L._prototypeLib.nodeTsApiGenerated().setHorizontalConstraint(t,2)}verticalConstraint(){L._prototypeLib.prepareCppNodeForAccess(this);let e=L._prototypeLib.nodeTsApiGenerated().getVerticalConstraint(2);return be.schema.ConstraintType[e]}setVerticalConstraint(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=be.schema.ConstraintType[e];L._prototypeLib.nodeTsApiGenerated().setVerticalConstraint(t,2)}blendMode(){L._prototypeLib.prepareCppNodeForAccess(this);let e=L._prototypeLib.nodeTsApiGenerated().getBlendMode(2);return be.schema.BlendMode[e]}setBlendMode(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=be.schema.BlendMode[e];L._prototypeLib.nodeTsApiGenerated().setBlendMode(t,2)}strokeAlign(){L._prototypeLib.prepareCppNodeForAccess(this);let e=L._prototypeLib.nodeTsApiGenerated().getStrokeAlign(2);return be.schema.StrokeAlign[e]}setStrokeAlign(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=be.schema.StrokeAlign[e];L._prototypeLib.nodeTsApiGenerated().setStrokeAlign(t,2)}overlayPositionType(){L._prototypeLib.prepareCppNodeForAccess(this);let e=L._prototypeLib.nodeTsApiGenerated().getOverlayPositionType(2);return be.schema.OverlayPositionType[e]}setOverlayPositionType(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=be.schema.OverlayPositionType[e];L._prototypeLib.nodeTsApiGenerated().setOverlayPositionType(t,2)}overlayBackgroundInteraction(){L._prototypeLib.prepareCppNodeForAccess(this);let e=L._prototypeLib.nodeTsApiGenerated().getOverlayBackgroundInteraction(2);return be.schema.OverlayBackgroundInteraction[e]}setOverlayBackgroundInteraction(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=be.schema.OverlayBackgroundInteraction[e];L._prototypeLib.nodeTsApiGenerated().setOverlayBackgroundInteraction(t,2)}styleType(){L._prototypeLib.prepareCppNodeForAccess(this);let e=L._prototypeLib.nodeTsApiGenerated().getStyleType(2);return be.schema.StyleType[e]}setStyleType(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=be.schema.StyleType[e];L._prototypeLib.nodeTsApiGenerated().setStyleType(t,2)}overflowDirection(){L._prototypeLib.prepareCppNodeForAccess(this);let e=L._prototypeLib.nodeTsApiGenerated().getOverflowDirection(2);return be.schema.ScrollDirection[e]}setOverflowDirection(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=be.schema.ScrollDirection[e];L._prototypeLib.nodeTsApiGenerated().setOverflowDirection(t,2)}scrollBehavior(){L._prototypeLib.prepareCppNodeForAccess(this);let e=L._prototypeLib.nodeTsApiGenerated().getScrollBehavior(2);return be.schema.ScrollBehavior[e]}setScrollBehavior(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=be.schema.ScrollBehavior[e];L._prototypeLib.nodeTsApiGenerated().setScrollBehavior(t,2)}maskType(){L._prototypeLib.prepareCppNodeForAccess(this);let e=L._prototypeLib.nodeTsApiGenerated().getMaskType(2);return be.schema.MaskType[e]}setMaskType(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=be.schema.MaskType[e];L._prototypeLib.nodeTsApiGenerated().setMaskType(t,2)}opacity(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getOpacity(2)}setOpacity(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setOpacity(t,2)}backgroundOpacity(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getBackgroundOpacity(2)}setBackgroundOpacity(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setBackgroundOpacity(t,2)}rectangleTopLeftCornerRadius(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getRectangleTopLeftCornerRadius(2)}setRectangleTopLeftCornerRadius(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setRectangleTopLeftCornerRadius(t,2)}rectangleTopRightCornerRadius(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getRectangleTopRightCornerRadius(2)}setRectangleTopRightCornerRadius(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setRectangleTopRightCornerRadius(t,2)}rectangleBottomLeftCornerRadius(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getRectangleBottomLeftCornerRadius(2)}setRectangleBottomLeftCornerRadius(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setRectangleBottomLeftCornerRadius(t,2)}rectangleBottomRightCornerRadius(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getRectangleBottomRightCornerRadius(2)}setRectangleBottomRightCornerRadius(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setRectangleBottomRightCornerRadius(t,2)}strokeWeight(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getStrokeWeight(2)}setStrokeWeight(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setStrokeWeight(t,2)}cornerRadius(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getCornerRadius(2)}setCornerRadius(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setCornerRadius(t,2)}cornerSmoothing(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getCornerSmoothing(2)}setCornerSmoothing(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setCornerSmoothing(t,2)}overrideKey(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getOverrideKey(2)}setOverrideKey(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setOverrideKey(t,2)}overriddenSymbolID(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getOverriddenSymbolID(2)}stackReverseZIndex(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getStackReverseZIndex(2)}setStackReverseZIndex(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setStackReverseZIndex(t,2)}containerSupportsFillStrokeAndCorners(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getContainerSupportsFillStrokeAndCorners(2)}setContainerSupportsFillStrokeAndCorners(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setContainerSupportsFillStrokeAndCorners(t,2)}isStateGroup(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getIsStateGroup(2)}setIsStateGroup(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setIsStateGroup(t,2)}shapeWithTextType(){L._prototypeLib.prepareCppNodeForAccess(this);let e=L._prototypeLib.nodeTsApiGenerated().getShapeWithTextType(2);return be.schema.ShapeWithTextType[e]}setShapeWithTextType(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=be.schema.ShapeWithTextType[e];L._prototypeLib.nodeTsApiGenerated().setShapeWithTextType(t,2)}usedAsBaseScreen(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getUsedAsBaseScreen(2)}setUsedAsBaseScreen(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setUsedAsBaseScreen(t,2)}hasBeenLoaded(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApiGenerated().getHasBeenLoaded(2)}setHasBeenLoaded(e){L._prototypeLib.prepareCppNodeForAccess(this);let t=e;L._prototypeLib.nodeTsApiGenerated().setHasBeenLoaded(t,2)}};function gp(i){return fp(i.map(([e,t])=>new Array(e).fill(t,0,e)))}function fp(i){return i.reduce((e,t)=>e.concat(Array.isArray(t)?fp(t):t),[])}var Fb=[0,1,2,3].concat(...gp([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function Nn(){let i=this;function e(r){let o=i.dyn_tree,a=i.stat_desc.static_tree,s=i.stat_desc.extra_bits,l=i.stat_desc.extra_base,d=i.stat_desc.max_length,c,p,u,h,f,_,m=0;for(h=0;h<=15;h++)r.bl_count[h]=0;for(o[r.heap[r.heap_max]*2+1]=0,c=r.heap_max+1;c<573;c++)p=r.heap[c],h=o[o[p*2+1]*2+1]+1,h>d&&(h=d,m++),o[p*2+1]=h,!(p>i.max_code)&&(r.bl_count[h]++,f=0,p>=l&&(f=s[p-l]),_=o[p*2],r.opt_len+=_*(h+f),a&&(r.static_len+=_*(a[p*2+1]+f)));if(m!==0){do{for(h=d-1;r.bl_count[h]===0;)h--;r.bl_count[h]--,r.bl_count[h+1]+=2,r.bl_count[d]--,m-=2}while(m>0);for(h=d;h!==0;h--)for(p=r.bl_count[h];p!==0;)u=r.heap[--c],!(u>i.max_code)&&(o[u*2+1]!=h&&(r.opt_len+=(h-o[u*2+1])*o[u*2],o[u*2+1]=h),p--)}}function t(r,o){let a=0;do a|=r&1,r>>>=1,a<<=1;while(--o>0);return a>>>1}function n(r,o,a){let s=[],l=0,d,c,p;for(d=1;d<=15;d++)s[d]=l=l+a[d-1]<<1;for(c=0;c<=o;c++)p=r[c*2+1],p!==0&&(r[c*2]=t(s[p]++,p))}i.build_tree=function(r){let o=i.dyn_tree,a=i.stat_desc.static_tree,s=i.stat_desc.elems,l,d,c=-1,p;for(r.heap_len=0,r.heap_max=573,l=0;l<s;l++)o[l*2]!==0?(r.heap[++r.heap_len]=c=l,r.depth[l]=0):o[l*2+1]=0;for(;r.heap_len<2;)p=r.heap[++r.heap_len]=c<2?++c:0,o[p*2]=1,r.depth[p]=0,r.opt_len--,a&&(r.static_len-=a[p*2+1]);for(i.max_code=c,l=Math.floor(r.heap_len/2);l>=1;l--)r.pqdownheap(o,l);p=s;do l=r.heap[1],r.heap[1]=r.heap[r.heap_len--],r.pqdownheap(o,1),d=r.heap[1],r.heap[--r.heap_max]=l,r.heap[--r.heap_max]=d,o[p*2]=o[l*2]+o[d*2],r.depth[p]=Math.max(r.depth[l],r.depth[d])+1,o[l*2+1]=o[d*2+1]=p,r.heap[1]=p++,r.pqdownheap(o,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],e(r),n(o,i.max_code,r.bl_count)}}Nn._length_code=[0,1,2,3,4,5,6,7].concat(...gp([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]]));Nn.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0];Nn.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576];Nn.d_code=function(i){return i<256?Fb[i]:Fb[256+(i>>>7)]};Nn.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];Nn.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];Nn.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];Nn.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function Br(i,e,t,n,r){let o=this;o.static_tree=i,o.extra_bits=e,o.extra_base=t,o.elems=n,o.max_length=r}var b1=[12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227],T1=gp([[144,8],[112,9],[24,7],[8,8]]);Br.static_ltree=fp(b1.map((i,e)=>[i,T1[e]]));var I1=[0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23],v1=gp([[30,5]]);Br.static_dtree=fp(I1.map((i,e)=>[i,v1[e]]));Br.static_l_desc=new Br(Br.static_ltree,Nn.extra_lbits,256+1,286,15);Br.static_d_desc=new Br(Br.static_dtree,Nn.extra_dbits,0,30,15);Br.static_bl_desc=new Br(null,Nn.extra_blbits,0,19,7);var E1=9,C1=8;function ki(i,e,t,n,r){let o=this;o.good_length=i,o.max_lazy=e,o.nice_length=t,o.max_chain=n,o.func=r}var Pb=0,hp=1,ws=2,fi=[new ki(0,0,0,0,Pb),new ki(4,4,8,4,hp),new ki(4,5,16,8,hp),new ki(4,6,32,32,hp),new ki(4,4,16,16,ws),new ki(8,16,32,32,ws),new ki(8,16,128,128,ws),new ki(8,32,128,256,ws),new ki(32,128,258,1024,ws),new ki(32,258,258,4096,ws)],cp=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],ai=0,dp=1,nd=2,up=3,w1=32,Rg=42,pp=113,rd=666,Og=8,N1=0,Fg=1,R1=2,Bn=3,mp=258,Po=mp+Bn+1;function xb(i,e,t,n){let r=i[e*2],o=i[t*2];return r<o||r==o&&n[e]<=n[t]}function O1(){let i=this,e,t,n,r,o,a,s,l,d,c,p,u,h,f,_,m,A,y,S,g,b,T,I,O,w,P,H,re,q,W,x,F,k,G=new Nn,M=new Nn,Q=new Nn;i.depth=[];let Y,B,te,j,ie,de;i.bl_count=[],i.heap=[],x=[],F=[],k=[];function tt(){d=2*o,p[h-1]=0;for(let v=0;v<h-1;v++)p[v]=0;P=fi[H].max_lazy,q=fi[H].good_length,W=fi[H].nice_length,w=fi[H].max_chain,b=0,A=0,I=0,y=O=Bn-1,g=0,u=0}function bt(){let v;for(v=0;v<286;v++)x[v*2]=0;for(v=0;v<30;v++)F[v*2]=0;for(v=0;v<19;v++)k[v*2]=0;x[256*2]=1,i.opt_len=i.static_len=0,B=te=0}function ht(){G.dyn_tree=x,G.stat_desc=Br.static_l_desc,M.dyn_tree=F,M.stat_desc=Br.static_d_desc,Q.dyn_tree=k,Q.stat_desc=Br.static_bl_desc,ie=0,de=0,j=8,bt()}i.pqdownheap=function(v,R){let z=i.heap,Z=z[R],ae=R<<1;for(;ae<=i.heap_len&&(ae<i.heap_len&&xb(v,z[ae+1],z[ae],i.depth)&&ae++,!xb(v,Z,z[ae],i.depth));)z[R]=z[ae],R=ae,ae<<=1;z[R]=Z};function Ft(v,R){let z=-1,Z,ae=v[0*2+1],pe=0,Te=7,De=4;ae===0&&(Te=138,De=3),v[(R+1)*2+1]=65535;for(let St=0;St<=R;St++)Z=ae,ae=v[(St+1)*2+1],!(++pe<Te&&Z==ae)&&(pe<De?k[Z*2]+=pe:Z!==0?(Z!=z&&k[Z*2]++,k[16*2]++):pe<=10?k[17*2]++:k[18*2]++,pe=0,z=Z,ae===0?(Te=138,De=3):Z==ae?(Te=6,De=3):(Te=7,De=4))}function Gt(){let v;for(Ft(x,G.max_code),Ft(F,M.max_code),Q.build_tree(i),v=19-1;v>=3&&k[Nn.bl_order[v]*2+1]===0;v--);return i.opt_len+=3*(v+1)+5+5+4,v}function Ut(v){i.pending_buf[i.pending++]=v}function vt(v){Ut(v&255),Ut(v>>>8&255)}function Vn(v){Ut(v>>8&255),Ut(v&255&255)}function Vt(v,R){let z,Z=R;de>16-Z?(z=v,ie|=z<<de&65535,vt(ie),ie=z>>>16-de,de+=Z-16):(ie|=v<<de&65535,de+=Z)}function sn(v,R){let z=v*2;Vt(R[z]&65535,R[z+1]&65535)}function xt(v,R){let z,Z=-1,ae,pe=v[0*2+1],Te=0,De=7,St=4;for(pe===0&&(De=138,St=3),z=0;z<=R;z++)if(ae=pe,pe=v[(z+1)*2+1],!(++Te<De&&ae==pe)){if(Te<St)do sn(ae,k);while(--Te!==0);else ae!==0?(ae!=Z&&(sn(ae,k),Te--),sn(16,k),Vt(Te-3,2)):Te<=10?(sn(17,k),Vt(Te-3,3)):(sn(18,k),Vt(Te-11,7));Te=0,Z=ae,pe===0?(De=138,St=3):ae==pe?(De=6,St=3):(De=7,St=4)}}function mt(v,R,z){let Z;for(Vt(v-257,5),Vt(R-1,5),Vt(z-4,4),Z=0;Z<z;Z++)Vt(k[Nn.bl_order[Z]*2+1],3);xt(x,v-1),xt(F,R-1)}function _t(){de==16?(vt(ie),ie=0,de=0):de>=8&&(Ut(ie&255),ie>>>=8,de-=8)}function Ze(){Vt(Fg<<1,3),sn(256,Br.static_ltree),_t(),1+j+10-de<9&&(Vt(Fg<<1,3),sn(256,Br.static_ltree),_t()),j=7}function Ct(v,R){let z,Z,ae;if(i.dist_buf[B]=v,i.lc_buf[B]=R&255,B++,v===0?x[R*2]++:(te++,v--,x[(Nn._length_code[R]+256+1)*2]++,F[Nn.d_code(v)*2]++),!(B&8191)&&H>2){for(z=B*8,Z=b-A,ae=0;ae<30;ae++)z+=F[ae*2]*(5+Nn.extra_dbits[ae]);if(z>>>=3,te<Math.floor(B/2)&&z<Math.floor(Z/2))return!0}return B==Y-1}function Ht(v,R){let z,Z,ae=0,pe,Te;if(B!==0)do z=i.dist_buf[ae],Z=i.lc_buf[ae],ae++,z===0?sn(Z,v):(pe=Nn._length_code[Z],sn(pe+256+1,v),Te=Nn.extra_lbits[pe],Te!==0&&(Z-=Nn.base_length[pe],Vt(Z,Te)),z--,pe=Nn.d_code(z),sn(pe,R),Te=Nn.extra_dbits[pe],Te!==0&&(z-=Nn.base_dist[pe],Vt(z,Te)));while(ae<B);sn(256,v),j=v[256*2+1]}function xe(){de>8?vt(ie):de>0&&Ut(ie&255),ie=0,de=0}function Dt(v,R,z){xe(),j=8,z&&(vt(R),vt(~R)),i.pending_buf.set(l.subarray(v,v+R),i.pending),i.pending+=R}function An(v,R,z){Vt((N1<<1)+(z?1:0),3),Dt(v,R,!0)}function hn(v,R,z){let Z,ae,pe=0;H>0?(G.build_tree(i),M.build_tree(i),pe=Gt(),Z=i.opt_len+3+7>>>3,ae=i.static_len+3+7>>>3,ae<=Z&&(Z=ae)):Z=ae=R+5,R+4<=Z&&v!=-1?An(v,R,z):ae==Z?(Vt((Fg<<1)+(z?1:0),3),Ht(Br.static_ltree,Br.static_dtree)):(Vt((R1<<1)+(z?1:0),3),mt(G.max_code+1,M.max_code+1,pe+1),Ht(x,F)),bt(),z&&xe()}function Xt(v){hn(A>=0?A:-1,b-A,v),A=b,e.flush_pending()}function Me(){let v,R,z,Z;do{if(Z=d-I-b,Z===0&&b===0&&I===0)Z=o;else if(Z==-1)Z--;else if(b>=o+o-Po){l.set(l.subarray(o,o+o),0),T-=o,b-=o,A-=o,v=h,z=v;do R=p[--z]&65535,p[z]=R>=o?R-o:0;while(--v!==0);v=o,z=v;do R=c[--z]&65535,c[z]=R>=o?R-o:0;while(--v!==0);Z+=o}if(e.avail_in===0)return;v=e.read_buf(l,b+I,Z),I+=v,I>=Bn&&(u=l[b]&255,u=(u<<m^l[b+1]&255)&_)}while(I<Po&&e.avail_in!==0)}function st(v){let R=65535,z;for(R>n-5&&(R=n-5);;){if(I<=1){if(Me(),I===0&&v==0)return ai;if(I===0)break}if(b+=I,I=0,z=A+R,(b===0||b>=z)&&(I=b-z,b=z,Xt(!1),e.avail_out===0)||b-A>=o-Po&&(Xt(!1),e.avail_out===0))return ai}return Xt(v==4),e.avail_out===0?v==4?nd:ai:v==4?up:dp}function kt(v){let R=w,z=b,Z,ae,pe=O,Te=b>o-Po?b-(o-Po):0,De=W,St=s,ot=b+mp,Ge=l[z+pe-1],D=l[z+pe];O>=q&&(R>>=2),De>I&&(De=I);do if(Z=v,!(l[Z+pe]!=D||l[Z+pe-1]!=Ge||l[Z]!=l[z]||l[++Z]!=l[z+1])){z+=2,Z++;do;while(l[++z]==l[++Z]&&l[++z]==l[++Z]&&l[++z]==l[++Z]&&l[++z]==l[++Z]&&l[++z]==l[++Z]&&l[++z]==l[++Z]&&l[++z]==l[++Z]&&l[++z]==l[++Z]&&z<ot);if(ae=mp-(ot-z),z=ot-mp,ae>pe){if(T=v,pe=ae,ae>=De)break;Ge=l[z+pe-1],D=l[z+pe]}}while((v=c[v&St]&65535)>Te&&--R!==0);return pe<=I?pe:I}function Ne(v){let R=0,z;for(;;){if(I<Po){if(Me(),I<Po&&v==0)return ai;if(I===0)break}if(I>=Bn&&(u=(u<<m^l[b+(Bn-1)]&255)&_,R=p[u]&65535,c[b&s]=p[u],p[u]=b),R!==0&&(b-R&65535)<=o-Po&&re!=2&&(y=kt(R)),y>=Bn)if(z=Ct(b-T,y-Bn),I-=y,y<=P&&I>=Bn){y--;do b++,u=(u<<m^l[b+(Bn-1)]&255)&_,R=p[u]&65535,c[b&s]=p[u],p[u]=b;while(--y!==0);b++}else b+=y,y=0,u=l[b]&255,u=(u<<m^l[b+1]&255)&_;else z=Ct(0,l[b]&255),I--,b++;if(z&&(Xt(!1),e.avail_out===0))return ai}return Xt(v==4),e.avail_out===0?v==4?nd:ai:v==4?up:dp}function We(v){let R=0,z,Z;for(;;){if(I<Po){if(Me(),I<Po&&v==0)return ai;if(I===0)break}if(I>=Bn&&(u=(u<<m^l[b+(Bn-1)]&255)&_,R=p[u]&65535,c[b&s]=p[u],p[u]=b),O=y,S=T,y=Bn-1,R!==0&&O<P&&(b-R&65535)<=o-Po&&(re!=2&&(y=kt(R)),y<=5&&(re==1||y==Bn&&b-T>4096)&&(y=Bn-1)),O>=Bn&&y<=O){Z=b+I-Bn,z=Ct(b-1-S,O-Bn),I-=O-1,O-=2;do++b<=Z&&(u=(u<<m^l[b+(Bn-1)]&255)&_,R=p[u]&65535,c[b&s]=p[u],p[u]=b);while(--O!==0);if(g=0,y=Bn-1,b++,z&&(Xt(!1),e.avail_out===0))return ai}else if(g!==0){if(z=Ct(0,l[b-1]&255),z&&Xt(!1),b++,I--,e.avail_out===0)return ai}else g=1,b++,I--}return g!==0&&(z=Ct(0,l[b-1]&255),g=0),Xt(v==4),e.avail_out===0?v==4?nd:ai:v==4?up:dp}function nt(v){return v.total_in=v.total_out=0,v.msg=null,i.pending=0,i.pending_out=0,t=pp,r=0,ht(),tt(),0}i.deflateInit=function(v,R,z,Z,ae,pe){return Z||(Z=Og),ae||(ae=C1),pe||(pe=0),v.msg=null,R==-1&&(R=6),ae<1||ae>E1||Z!=Og||z<9||z>15||R<0||R>9||pe<0||pe>2?-2:(v.dstate=i,a=z,o=1<<a,s=o-1,f=ae+7,h=1<<f,_=h-1,m=Math.floor((f+Bn-1)/Bn),l=new Uint8Array(o*2),c=[],p=[],Y=1<<ae+6,i.pending_buf=new Uint8Array(Y*4),n=Y*4,i.dist_buf=new Uint16Array(Y),i.lc_buf=new Uint8Array(Y),H=R,re=pe,nt(v))},i.deflateEnd=function(){return t!=Rg&&t!=pp&&t!=rd?-2:(i.lc_buf=null,i.dist_buf=null,i.pending_buf=null,p=null,c=null,l=null,i.dstate=null,t==pp?-3:0)},i.deflateParams=function(v,R,z){let Z=0;return R==-1&&(R=6),R<0||R>9||z<0||z>2?-2:(fi[H].func!=fi[R].func&&v.total_in!==0&&(Z=v.deflate(1)),H!=R&&(H=R,P=fi[H].max_lazy,q=fi[H].good_length,W=fi[H].nice_length,w=fi[H].max_chain),re=z,Z)},i.deflateSetDictionary=function(v,R,z){let Z=z,ae,pe=0;if(!R||t!=Rg)return-2;if(Z<Bn)return 0;for(Z>o-Po&&(Z=o-Po,pe=z-Z),l.set(R.subarray(pe,pe+Z),0),b=Z,A=Z,u=l[0]&255,u=(u<<m^l[1]&255)&_,ae=0;ae<=Z-Bn;ae++)u=(u<<m^l[ae+(Bn-1)]&255)&_,c[ae&s]=p[u],p[u]=ae;return 0},i.deflate=function(v,R){let z,Z,ae,pe,Te;if(R>4||R<0)return-2;if(!v.next_out||!v.next_in&&v.avail_in!==0||t==rd&&R!=4)return v.msg=cp[2- -2],-2;if(v.avail_out===0)return v.msg=cp[2- -5],-5;if(e=v,pe=r,r=R,t==Rg&&(Z=Og+(a-8<<4)<<8,ae=(H-1&255)>>1,ae>3&&(ae=3),Z|=ae<<6,b!==0&&(Z|=w1),Z+=31-Z%31,t=pp,Vn(Z)),i.pending!==0){if(e.flush_pending(),e.avail_out===0)return r=-1,0}else if(e.avail_in===0&&R<=pe&&R!=4)return e.msg=cp[2- -5],-5;if(t==rd&&e.avail_in!==0)return v.msg=cp[2- -5],-5;if(e.avail_in!==0||I!==0||R!=0&&t!=rd){switch(Te=-1,fi[H].func){case Pb:Te=st(R);break;case hp:Te=Ne(R);break;case ws:Te=We(R);break;default:}if((Te==nd||Te==up)&&(t=rd),Te==ai||Te==nd)return e.avail_out===0&&(r=-1),0;if(Te==dp){if(R==1)Ze();else if(An(0,0,!1),R==3)for(z=0;z<h;z++)p[z]=0;if(e.flush_pending(),e.avail_out===0)return r=-1,0}}return R!=4?0:1}}function Db(){let i=this;i.next_in_index=0,i.next_out_index=0,i.avail_in=0,i.total_in=0,i.avail_out=0,i.total_out=0}Db.prototype={deflateInit:function(i,e){let t=this;return t.dstate=new O1,e||(e=15),t.dstate.deflateInit(t,i,e)},deflate:function(i){let e=this;return e.dstate?e.dstate.deflate(e,i):-2},deflateEnd:function(){let i=this;if(!i.dstate)return-2;let e=i.dstate.deflateEnd();return i.dstate=null,e},deflateParams:function(i,e){let t=this;return t.dstate?t.dstate.deflateParams(t,i,e):-2},deflateSetDictionary:function(i,e){let t=this;return t.dstate?t.dstate.deflateSetDictionary(t,i,e):-2},read_buf:function(i,e,t){let n=this,r=n.avail_in;return r>t&&(r=t),r===0?0:(n.avail_in-=r,i.set(n.next_in.subarray(n.next_in_index,n.next_in_index+r),e),n.next_in_index+=r,n.total_in+=r,r)},flush_pending:function(){let i=this,e=i.dstate.pending;e>i.avail_out&&(e=i.avail_out),e!==0&&(i.next_out.set(i.dstate.pending_buf.subarray(i.dstate.pending_out,i.dstate.pending_out+e),i.next_out_index),i.next_out_index+=e,i.dstate.pending_out+=e,i.total_out+=e,i.avail_out-=e,i.dstate.pending-=e,i.dstate.pending===0&&(i.dstate.pending_out=0))}};function F1(i){let e=this,t=new Db,n=x1(i&&i.chunkSize?i.chunkSize:64*1024),r=0,o=new Uint8Array(n),a=i?i.level:-1;typeof a>"u"&&(a=-1),t.deflateInit(a),t.next_out=o,e.append=function(s,l){let d,c,p=0,u=0,h=0,f=[];if(s.length){t.next_in_index=0,t.next_in=s,t.avail_in=s.length;do{if(t.next_out_index=0,t.avail_out=n,d=t.deflate(r),d!=0)throw new Error("deflating: "+t.msg);t.next_out_index&&(t.next_out_index==n?f.push(new Uint8Array(o)):f.push(o.slice(0,t.next_out_index))),h+=t.next_out_index,l&&t.next_in_index>0&&t.next_in_index!=p&&(l(t.next_in_index),p=t.next_in_index)}while(t.avail_in>0||t.avail_out===0);return f.length>1?(c=new Uint8Array(h),f.forEach(function(_){c.set(_,u),u+=_.length})):c=f[0]||new Uint8Array(0),c}},e.flush=function(){let s,l,d=0,c=0,p=[];do{if(t.next_out_index=0,t.avail_out=n,s=t.deflate(4),s!=1&&s!=0)throw new Error("deflating: "+t.msg);n-t.avail_out>0&&p.push(o.slice(0,t.next_out_index)),c+=t.next_out_index}while(t.avail_in>0||t.avail_out===0);return t.deflateEnd(),l=new Uint8Array(c),p.forEach(function(u){l.set(u,d),d+=u.length}),l}}function x1(i){return i+5*(Math.floor(i/16383)+1)}var Mb=F1;var Do=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],tT=1440,P1=0,D1=4,M1=9,L1=5,B1=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],V1=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],k1=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],U1=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],G1=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],H1=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],La=15;function Mg(){let i=this,e,t,n,r,o,a;function s(d,c,p,u,h,f,_,m,A,y,S){let g,b,T,I,O,w,P,H,re,q,W,x,F,k,G;q=0,O=p;do n[d[c+q]]++,q++,O--;while(O!==0);if(n[0]==p)return _[0]=-1,m[0]=0,0;for(H=m[0],w=1;w<=La&&n[w]===0;w++);for(P=w,H<w&&(H=w),O=La;O!==0&&n[O]===0;O--);for(T=O,H>O&&(H=O),m[0]=H,k=1<<w;w<O;w++,k<<=1)if((k-=n[w])<0)return-3;if((k-=n[O])<0)return-3;for(n[O]+=k,a[1]=w=0,q=1,F=2;--O!==0;)a[F]=w+=n[q],F++,q++;O=0,q=0;do(w=d[c+q])!==0&&(S[a[w]++]=O),q++;while(++O<p);for(p=a[T],a[0]=O=0,q=0,I=-1,x=-H,o[0]=0,W=0,G=0;P<=T;P++)for(g=n[P];g--!==0;){for(;P>x+H;){if(I++,x+=H,G=T-x,G=G>H?H:G,(b=1<<(w=P-x))>g+1&&(b-=g+1,F=P,w<G))for(;++w<G&&!((b<<=1)<=n[++F]);)b-=n[F];if(G=1<<w,y[0]+G>tT)return-3;o[I]=W=y[0],y[0]+=G,I!==0?(a[I]=O,r[0]=w,r[1]=H,w=O>>>x-H,r[2]=W-o[I-1]-w,A.set(r,(o[I-1]+w)*3)):_[0]=W}for(r[1]=P-x,q>=p?r[0]=128+64:S[q]<u?(r[0]=S[q]<256?0:32+64,r[2]=S[q++]):(r[0]=f[S[q]-u]+16+64,r[2]=h[S[q++]-u]),b=1<<P-x,w=O>>>x;w<G;w+=b)A.set(r,(W+w)*3);for(w=1<<P-1;O&w;w>>>=1)O^=w;for(O^=w,re=(1<<x)-1;(O&re)!=a[I];)I--,x-=H,re=(1<<x)-1}return k!==0&&T!=1?-5:0}function l(d){let c;for(e||(e=[],t=[],n=new Int32Array(La+1),r=[],o=new Int32Array(La),a=new Int32Array(La+1)),t.length<d&&(t=[]),c=0;c<d;c++)t[c]=0;for(c=0;c<La+1;c++)n[c]=0;for(c=0;c<3;c++)r[c]=0;o.set(n.subarray(0,La),0),a.set(n.subarray(0,La+1),0)}i.inflate_trees_bits=function(d,c,p,u,h){let f;return l(19),e[0]=0,f=s(d,0,19,19,null,null,p,c,u,e,t),f==-3?h.msg="oversubscribed dynamic bit lengths tree":(f==-5||c[0]===0)&&(h.msg="incomplete dynamic bit lengths tree",f=-3),f},i.inflate_trees_dynamic=function(d,c,p,u,h,f,_,m,A){let y;return l(288),e[0]=0,y=s(p,0,d,257,k1,U1,f,u,m,e,t),y!=0||u[0]===0?(y==-3?A.msg="oversubscribed literal/length tree":y!=-4&&(A.msg="incomplete literal/length tree",y=-3),y):(l(288),y=s(p,d,c,0,G1,H1,_,h,m,e,t),y!=0||h[0]===0&&d>257?(y==-3?A.msg="oversubscribed distance tree":y==-5?(A.msg="incomplete distance tree",y=-3):y!=-4&&(A.msg="empty distance tree with lengths",y=-3),y):0)}}Mg.inflate_trees_fixed=function(i,e,t,n){return i[0]=M1,e[0]=L1,t[0]=B1,n[0]=V1,0};var _p=0,Lb=1,Bb=2,Vb=3,kb=4,Ub=5,Gb=6,xg=7,Hb=8,Ap=9;function z1(){let i=this,e,t=0,n,r=0,o=0,a=0,s=0,l=0,d=0,c=0,p,u=0,h,f=0;function _(m,A,y,S,g,b,T,I){let O,w,P,H,re,q,W,x,F,k,G,M,Q,Y,B,te;W=I.next_in_index,x=I.avail_in,re=T.bitb,q=T.bitk,F=T.write,k=F<T.read?T.read-F-1:T.end-F,G=Do[m],M=Do[A];do{for(;q<20;)x--,re|=(I.read_byte(W++)&255)<<q,q+=8;if(O=re&G,w=y,P=S,te=(P+O)*3,(H=w[te])===0){re>>=w[te+1],q-=w[te+1],T.win[F++]=w[te+2],k--;continue}do{if(re>>=w[te+1],q-=w[te+1],H&16){for(H&=15,Q=w[te+2]+(re&Do[H]),re>>=H,q-=H;q<15;)x--,re|=(I.read_byte(W++)&255)<<q,q+=8;O=re&M,w=g,P=b,te=(P+O)*3,H=w[te];do if(re>>=w[te+1],q-=w[te+1],H&16){for(H&=15;q<H;)x--,re|=(I.read_byte(W++)&255)<<q,q+=8;if(Y=w[te+2]+(re&Do[H]),re>>=H,q-=H,k-=Q,F>=Y)B=F-Y,F-B>0&&2>F-B?(T.win[F++]=T.win[B++],T.win[F++]=T.win[B++],Q-=2):(T.win.set(T.win.subarray(B,B+2),F),F+=2,B+=2,Q-=2);else{B=F-Y;do B+=T.end;while(B<0);if(H=T.end-B,Q>H){if(Q-=H,F-B>0&&H>F-B)do T.win[F++]=T.win[B++];while(--H!==0);else T.win.set(T.win.subarray(B,B+H),F),F+=H,B+=H,H=0;B=0}}if(F-B>0&&Q>F-B)do T.win[F++]=T.win[B++];while(--Q!==0);else T.win.set(T.win.subarray(B,B+Q),F),F+=Q,B+=Q,Q=0;break}else if(!(H&64))O+=w[te+2],O+=re&Do[H],te=(P+O)*3,H=w[te];else return I.msg="invalid distance code",Q=I.avail_in-x,Q=q>>3<Q?q>>3:Q,x+=Q,W-=Q,q-=Q<<3,T.bitb=re,T.bitk=q,I.avail_in=x,I.total_in+=W-I.next_in_index,I.next_in_index=W,T.write=F,-3;while(!0);break}if(H&64)return H&32?(Q=I.avail_in-x,Q=q>>3<Q?q>>3:Q,x+=Q,W-=Q,q-=Q<<3,T.bitb=re,T.bitk=q,I.avail_in=x,I.total_in+=W-I.next_in_index,I.next_in_index=W,T.write=F,1):(I.msg="invalid literal/length code",Q=I.avail_in-x,Q=q>>3<Q?q>>3:Q,x+=Q,W-=Q,q-=Q<<3,T.bitb=re,T.bitk=q,I.avail_in=x,I.total_in+=W-I.next_in_index,I.next_in_index=W,T.write=F,-3);if(O+=w[te+2],O+=re&Do[H],te=(P+O)*3,(H=w[te])===0){re>>=w[te+1],q-=w[te+1],T.win[F++]=w[te+2],k--;break}}while(!0)}while(k>=258&&x>=10);return Q=I.avail_in-x,Q=q>>3<Q?q>>3:Q,x+=Q,W-=Q,q-=Q<<3,T.bitb=re,T.bitk=q,I.avail_in=x,I.total_in+=W-I.next_in_index,I.next_in_index=W,T.write=F,0}i.init=function(m,A,y,S,g,b){e=_p,d=m,c=A,p=y,u=S,h=g,f=b,n=null},i.proc=function(m,A,y){let S,g,b,T=0,I=0,O=0,w,P,H,re;for(O=A.next_in_index,w=A.avail_in,T=m.bitb,I=m.bitk,P=m.write,H=P<m.read?m.read-P-1:m.end-P;;)switch(e){case _p:if(H>=258&&w>=10&&(m.bitb=T,m.bitk=I,A.avail_in=w,A.total_in+=O-A.next_in_index,A.next_in_index=O,m.write=P,y=_(d,c,p,u,h,f,m,A),O=A.next_in_index,w=A.avail_in,T=m.bitb,I=m.bitk,P=m.write,H=P<m.read?m.read-P-1:m.end-P,y!=0)){e=y==1?xg:Ap;break}o=d,n=p,r=u,e=Lb;case Lb:for(S=o;I<S;){if(w!==0)y=0;else return m.bitb=T,m.bitk=I,A.avail_in=w,A.total_in+=O-A.next_in_index,A.next_in_index=O,m.write=P,m.inflate_flush(A,y);w--,T|=(A.read_byte(O++)&255)<<I,I+=8}if(g=(r+(T&Do[S]))*3,T>>>=n[g+1],I-=n[g+1],b=n[g],b===0){a=n[g+2],e=Gb;break}if(b&16){s=b&15,t=n[g+2],e=Bb;break}if(!(b&64)){o=b,r=g/3+n[g+2];break}if(b&32){e=xg;break}return e=Ap,A.msg="invalid literal/length code",y=-3,m.bitb=T,m.bitk=I,A.avail_in=w,A.total_in+=O-A.next_in_index,A.next_in_index=O,m.write=P,m.inflate_flush(A,y);case Bb:for(S=s;I<S;){if(w!==0)y=0;else return m.bitb=T,m.bitk=I,A.avail_in=w,A.total_in+=O-A.next_in_index,A.next_in_index=O,m.write=P,m.inflate_flush(A,y);w--,T|=(A.read_byte(O++)&255)<<I,I+=8}t+=T&Do[S],T>>=S,I-=S,o=c,n=h,r=f,e=Vb;case Vb:for(S=o;I<S;){if(w!==0)y=0;else return m.bitb=T,m.bitk=I,A.avail_in=w,A.total_in+=O-A.next_in_index,A.next_in_index=O,m.write=P,m.inflate_flush(A,y);w--,T|=(A.read_byte(O++)&255)<<I,I+=8}if(g=(r+(T&Do[S]))*3,T>>=n[g+1],I-=n[g+1],b=n[g],b&16){s=b&15,l=n[g+2],e=kb;break}if(!(b&64)){o=b,r=g/3+n[g+2];break}return e=Ap,A.msg="invalid distance code",y=-3,m.bitb=T,m.bitk=I,A.avail_in=w,A.total_in+=O-A.next_in_index,A.next_in_index=O,m.write=P,m.inflate_flush(A,y);case kb:for(S=s;I<S;){if(w!==0)y=0;else return m.bitb=T,m.bitk=I,A.avail_in=w,A.total_in+=O-A.next_in_index,A.next_in_index=O,m.write=P,m.inflate_flush(A,y);w--,T|=(A.read_byte(O++)&255)<<I,I+=8}l+=T&Do[S],T>>=S,I-=S,e=Ub;case Ub:for(re=P-l;re<0;)re+=m.end;for(;t!==0;){if(H===0&&(P==m.end&&m.read!==0&&(P=0,H=P<m.read?m.read-P-1:m.end-P),H===0&&(m.write=P,y=m.inflate_flush(A,y),P=m.write,H=P<m.read?m.read-P-1:m.end-P,P==m.end&&m.read!==0&&(P=0,H=P<m.read?m.read-P-1:m.end-P),H===0)))return m.bitb=T,m.bitk=I,A.avail_in=w,A.total_in+=O-A.next_in_index,A.next_in_index=O,m.write=P,m.inflate_flush(A,y);m.win[P++]=m.win[re++],H--,re==m.end&&(re=0),t--}e=_p;break;case Gb:if(H===0&&(P==m.end&&m.read!==0&&(P=0,H=P<m.read?m.read-P-1:m.end-P),H===0&&(m.write=P,y=m.inflate_flush(A,y),P=m.write,H=P<m.read?m.read-P-1:m.end-P,P==m.end&&m.read!==0&&(P=0,H=P<m.read?m.read-P-1:m.end-P),H===0)))return m.bitb=T,m.bitk=I,A.avail_in=w,A.total_in+=O-A.next_in_index,A.next_in_index=O,m.write=P,m.inflate_flush(A,y);y=0,m.win[P++]=a,H--,e=_p;break;case xg:if(I>7&&(I-=8,w++,O--),m.write=P,y=m.inflate_flush(A,y),P=m.write,H=P<m.read?m.read-P-1:m.end-P,m.read!=m.write)return m.bitb=T,m.bitk=I,A.avail_in=w,A.total_in+=O-A.next_in_index,A.next_in_index=O,m.write=P,m.inflate_flush(A,y);e=Hb;case Hb:return y=1,m.bitb=T,m.bitk=I,A.avail_in=w,A.total_in+=O-A.next_in_index,A.next_in_index=O,m.write=P,m.inflate_flush(A,y);case Ap:return y=-3,m.bitb=T,m.bitk=I,A.avail_in=w,A.total_in+=O-A.next_in_index,A.next_in_index=O,m.write=P,m.inflate_flush(A,y);default:return y=-2,m.bitb=T,m.bitk=I,A.avail_in=w,A.total_in+=O-A.next_in_index,A.next_in_index=O,m.write=P,m.inflate_flush(A,y)}},i.free=function(){}}var zb=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],El=0,Pg=1,Wb=2,Qb=3,Kb=4,qb=5,Sp=6,yp=7,Yb=8,Ns=9;function W1(i,e){let t=this,n=El,r=0,o=0,a=0,s,l=[0],d=[0],c=new z1,p=0,u=new Int32Array(tT*3),h=0,f=new Mg;t.bitk=0,t.bitb=0,t.win=new Uint8Array(e),t.end=e,t.read=0,t.write=0,t.reset=function(_,m){m&&(m[0]=h),n==Sp&&c.free(_),n=El,t.bitk=0,t.bitb=0,t.read=t.write=0},t.reset(i,null),t.inflate_flush=function(_,m){let A,y,S;return y=_.next_out_index,S=t.read,A=(S<=t.write?t.write:t.end)-S,A>_.avail_out&&(A=_.avail_out),A!==0&&m==-5&&(m=0),_.avail_out-=A,_.total_out+=A,_.next_out.set(t.win.subarray(S,S+A),y),y+=A,S+=A,S==t.end&&(S=0,t.write==t.end&&(t.write=0),A=t.write-S,A>_.avail_out&&(A=_.avail_out),A!==0&&m==-5&&(m=0),_.avail_out-=A,_.total_out+=A,_.next_out.set(t.win.subarray(S,S+A),y),y+=A,S+=A),_.next_out_index=y,t.read=S,m},t.proc=function(_,m){let A,y,S,g,b,T,I,O;for(g=_.next_in_index,b=_.avail_in,y=t.bitb,S=t.bitk,T=t.write,I=T<t.read?t.read-T-1:t.end-T;;){let w,P,H,re,q,W,x,F;switch(n){case El:for(;S<3;){if(b!==0)m=0;else return t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);b--,y|=(_.read_byte(g++)&255)<<S,S+=8}switch(A=y&7,p=A&1,A>>>1){case 0:y>>>=3,S-=3,A=S&7,y>>>=A,S-=A,n=Pg;break;case 1:w=[],P=[],H=[[]],re=[[]],Mg.inflate_trees_fixed(w,P,H,re),c.init(w[0],P[0],H[0],0,re[0],0),y>>>=3,S-=3,n=Sp;break;case 2:y>>>=3,S-=3,n=Qb;break;case 3:return y>>>=3,S-=3,n=Ns,_.msg="invalid block type",m=-3,t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m)}break;case Pg:for(;S<32;){if(b!==0)m=0;else return t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);b--,y|=(_.read_byte(g++)&255)<<S,S+=8}if((~y>>>16&65535)!=(y&65535))return n=Ns,_.msg="invalid stored block lengths",m=-3,t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);r=y&65535,y=S=0,n=r!==0?Wb:p!==0?yp:El;break;case Wb:if(b===0||I===0&&(T==t.end&&t.read!==0&&(T=0,I=T<t.read?t.read-T-1:t.end-T),I===0&&(t.write=T,m=t.inflate_flush(_,m),T=t.write,I=T<t.read?t.read-T-1:t.end-T,T==t.end&&t.read!==0&&(T=0,I=T<t.read?t.read-T-1:t.end-T),I===0)))return t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);if(m=0,A=r,A>b&&(A=b),A>I&&(A=I),t.win.set(_.read_buf(g,A),T),g+=A,b-=A,T+=A,I-=A,(r-=A)!==0)break;n=p!==0?yp:El;break;case Qb:for(;S<14;){if(b!==0)m=0;else return t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);b--,y|=(_.read_byte(g++)&255)<<S,S+=8}if(o=A=y&16383,(A&31)>29||(A>>5&31)>29)return n=Ns,_.msg="too many length or distance symbols",m=-3,t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);if(A=258+(A&31)+(A>>5&31),!s||s.length<A)s=[];else for(O=0;O<A;O++)s[O]=0;y>>>=14,S-=14,a=0,n=Kb;case Kb:for(;a<4+(o>>>10);){for(;S<3;){if(b!==0)m=0;else return t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);b--,y|=(_.read_byte(g++)&255)<<S,S+=8}s[zb[a++]]=y&7,y>>>=3,S-=3}for(;a<19;)s[zb[a++]]=0;if(l[0]=7,A=f.inflate_trees_bits(s,l,d,u,_),A!=0)return m=A,m==-3&&(s=null,n=Ns),t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);a=0,n=qb;case qb:for(;A=o,!(a>=258+(A&31)+(A>>5&31));){let k,G;for(A=l[0];S<A;){if(b!==0)m=0;else return t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);b--,y|=(_.read_byte(g++)&255)<<S,S+=8}if(A=u[(d[0]+(y&Do[A]))*3+1],G=u[(d[0]+(y&Do[A]))*3+2],G<16)y>>>=A,S-=A,s[a++]=G;else{for(O=G==18?7:G-14,k=G==18?11:3;S<A+O;){if(b!==0)m=0;else return t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);b--,y|=(_.read_byte(g++)&255)<<S,S+=8}if(y>>>=A,S-=A,k+=y&Do[O],y>>>=O,S-=O,O=a,A=o,O+k>258+(A&31)+(A>>5&31)||G==16&&O<1)return s=null,n=Ns,_.msg="invalid bit length repeat",m=-3,t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);G=G==16?s[O-1]:0;do s[O++]=G;while(--k!==0);a=O}}if(d[0]=-1,q=[],W=[],x=[],F=[],q[0]=9,W[0]=6,A=o,A=f.inflate_trees_dynamic(257+(A&31),1+(A>>5&31),s,q,W,x,F,u,_),A!=0)return A==-3&&(s=null,n=Ns),m=A,t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);c.init(q[0],W[0],u,x[0],u,F[0]),n=Sp;case Sp:if(t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,(m=c.proc(t,_,m))!=1)return t.inflate_flush(_,m);if(m=0,c.free(_),g=_.next_in_index,b=_.avail_in,y=t.bitb,S=t.bitk,T=t.write,I=T<t.read?t.read-T-1:t.end-T,p===0){n=El;break}n=yp;case yp:if(t.write=T,m=t.inflate_flush(_,m),T=t.write,I=T<t.read?t.read-T-1:t.end-T,t.read!=t.write)return t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);n=Yb;case Yb:return m=1,t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);case Ns:return m=-3,t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m);default:return m=-2,t.bitb=y,t.bitk=S,_.avail_in=b,_.total_in+=g-_.next_in_index,_.next_in_index=g,t.write=T,t.inflate_flush(_,m)}}},t.free=function(_){t.reset(_,null),t.win=null,u=null},t.set_dictionary=function(_,m,A){t.win.set(_.subarray(m,m+A),0),t.read=t.write=A},t.sync_point=function(){return n==Pg?1:0}}var Q1=32,K1=8,q1=0,Xb=1,jb=2,Zb=3,$b=4,Jb=5,Dg=6,od=7,eT=12,Ba=13,Y1=[0,0,255,255];function X1(){let i=this;i.mode=0,i.method=0,i.was=[0],i.need=0,i.marker=0,i.wbits=0;function e(t){return!t||!t.istate?-2:(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=od,t.istate.blocks.reset(t,null),0)}i.inflateEnd=function(t){return i.blocks&&i.blocks.free(t),i.blocks=null,0},i.inflateInit=function(t,n){return t.msg=null,i.blocks=null,n<8||n>15?(i.inflateEnd(t),-2):(i.wbits=n,t.istate.blocks=new W1(t,1<<n),e(t),0)},i.inflate=function(t,n){let r,o;if(!t||!t.istate||!t.next_in)return-2;let a=t.istate;for(n=n==D1?-5:0,r=-5;;)switch(a.mode){case q1:if(t.avail_in===0)return r;if(r=n,t.avail_in--,t.total_in++,((a.method=t.read_byte(t.next_in_index++))&15)!=K1){a.mode=Ba,t.msg="unknown compression method",a.marker=5;break}if((a.method>>4)+8>a.wbits){a.mode=Ba,t.msg="invalid win size",a.marker=5;break}a.mode=Xb;case Xb:if(t.avail_in===0)return r;if(r=n,t.avail_in--,t.total_in++,o=t.read_byte(t.next_in_index++)&255,((a.method<<8)+o)%31!==0){a.mode=Ba,t.msg="incorrect header check",a.marker=5;break}if(!(o&Q1)){a.mode=od;break}a.mode=jb;case jb:if(t.avail_in===0)return r;r=n,t.avail_in--,t.total_in++,a.need=(t.read_byte(t.next_in_index++)&255)<<24&4278190080,a.mode=Zb;case Zb:if(t.avail_in===0)return r;r=n,t.avail_in--,t.total_in++,a.need+=(t.read_byte(t.next_in_index++)&255)<<16&16711680,a.mode=$b;case $b:if(t.avail_in===0)return r;r=n,t.avail_in--,t.total_in++,a.need+=(t.read_byte(t.next_in_index++)&255)<<8&65280,a.mode=Jb;case Jb:return t.avail_in===0?r:(r=n,t.avail_in--,t.total_in++,a.need+=t.read_byte(t.next_in_index++)&255,a.mode=Dg,2);case Dg:return a.mode=Ba,t.msg="need dictionary",a.marker=0,-2;case od:if(r=a.blocks.proc(t,r),r==-3){a.mode=Ba,a.marker=0;break}if(r==0&&(r=n),r!=1)return r;r=n,a.blocks.reset(t,a.was),a.mode=eT;case eT:return t.avail_in=0,1;case Ba:return-3;default:return-2}},i.inflateSetDictionary=function(t,n,r){let o=0,a=r;if(!t||!t.istate||t.istate.mode!=Dg)return-2;let s=t.istate;return a>=1<<s.wbits&&(a=(1<<s.wbits)-1,o=r-a),s.blocks.set_dictionary(n,o,a),s.mode=od,0},i.inflateSync=function(t){let n,r,o,a,s;if(!t||!t.istate)return-2;let l=t.istate;if(l.mode!=Ba&&(l.mode=Ba,l.marker=0),(n=t.avail_in)===0)return-5;for(r=t.next_in_index,o=l.marker;n!==0&&o<4;)t.read_byte(r)==Y1[o]?o++:t.read_byte(r)!==0?o=0:o=4-o,r++,n--;return t.total_in+=r-t.next_in_index,t.next_in_index=r,t.avail_in=n,l.marker=o,o!=4?-3:(a=t.total_in,s=t.total_out,e(t),t.total_in=a,t.total_out=s,l.mode=od,0)},i.inflateSyncPoint=function(t){return!t||!t.istate||!t.istate.blocks?-2:t.istate.blocks.sync_point()}}function nT(){}nT.prototype={inflateInit:function(i){let e=this;return e.istate=new X1,i||(i=15),e.istate.inflateInit(e,i)},inflate:function(i){let e=this;return e.istate?e.istate.inflate(e,i):-2},inflateEnd:function(){let i=this;if(!i.istate)return-2;let e=i.istate.inflateEnd(i);return i.istate=null,e},inflateSync:function(){let i=this;return i.istate?i.istate.inflateSync(i):-2},inflateSetDictionary:function(i,e){let t=this;return t.istate?t.istate.inflateSetDictionary(t,i,e):-2},read_byte:function(i){return this.next_in[i]},read_buf:function(i,e){return this.next_in.subarray(i,i+e)}};function j1(i){let e=this,t=new nT,n=i&&i.chunkSize?Math.floor(i.chunkSize*2):128*1024,r=P1,o=new Uint8Array(n),a=!1;t.inflateInit(),t.next_out=o,e.append=function(s,l){let d=[],c,p,u=0,h=0,f=0;if(s.length!==0){t.next_in_index=0,t.next_in=s,t.avail_in=s.length;do{if(t.next_out_index=0,t.avail_out=n,t.avail_in===0&&!a&&(t.next_in_index=0,a=!0),c=t.inflate(r),a&&c===-5){if(t.avail_in!==0)throw new Error("inflating: bad input")}else if(c!==0&&c!==1)throw new Error("inflating: "+t.msg);if((a||c===1)&&t.avail_in===s.length)throw new Error("inflating: bad input");t.next_out_index&&(t.next_out_index===n?d.push(new Uint8Array(o)):d.push(o.slice(0,t.next_out_index))),f+=t.next_out_index,l&&t.next_in_index>0&&t.next_in_index!=u&&(l(t.next_in_index),u=t.next_in_index)}while(t.avail_in>0||t.avail_out===0);return d.length>1?(p=new Uint8Array(f),d.forEach(function(_){p.set(_,h),h+=_.length})):p=d[0]||new Uint8Array(0),p}},e.flush=function(){t.inflateEnd()}}var rT=j1;var Z1={chunkSize:524288,maxWorkers:typeof navigator<"u"&&navigator.hardwareConcurrency||2,terminateWorkerTimeout:5e3,useWebWorkers:!0,workerScripts:void 0},yo=Object.assign({},Z1);function Lg(){return yo}function Cl(i){if(i.baseURL!==void 0&&(yo.baseURL=i.baseURL),i.chunkSize!==void 0&&(yo.chunkSize=i.chunkSize),i.maxWorkers!==void 0&&(yo.maxWorkers=i.maxWorkers),i.terminateWorkerTimeout!==void 0&&(yo.terminateWorkerTimeout=i.terminateWorkerTimeout),i.useWebWorkers!==void 0&&(yo.useWebWorkers=i.useWebWorkers),i.Deflate!==void 0&&(yo.Deflate=i.Deflate),i.Inflate!==void 0&&(yo.Inflate=i.Inflate),i.workerScripts!==void 0){if(i.workerScripts.deflate){if(!Array.isArray(i.workerScripts.deflate))throw new Error("workerScripts.deflate must be an array");yo.workerScripts||(yo.workerScripts={}),yo.workerScripts.deflate=i.workerScripts.deflate}if(i.workerScripts.inflate){if(!Array.isArray(i.workerScripts.inflate))throw new Error("workerScripts.inflate must be an array");yo.workerScripts||(yo.workerScripts={}),yo.workerScripts.inflate=i.workerScripts.inflate}}}var id={application:{"andrew-inset":"ez",annodex:"anx","atom+xml":"atom","atomcat+xml":"atomcat","atomserv+xml":"atomsrv",bbolin:"lin",cap:["cap","pcap"],"cu-seeme":"cu","davmount+xml":"davmount",dsptype:"tsp",ecmascript:["es","ecma"],futuresplash:"spl",hta:"hta","java-archive":"jar","java-serialized-object":"ser","java-vm":"class",javascript:"js",m3g:"m3g","mac-binhex40":"hqx",mathematica:["nb","ma","mb"],msaccess:"mdb",msword:["doc","dot"],mxf:"mxf",oda:"oda",ogg:"ogx",pdf:"pdf","pgp-keys":"key","pgp-signature":["asc","sig"],"pics-rules":"prf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],rar:"rar","rdf+xml":"rdf","rss+xml":"rss",rtf:"rtf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd"],"xspf+xml":"xspf",zip:"zip","vnd.android.package-archive":"apk","vnd.cinderella":"cdy","vnd.google-earth.kml+xml":"kml","vnd.google-earth.kmz":"kmz","vnd.mozilla.xul+xml":"xul","vnd.ms-excel":["xls","xlb","xlt","xlm","xla","xlc","xlw"],"vnd.ms-pki.seccat":"cat","vnd.ms-pki.stl":"stl","vnd.ms-powerpoint":["ppt","pps","pot"],"vnd.oasis.opendocument.chart":"odc","vnd.oasis.opendocument.database":"odb","vnd.oasis.opendocument.formula":"odf","vnd.oasis.opendocument.graphics":"odg","vnd.oasis.opendocument.graphics-template":"otg","vnd.oasis.opendocument.image":"odi","vnd.oasis.opendocument.presentation":"odp","vnd.oasis.opendocument.presentation-template":"otp","vnd.oasis.opendocument.spreadsheet":"ods","vnd.oasis.opendocument.spreadsheet-template":"ots","vnd.oasis.opendocument.text":"odt","vnd.oasis.opendocument.text-master":"odm","vnd.oasis.opendocument.text-template":"ott","vnd.oasis.opendocument.text-web":"oth","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","vnd.openxmlformats-officedocument.spreadsheetml.template":"xltx","vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx","vnd.openxmlformats-officedocument.presentationml.template":"potx","vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","vnd.openxmlformats-officedocument.wordprocessingml.template":"dotx","vnd.smaf":"mmf","vnd.stardivision.calc":"sdc","vnd.stardivision.chart":"sds","vnd.stardivision.draw":"sda","vnd.stardivision.impress":"sdd","vnd.stardivision.math":["sdf","smf"],"vnd.stardivision.writer":["sdw","vor"],"vnd.stardivision.writer-global":"sgl","vnd.sun.xml.calc":"sxc","vnd.sun.xml.calc.template":"stc","vnd.sun.xml.draw":"sxd","vnd.sun.xml.draw.template":"std","vnd.sun.xml.impress":"sxi","vnd.sun.xml.impress.template":"sti","vnd.sun.xml.math":"sxm","vnd.sun.xml.writer":"sxw","vnd.sun.xml.writer.global":"sxg","vnd.sun.xml.writer.template":"stw","vnd.symbian.install":["sis","sisx"],"vnd.visio":["vsd","vst","vss","vsw"],"vnd.wap.wbxml":"wbxml","vnd.wap.wmlc":"wmlc","vnd.wap.wmlscriptc":"wmlsc","vnd.wordperfect":"wpd","vnd.wordperfect5.1":"wp5","x-123":"wk","x-7z-compressed":"7z","x-abiword":"abw","x-apple-diskimage":"dmg","x-bcpio":"bcpio","x-bittorrent":"torrent","x-cbr":["cbr","cba","cbt","cb7"],"x-cbz":"cbz","x-cdf":["cdf","cda"],"x-cdlink":"vcd","x-chess-pgn":"pgn","x-cpio":"cpio","x-csh":"csh","x-debian-package":["deb","udeb"],"x-director":["dcr","dir","dxr","cst","cct","cxt","w3d","fgd","swa"],"x-dms":"dms","x-doom":"wad","x-dvi":"dvi","x-httpd-eruby":"rhtml","x-font":"pcf.Z","x-freemind":"mm","x-gnumeric":"gnumeric","x-go-sgf":"sgf","x-graphing-calculator":"gcf","x-gtar":["gtar","taz"],"x-hdf":"hdf","x-httpd-php":["phtml","pht","php"],"x-httpd-php-source":"phps","x-httpd-php3":"php3","x-httpd-php3-preprocessed":"php3p","x-httpd-php4":"php4","x-httpd-php5":"php5","x-ica":"ica","x-info":"info","x-internet-signup":["ins","isp"],"x-iphone":"iii","x-iso9660-image":"iso","x-java-jnlp-file":"jnlp","x-jmol":"jmz","x-killustrator":"kil","x-koan":["skp","skd","skt","skm"],"x-kpresenter":["kpr","kpt"],"x-kword":["kwd","kwt"],"x-latex":"latex","x-lha":"lha","x-lyx":"lyx","x-lzh":"lzh","x-lzx":"lzx","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-ms-wmd":"wmd","x-ms-wmz":"wmz","x-msdos-program":["com","exe","bat","dll"],"x-msi":"msi","x-netcdf":["nc","cdf"],"x-ns-proxy-autoconfig":["pac","dat"],"x-nwc":"nwc","x-object":"o","x-oz-application":"oza","x-pkcs7-certreqresp":"p7r","x-python-code":["pyc","pyo"],"x-qgis":["qgs","shp","shx"],"x-quicktimeplayer":"qtl","x-redhat-package-manager":"rpm","x-ruby":"rb","x-sh":"sh","x-shar":"shar","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","x-stuffit":"sit","x-sv4cpio":"sv4cpio","x-sv4crc":"sv4crc","x-tar":"tar","x-tcl":"tcl","x-tex-gf":"gf","x-tex-pk":"pk","x-texinfo":["texinfo","texi"],"x-trash":["~","%","bak","old","sik"],"x-troff":["t","tr","roff"],"x-troff-man":"man","x-troff-me":"me","x-troff-ms":"ms","x-ustar":"ustar","x-wais-source":"src","x-wingz":"wz","x-x509-ca-cert":["crt","der","cer"],"x-xcf":"xcf","x-xfig":"fig","x-xpinstall":"xpi",applixware:"aw","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-capability":"cdmia","cdmi-container":"cdmic","cdmi-domain":"cdmid","cdmi-object":"cdmio","cdmi-queue":"cdmiq","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc","emma+xml":"emma","epub+zip":"epub",exi:"exi","font-tdpfr":"pfr","gml+xml":"gml","gpx+xml":"gpx",gxf:"gxf",hyperstudio:"stk","inkml+xml":["ink","inkml"],ipfix:"ipfix",json:"json","jsonml+json":"jsonml","lost+xml":"lostxml","mads+xml":"mads",marc:"mrc","marcxml+xml":"mrcx","mathml+xml":"mathml",mbox:"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods",mp21:["m21","mp21"],mp4:"mp4s","oebps-package+xml":"opf","omdoc+xml":"omdoc",onenote:["onetoc","onetoc2","onetmp","onepkg"],oxps:"oxps","patch-ops-error+xml":"xer","pgp-encrypted":"pgp",pkcs10:"p10","pkcs7-mime":["p7m","p7c"],"pkcs7-signature":"p7s",pkcs8:"p8","pkix-attr-cert":"ac","pkix-crl":"crl","pkix-pkipath":"pkipath",pkixcmp:"pki","pls+xml":"pls","prs.cww":"cww","pskc+xml":"pskcxml","reginfo+xml":"rif","relax-ng-compact-syntax":"rnc","resource-lists+xml":"rl","resource-lists-diff+xml":"rld","rls-services+xml":"rs","rpki-ghostbusters":"gbr","rpki-manifest":"mft","rpki-roa":"roa","rsd+xml":"rsd","sbml+xml":"sbml","scvp-cv-request":"scq","scvp-cv-response":"scs","scvp-vp-request":"spq","scvp-vp-response":"spp",sdp:"sdp","set-payment-initiation":"setpay","set-registration-initiation":"setreg","shf+xml":"shf","sparql-query":"rq","sparql-results+xml":"srx",srgs:"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","timestamped-data":"tsd","vnd.3gpp.pic-bw-large":"plb","vnd.3gpp.pic-bw-small":"psb","vnd.3gpp.pic-bw-var":"pvb","vnd.3gpp2.tcap":"tcap","vnd.3m.post-it-notes":"pwn","vnd.accpac.simply.aso":"aso","vnd.accpac.simply.imp":"imp","vnd.acucobol":"acu","vnd.acucorp":["atc","acutc"],"vnd.adobe.air-application-installer-package+zip":"air","vnd.adobe.formscentral.fcdt":"fcdt","vnd.adobe.fxp":["fxp","fxpl"],"vnd.adobe.xdp+xml":"xdp","vnd.adobe.xfdf":"xfdf","vnd.ahead.space":"ahead","vnd.airzip.filesecure.azf":"azf","vnd.airzip.filesecure.azs":"azs","vnd.amazon.ebook":"azw","vnd.americandynamics.acc":"acc","vnd.amiga.ami":"ami","vnd.anser-web-certificate-issue-initiation":"cii","vnd.anser-web-funds-transfer-initiation":"fti","vnd.antix.game-component":"atx","vnd.apple.installer+xml":"mpkg","vnd.apple.mpegurl":"m3u8","vnd.aristanetworks.swi":"swi","vnd.astraea-software.iota":"iota","vnd.audiograph":"aep","vnd.blueice.multipass":"mpm","vnd.bmi":"bmi","vnd.businessobjects":"rep","vnd.chemdraw+xml":"cdxml","vnd.chipnuts.karaoke-mmd":"mmd","vnd.claymore":"cla","vnd.cloanto.rp9":"rp9","vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"vnd.cluetrust.cartomobile-config":"c11amc","vnd.cluetrust.cartomobile-config-pkg":"c11amz","vnd.commonspace":"csp","vnd.contact.cmsg":"cdbcmsg","vnd.cosmocaller":"cmc","vnd.crick.clicker":"clkx","vnd.crick.clicker.keyboard":"clkk","vnd.crick.clicker.palette":"clkp","vnd.crick.clicker.template":"clkt","vnd.crick.clicker.wordbank":"clkw","vnd.criticaltools.wbs+xml":"wbs","vnd.ctc-posml":"pml","vnd.cups-ppd":"ppd","vnd.curl.car":"car","vnd.curl.pcurl":"pcurl","vnd.dart":"dart","vnd.data-vision.rdz":"rdz","vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"vnd.dece.ttml+xml":["uvt","uvvt"],"vnd.dece.unspecified":["uvx","uvvx"],"vnd.dece.zip":["uvz","uvvz"],"vnd.denovo.fcselayout-link":"fe_launch","vnd.dna":"dna","vnd.dolby.mlp":"mlp","vnd.dpgraph":"dpg","vnd.dreamfactory":"dfac","vnd.ds-keypoint":"kpxx","vnd.dvb.ait":"ait","vnd.dvb.service":"svc","vnd.dynageo":"geo","vnd.ecowin.chart":"mag","vnd.enliven":"nml","vnd.epson.esf":"esf","vnd.epson.msf":"msf","vnd.epson.quickanime":"qam","vnd.epson.salt":"slt","vnd.epson.ssf":"ssf","vnd.eszigno3+xml":["es3","et3"],"vnd.ezpix-album":"ez2","vnd.ezpix-package":"ez3","vnd.fdf":"fdf","vnd.fdsn.mseed":"mseed","vnd.fdsn.seed":["seed","dataless"],"vnd.flographit":"gph","vnd.fluxtime.clip":"ftc","vnd.framemaker":["fm","frame","maker","book"],"vnd.frogans.fnc":"fnc","vnd.frogans.ltf":"ltf","vnd.fsc.weblaunch":"fsc","vnd.fujitsu.oasys":"oas","vnd.fujitsu.oasys2":"oa2","vnd.fujitsu.oasys3":"oa3","vnd.fujitsu.oasysgp":"fg5","vnd.fujitsu.oasysprs":"bh2","vnd.fujixerox.ddd":"ddd","vnd.fujixerox.docuworks":"xdw","vnd.fujixerox.docuworks.binder":"xbd","vnd.fuzzysheet":"fzs","vnd.genomatix.tuxedo":"txd","vnd.geogebra.file":"ggb","vnd.geogebra.tool":"ggt","vnd.geometry-explorer":["gex","gre"],"vnd.geonext":"gxt","vnd.geoplan":"g2w","vnd.geospace":"g3w","vnd.gmx":"gmx","vnd.grafeq":["gqf","gqs"],"vnd.groove-account":"gac","vnd.groove-help":"ghf","vnd.groove-identity-message":"gim","vnd.groove-injector":"grv","vnd.groove-tool-message":"gtm","vnd.groove-tool-template":"tpl","vnd.groove-vcard":"vcg","vnd.hal+xml":"hal","vnd.handheld-entertainment+xml":"zmm","vnd.hbci":"hbci","vnd.hhe.lesson-player":"les","vnd.hp-hpgl":"hpgl","vnd.hp-hpid":"hpid","vnd.hp-hps":"hps","vnd.hp-jlyt":"jlt","vnd.hp-pcl":"pcl","vnd.hp-pclxl":"pclxl","vnd.hydrostatix.sof-data":"sfd-hdstx","vnd.ibm.minipay":"mpy","vnd.ibm.modcap":["afp","listafp","list3820"],"vnd.ibm.rights-management":"irm","vnd.ibm.secure-container":"sc","vnd.iccprofile":["icc","icm"],"vnd.igloader":"igl","vnd.immervision-ivp":"ivp","vnd.immervision-ivu":"ivu","vnd.insors.igm":"igm","vnd.intercon.formnet":["xpw","xpx"],"vnd.intergeo":"i2g","vnd.intu.qbo":"qbo","vnd.intu.qfx":"qfx","vnd.ipunplugged.rcprofile":"rcprofile","vnd.irepository.package+xml":"irp","vnd.is-xpr":"xpr","vnd.isac.fcs":"fcs","vnd.jam":"jam","vnd.jcp.javame.midlet-rms":"rms","vnd.jisp":"jisp","vnd.joost.joda-archive":"joda","vnd.kahootz":["ktz","ktr"],"vnd.kde.karbon":"karbon","vnd.kde.kchart":"chrt","vnd.kde.kformula":"kfo","vnd.kde.kivio":"flw","vnd.kde.kontour":"kon","vnd.kde.kpresenter":["kpr","kpt"],"vnd.kde.kspread":"ksp","vnd.kde.kword":["kwd","kwt"],"vnd.kenameaapp":"htke","vnd.kidspiration":"kia","vnd.kinar":["kne","knp"],"vnd.koan":["skp","skd","skt","skm"],"vnd.kodak-descriptor":"sse","vnd.las.las+xml":"lasxml","vnd.llamagraphics.life-balance.desktop":"lbd","vnd.llamagraphics.life-balance.exchange+xml":"lbe","vnd.lotus-1-2-3":"123","vnd.lotus-approach":"apr","vnd.lotus-freelance":"pre","vnd.lotus-notes":"nsf","vnd.lotus-organizer":"org","vnd.lotus-screencam":"scm","vnd.lotus-wordpro":"lwp","vnd.macports.portpkg":"portpkg","vnd.mcd":"mcd","vnd.medcalcdata":"mc1","vnd.mediastation.cdkey":"cdkey","vnd.mfer":"mwf","vnd.mfmp":"mfm","vnd.micrografx.flo":"flo","vnd.micrografx.igx":"igx","vnd.mif":"mif","vnd.mobius.daf":"daf","vnd.mobius.dis":"dis","vnd.mobius.mbk":"mbk","vnd.mobius.mqy":"mqy","vnd.mobius.msl":"msl","vnd.mobius.plc":"plc","vnd.mobius.txf":"txf","vnd.mophun.application":"mpn","vnd.mophun.certificate":"mpc","vnd.ms-artgalry":"cil","vnd.ms-cab-compressed":"cab","vnd.ms-excel.addin.macroenabled.12":"xlam","vnd.ms-excel.sheet.binary.macroenabled.12":"xlsb","vnd.ms-excel.sheet.macroenabled.12":"xlsm","vnd.ms-excel.template.macroenabled.12":"xltm","vnd.ms-fontobject":"eot","vnd.ms-htmlhelp":"chm","vnd.ms-ims":"ims","vnd.ms-lrm":"lrm","vnd.ms-officetheme":"thmx","vnd.ms-powerpoint.addin.macroenabled.12":"ppam","vnd.ms-powerpoint.presentation.macroenabled.12":"pptm","vnd.ms-powerpoint.slide.macroenabled.12":"sldm","vnd.ms-powerpoint.slideshow.macroenabled.12":"ppsm","vnd.ms-powerpoint.template.macroenabled.12":"potm","vnd.ms-project":["mpp","mpt"],"vnd.ms-word.document.macroenabled.12":"docm","vnd.ms-word.template.macroenabled.12":"dotm","vnd.ms-works":["wps","wks","wcm","wdb"],"vnd.ms-wpl":"wpl","vnd.ms-xpsdocument":"xps","vnd.mseq":"mseq","vnd.musician":"mus","vnd.muvee.style":"msty","vnd.mynfc":"taglet","vnd.neurolanguage.nlu":"nlu","vnd.nitf":["ntf","nitf"],"vnd.noblenet-directory":"nnd","vnd.noblenet-sealer":"nns","vnd.noblenet-web":"nnw","vnd.nokia.n-gage.data":"ngdat","vnd.nokia.n-gage.symbian.install":"n-gage","vnd.nokia.radio-preset":"rpst","vnd.nokia.radio-presets":"rpss","vnd.novadigm.edm":"edm","vnd.novadigm.edx":"edx","vnd.novadigm.ext":"ext","vnd.oasis.opendocument.chart-template":"otc","vnd.oasis.opendocument.formula-template":"odft","vnd.oasis.opendocument.image-template":"oti","vnd.olpc-sugar":"xo","vnd.oma.dd2+xml":"dd2","vnd.openofficeorg.extension":"oxt","vnd.openxmlformats-officedocument.presentationml.slide":"sldx","vnd.osgeo.mapguide.package":"mgp","vnd.osgi.dp":"dp","vnd.osgi.subsystem":"esa","vnd.palm":["pdb","pqa","oprc"],"vnd.pawaafile":"paw","vnd.pg.format":"str","vnd.pg.osasli":"ei6","vnd.picsel":"efif","vnd.pmi.widget":"wg","vnd.pocketlearn":"plf","vnd.powerbuilder6":"pbd","vnd.previewsystems.box":"box","vnd.proteus.magazine":"mgz","vnd.publishare-delta-tree":"qps","vnd.pvi.ptid1":"ptid","vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"vnd.realvnc.bed":"bed","vnd.recordare.musicxml":"mxl","vnd.recordare.musicxml+xml":"musicxml","vnd.rig.cryptonote":"cryptonote","vnd.rn-realmedia":"rm","vnd.rn-realmedia-vbr":"rmvb","vnd.route66.link66+xml":"link66","vnd.sailingtracker.track":"st","vnd.seemail":"see","vnd.sema":"sema","vnd.semd":"semd","vnd.semf":"semf","vnd.shana.informed.formdata":"ifm","vnd.shana.informed.formtemplate":"itp","vnd.shana.informed.interchange":"iif","vnd.shana.informed.package":"ipk","vnd.simtech-mindmapper":["twd","twds"],"vnd.smart.teacher":"teacher","vnd.solent.sdkm+xml":["sdkm","sdkd"],"vnd.spotfire.dxp":"dxp","vnd.spotfire.sfs":"sfs","vnd.stepmania.package":"smzip","vnd.stepmania.stepchart":"sm","vnd.sus-calendar":["sus","susp"],"vnd.svd":"svd","vnd.syncml+xml":"xsm","vnd.syncml.dm+wbxml":"bdm","vnd.syncml.dm+xml":"xdm","vnd.tao.intent-module-archive":"tao","vnd.tcpdump.pcap":["pcap","cap","dmp"],"vnd.tmobile-livetv":"tmo","vnd.trid.tpt":"tpt","vnd.triscape.mxs":"mxs","vnd.trueapp":"tra","vnd.ufdl":["ufd","ufdl"],"vnd.uiq.theme":"utz","vnd.umajin":"umj","vnd.unity":"unityweb","vnd.uoml+xml":"uoml","vnd.vcx":"vcx","vnd.visionary":"vis","vnd.vsf":"vsf","vnd.webturbo":"wtb","vnd.wolfram.player":"nbp","vnd.wqd":"wqd","vnd.wt.stf":"stf","vnd.xara":"xar","vnd.xfdl":"xfdl","vnd.yamaha.hv-dic":"hvd","vnd.yamaha.hv-script":"hvs","vnd.yamaha.hv-voice":"hvp","vnd.yamaha.openscoreformat":"osf","vnd.yamaha.openscoreformat.osfpvg+xml":"osfpvg","vnd.yamaha.smaf-audio":"saf","vnd.yamaha.smaf-phrase":"spf","vnd.yellowriver-custom-menu":"cmp","vnd.zul":["zir","zirz"],"vnd.zzazz.deck+xml":"zaz","voicexml+xml":"vxml",widget:"wgt",winhlp:"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-ace-compressed":"ace","x-authorware-bin":["aab","x32","u32","vox"],"x-authorware-map":"aam","x-authorware-seg":"aas","x-blorb":["blb","blorb"],"x-bzip":"bz","x-bzip2":["bz2","boz"],"x-cfs-compressed":"cfs","x-chat":"chat","x-conference":"nsc","x-dgc-compressed":"dgc","x-dtbncx+xml":"ncx","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-eva":"eva","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-freearc":"arc","x-gca-compressed":"gca","x-glulx":"ulx","x-gramps-xml":"gramps","x-install-instructions":"install","x-lzh-compressed":["lzh","lha"],"x-mie":"mie","x-mobipocket-ebook":["prc","mobi"],"x-ms-application":"application","x-ms-shortcut":"lnk","x-ms-xbap":"xbap","x-msbinder":"obd","x-mscardfile":"crd","x-msclip":"clp","x-msdownload":["exe","dll","com","bat","msi"],"x-msmediaview":["mvb","m13","m14"],"x-msmetafile":["wmf","wmz","emf","emz"],"x-msmoney":"mny","x-mspublisher":"pub","x-msschedule":"scd","x-msterminal":"trm","x-mswrite":"wri","x-nzb":"nzb","x-pkcs12":["p12","pfx"],"x-pkcs7-certificates":["p7b","spc"],"x-research-info-systems":"ris","x-silverlight-app":"xap","x-sql":"sql","x-stuffitx":"sitx","x-subrip":"srt","x-t3vm-image":"t3","x-tads":"gam","x-tex":"tex","x-tex-tfm":"tfm","x-tgif":"obj","x-xliff+xml":"xlf","x-xz":"xz","x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"xaml+xml":"xaml","xcap-diff+xml":"xdf","xenc+xml":"xenc","xml-dtd":"dtd","xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xv+xml":["mxml","xhvml","xvml","xvm"],yang:"yang","yin+xml":"yin",envoy:"evy",fractals:"fif","internet-property-stream":"acx",olescript:"axs","vnd.ms-outlook":"msg","vnd.ms-pkicertstore":"sst","x-compress":"z","x-compressed":"tgz","x-gzip":"gz","x-perfmon":["pma","pmc","pml","pmr","pmw"],"x-pkcs7-mime":["p7c","p7m"],"ynd.ms-pkipko":"pko"},audio:{amr:"amr","amr-wb":"awb",annodex:"axa",basic:["au","snd"],flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"prs.sid":"sid","x-aiff":["aif","aiff","aifc"],"x-gsm":"gsm","x-ms-wma":"wma","x-ms-wax":"wax","x-pn-realaudio":"ram","x-realaudio":"ra","x-sd2":"sd2","x-wav":"wav",adpcm:"adp",mp4:"mp4a",s3m:"s3m",silk:"sil","vnd.dece.audio":["uva","uvva"],"vnd.digital-winds":"eol","vnd.dra":"dra","vnd.dts":"dts","vnd.dts.hd":"dtshd","vnd.lucent.voice":"lvp","vnd.ms-playready.media.pya":"pya","vnd.nuera.ecelp4800":"ecelp4800","vnd.nuera.ecelp7470":"ecelp7470","vnd.nuera.ecelp9600":"ecelp9600","vnd.rip":"rip",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},chemical:{"x-alchemy":"alc","x-cache":["cac","cache"],"x-cache-csf":"csf","x-cactvs-binary":["cbin","cascii","ctab"],"x-cdx":"cdx","x-chem3d":"c3d","x-cif":"cif","x-cmdf":"cmdf","x-cml":"cml","x-compass":"cpa","x-crossfire":"bsd","x-csml":["csml","csm"],"x-ctx":"ctx","x-cxf":["cxf","cef"],"x-embl-dl-nucleotide":["emb","embl"],"x-gamess-input":["inp","gam","gamin"],"x-gaussian-checkpoint":["fch","fchk"],"x-gaussian-cube":"cub","x-gaussian-input":["gau","gjc","gjf"],"x-gaussian-log":"gal","x-gcg8-sequence":"gcg","x-genbank":"gen","x-hin":"hin","x-isostar":["istr","ist"],"x-jcamp-dx":["jdx","dx"],"x-kinemage":"kin","x-macmolecule":"mcm","x-macromodel-input":["mmd","mmod"],"x-mdl-molfile":"mol","x-mdl-rdfile":"rd","x-mdl-rxnfile":"rxn","x-mdl-sdfile":["sd","sdf"],"x-mdl-tgf":"tgf","x-mmcif":"mcif","x-mol2":"mol2","x-molconn-Z":"b","x-mopac-graph":"gpt","x-mopac-input":["mop","mopcrt","mpc","zmt"],"x-mopac-out":"moo","x-ncbi-asn1":"asn","x-ncbi-asn1-ascii":["prt","ent"],"x-ncbi-asn1-binary":["val","aso"],"x-pdb":["pdb","ent"],"x-rosdal":"ros","x-swissprot":"sw","x-vamas-iso14976":"vms","x-vmd":"vmd","x-xtel":"xtel","x-xyz":"xyz"},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"vnd.djvu":["djvu","djv"],"vnd.wap.wbmp":"wbmp","x-canon-cr2":"cr2","x-canon-crw":"crw","x-cmu-raster":"ras","x-coreldraw":"cdr","x-coreldrawpattern":"pat","x-coreldrawtemplate":"cdt","x-corelphotopaint":"cpt","x-epson-erf":"erf","x-icon":"ico","x-jg":"art","x-jng":"jng","x-nikon-nef":"nef","x-olympus-orf":"orf","x-photoshop":"psd","x-portable-anymap":"pnm","x-portable-bitmap":"pbm","x-portable-graymap":"pgm","x-portable-pixmap":"ppm","x-rgb":"rgb","x-xbitmap":"xbm","x-xpixmap":"xpm","x-xwindowdump":"xwd",bmp:"bmp",cgm:"cgm",g3fax:"g3",ktx:"ktx","prs.btif":"btif",sgi:"sgi","vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"vnd.dwg":"dwg","vnd.dxf":"dxf","vnd.fastbidsheet":"fbs","vnd.fpx":"fpx","vnd.fst":"fst","vnd.fujixerox.edmics-mmr":"mmr","vnd.fujixerox.edmics-rlc":"rlc","vnd.ms-modi":"mdi","vnd.ms-photo":"wdp","vnd.net-fpx":"npx","vnd.xiff":"xif",webp:"webp","x-3ds":"3ds","x-cmx":"cmx","x-freehand":["fh","fhc","fh4","fh5","fh7"],"x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod",pipeg:"jfif"},message:{rfc822:["eml","mime","mht","mhtml","nws"]},model:{iges:["igs","iges"],mesh:["msh","mesh","silo"],vrml:["wrl","vrml"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"],"x3d+binary":["x3db","x3dbz"],"vnd.collada+xml":"dae","vnd.dwf":"dwf","vnd.gdl":"gdl","vnd.gtw":"gtw","vnd.mts":"mts","vnd.vtu":"vtu"},text:{"cache-manifest":["manifest","appcache"],calendar:["ics","icz","ifb"],css:"css",csv:"csv",h323:"323",html:["html","htm","shtml","stm"],iuls:"uls",mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx",scriptlet:["sct","wsc"],texmacs:["tm","ts"],"tab-separated-values":"tsv","vnd.sun.j2me.app-descriptor":"jad","vnd.wap.wml":"wml","vnd.wap.wmlscript":"wmls","x-bibtex":"bib","x-boo":"boo","x-c++hdr":["h++","hpp","hxx","hh"],"x-c++src":["c++","cpp","cxx","cc"],"x-component":"htc","x-dsrc":"d","x-diff":["diff","patch"],"x-haskell":"hs","x-java":"java","x-literate-haskell":"lhs","x-moc":"moc","x-pascal":["p","pas"],"x-pcs-gcd":"gcd","x-perl":["pl","pm"],"x-python":"py","x-scala":"scala","x-setext":"etx","x-tcl":["tcl","tk"],"x-tex":["tex","ltx","sty","cls"],"x-vcalendar":"vcs","x-vcard":"vcf",n3:"n3","prs.lines.tag":"dsc",sgml:["sgml","sgm"],troff:["t","tr","roff","man","me","ms"],turtle:"ttl","uri-list":["uri","uris","urls"],vcard:"vcard","vnd.curl":"curl","vnd.curl.dcurl":"dcurl","vnd.curl.scurl":"scurl","vnd.curl.mcurl":"mcurl","vnd.dvb.subtitle":"sub","vnd.fly":"fly","vnd.fmi.flexstor":"flx","vnd.graphviz":"gv","vnd.in3d.3dml":"3dml","vnd.in3d.spot":"spot","x-asm":["s","asm"],"x-c":["c","cc","cxx","cpp","h","hh","dic"],"x-fortran":["f","for","f77","f90"],"x-opml":"opml","x-nfo":"nfo","x-sfv":"sfv","x-uuencode":"uu",webviewhtml:"htt"},video:{avif:".avif","3gpp":"3gp",annodex:"axv",dl:"dl",dv:["dif","dv"],fli:"fli",gl:"gl",mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.dece.hd":["uvh","uvvh"],"vnd.dece.mobile":["uvm","uvvm"],"vnd.dece.pd":["uvp","uvvp"],"vnd.dece.sd":["uvs","uvvs"],"vnd.dece.video":["uvv","uvvv"],"vnd.dvb.file":"dvb","vnd.fvt":"fvt","vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"},"x-conference":{"x-cooltalk":"ice"},"x-world":{"x-vrml":["vrm","vrml","wrl","flr","wrz","xaf","xof"]}},vL=(()=>{let i={};for(let e in id)if(id.hasOwnProperty(e)){for(let t in id[e])if(id[e].hasOwnProperty(t)){let n=id[e][t];if(typeof n=="string")i[n]=e+"/"+t;else for(let r=0;r<n.length;r++)i[n[r]]=e+"/"+t}}return i})();var oT=[];for(let i=0;i<256;i++){let e=i;for(let t=0;t<8;t++)e&1?e=e>>>1^3988292384:e=e>>>1;oT[i]=e}var Bg=class{constructor(e){this.crc=e||-1}append(e){let t=this.crc|0;for(let n=0,r=e.length|0;n<r;n++)t=t>>>8^oT[(t^e[n])&255];this.crc=t}get(){return~this.crc}},Va=Bg;var Vg=J1;function J1(i){if(typeof TextEncoder>"u"){i=unescape(encodeURIComponent(i));let e=new Uint8Array(i.length);for(let t=0;t<e.length;t++)e[t]=i.charCodeAt(t);return e}else return new TextEncoder().encode(i)}var no={concat(i,e){if(i.length===0||e.length===0)return i.concat(e);let t=i[i.length-1],n=no.getPartial(t);return n===32?i.concat(e):no._shiftRight(e,n,t|0,i.slice(0,i.length-1))},bitLength(i){let e=i.length;if(e===0)return 0;let t=i[e-1];return(e-1)*32+no.getPartial(t)},clamp(i,e){if(i.length*32<e)return i;i=i.slice(0,Math.ceil(e/32));let t=i.length;return e=e&31,t>0&&e&&(i[t-1]=no.partial(e,i[t-1]&2147483648>>e-1,1)),i},partial(i,e,t){return i===32?e:(t?e|0:e<<32-i)+i*1099511627776},getPartial(i){return Math.round(i/1099511627776)||32},_shiftRight(i,e,t,n){for(n===void 0&&(n=[]);e>=32;e-=32)n.push(t),t=0;if(e===0)return n.concat(i);for(let a=0;a<i.length;a++)n.push(t|i[a]>>>e),t=i[a]<<32-e;let r=i.length?i[i.length-1]:0,o=no.getPartial(r);return n.push(no.partial(e+o&31,e+o>32?t:n.pop(),1)),n}},ad={bytes:{fromBits(i){let t=no.bitLength(i)/8,n=new Uint8Array(t),r;for(let o=0;o<t;o++)o&3||(r=i[o/4]),n[o]=r>>>24,r<<=8;return n},toBits(i){let e=[],t,n=0;for(t=0;t<i.length;t++)n=n<<8|i[t],(t&3)===3&&(e.push(n),n=0);return t&3&&e.push(no.partial(8*(t&3),n)),e}}},kg={};kg.sha1=function(i){i?(this._h=i._h.slice(0),this._buffer=i._buffer.slice(0),this._length=i._length):this.reset()};kg.sha1.prototype={blockSize:512,reset:function(){let i=this;return i._h=this._init.slice(0),i._buffer=[],i._length=0,i},update:function(i){let e=this;typeof i=="string"&&(i=ad.utf8String.toBits(i));let t=e._buffer=no.concat(e._buffer,i),n=e._length,r=e._length=n+no.bitLength(i);if(r>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");let o=new Uint32Array(t),a=0;for(let s=e.blockSize+n-(e.blockSize+n&e.blockSize-1);s<=r;s+=e.blockSize)e._block(o.subarray(16*a,16*(a+1))),a+=1;return t.splice(0,16*a),e},finalize:function(){let i=this,e=i._buffer,t=i._h;e=no.concat(e,[no.partial(1,1)]);for(let n=e.length+2;n&15;n++)e.push(0);for(e.push(Math.floor(i._length/4294967296)),e.push(i._length|0);e.length;)i._block(e.splice(0,16));return i.reset(),t},_init:[1732584193,4023233417,2562383102,271733878,3285377520],_key:[1518500249,1859775393,2400959708,3395469782],_f:function(i,e,t,n){if(i<=19)return e&t|~e&n;if(i<=39)return e^t^n;if(i<=59)return e&t|e&n|t&n;if(i<=79)return e^t^n},_S:function(i,e){return e<<i|e>>>32-i},_block:function(i){let e=this,t=e._h,n=Array(80);for(let d=0;d<16;d++)n[d]=i[d];let r=t[0],o=t[1],a=t[2],s=t[3],l=t[4];for(let d=0;d<=79;d++){d>=16&&(n[d]=e._S(1,n[d-3]^n[d-8]^n[d-14]^n[d-16]));let c=e._S(5,r)+e._f(d,o,a,s)+l+n[d]+e._key[Math.floor(d/20)]|0;l=s,s=a,a=e._S(30,o),o=r,r=c}t[0]=t[0]+r|0,t[1]=t[1]+o|0,t[2]=t[2]+a|0,t[3]=t[3]+s|0,t[4]=t[4]+l|0}};var Ug={};Ug.aes=class{constructor(i){let e=this;e._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],e._tables[0][0][0]||e._precompute();let t=e._tables[0][4],n=e._tables[1],r=i.length,o,a,s,l=1;if(r!==4&&r!==6&&r!==8)throw new Error("invalid aes key size");for(e._key=[a=i.slice(0),s=[]],o=r;o<4*r+28;o++){let d=a[o-1];(o%r===0||r===8&&o%r===4)&&(d=t[d>>>24]<<24^t[d>>16&255]<<16^t[d>>8&255]<<8^t[d&255],o%r===0&&(d=d<<8^d>>>24^l<<24,l=l<<1^(l>>7)*283)),a[o]=a[o-r]^d}for(let d=0;o;d++,o--){let c=a[d&3?o:o-4];o<=4||d<4?s[d]=c:s[d]=n[0][t[c>>>24]]^n[1][t[c>>16&255]]^n[2][t[c>>8&255]]^n[3][t[c&255]]}}encrypt(i){return this._crypt(i,0)}decrypt(i){return this._crypt(i,1)}_precompute(){let i=this._tables[0],e=this._tables[1],t=i[4],n=e[4],r=[],o=[],a,s,l,d;for(let c=0;c<256;c++)o[(r[c]=c<<1^(c>>7)*283)^c]=c;for(let c=a=0;!t[c];c^=s||1,a=o[a]||1){let p=a^a<<1^a<<2^a<<3^a<<4;p=p>>8^p&255^99,t[c]=p,n[p]=c,d=r[l=r[s=r[c]]];let u=d*16843009^l*65537^s*257^c*16843008,h=r[p]*257^p*16843008;for(let f=0;f<4;f++)i[f][c]=h=h<<24^h>>>8,e[f][p]=u=u<<24^u>>>8}for(let c=0;c<5;c++)i[c]=i[c].slice(0),e[c]=e[c].slice(0)}_crypt(i,e){if(i.length!==4)throw new Error("invalid aes block size");let t=this._key[e],n=t.length/4-2,r=[0,0,0,0],o=this._tables[e],a=o[0],s=o[1],l=o[2],d=o[3],c=o[4],p=i[0]^t[0],u=i[e?3:1]^t[1],h=i[2]^t[2],f=i[e?1:3]^t[3],_=4,m,A,y;for(let S=0;S<n;S++)m=a[p>>>24]^s[u>>16&255]^l[h>>8&255]^d[f&255]^t[_],A=a[u>>>24]^s[h>>16&255]^l[f>>8&255]^d[p&255]^t[_+1],y=a[h>>>24]^s[f>>16&255]^l[p>>8&255]^d[u&255]^t[_+2],f=a[f>>>24]^s[p>>16&255]^l[u>>8&255]^d[h&255]^t[_+3],_+=4,p=m,u=A,h=y;for(let S=0;S<4;S++)r[e?3&-S:S]=c[p>>>24]<<24^c[u>>16&255]<<16^c[h>>8&255]<<8^c[f&255]^t[_++],m=p,p=u,u=h,h=f,f=m;return r}};var iT={getRandomValues(i){let e=new Uint32Array(i.buffer),t=n=>{let r=987654321,o=4294967295;return function(){return r=36969*(r&65535)+(r>>16)&o,n=18e3*(n&65535)+(n>>16)&o,(((r<<16)+n&o)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let n=0,r;n<i.length;n+=4){let o=t((r||Math.random())*4294967296);r=o()*987654071,e[n/4]=o()*4294967296|0}return i}},Gg={};Gg.ctrGladman=class{constructor(i,e){this._prf=i,this._initIv=e,this._iv=e}reset(){this._iv=this._initIv}update(i){return this.calculate(this._prf,i,this._iv)}incWord(i){if((i>>24&255)===255){let e=i>>16&255,t=i>>8&255,n=i&255;e===255?(e=0,t===255?(t=0,n===255?n=0:++n):++t):++e,i=0,i+=e<<16,i+=t<<8,i+=n}else i+=1<<24;return i}incCounter(i){(i[0]=this.incWord(i[0]))===0&&(i[1]=this.incWord(i[1]))}calculate(i,e,t){let n;if(!(n=e.length))return[];let r=no.bitLength(e);for(let o=0;o<n;o+=4){this.incCounter(t);let a=i.encrypt(t);e[o]^=a[0],e[o+1]^=a[1],e[o+2]^=a[2],e[o+3]^=a[3]}return no.clamp(e,r)}};var wl={importKey(i){return new wl.hmacSha1(ad.bytes.toBits(i))},pbkdf2(i,e,t,n){if(t=t||1e4,n<0||t<0)throw new Error("invalid params to pbkdf2");let r=(n>>5)+1<<2,o,a,s,l,d,c=new ArrayBuffer(r),p=new DataView(c),u=0,h=no;for(e=ad.bytes.toBits(e),d=1;u<(r||1);d++){for(o=a=i.encrypt(h.concat(e,[d])),s=1;s<t;s++)for(a=i.encrypt(a),l=0;l<a.length;l++)o[l]^=a[l];for(s=0;u<(r||1)&&s<o.length;s++)p.setInt32(u,o[s]),u+=4}return c.slice(0,n/8)}};wl.hmacSha1=class{constructor(i){let e=this,t=e._hash=kg.sha1,n=[[],[]],r=t.prototype.blockSize/32;e._baseHash=[new t,new t],i.length>r&&(i=t.hash(i));for(let o=0;o<r;o++)n[0][o]=i[o]^909522486,n[1][o]=i[o]^1549556828;e._baseHash[0].update(n[0]),e._baseHash[1].update(n[1]),e._resultHash=new t(e._baseHash[0])}reset(){let i=this;i._resultHash=new i._hash(i._baseHash[0]),i._updated=!1}update(i){let e=this;e._updated=!0,e._resultHash.update(i)}digest(){let i=this,e=i._resultHash.finalize(),t=new i._hash(i._baseHash[1]).update(e).finalize();return i.reset(),t}encrypt(i){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(i),this.digest(i)}};var Rs="Invalid pasword",Nl=16,ew="raw",aT={name:"PBKDF2"},tw={name:"HMAC"},nw="SHA-1",rw=Object.assign({hash:tw},aT),sT=Object.assign({iterations:1e3,hash:{name:nw}},aT),ow=["deriveBits"],ld=[8,12,16],sd=[16,24,32],ka=10,lT=[0,0,0,0],Ip=typeof crypto<"u",cT=Ip&&typeof crypto.subtle<"u",Ui=ad.bytes,dT=Ug.aes,uT=Gg.ctrGladman,pT=wl.hmacSha1,bp=class{constructor(e,t,n){Object.assign(this,{password:e,signed:t,strength:n-1,pendingInput:new Uint8Array(0)})}async append(e){let t=this;if(t.password){let r=Mo(e,0,ld[t.strength]+2);await iw(t,r,t.password),t.password=null,t.aesCtrGladman=new uT(new dT(t.keys.key),Array.from(lT)),t.hmac=new pT(t.keys.authentication),e=Mo(e,ld[t.strength]+2)}let n=new Uint8Array(e.length-ka-(e.length-ka)%Nl);return hT(t,e,n,0,ka,!0)}flush(){let e=this,t=e.pendingInput,n=Mo(t,0,t.length-ka),r=Mo(t,t.length-ka),o=new Uint8Array(0);if(n.length){let s=Ui.toBits(n);e.hmac.update(s);let l=e.aesCtrGladman.update(s);o=Ui.fromBits(l)}let a=!0;if(e.signed){let s=Mo(Ui.fromBits(e.hmac.digest()),0,ka);for(let l=0;l<ka;l++)s[l]!=r[l]&&(a=!1)}return{valid:a,data:o}}},Tp=class{constructor(e,t){Object.assign(this,{password:e,strength:t-1,pendingInput:new Uint8Array(0)})}async append(e){let t=this,n=new Uint8Array(0);t.password&&(n=await aw(t,t.password),t.password=null,t.aesCtrGladman=new uT(new dT(t.keys.key),Array.from(lT)),t.hmac=new pT(t.keys.authentication));let r=new Uint8Array(n.length+e.length-e.length%Nl);return r.set(n,0),hT(t,e,r,n.length,0)}flush(){let e=this,t=new Uint8Array(0);if(e.pendingInput.length){let r=e.aesCtrGladman.update(Ui.toBits(e.pendingInput));e.hmac.update(r),t=Ui.fromBits(r)}let n=Mo(Ui.fromBits(e.hmac.digest()),0,ka);return{data:Hg(t,n),signature:n}}};function hT(i,e,t,n,r,o){let a=e.length-r;i.pendingInput.length&&(e=Hg(i.pendingInput,e),t=dw(t,a-a%Nl));let s;for(s=0;s<=a-Nl;s+=Nl){let l=Ui.toBits(Mo(e,s,s+Nl));o&&i.hmac.update(l);let d=i.aesCtrGladman.update(l);o||i.hmac.update(d),t.set(Ui.fromBits(d),s+n)}return i.pendingInput=Mo(e,s),t}async function iw(i,e,t){await mT(i,t,Mo(e,0,ld[i.strength]));let n=Mo(e,ld[i.strength]),r=i.keys.passwordVerification;if(r[0]!=n[0]||r[1]!=n[1])throw new Error(Rs)}async function aw(i,e){let t=sw(new Uint8Array(ld[i.strength]));return await mT(i,e,t),Hg(t,i.keys.passwordVerification)}async function mT(i,e,t){let n=Vg(e),r=await lw(ew,n,rw,!1,ow),o=await cw(Object.assign({salt:t},sT),r,8*(sd[i.strength]*2+2)),a=new Uint8Array(o);i.keys={key:Ui.toBits(Mo(a,0,sd[i.strength])),authentication:Ui.toBits(Mo(a,sd[i.strength],sd[i.strength]*2)),passwordVerification:Mo(a,sd[i.strength]*2)}}function sw(i){return Ip&&typeof crypto.getRandomValues=="function"?crypto.getRandomValues(i):iT.getRandomValues(i)}function lw(i,e,t,n,r){return Ip&&cT&&typeof crypto.subtle.importKey=="function"?crypto.subtle.importKey(i,e,t,n,r):wl.importKey(e)}async function cw(i,e,t){return Ip&&cT&&typeof crypto.subtle.deriveBits=="function"?await crypto.subtle.deriveBits(i,e,t):wl.pbkdf2(e,i.salt,sT.iterations,t)}function Hg(i,e){let t=i;return i.length+e.length&&(t=new Uint8Array(i.length+e.length),t.set(i,0),t.set(e,i.length)),t}function dw(i,e){if(e&&e>i.length){let t=i;i=new Uint8Array(e),i.set(t,0)}return i}function Mo(i,e,t){return i.subarray(e,t)}var Rl=12,vp=class{constructor(e,t){let n=this;Object.assign(n,{password:e,passwordVerification:t}),AT(n,e)}append(e){let t=this;if(t.password){let n=gT(t,e.subarray(0,Rl));if(t.password=null,n[Rl-1]!=t.passwordVerification)throw new Error(Rs);e=e.subarray(Rl)}return gT(t,e)}flush(){return{valid:!0,data:new Uint8Array(0)}}},Ep=class{constructor(e,t){let n=this;Object.assign(n,{password:e,passwordVerification:t}),AT(n,e)}append(e){let t=this,n,r;if(t.password){t.password=null;let o=crypto.getRandomValues(new Uint8Array(Rl));o[Rl-1]=t.passwordVerification,n=new Uint8Array(e.length+o.length),n.set(fT(t,o),0),r=Rl}else n=new Uint8Array(e.length),r=0;return n.set(fT(t,e),r),n}flush(){return{data:new Uint8Array(0)}}};function gT(i,e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=ST(i)^e[n],zg(i,t[n]);return t}function fT(i,e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=ST(i)^e[n],zg(i,e[n]);return t}function AT(i,e){i.keys=[305419896,591751049,878082192],i.crcKey0=new Va(i.keys[0]),i.crcKey2=new Va(i.keys[2]);for(let t=0;t<e.length;t++)zg(i,e.charCodeAt(t))}function zg(i,e){i.crcKey0.append([e]),i.keys[0]=~i.crcKey0.get(),i.keys[1]=_T(i.keys[1]+yT(i.keys[0])),i.keys[1]=_T(Math.imul(i.keys[1],134775813)+1),i.crcKey2.append([i.keys[1]>>>24]),i.keys[2]=~i.crcKey2.get()}function ST(i){let e=i.keys[2]|2;return yT(Math.imul(e,e^1)>>>8)}function yT(i){return i&255}function _T(i){return i&4294967295}var Kg="deflate",Cp="inflate",cd="Invalid signature",Wg=class{constructor(e,{signature:t,password:n,signed:r,compressed:o,zipCrypto:a,passwordVerification:s,encryptionStrength:l},{chunkSize:d}){let c=!!n;Object.assign(this,{signature:t,encrypted:c,signed:r,compressed:o,inflate:o&&new e({chunkSize:d}),crc32:r&&new Va,zipCrypto:a,decrypt:c&&a?new vp(n,s):new bp(n,r,l)})}async append(e){let t=this;return t.encrypted&&e.length&&(e=await t.decrypt.append(e)),t.compressed&&e.length&&(e=await t.inflate.append(e)),(!t.encrypted||t.zipCrypto)&&t.signed&&e.length&&t.crc32.append(e),e}async flush(){let e=this,t,n=new Uint8Array(0);if(e.encrypted){let r=e.decrypt.flush();if(!r.valid)throw new Error(cd);n=r.data}if((!e.encrypted||e.zipCrypto)&&e.signed){let r=new DataView(new Uint8Array(4).buffer);if(t=e.crc32.get(),r.setUint32(0,t),e.signature!=r.getUint32(0,!1))throw new Error(cd)}return e.compressed&&(n=await e.inflate.append(n)||new Uint8Array(0),await e.inflate.flush()),{data:n,signature:t}}},Qg=class{constructor(e,{encrypted:t,signed:n,compressed:r,level:o,zipCrypto:a,password:s,passwordVerification:l,encryptionStrength:d},{chunkSize:c}){Object.assign(this,{encrypted:t,signed:n,compressed:r,deflate:r&&new e({level:o||5,chunkSize:c}),crc32:n&&new Va,zipCrypto:a,encrypt:t&&a?new Ep(s,l):new Tp(s,d)})}async append(e){let t=this,n=e;return t.compressed&&e.length&&(n=await t.deflate.append(e)),t.encrypted&&n.length&&(n=await t.encrypt.append(n)),(!t.encrypted||t.zipCrypto)&&t.signed&&e.length&&t.crc32.append(e),n}async flush(){let e=this,t,n=new Uint8Array(0);if(e.compressed&&(n=await e.deflate.flush()||new Uint8Array(0)),e.encrypted){n=await e.encrypt.append(n);let r=e.encrypt.flush();t=r.signature;let o=new Uint8Array(n.length+r.data.length);o.set(n,0),o.set(r.data,n.length),n=o}return(!e.encrypted||e.zipCrypto)&&e.signed&&(t=e.crc32.get()),{data:n,signature:t}}};function bT(i,e,t){if(e.codecType.startsWith(Kg))return new Qg(i,e,t);if(e.codecType.startsWith(Cp))return new Wg(i,e,t)}var TT="init",IT="append",qg="flush",uw="message",vT=!0,wp=(i,e,t,n,r,o,a)=>(Object.assign(i,{busy:!0,codecConstructor:e,options:Object.assign({},t),scripts:a,terminate(){i.worker&&!i.busy&&(i.worker.terminate(),i.interface=null)},onTaskFinished(){i.busy=!1,r(i)}}),o?hw(i,n):pw(i,n));function pw(i,e){let t=bT(i.codecConstructor,i.options,e);return{async append(n){try{return await t.append(n)}catch(r){throw i.onTaskFinished(),r}},async flush(){try{return await t.flush()}finally{i.onTaskFinished()}},abort(){i.onTaskFinished()}}}function hw(i,e){let t,n={type:"module"};if(!i.interface){if(!vT)i.worker=r(n,e.baseURL);else try{i.worker=r({},e.baseURL)}catch{vT=!1,i.worker=r(n,e.baseURL)}i.worker.addEventListener(uw,s,!1),i.interface={append(l){return o({type:IT,data:l})},flush(){return o({type:qg})},abort(){i.onTaskFinished()}}}return i.interface;function r(l,d){let c,p;c=i.scripts[0],typeof c=="function"&&(c=c());try{p=new URL(c,d)}catch{p=c}return new Worker(p,l)}async function o(l){if(!t){let d=i.options,c=i.scripts.slice(1);await a({scripts:c,type:TT,options:d,config:{chunkSize:e.chunkSize}})}return a(l)}function a(l){let d=i.worker,c=new Promise((p,u)=>t={resolve:p,reject:u});try{if(l.data)try{l.data=l.data.buffer,d.postMessage(l,[l.data])}catch{d.postMessage(l)}else d.postMessage(l)}catch(p){t.reject(p),t=null,i.onTaskFinished()}return c}function s(l){let d=l.data;if(t){let c=d.error,p=d.type;if(c){let u=new Error(c.message);u.stack=c.stack,t.reject(u),t=null,i.onTaskFinished()}else if(p==TT||p==qg||p==IT){let u=d.data;p==qg?(t.resolve({data:new Uint8Array(u),signature:d.signature}),t=null,i.onTaskFinished()):t.resolve(u&&new Uint8Array(u))}}}}var Os=[],Yg=[];function Xg(i,e,t){let r=!(!e.compressed&&!e.signed&&!e.encrypted)&&(e.useWebWorkers||e.useWebWorkers===void 0&&t.useWebWorkers),o=r&&t.workerScripts?t.workerScripts[e.codecType]:[];if(Os.length<t.maxWorkers){let s={};return Os.push(s),wp(s,i,e,t,a,r,o)}else{let s=Os.find(l=>!l.busy);return s?(ET(s),wp(s,i,e,t,a,r,o)):new Promise(l=>Yg.push({resolve:l,codecConstructor:i,options:e,webWorker:r,scripts:o}))}function a(s){if(Yg.length){let[{resolve:l,codecConstructor:d,options:c,webWorker:p,scripts:u}]=Yg.splice(0,1);l(wp(s,d,c,t,a,p,u))}else s.worker?(ET(s),Number.isFinite(t.terminateWorkerTimeout)&&t.terminateWorkerTimeout>=0&&(s.terminateTimeout=setTimeout(()=>{Os=Os.filter(l=>l!=s),s.terminate()},t.terminateWorkerTimeout))):Os=Os.filter(l=>l!=s)}}function ET(i){i.terminateTimeout&&(clearTimeout(i.terminateTimeout),i.terminateTimeout=null)}var CT=i=>{if(typeof URL.createObjectURL=="function"){let e=()=>URL.createObjectURL(new Blob([`const{Array:t,Object:e,Math:n,Error:r,Uint8Array:i,Uint16Array:o,Uint32Array:s,Int32Array:f,DataView:c,TextEncoder:l,crypto:u,postMessage:a}=globalThis,w=[];for(let t=0;256>t;t++){let e=t;for(let t=0;8>t;t++)1&e?e=e>>>1^3988292384:e>>>=1;w[t]=e}class h{constructor(t){this.t=t||-1}append(t){let e=0|this.t;for(let n=0,r=0|t.length;r>n;n++)e=e>>>8^w[255&(e^t[n])];this.t=e}get(){return~this.t}}const d={concat(t,e){if(0===t.length||0===e.length)return t.concat(e);const n=t[t.length-1],r=d.i(n);return 32===r?t.concat(e):d.o(e,r,0|n,t.slice(0,t.length-1))},l(t){const e=t.length;if(0===e)return 0;const n=t[e-1];return 32*(e-1)+d.i(n)},u(t,e){if(32*t.length<e)return t;const r=(t=t.slice(0,n.ceil(e/32))).length;return e&=31,r>0&&e&&(t[r-1]=d.h(e,t[r-1]&2147483648>>e-1,1)),t},h:(t,e,n)=>32===t?e:(n?0|e:e<<32-t)+1099511627776*t,i:t=>n.round(t/1099511627776)||32,o(t,e,n,r){for(void 0===r&&(r=[]);e>=32;e-=32)r.push(n),n=0;if(0===e)return r.concat(t);for(let i=0;i<t.length;i++)r.push(n|t[i]>>>e),n=t[i]<<32-e;const i=t.length?t[t.length-1]:0,o=d.i(i);return r.push(d.h(e+o&31,e+o>32?n:r.pop(),1)),r}},p={p:{k(t){const e=d.l(t)/8,n=new i(e);let r;for(let i=0;e>i;i++)0==(3&i)&&(r=t[i/4]),n[i]=r>>>24,r<<=8;return n},g(t){const e=[];let n,r=0;for(n=0;n<t.length;n++)r=r<<8|t[n],3==(3&n)&&(e.push(r),r=0);return 3&n&&e.push(d.h(8*(3&n),r)),e}}},y={v:function(t){t?(this.m=t.m.slice(0),this.S=t.S.slice(0),this._=t._):this.reset()}};y.v.prototype={blockSize:512,reset:function(){const t=this;return t.m=this.I.slice(0),t.S=[],t._=0,t},update:function(t){const e=this;"string"==typeof t&&(t=p.A.g(t));const n=e.S=d.concat(e.S,t),i=e._,o=e._=i+d.l(t);if(o>9007199254740991)throw new r("Cannot hash more than 2^53 - 1 bits");const f=new s(n);let c=0;for(let t=e.blockSize+i-(e.blockSize+i&e.blockSize-1);o>=t;t+=e.blockSize)e.C(f.subarray(16*c,16*(c+1))),c+=1;return n.splice(0,16*c),e},V:function(){const t=this;let e=t.S;const r=t.m;e=d.concat(e,[d.h(1,1)]);for(let t=e.length+2;15&t;t++)e.push(0);for(e.push(n.floor(t._/4294967296)),e.push(0|t._);e.length;)t.C(e.splice(0,16));return t.reset(),r},I:[1732584193,4023233417,2562383102,271733878,3285377520],B:[1518500249,1859775393,2400959708,3395469782],D:(t,e,n,r)=>t>19?t>39?t>59?t>79?void 0:e^n^r:e&n|e&r|n&r:e^n^r:e&n|~e&r,U:(t,e)=>e<<t|e>>>32-t,C:function(e){const r=this,i=r.m,o=t(80);for(let t=0;16>t;t++)o[t]=e[t];let s=i[0],f=i[1],c=i[2],l=i[3],u=i[4];for(let t=0;79>=t;t++){16>t||(o[t]=r.U(1,o[t-3]^o[t-8]^o[t-14]^o[t-16]));const e=r.U(5,s)+r.D(t,f,c,l)+u+o[t]+r.B[n.floor(t/20)]|0;u=l,l=c,c=r.U(30,f),f=s,s=e}i[0]=i[0]+s|0,i[1]=i[1]+f|0,i[2]=i[2]+c|0,i[3]=i[3]+l|0,i[4]=i[4]+u|0}};const b={getRandomValues(t){const e=new s(t.buffer),r=t=>{let e=987654321;const r=4294967295;return()=>(e=36969*(65535&e)+(e>>16)&r,(((e<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r)/4294967296+.5)*(n.random()>.5?1:-1))};for(let i,o=0;o<t.length;o+=4){const t=r(4294967296*(i||n.random()));i=987654071*t(),e[o/4]=4294967296*t()|0}return t}},k={importKey:t=>new k.M(p.p.g(t)),P(t,e,n,i){if(n=n||1e4,0>i||0>n)throw new r("invalid params to pbkdf2");const o=1+(i>>5)<<2;let s,f,l,u,a;const w=new ArrayBuffer(o),h=new c(w);let y=0;const b=d;for(e=p.p.g(e),a=1;(o||1)>y;a++){for(s=f=t.encrypt(b.concat(e,[a])),l=1;n>l;l++)for(f=t.encrypt(f),u=0;u<f.length;u++)s[u]^=f[u];for(l=0;(o||1)>y&&l<s.length;l++)h.setInt32(y,s[l]),y+=4}return w.slice(0,i/8)},M:class{constructor(t){const e=this,n=e.R=y.v,r=[[],[]],i=n.prototype.blockSize/32;e.H=[new n,new n],t.length>i&&(t=n.hash(t));for(let e=0;i>e;e++)r[0][e]=909522486^t[e],r[1][e]=1549556828^t[e];e.H[0].update(r[0]),e.H[1].update(r[1]),e.K=new n(e.H[0])}reset(){const t=this;t.K=new t.R(t.H[0]),t.L=!1}update(t){this.L=!0,this.K.update(t)}digest(){const t=this,e=t.K.V(),n=new t.R(t.H[1]).update(e).V();return t.reset(),n}encrypt(t){if(this.L)throw new r("encrypt on already updated hmac called!");return this.update(t),this.digest(t)}}},g={name:"PBKDF2"},v=e.assign({hash:{name:"HMAC"}},g),m=e.assign({iterations:1e3,hash:{name:"SHA-1"}},g),S=["deriveBits"],z=[8,12,16],_=[16,24,32],I=[0,0,0,0],A=void 0!==u,C=A&&void 0!==u.subtle,V=p.p,B=class{constructor(t){const e=this;e.T=[[[],[],[],[],[]],[[],[],[],[],[]]],e.T[0][0][0]||e.j();const n=e.T[0][4],i=e.T[1],o=t.length;let s,f,c,l=1;if(4!==o&&6!==o&&8!==o)throw new r("invalid aes key size");for(e.B=[f=t.slice(0),c=[]],s=o;4*o+28>s;s++){let t=f[s-1];(s%o==0||8===o&&s%o==4)&&(t=n[t>>>24]<<24^n[t>>16&255]<<16^n[t>>8&255]<<8^n[255&t],s%o==0&&(t=t<<8^t>>>24^l<<24,l=l<<1^283*(l>>7))),f[s]=f[s-o]^t}for(let t=0;s;t++,s--){const e=f[3&t?s:s-4];c[t]=4>=s||4>t?e:i[0][n[e>>>24]]^i[1][n[e>>16&255]]^i[2][n[e>>8&255]]^i[3][n[255&e]]}}encrypt(t){return this.F(t,0)}decrypt(t){return this.F(t,1)}j(){const t=this.T[0],e=this.T[1],n=t[4],r=e[4],i=[],o=[];let s,f,c,l;for(let t=0;256>t;t++)o[(i[t]=t<<1^283*(t>>7))^t]=t;for(let u=s=0;!n[u];u^=f||1,s=o[s]||1){let o=s^s<<1^s<<2^s<<3^s<<4;o=o>>8^255&o^99,n[u]=o,r[o]=u,l=i[c=i[f=i[u]]];let a=16843009*l^65537*c^257*f^16843008*u,w=257*i[o]^16843008*o;for(let n=0;4>n;n++)t[n][u]=w=w<<24^w>>>8,e[n][o]=a=a<<24^a>>>8}for(let n=0;5>n;n++)t[n]=t[n].slice(0),e[n]=e[n].slice(0)}F(t,e){if(4!==t.length)throw new r("invalid aes block size");const n=this.B[e],i=n.length/4-2,o=[0,0,0,0],s=this.T[e],f=s[0],c=s[1],l=s[2],u=s[3],a=s[4];let w,h,d,p=t[0]^n[0],y=t[e?3:1]^n[1],b=t[2]^n[2],k=t[e?1:3]^n[3],g=4;for(let t=0;i>t;t++)w=f[p>>>24]^c[y>>16&255]^l[b>>8&255]^u[255&k]^n[g],h=f[y>>>24]^c[b>>16&255]^l[k>>8&255]^u[255&p]^n[g+1],d=f[b>>>24]^c[k>>16&255]^l[p>>8&255]^u[255&y]^n[g+2],k=f[k>>>24]^c[p>>16&255]^l[y>>8&255]^u[255&b]^n[g+3],g+=4,p=w,y=h,b=d;for(let t=0;4>t;t++)o[e?3&-t:t]=a[p>>>24]<<24^a[y>>16&255]<<16^a[b>>8&255]<<8^a[255&k]^n[g++],w=p,p=y,y=b,b=k,k=w;return o}},E=class{constructor(t,e){this.O=t,this.W=e,this.q=e}reset(){this.q=this.W}update(t){return this.G(this.O,t,this.q)}J(t){if(255==(t>>24&255)){let e=t>>16&255,n=t>>8&255,r=255&t;255===e?(e=0,255===n?(n=0,255===r?r=0:++r):++n):++e,t=0,t+=e<<16,t+=n<<8,t+=r}else t+=1<<24;return t}N(t){0===(t[0]=this.J(t[0]))&&(t[1]=this.J(t[1]))}G(t,e,n){let r;if(!(r=e.length))return[];const i=d.l(e);for(let i=0;r>i;i+=4){this.N(n);const r=t.encrypt(n);e[i]^=r[0],e[i+1]^=r[1],e[i+2]^=r[2],e[i+3]^=r[3]}return d.u(e,i)}},D=k.M;class U{constructor(t,n,r){e.assign(this,{password:t,signed:n,X:r-1,Y:new i(0)})}async append(e){const n=this;if(n.password){const i=K(e,0,z[n.X]+2);await(async(t,e,n)=>{await R(t,n,K(e,0,z[t.X]));const i=K(e,z[t.X]),o=t.keys.passwordVerification;if(o[0]!=i[0]||o[1]!=i[1])throw new r("Invalid pasword")})(n,i,n.password),n.password=null,n.Z=new E(new B(n.keys.key),t.from(I)),n.$=new D(n.keys.tt),e=K(e,z[n.X]+2)}return P(n,e,new i(e.length-10-(e.length-10)%16),0,10,!0)}flush(){const t=this,e=t.Y,n=K(e,0,e.length-10),r=K(e,e.length-10);let o=new i(0);if(n.length){const e=V.g(n);t.$.update(e);const r=t.Z.update(e);o=V.k(r)}let s=!0;if(t.signed){const e=K(V.k(t.$.digest()),0,10);for(let t=0;10>t;t++)e[t]!=r[t]&&(s=!1)}return{valid:s,data:o}}}class M{constructor(t,n){e.assign(this,{password:t,X:n-1,Y:new i(0)})}async append(e){const n=this;let r=new i(0);n.password&&(r=await(async(t,e)=>{const n=(r=new i(z[t.X]),A&&"function"==typeof u.getRandomValues?u.getRandomValues(r):b.getRandomValues(r));var r;return await R(t,e,n),H(n,t.keys.passwordVerification)})(n,n.password),n.password=null,n.Z=new E(new B(n.keys.key),t.from(I)),n.$=new D(n.keys.tt));const o=new i(r.length+e.length-e.length%16);return o.set(r,0),P(n,e,o,r.length,0)}flush(){const t=this;let e=new i(0);if(t.Y.length){const n=t.Z.update(V.g(t.Y));t.$.update(n),e=V.k(n)}const n=K(V.k(t.$.digest()),0,10);return{data:H(e,n),signature:n}}}function P(t,e,n,r,o,s){const f=e.length-o;let c;for(t.Y.length&&(e=H(t.Y,e),n=((t,e)=>{if(e&&e>t.length){const n=t;(t=new i(e)).set(n,0)}return t})(n,f-f%16)),c=0;f-16>=c;c+=16){const i=V.g(K(e,c,c+16));s&&t.$.update(i);const o=t.Z.update(i);s||t.$.update(o),n.set(V.k(o),c+r)}return t.Y=K(e,c),n}async function R(t,n,r){const o=(t=>{if(void 0===l){const e=new i((t=unescape(encodeURIComponent(t))).length);for(let n=0;n<e.length;n++)e[n]=t.charCodeAt(n);return e}return(new l).encode(t)})(n),s=await((t,e,n,r,i)=>A&&C&&"function"==typeof u.subtle.importKey?u.subtle.importKey("raw",e,n,!1,i):k.importKey(e))(0,o,v,0,S),f=await(async(t,e,n)=>A&&C&&"function"==typeof u.subtle.deriveBits?await u.subtle.deriveBits(t,e,n):k.P(e,t.salt,m.iterations,n))(e.assign({salt:r},m),s,8*(2*_[t.X]+2)),c=new i(f);t.keys={key:V.g(K(c,0,_[t.X])),tt:V.g(K(c,_[t.X],2*_[t.X])),passwordVerification:K(c,2*_[t.X])}}function H(t,e){let n=t;return t.length+e.length&&(n=new i(t.length+e.length),n.set(t,0),n.set(e,t.length)),n}function K(t,e,n){return t.subarray(e,n)}class L{constructor(t,n){e.assign(this,{password:t,passwordVerification:n}),F(this,t)}append(t){const e=this;if(e.password){const n=j(e,t.subarray(0,12));if(e.password=null,n[11]!=e.passwordVerification)throw new r("Invalid pasword");t=t.subarray(12)}return j(e,t)}flush(){return{valid:!0,data:new i(0)}}}class T{constructor(t,n){e.assign(this,{password:t,passwordVerification:n}),F(this,t)}append(t){const e=this;let n,r;if(e.password){e.password=null;const o=u.getRandomValues(new i(12));o[11]=e.passwordVerification,n=new i(t.length+o.length),n.set(x(e,o),0),r=12}else n=new i(t.length),r=0;return n.set(x(e,t),r),n}flush(){return{data:new i(0)}}}function j(t,e){const n=new i(e.length);for(let r=0;r<e.length;r++)n[r]=W(t)^e[r],O(t,n[r]);return n}function x(t,e){const n=new i(e.length);for(let r=0;r<e.length;r++)n[r]=W(t)^e[r],O(t,e[r]);return n}function F(t,e){t.keys=[305419896,591751049,878082192],t.et=new h(t.keys[0]),t.nt=new h(t.keys[2]);for(let n=0;n<e.length;n++)O(t,e.charCodeAt(n))}function O(t,e){t.et.append([e]),t.keys[0]=~t.et.get(),t.keys[1]=G(t.keys[1]+q(t.keys[0])),t.keys[1]=G(n.imul(t.keys[1],134775813)+1),t.nt.append([t.keys[1]>>>24]),t.keys[2]=~t.nt.get()}function W(t){const e=2|t.keys[2];return q(n.imul(e,1^e)>>>8)}function q(t){return 255&t}function G(t){return 4294967295&t}class J{constructor(t,{signature:n,password:r,signed:i,compressed:o,zipCrypto:s,passwordVerification:f,encryptionStrength:c},{rt:l}){const u=!!r;e.assign(this,{signature:n,encrypted:u,signed:i,compressed:o,it:o&&new t({rt:l}),ot:i&&new h,zipCrypto:s,decrypt:u&&s?new L(r,f):new U(r,i,c)})}async append(t){const e=this;return e.encrypted&&t.length&&(t=await e.decrypt.append(t)),e.compressed&&t.length&&(t=await e.it.append(t)),(!e.encrypted||e.zipCrypto)&&e.signed&&t.length&&e.ot.append(t),t}async flush(){const t=this;let e,n=new i(0);if(t.encrypted){const e=t.decrypt.flush();if(!e.valid)throw new r("Invalid signature");n=e.data}if((!t.encrypted||t.zipCrypto)&&t.signed){const n=new c(new i(4).buffer);if(e=t.ot.get(),n.setUint32(0,e),t.signature!=n.getUint32(0,!1))throw new r("Invalid signature")}return t.compressed&&(n=await t.it.append(n)||new i(0),await t.it.flush()),{data:n,signature:e}}}class N{constructor(t,{encrypted:n,signed:r,compressed:i,level:o,zipCrypto:s,password:f,passwordVerification:c,encryptionStrength:l},{rt:u}){e.assign(this,{encrypted:n,signed:r,compressed:i,st:i&&new t({level:o||5,rt:u}),ot:r&&new h,zipCrypto:s,encrypt:n&&s?new T(f,c):new M(f,l)})}async append(t){const e=this;let n=t;return e.compressed&&t.length&&(n=await e.st.append(t)),e.encrypted&&n.length&&(n=await e.encrypt.append(n)),(!e.encrypted||e.zipCrypto)&&e.signed&&t.length&&e.ot.append(t),n}async flush(){const t=this;let e,n=new i(0);if(t.compressed&&(n=await t.st.flush()||new i(0)),t.encrypted){n=await t.encrypt.append(n);const r=t.encrypt.flush();e=r.signature;const o=new i(n.length+r.data.length);o.set(n,0),o.set(r.data,n.length),n=o}return t.encrypted&&!t.zipCrypto||!t.signed||(e=t.ot.get()),{data:n,signature:e}}}const Q={init(t){t.scripts&&t.scripts.length&&importScripts.apply(void 0,t.scripts);const e=t.options;let n;self.initCodec&&self.initCodec(),e.codecType.startsWith("deflate")?n=self.Deflate:e.codecType.startsWith("inflate")&&(n=self.Inflate),X=((t,e,n)=>e.codecType.startsWith("deflate")?new N(t,e,n):e.codecType.startsWith("inflate")?new J(t,e,n):void 0)(n,e,t.config)},append:async t=>({data:await X.append(t.data)}),flush:()=>X.flush()};let X;function Y(e){return Z(e.map((([e,n])=>new t(e).fill(n,0,e))))}function Z(e){return e.reduce(((e,n)=>e.concat(t.isArray(n)?Z(n):n)),[])}addEventListener("message",(async t=>{const e=t.data,n=e.type,r=Q[n];if(r)try{e.data&&(e.data=new i(e.data));const t=await r(e)||{};if(t.type=n,t.data)try{t.data=t.data.buffer,a(t,[t.data])}catch(e){a(t)}else a(t)}catch(t){a({type:n,error:{message:t.message,stack:t.stack}})}}));const $=[0,1,2,3].concat(...Y([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function tt(){const t=this;function e(t,e){let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}t.ft=r=>{const i=t.ct,o=t.ut.lt,s=t.ut.wt;let f,c,l,u=-1;for(r.ht=0,r.dt=573,f=0;s>f;f++)0!==i[2*f]?(r.yt[++r.ht]=u=f,r.bt[f]=0):i[2*f+1]=0;for(;2>r.ht;)l=r.yt[++r.ht]=2>u?++u:0,i[2*l]=1,r.bt[l]=0,r.kt--,o&&(r.gt-=o[2*l+1]);for(t.vt=u,f=n.floor(r.ht/2);f>=1;f--)r.St(i,f);l=s;do{f=r.yt[1],r.yt[1]=r.yt[r.ht--],r.St(i,1),c=r.yt[1],r.yt[--r.dt]=f,r.yt[--r.dt]=c,i[2*l]=i[2*f]+i[2*c],r.bt[l]=n.max(r.bt[f],r.bt[c])+1,i[2*f+1]=i[2*c+1]=l,r.yt[1]=l++,r.St(i,1)}while(r.ht>=2);r.yt[--r.dt]=r.yt[1],(e=>{const n=t.ct,r=t.ut.lt,i=t.ut.zt,o=t.ut._t,s=t.ut.It;let f,c,l,u,a,w,h=0;for(u=0;15>=u;u++)e.At[u]=0;for(n[2*e.yt[e.dt]+1]=0,f=e.dt+1;573>f;f++)c=e.yt[f],u=n[2*n[2*c+1]+1]+1,u>s&&(u=s,h++),n[2*c+1]=u,c>t.vt||(e.At[u]++,a=0,o>c||(a=i[c-o]),w=n[2*c],e.kt+=w*(u+a),r&&(e.gt+=w*(r[2*c+1]+a)));if(0!==h){do{for(u=s-1;0===e.At[u];)u--;e.At[u]--,e.At[u+1]+=2,e.At[s]--,h-=2}while(h>0);for(u=s;0!==u;u--)for(c=e.At[u];0!==c;)l=e.yt[--f],l>t.vt||(n[2*l+1]!=u&&(e.kt+=(u-n[2*l+1])*n[2*l],n[2*l+1]=u),c--)}})(r),((t,n,r)=>{const i=[];let o,s,f,c=0;for(o=1;15>=o;o++)i[o]=c=c+r[o-1]<<1;for(s=0;n>=s;s++)f=t[2*s+1],0!==f&&(t[2*s]=e(i[f]++,f))})(i,t.vt,r.At)}}function et(t,e,n,r,i){const o=this;o.lt=t,o.zt=e,o._t=n,o.wt=r,o.It=i}tt.Ct=[0,1,2,3,4,5,6,7].concat(...Y([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]])),tt.Vt=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],tt.Bt=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],tt.Et=t=>256>t?$[t]:$[256+(t>>>7)],tt.Dt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],tt.Ut=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],tt.Mt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],tt.Pt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];const nt=Y([[144,8],[112,9],[24,7],[8,8]]);et.Rt=Z([12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227].map(((t,e)=>[t,nt[e]])));const rt=Y([[30,5]]);function it(t,e,n,r,i){const o=this;o.Ht=t,o.Kt=e,o.Lt=n,o.Tt=r,o.jt=i}et.xt=Z([0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23].map(((t,e)=>[t,rt[e]]))),et.Ft=new et(et.Rt,tt.Dt,257,286,15),et.Ot=new et(et.xt,tt.Ut,0,30,15),et.Wt=new et(null,tt.Mt,0,19,7);const ot=[new it(0,0,0,0,0),new it(4,4,8,4,1),new it(4,5,16,8,1),new it(4,6,32,32,1),new it(4,4,16,16,2),new it(8,16,32,32,2),new it(8,16,128,128,2),new it(8,32,128,256,2),new it(32,128,258,1024,2),new it(32,258,258,4096,2)],st=["need dictionary","stream end","","","stream error","data error","","buffer error","",""];function ft(t,e,n,r){const i=t[2*e],o=t[2*n];return o>i||i==o&&r[e]<=r[n]}function ct(){const t=this;let e,r,s,f,c,l,u,a,w,h,d,p,y,b,k,g,v,m,S,z,_,I,A,C,V,B,E,D,U,M,P,R,H;const K=new tt,L=new tt,T=new tt;let j,x,F,O,W,q;function G(){let e;for(e=0;286>e;e++)P[2*e]=0;for(e=0;30>e;e++)R[2*e]=0;for(e=0;19>e;e++)H[2*e]=0;P[512]=1,t.kt=t.gt=0,x=F=0}function J(t,e){let n,r=-1,i=t[1],o=0,s=7,f=4;0===i&&(s=138,f=3),t[2*(e+1)+1]=65535;for(let c=0;e>=c;c++)n=i,i=t[2*(c+1)+1],++o<s&&n==i||(f>o?H[2*n]+=o:0!==n?(n!=r&&H[2*n]++,H[32]++):o>10?H[36]++:H[34]++,o=0,r=n,0===i?(s=138,f=3):n==i?(s=6,f=3):(s=7,f=4))}function N(e){t.qt[t.pending++]=e}function Q(t){N(255&t),N(t>>>8&255)}function X(t,e){let n;const r=e;q>16-r?(n=t,W|=n<<q&65535,Q(W),W=n>>>16-q,q+=r-16):(W|=t<<q&65535,q+=r)}function Y(t,e){const n=2*t;X(65535&e[n],65535&e[n+1])}function Z(t,e){let n,r,i=-1,o=t[1],s=0,f=7,c=4;for(0===o&&(f=138,c=3),n=0;e>=n;n++)if(r=o,o=t[2*(n+1)+1],++s>=f||r!=o){if(c>s)do{Y(r,H)}while(0!=--s);else 0!==r?(r!=i&&(Y(r,H),s--),Y(16,H),X(s-3,2)):s>10?(Y(18,H),X(s-11,7)):(Y(17,H),X(s-3,3));s=0,i=r,0===o?(f=138,c=3):r==o?(f=6,c=3):(f=7,c=4)}}function $(){16==q?(Q(W),W=0,q=0):8>q||(N(255&W),W>>>=8,q-=8)}function nt(e,r){let i,o,s;if(t.Gt[x]=e,t.Jt[x]=255&r,x++,0===e?P[2*r]++:(F++,e--,P[2*(tt.Ct[r]+256+1)]++,R[2*tt.Et(e)]++),0==(8191&x)&&E>2){for(i=8*x,o=_-v,s=0;30>s;s++)i+=R[2*s]*(5+tt.Ut[s]);if(i>>>=3,F<n.floor(x/2)&&i<n.floor(o/2))return!0}return x==j-1}function rt(e,n){let r,i,o,s,f=0;if(0!==x)do{r=t.Gt[f],i=t.Jt[f],f++,0===r?Y(i,e):(o=tt.Ct[i],Y(o+256+1,e),s=tt.Dt[o],0!==s&&(i-=tt.Vt[o],X(i,s)),r--,o=tt.Et(r),Y(o,n),s=tt.Ut[o],0!==s&&(r-=tt.Bt[o],X(r,s)))}while(x>f);Y(256,e),O=e[513]}function it(){q>8?Q(W):q>0&&N(255&W),W=0,q=0}function ct(e,n,r){X(0+(r?1:0),3),((e,n)=>{it(),O=8,Q(n),Q(~n),t.qt.set(a.subarray(e,e+n),t.pending),t.pending+=n})(e,n)}function lt(n){((e,n,r)=>{let i,o,s=0;E>0?(K.ft(t),L.ft(t),s=(()=>{let e;for(J(P,K.vt),J(R,L.vt),T.ft(t),e=18;e>=3&&0===H[2*tt.Pt[e]+1];e--);return t.kt+=14+3*(e+1),e})(),i=t.kt+3+7>>>3,o=t.gt+3+7>>>3,o>i||(i=o)):i=o=n+5,n+4>i||-1==e?o==i?(X(2+(r?1:0),3),rt(et.Rt,et.xt)):(X(4+(r?1:0),3),((t,e,n)=>{let r;for(X(t-257,5),X(e-1,5),X(n-4,4),r=0;n>r;r++)X(H[2*tt.Pt[r]+1],3);Z(P,t-1),Z(R,e-1)})(K.vt+1,L.vt+1,s+1),rt(P,R)):ct(e,n,r),G(),r&&it()})(0>v?-1:v,_-v,n),v=_,e.Nt()}function ut(){let t,n,r,i;do{if(i=w-A-_,0===i&&0===_&&0===A)i=c;else if(-1==i)i--;else if(_>=c+c-262){a.set(a.subarray(c,c+c),0),I-=c,_-=c,v-=c,t=y,r=t;do{n=65535&d[--r],d[r]=c>n?0:n-c}while(0!=--t);t=c,r=t;do{n=65535&h[--r],h[r]=c>n?0:n-c}while(0!=--t);i+=c}if(0===e.Qt)return;t=e.Xt(a,_+A,i),A+=t,3>A||(p=255&a[_],p=(p<<g^255&a[_+1])&k)}while(262>A&&0!==e.Qt)}function at(t){let e,n,r=V,i=_,o=C;const s=_>c-262?_-(c-262):0;let f=M;const l=u,w=_+258;let d=a[i+o-1],p=a[i+o];U>C||(r>>=2),f>A&&(f=A);do{if(e=t,a[e+o]==p&&a[e+o-1]==d&&a[e]==a[i]&&a[++e]==a[i+1]){i+=2,e++;do{}while(a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&w>i);if(n=258-(w-i),i=w-258,n>o){if(I=t,o=n,n>=f)break;d=a[i+o-1],p=a[i+o]}}}while((t=65535&h[t&l])>s&&0!=--r);return o>A?A:o}t.bt=[],t.At=[],t.yt=[],P=[],R=[],H=[],t.St=(e,n)=>{const r=t.yt,i=r[n];let o=n<<1;for(;o<=t.ht&&(o<t.ht&&ft(e,r[o+1],r[o],t.bt)&&o++,!ft(e,i,r[o],t.bt));)r[n]=r[o],n=o,o<<=1;r[n]=i},t.Yt=(e,S,I,x,F,J)=>(x||(x=8),F||(F=8),J||(J=0),e.Zt=null,-1==S&&(S=6),1>F||F>9||8!=x||9>I||I>15||0>S||S>9||0>J||J>2?-2:(e.$t=t,l=I,c=1<<l,u=c-1,b=F+7,y=1<<b,k=y-1,g=n.floor((b+3-1)/3),a=new i(2*c),h=[],d=[],j=1<<F+6,t.qt=new i(4*j),s=4*j,t.Gt=new o(j),t.Jt=new i(j),E=S,D=J,(e=>(e.te=e.ee=0,e.Zt=null,t.pending=0,t.ne=0,r=113,f=0,K.ct=P,K.ut=et.Ft,L.ct=R,L.ut=et.Ot,T.ct=H,T.ut=et.Wt,W=0,q=0,O=8,G(),(()=>{w=2*c,d[y-1]=0;for(let t=0;y-1>t;t++)d[t]=0;B=ot[E].Kt,U=ot[E].Ht,M=ot[E].Lt,V=ot[E].Tt,_=0,v=0,A=0,m=C=2,z=0,p=0})(),0))(e))),t.re=()=>42!=r&&113!=r&&666!=r?-2:(t.Jt=null,t.Gt=null,t.qt=null,d=null,h=null,a=null,t.$t=null,113==r?-3:0),t.ie=(t,e,n)=>{let r=0;return-1==e&&(e=6),0>e||e>9||0>n||n>2?-2:(ot[E].jt!=ot[e].jt&&0!==t.te&&(r=t.st(1)),E!=e&&(E=e,B=ot[E].Kt,U=ot[E].Ht,M=ot[E].Lt,V=ot[E].Tt),D=n,r)},t.oe=(t,e,n)=>{let i,o=n,s=0;if(!e||42!=r)return-2;if(3>o)return 0;for(o>c-262&&(o=c-262,s=n-o),a.set(e.subarray(s,s+o),0),_=o,v=o,p=255&a[0],p=(p<<g^255&a[1])&k,i=0;o-3>=i;i++)p=(p<<g^255&a[i+2])&k,h[i&u]=d[p],d[p]=i;return 0},t.st=(n,i)=>{let o,w,b,V,U;if(i>4||0>i)return-2;if(!n.se||!n.fe&&0!==n.Qt||666==r&&4!=i)return n.Zt=st[4],-2;if(0===n.ce)return n.Zt=st[7],-5;var M;if(e=n,V=f,f=i,42==r&&(w=8+(l-8<<4)<<8,b=(E-1&255)>>1,b>3&&(b=3),w|=b<<6,0!==_&&(w|=32),w+=31-w%31,r=113,N((M=w)>>8&255),N(255&M)),0!==t.pending){if(e.Nt(),0===e.ce)return f=-1,0}else if(0===e.Qt&&V>=i&&4!=i)return e.Zt=st[7],-5;if(666==r&&0!==e.Qt)return n.Zt=st[7],-5;if(0!==e.Qt||0!==A||0!=i&&666!=r){switch(U=-1,ot[E].jt){case 0:U=(t=>{let n,r=65535;for(r>s-5&&(r=s-5);;){if(1>=A){if(ut(),0===A&&0==t)return 0;if(0===A)break}if(_+=A,A=0,n=v+r,(0===_||_>=n)&&(A=_-n,_=n,lt(!1),0===e.ce))return 0;if(_-v>=c-262&&(lt(!1),0===e.ce))return 0}return lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i);break;case 1:U=(t=>{let n,r=0;for(;;){if(262>A){if(ut(),262>A&&0==t)return 0;if(0===A)break}if(3>A||(p=(p<<g^255&a[_+2])&k,r=65535&d[p],h[_&u]=d[p],d[p]=_),0===r||(_-r&65535)>c-262||2!=D&&(m=at(r)),3>m)n=nt(0,255&a[_]),A--,_++;else if(n=nt(_-I,m-3),A-=m,m>B||3>A)_+=m,m=0,p=255&a[_],p=(p<<g^255&a[_+1])&k;else{m--;do{_++,p=(p<<g^255&a[_+2])&k,r=65535&d[p],h[_&u]=d[p],d[p]=_}while(0!=--m);_++}if(n&&(lt(!1),0===e.ce))return 0}return lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i);break;case 2:U=(t=>{let n,r,i=0;for(;;){if(262>A){if(ut(),262>A&&0==t)return 0;if(0===A)break}if(3>A||(p=(p<<g^255&a[_+2])&k,i=65535&d[p],h[_&u]=d[p],d[p]=_),C=m,S=I,m=2,0!==i&&B>C&&c-262>=(_-i&65535)&&(2!=D&&(m=at(i)),5>=m&&(1==D||3==m&&_-I>4096)&&(m=2)),3>C||m>C)if(0!==z){if(n=nt(0,255&a[_-1]),n&&lt(!1),_++,A--,0===e.ce)return 0}else z=1,_++,A--;else{r=_+A-3,n=nt(_-1-S,C-3),A-=C-1,C-=2;do{++_>r||(p=(p<<g^255&a[_+2])&k,i=65535&d[p],h[_&u]=d[p],d[p]=_)}while(0!=--C);if(z=0,m=2,_++,n&&(lt(!1),0===e.ce))return 0}}return 0!==z&&(n=nt(0,255&a[_-1]),z=0),lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i)}if(2!=U&&3!=U||(r=666),0==U||2==U)return 0===e.ce&&(f=-1),0;if(1==U){if(1==i)X(2,3),Y(256,et.Rt),$(),9>1+O+10-q&&(X(2,3),Y(256,et.Rt),$()),O=7;else if(ct(0,0,!1),3==i)for(o=0;y>o;o++)d[o]=0;if(e.Nt(),0===e.ce)return f=-1,0}}return 4!=i?0:1}}function lt(){const t=this;t.le=0,t.ue=0,t.Qt=0,t.te=0,t.ce=0,t.ee=0}function ut(t){const e=new lt,o=(s=t&&t.rt?t.rt:65536)+5*(n.floor(s/16383)+1);var s;const f=new i(o);let c=t?t.level:-1;void 0===c&&(c=-1),e.Yt(c),e.se=f,this.append=(t,n)=>{let s,c,l=0,u=0,a=0;const w=[];if(t.length){e.le=0,e.fe=t,e.Qt=t.length;do{if(e.ue=0,e.ce=o,s=e.st(0),0!=s)throw new r("deflating: "+e.Zt);e.ue&&(e.ue==o?w.push(new i(f)):w.push(f.slice(0,e.ue))),a+=e.ue,n&&e.le>0&&e.le!=l&&(n(e.le),l=e.le)}while(e.Qt>0||0===e.ce);return w.length>1?(c=new i(a),w.forEach((t=>{c.set(t,u),u+=t.length}))):c=w[0]||new i(0),c}},this.flush=()=>{let t,n,s=0,c=0;const l=[];do{if(e.ue=0,e.ce=o,t=e.st(4),1!=t&&0!=t)throw new r("deflating: "+e.Zt);o-e.ce>0&&l.push(f.slice(0,e.ue)),c+=e.ue}while(e.Qt>0||0===e.ce);return e.re(),n=new i(c),l.forEach((t=>{n.set(t,s),s+=t.length})),n}}lt.prototype={Yt:function(t,e){const n=this;return n.$t=new ct,e||(e=15),n.$t.Yt(n,t,e)},st:function(t){const e=this;return e.$t?e.$t.st(e,t):-2},re:function(){const t=this;if(!t.$t)return-2;const e=t.$t.re();return t.$t=null,e},ie:function(t,e){const n=this;return n.$t?n.$t.ie(n,t,e):-2},oe:function(t,e){const n=this;return n.$t?n.$t.oe(n,t,e):-2},Xt:function(t,e,n){const r=this;let i=r.Qt;return i>n&&(i=n),0===i?0:(r.Qt-=i,t.set(r.fe.subarray(r.le,r.le+i),e),r.le+=i,r.te+=i,i)},Nt:function(){const t=this;let e=t.$t.pending;e>t.ce&&(e=t.ce),0!==e&&(t.se.set(t.$t.qt.subarray(t.$t.ne,t.$t.ne+e),t.ue),t.ue+=e,t.$t.ne+=e,t.ee+=e,t.ce-=e,t.$t.pending-=e,0===t.$t.pending&&(t.$t.ne=0))}};const at=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],wt=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],ht=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],dt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],pt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],yt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],bt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function kt(){let t,e,n,r,i,o;function s(t,e,s,f,c,l,u,a,w,h,d){let p,y,b,k,g,v,m,S,z,_,I,A,C,V,B;_=0,g=s;do{n[t[e+_]]++,_++,g--}while(0!==g);if(n[0]==s)return u[0]=-1,a[0]=0,0;for(S=a[0],v=1;15>=v&&0===n[v];v++);for(m=v,v>S&&(S=v),g=15;0!==g&&0===n[g];g--);for(b=g,S>g&&(S=g),a[0]=S,V=1<<v;g>v;v++,V<<=1)if(0>(V-=n[v]))return-3;if(0>(V-=n[g]))return-3;for(n[g]+=V,o[1]=v=0,_=1,C=2;0!=--g;)o[C]=v+=n[_],C++,_++;g=0,_=0;do{0!==(v=t[e+_])&&(d[o[v]++]=g),_++}while(++g<s);for(s=o[b],o[0]=g=0,_=0,k=-1,A=-S,i[0]=0,I=0,B=0;b>=m;m++)for(p=n[m];0!=p--;){for(;m>A+S;){if(k++,A+=S,B=b-A,B=B>S?S:B,(y=1<<(v=m-A))>p+1&&(y-=p+1,C=m,B>v))for(;++v<B&&(y<<=1)>n[++C];)y-=n[C];if(B=1<<v,h[0]+B>1440)return-3;i[k]=I=h[0],h[0]+=B,0!==k?(o[k]=g,r[0]=v,r[1]=S,v=g>>>A-S,r[2]=I-i[k-1]-v,w.set(r,3*(i[k-1]+v))):u[0]=I}for(r[1]=m-A,s>_?d[_]<f?(r[0]=256>d[_]?0:96,r[2]=d[_++]):(r[0]=l[d[_]-f]+16+64,r[2]=c[d[_++]-f]):r[0]=192,y=1<<m-A,v=g>>>A;B>v;v+=y)w.set(r,3*(I+v));for(v=1<<m-1;0!=(g&v);v>>>=1)g^=v;for(g^=v,z=(1<<A)-1;(g&z)!=o[k];)k--,A-=S,z=(1<<A)-1}return 0!==V&&1!=b?-5:0}function c(s){let c;for(t||(t=[],e=[],n=new f(16),r=[],i=new f(15),o=new f(16)),e.length<s&&(e=[]),c=0;s>c;c++)e[c]=0;for(c=0;16>c;c++)n[c]=0;for(c=0;3>c;c++)r[c]=0;i.set(n.subarray(0,15),0),o.set(n.subarray(0,16),0)}this.ae=(n,r,i,o,f)=>{let l;return c(19),t[0]=0,l=s(n,0,19,19,null,null,i,r,o,t,e),-3==l?f.Zt="oversubscribed dynamic bit lengths tree":-5!=l&&0!==r[0]||(f.Zt="incomplete dynamic bit lengths tree",l=-3),l},this.we=(n,r,i,o,f,l,u,a,w)=>{let h;return c(288),t[0]=0,h=s(i,0,n,257,dt,pt,l,o,a,t,e),0!=h||0===o[0]?(-3==h?w.Zt="oversubscribed literal/length tree":-4!=h&&(w.Zt="incomplete literal/length tree",h=-3),h):(c(288),h=s(i,n,r,0,yt,bt,u,f,a,t,e),0!=h||0===f[0]&&n>257?(-3==h?w.Zt="oversubscribed distance tree":-5==h?(w.Zt="incomplete distance tree",h=-3):-4!=h&&(w.Zt="empty distance tree with lengths",h=-3),h):0)}}function gt(){const t=this;let e,n,r,i,o=0,s=0,f=0,c=0,l=0,u=0,a=0,w=0,h=0,d=0;function p(t,e,n,r,i,o,s,f){let c,l,u,a,w,h,d,p,y,b,k,g,v,m,S,z;d=f.le,p=f.Qt,w=s.he,h=s.de,y=s.write,b=y<s.read?s.read-y-1:s.end-y,k=at[t],g=at[e];do{for(;20>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;if(c=w&k,l=n,u=r,z=3*(u+c),0!==(a=l[z]))for(;;){if(w>>=l[z+1],h-=l[z+1],0!=(16&a)){for(a&=15,v=l[z+2]+(w&at[a]),w>>=a,h-=a;15>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;for(c=w&g,l=i,u=o,z=3*(u+c),a=l[z];;){if(w>>=l[z+1],h-=l[z+1],0!=(16&a)){for(a&=15;a>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;if(m=l[z+2]+(w&at[a]),w>>=a,h-=a,b-=v,m>y){S=y-m;do{S+=s.end}while(0>S);if(a=s.end-S,v>a){if(v-=a,y-S>0&&a>y-S)do{s.ye[y++]=s.ye[S++]}while(0!=--a);else s.ye.set(s.ye.subarray(S,S+a),y),y+=a,S+=a,a=0;S=0}}else S=y-m,y-S>0&&2>y-S?(s.ye[y++]=s.ye[S++],s.ye[y++]=s.ye[S++],v-=2):(s.ye.set(s.ye.subarray(S,S+2),y),y+=2,S+=2,v-=2);if(y-S>0&&v>y-S)do{s.ye[y++]=s.ye[S++]}while(0!=--v);else s.ye.set(s.ye.subarray(S,S+v),y),y+=v,S+=v,v=0;break}if(0!=(64&a))return f.Zt="invalid distance code",v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,-3;c+=l[z+2],c+=w&at[a],z=3*(u+c),a=l[z]}break}if(0!=(64&a))return 0!=(32&a)?(v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,1):(f.Zt="invalid literal/length code",v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,-3);if(c+=l[z+2],c+=w&at[a],z=3*(u+c),0===(a=l[z])){w>>=l[z+1],h-=l[z+1],s.ye[y++]=l[z+2],b--;break}}else w>>=l[z+1],h-=l[z+1],s.ye[y++]=l[z+2],b--}while(b>=258&&p>=10);return v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,0}t.init=(t,o,s,f,c,l)=>{e=0,a=t,w=o,r=s,h=f,i=c,d=l,n=null},t.be=(t,y,b)=>{let k,g,v,m,S,z,_,I=0,A=0,C=0;for(C=y.le,m=y.Qt,I=t.he,A=t.de,S=t.write,z=S<t.read?t.read-S-1:t.end-S;;)switch(e){case 0:if(z>=258&&m>=10&&(t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,b=p(a,w,r,h,i,d,t,y),C=y.le,m=y.Qt,I=t.he,A=t.de,S=t.write,z=S<t.read?t.read-S-1:t.end-S,0!=b)){e=1==b?7:9;break}f=a,n=r,s=h,e=1;case 1:for(k=f;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}if(g=3*(s+(I&at[k])),I>>>=n[g+1],A-=n[g+1],v=n[g],0===v){c=n[g+2],e=6;break}if(0!=(16&v)){l=15&v,o=n[g+2],e=2;break}if(0==(64&v)){f=v,s=g/3+n[g+2];break}if(0!=(32&v)){e=7;break}return e=9,y.Zt="invalid literal/length code",b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 2:for(k=l;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}o+=I&at[k],I>>=k,A-=k,f=w,n=i,s=d,e=3;case 3:for(k=f;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}if(g=3*(s+(I&at[k])),I>>=n[g+1],A-=n[g+1],v=n[g],0!=(16&v)){l=15&v,u=n[g+2],e=4;break}if(0==(64&v)){f=v,s=g/3+n[g+2];break}return e=9,y.Zt="invalid distance code",b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 4:for(k=l;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}u+=I&at[k],I>>=k,A-=k,e=5;case 5:for(_=S-u;0>_;)_+=t.end;for(;0!==o;){if(0===z&&(S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z&&(t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z)))return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);t.ye[S++]=t.ye[_++],z--,_==t.end&&(_=0),o--}e=0;break;case 6:if(0===z&&(S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z&&(t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z)))return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,t.ye[S++]=c,z--,e=0;break;case 7:if(A>7&&(A-=8,m++,C--),t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,t.read!=t.write)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);e=8;case 8:return b=1,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 9:return b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);default:return b=-2,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b)}},t.ge=()=>{}}kt.ve=(t,e,n,r)=>(t[0]=9,e[0]=5,n[0]=wt,r[0]=ht,0);const vt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function mt(t,e){const n=this;let r,o=0,s=0,c=0,l=0;const u=[0],a=[0],w=new gt;let h=0,d=new f(4320);const p=new kt;n.de=0,n.he=0,n.ye=new i(e),n.end=e,n.read=0,n.write=0,n.reset=(t,e)=>{e&&(e[0]=0),6==o&&w.ge(t),o=0,n.de=0,n.he=0,n.read=n.write=0},n.reset(t,null),n.ke=(t,e)=>{let r,i,o;return i=t.ue,o=n.read,r=(o>n.write?n.end:n.write)-o,r>t.ce&&(r=t.ce),0!==r&&-5==e&&(e=0),t.ce-=r,t.ee+=r,t.se.set(n.ye.subarray(o,o+r),i),i+=r,o+=r,o==n.end&&(o=0,n.write==n.end&&(n.write=0),r=n.write-o,r>t.ce&&(r=t.ce),0!==r&&-5==e&&(e=0),t.ce-=r,t.ee+=r,t.se.set(n.ye.subarray(o,o+r),i),i+=r,o+=r),t.ue=i,n.read=o,e},n.be=(t,e)=>{let i,f,y,b,k,g,v,m;for(b=t.le,k=t.Qt,f=n.he,y=n.de,g=n.write,v=g<n.read?n.read-g-1:n.end-g;;){let S,z,_,I,A,C,V,B;switch(o){case 0:for(;3>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}switch(i=7&f,h=1&i,i>>>1){case 0:f>>>=3,y-=3,i=7&y,f>>>=i,y-=i,o=1;break;case 1:S=[],z=[],_=[[]],I=[[]],kt.ve(S,z,_,I),w.init(S[0],z[0],_[0],0,I[0],0),f>>>=3,y-=3,o=6;break;case 2:f>>>=3,y-=3,o=3;break;case 3:return f>>>=3,y-=3,o=9,t.Zt="invalid block type",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e)}break;case 1:for(;32>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if((~f>>>16&65535)!=(65535&f))return o=9,t.Zt="invalid stored block lengths",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);s=65535&f,f=y=0,o=0!==s?2:0!==h?7:0;break;case 2:if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(0===v&&(g==n.end&&0!==n.read&&(g=0,v=g<n.read?n.read-g-1:n.end-g),0===v&&(n.write=g,e=n.ke(t,e),g=n.write,v=g<n.read?n.read-g-1:n.end-g,g==n.end&&0!==n.read&&(g=0,v=g<n.read?n.read-g-1:n.end-g),0===v)))return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(e=0,i=s,i>k&&(i=k),i>v&&(i=v),n.ye.set(t.Xt(b,i),g),b+=i,k-=i,g+=i,v-=i,0!=(s-=i))break;o=0!==h?7:0;break;case 3:for(;14>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(c=i=16383&f,(31&i)>29||(i>>5&31)>29)return o=9,t.Zt="too many length or distance symbols",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(i=258+(31&i)+(i>>5&31),!r||r.length<i)r=[];else for(m=0;i>m;m++)r[m]=0;f>>>=14,y-=14,l=0,o=4;case 4:for(;4+(c>>>10)>l;){for(;3>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}r[vt[l++]]=7&f,f>>>=3,y-=3}for(;19>l;)r[vt[l++]]=0;if(u[0]=7,i=p.ae(r,u,a,d,t),0!=i)return-3==(e=i)&&(r=null,o=9),n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);l=0,o=5;case 5:for(;i=c,258+(31&i)+(i>>5&31)>l;){let s,w;for(i=u[0];i>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(i=d[3*(a[0]+(f&at[i]))+1],w=d[3*(a[0]+(f&at[i]))+2],16>w)f>>>=i,y-=i,r[l++]=w;else{for(m=18==w?7:w-14,s=18==w?11:3;i+m>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(f>>>=i,y-=i,s+=f&at[m],f>>>=m,y-=m,m=l,i=c,m+s>258+(31&i)+(i>>5&31)||16==w&&1>m)return r=null,o=9,t.Zt="invalid bit length repeat",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);w=16==w?r[m-1]:0;do{r[m++]=w}while(0!=--s);l=m}}if(a[0]=-1,A=[],C=[],V=[],B=[],A[0]=9,C[0]=6,i=c,i=p.we(257+(31&i),1+(i>>5&31),r,A,C,V,B,d,t),0!=i)return-3==i&&(r=null,o=9),e=i,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);w.init(A[0],C[0],d,V[0],d,B[0]),o=6;case 6:if(n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,1!=(e=w.be(n,t,e)))return n.ke(t,e);if(e=0,w.ge(t),b=t.le,k=t.Qt,f=n.he,y=n.de,g=n.write,v=g<n.read?n.read-g-1:n.end-g,0===h){o=0;break}o=7;case 7:if(n.write=g,e=n.ke(t,e),g=n.write,v=g<n.read?n.read-g-1:n.end-g,n.read!=n.write)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);o=8;case 8:return e=1,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);case 9:return e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);default:return e=-2,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e)}}},n.ge=t=>{n.reset(t,null),n.ye=null,d=null},n.me=(t,e,r)=>{n.ye.set(t.subarray(e,e+r),0),n.read=n.write=r},n.Se=()=>1==o?1:0}const St=[0,0,255,255];function zt(){const t=this;function e(t){return t&&t.ze?(t.te=t.ee=0,t.Zt=null,t.ze.mode=7,t.ze._e.reset(t,null),0):-2}t.mode=0,t.method=0,t.Ie=[0],t.Ae=0,t.marker=0,t.Ce=0,t.Ve=e=>(t._e&&t._e.ge(e),t._e=null,0),t.Be=(n,r)=>(n.Zt=null,t._e=null,8>r||r>15?(t.Ve(n),-2):(t.Ce=r,n.ze._e=new mt(n,1<<r),e(n),0)),t.it=(t,e)=>{let n,r;if(!t||!t.ze||!t.fe)return-2;const i=t.ze;for(e=4==e?-5:0,n=-5;;)switch(i.mode){case 0:if(0===t.Qt)return n;if(n=e,t.Qt--,t.te++,8!=(15&(i.method=t.pe(t.le++)))){i.mode=13,t.Zt="unknown compression method",i.marker=5;break}if(8+(i.method>>4)>i.Ce){i.mode=13,t.Zt="invalid win size",i.marker=5;break}i.mode=1;case 1:if(0===t.Qt)return n;if(n=e,t.Qt--,t.te++,r=255&t.pe(t.le++),((i.method<<8)+r)%31!=0){i.mode=13,t.Zt="incorrect header check",i.marker=5;break}if(0==(32&r)){i.mode=7;break}i.mode=2;case 2:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae=(255&t.pe(t.le++))<<24&4278190080,i.mode=3;case 3:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae+=(255&t.pe(t.le++))<<16&16711680,i.mode=4;case 4:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae+=(255&t.pe(t.le++))<<8&65280,i.mode=5;case 5:return 0===t.Qt?n:(n=e,t.Qt--,t.te++,i.Ae+=255&t.pe(t.le++),i.mode=6,2);case 6:return i.mode=13,t.Zt="need dictionary",i.marker=0,-2;case 7:if(n=i._e.be(t,n),-3==n){i.mode=13,i.marker=0;break}if(0==n&&(n=e),1!=n)return n;n=e,i._e.reset(t,i.Ie),i.mode=12;case 12:return t.Qt=0,1;case 13:return-3;default:return-2}},t.Ee=(t,e,n)=>{let r=0,i=n;if(!t||!t.ze||6!=t.ze.mode)return-2;const o=t.ze;return i<1<<o.Ce||(i=(1<<o.Ce)-1,r=n-i),o._e.me(e,r,i),o.mode=7,0},t.De=t=>{let n,r,i,o,s;if(!t||!t.ze)return-2;const f=t.ze;if(13!=f.mode&&(f.mode=13,f.marker=0),0===(n=t.Qt))return-5;for(r=t.le,i=f.marker;0!==n&&4>i;)t.pe(r)==St[i]?i++:i=0!==t.pe(r)?0:4-i,r++,n--;return t.te+=r-t.le,t.le=r,t.Qt=n,f.marker=i,4!=i?-3:(o=t.te,s=t.ee,e(t),t.te=o,t.ee=s,f.mode=7,0)},t.Ue=t=>t&&t.ze&&t.ze._e?t.ze._e.Se():-2}function _t(){}function It(t){const e=new _t,o=t&&t.rt?n.floor(2*t.rt):131072,s=new i(o);let f=!1;e.Be(),e.se=s,this.append=(t,n)=>{const c=[];let l,u,a=0,w=0,h=0;if(0!==t.length){e.le=0,e.fe=t,e.Qt=t.length;do{if(e.ue=0,e.ce=o,0!==e.Qt||f||(e.le=0,f=!0),l=e.it(0),f&&-5===l){if(0!==e.Qt)throw new r("inflating: bad input")}else if(0!==l&&1!==l)throw new r("inflating: "+e.Zt);if((f||1===l)&&e.Qt===t.length)throw new r("inflating: bad input");e.ue&&(e.ue===o?c.push(new i(s)):c.push(s.slice(0,e.ue))),h+=e.ue,n&&e.le>0&&e.le!=a&&(n(e.le),a=e.le)}while(e.Qt>0||0===e.ce);return c.length>1?(u=new i(h),c.forEach((t=>{u.set(t,w),w+=t.length}))):u=c[0]||new i(0),u}},this.flush=()=>{e.Ve()}}_t.prototype={Be:function(t){const e=this;return e.ze=new zt,t||(t=15),e.ze.Be(e,t)},it:function(t){const e=this;return e.ze?e.ze.it(e,t):-2},Ve:function(){const t=this;if(!t.ze)return-2;const e=t.ze.Ve(t);return t.ze=null,e},De:function(){const t=this;return t.ze?t.ze.De(t):-2},Ee:function(t,e){const n=this;return n.ze?n.ze.Ee(n,t,e):-2},pe:function(t){return this.fe[t]},Xt:function(t,e){return this.fe.subarray(t,t+e)}},self.initCodec=()=>{self.Deflate=ut,self.Inflate=It};
`],{type:"text/javascript"}));i({workerScripts:{inflate:[e],deflate:[e]}})}};var Np=class{constructor(){this.size=0}init(){this.initialized=!0}},dd=class extends Np{},Rp=class extends Np{writeUint8Array(e){this.size+=e.length}};var Ol=class extends dd{constructor(e){super(),this.array=e,this.size=e.length}readUint8Array(e,t){return this.array.slice(e,e+t)}},Fl=class extends Rp{constructor(){super(),this.array=new Uint8Array(0)}writeUint8Array(e){super.writeUint8Array(e);let t=this.array;this.array=new Uint8Array(t.length+e.length),this.array.set(t),this.array.set(e,t.length)}getData(){return this.array}};var jg="/",mw=new Date(2107,11,31),gw=new Date(1980,0,1);var fw="\0\u263A\u263B\u2665\u2666\u2663\u2660\u2022\u25D8\u25CB\u25D9\u2642\u2640\u266A\u266B\u263C\u25BA\u25C4\u2195\u203C\xB6\xA7\u25AC\u21A8\u2191\u2193\u2192\u2190\u221F\u2194\u25B2\u25BC !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\u2302\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xA2\xA3\xA5\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0 ".split(""),wT=i=>{let e="";for(let t=0;t<i.length;t++)e+=fw[i[t]];return e};var Op=_w;function _w(i,e){if(e&&e.trim().toLowerCase()=="cp437")return wT(i);if(typeof TextDecoder>"u"){let t=new FileReader;return new Promise((n,r)=>{t.onload=o=>n(o.target.result),t.onerror=()=>r(t.error),t.readAsText(new Blob([i]))})}else return new TextDecoder(e).decode(i)}var $g="Abort error";async function Jg(i,e,t,n,r,o,a){let s=Math.max(o.chunkSize,64);return l();async function l(d=0,c=0){let p=a.signal,u=r();if(d<u){Zg(p,i);let h=await e.readUint8Array(d+n,Math.min(s,u-d)),f=h.length;Zg(p,i);let _=await i.append(h);if(Zg(p,i),c+=await NT(t,_),a.onprogress)try{a.onprogress(d+f,u)}catch{}return l(d+s,c)}else{let h=await i.flush();return c+=await NT(t,h.data),{signature:h.signature,length:c}}}}function Zg(i,e){if(i&&i.aborted)throw e.abort(),new Error($g)}async function NT(i,e){return e.length&&await i.writeUint8Array(e),e.length}var Aw=["filename","rawFilename","directory","encrypted","compressedSize","uncompressedSize","lastModDate","rawLastModDate","comment","rawComment","signature","extraField","rawExtraField","bitFlag","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","filenameUTF8","commentUTF8","offset","zip64","compressionMethod","extraFieldNTFS","lastAccessDate","creationDate","extraFieldExtendedTimestamp","version","versionMadeBy","msDosCompatible","internalFileAttribute","externalFileAttribute"],Fs=class{constructor(e){Aw.forEach(t=>this[t]=e[t])}};var Fp="File format is not recognized",WT="End of central directory not found",QT="End of Zip64 central directory not found",KT="End of Zip64 central directory locator not found",qT="Central directory header not found",YT="Local file header not found",XT="Zip64 extra field not found",jT="File contains encrypted entry",ZT="Encryption method not supported",pf="Compression method not supported",RT="utf-8",OT="cp437",FT=["uncompressedSize","compressedSize","offset"],Dl=class{constructor(e,t={}){Object.assign(this,{reader:e,options:t,config:Lg()})}async*getEntriesGenerator(e={}){let t=this,n=t.reader;if(n.initialized||await n.init(),n.size<22)throw new Error(Fp);let r=await Cw(n,101010256,n.size,22,65535*16);if(!r)throw new Error(WT);let o=zr(r),a=wr(o,12),s=wr(o,16),l=Lo(o,8),d=0;if(s==4294967295||a==4294967295||l==65535){let h=await Ua(n,r.offset-20,20),f=zr(h);if(wr(f,0)!=117853008)throw new Error(QT);s=xp(f,8);let _=await Ua(n,s,56),m=zr(_),A=r.offset-20-56;if(wr(m,0)!=101075792&&s!=A){let y=s;s=A,d=s-y,_=await Ua(n,s,56),m=zr(_)}if(wr(m,0)!=101075792)throw new Error(KT);l=xp(m,32),a=xp(m,40),s-=a}if(s<0||s>=n.size)throw new Error(Fp);let c=0,p=await Ua(n,s,a),u=zr(p);if(a){let h=r.offset-a;if(wr(u,c)!=33639248&&s!=h){let f=s;s=h,d=s-f,p=await Ua(n,s,a),u=zr(p)}}if(s<0||s>=n.size)throw new Error(Fp);for(let h=0;h<l;h++){let f=new hf(n,t.config,t.options);if(wr(u,c)!=33639248)throw new Error(qT);$T(f,u,c+6);let _=!!f.bitFlag.languageEncodingFlag,m=c+46,A=m+f.filenameLength,y=A+f.extraFieldLength,S=Lo(u,c+4),g=(S&0)==0;Object.assign(f,{versionMadeBy:S,msDosCompatible:g,compressedSize:0,uncompressedSize:0,commentLength:Lo(u,c+32),directory:g&&(Pl(u,c+38)&16)==16,offset:wr(u,c+42)+d,internalFileAttribute:wr(u,c+34),externalFileAttribute:wr(u,c+38),rawFilename:p.subarray(m,A),filenameUTF8:_,commentUTF8:_,rawExtraField:p.subarray(A,y)});let b=y+f.commentLength;f.rawComment=p.subarray(y,b);let T=xl(t,e,"filenameEncoding"),I=xl(t,e,"commentEncoding"),[O,w]=await Promise.all([Op(f.rawFilename,f.filenameUTF8?RT:T||OT),Op(f.rawComment,f.commentUTF8?RT:I||OT)]);f.filename=O,f.comment=w,!f.directory&&f.filename.endsWith(jg)&&(f.directory=!0),await JT(f,f,u,c+6);let P=new Fs(f);if(P.getData=(H,re)=>f.getData(H,P,re),c=b,e.onprogress)try{e.onprogress(h+1,l,new Fs(f))}catch{}yield P}return!0}async getEntries(e={}){let t=[],n=this.getEntriesGenerator(e),r=n.next();for(;!(await r).done;)t.push((await r).value),r=n.next();return t}async close(){}};var hf=class{constructor(e,t,n){Object.assign(this,{reader:e,config:t,options:n})}async getData(e,t,n={}){let r=this,{reader:o,offset:a,extraFieldAES:s,compressionMethod:l,config:d,bitFlag:c,signature:p,rawLastModDate:u,compressedSize:h}=r,f=r.localDirectory={};o.initialized||await o.init();let _=await Ua(o,a,30),m=zr(_),A=xl(r,n,"password");if(A=A&&A.length&&A,s&&s.originalCompressionMethod!=99)throw new Error(pf);if(l!=0&&l!=8)throw new Error(pf);if(wr(m,0)!=67324752)throw new Error(YT);$T(f,m,4),_=await Ua(o,a,30+f.filenameLength+f.extraFieldLength),f.rawExtraField=_.subarray(30+f.filenameLength),await JT(r,f,m,4),t.lastAccessDate=f.lastAccessDate,t.creationDate=f.creationDate;let y=r.encrypted&&f.encrypted,S=y&&!s;if(y){if(!S&&s.strength===void 0)throw new Error(ZT);if(!A)throw new Error(jT)}let g=await Xg(d.Inflate,{codecType:Cp,password:A,zipCrypto:S,encryptionStrength:s&&s.strength,signed:xl(r,n,"checkSignature"),passwordVerification:S&&(c.dataDescriptor?u>>>8&255:p>>>24&255),signature:p,compressed:l!=0,encrypted:y,useWebWorkers:xl(r,n,"useWebWorkers")},d);e.initialized||await e.init();let b=xl(r,n,"signal"),T=a+30+f.filenameLength+f.extraFieldLength;return await Jg(g,o,e,T,()=>h,d,{onprogress:n.onprogress,signal:b}),e.getData()}};function $T(i,e,t){let n=i.rawBitFlag=Lo(e,t+2),r=(n&1)==1,o=wr(e,t+6);Object.assign(i,{encrypted:r,version:Lo(e,t),bitFlag:{level:(n&6)>>1,dataDescriptor:(n&8)==8,languageEncodingFlag:(n&2048)==2048},rawLastModDate:o,lastModDate:ww(o),filenameLength:Lo(e,t+22),extraFieldLength:Lo(e,t+24)})}async function JT(i,e,t,n){let r=e.rawExtraField,o=e.extraField=new Map,a=zr(new Uint8Array(r)),s=0;try{for(;s<r.length;){let _=Lo(a,s),m=Lo(a,s+2);o.set(_,{type:_,data:r.slice(s+4,s+4+m)}),s+=4+m}}catch{}let l=Lo(t,n+4);e.signature=wr(t,n+10),e.uncompressedSize=wr(t,n+18),e.compressedSize=wr(t,n+14);let d=o.get(1);d&&(Tw(d,e),e.extraFieldZip64=d);let c=o.get(28789);c&&(await xT(c,"filename","rawFilename",e,i),e.extraFieldUnicodePath=c);let p=o.get(25461);p&&(await xT(p,"comment","rawComment",e,i),e.extraFieldUnicodeComment=p);let u=o.get(39169);u?(Iw(u,e,l),e.extraFieldAES=u):e.compressionMethod=l;let h=o.get(10);h&&(vw(h,e),e.extraFieldNTFS=h);let f=o.get(21589);f&&(Ew(f,e),e.extraFieldExtendedTimestamp=f)}function Tw(i,e){e.zip64=!0;let t=zr(i.data);i.values=[];for(let r=0;r<Math.floor(i.data.length/8);r++)i.values.push(xp(t,0+r*8));let n=FT.filter(r=>e[r]==4294967295);for(let r=0;r<n.length;r++)i[n[r]]=i.values[r];FT.forEach(r=>{if(e[r]==4294967295)if(i[r]!==void 0)e[r]=i[r];else throw new Error(XT)})}async function xT(i,e,t,n,r){let o=zr(i.data);i.version=Pl(o,0),i.signature=wr(o,1);let a=new Va;a.append(r[t]);let s=zr(new Uint8Array(4));s.setUint32(0,a.get(),!0),i[e]=await Op(i.data.subarray(5)),i.valid=!r.bitFlag.languageEncodingFlag&&i.signature==wr(s,0),i.valid&&(n[e]=i[e],n[e+"UTF8"]=!0)}function Iw(i,e,t){let n=zr(i.data);i.vendorVersion=Pl(n,0),i.vendorId=Pl(n,2);let r=Pl(n,4);i.strength=r,i.originalCompressionMethod=t,e.compressionMethod=i.compressionMethod=Lo(n,5)}function vw(i,e){let t=zr(i.data),n=4,r;try{for(;n<i.data.length&&!r;){let o=Lo(t,n),a=Lo(t,n+2);o==1&&(r=i.data.slice(n+4,n+4+a)),n+=4+a}}catch{}try{if(r&&r.length==24){let o=zr(r),a=o.getBigUint64(0,!0),s=o.getBigUint64(8,!0),l=o.getBigUint64(16,!0);Object.assign(i,{rawLastModDate:a,rawLastAccessDate:s,rawCreationDate:l});let d=nf(a),c=nf(s),p=nf(l),u={lastModDate:d,lastAccessDate:c,creationDate:p};Object.assign(i,u),Object.assign(e,u)}}catch{}}function Ew(i,e){let t=zr(i.data),n=Pl(t,0),r=[],o=[];(n&1)==1&&(r.push("lastModDate"),o.push("rawLastModDate")),(n&2)==2&&(r.push("lastAccessDate"),o.push("rawLastAccessDate")),(n&4)==4&&(r.push("creationDate"),o.push("rawCreationDate"));let a=1;r.forEach((s,l)=>{if(i.data.length>=a+4){let d=wr(t,a);e[s]=i[s]=new Date(d*1e3);let c=o[l];i[c]=d}a+=4})}async function Cw(i,e,t,n,r){let o=new Uint8Array(4),a=zr(o);Nw(a,0,e);let s=n+r;return await l(n)||await l(Math.min(s,t));async function l(d){let c=t-d,p=await Ua(i,c,d);for(let u=p.length-n;u>=0;u--)if(p[u]==o[0]&&p[u+1]==o[1]&&p[u+2]==o[2]&&p[u+3]==o[3])return{offset:c+u,buffer:p.slice(u,u+n).buffer}}}function xl(i,e,t){return e[t]===void 0?i.options[t]:e[t]}function ww(i){let e=(i&4294901760)>>16,t=i&65535;try{return new Date(1980+((e&65024)>>9),((e&480)>>5)-1,e&31,(t&63488)>>11,(t&2016)>>5,(t&31)*2,0)}catch{}}function nf(i){return new Date(Number(i/BigInt(1e4)-BigInt(116444736e5)))}function Pl(i,e){return i.getUint8(e)}function Lo(i,e){return i.getUint16(e,!0)}function wr(i,e){return i.getUint32(e,!0)}function xp(i,e){return Number(i.getBigUint64(e,!0))}function Nw(i,e,t){i.setUint32(e,t,!0)}function zr(i){return new DataView(i.buffer)}function Ua(i,e,t){return i.readUint8Array(e,t)}var IB=new Uint8Array([7,0,2,0,65,69,3,0,0]);var NB=512*1024;var Vw={},tI;try{tI=Vw.url}catch{}Cl({baseURL:tI});CT(Cl);Cl({Deflate:Mb,Inflate:rT});var lh=$a(Xs());var pd,ua,gf,mf={env:{emscripten_notify_memory_growth:function(i){gf=new Uint8Array(ua.exports.memory.buffer)}}},Pp=class{init(){return pd||(typeof fetch<"u"?pd=fetch("data:application/wasm;base64,"+nI).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,mf)).then(this._init):pd=WebAssembly.instantiate(Buffer.from(nI,"base64"),mf).then(this._init),pd)}_init(e){ua=e.instance,mf.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!ua)throw new Error("ZSTDDecoder: Await .init() before decoding.");let n=e.byteLength,r=ua.exports.malloc(n);gf.set(e,r),t=t||Number(ua.exports.ZSTD_findDecompressedSize(r,n));let o=ua.exports.malloc(t),a=ua.exports.ZSTD_decompress(o,t,r,n),s=gf.slice(o,o+a);return ua.exports.free(r),ua.exports.free(o),s}},nI="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";function Dp(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Dp||(Dp={}));function ff(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(ff||(ff={}));function _f(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(_f||(_f={}));function Af(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Af||(Af={}));function Ml(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Ml||(Ml={}));function Sf(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Sf||(Sf={}));function yf(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(yf||(yf={}));function Mp(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Mp||(Mp={}));function bf(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(bf||(bf={}));function Tf(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Tf||(Tf={}));function If(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(If||(If={}));function Ll(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Ll||(Ll={}));function vf(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(vf||(vf={}));function Ef(i){return i}(t=>{t.INVALID=t("");function e(n){return n}t.toString=e})(Ef||(Ef={}));var rI;(o=>(o.toString=xs,o.fromString=Ps,o.fromKiwi=Ds,o.isEqual=Ms,o.isValid=Ls))(rI||(rI={}));var oI;(o=>(o.toString=xs,o.fromString=Ps,o.fromKiwi=Ds,o.isEqual=Ms,o.isValid=Ls))(oI||(oI={}));var iI;(o=>(o.toString=xs,o.fromString=Ps,o.fromKiwi=Ds,o.isEqual=Ms,o.isValid=Ls))(iI||(iI={}));var aI;(o=>(o.toString=xs,o.fromString=Ps,o.fromKiwi=Ds,o.isEqual=Ms,o.isValid=Ls))(aI||(aI={}));var sI;(o=>(o.toString=xs,o.fromString=Ps,o.fromKiwi=Ds,o.isEqual=Ms,o.isValid=Ls))(sI||(sI={}));var lI;(o=>(o.toString=xs,o.fromString=Ps,o.fromKiwi=Ds,o.isEqual=Ms,o.isValid=Ls))(lI||(lI={}));var cI;(o=>(o.toString=xs,o.fromString=Ps,o.fromKiwi=Ds,o.isEqual=Ms,o.isValid=Ls))(cI||(cI={}));function xs({key:i,version:e}){return`${Dp.toString(i)}/${Mp.toString(e)}`}function Ps(i){let e=i.split("/");if(e.length!==2)return null;let[t,n]=e;return t&&n?{key:t,version:n}:null}function Ds({key:i,version:e}){return!i||!e?null:{key:i,version:e}}function Ms(i,e){return!i||!e?i===e:i.key===e.key&&i.version===e.version}function Ls({key:i,version:e}){return!!(i&&e)}var Fe=class i{blendMode(){return this._blendMode}blurColor(){return this._blurColor}blurOffset(){return this._blurOffset}blurRadius(){return this._blurRadius}spread(){return this._spread}isEnabled(){return this._isEnabled}opacity(){return this._opacity}showShadowBehindNode(){return this._showShadowBehindNode}type(){return this._type}setBlendMode(e){this._blendMode=e}setBlurColor(e){this._blurColor=e}setBlurOffset(e){this._blurOffset=e}setBlurOffset1(e){this._blurOffset=e.clone()}setBlurRadius(e){this._blurRadius=e}setSpread(e){this._spread=e}setIsEnabled(e){this._isEnabled=e}setOpacity(e){this._opacity=e}setShowShadowBehindNode(e){this._showShadowBehindNode=e}setType(e){this._type=e}clone(){let e=new i;return e.setBlendMode(this.blendMode()),e.setBlurColor(this.blurColor()),e.setBlurOffset1(this.blurOffset().clone()),e.setBlurRadius(this.blurRadius()),e.setSpread(this.spread()),e.setIsEnabled(this.isEnabled()),e.setOpacity(this.opacity()),e.setShowShadowBehindNode(this.showShadowBehindNode()),e.setType(this.type()),e}isVisibleForRendering(){switch(this.type()){case"DROP_SHADOW":return this.isEnabled()&&C.alpha(this.blurColor())>0&&this.opacity()>0;case"INNER_SHADOW":return this.isEnabled()&&C.alpha(this.blurColor())>0&&this.opacity()>0&&(this.blurRadius()>0||this.blurOffset().x()!=0||this.blurOffset().y()!=0||this.spread()>0);case"BACKGROUND_BLUR":return this.isEnabled()&&this.blurRadius()>0;case"FOREGROUND_BLUR":return this.isEnabled()&&this.blurRadius()>0}return!1}isEnabledAndVisible(){return this.isEnabled()&&this.opacity()>0}equals(e){return this.blendMode()==e.blendMode()&&this.blurColor()==e.blurColor()&&this.blurOffset().equals(e.blurOffset())&&this.blurRadius()==e.blurRadius()&&this.spread()==e.spread()&&this.showShadowBehindNode()==e.showShadowBehindNode()&&this.isEnabled()==e.isEnabled()&&this.opacity()==e.opacity()&&this.type()==e.type()}static createForegroundBlur(e){let t=new i;return t.setType("FOREGROUND_BLUR"),t.setBlurRadius(e),t}static createBackgroundBlur(e){let t=new i;return t.setType("BACKGROUND_BLUR"),t.setBlurRadius(e),t}static createInnerShadow(e,t,n,r){let o=new i;return o.setType("INNER_SHADOW"),o.setBlurRadius(e),o.setBlurOffset(t),o.setBlurColor(n),o.setOpacity(r),o}static createDropShadow1(e,t,n,r){return i.createDropShadow3(e,t,n,r,0,!0)}static createDropShadow2(e,t,n,r,o){return i.createDropShadow3(e,t,n,r,o,!0)}static createDropShadow3(e,t,n,r,o,a){let s=new i;return s.setType("DROP_SHADOW"),s.setBlurRadius(e),s.setBlurOffset(t),s.setBlurColor(n),s.setOpacity(r),s.setSpread(o),s.setShowShadowBehindNode(a),s}constructor(){this._blendMode="NORMAL",this._blurColor=C.TRANSPARENT,this._blurOffset=ve.FrozenVector_ZERO,this._blurRadius=0,this._spread=0,this._isEnabled=!0,this._opacity=1,this._showShadowBehindNode=!1,this._type="DROP_SHADOW"}};var gr=class gr{count(){return this._heap.length}peek(){if(this.count()==0)throw new Error("Peeking on an empty queue");return this._heap[gr.ROOT_INDEX].value}insertOrUpdate(e,t){if(this._indexByElement.has(e)){this.remove(e),this.insertOrUpdate(e,t);return}let n=new gr.Element(e,t);this._heap.push(n),this._indexByElement.set(n.value,this.count()-1),this._siftUp(this.count()-1)}getPriority(e){if(!this._indexByElement.has(e))return null;let t=this._indexByElement.get(e),n=this._heap[t];return new Se(n.priority)}remove(e){if(!this._indexByElement.has(e))return;let t=this._indexByElement.get(e),n=this.count()-1;n>t&&this._swap(t,n);let r=this._heap.pop();this._indexByElement.delete(r.value),t!=n&&(this._siftDown(t),this._siftUp(t))}allValues(){return this._heap.map(e=>e.value)}maxPriority(){if(this.count()==0)throw new Error("Calling maxPriority on an empty queue");return this._heap[gr.ROOT_INDEX].priority}pop(){if(this.count()==0)throw new Error("Popping an empty queue");let e=this.peek();return this.remove(e),e}_isGreater(e,t){return this._compare(this._heap[e].priority,this._heap[t].priority)>0}_swap(e,t){let n=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=n,this._indexByElement.set(this._heap[e].value,e),this._indexByElement.set(this._heap[t].value,t)}_siftUp(e){let t=e;for(;t>gr.ROOT_INDEX&&this._isGreater(t,gr.indexOfParent(t));)this._swap(t,gr.indexOfParent(t)),t=gr.indexOfParent(t)}_siftDown(e){let t=e;for(;gr.indexOfLeftChild(t)<this.count()&&this._isGreater(gr.indexOfLeftChild(t),t)||gr.indexOfRightChild(t)<this.count()&&this._isGreater(gr.indexOfRightChild(t),t);){let n=gr.indexOfRightChild(t)<this.count()&&this._isGreater(gr.indexOfRightChild(t),gr.indexOfLeftChild(t))?gr.indexOfRightChild(t):gr.indexOfLeftChild(t);this._swap(t,n),t=n}}static indexOfParent(e){return((e+1)/2|0)-1}static indexOfLeftChild(e){return e*2+1}static indexOfRightChild(e){return(e+1)*2}constructor(e){this._heap=[],this._indexByElement=new Map,this._compare=e}};gr.ROOT_INDEX=0;var pa=gr;(e=>{class i{constructor(n,r){this.value=n,this.priority=r}}e.Element=i})(pa||(pa={}));var Bl=class Bl{texture(e){return this._texture==null&&(this._texture=e.createTexture2(N.TextureFormat.RGBA_LINEAR_CLAMP,Bl.WIDTH,Bl.HEIGHT,this.pixels,"GradientData")),this._texture}totalVRAM(){return this._texture!=null?N.in_Texture.Texture_totalVRAM(this._texture):0}constructor(e){this.pixels=e,this._texture=null}};Bl.WIDTH=1024,Bl.HEIGHT=2;var Ga=Bl,hd=class i{constructor(){this._table=null;let e=new co;this._table=new wi(t=>i._hashGradient(e,t),(t,n)=>t.equals2(n),t=>i._evaluateGradient(t))}allocate(e){return this._table.getOrInsertFallback(e)}totalVRAM(){let e=0;return this._table.each((t,n)=>{e=e+n.totalVRAM()}),e}static _hashGradient(e,t){let n=t.colorStops(),r=n.length;e.hash2(as.shouldWrap(t.type())?1:0),e.hash2(r);for(let o=0,a=r;o<a;o=o+1){let s=n[o];e.hash2(s.color),e.hash1(s.position)}return e.value()}static _evaluateGradient(e){let t=new Uint8Array(Ga.WIDTH*Ga.HEIGHT*4),n=e.flattenedStops(),r=n.length;if(r!=0){let o=1,a=n[0],s=a,l=0;for(let d=0;d<Ga.WIDTH;d=d+1){let c=d/(Ga.WIDTH-1);for(;a.position<c&&o<r;)s=a,a=n[o],o=o+1;let p=s.position,u=a.position,h=c<p?0:c>u?1:p<u?(c-p)/(u-p):0,f=s.color,_=a.color,m=((f>>>24)+((_>>>24)-(f>>>24))*h)/255;for(let A=0;A<4;A=A+1){let y=f&255,S=_&255,g=y+(S-y)*h,b=.5+257*(A<3?g*m:g)|0;t[l]=b>>8,t[l+Ga.WIDTH*4]=b,f>>=8,_>>=8,l=l+1}}}return new Ga(t)}};var Bt=class Bt{static SUPERSAMPLE_COUNT(){return this._CACHED_SUPERSAMPLE_COUNT==null&&(this._CACHED_SUPERSAMPLE_COUNT=X.useSSAA()?4:2),this._CACHED_SUPERSAMPLE_COUNT}static SSAA_SIZE(){return gn.TILE_SIZE*Bt.SUPERSAMPLE_COUNT()}constructor(e,t,n){this._delegate=null,this._context=null,this._bufferPool=null,this._quadArea=null,this._solidColorMaterial=null,this._gradientPaintMaterial=null,this._lerpGradientPaintMaterial=null,this._stencilMaterial=null,this._imageMaterial=null,this._lerpImageMaterial=null,this._imageColorAdjustMaterial=null,this._lerpImageColorAdjustMaterial=null,this._aaaShapeSolidColorMaterial=null,this._aaaShapeGradientPaintMaterial=null,this._aaaShapeLerpGradientPaintMaterial=null,this._aaaShapeImageMaterial=null,this._aaaShapeLerpImageMaterial=null,this._aaaShapeImageColorAdjustMaterial=null,this._aaaShapeLerpImageColorAdjustMaterial=null,this._gradientDataCache=new Map,this._gradientPool=new hd,this._batchAntialiasing=null,this._currentBatchScissorBuilder=new Tt,this._shouldFlushAfterStencilCover=!1,this._shouldFlushAfterRenderGeometryDirectly=!1,this.computeStates=new Map([["ODD",new N.StencilState(new N.StencilFaceState(0,N.Comparison.ALWAYS,1,1,N.StencilOperation.KEEP,N.StencilOperation.INVERT,N.StencilOperation.INVERT))],["NONZERO",new N.StencilState(new N.StencilFaceState(0,N.Comparison.ALWAYS,Bt.WINDING_MASK,Bt.WINDING_MASK,N.StencilOperation.KEEP,N.StencilOperation.INCREMENT_WRAP,N.StencilOperation.INCREMENT_WRAP),new N.StencilFaceState(0,N.Comparison.ALWAYS,Bt.WINDING_MASK,Bt.WINDING_MASK,N.StencilOperation.KEEP,N.StencilOperation.DECREMENT_WRAP,N.StencilOperation.DECREMENT_WRAP))]]),this.useStates=new Map([["ODD",new N.StencilState(new N.StencilFaceState(0,N.Comparison.NOT_EQUAL,1,0,N.StencilOperation.KEEP,N.StencilOperation.KEEP,N.StencilOperation.KEEP))],["NONZERO",new N.StencilState(new N.StencilFaceState(0,N.Comparison.NOT_EQUAL,Bt.WINDING_MASK,0,N.StencilOperation.KEEP,N.StencilOperation.KEEP,N.StencilOperation.KEEP))]]),this.clearStates=new Map([["ODD",new N.StencilState(new N.StencilFaceState(0,N.Comparison.NOT_EQUAL,1,Bt.WINDING_MASK,N.StencilOperation.ZERO,N.StencilOperation.ZERO,N.StencilOperation.ZERO))],["NONZERO",new N.StencilState(new N.StencilFaceState(0,N.Comparison.NOT_EQUAL,Bt.WINDING_MASK,Bt.WINDING_MASK,N.StencilOperation.ZERO,N.StencilOperation.ZERO,N.StencilOperation.ZERO))]]),this.setFillStates=new Map([["ODD",new N.StencilState(new N.StencilFaceState(Bt.FILL,N.Comparison.NOT_EQUAL,1,Bt.NOT_STROKE,N.StencilOperation.KEEP,N.StencilOperation.REPLACE,N.StencilOperation.REPLACE))],["NONZERO",new N.StencilState(new N.StencilFaceState(Bt.FILL,N.Comparison.NOT_EQUAL,Bt.WINDING_MASK,Bt.NOT_STROKE,N.StencilOperation.KEEP,N.StencilOperation.REPLACE,N.StencilOperation.REPLACE))]]),this.setStrokeStates=new Map([["ODD",new N.StencilState(new N.StencilFaceState(Bt.STROKE,N.Comparison.NOT_EQUAL,1,Bt.NOT_FILL,N.StencilOperation.KEEP,N.StencilOperation.REPLACE,N.StencilOperation.REPLACE))],["NONZERO",new N.StencilState(new N.StencilFaceState(Bt.STROKE,N.Comparison.NOT_EQUAL,Bt.WINDING_MASK,Bt.NOT_FILL,N.StencilOperation.KEEP,N.StencilOperation.REPLACE,N.StencilOperation.REPLACE))]]),this.compoundUseStates=new Map([[0,new N.StencilState(new N.StencilFaceState(Bt.FILL_AND_STROKE,N.Comparison.EQUAL,Bt.FILL_AND_STROKE,0,N.StencilOperation.KEEP,N.StencilOperation.KEEP,N.StencilOperation.KEEP))],[1,new N.StencilState(new N.StencilFaceState(Bt.STROKE,N.Comparison.EQUAL,Bt.FILL_AND_STROKE,0,N.StencilOperation.KEEP,N.StencilOperation.KEEP,N.StencilOperation.KEEP))]]),this.compoundClearStates=new Map([[0,new N.StencilState(new N.StencilFaceState(Bt.FILL_AND_STROKE,N.Comparison.EQUAL,Bt.FILL_AND_STROKE,-1,N.StencilOperation.ZERO,N.StencilOperation.ZERO,N.StencilOperation.ZERO))],[1,new N.StencilState(new N.StencilFaceState(Bt.STROKE,N.Comparison.EQUAL,Bt.FILL_AND_STROKE,-1,N.StencilOperation.ZERO,N.StencilOperation.ZERO,N.StencilOperation.ZERO))]]),this._delegate=e,this._context=t,this._bufferPool=n,this._solidColorMaterial=this._context.createMaterial("solidColor",N.VertexFormat.POSITION_F2_COORD_F3,EA,du),this._gradientPaintMaterial=this._context.createMaterial("gradientPaint",N.VertexFormat.POSITION_F2_COORD_F3,sc,CA),this._lerpGradientPaintMaterial=this._context.createMaterial("lerpGradientPaint",N.VertexFormat.POSITION_F2_COORD_F3,sc,wA),this._stencilMaterial=this._context.createMaterial("stencil",N.VertexFormat.POSITION_F2_COORD_F3,aA,sA),this._imageMaterial=this._context.createMaterial("image",N.VertexFormat.POSITION_F2_COORD_F3,sc,NA),this._lerpImageMaterial=this._context.createMaterial("lerpImage",N.VertexFormat.POSITION_F2_COORD_F3,om,RA),this._imageColorAdjustMaterial=this._context.createMaterial("imageColorAdjust",N.VertexFormat.POSITION_F2_COORD_F3,sc,OA),this._lerpImageColorAdjustMaterial=this._context.createMaterial("lerpImageColorAdjust",N.VertexFormat.POSITION_F2_COORD_F3,om,FA),N.supportsWebGLExtensionOESStandardDerivatives()&&(this._aaaShapeSolidColorMaterial=this._context.createMaterial("aaaShapeSolidColor",N.VertexFormat.POSITION_F2_COORD_F3,PA,DA),this._aaaShapeGradientPaintMaterial=this._context.createMaterial("aaaShapeGradientPaint",N.VertexFormat.POSITION_F2_COORD_F3,lc,MA),this._aaaShapeLerpGradientPaintMaterial=this._context.createMaterial("aaaShapeLerpGradientPaint",N.VertexFormat.POSITION_F2_COORD_F3,lc,LA),this._aaaShapeImageMaterial=this._context.createMaterial("aaaShapeImage",N.VertexFormat.POSITION_F2_COORD_F3,lc,BA),this._aaaShapeLerpImageMaterial=this._context.createMaterial("aaaShapeLerpImage",N.VertexFormat.POSITION_F2_COORD_F3,im,VA),this._aaaShapeImageColorAdjustMaterial=this._context.createMaterial("aaaShapeImageColorAdjust",N.VertexFormat.POSITION_F2_COORD_F3,lc,kA),this._aaaShapeLerpImageColorAdjustMaterial=this._context.createMaterial("aaaShapeLerpImageColorAdjust",N.VertexFormat.POSITION_F2_COORD_F3,im,UA)),this._quadArea=this._bufferPool.allocate(N.VertexFormat.POSITION_F2_COORD_F3,new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._shouldFlushAfterStencilCover=this._checkShouldFlushAfterStencilCover(),this._shouldFlushAfterRenderGeometryDirectly=this._checkShouldFlushAfterRenderGeometryDirectly()}totalVRAM(){return this._gradientPool.totalVRAM()}clearGradientCache(){this._gradientDataCache=new Map,this._gradientPool=new hd}canSkipStencil(e,t,n){return t.hasNoCurves?!!(t.hasNoOverlaps||e=="NONZERO"&&t.hasNoCurvesAndSameOrientation&&!Oe.containsAtLeastOneNonOpaquePaint(n)):!1}currentBatchAA(){return this._batchAntialiasing}currentBatchScissor(){return this._currentBatchScissorBuilder.build()}includeBoundsInBatchScissor(e){this._currentBatchScissorBuilder.include3(e)}beginBatch(e){this._batchAntialiasing=new Se(e),this._batchAntialiasing.value==2&&this._delegate.pushSSAARenderState(null)}finishBatch(){if(this._delegate.supersampleState().level==1&&this._delegate.supersampleState().mode==0&&this._batchAntialiasing.value==2){let e=this.currentBatchScissor();this._delegate.currentTile().pushScissor2(e)}this._currentBatchScissorBuilder.reset(),this._batchAntialiasing.value==2&&this._delegate.popSSAARenderState(),this._batchAntialiasing=null}renderStencilQuad(e,t,n){let r=this._solidColorMaterial,o=oe.new3(e).translatedBy1(t.topLeft()).scaledBy1(t.size());N.in_Material.Material_setUniformMat32(r,Tn,o),this._context.setStencilState(n),N.in_Context.Context_setKeepBlendState(this._context),this._delegate.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,r,this._quadArea),this._delegate.markDidDraw()}renderFill(e,t){if(t.geometry.paints.length==0)return;let n=t.geometry.type==_i.PaintedGeometryType.DYNAMIC?t.geometry.path().bounds().size():t.paintSize,r=oe.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(t.transform),o=this._delegate.currentTile(),a=o.tileSize(),s=oe.new2().scaledBy2(a).multipliedBy1(e).multipliedBy1(t.transform),l=N.FrozenScissors.isEmpty(o.scissors())?new U(0,0,a,a):N.FrozenScissors.last(o.scissors()),d=U.new3(t.geometry.path().bounds());if(s.transformRect(d),d.intersectWith(l),this.includeBoundsInBatchScissor(d),t.geometry.canBeAnalyticallyAntialiased()){N.in_Context.Context_setPremultipliedBlendState(this._context),this.renderAAAShape(r,t.geometry,n);return}let c=t.geometry.path().windingRule(),p=t.geometry.path().triangles(this._bufferPool,N.VertexFormat.POSITION_F2_COORD_F3),u=!0;for(let h=0,f=p.length;h<f;h=h+1)if(!this.canSkipStencil(c,p[h],t.geometry.paints)){u=!1;break}u?(N.in_Context.Context_setPremultipliedBlendState(this._context),this.renderGeometryDirectly(r,t.geometry,n)):(this.renderStencilGeometry(r,t.geometry,this.computeStates.get(c)),N.in_Context.Context_setPremultipliedBlendState(this._context),this.renderCoverQuad(r,t.geometry,n,this.useStates.get(c),this.clearStates.get(c)),this._context.setStencilState(N.StencilState.NONE))}renderFillStroke(e,t){let n=this._delegate.currentTile(),r=n.tileSize(),o=oe.new2().scaledBy2(r).multipliedBy1(e).multipliedBy1(t.transform),a=N.FrozenScissors.isEmpty(n.scissors())?new U(0,0,r,r):N.FrozenScissors.last(n.scissors()),s=oe.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(t.transform);for(let l=0,d=t.fillGeometries.length;l<d;l=l+1){let c=t.fillGeometries[l],p=U.new3(c.path().bounds());o.transformRect(p),this.includeBoundsInBatchScissor(p.intersectedWith(a));let u=c.path().windingRule();this.renderStencilGeometry(s,c,this.computeStates.get(u)),N.in_Context.Context_setPremultipliedBlendState(this._context),this.renderCoverQuad(s,c,t.paintSize,this.useStates.get(u),this.setFillStates.get(u))}for(let l=0,d=t.strokeGeometries.length;l<d;l=l+1){let c=t.strokeGeometries[l],p=U.new3(c.path().bounds());o.transformRect(p),this.includeBoundsInBatchScissor(p.intersectedWith(a));let u=c.path().windingRule();this.renderStencilGeometry(s,c,this.computeStates.get(u)),this.renderStencilQuad(s,c.path().bounds(),this.setStrokeStates.get(u)),N.in_Context.Context_setPremultipliedBlendState(this._context),this.renderCoverQuad(s,c,t.paintSize,this.compoundUseStates.get(t.mode),this.compoundClearStates.get(t.mode))}if(t.strokeGeometries.length!=0){let l=ce.List_last(t.strokeGeometries).path().bounds(),d=ce.List_last(t.fillGeometries).path().bounds();l.contains1(d)||this.renderStencilQuad(s,d,this.compoundClearStates.get(t.mode))}this._context.setStencilState(N.StencilState.NONE)}uvTransformFromBounds(e,t){let n=oe.new2();return n.scale4(1/t.x(),1/t.y()),n.translate1(e.topLeft()),n.scale3(e.size()),n}canSkipPaint(e,t,n,r){let o=n.asSinglePaint();if(o==null)return!1;if((o.type()=="GRADIENT_RADIAL"||o.type()=="GRADIENT_DIAMOND")&&o.lastStopIsTransparent()){let a=oe.new3(o.transform());if(a.multiply(t),a.invert()){let s=ce.List_last(o.colorStops()).position*.5,l=new E(.5,.5),d=U.new4(l.subtract(s),l.add(s));return oe.new3(e).translatedBy1(r.topLeft()).scaledBy1(r.size()).multipliedBy1(a).transformRect(d),!U.CLIP.overlaps(d)}}return!1}_findOrCreateGradientData(e){let t=qt.IntMap_get(this._gradientDataCache,e.id(),null);return t==null&&(t=this._gradientPool.allocate(e),this._gradientDataCache.set(e.id(),t)),t}_setAaaShapeUniforms(e,t,n){if(e.setUniformVec21(JA,n.x(),n.y()),N.in_Material.Material_setUniformVec22(e,jA,t.bounds().size()),t instanceof ui){let r=t;e.setUniformInt(sm,Bp.ELLIPSE),N.in_Material.Material_setUniformVec22(e,KA,r.center.subtract1(r.bounds().topLeft())),e.setUniformVec21(qA,r.xRadius,r.yRadius)}else if(t instanceof Pt){let r=t;e.setUniformInt(sm,Bp.ROUNDED_RECT),N.in_Material.Material_setUniformVec43(e,YA,t.bounds().translatedBy(t.bounds().topLeft())),e.setUniformVec41(XA,Math.max(r.radii().topLeft,0),Math.max(r.radii().topRight,0),Math.max(r.radii().bottomRight,0),Math.max(r.radii().bottomLeft,0))}else throw new Error("Unxpected path type")}renderAAAShape(e,t,n){let r=t.paints,o=t.path().bounds(),a=e.clone(),s=a.invert(),l=2/gn.TILE_SIZE,d=a.scale1().x()*l,c=o.clone().expandedBy1(d),p=oe.new3(e).translatedBy1(c.topLeft()).scaledBy1(c.size()),u=this.uvTransformFromBounds(o,n),h=new E(c.width()/o.width(),c.height()/o.height()),f=t.path().path();for(let _=0,m=r.length;_<m;_=_+1){let A=r[_];if(!this.canSkipPaint(e,u,A,o))if(A.type()=="SOLID"){let y=this._aaaShapeSolidColorMaterial;this._setAaaShapeUniforms(y,f,h),N.in_Material.Material_setUniformMat32(y,Tn,p),N.in_Material.Material_setUniformVec42(y,Ko,C.premultiplied(A.color())),y.setUniformFloat(Pn,A.opacity()),this._delegate.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,y,this._quadArea),this._delegate.markDidDraw()}else if(as.isGradient(A.type())){let y=oe.new3(A.transform()).multipliedBy1(u),S=null,g=A.asVolatilePaint();if(g!=null){S=this._aaaShapeLerpGradientPaintMaterial;let b=this._findOrCreateGradientData(g.from()).texture(this._context),T=this._findOrCreateGradientData(g.to()).texture(this._context);b.setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),T.setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),S.setUniformSampler(Yt,b,0),S.setUniformSampler(Tr,T,1),S.setUniformFloat(is,g.t())}else{let b=A.asSinglePaint();S=this._aaaShapeGradientPaintMaterial;let T=this._findOrCreateGradientData(b).texture(this._context);T.setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),S.setUniformSampler(Yt,T,0)}this._setAaaShapeUniforms(S,f,h),N.in_Material.Material_setUniformMat32(S,Tn,p),N.in_Material.Material_setUniformMat32(S,di,y),S.setUniformInt($s,Lp.get(A.type())),S.setUniformFloat(Pn,A.opacity()),this._delegate.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,S,this._quadArea),this._delegate.markDidDraw()}else if(A.type()=="IMAGE"||A.type()=="VIDEO"){let y=oe.new3(u).scaledBy3(1/o.size().x(),1/o.size().y()),S=!0,g=A.asVolatilePaint();if(g!=null){let b=this.getImageToDraw(g.from(),n,e,y,g.from().imageScaleMode());if(b!=null){let T=oe.new2(),I=null;if(g.from().image()==g.to().image()&&!(g.from().imageScaleMode()=="TILE"||g.to().imageScaleMode()=="TILE"))I=this._aaaShapeImageMaterial,g.colorAdjustIsActive()&&(I=this._aaaShapeImageColorAdjustMaterial,g.colorAdjustSetData(I)),T=this.allocateObjectSpaceToNormalizedImageSpaceTransform(g,n,u);else{I=this._aaaShapeLerpImageMaterial,g.colorAdjustIsActive()&&(I=this._aaaShapeLerpImageColorAdjustMaterial,g.colorAdjustSetData(I)),T=this.allocateObjectSpaceToNormalizedImageSpaceTransform(g.from(),n,u);let w=this.getImageToDraw(g.to(),n,e,y,g.to().imageScaleMode());if(w==null)S=!1;else{let P=this.getOrCreateVideoTexture(g.to());P==null&&(P=this._delegate.getOrCreateImageTexture(w));let H=this.allocateObjectSpaceToNormalizedImageSpaceTransform(g.to(),n,u);N.in_Material.Material_setUniformMat32(I,mu,H),P!=null&&P.setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),I.setUniformSampler(Tr,P,1),I.setUniformFloat(is,tn.double_clamp(g.t(),0,1))}}I.setUniformFloat(fm,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale());let O=this.getOrCreateVideoTexture(g.from());O==null&&(O=this._delegate.getOrCreateImageTexture(b)),S&&O!=null&&(O!=null&&O.setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(A,I),N.in_Material.Material_setUniformMat32(I,Tn,p),N.in_Material.Material_setUniformMat32(I,di,T),I.setUniformFloat(Pn,g.opacity()),I.setUniformSampler(Yt,O,0),this._setAaaShapeUniforms(I,f,h),this._delegate.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,I,this._quadArea),this._delegate.markDidDraw())}}else{let b=A.asSinglePaint(),T=null;if(T=this.getOrCreateVideoTexture(b),T==null){let I=this.getImageToDraw(b,n,e,y,b.imageScaleMode());I!=null&&(T=this._delegate.getOrCreateImageTexture(I))}if(T!=null){let I=this._aaaShapeImageMaterial;b.colorAdjustIsActive()&&(I=this._aaaShapeImageColorAdjustMaterial,b.colorAdjustSetData(I));let O=this.allocateObjectSpaceToNormalizedImageSpaceTransform(b,n,u);T.setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(A,I),N.in_Material.Material_setUniformMat32(I,Tn,p),N.in_Material.Material_setUniformMat32(I,di,O),I.setUniformFloat(Pn,b.opacity()),I.setUniformSampler(Yt,T,0),I.setUniformFloat(fm,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale()),this._setAaaShapeUniforms(I,f,h),this._delegate.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,I,this._quadArea),this._delegate.markDidDraw()}}}else A.type()=="EMOJI"&&Ke("Emoji should always be rendered by renderGeometryDirectly")}}renderGeometryDirectly(e,t,n){let r=t.path().triangles(this._bufferPool,N.VertexFormat.POSITION_F2_COORD_F3),o=t.paints,a=t.path().bounds(),s=this.uvTransformFromBounds(a,n),l=null;for(let d=0,c=o.length;d<c;d=d+1){let p=o[d];if(!this.canSkipPaint(e,s,p,a))switch(p.type()){case"SOLID":{l=this._solidColorMaterial,N.in_Material.Material_setUniformMat32(l,Tn,e),N.in_Material.Material_setUniformVec42(l,Ko,C.premultiplied(p.color())),l.setUniformFloat(Pn,p.opacity());for(let u=0,h=r.length;u<h;u=u+1)r[u].bufferArea!=null&&(this._delegate.drawToCurrentTile(N.Primitive.TRIANGLES,l,r[u].bufferArea),this._delegate.markDidDraw());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let u=oe.new3(p.transform()).scaledBy3(1/n.x(),1/n.y()),h=p.asVolatilePaint();if(h!=null){l=this._lerpGradientPaintMaterial;let f=this._findOrCreateGradientData(h.from()).texture(this._context),_=this._findOrCreateGradientData(h.to()).texture(this._context);f.setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),_.setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),l.setUniformSampler(Yt,f,0),l.setUniformSampler(Tr,_,1),l.setUniformFloat(is,h.t())}else{let f=p.asSinglePaint();l=this._gradientPaintMaterial;let _=this._findOrCreateGradientData(f).texture(this._context);_.setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),l.setUniformSampler(Yt,_,0)}N.in_Material.Material_setUniformMat32(l,Tn,e),N.in_Material.Material_setUniformMat32(l,di,u),l.setUniformInt($s,Lp.get(p.type())),l.setUniformFloat(Pn,p.opacity());for(let f=0,_=r.length;f<_;f=f+1)r[f].bufferArea!=null&&(this._delegate.drawToCurrentTile(N.Primitive.TRIANGLES,l,r[f].bufferArea),this._delegate.markDidDraw());break}case"IMAGE":case"VIDEO":{let u=oe.new2().scaledBy3(1/n.x(),1/n.y()),h=p.asVolatilePaint();if(h!=null){let f=this.getImageToDraw(h.from(),n,e,u,h.from().imageScaleMode());if(f!=null){let _=oe.new2(),m=!0;if(h.from().image()==h.to().image()&&!(h.from().imageScaleMode()=="TILE"||h.to().imageScaleMode()=="TILE"))l=this._imageMaterial,h.colorAdjustIsActive()&&(l=this._imageColorAdjustMaterial,h.colorAdjustSetData(l)),_=this.allocateObjectSpaceToNormalizedImageSpaceTransform(h,n,u);else{let y=this.getImageToDraw(h.to(),n,e,u,h.to().imageScaleMode());if(y==null)m=!1;else{l=this._lerpImageMaterial,h.colorAdjustIsActive()&&(l=this._lerpImageColorAdjustMaterial,h.colorAdjustSetData(l)),_=this.allocateObjectSpaceToNormalizedImageSpaceTransform(h.from(),n,u);let S=this._delegate.getOrCreateImageTexture(y),g=this.allocateObjectSpaceToNormalizedImageSpaceTransform(h.to(),n,u);N.in_Material.Material_setUniformMat32(l,mu,g),this._setupClampingForImageOrGIF(y.image,S),l.setUniformSampler(Tr,S,1),l.setUniformFloat(is,tn.double_clamp(h.t(),0,1))}}let A=this._delegate.getOrCreateImageTexture(f);if(m&&A!=null){N.in_Material.Material_setUniformMat32(l,Tn,e),N.in_Material.Material_setUniformMat32(l,di,_),l.setUniformFloat(Pn,h.opacity()),this._setupRepeatingForImage(p,l),this._setupClampingForImageOrGIF(f.image,A),l.setUniformSampler(Yt,A,0);for(let y=0,S=r.length;y<S;y=y+1)r[y].bufferArea!=null&&(this._delegate.drawToCurrentTile(N.Primitive.TRIANGLES,l,r[y].bufferArea),this._delegate.markDidDraw())}}}else{let f=p.asSinglePaint(),_=null;if(_=this.getOrCreateVideoTexture(f),_==null){let m=this.getImageToDraw(f,n,e,u,f.imageScaleMode());m!=null&&(_=this._delegate.getOrCreateImageTexture(m),_!=null&&this._setupClampingForImageOrGIF(m.image,_))}if(_!=null){let m=this.allocateObjectSpaceToNormalizedImageSpaceTransform(f,n,u);l=this._imageMaterial,f.colorAdjustIsActive()&&(l=this._imageColorAdjustMaterial,f.colorAdjustSetData(l)),N.in_Material.Material_setUniformMat32(l,Tn,e),N.in_Material.Material_setUniformMat32(l,di,m),l.setUniformFloat(Pn,f.opacity()),this._setupRepeatingForImage(p,l),l.setUniformSampler(Yt,_,0);for(let A=0,y=r.length;A<y;A=A+1)r[A].bufferArea!=null&&(this._delegate.drawToCurrentTile(N.Primitive.TRIANGLES,l,r[A].bufferArea),this._delegate.markDidDraw())}}break}case"EMOJI":{let u=p.asSinglePaint();if(u==null)continue;let h=this._delegate.getOrCreateImageTexture(new Gi(u.image(),2));if(u.decodedImageIsReady()||(h=null),h!=null){let f=h;l=this._imageMaterial;let _=oe.new2().scaledBy3(1/a.width(),1/a.height()).translatedBy2(-a.left(),-a.top());N.in_Material.Material_setUniformMat32(l,Tn,e),N.in_Material.Material_setUniformMat32(l,di,_),l.setUniformFloat(Pn,u.opacity()),l.setUniformSampler(Yt,f,0),f!=null&&f.setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP);for(let m=0,A=r.length;m<A;m=m+1)r[m].bufferArea!=null&&(this._delegate.drawToCurrentTile(N.Primitive.TRIANGLES,l,r[m].bufferArea),this._delegate.markDidDraw())}break}}}this._shouldFlushAfterRenderGeometryDirectly&&this._context.flush()}_setupRepeatingForImage(e,t){let n=!1,r=e.asVolatilePaint();r!=null?r.eitherPaint(o=>o.imageScaleMode()=="TILE")&&(n=!0):e.asSinglePaint()!=null&&(n=e.asSinglePaint().imageScaleMode()=="TILE"),t.setUniformInt(WA,n?1:0),t.setUniformInt(QA,n?0:1)}_setupClampingForImageOrGIF(e,t){e.isGIF()?t.setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP):t.setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP)}renderStencilGeometry(e,t,n){let r=t.path().triangles(this._bufferPool,N.VertexFormat.POSITION_F2_COORD_F3),o=this._stencilMaterial;N.in_Material.Material_setUniformMat32(o,Tn,e),this._context.setStencilState(n),N.in_Context.Context_setKeepBlendState(this._context);for(let a=0,s=r.length;a<s;a=a+1)r[a].bufferArea!=null&&(this._delegate.drawToCurrentTile(N.Primitive.TRIANGLES,o,r[a].bufferArea),this._delegate.markDidDraw())}_checkShouldFlushAfterStencilCover(){return!!X.shouldFlushAfterStencilCover()}_checkShouldFlushAfterRenderGeometryDirectly(){return!!X.shouldFlushAfterRenderGeometryDirectly()}renderCoverQuad(e,t,n,r,o){let a=t.paints;if(a.length==0){this.renderStencilQuad(e,t.path().bounds(),o),this._shouldFlushAfterStencilCover&&this._context.flush();return}let s=t.path().bounds(),l=oe.new3(e).translatedBy1(s.topLeft()).scaledBy1(s.size()),d=this.uvTransformFromBounds(s,n),c=null;for(let p=0,u=a.length;p<u;p=p+1){let h=a[p],f=p+1==u;if(!(!f&&this.canSkipPaint(e,d,h,s)))switch(this._context.setStencilState(f?o:r),h.type()){case"SOLID":{c=this._solidColorMaterial,N.in_Material.Material_setUniformMat32(c,Tn,l),N.in_Material.Material_setUniformVec42(c,Ko,C.premultiplied(h.color())),c.setUniformFloat(Pn,h.opacity()),this._delegate.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,c,this._quadArea),this._delegate.markDidDraw();break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let _=oe.new3(h.transform()).multipliedBy1(d),m=h.asVolatilePaint();if(m!=null){c=this._lerpGradientPaintMaterial;let A=this._findOrCreateGradientData(m.from()).texture(this._context),y=this._findOrCreateGradientData(m.to()).texture(this._context);A.setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),y.setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),c.setUniformSampler(Yt,A,0),c.setUniformSampler(Tr,y,1),c.setUniformFloat(is,m.t())}else{let A=h.asSinglePaint();c=this._gradientPaintMaterial;let y=this._findOrCreateGradientData(A).texture(this._context);y.setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),c.setUniformSampler(Yt,y,0)}N.in_Material.Material_setUniformMat32(c,Tn,l),N.in_Material.Material_setUniformMat32(c,di,_),c.setUniformInt($s,Lp.get(h.type())),c.setUniformFloat(Pn,h.opacity()),this._delegate.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,c,this._quadArea),this._delegate.markDidDraw();break}case"IMAGE":case"VIDEO":{let _=oe.new3(d).scaledBy3(1/s.size().x(),1/s.size().y()),m=!0,A=!1,y=h.asVolatilePaint();if(y!=null){let S=this.getImageToDraw(y.from(),n,e,_,y.from().imageScaleMode());if(S!=null){let g=oe.new2();if(y.from().image()==y.to().image()&&!(y.from().imageScaleMode()=="TILE"||y.to().imageScaleMode()=="TILE"))c=this._imageMaterial,y.colorAdjustIsActive()&&(c=this._imageColorAdjustMaterial,y.colorAdjustSetData(c)),g=this.allocateObjectSpaceToNormalizedImageSpaceTransform(y,n,d);else{c=this._lerpImageMaterial,y.colorAdjustIsActive()&&(c=this._lerpImageColorAdjustMaterial,y.colorAdjustSetData(c)),g=this.allocateObjectSpaceToNormalizedImageSpaceTransform(y.from(),n,d);let T=this.getImageToDraw(y.to(),n,e,_,y.to().imageScaleMode());if(T==null)m=!1;else{let I=this._delegate.getOrCreateImageTexture(T),O=this.allocateObjectSpaceToNormalizedImageSpaceTransform(y.to(),n,d);N.in_Material.Material_setUniformMat32(c,mu,O),I!=null&&I.setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),c.setUniformSampler(Tr,I,1),c.setUniformFloat(is,tn.double_clamp(y.t(),0,1))}}let b=this._delegate.getOrCreateImageTexture(S);m&&b!=null&&(b!=null&&b.setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(h,c),N.in_Material.Material_setUniformMat32(c,Tn,l),N.in_Material.Material_setUniformMat32(c,di,g),c.setUniformFloat(Pn,y.opacity()),c.setUniformSampler(Yt,b,0),this._delegate.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,c,this._quadArea),this._delegate.markDidDraw(),A=!0)}}else{let S=h.asSinglePaint(),g=null;if(g=this.getOrCreateVideoTexture(S),g==null){let b=this.getImageToDraw(S,n,e,_,S.imageScaleMode());b!=null&&(g=this._delegate.getOrCreateImageTexture(b))}if(g!=null){c=this._imageMaterial,S.colorAdjustIsActive()&&(c=this._imageColorAdjustMaterial,S.colorAdjustSetData(c));let b=this.allocateObjectSpaceToNormalizedImageSpaceTransform(S,n,d);g.setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(h,c),N.in_Material.Material_setUniformMat32(c,Tn,l),N.in_Material.Material_setUniformMat32(c,di,b),c.setUniformFloat(Pn,S.opacity()),c.setUniformSampler(Yt,g,0),this._delegate.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,c,this._quadArea),this._delegate.markDidDraw(),A=!0}}f&&!A&&(N.in_Material.Material_setUniformMat32(this._solidColorMaterial,Tn,l),N.in_Material.Material_setUniformVec42(this._solidColorMaterial,Ko,C.TRANSPARENT),this._solidColorMaterial.setUniformFloat(Pn,0),this._delegate.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._solidColorMaterial,this._quadArea),this._delegate.markDidDraw());break}case"EMOJI":{Ke("Emoji should always be rendered by renderGeometryDirectly");break}}}this._shouldFlushAfterStencilCover&&this._context.flush()}allocateObjectSpaceToNormalizedImageSpaceTransform(e,t,n){let r=e.allocateImageTransformForGeometrySize(t);return oe.new2().multipliedBy1(r).multipliedBy1(n)}getImageToDraw(e,t,n,r,o){if(e.image()==null&&e.imageThumbnail()==null)return null;e.imageThumbnail()!=null&&this._delegate.getOrCreateImageTexture(new Gi(e.imageThumbnail(),1)),e.image()!=null&&e.image().isGIF()&&this._delegate.getOrCreateImageTexture(new Gi(e.image(),0));let a=e.decodedImageThumbnailIsReady()?e.decodedImageThumbnail():null,s=!1;if(e.imageThumbnail()==null)s=!0;else if(a!=null){let l=this.allocateObjectSpaceToNormalizedImageSpaceTransform(e,t,r),d=oe.new3(l);d.invert();let c=oe.new2().scaledBy2(gn.TILE_SIZE).multipliedBy1(n).multipliedBy1(d).scaledBy3(1/a.width(),1/a.height()),p=c.axisX().length(),u=c.axisY().length();s=Math.max(u,p)>1||e.image()!=null&&e.image().isGIF(),o=="TILE"&&(s=!0)}if(s&&(this._delegate.getOrCreateImageTexture(new Gi(e.image(),0)),e.decodedImageIsReady())){let l=e.decodedImage();if(l!=null)return new Gi(l,0)}if(a!=null)return new Gi(a,1);if(e.decodedImageIsReady()){let l=e.decodedImage();if(l!=null)return new Gi(l,0)}return null}getOrCreateVideoTexture(e){var t;return(t=e==null?void 0:e.video())==null?void 0:t.getOrCreateTexture(e,this._context,N.TextureFormat.RGBA_NEAREST_CLAMP)}};Bt.FILL=128,Bt.STROKE=64,Bt.NOT_FILL=255^Bt.FILL,Bt.NOT_STROKE=255^Bt.STROKE,Bt.FILL_AND_STROKE=Bt.FILL|Bt.STROKE,Bt.WINDING_MASK=255^Bt.FILL_AND_STROKE,Bt._CACHED_SUPERSAMPLE_COUNT=null;var Wr=Bt,Vp=(n=>(n[n.NONE=0]="NONE",n[n.ANALYTICAL=1]="ANALYTICAL",n[n.SSAA=2]="SSAA",n))(Vp||{}),Bp;(t=>(t.ELLIPSE=0,t.ROUNDED_RECT=1))(Bp||(Bp={}));var dI;(e=>{function i(t){return Vp[t]}e.PathAntialiasing_toString=i})(dI||(dI={}));var kp=class{activate(e){this.reset(),this._isEnabled=!0,this._invalidateFn=e}deactivate(){this.isEnabled()&&(this._invalidateFn(),this.reset())}isEnabled(){return this._isEnabled}reset(){this._isPlaying=!1,this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._framesUntilUpdate=this._frameDelay,this._filteredTree=null,this._invalidateFn=null,this._frameDelay=this._defaultFrameDelay}play(){this.isEnabled()&&(this._isPlaying=!0,this._invalidateFn())}pause(){this.isEnabled()&&(this._isPlaying=!1)}forward(){this.isEnabled()&&(this._maxLayersToRender=Math.min(this._maxLayersToRender+1,this._totalLayersInRenderTree),this._invalidateFn())}backward(){this.isEnabled()&&(this._maxLayersToRender=Math.max(this._maxLayersToRender-1,1),this._invalidateFn())}rewind(){this.isEnabled()&&(this._maxLayersToRender=1,this._invalidateFn())}increaseSpeed(){this.isEnabled()&&(this._frameDelay=Math.max(this._minFrameDelay,this._frameDelay-5))}decreaseSpeed(){this.isEnabled()&&(this._frameDelay=Math.min(this._maxFrameDelay,this._frameDelay+5))}finishLayerByLayerDrawToScreen(){this.isEnabled()&&this._isPlaying&&(this._maxLayersToRender>=this._totalLayersInRenderTree||(this._invalidateFn(),this._framesUntilUpdate=this._framesUntilUpdate-1,this._framesUntilUpdate<=0&&(this._maxLayersToRender=this._maxLayersToRender+1,this._framesUntilUpdate=this._frameDelay)))}_filterCompositeTileGridNodes(e){switch(e.op()){case 0:{let t=e;return new Ha(this._filterCompositeTileGridNodes(t.child),t.flags)}case 2:{let t=e;return new si(this._filterCompositeTileGridNodes(t.child))}case 1:{let t=e,n=[];for(let r=0,o=t.children.length;r<o;r=r+1){let a=this._filterCompositeTileGridNodes(t.children[r]);n.push(a)}return new ze(n,t.isFirstChildSolidBackground())}case 3:case 4:return e;case 5:{let t=e,n=this._filterCompositeTileGridNodes(t.alpha),r=this._filterCompositeTileGridNodes(t.color);return new _r(n,r,t.type,t.innerShadowFill,t.innerShadowAlphaRequiresHardMask)}case 6:{let t=e;return new ro(t.radius,this._filterCompositeTileGridNodes(t.child),t.clamp)}case 7:{let t=e;return new oo(t.blendMode,t.opacity,this._filterCompositeTileGridNodes(t.child))}case 9:{let t=e;return new bo(this._filterCompositeTileGridNodes(t.alpha),t.color)}case 8:{let t=e;return this._filterCompositeTileGridNodes(t.tree)}case 10:{let t=e;return new pt(this._filterCompositeTileGridNodes(t.child),t.id,t.property,t.getter)}case 11:{let t=e;return new Hi(this._filterCompositeTileGridNodes(t.child),t.transform)}case 12:{let t=e,n=this._filterCompositeTileGridNodes(t.startChild),r=this._filterCompositeTileGridNodes(t.endChild);return new Ar(n,r,t.id,t.progressFn)}default:throw new Error(`Unhandled node op ${fr[e.op()]}`)}return null}_renderTreeWithNLayers(e,t){let n=(a,s)=>new vr(a,s);if(t<=0)return n(null,0);let r=[];switch(e.op()){case 0:{let a=e;r.push(a.child);break}case 2:{let a=e;r.push(a.child);break}case 1:{let a=e;for(let s=0,l=a.children.length;s<l;s=s+1){let d=a.children[s];r.push(d)}break}case 3:case 4:return n(e,t-1);case 5:{let a=e;r.push(a.color),r.push(a.alpha);break}case 6:{let a=e;r.push(a.child);break}case 7:{let a=e;r.push(a.child);break}case 9:{let a=e;r.push(a.alpha);break}case 8:{let a=e;r.push(a.tree);break}case 10:{let a=e;r.push(a.child);break}case 11:{let a=e;r.push(a.child);break}case 12:{let a=e;r.push(a.startChild),r.push(a.endChild);break}default:throw new Error(`Unhandled node op ${fr[e.op()]}`)}let o=[];for(let a=0,s=r.length;a<s;a=a+1){let l=r[a],d=this._renderTreeWithNLayers(l,t);if(t=d.b,o.push(d.a),t<=0)return n(new ze(o).optimized(),0)}return this._isRenderableLayer(e)?t>0?n(e,t-1):n(new ze(o).optimized(),0):n(e,t)}_isRenderableLayer(e){switch(e.op()){case 8:case 1:case 0:return!1}return!0}_countLayers(e){let t=0;switch(e.op()){case 0:{let n=e;t=t+this._countLayers(n.child);break}case 2:{let n=e;t=t+this._countLayers(n.child);break}case 1:{let n=e;for(let r=0,o=n.children.length;r<o;r=r+1){let a=n.children[r];t=t+this._countLayers(a)}break}case 3:case 4:break;case 5:{let n=e;t=t+this._countLayers(n.alpha),t=t+this._countLayers(n.color);break}case 6:{let n=e;t=t+this._countLayers(n.child);break}case 7:{let n=e;t=t+this._countLayers(n.child);break}case 9:{let n=e;t=t+this._countLayers(n.alpha);break}case 8:{let n=e;t=t+this._countLayers(n.tree);break}case 10:{let n=e;t=t+this._countLayers(n.child);break}case 11:{let n=e;t=t+this._countLayers(n.child);break}case 12:{let n=e;t=t+this._countLayers(n.startChild),t=t+this._countLayers(n.endChild);break}default:throw new Error(`Unhandled node op ${fr[e.op()]}`)}return this._isRenderableLayer(e)&&(t=t+1),t}treeToRender(e){if(!this.isEnabled())return e;e!=this._originalTree&&(this._totalLayersInRenderTree=this._countLayers(e),this._filteredTree=this._filterCompositeTileGridNodes(e),this._originalTree=e);let t=this._renderTreeWithNLayers(this._filteredTree,this._maxLayersToRender).a;return t!=this._lastTreeToRender&&console.log(`LayerByLayerRendering: rendering ${this._maxLayersToRender} instructions out of ${this._totalLayersInRenderTree}
`+t.debugString1()),this._lastTreeToRender=t,t}constructor(){this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._maxFrameDelay=60,this._defaultFrameDelay=45,this._minFrameDelay=5,this._frameDelay=60,this._framesUntilUpdate=0,this._filteredTree=null,this._originalTree=null,this._invalidateFn=null,this._isPlaying=!1,this._lastTreeToRender=null}};var md=(n=>(n[n.FULL_SIZE=0]="FULL_SIZE",n[n.THUMBNAIL=1]="THUMBNAIL",n[n.EMOJI=2]="EMOJI",n))(md||{}),Gi=class{hash(){return`${this.image.objectHash()}:${md[this.purpose]}`}constructor(e,t){this.image=e,this.purpose=t}},gI=(t=>(t[t.TILE_WAS_EMPTY=0]="TILE_WAS_EMPTY",t[t.HAS_CONTENT=1]="HAS_CONTENT",t))(gI||{}),gd;(r=>{function i(){return new Map}r._new=i;function e(o,a){o.set(a.hash(),a)}r.add=e;function t(o){let a=o;return Array.from(a.values())}r.asList=t;function n(o,a){let s=a,l=o;Le.StringMap_each(s,(d,c)=>{l.set(d,c)})}r.addAllImagesInSet=n})(gd||(gd={}));var wf=class{needsMultipleAAPasses(){return this.status==1}constructor(e,t,n){this.includesBackgroundColor=e,this.status=t,this.neededImagesOrNull=n}},zi=class i{context(){return this._context}bufferPool(){return this._bufferPool}totalVRAM(){let e=0;return e=e+this._pathRasterizer.totalVRAM(),e=e+this._tileStack.totalVRAM(),e}upscaleRectForSSAA(e){let t=Wr.SSAA_SIZE()/gn.TILE_SIZE|0;return e.scaledBy1(t)}downscaleRectForSSAA(e){let t=gn.TILE_SIZE/Wr.SSAA_SIZE();return e.scaledBy1(t)}setBackgroundEnabled(e){this._backgroundEnabled=e}currentTextureSize(){return this._currentTile1().tileSize()}drawTile1(e,t,n,r,o,a,s,l,d){var _;let c=(_=this._canvas)==null?void 0:_.scene().findNode1(a);c==null&&(c=this._canvas);let p=c==this._canvas,u=c==this._canvas&&this._backgroundEnabled?this._canvas.computedBackgroundColor():C.TRANSPARENT,h=!1,f=new i.Options(c.renderTree1(),p,u,h,null,s,!1,l,d);return this.drawTile2(e,t,n,r,o,f)}markDidDraw(){this._didDraw=!0}pushSSAARenderState(e){if(this._shouldDisableAllAntialiasing){Ke("Pushing SSAA state during final composite");return}if(this._ssaaState.level==0){this._tileStack.setSSAARenderState(),this._ssaaState.mode=e==null?0:1;let t=null;this._tileStack.isEmpty()||(t=this.upscaleRectForSSAA(N.FrozenScissors.last(this._currentTile1().scissors()).clone())),e!=null&&this._needsBackgroundColor(e)?(this.duplicateTile1(t),this._downsampleNeedsBlend=!0):(this._downsampleNeedsBlend=!1,this._tileStack.pushTileWithScissors1(t))}this._ssaaState!=null&&(this._ssaaState.level+=1)}popSSAARenderState(){if(this._shouldDisableAllAntialiasing){Ke("Popping SSAA state during final composite");return}if(this._ssaaState!=null&&(this._ssaaState.level-=1),this._ssaaState.level==0){let e=this._tileStack.popTile();this._tileStack.unsetSSAARenderState(),this._downsampleNeedsBlend?N.in_Context.Context_setCopyBlendState(this._context):N.in_Context.Context_setPremultipliedBlendState(this._context),this.downsampleSuperSSAATile(e),this._tileStack.freeTileToPool(e)}}supersampleState(){return this._ssaaState}currentTile(){return this._currentTile1()}computeTileTransform(){return oe.new2().scaledBy2(1/this._canvasSpaceTileBounds.size().x()).translatedBy1(new E(-this._canvasSpaceTileBounds.x(),-this._canvasSpaceTileBounds.y()))}canvasSpaceToViewSpaceScale(){return gn.TILE_SIZE/this._canvasSpaceTileBounds.size().x()}drawTile2(e,t,n,r,o,a){return this._context.annotateAndReturn(`Draw tile (${t}, ${n})`,()=>{let s=o.colorTexture().format(),l=a.shouldRenderDirectlyToOutputTexture;l&&(a.shouldDisableAllAntialiasing,s!=N.TextureFormat.RGBA_LINEAR_CLAMP&&o.colorTexture().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP)),this._requestImage=a.requestImage,this._boundsCache=a.boundsCache,this._canvasSpaceTileBounds=new U(t,n,r,r),this._shouldDisableAllAntialiasing=a.shouldDisableAllAntialiasing,this._neededImagesOrNull=a.shouldCollectNeededImages?gd._new():null;let d=this.computeTileTransform(),c=a.renderTree,p=new Nf(c,d,a.backgroundClearColor);if(this._didDraw=!1,this._includesBackgroundColor=!1,this._includesBackgroundColor=c!=null&&this.nodeNeedsBackgroundColor(c,d),this._includesBackgroundColor){let h=C.premultiplied(a.backgroundClearColor);l?this._tileStack.pushTileBackedByExistingFramebufferAndClearToColor(o,e,a.outputTextureNeedsClear,h):this._tileStack.pushTileAndClearToColor(h)}else l?this._tileStack.pushTileBackedByExistingFramebuffer(o,e,a.outputTextureNeedsClear):this._tileStack.pushTile1();if(c!=null){let h=this.allocateAndComputeTileScissor(d,this.bounds(c));this._tileStack.last().pushScissor2(h);let f=oe.new2();this.visit(c,oe.new3(d),f),this._tileStack.popScissorFromCurrentTile()}let u=this.drawTileFinish(p,e,o,l);return l&&s!=N.TextureFormat.RGBA_LINEAR_CLAMP&&o.colorTexture().setFormat(s),u})}setCanvas(e){this._canvas!=e&&(this._canvas=e,this._pathRasterizer.clearGradientCache())}drawToCurrentTile(e,t,n){let r=this._currentTile1().needsColorClear(),o=this._context.currentStencilState().isEnabled&&this._currentTile1().needsDepthStencilClear();if(r||o){let a=this._context.currentStencilState(),s=this._context.currentBlendState();this._context.setStencilState(N.StencilState.NONE),N.in_Context.Context_setCopyBlendState(this._context);let l=r&&o?N.Clear.ALL:r?N.Clear.COLOR:N.Clear.DEPTH_STENCIL;this._currentTile1().doDeferredClear(l),this._context.setStencilState(a),this._context.setBlendState(s)}this._context.draw(e,t,n),this._currentTile1().setIsColorClear(!1)}clear(e,t){this._context.setFramebuffer(t);let n=this._context.graphicsCardName(),r=Xe.current()==5||n=="Intel Iris Pro OpenGL Engine"||n=="Intel(R) Iris(TM) Graphics 6100"||n=="Intel(R) Iris(TM) Pro Graphics 6200"||n=="Intel Iris OpenGL Engine"||n=="Intel(R) HD Graphics 6000"||n=="Intel(R) HD Graphics 5300"||n=="Intel HD Graphics 5000 OpenGL Engine"||X.getFeatureFlags().viewerWebGLClearWorkaround;if(!X.getFeatureFlags().viewerWebGLClearWorkaroundDisable&&r){let a=this._context.currentStencilState();N.in_Material.Material_setUniformVec42(this._clearOnWindowsMaterial,Ko,e),this._clearOnWindowsMaterial.setUniformFloat(Pn,1),this._context.setStencilState(N.StencilState.NONE),N.in_Context.Context_setCopyBlendState(this._context),this._context.draw(N.Primitive.TRIANGLE_STRIP,this._clearOnWindowsMaterial,this._quadArea),this._context.setStencilState(a);return}this._context.clear2(N.Clear.COLOR,e)}_currentTile1(){return this._tileStack.last()}_currentTile2(e){return this._tileStack.get(this._tileStack.count()-e-1)}_needsBackgroundColor(e){return e.hasNonIsolatedBlends()||e.hasBackgroundBlurs()}bounds(e){return e.currentBounds(this._boundsCache)}nodeNeedsBackgroundColor(e,t){let n=U.new3(this.bounds(e));t.transformRect(n);let r=U.UNIT.overlaps(n);if(e==null||!this._needsBackgroundColor(e)||!r)return!1;if(e.op()==1){let o=e;for(let a of o.children){let s=U.new3(this.bounds(a)),l=U.UNIT.overlaps(t.transformRect(s));if(this._needsBackgroundColor(a)&&l)return!0}return!1}return!0}drawTileFinish(e,t,n,r){this._includesBackgroundColor&&!this._didDraw&&(this._tileStack.last().clearToColor(C.TRANSPARENT),this._includesBackgroundColor=!1),this._currentTile1().needsColorClear()&&this._currentTile1().doDeferredClear(N.Clear.COLOR);let o=this._tileStack.popTile();return r||(this._context.setFramebuffer(n),this._context.setViewport(t.x()|0,t.y()|0,t.width()|0,t.height()|0),N.in_Context.Context_setCopyBlendState(this._context),this._blendTextureMaterial.setUniformFloat(Pn,1),this._blendTextureMaterial.setUniformSampler(Yt,o.colorTextureForSampling(),0),this._context.draw(N.Primitive.TRIANGLE_STRIP,this._blendTextureMaterial,this._quadArea),this._tileStack.freeTileToPool(o)),this._tileStack.assertPoolAfterRender(),new wf(this._includesBackgroundColor,this._didDraw?1:0,this._neededImagesOrNull)}visit(e,t,n){let r=U.new3(U.UNIT),o=oe.new3(t);o.invert();let a=o.transformRect(r);this.visitWithCanvasSpaceTileBounds(e,t,a,n)}visitWithCanvasSpaceTileBounds(e,t,n,r){this._context.annotateProfile(e.opProfileString(),()=>{this._visitWithCanvasSpaceTileBounds(e,t,n,r)})}_visitWithCanvasSpaceTileBounds(e,t,n,r){var o,a;if(n.overlaps(this.bounds(e))&&!N.FrozenScissors.isEmpty(this._currentTile1().scissors()))switch(e.op()){case 0:{let s=e;this.visitWithCanvasSpaceTileBounds(s.child,t,n,r);break}case 2:{let s=e;this._shouldDisableAllAntialiasing?this.visitWithCanvasSpaceTileBounds(s.child,t,n,r):(this.pushSSAARenderState(s.child),this.visitWithCanvasSpaceTileBounds(s.child,t,n,r),this.popSSAARenderState());break}case 1:{let s=e;for(let l of s.children){if(!N.FrozenScissors.last(this._currentTile1().scissors()).overlaps(this.allocateAndComputeTileScissor(t,this.bounds(l))))continue;let c=this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.currentBatchAA().value==2,p=l.desiredAntialiasing()==2&&!this._shouldDisableAllAntialiasing;p&&!c?this._pathRasterizer.beginBatch(2):!p&&c&&this._pathRasterizer.finishBatch(),p?l.op()==3?this._pathRasterizer.renderFill(t,l):l.op()==4&&this._pathRasterizer.renderFillStroke(t,l):this.visitWithCanvasSpaceTileBounds(l,t,n,r)}this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.finishBatch();break}case 3:{let s=e,l=this._shouldDisableAllAntialiasing?0:s.desiredAntialiasing();this._pathRasterizer.beginBatch(l),this._pathRasterizer.renderFill(t,s),this._pathRasterizer.finishBatch();break}case 4:{let s=e,l=this._shouldDisableAllAntialiasing?0:s.desiredAntialiasing();this._pathRasterizer.beginBatch(l),this._pathRasterizer.renderFillStroke(t,s),this._pathRasterizer.finishBatch();break}case 5:{let s=e,l=(s.type==0||s.type==4||s.type==1)&&s.hasNonIsolatedBlends(),d=this.allocateAndComputeTileScissor(t,this.bounds(s.color)),c=s.type==0&&!s.hasNonIsolatedBlends()&&s.alpha.isAxisAlignedRectFill()&&s.alpha.op()==3&&Oe.containsAtLeastOneVisibleOpaquePaint(s.alpha.geometry.paints),p=c?s.alpha.geometryBounds():this.bounds(s.alpha),u=s.type==2||Ce.emulateFullscreenRenderingBugs&&s.type==3?this.allocateAndComputeTileScissor(t,p):s.type==4?d:this.allocateAndComputeTileScissor(t,p).intersectedWith(d);if(c){let m=this._tileStack.takeScissorFromCurrentTile();u.intersectWith(m),this._tileStack.pushScissor(u),this.visitWithCanvasSpaceTileBounds(s.color,t,n,r),this._tileStack.popScissorFromCurrentTile(),this._tileStack.pushScissor(m);return}let h=U.new3(N.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(u);if(h.isEmpty())return;l?(this.duplicateTile1(h),this.duplicateTile1(h)):s.type==3?(this._tileStack.pushTileAndClearToColor(C.premultiplied(this._canvas.computedBackgroundColor())),this._tileStack.pushScissor(h)):this._tileStack.pushTileWithScissors1(h),this.visitWithCanvasSpaceTileBounds(s.color,t,n,r),this._tileStack.pushTileWithScissors1(h),this.visitWithCanvasSpaceTileBounds(s.alpha,t,n,r);let f=this._tileStack.popTile(),_=this._tileStack.popTile();switch(s.type){case 0:{if(l){let m=this._tileStack.popTile();this.maskTilePassThrough(m,f,_,h),this._tileStack.freeTileToPool(m)}else this.maskTile(f,_,h);break}case 1:{if(l){let m=this._tileStack.popTile();this.maskTileLuminancePassThrough(m,f,_,h),this._tileStack.freeTileToPool(m)}else this.maskTileLuminance(f,_,h);break}case 4:{if(l){let m=this._tileStack.popTile();this.maskKnockoutShadowTilePassThrough(m,f,_,h),this._tileStack.freeTileToPool(m)}else this.maskKnockoutShadowTile(f,_,h);break}case 3:{this.maskBackgroundBlurTile(f,_,h);break}case 2:{this.maskInnerShadowTile(f,_,h,s.innerShadowFill,s.innerShadowAlphaRequiresHardMask);break}}this._tileStack.freeTileToPool(f),this._tileStack.freeTileToPool(_);break}case 9:{let s=e,l=this.allocateAndComputeTileScissor(t,this.bounds(s.alpha)),d=U.new3(N.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(l);if(d.isEmpty())return;this._tileStack.pushTileWithScissors1(d),this.visitWithCanvasSpaceTileBounds(s.alpha,t,n,r);let c=this._tileStack.popTile();this.hardMaskTileWithColor(c,s.color,d),this._tileStack.freeTileToPool(c);break}case 6:{let s=e,l=U.new3(this.bounds(s));t.transformRect(l),l.scaledBy1(this.currentTextureSize());let d=s.radius*t.scale1().max1(),c=U.new3(N.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(l);if(c.isEmpty())return;if(d<1/this.currentTextureSize()){this.visitWithCanvasSpaceTileBounds(s.child,t,n,r);return}let p=_I(s.child),u=p.a,h=(o=p.b)!=null?o:Nt.FrozenAffineTransform_IDENTITY,f=u.isRectFill()?u:null;if(f!=null&&s.clamp.isInvalid()){let m=Oe.onlySolidPaintOrNull(f.geometry.paints);if(m!=null){let A=oe.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(t).multipliedBy1(h).multipliedBy1(f.transform);this.renderBlurredRectangle(A,f.geometry.path().bounds(),C.multiplyOpacity(m.color(),m.opacity()),s.radius);return}}let _=u.isRoundedRectFill()?u:null;if(_!=null&&s.clamp.isInvalid()){let m=_.geometry.path().path(),A=m.radii();if(A.isUniform()){let y=Oe.onlySolidPaintOrNull(_.geometry.paints);if(y!=null){let S=A.topLeft,g=oe.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(t).multipliedBy1(h).multipliedBy1(_.transform);this.renderBlurredRoundedRectangle(g,m.bounds(),S,C.multiplyOpacity(y.color(),y.opacity()),s.radius);return}}}this.renderBlur(e,t,d,c,r,s.clamp);break}case 7:{let s=e,l=this.allocateAndComputeTileScissor(t,this.bounds(s.child)),d=Gw(s.blendMode)&&(this._currentTile1().isColorClear()||this._currentTile1().needsColorClear())&&s.opacity==1,c=U.new3(N.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(l);if(c.isEmpty())return;d?this._currentTile1().pushScissor2(c.clone()):s.blendMode=="PASS_THROUGH"?this.duplicateTile1(c):this._tileStack.pushTileWithScissors1(c),this.visitWithCanvasSpaceTileBounds(s.child,t,n,r),d&&this._currentTile1().popScissor(),d||this.blendAndPopTile(s.blendMode,s.opacity);break}case 8:{let s=e;this.visitCompositeChildWithOpacity(s,1,t,n);break}case 10:{let s=e;switch(s.property){case 2:{let l=oe.new3(t);l.multipliedBy1(s.transform());let d=oe.new3(s.transform());d.invert()||d.copyFrom(Nt.FrozenAffineTransform_IDENTITY),d.multipliedBy1(r),this.visit(s.child,l,d);break}case 1:{let l=oe.new2();this.visitWithCanvasSpaceTileBounds(s.child,t,n,l);break}case 0:{let l=oe.new2(),d=oe.new2();l.copyFrom(t).multipliedBy1(r),this.visit(s.child,l,d);break}case 4:{let l=s.opacity(),d=!1;if(l==1)this.visitWithCanvasSpaceTileBounds(s.child,t,n,r),d=!0;else if(l==0)d=!0;else if(s.child.op()==3){let c=s.child,p=(a=Oe.onlyPaintOrNull(c.geometry.paints))==null?void 0:a.asSinglePaint();if(p!=null){let u=p.cloneAsSinglePaint();u.setOpacity(u.opacity()*l);let h=[u].slice();this.visitWithCanvasSpaceTileBounds(c.withPaints(h),t,n,r),d=!0}}else if(s.child.op()==8){let c=s.child;this.visitCompositeChildWithOpacity(c,l,t,n),d=!0}if(!d){let c=this.allocateAndComputeTileScissor(t,this.bounds(s.child)),p=U.new3(N.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(c);s.child.hasNonIsolatedBlends()?this.duplicateTile1(p):this._tileStack.pushTileWithScissors1(p),this.visitWithCanvasSpaceTileBounds(s.child,t,n,r),s.child.hasNonIsolatedBlends()?this.blendAndPopTile("PASS_THROUGH",l):this.blendAndPopTile("NORMAL",l)}break}case 3:{this.visitWithCanvasSpaceTileBounds(s.child,t,n,r);break}case 5:{this.visitWithCanvasSpaceTileBounds(s.child,t,n,r);break}default:throw new Error(`Unhandled VolatileProperty value ${za.VolatileProperty_toString(s.property)}`)}break}case 11:{let s=e,l=oe.new3(t);l.multipliedBy1(s.transform);let d=oe.new3(s.transform);d.invert()||d.copyFrom(Nt.FrozenAffineTransform_IDENTITY),d.multipliedBy1(r),this.visit(s.child,l,d);break}case 12:{let s=e,l=this.allocateAndComputeTileScissor(t,this.bounds(s.startChild)),d=this.allocateAndComputeTileScissor(t,this.bounds(s.endChild)),c=U.new2();c.copyFrom(N.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(l);let p=c.clone().scaledBy1(1/this.currentTextureSize());s.startChild.hasNonIsolatedBlends()?this.duplicateTile1(c):this._tileStack.pushTileWithScissors1(c),this.visitWithCanvasSpaceTileBounds(s.startChild,t,n,r);let u=this._tileStack.popTile();c.copyFrom(N.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(d);let h=c.clone().scaledBy1(1/this.currentTextureSize());s.endChild.hasNonIsolatedBlends()?this.duplicateTile1(c):this._tileStack.pushTileWithScissors1(c),this.visitWithCanvasSpaceTileBounds(s.endChild,t,n,r);let f=this._tileStack.popTile();this._lerpTileMaterial.setUniformSampler(Yt,u.colorTextureForSampling(),0),this._lerpTileMaterial.setUniformSampler(Tr,f.colorTextureForSampling(),1),N.in_Material.Material_setUniformVec43(this._lerpTileMaterial,nS,p),N.in_Material.Material_setUniformVec43(this._lerpTileMaterial,rS,h),this._lerpTileMaterial.setUniformFloat(Pn,tn.double_clamp(s.progress(),0,1)),N.in_Context.Context_setPremultipliedBlendState(this._context);let _=this.allocateAndComputeTileScissor(t,this.bounds(e));this._tileStack.pushScissor(_),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._lerpTileMaterial,this._quadArea),this._tileStack.popScissorFromCurrentTile(),this._tileStack.freeTileToPool(f),this._tileStack.freeTileToPool(u);break}}}visitCompositeChildWithOpacity(e,t,n,r){let o=oe.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(n),a=this.allocateAndComputeTileScissor(n,this.bounds(e));this._tileStack.pushScissor(a),e.forEachTileWithinBounds(1,r,s=>{let l=s.textureRegionOrNull();if(l!=null&&(this.drawTextureRegion2(l,s.canvasSpaceBounds(),o,1,t),s.neededImagesOrNull!=null)){let d=gd.asList(s.neededImagesOrNull);for(let c of d)this.getOrCreateImageTexture(c)}}),this._tileStack.popScissorFromCurrentTile()}allocateAndComputeTileScissor(e,t){let n=U.new3(t);e.transformRect(n);let r=n.scaledBy1(this.currentTextureSize());return X.useIntBoundariesForScissor()?r.expandToInts():r.round(),r}renderBlurredRectangle(e,t,n,r){C.alpha(n)!=0&&(N.in_Material.Material_setUniformMat32(this._rectangleBlurMaterial,Tn,e),N.in_Material.Material_setUniformVec42(this._rectangleBlurMaterial,Ko,C.premultiplied(n)),N.in_Material.Material_setUniformVec43(this._rectangleBlurMaterial,Ir,t),this._rectangleBlurMaterial.setUniformFloat(lm,r),N.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._rectangleBlurMaterial,this._quadArea),this._didDraw=!0)}renderBlurredRoundedRectangle(e,t,n,r,o){C.alpha(r)!=0&&(N.in_Material.Material_setUniformMat32(this._roundedRectangleBlurMaterial,Tn,e),N.in_Material.Material_setUniformVec42(this._roundedRectangleBlurMaterial,Ko,C.premultiplied(r)),N.in_Material.Material_setUniformVec43(this._roundedRectangleBlurMaterial,Ir,t),this._roundedRectangleBlurMaterial.setUniformFloat(lS,n/o),N.in_Material.Material_setUniformVec22(this._roundedRectangleBlurMaterial,$A,t.size().divide(2*o)),this._roundedRectangleBlurMaterial.setUniformFloat(lm,o),N.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._roundedRectangleBlurMaterial,this._quadArea),this._didDraw=!0)}renderBlur(e,t,n,r,o,a){let s=e,l=32,d=.5,c=1/(1+2*n),p=Math.min(l,c*n*this.currentTextureSize()),u=p/this.currentTextureSize(),h=u/n;h>2/d/this.currentTextureSize()&&(h=Math.round(h*(this.currentTextureSize()*d))/(this.currentTextureSize()*d),p=Math.min(l/d,h*n*this.currentTextureSize()),u=p/this.currentTextureSize());let f=oe.new2().translatedBy2(.5,.5).scaledBy2(h).translatedBy2(-.5,-.5),_=U.new3(r).scaledBy1(1/this.currentTextureSize());f.transformRect(_);let m=U.new3(_).expandedBy2(0,u),A=U.new3(m).expandedBy2(u,0),y=f.multipliedBy1(t),S=null;if(!a.isInvalid()){S=y.transformRect(a.clone()),S.scaledBy1(this.currentTextureSize());let I=Math.ceil(S.left()-.5)+.5,O=Math.ceil(S.top()-.5)+.5,w=Math.floor(S.right()+.5)-.5,P=Math.floor(S.bottom()+.5)-.5;S=new U(I,O,w-I,P-O),S.scaledBy1(1/this.currentTextureSize())}let g=p>4,b=g&&s.child.op()==9;if(this._tileStack.pushTileWithScissors1(U.new3(A).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded()),b){let I=s.child;this.visit(I.alpha,y,o)}else this.visit(s.child,y,o);let T=!1;if(g){let I=p*d,O=U.new3(A).scaledBy1(d),w=U.new3(m).scaledBy1(d),P=U.new3(_).scaledBy1(d),H=null;if(S!=null){H=U.new3(S).scaledBy1(d),H.scaledBy1(this.currentTextureSize());let M=Math.ceil(H.left()-.5)+.5,Q=Math.ceil(H.top()-.5)+.5,Y=Math.floor(H.right()+.5)-.5,B=Math.floor(H.bottom()+.5)-.5;H=new U(M,Q,Y-M,B-Q),H.scaledBy1(1/this.currentTextureSize())}let re=this._tileStack.popTile(),q=U.new3(O).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();if(this._tileStack.pushTileWithScissors2(q,T),b){let M=s.child;this.hardMaskWithColorAndDownscaleTile(re,M.color,O,A)}else this.downscaleTile(re,O,A);this._tileStack.freeTileToPool(re);let W=this._tileStack.popTile(),x=U.new3(w).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTileWithScissors2(x,T),this.blurTile(W,1/this.currentTextureSize(),0,U.new3(x).scaledBy1(1/this.currentTextureSize()),I,H),this._tileStack.freeTileToPool(W);let F=this._tileStack.popTile(),k=U.new3(P).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTileWithScissors2(k,T),this.blurTile(F,0,1/this.currentTextureSize(),U.new3(k).scaledBy1(1/this.currentTextureSize()),I,H),this._tileStack.freeTileToPool(F);let G=this._tileStack.popTile();this.upscaleTile(G,r.scaledBy1(1/this.currentTextureSize()),P),this._tileStack.freeTileToPool(G)}else{let I=this._tileStack.popTile(),O=U.new3(m).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTileWithScissors2(O,T),this.blurTile(I,1/this.currentTextureSize(),0,U.new3(O).scaledBy1(1/this.currentTextureSize()),p,S),this._tileStack.freeTileToPool(I);let w=this._tileStack.popTile(),P=U.new3(_).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTileWithScissors2(P,T),this.blurTile(w,0,1/this.currentTextureSize(),U.new3(P).scaledBy1(1/this.currentTextureSize()),p,S),this._tileStack.freeTileToPool(w);let H=this._tileStack.popTile();this.upscaleTile(H,r.scaledBy1(1/this.currentTextureSize()),_),this._tileStack.freeTileToPool(H)}}hardMaskTileWithColor(e,t,n){let r=U.new3(n);N.in_Material.Material_setUniformVec43(this._hardMaskTileWithColorMaterial,Ir,this.scissorQuad(r)),N.in_Material.Material_setUniformVec42(this._hardMaskTileWithColorMaterial,Ko,C.premultiplied(t)),e.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._hardMaskTileWithColorMaterial.setUniformSampler(Yt,e.colorTextureForSampling(),0),N.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._hardMaskTileWithColorMaterial,this._quadArea),this._didDraw=!0,e.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP)}blurTile(e,t,n,r,o,a){let s=null;a==null?s=this._unclampedBlurMaterial:(s=this._clampedBlurMaterial,N.in_Material.Material_setUniformVec43(s,HA,a)),N.in_Material.Material_setUniformVec43(s,Ir,r),s.setUniformFloat(GA,o),s.setUniformVec21(zA,t,n),s.setUniformSampler(Yt,e.colorTextureForSampling(),0),N.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,s,this._quadArea),this._didDraw=!0}scissorQuad(e){return e.scaledBy1(1/this.currentTextureSize())}blendAndPopTile(e,t){if(e=="PASS_THROUGH"||e=="NORMAL"||e=="SCREEN"){let n=this._tileStack.popTile(),r=this.scissorQuad(U.new3(N.FrozenScissors.last(n.scissors())));N.in_Material.Material_setUniformVec43(this._blendTileSimpleMaterial,Ir,r),e=="PASS_THROUGH"?(this._blendTileSimpleMaterial.setUniformFloat(Pn,1),N.in_Context.Context_setInterpolateBlendState(this._context,t)):(this._blendTileSimpleMaterial.setUniformFloat(Pn,t),e=="SCREEN"?N.in_Context.Context_setScreenBlendState(this._context):N.in_Context.Context_setPremultipliedBlendState(this._context)),n.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._blendTileSimpleMaterial.setUniformSampler(Yt,n.colorTextureForSampling(),0),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._blendTileSimpleMaterial,this._quadArea),this._didDraw=!0,n.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(n)}else{this.duplicateTile2(N.FrozenScissors.last(this._currentTile1().scissors()),1);let n=this._tileStack.popTile(),r=this._tileStack.popTile(),o=this.scissorQuad(U.new3(N.FrozenScissors.last(r.scissors())));N.in_Material.Material_setUniformVec43(this._blendTileCustomMaterial,Ir,o),this._blendTileCustomMaterial.setUniformInt($s,Hw.get(e)),this._blendTileCustomMaterial.setUniformFloat(Pn,t),r.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),n.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._blendTileCustomMaterial.setUniformSampler(Yt,r.colorTextureForSampling(),0),this._blendTileCustomMaterial.setUniformSampler(Tr,n.colorTextureForSampling(),1),N.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._blendTileCustomMaterial,this._quadArea),this._didDraw=!0,n.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(n),this._tileStack.freeTileToPool(r)}}upscaleTile(e,t,n){N.in_Material.Material_setUniformVec43(this._upscaleTileMaterial,Ir,t),N.in_Material.Material_setUniformVec43(this._upscaleTileMaterial,hu,n),this._upscaleTileMaterial.setUniformSampler(Yt,e.colorTextureForSampling(),0),N.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._upscaleTileMaterial,this._quadArea),this._didDraw=!0}downscaleTile(e,t,n){N.in_Material.Material_setUniformVec43(this._downscaleTileMaterial,Ir,t),N.in_Material.Material_setUniformVec43(this._downscaleTileMaterial,hu,n),this._downscaleTileMaterial.setUniformSampler(Yt,e.colorTextureForSampling(),0),N.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._downscaleTileMaterial,this._quadArea),this._didDraw=!0}hardMaskWithColorAndDownscaleTile(e,t,n,r){N.in_Material.Material_setUniformVec43(this._hardMaskWithColorAndDownscaleTileMaterial,Ir,n),N.in_Material.Material_setUniformVec43(this._hardMaskWithColorAndDownscaleTileMaterial,hu,r),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformSampler(Yt,e.colorTextureForSampling(),0),N.in_Material.Material_setUniformVec42(this._hardMaskWithColorAndDownscaleTileMaterial,Ko,C.premultiplied(t)),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformFloat(iS,this.currentTextureSize()),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformFloat(ZA,1/this.currentTextureSize()),N.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._hardMaskWithColorAndDownscaleTileMaterial,this._quadArea),this._didDraw=!0}_advanceGIFAndUpload(e,t){let n=e.gif().nextFrameIfNecessary();n!=null&&N.in_Texture.Texture_resize3(t,e.width(),e.height(),new yn(0,e.width(),e.height(),n))}getOrCreateImageTexture(e){var o,a;if((e==null?void 0:e.image)==null)return null;this._neededImagesOrNull!=null&&gd.add(this._neededImagesOrNull,e);let t=e.image,n=e.purpose,r=t.texture();return r!=null?t.gif()!=null&&this._advanceGIFAndUpload(t,r):(((o=t.decodedData())==null?void 0:o.pixels)!=null||t.gif()!=null)&&(r=N.in_Context.Context_createTexture1(this._context,N.TextureFormat.RGBA_NEAREST_CLAMP,t.width(),t.height(),"Image"),r.setShouldUnloadImageBuffer(Xe.isMobile(Xe.current())||Xe.current()==4&&navigator.maxTouchPoints>0||wt.forceMobileOptimizations()),t.setTexture(r),((a=t.decodedData())==null?void 0:a.pixels)!=null?(N.in_Texture.Texture_resize3(t.texture(),t.width(),t.height(),t.decodedData()),(Xe.isMobile(Xe.current())||Xe.current()==4&&navigator.maxTouchPoints>0||wt.forceMobileOptimizations())&&t.freeMemoryForDecodedData()):t.gif()!=null&&this._advanceGIFAndUpload(t,r)),t.state()==0&&this._requestImage(t,n),r}duplicateTile1(e){this.duplicateTile2(e,0)}duplicateTile2(e,t){let n=this._currentTile2(t),r=n.isColorClear()||n.needsColorClear(),o=r;this._tileStack.pushTile2(o);let a=this._currentTile1();if(this._tileStack.pushScissor(e),a.bind(),r)return;let s=n.colorTextureForSampling();s.setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP);let l=n.uvSpaceRect(),d=this.scissorQuad(U.new3(e)),c=new U(l.x()+l.width()*d.x(),l.y()+l.height()*d.y(),l.width()*d.width(),l.height()*d.height()),p=new U(-1+2*d.x(),-1+2*d.y(),2*d.width(),2*d.height());this.drawTexture1(s,c,null,p,0),s.setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP)}maskBackgroundBlurTile(e,t,n){Ce.flushBeforeMasks()&&this._context.flush();let r=U.new3(n);N.in_Material.Material_setUniformVec43(this._maskBackgroundBlurTileMaterial,Ir,this.scissorQuad(r)),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._maskBackgroundBlurTileMaterial.setUniformSampler(Yt,t.colorTextureForSampling(),0),this._maskBackgroundBlurTileMaterial.setUniformSampler(Tr,e.colorTextureForSampling(),1),N.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._maskBackgroundBlurTileMaterial,this._quadArea),this._didDraw=!0,e.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP)}maskInnerShadowTile(e,t,n,r,o){Ce.flushBeforeMasks()&&this._context.flush();let a=U.new3(n),s=o?this._maskInnerShadowTileAndFirstHardMaskAlpha:this._maskInnerShadowTileMaterial;N.in_Material.Material_setUniformVec43(s,Ir,this.scissorQuad(a)),N.in_Material.Material_setUniformVec42(s,Ko,C.premultiplied(r)),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),s.setUniformSampler(Yt,t.colorTextureForSampling(),0),s.setUniformSampler(Tr,e.colorTextureForSampling(),1),N.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,s,this._quadArea),e.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTile(e,t,n){Ce.flushBeforeMasks()&&this._context.flush();let r=U.new3(n);N.in_Material.Material_setUniformVec43(this._maskTileMaterial,Ir,this.scissorQuad(r)),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTileMaterial.setUniformSampler(Yt,t.colorTextureForSampling(),0),this._maskTileMaterial.setUniformSampler(Tr,e.colorTextureForSampling(),1),N.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._maskTileMaterial,this._quadArea),e.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminance(e,t,n){Ce.flushBeforeMasks()&&this._context.flush();let r=U.new3(n);N.in_Material.Material_setUniformVec43(this._maskTileLuminanceMaterial,Ir,this.scissorQuad(r)),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTileLuminanceMaterial.setUniformSampler(Yt,t.colorTextureForSampling(),0),this._maskTileLuminanceMaterial.setUniformSampler(Tr,e.colorTextureForSampling(),1),N.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._maskTileLuminanceMaterial,this._quadArea),e.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminancePassThrough(e,t,n,r){Ce.flushBeforeMasks()&&this._context.flush();let o=U.new3(r);N.in_Material.Material_setUniformVec43(this._maskTileLuminancePassThroughMaterial,Ir,this.scissorQuad(o)),n.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTileLuminancePassThroughMaterial.setUniformSampler(Yt,n.colorTextureForSampling(),0),this._maskTileLuminancePassThroughMaterial.setUniformSampler(Tr,e.colorTextureForSampling(),1),this._maskTileLuminancePassThroughMaterial.setUniformSampler(pu,t.colorTextureForSampling(),2),N.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._maskTileLuminancePassThroughMaterial,this._quadArea),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTilePassThrough(e,t,n,r){Ce.flushBeforeMasks()&&this._context.flush();let o=U.new3(r);N.in_Material.Material_setUniformVec43(this._maskTilePassThroughMaterial,Ir,this.scissorQuad(o)),n.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTilePassThroughMaterial.setUniformSampler(Yt,n.colorTextureForSampling(),0),this._maskTilePassThroughMaterial.setUniformSampler(Tr,e.colorTextureForSampling(),1),this._maskTilePassThroughMaterial.setUniformSampler(pu,t.colorTextureForSampling(),2),N.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._maskTilePassThroughMaterial,this._quadArea),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTile(e,t,n){Ce.flushBeforeMasks()&&this._context.flush();let r=U.new3(n);N.in_Material.Material_setUniformVec43(this._maskKnockoutShadowTileMaterial,Ir,this.scissorQuad(r)),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._maskKnockoutShadowTileMaterial.setUniformSampler(Yt,t.colorTextureForSampling(),0),this._maskKnockoutShadowTileMaterial.setUniformSampler(Tr,e.colorTextureForSampling(),1),N.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._maskKnockoutShadowTileMaterial,this._quadArea),e.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTilePassThrough(e,t,n,r){Ce.flushBeforeMasks()&&this._context.flush();let o=U.new3(r);N.in_Material.Material_setUniformVec43(this._maskKnockoutShadowTilePassThroughMaterial,Ir,this.scissorQuad(o)),n.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_NEAREST_CLAMP),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(Yt,n.colorTextureForSampling(),0),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(Tr,e.colorTextureForSampling(),1),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(pu,t.colorTextureForSampling(),2),N.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._maskKnockoutShadowTilePassThroughMaterial,this._quadArea),t.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(N.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}downsampleSuperSSAATile(e){let t=this.downscaleRectForSSAA(N.FrozenScissors.last(e.scissors()).clone());t.expand1(1),t.round(),this._tileStack.pushScissor(t);let n=null;switch(Wr.SUPERSAMPLE_COUNT()){case 4:{n=this._superSSAA4x4DownsampleMaterial;break}case 2:{n=this._blendTextureMaterial;break}default:throw new Error(`Unrecognized SUPERSAMPLE_COUNT (${Wr.SUPERSAMPLE_COUNT()}) when downsampling`)}n.setUniformFloat(Pn,1),n.setUniformSampler(Yt,e.colorTextureForSampling(),0),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,n,this._quadArea),this._tileStack.popScissorFromCurrentTile()}drawTextureRegion1(e,t,n){this.drawTextureRegion2(e,t,Nt.FrozenAffineTransform_IDENTITY,n,1)}drawTextureRegion2(e,t,n,r,o){let a=e.uvSpaceRect,s=null;if(e.texture.format().minFilter==N.PixelFilter.LINEAR||e.texture.format().magFilter==N.PixelFilter.LINEAR){s=a.clone();let l=1/e.texture.width();s.contract(l/2)}this.drawTexture2(e.texture,e.uvSpaceRect,s,t,n,r,o)}drawTexture1(e,t,n,r,o){this.drawTexture2(e,t,n,r,Nt.FrozenAffineTransform_IDENTITY,o,1)}drawTexture2(e,t,n,r,o,a,s){this._setupDrawTextureState(e,t,n,r,o,a,s),this.drawToCurrentTile(N.Primitive.TRIANGLE_STRIP,this._drawTextureMaterial,this._quadArea),this._didDraw=!0}drawTextureToCurrentFramebuffer(e,t,n,r,o,a,s){this._setupDrawTextureState(e,t,n,r,o,a,s),this._context.draw(N.Primitive.TRIANGLE_STRIP,this._drawTextureMaterial,this._quadArea)}_setupDrawTextureState(e,t,n,r,o,a,s){switch(a){case 0:{N.in_Context.Context_setCopyBlendState(this._context);break}case 1:{N.in_Context.Context_setPremultipliedBlendState(this._context);break}}N.in_Material.Material_setUniformVec43(this._drawTextureMaterial,tS,n!=null?n:t),N.in_Material.Material_setUniformVec43(this._drawTextureMaterial,aS,t),N.in_Material.Material_setUniformMat32(this._drawTextureMaterial,dS,o),N.in_Material.Material_setUniformVec43(this._drawTextureMaterial,sS,r),this._drawTextureMaterial.setUniformFloat(Pn,s),this._drawTextureMaterial.setUniformSampler(Yt,e,0)}constructor(e,t){this._canvas=null,this._backgroundEnabled=!0,this._didDraw=!1,this._includesBackgroundColor=!1,this._boundsCache=null,this._canvasSpaceTileBounds=null,this._neededImagesOrNull=null,this._context=null,this._quadArea=null,this._bufferPool=null,this._transparentClearTexture=null,this._tileStack=null,this._ssaaState=new Rf,this._downsampleNeedsBlend=!1,this._shouldDisableAllAntialiasing=!1,this._clampedBlurMaterial=null,this._unclampedBlurMaterial=null,this._rectangleBlurMaterial=null,this._roundedRectangleBlurMaterial=null,this._upscaleTileMaterial=null,this._downscaleTileMaterial=null,this._hardMaskWithColorAndDownscaleTileMaterial=null,this._blendTextureMaterial=null,this._lerpTileMaterial=null,this._blendTileSimpleMaterial=null,this._blendTileCustomMaterial=null,this._maskInnerShadowTileMaterial=null,this._maskInnerShadowTileAndFirstHardMaskAlpha=null,this._maskBackgroundBlurTileMaterial=null,this._maskTileMaterial=null,this._maskTileLuminanceMaterial=null,this._maskTileLuminancePassThroughMaterial=null,this._maskTilePassThroughMaterial=null,this._maskKnockoutShadowTileMaterial=null,this._maskKnockoutShadowTilePassThroughMaterial=null,this._hardMaskTileWithColorMaterial=null,this._drawTextureMaterial=null,this._clearOnWindowsMaterial=null,this._superSSAA4x4DownsampleMaterial=null,this._requestImage=null,this._pathRasterizer=null,this._layerByLayerRendering=new kp,this._context=e,this._bufferPool=t,this._quadArea=this._bufferPool.allocate(N.VertexFormat.POSITION_F2_COORD_F3,new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._transparentClearTexture=e.createTexture2(N.TextureFormat.RGBA_LINEAR_CLAMP,1,1,new Uint8Array([0,0,0,0]),"Transparent clear texture"),this._tileStack=new i.TileStack(e,(r,o)=>{this.clear(r,o)},this._transparentClearTexture),this._pathRasterizer=new Wr(this,this._context,this._bufferPool);let n=this._context.graphicsCardName();Ce.setFlushBeforeMasks(n.indexOf("NVIDIA")!=-1&&n.indexOf("Direct3D11")!=-1||X.getFeatureFlags().flushBeforeMasks),this._clampedBlurMaterial=this._context.createMaterial("clampedBlur",N.VertexFormat.POSITION_F2_COORD_F3,$r,lA),this._unclampedBlurMaterial=this._context.createMaterial("unclampedBlur",N.VertexFormat.POSITION_F2_COORD_F3,$r,cA),this._rectangleBlurMaterial=this._context.createMaterial("rectangleBlur",N.VertexFormat.POSITION_F2_COORD_F3,uA,pA),this._roundedRectangleBlurMaterial=this._context.createMaterial("roundedRectangleBlur",N.VertexFormat.POSITION_F2_COORD_F3,hA,mA),this._upscaleTileMaterial=this._context.createMaterial("upscaleTile",N.VertexFormat.POSITION_F2_COORD_F3,J_,eA),this._downscaleTileMaterial=this._context.createMaterial("downscaleTile",N.VertexFormat.POSITION_F2_COORD_F3,nm,tA),this._hardMaskWithColorAndDownscaleTileMaterial=this._context.createMaterial("hardMaskWithColorAndDownscaleTile",N.VertexFormat.POSITION_F2_COORD_F3,nm,nA),this._blendTextureMaterial=this._context.createMaterial("blendTexture",N.VertexFormat.POSITION_F2_COORD_F3,ac,rm),this._lerpTileMaterial=this._context.createMaterial("lerpTexture",N.VertexFormat.POSITION_F2_COORD_F3,ac,dA),this._clearOnWindowsMaterial=this._context.createMaterial("clearOnWindows",N.VertexFormat.POSITION_F2_COORD_F3,ac,du),this._blendTileSimpleMaterial=this._context.createMaterial("blendTileSimple",N.VertexFormat.POSITION_F2_COORD_F3,$r,rm),this._blendTileCustomMaterial=this._context.createMaterial("blendTileCustom",N.VertexFormat.POSITION_F2_COORD_F3,$r,xA),this._maskInnerShadowTileMaterial=this._context.createMaterial("maskInnerShadowTile",N.VertexFormat.POSITION_F2_COORD_F3,$r,TA),this._maskInnerShadowTileAndFirstHardMaskAlpha=this._context.createMaterial("maskInnerShadowTileAndFirstHardMaskAlpha",N.VertexFormat.POSITION_F2_COORD_F3,$r,IA),this._maskBackgroundBlurTileMaterial=this._context.createMaterial("maskBackgroundBlurTile",N.VertexFormat.POSITION_F2_COORD_F3,$r,vA),this._maskTileMaterial=this._context.createMaterial("maskTile",N.VertexFormat.POSITION_F2_COORD_F3,$r,gA),this._maskTileLuminanceMaterial=this._context.createMaterial("maskTileLuminance",N.VertexFormat.POSITION_F2_COORD_F3,$r,fA),this._maskTileLuminancePassThroughMaterial=this._context.createMaterial("maskTileLuminancePassThrough",N.VertexFormat.POSITION_F2_COORD_F3,$r,_A),this._maskTilePassThroughMaterial=this._context.createMaterial("maskTilePassThrough",N.VertexFormat.POSITION_F2_COORD_F3,$r,AA),this._maskKnockoutShadowTileMaterial=this._context.createMaterial("maskKnockoutShadowTile",N.VertexFormat.POSITION_F2_COORD_F3,$r,SA),this._maskKnockoutShadowTilePassThroughMaterial=this._context.createMaterial("maskKnockoutShadowTile",N.VertexFormat.POSITION_F2_COORD_F3,$r,yA),this._hardMaskTileWithColorMaterial=this._context.createMaterial("hardMaskWithColor",N.VertexFormat.POSITION_F2_COORD_F3,$r,bA),this._drawTextureMaterial=this._context.createMaterial("drawTexture",N.VertexFormat.POSITION_F2_COORD_F3,rA,oA),this._superSSAA4x4DownsampleMaterial=this._context.createMaterial("superSSAA4x4Downsample",N.VertexFormat.POSITION_F2_COORD_F3,ac,iA)}renderLayerByLayerActivate(e){this._layerByLayerRendering.activate(e)}renderLayerByLayerDeactivate(){this._layerByLayerRendering.deactivate()}finishLayerByLayerDrawToScreen(){this._layerByLayerRendering.finishLayerByLayerDrawToScreen()}isLayerByLayerRenderingEnabled(){return this._layerByLayerRendering.isEnabled()}treeToRender(e){return this._layerByLayerRendering.treeToRender(e)}renderLayerByLayerPlay(){this._layerByLayerRendering.play()}renderLayerByLayerPause(){this._layerByLayerRendering.pause()}renderLayerByLayerForward(){this._layerByLayerRendering.forward()}renderLayerByLayerBackward(){this._layerByLayerRendering.backward()}renderLayerByLayerRewind(){this._layerByLayerRendering.rewind()}renderLayerByLayerIncreaseSpeed(){this._layerByLayerRendering.increaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._layerByLayerRendering.decreaseSpeed()}};(n=>{class i{constructor(){if(arguments.length==7){let o=arguments[0],a=arguments[1],s=arguments[2],l=arguments[3],d=arguments[4],c=arguments[5],p=arguments[6];this.renderTree=null,this.isRenderingWholeCanvas=!1,this.backgroundClearColor=0,this.boundsCache=null,this.shouldCollectNeededImages=!1,this.requestImage=null,this.shouldDisableAllAntialiasing=!1,this.shouldRenderDirectlyToOutputTexture=!1,this.outputTextureNeedsClear=!1,this.renderTree=o,this.isRenderingWholeCanvas=a,this.backgroundClearColor=s,this.shouldCollectNeededImages=l,this.boundsCache=d,this.requestImage=c,this.shouldDisableAllAntialiasing=p}else if(arguments.length==9){let o=arguments[0],a=arguments[1],s=arguments[2],l=arguments[3],d=arguments[4],c=arguments[5],p=arguments[6],u=arguments[7],h=arguments[8];this.renderTree=null,this.isRenderingWholeCanvas=!1,this.backgroundClearColor=0,this.boundsCache=null,this.shouldCollectNeededImages=!1,this.requestImage=null,this.shouldDisableAllAntialiasing=!1,this.shouldRenderDirectlyToOutputTexture=!1,this.outputTextureNeedsClear=!1,this.renderTree=o,this.isRenderingWholeCanvas=a,this.backgroundClearColor=s,this.shouldCollectNeededImages=l,this.boundsCache=d,this.requestImage=c,this.shouldDisableAllAntialiasing=p,this.shouldRenderDirectlyToOutputTexture=u,this.outputTextureNeedsClear=h}}}n.Options=i;class e{constructor(o,a,s){this._context=null,this._clear=null,this._transparentClearTexture=null,this._tilePools=new Map([[gn.TILE_SIZE,[]],[Wr.SSAA_SIZE(),[]]]),this._stack=[],this._tileSizeState=n.TileStack.TileSizeState.REGULAR,this._liveTileCount=new Map([[gn.TILE_SIZE,0],[Wr.SSAA_SIZE(),0]]),this._sharedStencilTexture=null,this._sharedSSAAStencilTexture=null,this._context=o,this._clear=a,this._transparentClearTexture=s}setSSAARenderState(){this._tileSizeState=n.TileStack.TileSizeState.SUPERSAMPLING}unsetSSAARenderState(){this._tileSizeState=n.TileStack.TileSizeState.REGULAR}isEmpty(){return this._stack.length==0}count(){return this._stack.length}get(o){return this._stack[o]}last(){return this._stack.length==0?null:ce.List_last(this._stack)}assertPoolAfterRender(){}popScissorFromCurrentTile(){ce.List_last(this._stack).popScissor()}takeScissorFromCurrentTile(){return ce.List_last(this._stack).takeScissor()}freeTileToPool(o){o.clearScissors(),o.setIsColorClear(!1),o.setNeedsColorClear(!0),o.setNeedsDepthStencilClear(!0),o.tileSize()==Wr.SSAA_SIZE()?this._tilePools.get(Wr.SSAA_SIZE()).push(o):this._tilePools.get(gn.TILE_SIZE).push(o)}pushScissor(o){ce.List_last(this._stack).pushScissor2(o.clone())}pushTileWithScissors1(o){this.pushTileWithScissors2(o,!0)}pushTileWithScissors2(o,a){this.pushTile2(a),this.pushScissor(o)}pushTile1(){this.pushTile2(!0)}pushTile2(o){let a=this._allocateTileFromPool();this._stack.push(a),a.bind(),o||a.setNeedsColorClear(!1),a.backingColorTexture().hasContentBeenInitialized()||a.setNeedsColorClear(!0),a.backingDepthStencilTexture()!=null&&!a.backingDepthStencilTexture().hasContentBeenInitialized()&&a.setNeedsDepthStencilClear(!0)}pushTileAndClearToColor(o){this.pushTile1(),o!=C.TRANSPARENT&&ce.List_last(this._stack).clearToColor(o)}pushTileBackedByExistingFramebuffer(o,a,s){let l=!s,d=new n.TileStackTile(1,this._context,o,a,this._clear,l,this._transparentClearTexture);this._stack.push(d),d.bind(),d.setNeedsColorClear(s),d.setNeedsDepthStencilClear(s)}pushTileBackedByExistingFramebufferAndClearToColor(o,a,s,l){this.pushTileBackedByExistingFramebuffer(o,a,s),l!=C.TRANSPARENT&&ce.List_last(this._stack).clearToColor(l)}popTile(){let o=this._stack.pop(),a=this.last();return a!=null?a.bind():this._context.setFramebuffer(null),o}totalVRAM(){let o=0;this._sharedStencilTexture!=null&&(o=o+N.in_Texture.Texture_totalVRAM(this._sharedStencilTexture));for(let a of this._tilePools.get(gn.TILE_SIZE))o=o+N.in_Texture.Texture_totalVRAM(a.backingColorTexture());for(let a of this._tilePools.get(Wr.SSAA_SIZE()))o=o+N.in_Texture.Texture_totalVRAM(a.backingColorTexture());for(let a of this._stack)o=o+N.in_Texture.Texture_totalVRAM(a.backingColorTexture());return o}_pool(){return this._tileSizeState==n.TileStack.TileSizeState.REGULAR?this._tilePools.get(gn.TILE_SIZE):this._tilePools.get(Wr.SSAA_SIZE())}_size(){return this._tileSizeState==n.TileStack.TileSizeState.REGULAR?gn.TILE_SIZE:Wr.SSAA_SIZE()}_purpose(){return this._tileSizeState==n.TileStack.TileSizeState.REGULAR?"TileStack":"SSAATileStack"}_allocateTileFromPool(){let o=this._pool(),a=this._size(),s=this._purpose(),l=null;if(o!=null&&o.length!=0)l=o.pop();else{this._liveTileCount.set(a,this._liveTileCount.get(a)+1);let d=null;s=="TileStack"?(this._sharedStencilTexture==null&&(this._sharedStencilTexture=N.in_Context.Context_createTexture1(this._context,N.TextureFormat.STENCIL,a,a,s)),d=this._sharedStencilTexture):s=="SSAATileStack"&&(this._sharedSSAAStencilTexture==null&&(this._sharedSSAAStencilTexture=N.in_Context.Context_createTexture1(this._context,N.TextureFormat.STENCIL,a,a,s)),d=this._sharedSSAAStencilTexture),l=new n.TileStackTile(0,a,s,d,this._context,this._clear,this._transparentClearTexture)}return l}_isAllocatedUnusedTile(o){return o!=null&&o!=this.last()&&this._stack.indexOf(o)==-1&&this._tilePools.get(gn.TILE_SIZE).indexOf(o)==-1&&this._tilePools.get(Wr.SSAA_SIZE()).indexOf(o)==-1}}n.TileStack=e,(a=>{let r;(d=>(d[d.REGULAR=0]="REGULAR",d[d.SUPERSAMPLING=1]="SUPERSAMPLING"))(r=a.TileSizeState||(a.TileSizeState={}));let o;(l=>{function s(d){return n.TileStack.TileSizeState[d]}l.TileSizeState_toString=s})(o=a.in_TileSizeState||(a.in_TileSizeState={}))})(e=n.TileStack||(n.TileStack={}));class t{constructor(){if(arguments[0]==0){let[,o,a,s,l,d,c]=arguments;this._context=null,this._clear=null,this._framebuffer=null,this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=null,this._isColorClear=!1,this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=l,this._clear=d,this._framebuffer=this._context.createFramebuffer(N.in_Context.Context_createTexture1(this._context,N.TextureFormat.RGBA_LINEAR_CLAMP,o,o,a),s,a),this._framebuffer.setViewport(0,0,o,o),this._isBackedBySingleTileTexture=!0,this._transparentClearTexture=c,this._isColorClear=!0}else if(arguments[0]==1){let[,o,a,s,l,d,c]=arguments;this._context=null,this._clear=null,this._framebuffer=null,this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=null,this._isColorClear=!1,this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=o,this._clear=l,this._framebuffer=a,this._framebuffer.setViewport(s.x()|0,s.y()|0,gn.TILE_SIZE,gn.TILE_SIZE),this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=c,this._isColorClear=d}}uvSpaceRect(){if(this._isBackedBySingleTileTexture)return U.UNIT;{let o=this._framebuffer.viewport(),a=this._framebuffer.colorTexture();return new U(o.x()/a.width(),o.y()/a.height(),o.width()/a.width(),o.height()/a.height())}}tileSize(){return this._framebuffer.viewport().width()|0}colorTextureForSampling(){return this._isColorClear||this._needsColorClear?this._transparentClearTexture:this._framebuffer.colorTexture()}backingColorTexture(){return this._framebuffer.colorTexture()}backingDepthStencilTexture(){return this._framebuffer.depthStencilTexture()}context(){return this._context}framebuffer(){return this._framebuffer}isBackedBySingleTileTexture(){return this._isBackedBySingleTileTexture}deleteTexture(){this._framebuffer.deleteTexture()}popScissor(){this._framebuffer.popScissor()}takeScissor(){let o=this._framebuffer.takeScissor();if(this._isBackedBySingleTileTexture)return o;let a=this._framebuffer.viewport();return o.setX(o.x()-a.x()),o.setY(o.y()-a.y()),o}scissors(){let o=this._framebuffer.scissors();if(this._isBackedBySingleTileTexture)return o;let a=[],s=this._framebuffer.viewport();for(let l=0,d=N.FrozenScissors.count(o);l<d;l=l+1){let c=U.new3(N.FrozenScissors.get(o,l));c.setX(c.x()-s.x()),c.setY(c.y()-s.y()),a.push(c)}return a}pushScissor1(o,a,s,l){if(this._isBackedBySingleTileTexture)this._framebuffer.pushScissor1(o,a,s,l);else{let d=this._framebuffer.viewport();this._framebuffer.pushScissor1((d.x()|0)+o,(d.y()|0)+a,s,l)}}pushScissor2(o){this.pushScissor1(o.x()|0,o.y()|0,o.width()|0,o.height()|0)}clearScissors(){this._framebuffer.clearScissors()}updateScissor(){this._framebuffer.updateScissor()}bind(){this._context.setFramebuffer(this._framebuffer)}clearToColor(o){if(this.needsColorClear()||this.needsDepthStencilClear()){let s=this.needsColorClear()&&this.needsDepthStencilClear()?N.Clear.ALL:this.needsColorClear()?N.Clear.COLOR:N.Clear.DEPTH_STENCIL;this.doDeferredClear(s)}if(o==C.TRANSPARENT&&this.isColorClear())return;let a=this._framebuffer.takeAllScissors();if(!this._isBackedBySingleTileTexture){let s=this._framebuffer.viewport();this._framebuffer.pushScissor1(s.x()|0,s.y()|0,s.width()|0,s.height()|0)}this._clear(o,this._framebuffer),this._isBackedBySingleTileTexture||this._framebuffer.popScissor(),this._framebuffer.replaceAllScissors(a),this._isColorClear=o==C.TRANSPARENT}doDeferredClear(o){let a=this._framebuffer.takeAllScissors();if(!this._isBackedBySingleTileTexture){let s=this._framebuffer.viewport();this._framebuffer.pushScissor1(s.x()|0,s.y()|0,s.width()|0,s.height()|0)}N.in_Context.Context_clear1(this._context,o),this._isBackedBySingleTileTexture||this._framebuffer.popScissor(),this._framebuffer.replaceAllScissors(a),(o==N.Clear.ALL||o==N.Clear.COLOR)&&(this._needsColorClear=!1,this._isColorClear=!0),(o==N.Clear.ALL||o==N.Clear.DEPTH_STENCIL)&&(this._needsDepthStencilClear=!1)}setNeedsColorClear(o){this._needsColorClear=o}needsColorClear(){return this._needsColorClear}setNeedsDepthStencilClear(o){this._needsDepthStencilClear=o}needsDepthStencilClear(){return this._needsDepthStencilClear}setIsColorClear(o){this._isColorClear=o}isColorClear(){return this._isColorClear}}n.TileStackTile=t})(zi||(zi={}));var Nf=class{constructor(e,t,n){this.node=e,this.transform=t,this.backgroundColor=n}},Of=(t=>(t[t.REPLACE=0]="REPLACE",t[t.BLEND=1]="BLEND",t))(Of||{}),Cf=(t=>(t[t.PATHS_ONLY=0]="PATHS_ONLY",t[t.GROUP=1]="GROUP",t))(Cf||{}),Rf=class{constructor(){this.level=0,this.mode=0}},uI;(e=>{function i(t){return md[t]}e.ImagePurpose_toString=i})(uI||(uI={}));var pI;(e=>{function i(t){return gI[t]}e.DrawTileWorkStatus_toString=i})(pI||(pI={}));var hI;(e=>{function i(t){return Of[t]}e.CompositeMode_toString=i})(hI||(hI={}));var mI;(e=>{function i(t){return Cf[t]}e.SupersampleMode_toString=i})(mI||(mI={}));function Up(i,e,t){return t==null?C.BLACK:i!=null?e==4?t.computedBackgroundColor():X.prototypeBackgroundColorOverride!=null&&X.prototypeBackgroundColorOverride.value!=C.TRANSPARENT?C.rgbaToRgb(X.prototypeBackgroundColorOverride.value):t.prototypeBackgroundColor()!=C.TRANSPARENT?C.rgbaToRgb(t.prototypeBackgroundColor()):C.BLACK:t.computedBackgroundColor()}function Gw(i){switch(i){case"PASS_THROUGH":case"NORMAL":case"DARKEN":case"MULTIPLY":case"LINEAR_BURN":case"COLOR_BURN":case"LIGHTEN":case"SCREEN":case"LINEAR_DODGE":case"COLOR_DODGE":case"OVERLAY":case"SOFT_LIGHT":case"HARD_LIGHT":case"DIFFERENCE":case"EXCLUSION":case"HUE":case"SATURATION":case"COLOR":case"LUMINOSITY":return!0;default:break}return!1}var Hw=new Map([["PASS_THROUGH",0],["NORMAL",1],["DARKEN",2],["MULTIPLY",3],["LINEAR_BURN",4],["COLOR_BURN",5],["LIGHTEN",6],["SCREEN",7],["LINEAR_DODGE",8],["COLOR_DODGE",9],["OVERLAY",10],["SOFT_LIGHT",11],["HARD_LIGHT",12],["DIFFERENCE",13],["EXCLUSION",14],["HUE",15],["SATURATION",16],["COLOR",17],["LUMINOSITY",18]]),Lp=new Map([["SOLID",0],["GRADIENT_LINEAR",1],["GRADIENT_RADIAL",2],["GRADIENT_ANGULAR",3],["GRADIENT_DIAMOND",4],["IMAGE",5],["EMOJI",6],["VIDEO",7]]);var Vl=(o=>(o[o.OTHER=0]="OTHER",o[o.PRERENDER_FULLSIZE=1]="PRERENDER_FULLSIZE",o[o.PRERENDER_THUMB=2]="PRERENDER_THUMB",o[o.ON_SCREEN_FULLSIZE=3]="ON_SCREEN_FULLSIZE",o[o.ON_SCREEN_THUMB=4]="ON_SCREEN_THUMB",o))(Vl||{}),Ai=class Ai{compare(e){let t=At.int_compare(this.type,e.type);return t!=0?t:At.int_compare(this.generation,e.generation)}toString(){return`${Vl[this.type]}:${this.generation}`}static advanceGeneration(){Ai._generation=Ai._generation+1}static forType(e){return new Ai(e,Ai._generation)}static forOnScreenPurpose(e){let t=Wa.ImagePriorityType_forOnScreenPurpose(e);return Ai.forType(t)}static forPrerenderPurpose(e){let t=Wa.ImagePriorityType_forPrerenderPurpose(e);return Ai.forType(t)}static max(e,t){return e.compare(t)>0?e:t}constructor(e,t){this.type=e,this.generation=t}};Ai.OTHER=new Ai(0,0),Ai._generation=0;var Nr=Ai,Hp=class{insertOrUpdate(e,t){let n=this._queue.getPriority(e);(n==null||t.compare(n.value)>0)&&this._queue.insertOrUpdate(e,t)}peek(){return this._queue.peek()}getPriority(e){let t=this._queue.getPriority(e);return t!=null?new Se(t.value):null}maxPriority(){return this._queue.count()==0?null:new Se(this._queue.maxPriority())}remove(e){this._queue.remove(e)}clear(){this._queue=new pa((e,t)=>e.compare(t))}allImages(){return this._queue.allValues()}count(){return this._queue.count()}isEmpty(){return this.count()==0}takeFirst(){return this._queue.pop()}constructor(){this._queue=new pa((e,t)=>e.compare(t))}},Wa;(o=>{function i(a){return a==3||a==4}o.ImagePriorityType_isOnScreen=i;function e(a){return a==1||a==2}o.ImagePriorityType_isPrerender=e;function t(a){switch(a){case 0:return 3;case 1:case 2:return 4}throw new Error("Unhandled case")}o.ImagePriorityType_forOnScreenPurpose=t;function n(a){switch(a){case 0:return 1;case 1:case 2:return 2}throw new Error("Unhandled case")}o.ImagePriorityType_forPrerenderPurpose=n;function r(a){return Vl[a]}o.ImagePriorityType_toString=r})(Wa||(Wa={}));var fd=class{constructor(e){this._imagesByNodeId=null,this._nodeIdsByImage=null,e.addAppObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage=new wo(t=>t.objectHash())}imagesUsedByNode(e){return Le.StringMap_get(this._imagesByNodeId,e,new Map)}nodesUsedByImage(e){return Array.from(this._nodeIdsByImage.get(e,new Map).values())}nodesThatUseAnImage(){return Array.from(this._imagesByNodeId.keys())}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage.clear(),t!=null&&this._addImageNodeReferencesInSubtree(t.root())}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}_trackImageUse(e,t){this._imagesByNodeId.has(e.id())||this._imagesByNodeId.set(e.id(),new Map),this._imagesByNodeId.get(e.id()).set(t.objectHash(),t),this._nodeIdsByImage._in(t)||this._nodeIdsByImage.set(t,new Map),this._nodeIdsByImage.get1(t).set(e.id(),e.id())}_removeImageUse(e,t){Array.from(this._imagesByNodeId.keys()).indexOf(e.id())!=-1&&(this._imagesByNodeId.get(e.id()).delete(t.objectHash()),this._imagesByNodeId.get(e.id()).size==0&&this._imagesByNodeId.delete(e.id())),this._nodeIdsByImage._in(t)&&(this._nodeIdsByImage.get1(t).delete(e.id()),this._nodeIdsByImage.get1(t).size==0&&this._nodeIdsByImage.remove(t))}handleSceneGraphEvent(e){let t=io.affectsImagesUsedByNode(e.property);if(!(!(t||e.property==8||e.property==25)||!(e.node.isVisibleInCanvas()||e.property==8&&$.asBool(e.oldVal)&&!$.asBool(e.newVal)&&(e.node.parent()!=null&&e.node.parent().isVisibleInCanvas())))){if(t){let r=e.node.collectUniqueUsedImages(),o=Le.StringMap_get(this._imagesByNodeId,e.node.id(),new Map);for(let a of Array.from(o.keys()))r.has(a)||this._removeImageUse(e.node,o.get(a));for(let a of Array.from(r.keys()))o.has(a)||this._trackImageUse(e.node,r.get(a))}else if(e.property==8){let r=$.asBool(e.oldVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1),o=$.asBool(e.newVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1);!r&&o?this._addImageNodeReferencesInSubtree(e.node):r&&!o&&this._removeImageNodeReferencesInSubtree(e.node)}else if(e.property==25){let r=e.oldVal!=null&&$.isParentIndex(e.oldVal)?$.asParentIndex(e.oldVal):null,o=e.newVal!=null&&$.isParentIndex(e.newVal)?$.asParentIndex(e.newVal):null,a=r!=null?e.node.scene().findNode1(r.id):null,s=o!=null?e.node.scene().findNode1(o.id):null,l=a!=null&&a.isRooted(),d=s!=null&&s.isRooted();l&&!d?this._removeImageNodeReferencesInSubtree(e.node):!l&&d&&this._addImageNodeReferencesInSubtree(e.node)}}}_removeImageNodeReferencesInSubtree(e){for(let t=0,n=e.childCount();t<n;t=t+1)this._removeImageNodeReferencesInSubtree(e.childAt1(t));e.forEachSinglePaint(t=>{(t.type()=="IMAGE"||t.type()=="EMOJI"||t.type()=="VIDEO")&&(t.image()!=null&&this._removeImageUse(e,t.image()),t.imageThumbnail()!=null&&this._removeImageUse(e,t.imageThumbnail()))}),e.forEachEmojiInTextData(t=>{this._removeImageUse(e,t)})}_addImageNodeReferencesInSubtree(e){if(e.visible()){for(let t=0,n=e.childCount();t<n;t=t+1)this._addImageNodeReferencesInSubtree(e.childAt1(t));e.forEachSinglePaint(t=>{(t.type()=="IMAGE"||t.type()=="EMOJI"||t.type()=="VIDEO")&&(t.image()!=null&&this._trackImageUse(e,t.image()),t.imageThumbnail()!=null&&this._trackImageUse(e,t.imageThumbnail()))}),e.forEachEmojiInTextData(t=>{this._trackImageUse(e,t)})}}};var Qp=$a(Xs());var xf=class{constructor(){this.numTransitions=0,this.numTransitionsWithAnimation=0,this.numNodesWithSmartAnimateTransitionType=0,this.numNodesWithSmartAnimateExtension=0,this.numSlidesPushesOrMovesWithPreserveScrollPosition=0,this.numDragTriggers=0}};var _d=class{constructor(e){this._noodleMap=new ha,this._cachedCleanedUpTransitionMapByTlf=null,this._scene=null,this._appState=null,this.triggerPotentialTimedTransition=null,this.createVideoTriggerEventsForNodesInFrame=null,this.createVideoTriggerEventsForAllNodesOnscreen=null,this._topmostScreenChangeCounter=0,this._appState=e,this._appState.addAppObserver(this)}_setPrototypeInteractionsInNoodleMap(e,t){t.some(r=>r.isValid())?this._noodleMap.update(e,t):this._noodleMap.update(e,[])}_setHyperlinkInteractionInNoodleMap(e){if(Wt.isNodeInteractableBecauseOfHyperlinks(e)){let t=Wt.createFakeHyperlinkInteraction();this._setPrototypeInteractionsInNoodleMap(e,[t].slice())}}cleanedUpInteractionMap(){return new ha.CleanedMap(this._noodleMap,0,e=>{var n;let t=(n=this._scene)==null?void 0:n.findNode1(e);return Wt.cleanedInteractionsForNode(this._appState,t)})}cleanedUpTransitionMap(){return new ha.CleanedMap(this._noodleMap,1,e=>{let t=[];return this.cleanedUpInteractionMap().getHotspotInteractions(e).forEach(n=>{n.interactionContainsTransitionAction()&&t.push(n)}),t})}cleanedUpTransitionMapByTLF(){if(this._cachedCleanedUpTransitionMapByTlf==null){let e=new wo(t=>t);for(let t of this.cleanedUpTransitionMap().hotspots()){let n=this._scene.findNode1(t);if(n!=null){let r=null,o=n.topLevelAncestor();o!=null&&o.visible()&&(r=o.id()),r!=null&&(e._in(r)||e.set(r,[]),ce.List_append2(e.get1(r),this.cleanedUpTransitionMap().getHotspotInteractions(t).slice()))}}this._cachedCleanedUpTransitionMapByTlf=e}return this._cachedCleanedUpTransitionMapByTlf}transitionStats__DEPRECATED(){let e=new xf;for(let t of this.cleanedUpTransitionMap().hotspots())this.cleanedUpTransitionMap().getHotspotInteractions(t).forEach(n=>{e.numTransitions=e.numTransitions+1,n.event().interactionType()=="DRAG"&&(e.numDragTriggers=e.numDragTriggers+1);let r=n.action()!=null?n.action().value:null;if(r!=null){r.transitionDuration()>0&&(e.numTransitionsWithAnimation=e.numTransitionsWithAnimation+1),r.transitionType()=="SMART_ANIMATE"&&(e.numNodesWithSmartAnimateTransitionType=e.numNodesWithSmartAnimateTransitionType+1),kn.supportsSmartAnimate(r.transitionType())&&r.transitionShouldSmartAnimate()&&(e.numNodesWithSmartAnimateExtension=e.numNodesWithSmartAnimateExtension+1);let o=kn.isSlide(r.transitionType())||kn.isPush(r.transitionType())||kn.isMove(r.transitionType());r.transitionPreserveScroll()&&o&&(e.numSlidesPushesOrMovesWithPreserveScrollPosition=e.numSlidesPushesOrMovesWithPreserveScrollPosition+1)}});return e}rawInteractionMapForTests(){return new ha.RawMapForTests(this._noodleMap)}rawNoodleMap(){return this._noodleMap}handleSceneChange(e,t){this._scene=t,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){this._noodleMap.noodleNodes.clear(),t!=null&&this._addConnectionsFromSubtree(t),this._cachedCleanedUpTransitionMapByTlf=null}handleActivePrototypeStartingPointChange(e,t){}_addConnectionsFromSubtree(e){this._setPrototypeInteractionsInNoodleMap(e,e.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e);for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);this._addConnectionsFromSubtree(r)}}_removeConnectionsFromSubtree(e){this._noodleMap.update(e,[]);for(let t=0,n=e.childCount();t<n;t=t+1)this._removeConnectionsFromSubtree(e.childAt1(t))}topmostScreenChangeCounter(){return this._topmostScreenChangeCounter}handleSceneGraphEvent(e){let t=!1;if((io.isInteractionProperty(e.property)||io.affects(e.property,82))&&(e.node.isRooted()&&(this._setPrototypeInteractionsInNoodleMap(e.node,e.node.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e.node),t=!0),ne.equals(this._appState.baseScreenId(),e.node.id())&&e.node.prototypeInteractions().forEach(n=>{this._topmostScreenChangeCounter=this._topmostScreenChangeCounter+1,n.event().interactionType()=="AFTER_TIMEOUT"?this.triggerPotentialTimedTransition!=null&&this.triggerPotentialTimedTransition():(n.event().interactionType()=="ON_MEDIA_HIT"||n.event().interactionType()=="ON_MEDIA_END")&&this.createVideoTriggerEventsForAllNodesOnscreen!=null&&this.createVideoTriggerEventsForAllNodesOnscreen()})),e.property==8||e.property==9||e.property==14||e.property==81)t=!0,this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node),this._noodleMap.invalidateHotspotAndChildren(e.node);else if(e.property==25){let n=e.oldVal!=null&&$.isParentIndex(e.oldVal)?$.asParentIndex(e.oldVal):null,r=e.newVal!=null&&$.isParentIndex(e.newVal)?$.asParentIndex(e.newVal):null,o=n!=null?e.node.scene().findNode1(n.id):null,a=r!=null?e.node.scene().findNode1(r.id):null,s=o!=null&&o.isRooted(),l=a!=null&&a.isRooted();s&&!l?(this._removeConnectionsFromSubtree(e.node),t=!0):!s&&l&&(this._addConnectionsFromSubtree(e.node),t=!0,this.createVideoTriggerEventsForNodesInFrame!=null&&this.createVideoTriggerEventsForNodesInFrame(e.node)),s&&l&&o.id()!=a.id()&&(t=!0),this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node)}t&&(this._cachedCleanedUpTransitionMapByTlf=null)}},yI=(t=>(t[t.CLEANED_INTERACTIONS=0]="CLEANED_INTERACTIONS",t[t.CLEANED_TRANSITIONS=1]="CLEANED_TRANSITIONS",t))(yI||{}),zp=class{invalidateCaches(){this.caches.set(0,null),this.caches.set(1,null)}constructor(){this.interactions=new ta(e=>e.id()),this.backReferences=new wo(e=>e),this.caches=new Map([[0,null],[1,null]])}},ha=class{update(e,t){var o,a,s;let n=(s=(a=(o=this.noodleNodes.get(e.id(),null))==null?void 0:o.interactions)==null?void 0:a.asList())!=null?s:[];for(let l=0,d=n.length;l<d;l=l+1){let c=n[l];this._eraseInteraction(e,c)}for(let l=0,d=t.length;l<d;l=l+1){let c=t[l];this._addInteraction(e,c)}let r=this.noodleNodes.get(e.id(),null);r!=null&&r.interactions.count()==0&&r.backReferences.count()==0&&this.noodleNodes.remove(e.id())}_addInteraction(e,t){var o;let n=e.id(),r=(o=this.noodleNodes.get(n,null))!=null?o:new zp;this.noodleNodes.set(n,r),r.interactions.add(t);for(let a of t.allActions()){let s=a.transitionNodeID();if(SI(s,a.connectionType())){let l=this.noodleNodes.get(s,null);l==null&&(l=new zp,this.noodleNodes.set(s,l)),l.backReferences.set(n,l.backReferences.get(n,0)+1)}}r.invalidateCaches()}_eraseInteraction(e,t){let n=e.id(),r=this.noodleNodes.get(n,null);r!=null&&r.interactions.remove(t);for(let o of t.allActions()){let a=o.transitionNodeID();if(SI(a,o.connectionType())){let s=this.noodleNodes.get(a,null);s!=null&&(s.backReferences.set(n,s.backReferences.get1(n)-1),s.backReferences.get1(n)<=0&&s.backReferences.remove(n))}}r.invalidateCaches()}invalidateHotspotAndChildren(e){be.forEachNode1(e,t=>(this.noodleNodes._in(t.id())&&this.noodleNodes.get1(t.id()).invalidateCaches(),be.Loop.CONTINUE))}invalidateBackRefsForDestinationAndChildren(e){be.forEachNode1(e,t=>(this.noodleNodes._in(t.id())&&this.noodleNodes.get1(t.id()).backReferences.each((r,o)=>{this.noodleNodes.get1(r).invalidateCaches()}),be.Loop.CONTINUE))}constructor(){this.noodleNodes=new wo(e=>e)}};(t=>{class i{_in(r){return this.noodleMap.noodleNodes._in(r)&&this.getHotspotInteractions(r).length!=0}hotspots(){return this.noodleMap.noodleNodes.keys().filter(r=>this.getHotspotInteractions(r).length!=0)}getHotspotInteractions(r){return this.noodleMap.noodleNodes.get1(r).interactions.asList()}constructor(r){this.noodleMap=r}}t.RawMapForTests=i;class e{_in(r){return this.noodleMap.noodleNodes._in(r)?this.getHotspotInteractions(r).length!=0:!1}hotspots(){return this.noodleMap.noodleNodes.keys().filter(r=>this.getHotspotInteractions(r).length!=0)}getHotspotInteractions(r){let o=this.noodleMap.noodleNodes.get1(r);return o.caches.get(this.cacheType)==null&&o.caches.set(this.cacheType,this.computeCacheForHotspot(r)),o.caches.get(this.cacheType)}constructor(r,o,a){this.noodleMap=r,this.cacheType=o,this.computeCacheForHotspot=a}}t.CleanedMap=e})(ha||(ha={}));var AI;(e=>{function i(t){return yI[t]}e.NoodleCache_toString=i})(AI||(AI={}));function SI(i,e){return i!=null&&ne.isValid(i)&&(e=="INTERNAL_NODE"||e=="UPDATE_MEDIA_RUNTIME")}var Ul=(t=>(t[t.ALL=0]="ALL",t[t.NESTED_ONLY=1]="NESTED_ONLY",t))(Ul||{}),Bo=class{constructor(){if(arguments.length==1){let e=arguments[0];this.node=null,this.hyperlink=null,this.node=e}else if(arguments.length==2){let e=arguments[0],t=arguments[1];this.node=null,this.hyperlink=null,this.node=e,this.hyperlink=t}}canvasSpaceScrolledInteractiveBounds(e){let t=this.node.canvasSpaceScrolledInteractiveBounds(e);return this.hyperlink!=null?Jn.FrozenRect_new4(this.hyperlink.bounds.x+t.x(),this.hyperlink.bounds.y+t.y(),this.hyperlink.bounds.w,this.hyperlink.bounds.h):t}},Wi=(t=>(t[t.NONLINEAR=0]="NONLINEAR",t[t.FRAME_LIST=1]="FRAME_LIST",t))(Wi||{}),kl=class{asScreen(){return null}asSmartAnimate(){return null}constructor(){}};kl.MAX_PRERENDER_JOB_COUNT=10;var Qn=class i extends kl{constructor(t,n,r,o,a){super();this.nodeId=t,this.role=n,this.overlayStackPosition=r,this.prototypeAction=o,this.precedingOverlays=a}asScreen(){return this}hash(){let t=`${this.nodeId}-${i.FrameRole[this.role]}`;return this.role==i.FrameRole.OVERLAY?t+`-${this.overlayStackPosition}`:t}static forBaseScreen(t){return new i(t,i.FrameRole.BASE_SCREEN,0,null,null)}static forOverlay(t,n,r,o){return new i(t,i.FrameRole.OVERLAY,n,r,o)}};(t=>{let i;(o=>(o[o.BASE_SCREEN=0]="BASE_SCREEN",o[o.OVERLAY=1]="OVERLAY"))(i=t.FrameRole||(t.FrameRole={}));let e;(r=>{function n(o){return t.FrameRole[o]}r.FrameRole1_toString=n})(e=t.in_FrameRole1||(t.in_FrameRole1={}))})(Qn||(Qn={}));var Pf=class extends kl{constructor(t,n,r,o,a){super();this.srcNodeId=t,this.dstNodeId=n,this.role=r,this.transitionType=o,this.easingFunction=a}asSmartAnimate(){return this}hash(){return`Smart animate ${this.srcNodeId} -> ${this.dstNodeId} w/ ${this.transitionType}`}},Ad;(e=>{function i(t,n){if(n=="URL"){if(t!="ON_CLICK"&&t!="MOUSE_UP")return!1}else if(n=="BACK"&&(t=="ON_HOVER"||t=="ON_PRESS"))return!1;return!0}e.isValidForConnection=i})(Ad||(Ad={}));var Wt=class i{constructor(e){this._nodeTransitionTracker=null,this._appState=null,this._emitter=null,this._cachedPrerenderJobList=[],this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1,this._appState=e,this._emitter=$t.getEventEmitter(),this._appState.addAppObserver(this),this._appState.prototypeState().addObserver(this),this._nodeTransitionTracker=new _d(e),this._appState.addFrameObserver(this)}nodeTransitionTracker(){return this._nodeTransitionTracker}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActiveCanvasChange(e,t){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActivePrototypeStartingPointChange(e,t){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleSceneGraphEvent(e){if(io.isPrototypeStructuralChange(e.property)||e.property==14||e.property==81||e.property==9||e.property==24){this._cachedPrerenderJobList=null;let t=this._appState.prototypeState();t.isApplyingStateChangeMutation()||t.isResettingStateChangeMutations()||(this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0)}}onFrame(){this._shouldNotifyTopLevelPrototypeNodesInvalidated&&(this._emitter.trigger("topLevelFramesListInvalidated",null),this._emitter.trigger("navigationInfoInvalidated",null),this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1)}handleStateChangeAborted(e){this._cachedPrerenderJobList=null}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){this._cachedPrerenderJobList=null}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}_scene(){return this._appState.scene()}_baseScreenId(){return this._appState.prototypeState().getCurrentBaseScreenId()}getPrerenderingJobs(e){return this._cachedPrerenderJobList==null&&(this._cachedPrerenderJobList=this.computePrerenderJobsForStartNode(this._baseScreenId(),kl.MAX_PRERENDER_JOB_COUNT)),this._cachedPrerenderJobList}currentType(){return this._scene()==null||this._appState.getActiveCanvas()==null?1:this.topLevelPrototypeStartingPointNodeIdsSorted().length>0||X.getViewerMode()==X.ViewerMode.MIRROR?0:1}activePrototypeStartNodeOrDefault(){if(this._scene()==null)return null;if(this._appState.activePrototypeStartingPointNodeId()!=null){let t=this._scene().findNode1(this._appState.activePrototypeStartingPointNodeId());if(t!=null)return t}let[e]=this.topLevelPrototypeStartingPointNodeIdsSorted();return e?this._scene().findNode1(ne.fromString(e)):null}nodeToRestartPrototypeOn(e){if(e==null||e.type()!="CANVAS"&&e.type()!="SECTION")return null;let t=this.activePrototypeStartNodeOrDefault();if(t!=null)return t;let n=i.visuallySortedTopLevelFrames(e);return n.length>0?n[0]:null}getDestinationFrame(e){var n,r,o;let t=(n=this._scene())==null?void 0:n.findNode1(e);if(t==null)return null;if(t.type()=="SECTION"){let a=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(t.id()),s=(r=this._scene())==null?void 0:r.findNode1(a);if((s==null?void 0:s.type())=="SECTION")for(;s.type()!="FRAME";)a=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(a),s=(o=this._scene())==null?void 0:o.findNode1(a);return s}return t}validDestinationForPrototypeFromId(e){let t=this.getDestinationFrame(e);return t==null||!t.isTopLevel()||!t.isVisibleInCanvas()||t.isStateGroup()?null:t}topLevelPrototypeNodesInOrder(){return this.currentType()==1?i.visuallySortedTopLevelFrames(this._appState.getActiveCanvas()).map(e=>e.id()):this._appState.prototypeState().getTlfHistory()}topLevelPrototypeStartingPointNodeIdsSorted(){if(this._scene()==null)return console.error("topLevelPrototypeStartingPointNodeIdsSorted when we don't have a valid scene"),[];let e=this._appState.getActiveCanvas();return e==null||e.type()!="CANVAS"?[]:i.topLevelStartingPointFramesSorted(e).map(n=>n.id())}prototypeStartingPointsData(){let e=this._appState.getActiveCanvas();if(e==null||e.type()!="CANVAS")return null;let t=i.topLevelStartingPointFramesSorted(e),n=[];for(let r of t){if(r.type()=="SECTION")continue;let o={id:r.id(),name:r.prototypeStartingPoint().name,description:r.prototypeStartingPoint().description};n.push(o)}return n}prerenderJobsForBaseScreen(){return this.prerenderJobsAfter(Qn.forBaseScreen(this._baseScreenId()))}prerenderJobsAfter(e){var a;let t=(a=this._scene())==null?void 0:a.findNode1(e.nodeId);if(t==null)return[];let n=new Map,r=[],o=s=>{n.has(s.hash())||(n.set(s.hash(),!0),r.push(s))};if(e.role==0){let s=this.topLevelPrototypeNodesInOrder(),l=s.indexOf(e.nodeId);if(l!=-1){let d=l+1,c=null;d<s.length?c=ne.fromString(s[d]):this.currentType()==1?c=this._appState.prototypeState().getNextBaseScreenIdForFrameList():c=this._appState.prototypeState().getNextBaseScreenIdForPrototype(),c!=null&&o(Qn.forBaseScreen(c))}}return this.forTransitionInFrame(t,s=>{for(let l of s.allActions()){if(l==null||!ne.isValid(l.transitionNodeID()))return!0;let d=l.transitionType(),c=!1;if(l.navigationType()=="SWAP_STATE")return!0;if(e.role==0&&(d=="SMART_ANIMATE"||kn.supportsSmartAnimate(d)&&l.transitionShouldSmartAnimate())&&(c=!0),e.role==1&&d=="SMART_ANIMATE"&&l.navigationType()=="SWAP"&&(c=!0),c&&o(new Pf(t.id(),l.transitionNodeID(),e.role,d,l.easingFunction)),l.navigationType()=="NAVIGATE"){o(Qn.forBaseScreen(l.transitionNodeID()));let p=this._scene().findNode1(l.transitionNodeID());p!=null&&p.setUsedAsBaseScreen(!0)}else if(l.navigationType()=="OVERLAY"){let p=e.precedingOverlays!=null?e.precedingOverlays.slice():[];p.push(l.transitionNodeID()),o(Qn.forOverlay(l.transitionNodeID(),e.overlayStackPosition+1,l,p));let u=this._scene().findNode1(l.transitionNodeID());u!=null&&u.setUsedAsBaseScreen(!1)}else if(l.navigationType()=="SWAP"){if(e.role==1){let p=e.precedingOverlays!=null?e.precedingOverlays.slice():null;p!=null&&(p[p.length-1]=l.transitionNodeID()),o(Qn.forOverlay(l.transitionNodeID(),e.overlayStackPosition,l,p))}else o(Qn.forBaseScreen(l.transitionNodeID()));this._scene().findNode1(l.transitionNodeID()).setUsedAsBaseScreen(e.role==0)}}return!0}),r}prerenderJobForPreviousNode(){return this.prerenderJobForNodeBefore(this._baseScreenId())}prerenderJobForNodeBefore(e){var o;if(((o=this._scene())==null?void 0:o.findNode1(e))==null)return null;let n=this.topLevelPrototypeNodesInOrder(),r=n.indexOf(e);if(r!=-1){let a=r-1;if(a>=0)return Qn.forBaseScreen(ne.fromString(n[a]))}return null}computePrerenderJobsForStartNode(e,t){if(e==null)return[];let n=[Qn.forBaseScreen(e)],r=[Qn.forBaseScreen(e)],o=new Map,a=0;for(o.set(n[0].hash(),!0);a<n.length;){let s=n[a],l=[],d=this.prerenderJobForNodeBefore(s.nodeId);if(d!=null&&l.push(d),ce.List_append2(l,this.prerenderJobsAfter(s)),l.forEach(c=>{if(r.length<t&&!o.has(c.hash())){let p=c.asScreen();p!=null&&n.push(p),r.push(c),o.set(c.hash(),!0)}}),n.length==t)break;a=a+1}return r}forTransitionInFrame(e,t){let n=this._nodeTransitionTracker.cleanedUpTransitionMapByTLF();if(n._in(e.id())){let r=n.get1(e.id());for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];if(!t(s))return}}}forInteractionInFrame(e,t){this.forInteractionInFrames([e],t)}getInteractionsGroupedByType(e){let t=this._nodeTransitionTracker.cleanedUpInteractionMap(),n={};for(let r of t.hotspots()){let o=this._scene().findNode1(r);if(o!=null)for(let a of e)a!=null&&a.isAncestorOf(o)&&t.getHotspotInteractions(r).forEach(s=>{let l=s.event().interactionType().toString();n[l]||(n[l]=[]),n[l].push({node:o,interaction:s})})}return n}static getNodeInteractionPairs(e,t){if(t!==null&&(X.prototypeMouseMovePerf()||X.getFeatureFlags().prototypeNewMousePerf))return t[e]||[]}forInteractionInFrames(e,t){let n=this._nodeTransitionTracker.cleanedUpInteractionMap();for(let r of n.hotspots()){let o=this._scene().findNode1(r);if(o!=null)for(let a of e)a!=null&&a.isAncestorOf(o)&&n.getHotspotInteractions(r).forEach(s=>{t(o,s)})}}forHotspotInMap(e,t){for(let n of Array.from(e.keys())){let r=this._scene().findNode2(n),o=!1;if(i.isNodeInteractableBecauseOfHyperlinks(r)){for(let a of e.get(n))for(let s of a.allActions())if(s.connectionURL()=="HYPERLINK"){for(let l of r.textHyperlinkBoxes())t(new Bo(r,l)),o=!0;break}}o||t(new Bo(r))}}findPrototypeInteractionWithId(e,t){let n=this._scene().findNode2(e),r=i.cleanedInteractionsForNode(this._appState,n);for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];if(s.id()==t)return s}return null}findPrototypeInteractionsWithTransition(e,t){let n=this._scene().findNode2(e),r=i.cleanedInteractionsForNode(this._appState,n),o=[];return r.forEach(a=>{for(let s of a.getAllValidTransitionActionsInInteraction())if(s!=null&&s.transitionNodeID()==t){o.push(a);break}}),o}findPrototypeInteractionsWithInteractionType(e,t){let n=i.cleanedInteractionsForNode(this._appState,e);if(n.length==0)return n;let r=[],o=[];return n.forEach(a=>{a.event().interactionType()==t&&(a.action()!=null&&a.action().value.navigationType()=="SWAP_STATE"?o.push(a):r.push(a))}),e.isInstanceSublayer()&&o.sort((a,s)=>{var c,p;let l=jt.whichInstanceToSwap(e,(c=a.action())==null?void 0:c.value.transitionNodeID()).stablePath(),d=jt.whichInstanceToSwap(e,(p=s.action())==null?void 0:p.value.transitionNodeID()).stablePath();return l.guids.length<d.guids.length?-1:1}),ce.List_append2(r,o),r}findHotspotsWithInteractionFilter(e,t,n,r){return this.findHotspotsWithNoodleFilter(e,t,(o,a)=>n(a),r)}findHotspotsWithInteractionFilterWithinMultipleNodes(e,t,n){return this.findHotspotsWithNoodleFilterWithinMultipleNodes(e,t,(r,o)=>n(o))}findHotspotsWithNoodleFilter(e,t,n,r){let o=[];return e==null?o:this.findHotspotsWithNoodleFilterWithinMultipleNodes(new Set([e]),t,n,r)}findHotspotsWithNoodleFilterWithinMultipleNodes(e,t,n,r){let o=[];if(e==null||e.size==0)return o;let a=new Map,s=(l,d)=>{!n(l,d)||!d.allActions().some(p=>Ad.isValidForConnection(d.event().interactionType(),p.connectionType()))||(a.has(l.id())||a.set(l.id(),[]),a.get(l.id()).push(d))};if(r)for(let l of r)s(l.node,l.interaction);else this.forInteractionInFrames(Array.from(e.values()),s);return this.forHotspotInMap(a,l=>{(t==0||!e.has(l.node))&&o.push(l)}),o.sort((l,d)=>l.node.isAboveInLayerOrder(d.node)?-1:1),o}findHotspotsWithInteractionType(e,t,n,r){return this.findHotspotsWithInteractionFilter(e,t,o=>o.event().interactionType()==n,r)}findAllHotspots(e,t){return this.findHotspotsWithInteractionFilter(e,t,n=>!0)}hotspotOnPresentedNode(e,t,n,r){let o=n!="MOUSE_OUT"&&n!="MOUSE_LEAVE",a=this._appState.prototypeStructure().findHotspotsWithInteractionType(e,0,n,r),s=null;for(let l of a)l.canvasSpaceScrolledInteractiveBounds(0).contains2(t)==o&&(s==null||l.node.isAboveInLayerOrder(s.node))&&(s=l);return s}static createFakeHyperlinkInteraction(){let e=new eo("ON_CLICK",null,null,{},null,null),t=new tr(null,null,null,null,null,null,"URL","HYPERLINK",null,null,null,null,null,null,null,null,null,null,null,null,null,null);return new jt(ne.invalid(),e,[t],!1,0)}static hasValidTopLevelFrameInSection(e){for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);if(i.isValidTopLevelFrameForPrototype(r))return!0}return!1}static isValidTopLevelFrameForPrototype(e){return e==null||!e.isTopLevel()||!e.isVisibleInCanvas()||e.isStateGroup()?!1:e.type()=="SECTION"?i.hasValidTopLevelFrameInSection(e):e.type()=="SLIDE"?!0:!(e.type()!="FRAME"||e.isResizeToFit())}static cleanedInteractionsForNode(e,t){let n=[];if(t==null)return n;let r=t.prototypeInteractions();for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];if(s.actions()==null||s.actions().length==0)continue;let l=[];for(let d=0,c=s.actions().length;d<c;d=d+1){let p=s.actions()[d],u=null;if(ne.isValid(p.transitionNodeID())){let h=e.getActiveCanvas(),f=i.cleanedUpTransitionDestinationId(h,t==null?void 0:t.id(),p.transitionNodeID(),p.navigationType(),p.connectionType());f!==null&&f!=null&&(u=p.withTransitionNodeID(f)),p.navigationType()=="SWAP_STATE"&&!t.scene().interactiveComponentsEnabled()&&(u=null)}else t.isVisibleInCanvas()&&i.isPrototypeActionInteractableBecauseOfConnection(p)&&(u=p);u!=null&&l.push(u)}l.length!=0&&n.push(s.withActions(l))}return n.length==0&&i.isNodeInteractableBecauseOfHyperlinks(t)&&n.push(i.createFakeHyperlinkInteraction()),n}static cleanedUpTransitionDestinationId(e,t,n,r,o){return L._prototypeLib.modules().prototype.cleanedUpTransitionDestination(e!=null?e.handle():-1,t,n,be.schema.NavigationType[r],be.schema.ConnectionType[o])}static visuallySortedTopLevelFrames(e){if(e==null)return[];let t=[];for(let o=0,a=e.childCount();o<a;o=o+1){let s=e.childAt1(o);i.isValidTopLevelFrameForPrototype(s)&&t.push(s)}let n=i.visuallySortLayersLeftToRightAndTopToBottom1(t),r=[];for(let o=0,a=n.length;o<a;o=o+1){let s=n[o];i.isValidTopLevelFrameForPrototype(s)&&(s.type()=="SECTION"?ce.List_append2(r,i.visuallySortedTopLevelFrames(s)):r.push(s))}return r}static visuallySortLayersLeftToRightAndTopToBottom1(e){let t=e.slice();return t.sort((n,r)=>{let o=n.fullSizeCanvasSpaceBoundingBox(),a=r.fullSizeCanvasSpaceBoundingBox();return a.top()<=o.bottom()&&a.bottom()>=o.top()?o.x()==a.x()?Wn.string_compare(n.id(),r.id()):o.x()-a.x()|0:o.y()-a.y()|0}),t}static visuallySortLayersLeftToRightAndTopToBottom2(e,t){let n=[];for(let o of t){let a=e.findNode1(o);a!=null&&n.push(a)}return i.visuallySortLayersLeftToRightAndTopToBottom1(n).map(o=>o.id())}static adjacentBaseScreens(e,t){let n=t.scene(),r=new ta(s=>s),o=null,a=new Cr;return o=s=>{if(s==null||a._in(s.id())||!e._in(s.id()))return;a.add(s.id());let l=e.get1(s.id());for(let d=0,c=l.length;d<c;d=d+1){let p=l[d];for(let u of p.allActions()){if(u==null||!ne.isValid(u.transitionNodeID()))continue;let h=n.findNode1(u.transitionNodeID());if(h==null){Ke("null destination when finding reachable TLFs?");continue}let f=u.connectionType()!="UPDATE_MEDIA_RUNTIME"&&u.connectionType()!="SET_VARIABLE";u.navigationType()=="NAVIGATE"&&f||u.navigationType()=="SWAP"&&ne.equals(s.id(),t.id())?r.add(h.id()):(u.navigationType()=="OVERLAY"||u.navigationType()=="SWAP")&&o(h)}}},o(t),r}static topLevelStartingPointFramesInSection(e){let t=[],n=[];for(n.push(e);n.length>0;){let r=n.shift();for(let o=0,a=r.childCount();o<a;o=o+1){let s=r.childAt1(o);s.isTopLevel()&&hc(s)&&t.push(s),s.type()=="SECTION"&&n.push(s)}}return t}static topLevelStartingPointFramesSorted(e){let t=[];for(let n=0,r=e.childCount();n<r;n=n+1){let o=e.childAt1(n);if(o.type()=="SECTION"){let a=i.topLevelStartingPointFramesInSection(o);ce.List_append2(t,a)}o.isTopLevel()&&hc(o)&&t.push(o)}return t.sort((n,r)=>dn.compare(n.prototypeStartingPoint().position,r.prototypeStartingPoint().position)),t}static isNodeInteractableBecauseOfHyperlinks(e){return e.type()=="TEXT"&&e.textHyperlinkBoxes().length>0}static isPrototypeActionInteractableBecauseOfConnection(e){return e.connectionURL()!=null||e.connectionType()=="BACK"||e.connectionType()=="CLOSE"||e.connectionType()=="SET_VARIABLE"||e.connectionType()=="UPDATE_MEDIA_RUNTIME"||e.connectionType()=="CONDITIONAL"}},bI;(e=>{function i(t){return Ul[t]}e.HotspotPredicate_toString=i})(bI||(bI={}));var TI;(e=>{function i(t){return Wi[t]}e.PrototypeType_toString=i})(TI||(TI={}));var Wp=class{constructor(e,t,n,r){this.node=e,this.property=t,this.oldVal=n,this.newVal=r}},Si=class Si{constructor(e,t){this._listeners=new Set;this._handle=0,this._observers=new nr,this._nodes=new Map,this._cachedRoot=null,this._interactiveComponentsEnabled=!1,this._isBetweenJoinStartAndJoinEnd=!1,this._loadedTlfs=[],this._deferUnregisteringNodes=!1,this._deferredUnregisters=null,this._interactiveComponentsEnabled=t==0,this._handle=e}handle(){return this._handle}interactiveComponentsEnabled(){return this._interactiveComponentsEnabled}setInteractiveComponentsEnabledForTesting(e){this._interactiveComponentsEnabled=e}firstUserCanvasOrNull(){for(let e=0,t=this.root().childCount();e<t;e=e+1){let n=this.root().childAt1(e);if(n.type()=="CANVAS"&&!n.isInternalOnly())return n}return null}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}broadcastPropertyChange(e){Si.VERBOSE&&console.log(`broadcasting change for property '${Ot[e.property]}' on node '${e.node.id()}'`),this._observers.forEach(t=>{t.handleSceneGraphEvent(e)});for(let t of this._listeners)t()}onChange(e){return this._listeners.add(e),()=>{var t;return(t=this._listeners)==null?void 0:t.delete(e)}}isLoadedTlfsEmpty(){return this._loadedTlfs.length==0}setAllTlfsLoaded(){this.setTlfsLoaded(e=>!0)}setTlfsLoaded(e){this._loadedTlfs=[],be.forEachNode1(this.root(),t=>t.type()=="DOCUMENT"||t.type()=="CANVAS"||t.type()=="SECTION"?be.Loop.CONTINUE:t.isTopLevel()?(t.setHasBeenLoaded(e(t)),t.hasBeenLoaded()&&this._loadedTlfs.push(t),be.Loop.CONTINUE):be.Loop.SKIP)}hierarchyDebugString(){let e="",t=(n,r)=>{let o=n.symbolID(),a=o!=null?` -> ${o}`:"";e+=`${r}${n.id()} ${n.name()}${a}
`,r+="  ";for(let s=0,l=n.childCount();s<l;s=s+1)t(n.childAt1(s),r)};return t(this.root(),""),e}dangerouslyRegisterNode(e){if(e.scene()!=this)throw new Error("Scene mismatch when registering node");let t=this.findNode2(e.id());if(t!=null&&t!=e)throw new Error("Unexpected existing node when registering node");this._nodes.set(e.id(),e)}dangerouslyUnregisterNode(e){if(this._deferUnregisteringNodes){this._deferredUnregisters.push(e);return}this._nodes.delete(e),ne.isRoot(e)&&(this._cachedRoot=null)}dangerouslyDeferNodeRemovalScope(e){this._deferredUnregisters=[],this._deferUnregisteringNodes=!0,e(),this._deferUnregisteringNodes=!1;for(let t of this._deferredUnregisters)this.dangerouslyUnregisterNode(t);this._deferredUnregisters=null}markLoaded(){var e;(e=L._prototypeLib)==null||e.markSceneLoaded(this)}destroy(){var e;(e=L._prototypeLib)==null||e.destroyScene(this)}setFileKey(e){var t;(t=L._prototypeLib)==null||t.modules().prototype.setSceneMetadata(e)}applyMessageToScene(e){var r;let t=Qe.milliseconds();(r=L._prototypeLib)==null||r.applyNodeChanges(e);let n=Qe.milliseconds()-t;n>100&&console.warn(`applyMessageToScene took ${n/1e3} seconds`)}totalNodeCount(){return this._nodes.size}each(e){Le.StringMap_each(this._nodes,(t,n)=>{e(n)})}findNode1(e){return this.findNode2(e)}findNode2(e){return e==null?null:Le.StringMap_get(this._nodes,e,null)}findNode3(e){if(e==null||e.guids==null)return null;let t=L._prototypeLib.findNode(this,e);return this.findNode1(t)}findStyle(e){let t=L._prototypeLib.sceneGraphTsApi().styleByIdOrNull(e);return this.findNode1(t)}createNode1(e){return this.createNode2(e,new Mt([e]))}createNode2(e,t){if(!L.isTestingEnv())throw new Error("Should not be creating nodes in Skew while running fullview");let n={};return n.guid=gt.encodeGUID(e),n.phase="CREATED",Ng(n),this.findNode1(e)}removeNode(e){if(!L.isTestingEnv())throw new Error("Should not be removing nodes in Skew while running fullview");let t={};t.guid=gt.encodeGUID(e),t.phase="REMOVED",Ng(t);let n=this.findNode1(e)}root(){return this._cachedRoot==null&&(this._cachedRoot=this.findNode1(ne._new(0,0)),this._cachedRoot.updateIsRooted()),this._cachedRoot}regenerateDirtySymbolInstances(e){L._prototypeLib.updateSymbolInstancesForTests()}updateDirtyStyleConsumers(){L._prototypeLib.updateStylesForTests()}findNodeFromDeveloperFriendlyId(e){if(e.charCodeAt(0)==84){let t=e.slice(1).split(";");if(t.length!=3)return console.error("Table cell developer friendly id does not have 3 guids"),null;let n=ne.fromString(t[0]),r=this.findNode1(n);if(r==null)return console.error("Cannot find table from table cell developer friendly id"),null;let o=ne.fromString(t[1]),a=ne.fromString(t[2]);return r.getTableCellAt(o,a)}else if(e.charCodeAt(0)==73){let t=e.slice(1).split(";"),n=ne.fromString(t[0]),r=this.findNode1(n),o=null;o=(s,l)=>{if(s==null)return null;if(l(s))return s;for(let d=0,c=s.childCount();d<c;d=d+1){let p=o(s.childAt1(d),l);if(p!=null)return p}return null};let a=new Mt(t.map(s=>ne.fromString(s)));return o(r,s=>Mt.equals(s.stablePath(),a))}else return this.findNode2(e)}static createCanvasInScene(e,t){let n=e.createNode1(t);return n.setType("CANVAS"),n.setVisible(!0),n.setOpacity(1),n.setName("canvas"),n.setCurrentViewportSize(new E(1e6,1e6)),e.root().appendChild(n),n}static createLoadedFrameWithCanvasContent(e,t){let n=new Tt,r=[];be.forEachNode1(t,l=>l.isTopLevel()?(n.include3(l.fullSizeCanvasSpaceBoundingBox()),r.push(l),be.Loop.SKIP):be.Loop.CONTINUE);let o=n.build();o.expand1(150);let a=t.fillPaintsToRender()[0].asSinglePaint();a.opacity()==0&&(a=se.createSolid(C.WHITE,1));let s=So(t,"frame",a);je(s,o.topLeft(),o.size()),s.setTestOnlyFillGeometry(ii(s.fullSizeCanvasSpaceBoundingBox()));for(let l of r){let d=l.relativeTransform().clone();d.translate1(s.relativeTransform().translation().negative()),l.setParentIndex(new qn(ne.invalid(),dn.fromString(""))),s.appendChild(l),l.setRelativeTransform(d)}return e.setTlfsLoaded(l=>l==s?!0:l.hasBeenLoaded()),s}static createScene(e,t){return L._prototypeLib.createSceneAndSetActive(e,t)}static createSceneWithCanvasForTests1(){return Si.createSceneWithCanvasForTests2(X.ViewerMode.PROTOTYPE,1)}static createSceneWithCanvasForTests2(e,t){var r;new vn,X.setViewerMode(e);let n=Si.createScene(Si.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,t);return(r=L._prototypeLib)==null||r.modules().prototype.setSceneMetadata("1"),Si.createCanvasInScene(n,ne._new(0,1)),n.markLoaded(),n}};Si.MAX_GUID_VALUE=2147483647,Si.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER=Si.MAX_GUID_VALUE-1,Si.VERBOSE=!1;var It=Si;var vI=(t=>(t[t.RENDER=0]="RENDER",t[t.PERFORMANCE=1]="PERFORMANCE",t))(vI||{}),Qi=class Qi{static instance(){return Qi._instance==null&&(Qi._instance=new Qi),Qi._instance}requestWithSecret(e){let t=`secret=${encodeURIComponent(this.secret)}`;return new Ur(e+(e.indexOf("?")!=-1?"&":"?")+t)}getArgv(){return new Promise((e,t)=>{this.requestWithSecret("/rpc/argv").get().then(n=>{e(JSON.parse(n.text))})})}readFile(e,t){return this.requestWithSecret(`/rpc/file?path=${e}`).format(t).get()}writeFile(e,t){return this.requestWithSecret(`/rpc/file?path=${e}`).send2("POST",t)}exit(){this.requestWithSecret("/rpc/process?returnCode=0").send3("DELETE")}queryArgs(){let e=new Map,t=window.location.search;if(t.length==0)return e;t=t.slice(1);for(let n of t.split("&")){let r=n.split("=");r.length==2&&e.set(r[0],r[1])}return e}resolveFromBasePath(e){return e.startsWith("/")?e:this.basePath+"/"+e}afterRenderingCompletes(e){let t=()=>{this._triggerOnFrameCallbacksForTesting(),this.testMode==0&&this.app.canvasView().renderingIsComplete()&&!this.app.state().imageManager().hasPendingImages()||this.testMode==1&&!this.app.canvasView().isTopLevelTransitionOngoing()&&!this.app.state().imageManager().hasPendingImages()?e():requestAnimationFrame(t)};requestAnimationFrame(t)}afterInitialLoad(e){let t=()=>{e(),this.viewer.off("sceneDidCompleteInitialLoad",t)};this.viewer.on("sceneDidCompleteInitialLoad",t)}convertTitleToFilename(e,t,n,r,o){let a=t.trim();return o>0?`${a}${n}-${o}${r}`:`${a}${n}${r}`}figFileToName(e){let t=e.split("/");return t[t.length-1].replace(new RegExp(".fig$","g"),"")}computeBoundsForExport(e){let t=U.new3(e.canvasSpaceRenderedBounds());(un.isFrameLike(e.type())||e.type()=="SLICE")&&(t.isInvalid()?t=e.canvasSpaceBoundingBox():t.expandToInclude(e.canvasSpaceBoundingBox()));for(let n=e.parent();n!=null;n=n.parent())n.clipsToBoundingRectangle()&&t.intersectWith(n.canvasSpaceRenderedBounds());return t}saveCanvasContentToPathAsync(e,t){this.app.canvasView().getContext().gl().canvas.toBlob(r=>{this.writeFile(e,r).then(o=>{t()})})}_assertCurrentModeIsOneOf(e,t){if(e.indexOf(X.getViewerMode())==-1){let n=e.map(r=>X.ViewerMode[r]);throw new Error(`Command ${JSON.stringify(t)} is supported only in modes ${n}`)}}runNextCommand(){if(this.commandQueue.length==0){this.exit();return}let e=this.commandQueue.shift();switch(e.type){case"load-canvas-as-prototype":{this._assertCurrentModeIsOneOf([X.ViewerMode.PROTOTYPE],e),console.log(e.type,e.figFile),this.figFileName=this.figFileToName(e.figFile),this.readFile(this.resolveFromBasePath(e.figFile),1).then(t=>{this.app.state().imageManager().resetForRenderingTests(),this.viewer.loadFile({bytes:t.bytes},this.initializePrototypeLib),this.afterInitialLoad(()=>{let n=It.createLoadedFrameWithCanvasContent(this.app.state().scene(),this.app.state().getActiveCanvas()),r=n.canvasSpaceRenderedBounds();this.resize(r.width(),r.height()),this.app.state().prototypeState().setFitModeFromParameter("contain"),this.app.state().prototypeState().navigateToFrameAndCloseOverlays1(n.id()),this.commandQueue.unshift({type:"save-canvas-as-image",outFile:e.outFile}),this.afterRenderingCompletes(()=>{this.runNextCommand()})})});break}case"load-prototype":{this._assertCurrentModeIsOneOf([X.ViewerMode.PROTOTYPE],e),console.log(e.type,e.figFile,e.nodeId),this.figFileName=this.figFileToName(e.figFile),this.testMode==0&&this._mockTime.reset(),this.readFile(this.resolveFromBasePath(e.figFile),1).then(t=>{this.app.canvasView().dangerouslyAccessProtoRenderManager().clearTileCaches(),this.app.state().imageManager().resetForRenderingTests(),this.viewer.loadFile({bytes:t.bytes,interactiveComponentsEnabled:!0},this.initializePrototypeLib),this.afterInitialLoad(()=>{let n=this.app.state().scene();if(n!=null){let r=n.findNode2(e.nodeId);if(r.type()!="CANVAS")this.app.state().prototypeState().navigateToFrameAndCloseOverlays1(r.id());else{this.app.state().setActiveCanvas(r);let o=Wt.visuallySortedTopLevelFrames(this.app.state().getActiveCanvas());if(o.length>0)this.app.state().prototypeState().navigateToFrameAndCloseOverlays1(o[0].id());else throw new Error("no top level frames in prototype")}}this.app.state().prototypeState().setFitModeFromParameter(e.scalingMode),this.afterRenderingCompletes(()=>{this.runNextCommand()})})});break}case"set-top-level-frame":{this._assertCurrentModeIsOneOf([X.ViewerMode.PROTOTYPE],e),console.log(e.type,e.nodeId);let t=this.app.state().scene();if(t==null)throw new Error("Missing scene in set-top-level-frame");let n=t.findNode2(e.nodeId);if(n==null)throw new Error("Missing node to navigate to");this.app.state().prototypeState().navigateToFrameAndCloseOverlays1(n.id()),this.runNextCommand();break}case"scroll-node":{this._assertCurrentModeIsOneOf([X.ViewerMode.PROTOTYPE],e);let t=this.app.state().scene();if(t==null)throw new Error("Missing scene in scroll-node");let n=t.findNode2(e.nodeId);if(n==null)throw new Error("Missing node in scroll-node");this.app.canvasView().updateScrollOffsetForNode(n,new E(+e.offset.x,+e.offset.y)),this.runNextCommand();break}case"trigger-hotspot":{this._assertCurrentModeIsOneOf([X.ViewerMode.PROTOTYPE],e);let t=e.nodeId,n=Kt.TransitionAction_fromString(e.action);if(n==0)throw new Error(`Unrecognized action ${e.action}`);let r=this.app.state().scene();if(r==null)throw new Error(`Missing scene in ${e.type}`);let o=r.findNode2(t);if(o==null)throw new Error(`Missing node in ${e.type}`);let a=this.app.state().prototypeStructure().findPrototypeInteractionsWithInteractionType(o,Kt.TransitionAction_mapToInteractionType(n));if(a.length==0)throw new Error(`Could not find hotspot for action ${En[n]} on node ${t}`);this.app.canvasView().triggerHotspot(new Bo(o),a[0],n,null),this.afterRenderingCompletes(()=>{this.runNextCommand()});break}case"advance-time":{this._assertCurrentModeIsOneOf([X.ViewerMode.PROTOTYPE],e);let t=parseFloat(e.seconds),n=1/60;for(;t>n;)this._mockTime.advanceSeconds(n),this._triggerOnFrameCallbacksForTesting(),t-=n;t>0&&(this._mockTime.advanceSeconds(t),this._triggerOnFrameCallbacksForTesting()),this.runNextCommand();break}case"save-canvas-as-image":{this._assertCurrentModeIsOneOf([X.ViewerMode.PROTOTYPE],e);let t=e.outFile;console.log("save-canvas-as-image",t),this.afterRenderingCompletes(()=>{this.saveCanvasContentToPathAsync(this.resolveFromBasePath(e.outFile),()=>{this.runNextCommand()})});break}case"write-performance-stats":{let t=this.app.canvasView().dangerouslyAccessProtoRenderManager().getAggregateTransitionStats(),n=Object.create(null);n.stats=Object.create(null),n.meta=Object.create(null),t.forEach((o,a,s)=>{n.stats[a]=o});for(let o of["runCount","deviceMode","flags"])n.meta[o]=e[o];let r=JSON.stringify(n);this.writeFile(e.outFile,new Blob([r],{type:"application/json"})).then(o=>{this.runNextCommand()});break}case"trigger-optional-oob-access-for-testing":{L._prototypeLib.modules().interactionTestHelpers.triggerOptionalOOBAccess(),L._prototypeLib.modules().interactionTestHelpers.triggerReleaseReport(),L._prototypeLib.modules().interactionTestHelpers.triggerSloge(),setTimeout(()=>{this.runNextCommand()},1e3);break}default:throw new Error(`Skipping unrecognized command ${e.type}`)}}writePerformanceResultsWhenFinished(e,t){this.commandQueue.push({type:"write-performance-stats",outFile:e,runCount:t.get("runCount"),deviceMode:t.get("deviceMode"),flags:t.get("flags")})}_triggerOnFrameCallbacksForTesting(){this.app.window().internalOnFrame()}resizeToFit(){this.resize(window.innerWidth*mr(),window.innerHeight*mr())}resize(e,t){this.container.style.width=`${Math.ceil(e/mr())}px`,this.container.style.height=`${Math.ceil(t/mr())}px`,this.app.window().notifyAll(new xo(2,this.app.window().root(),0)),this._triggerOnFrameCallbacksForTesting()}start(e,t,n){Qi.instance().initializePrototypeLib=t,Qi.instance().bowser=n,wt.setImagePrefixURL(""),Ki=!0;let r=decodeURIComponent(this.queryArgs().get("viewerMode"));if(r!="PROTOTYPE")throw new Error(`Invalid viewer mode '${r}'`);let o=this.queryArgs().get("testMode");switch(o){case"RENDER":{this.testMode=0;break}case"PERFORMANCE":{this.testMode=1;break}default:throw new Error(`Invalid viewer test mode '${o}'`)}this.secret=decodeURIComponent(this.queryArgs().get("secret")),this.container=document.createElement("div"),document.body.appendChild(this.container),this.getArgv().then(a=>{let s=a[0],l=s.split("/");ce.List_removeLast(l),this.basePath=l.join("/");let d=new Map;for(let c=1,p=a.length;c<p;c=c+1){let u=a[c];u.length>=2&&u.charCodeAt(0)==45&&u.charCodeAt(1)==70&&d.set(u.slice(2),!0)}if(this.viewer=e({workerURL:"ts-imagedecoder.js",containerElement:this.container,viewerMode:r,featureFlags:Le.StringMap_toJSObject(d),trackingSessionId:"unimportant dummy value",startNodeId:null,bowser:Qi.instance().bowser,kiwiSchema:Qp.compileSchema(Qp.parseSchema(`// This is the schema for the file format. We use the Kiwi serialization format,
// which is a custom format that is similar to Google Protocol Buffers but
// customized for our needs: https://github.com/evanw/kiwi
//
// The files src/multiplayer/sync.h and resources/other/sync.bkiwi in fullscreen
// are automatically generated from this schema file every time you build
// fullscreen using Xcode. To manually generate the files, run the
// "fullscreen/scripts/generate_kiwi.sh" script.
//
// The "kiwic" compiler emits errors in a format that Xcode understands, so you
// should be able to edit the "sync.kiwi" file directly in Xcode and get inline
// errors if the build fails.
//
// Please ensure every property that is an index into the top-level "blobs"
// array ends in "Blob", like "fooBlob". This is used by the multiplayer
// server to automatically substitute blob values in the right places.

package Fig;

enum MessageType {
  JOIN_START = 0;
  NODE_CHANGES = 1;
  USER_CHANGES = 2;
  JOIN_END = 3;
  SIGNAL = 4;
  STYLE = 5;
  STYLE_SET = 6;

  // This message type is only sent if:
  //
  // - The client passes the "snapshot-hash" query parameter on connect
  // - The value for that parameter is the same as the current document
  // - There aren't any pending unsaved changes or active autosaves
  //
  // In this case, the client should skip reloading the document and just assume
  // that it's local document is the exact same as the server. This is just an
  // optimization to avoid needing to download and parse the document all over
  // again when the browser tab has timed out because it was in the background
  // and the network connection was idle. It's completely optional; if a client
  // doesn't want to handle JOIN_START_SKIP_RELOAD, it can just not pass the
  // "snapshot-hash" query parameter and the server will never send this type.
  JOIN_START_SKIP_RELOAD = 7;

  // Client upgrades work like this:
  //
  // 1) Client -> server:
  // - Make a WebSocket request with an old "version" URL parameter
  //
  // 2) Server -> client:
  // - Send the schema
  // - Send a NOTIFY_SHOULD_UPGRADE message
  //   - The "access" property is either READ_ONLY | READ_WRITE. The client
  //     should use this to update the "isReadOnly" state of the scene.
  //
  // 3) Client -> server:
  // - Send the schema
  //   - This is optional, and is currently unused by the server. We were
  //     thinking this could be nice to have if we ever change the wire
  //     protocol itself since the client definitely knows what format its
  //     messages are in.
  // - At this point the upgrade flow pauses until user action. We let the user
  //   continue to edit the document while we show a persistent banner at the
  //   top of the screen that prompts them to upgrade. When they click the
  //   upgrade button in this banner, we kick off the rest of the flow below.
  // - Send a NODE_CHANGES message for all local changes
  //   - This will happen if the document was already open and the user made
  //     some unsaved changes while disconnected.
  //   - Note that this currently happens even if the document is read-only.
  //     In that case the server will just reject all of that user's changes
  //     and they will be dropped on the floor when the client reloads.
  // - Send an UPGRADE_DONE message
  //
  // 4) Server -> client:
  // - Send an UPGRADE_REFRESH message
  //   - This lets the client know that its changes have been fully committed
  //     to the server and it's ok to reload.
  //
  // 5) Client -> server:
  // - Close the connection and reload
  //   - The client waits to reload until it gets the UPGRADE_REFRESH message
  //     to avoid losing data. If the client reloaded earlier, it might lose
  //     data because the message may not have ever reached the server. For
  //     example, the user's car might have just entered a tunnel and has no
  //     more internet connection.
  //
  // This whole sequence can be easily tested from the editor. Just choose
  // "Debug > Test Multiplayer Upgrade Protocol". That reconnects to the
  // multiplayer server with a special flag that forces the upgrade sequence.
  NOTIFY_SHOULD_UPGRADE = 8;
  UPGRADE_DONE = 9;
  UPGRADE_REFRESH = 10;
  SCENE_GRAPH_QUERY = 11;
  SCENE_GRAPH_REPLY = 12;

  DIFF = 13;

  // Sometimes clients want to send information to each other that, unlike
  // USER_CHANGES, is ephemeral. An example is when someone in the editor uses
  // the E shortcut to react to things in the editor. This shows temporary
  // emoji around the user's cursor on other clients. We DON'T want these to
  // show up when others join the file in future.
  CLIENT_BROADCAST = 14;

  // Sent to indicate that a journaled reconnect will be performed.
  JOIN_START_JOURNALED = 15;

  // To stream chunked NODE_CHANGES, the client needs to know whether to
  // decompress using a Zstd stream context or to individually decompress
  // messages. The server sends STREAM_START and STREAM_END messages
  // to indicate to the client when it should decompress using the Zstd
  // stream context and when to individually decompress messages.
  STREAM_START = 16;
  STREAM_END = 17;

  // Send changes to interactiveSlideParticipantData using this message type
  // from the Flides viewer. This allows viewers to write to this field.
  INTERACTIVE_SLIDE_CHANGE = 18;
}

enum Axis {
  X = 0;
  Y = 1;
}

enum Access {
  READ_ONLY = 0;
  READ_WRITE = 1;
}

enum NodePhase {
  CREATED = 0;
  REMOVED = 1;
}

enum WindingRule {
  NONZERO = 0;
  ODD = 1;
}

// Keep the names here up to date with serialization logic in FGNode.h
enum NodeType {
  NONE = 0;
  DOCUMENT = 1;
  CANVAS = 2;
  GROUP = 3;
  FRAME = 4;
  BOOLEAN_OPERATION = 5;
  VECTOR = 6;
  STAR = 7;
  LINE = 8;
  ELLIPSE = 9;
  RECTANGLE = 10;
  REGULAR_POLYGON = 11;
  ROUNDED_RECTANGLE = 12;
  TEXT = 13;
  SLICE = 14;
  SYMBOL = 15;
  INSTANCE = 16;
  STICKY = 17;
  SHAPE_WITH_TEXT = 18;
  CONNECTOR = 19;
  CODE_BLOCK = 20;
  WIDGET = 21;
  STAMP = 22;
  MEDIA = 23;
  HIGHLIGHT = 24;
  SECTION = 25;
  SECTION_OVERLAY = 26;
  WASHI_TAPE = 27;
  VARIABLE = 28;
  TABLE = 29;
  TABLE_CELL = 30;
  VARIABLE_SET = 31;
  SLIDE = 32;
  ASSISTED_LAYOUT = 33;
  INTERACTIVE_SLIDE_ELEMENT = 34;
  VARIABLE_OVERRIDE = 35;
}

enum ShapeWithTextType {
  SQUARE = 0;
  ELLIPSE = 1;
  DIAMOND = 2;
  TRIANGLE_UP = 3;
  TRIANGLE_DOWN = 4;
  ROUNDED_RECTANGLE = 5;
  PARALLELOGRAM_RIGHT = 6;
  PARALLELOGRAM_LEFT = 7;
  ENG_DATABASE = 8;
  ENG_QUEUE = 9;
  ENG_FILE = 10;
  ENG_FOLDER = 11;
  TRAPEZOID = 12;
  PREDEFINED_PROCESS = 13;
  SHIELD = 14;
  DOCUMENT_SINGLE = 15;
  DOCUMENT_MULTIPLE = 16;
  MANUAL_INPUT = 17;
  HEXAGON = 18;
  CHEVRON = 19;
  PENTAGON = 20;
  OCTAGON = 21;
  STAR = 22;
  PLUS = 23;
  ARROW_LEFT = 24;
  ARROW_RIGHT = 25;
  SUMMING_JUNCTION = 26;
  OR = 27;
  SPEECH_BUBBLE = 28;
  INTERNAL_STORAGE = 29;
}

// Keep the names here up to date with serialization logic in FGPaintHelpers.cpp
enum BlendMode {
  PASS_THROUGH = 0;
  NORMAL = 1;
  DARKEN = 2;
  MULTIPLY = 3;
  LINEAR_BURN = 4;
  COLOR_BURN = 5;
  LIGHTEN = 6;
  SCREEN = 7;
  LINEAR_DODGE = 8;
  COLOR_DODGE = 9;
  OVERLAY = 10;
  SOFT_LIGHT = 11;
  HARD_LIGHT = 12;
  DIFFERENCE = 13;
  EXCLUSION = 14;
  HUE = 15;
  SATURATION = 16;
  COLOR = 17;
  LUMINOSITY = 18;
}

enum PaintType {
  SOLID = 0;
  GRADIENT_LINEAR = 1;
  GRADIENT_RADIAL = 2;
  GRADIENT_ANGULAR = 3;
  GRADIENT_DIAMOND = 4;
  IMAGE = 5;
  EMOJI = 6;
  VIDEO = 7;
}

enum ImageScaleMode {
  STRETCH = 0;
  FIT = 1;
  FILL = 2;
  TILE = 3;
}

enum EffectType {
  INNER_SHADOW = 0;
  DROP_SHADOW = 1;
  FOREGROUND_BLUR = 2;
  BACKGROUND_BLUR = 3;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum TextCase {
  ORIGINAL = 0;
  UPPER = 1;
  LOWER = 2;
  TITLE = 3;
  SMALL_CAPS = 4;
  SMALL_CAPS_FORCED = 5;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum TextDecoration {
  NONE = 0;
  UNDERLINE = 1;
  STRIKETHROUGH = 2;
}

enum LeadingTrim {
  NONE = 0;
  CAP_HEIGHT = 1;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum NumberUnits {
  RAW = 0;
  PIXELS = 1;
  PERCENT = 2;
}

enum ConstraintType {
  MIN = 0;
  CENTER = 1;
  MAX = 2;
  STRETCH = 3;
  SCALE = 4;

  // FIXED_MIN and FIXED_MAX are deprecated and should be parsed as MIN
  // and MAX. They were released internally, so there are documents on
  // staging with these values stored in them. We already released them
  // to users behind a feature flag. No external users should have been
  // able to create documents with these constraint values.
  FIXED_MIN = 5;
  FIXED_MAX = 6;
}

enum StrokeAlign {
  CENTER = 0;
  INSIDE = 1;
  OUTSIDE = 2;
}

enum StrokeCap {
  NONE = 0;
  ROUND = 1;
  SQUARE = 2;
  ARROW_LINES = 3;
  ARROW_EQUILATERAL = 4;
  DIAMOND_FILLED = 5;
  TRIANGLE_FILLED = 6;
  HIGHLIGHT = 7;
  WASHI_TAPE_1 = 8;
  WASHI_TAPE_2 = 9;
  WASHI_TAPE_3 = 10;
  WASHI_TAPE_4 = 11;
  WASHI_TAPE_5 = 12;
  WASHI_TAPE_6 = 13;
  CIRCLE_FILLED = 14;
}

enum StrokeJoin {
  MITER = 0;
  BEVEL = 1;
  ROUND = 2;
}

enum BooleanOperation {
  UNION = 0;
  INTERSECT = 1;
  SUBTRACT = 2;
  XOR = 3;
}

enum TextAlignHorizontal {
  LEFT = 0;
  CENTER = 1;
  RIGHT = 2;
  JUSTIFIED = 3;
}

enum TextAlignVertical {
  TOP = 0;
  CENTER = 1;
  BOTTOM = 2;
}

enum MouseCursor {
  DEFAULT = 0;
  CROSSHAIR = 1;
  EYEDROPPER = 2;
  HAND = 3;
  PAINT_BUCKET = 4;
  PEN = 5;
  PENCIL = 6;
  MARKER = 7;
  ERASER = 8;
  HIGHLIGHTER = 9;
}

// The order here matters. Moving geometry around may downgrade (decrement)
// the mirror mode but will never upgrade (increment) the mirror mode.
enum VectorMirror {
  NONE = 0;
  ANGLE = 1;
  ANGLE_AND_LENGTH = 2;
}

enum DashMode {
  CLIP = 0;
  STRETCH = 1;
}

// Keep the names here up to date with imageTypeFromEnumName() in FWImageIO.cpp
enum ImageType {
  PNG = 0;
  JPEG = 1;
  SVG = 2;
  PDF = 3;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum ExportConstraintType {
  CONTENT_SCALE = 0;
  CONTENT_WIDTH = 1;
  CONTENT_HEIGHT = 2;
}

enum LayoutGridType {
  MIN = 0;
  CENTER = 1;
  STRETCH = 2;
  MAX = 3;
}

enum LayoutGridPattern {
  STRIPES = 0;
  GRID = 1;
}

enum TextAutoResize {
  NONE = 0;
  WIDTH_AND_HEIGHT = 1; // Don't wrap lines and adjust width and height automatically.
  HEIGHT = 2; // Wrap lines to fit existing width and adjust height automatically.
}

enum TextTruncation {
  DISABLED = 0;
  ENDING = 1;
}

enum StyleSetType {
  PERSONAL = 0;
  TEAM = 1;
  CUSTOM = 2;
  FREQUENCY = 3;
  TEMPORARY = 4;
}

enum StyleSetContentType {
  SOLID = 0;
  GRADIENT = 1;
  IMAGE = 2;
}

enum StackMode {
  NONE = 0;
  HORIZONTAL = 1;
  VERTICAL = 2;
}

enum StackAlign {
  MIN = 0;
  CENTER = 1;
  MAX = 2;
  BASELINE = 3;
}

enum StackCounterAlign {
  MIN = 0; // DEPRECATED - no longer used as of ALv3
  CENTER = 1; // DEPRECATED - no longer used as of ALv3
  MAX = 2; // DEPRECATED - no longer used as of ALv3
  STRETCH = 3;
  AUTO = 4;
  BASELINE = 5;
}

enum StackJustify {
  MIN = 0;
  CENTER = 1;
  MAX = 2;
  SPACE_EVENLY = 3; // DEPRECATED - new stacks will use SPACE_BETWEEN
  SPACE_BETWEEN = 4;
}

enum StackSize {
  FIXED = 0;
  RESIZE_TO_FIT = 1; // DEPRECATED - no longer used as of ALv3
  RESIZE_TO_FIT_WITH_IMPLICIT_SIZE = 2;
}

enum StackPositioning {
  AUTO = 0;
  ABSOLUTE = 1;
}

enum StackWrap {
  NO_WRAP = 0;
  WRAP = 1;
}

enum StackCounterAlignContent {
  AUTO = 0; // If all stack children are FILL in the counter axis, auto=stretch, otherwise auto=flex-start
  SPACE_BETWEEN = 1;
}

enum ConnectionType {
  NONE = 0;

  // Prototype link/hotspot points to a node in the same file
  // to perform a Navigation action (excludes MediaActions)
  INTERNAL_NODE = 1;

  // Prototype link/hotspot opens a URL
  URL = 2;

  // Goes to the previous frame
  BACK = 3;

  // Closes the overlay
  CLOSE = 4;

  // Changes the value of a variable
  SET_VARIABLE = 5;

  // Changes the runtime properties of media
  // Can point to a node in the same frame
  UPDATE_MEDIA_RUNTIME = 6;

  // Evaluates a conditional expression and executes a list of actions
  CONDITIONAL = 7;
}

enum InteractionType {
  ON_CLICK = 0;
  AFTER_TIMEOUT = 1;
  MOUSE_IN = 2;
  MOUSE_OUT = 3;
  ON_HOVER = 4;
  MOUSE_DOWN = 5;
  MOUSE_UP = 6;
  ON_PRESS = 7;
  NONE = 8;
  DRAG = 9;
  ON_KEY_DOWN = 10;
  ON_VOICE = 11;
  ON_MEDIA_HIT = 12;
  ON_MEDIA_END = 13;
  MOUSE_ENTER = 14;
  MOUSE_LEAVE = 15;
}

enum TransitionType {
  INSTANT_TRANSITION = 0;

  DISSOLVE = 1;

  FADE = 2;

  // Frame A moves over frame B while frame B
  // fades out and moves slightly in the direction
  // of the animation.
  SLIDE_FROM_LEFT = 3;
  SLIDE_FROM_RIGHT = 4;
  SLIDE_FROM_TOP = 5;
  SLIDE_FROM_BOTTOM = 6;

  // Frame A moves onto screen by pushing frame B
  // out of the way in the direction of the animation.
  // The frames never overlap.
  PUSH_FROM_LEFT = 7;
  PUSH_FROM_RIGHT = 8;
  PUSH_FROM_TOP = 9;
  PUSH_FROM_BOTTOM = 10;

  // Frame A moves over frame B in the direction of the
  // animation. Frame B remains in place and doesn't
  // change visually.
  MOVE_FROM_LEFT = 11;
  MOVE_FROM_RIGHT = 12;
  MOVE_FROM_TOP = 13;
  MOVE_FROM_BOTTOM = 14;

  // The current frame on screen slides in the direction OPPOSITE
  // to the one specified revealing the new frame under it which
  // fades in and moves slightly in the direction of
  // the animation.
  //
  // Why does ..._TO_LEFT actually move to the right? This was a
  // mistake when we picked these names, and changing names in our
  // file format is a huge pain so we've chosen to live with this
  // for now.
  SLIDE_OUT_TO_LEFT = 15;
  SLIDE_OUT_TO_RIGHT = 16;
  SLIDE_OUT_TO_TOP = 17;
  SLIDE_OUT_TO_BOTTOM = 18;

  // The current frame on screen moves in the direction OPPOSITE
  // to the one specified, revealing the new frame under it.
  //
  // Why does ..._TO_LEFT actually move to the right? This was a
  // mistake when we picked these names, and changing names in our
  // file format is a huge pain so we've chosen to live with this
  // for now.
  MOVE_OUT_TO_LEFT = 19;
  MOVE_OUT_TO_RIGHT = 20;
  MOVE_OUT_TO_TOP = 21;
  MOVE_OUT_TO_BOTTOM = 22;

  // DEPRECATED: This was deprecated in favor of SMART_ANIMATE below.
  MAGIC_MOVE = 23;

  // The current frame on screen transitions "magically" to match the
  // destination frame.
  SMART_ANIMATE = 24;

  SCROLL_ANIMATE = 25;
}

enum EasingType {
  IN_CUBIC = 0;
  OUT_CUBIC = 1;
  INOUT_CUBIC = 2;
  LINEAR = 3;
  IN_BACK_CUBIC = 4;
  OUT_BACK_CUBIC = 5;
  INOUT_BACK_CUBIC = 6;
  CUSTOM_CUBIC = 7;
  SPRING = 8;
  GENTLE_SPRING = 9;
  CUSTOM_SPRING = 10;
  SPRING_PRESET_ONE = 11;
  SPRING_PRESET_TWO = 12;
  SPRING_PRESET_THREE = 13;
}

enum ScrollDirection {
  NONE = 0;
  HORIZONTAL = 1;
  VERTICAL = 2;
  BOTH = 3;
}

enum ScrollContractedState {
  EXPANDED = 0;
  CONTRACTED = 1;
}

struct GUID {
  uint sessionID;
  uint localID;
}

struct Color {
  float r;
  float g;
  float b;
  float a;
}

struct Vector {
  float x;
  float y;
}

struct Rect {
  float x;
  float y;
  float w;
  float h;
}

struct ColorStop {
  Color color;
  float position;
}

struct Matrix {
  float m00;
  float m01;
  float m02;
  float m10;
  float m11;
  float m12;
}

struct ParentIndex {
  GUID guid;
  string position;
}

struct Number {
  float value;
  NumberUnits units;
}

struct FontName {
  string family;
  string style;
  string postscript;
}

enum FontVariantNumericFigure {
  NORMAL = 0;
  LINING = 1;
  OLDSTYLE = 2;
}

enum FontVariantNumericSpacing {
  NORMAL = 0;
  PROPORTIONAL = 1;
  TABULAR = 2;
}

enum FontVariantNumericFraction {
  NORMAL = 0;
  DIAGONAL = 1;
  STACKED = 2;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum FontVariantCaps {
  NORMAL = 0;
  SMALL = 1;
  ALL_SMALL = 2;
  PETITE = 3;
  ALL_PETITE = 4;
  UNICASE = 5;
  TITLING = 6;
}

enum FontVariantPosition {
  NORMAL = 0;
  SUB = 1;
  SUPER = 2;
}

enum FontStyle {
  // Keep this up-to-date with \`FontStyle\` in \`FGFontFace.h\`
  NORMAL = 0;
  ITALIC = 1;
}

enum SemanticWeight {
  NORMAL = 0;
  BOLD = 1;
}

enum SemanticItalic {
  NORMAL = 0;
  ITALIC = 1;
}

// All registered OpenType features:
// https://docs.microsoft.com/en-us/typography/opentype/spec/featurelist
// Omitted tags:
//  \`pnum\`, \`tnum\`, \`lnum\`, \`lnum\` (covered by \`FontVariantNumericFigure\` and \`FontVariantNumericSpacing\`)
//  \`frac\` (covered by \`FontVariantNumericFraction\`)
//  \`smcp\`, \`c2sc\` (covered by \`FontVariantCaps\`)
//  \`subs\`, \`sups\` (covered by \`FontVariantPosition\`)

enum OpenTypeFeature {

    // Letter case
    PCAP = 0; // Petite Capitals
    C2PC = 1; // Petite Capitals from Capitals
    CASE = 2; // Case-Sensitive Forms
    CPSP = 3; // Capital Spacing
    TITL = 4; // Titling
    UNIC = 5; // Unicase

    // Numbers
    ZERO = 6; // Slashed Zero
    SINF = 7; // Scientific Inferiors
    ORDN = 8; // Ordinals
    AFRC = 9; // Alternative Fractions
    DNOM = 10; // Denominators
    NUMR = 11; // Numerators

    // Variants
    LIGA = 12; // Standard Ligatures
    CLIG = 13; // Contextual Ligatures
    DLIG = 14; // Discretionary Ligatures
    HLIG = 15; // Historical Ligatures
    RLIG = 16; // Required Ligatures
    AALT = 17; // Access All Alternates
    CALT = 18; // Contextual Alternates
    RCLT = 19; // Required Contextual Alternates
    SALT = 20; // Stylistic Alternates
    RVRN = 21; // Required Variation Alternates
    VERT = 22; // Vertical Alternates
    SWSH = 23; // Swash
    CSWH = 24; // Contextual Swash
    NALT = 25; // Alternate Annotation Forms
    CCMP = 26; // Glyph Composition/Decomposition
    STCH = 27; // Stretching Glyph Decomposition
    HIST = 28; // Historical Forms
    SIZE = 29; // Optical Size
    ORNM = 30; // Ornaments
    ITAL = 31; // Italics
    RAND = 32; // Randomize

    // Math
    DTLS = 33; // Dotless Forms
    FLAC = 34; // Flattened Ascent Forms
    MGRK = 35; // Mathematical Greek
    SSTY = 36; // Math script style alternates

    // Horizontal spacing
    KERN = 37; // Kerning
    FWID = 38; // Full Widths
    HWID = 39; // Half Widths
    HALT = 40; // Alternate Half Widths
    TWID = 41; // Third Widths
    QWID = 42; // Quarter Widths
    PWID = 43; // Proportional Widths
    JUST = 44; // Justification Alternates
    LFBD = 45; // Left Bounds
    OPBD = 46; // Optical Bounds
    RTBD = 47; // Right Bounds
    PALT = 48; // Proportional Alternate Widths
    PKNA = 49; // Proportional Kana

    // Writing direction
    LTRA = 50; // Left-to-right Alternates
    LTRM = 51; // Left-to-right Mirrored Forms
    RTLA = 52; // Right-to-left Alternates
    RTLM = 53; // Right-to-left Mirrored Forms

    // More features
    ABRV = 54; // Above-base Forms
    ABVM = 55; // Above-base Mark Positioning
    ABVS = 56; // Above-base Substitutions
    VALT = 57; // Alternate Vertical Metrics
    VHAL = 58; // Alternate Vertical Half Metrics
    BLWF = 59; // Below-base Forms
    BLWM = 60; // Below-base Mark Positioning
    BLWS = 61; // Below-base Substitutions
    AKHN = 62; // Akhand (Ligature Devanagari)
    CJCT = 63; // Conjuct Forms
    CFAR = 64; // Conjunct Form After Ro
    CPCT = 65; // Centered CJK Punctuation
    CURS = 66; // Cursive Positioning
    DIST = 67; // Distances
    EXPT = 68; // Expert Forms
    FALT = 69; // Final Glyph on Line Alternates
    FINA = 70; // Terminal Forms
    FIN2 = 71; // Terminal Form #2
    FIN3 = 72; // Terminal Form #3
    HALF = 73; // Half Forms
    HALN = 74; // Halant Forms
    HKNA = 75; // Horizontal Kana Alternates
    HNGL = 76; // Hangul
    HOJO = 77; // Hojo Kanji Forms
    INIT = 78; // Initial Forms
    ISOL = 79; // Isolated Forms
    JP78 = 80; // JIS78 Forms
    JP83 = 81; // JIS83 Forms
    JP90 = 82; // JIS90 Forms
    JP04 = 83; // JIS2004 Forms
    LJMO = 84; // Leading Jamo Forms (Hangul)
    LOCL = 85; // Localized Forms
    MARK = 86; // Mark Positioning (Arabic)
    MEDI = 87; // Medial Forms
    MED2 = 88; // Medial Forms #2
    MKMK = 89; // Mark-to-Mark Positioning
    NLCK = 90; // NLC Kanji Forms
    NUKT = 91; // Nukta Forms
    PREF = 92; // Pre-base Forms
    PRES = 93; // Pre-base Substitutions
    VPAL = 94; // Proportional Alternate Vertical Metrics
    PSTF = 95; // Post-base Forms
    PSTS = 96; // Post-base Substitutions
    RKRF = 97; // Rakar Forms
    RPHF = 98; // Reph Form
    RUBY = 99; // Ruby Notation Forms
    SMPL = 100; // Simplified Forms
    TJMO = 101; // Trailing Jamo Forms
    TNAM = 102; // Traditional Name Forms
    TRAD = 103; // Traditional Forms
    VATU = 104; // Vattu Variants
    VJMO = 105; // Vovel Jamo Forms
    VKNA = 106; // Vertical Kana Alternates
    VKRN = 107; // Vertical Kerning
    VRTR = 108; // Vertical Alternates for Rotation
    VRT2 = 109; // Vertical Alternates and Rotation

    // Variants: Stylistic Sets
    SS01 = 110; // Stylistic Set 1
    SS02 = 111; // Stylistic Set 2
    SS03 = 112; // Stylistic Set 3
    SS04 = 113; // Stylistic Set 4
    SS05 = 114; // Stylistic Set 5
    SS06 = 115; // Stylistic Set 6
    SS07 = 116; // Stylistic Set 7
    SS08 = 117; // Stylistic Set 8
    SS09 = 118; // Stylistic Set 9
    SS10 = 119; // Stylistic Set 10
    SS11 = 120; // Stylistic Set 11
    SS12 = 121; // Stylistic Set 12
    SS13 = 122; // Stylistic Set 13
    SS14 = 123; // Stylistic Set 14
    SS15 = 124; // Stylistic Set 15
    SS16 = 125; // Stylistic Set 16
    SS17 = 126; // Stylistic Set 17
    SS18 = 127; // Stylistic Set 18
    SS19 = 128; // Stylistic Set 19
    SS20 = 129; // Stylistic Set 20

    // Variants: Character Variants
    CV01 = 130; // Character Variants 1
    CV02 = 131; // Character Variants 2
    CV03 = 132; // Character Variants 3
    CV04 = 133; // Character Variants 4
    CV05 = 134; // Character Variants 5
    CV06 = 135; // Character Variants 6
    CV07 = 136; // Character Variants 7
    CV08 = 137; // Character Variants 8
    CV09 = 138; // Character Variants 9
    CV10 = 139; // Character Variants 10
    CV11 = 140; // Character Variants 11
    CV12 = 141; // Character Variants 12
    CV13 = 142; // Character Variants 13
    CV14 = 143; // Character Variants 14
    CV15 = 144; // Character Variants 15
    CV16 = 145; // Character Variants 16
    CV17 = 146; // Character Variants 17
    CV18 = 147; // Character Variants 18
    CV19 = 148; // Character Variants 19
    CV20 = 149; // Character Variants 20
    CV21 = 150; // Character Variants 21
    CV22 = 151; // Character Variants 22
    CV23 = 152; // Character Variants 23
    CV24 = 153; // Character Variants 24
    CV25 = 154; // Character Variants 25
    CV26 = 155; // Character Variants 26
    CV27 = 156; // Character Variants 27
    CV28 = 157; // Character Variants 28
    CV29 = 158; // Character Variants 29
    CV30 = 159; // Character Variants 30
    CV31 = 160; // Character Variants 31
    CV32 = 161; // Character Variants 32
    CV33 = 162; // Character Variants 33
    CV34 = 163; // Character Variants 34
    CV35 = 164; // Character Variants 35
    CV36 = 165; // Character Variants 36
    CV37 = 166; // Character Variants 37
    CV38 = 167; // Character Variants 38
    CV39 = 168; // Character Variants 39
    CV40 = 169; // Character Variants 40
    CV41 = 170; // Character Variants 41
    CV42 = 171; // Character Variants 42
    CV43 = 172; // Character Variants 43
    CV44 = 173; // Character Variants 44
    CV45 = 174; // Character Variants 45
    CV46 = 175; // Character Variants 46
    CV47 = 176; // Character Variants 47
    CV48 = 177; // Character Variants 48
    CV49 = 178; // Character Variants 49
    CV50 = 179; // Character Variants 50
    CV51 = 180; // Character Variants 51
    CV52 = 181; // Character Variants 52
    CV53 = 182; // Character Variants 53
    CV54 = 183; // Character Variants 54
    CV55 = 184; // Character Variants 55
    CV56 = 185; // Character Variants 56
    CV57 = 186; // Character Variants 57
    CV58 = 187; // Character Variants 58
    CV59 = 188; // Character Variants 59
    CV60 = 189; // Character Variants 60
    CV61 = 190; // Character Variants 61
    CV62 = 191; // Character Variants 62
    CV63 = 192; // Character Variants 63
    CV64 = 193; // Character Variants 64
    CV65 = 194; // Character Variants 65
    CV66 = 195; // Character Variants 66
    CV67 = 196; // Character Variants 67
    CV68 = 197; // Character Variants 68
    CV69 = 198; // Character Variants 69
    CV70 = 199; // Character Variants 70
    CV71 = 200; // Character Variants 71
    CV72 = 201; // Character Variants 72
    CV73 = 202; // Character Variants 73
    CV74 = 203; // Character Variants 74
    CV75 = 204; // Character Variants 75
    CV76 = 205; // Character Variants 76
    CV77 = 206; // Character Variants 77
    CV78 = 207; // Character Variants 78
    CV79 = 208; // Character Variants 79
    CV80 = 209; // Character Variants 80
    CV81 = 210; // Character Variants 81
    CV82 = 211; // Character Variants 82
    CV83 = 212; // Character Variants 83
    CV84 = 213; // Character Variants 84
    CV85 = 214; // Character Variants 85
    CV86 = 215; // Character Variants 86
    CV87 = 216; // Character Variants 87
    CV88 = 217; // Character Variants 88
    CV89 = 218; // Character Variants 89
    CV90 = 219; // Character Variants 90
    CV91 = 220; // Character Variants 91
    CV92 = 221; // Character Variants 92
    CV93 = 222; // Character Variants 93
    CV94 = 223; // Character Variants 94
    CV95 = 224; // Character Variants 95
    CV96 = 225; // Character Variants 96
    CV97 = 226; // Character Variants 97
    CV98 = 227; // Character Variants 98
    CV99 = 228; // Character Variants 99
}

struct ExportConstraint {
  ExportConstraintType type;
  float value;
}

struct GUIDMapping {
  GUID from;
  GUID to;
}

struct Blob {
  byte[] bytes;
}

message Image {
  byte[] hash = 1; // SHA1 of compressed data
  string name = 2; // Just for display, not referenced by anything
  uint dataBlob = 3; // An index into "blobs", stores a compressed PNG or JPG (optional, will be missing for messages sent over the wire)
}

message Video {
  byte[] hash = 1; // SHA1 of compressed data
  string s3Url = 2; // HACK(ldamasco): ideally we should be resolving the hash against sinatra to get the s3 url, not storing it directly in fig file

  // string name = 3; // Just for display, not referenced by anything
  // uint dataBlob = 4; // An index into "blobs", stores a compressed MP4 (optional, will be missing for messages sent over the wire)
}

// DEPRECATED
struct FilterColorAdjust {
  float tint;
  float shadows;
  float highlights;
  float detail;
  float exposure;
  float vignette;
  float temperature;
  float vibrance;
}

message PaintFilterMessage {
  float tint = 1;
  float shadows = 2;
  float highlights = 3;
  float detail = 4 [deprecated];
  float exposure = 5;
  float vignette = 6 [deprecated];
  float temperature = 7;
  float vibrance = 8;
  float contrast = 9;
  float brightness = 10 [deprecated];
}

message Paint {
  PaintType type = 1;
  Color color = 2;
  float opacity = 3;
  bool visible = 4;
  BlendMode blendMode = 5;
  ColorStop[] stops = 6;
  Matrix transform = 7;
  Image image = 8;
  Image imageThumbnail = 9;
  Image animatedImage = 16;
  uint animationFrame = 17;
  ImageScaleMode imageScaleMode = 10;
  // Will not exist / be false for images uploaded before color management
  // Will always be true for images uploaded in non-legacy documents after color management
  bool imageShouldColorManage = 22;


  // NOTE: Either the transform above is used (e.g. for ImageScaleMode::STRETCH),
  // or these decomposed parameters are used (e.g. for ImageScaleMode::TILE).
  float rotation = 11;
  float scale = 12;

  // DEPRECATED, this is not used anywhere.
  FilterColorAdjust filterColorAdjust = 13 [deprecated];

  PaintFilterMessage paintFilter = 14;

  uint[] emojiCodePoints = 15;

  // NOTE: videos still use \`image\` and \`imageThumbnail\` for cover images in the editor
  // Video Playback data is stored in the VideoPlayback node field.
  Video video = 18;

  // For a fill of type IMAGE, these fields store the dimensions of the
  // original (full-size) image.  This is needed to correctly render an
  // image with imageScaleMode == TILE before the original image is loaded.
  // Beware that this isn't always present (specifically it is missing from
  // fills created before this handling was added), so fullscreen needs to
  // be prepared to render image fills without this information.
  uint originalImageWidth = 19;
  uint originalImageHeight = 20;

  VariableData colorVar = 21;
}

message FontMetaData {
  FontName key = 1;
  float fontLineHeight = 2;
  byte[] fontDigest = 3;
  FontStyle fontStyle = 4;
  int fontWeight = 5;
}

message FontVariation {
  uint axisTag = 1;
  string axisName = 2;
  float value = 3;
}

message TextData {
  string characters = 1;
  uint[] characterStyleIDs = 2; // All style IDs after the end are assumed to be 0, meaning no override
  NodeChange[] styleOverrideTable = 3;

  Vector layoutSize = 4;
  Baseline[] baselines = 5;
  Glyph[] glyphs = 6;
  Decoration[] decorations = 7;
  Blockquote[] blockquotes = 16;

  uint layoutVersion = 8 [deprecated];

  FontMetaData[] fontMetaData = 9; // Used for CSS export when font is not locally available

  FontName[] fallbackFonts = 10 [deprecated];
  HyperlinkBox[] hyperlinkBoxes = 11;
  TextLineData[] lines = 12;

  int truncationStartIndex = 13;
  float truncatedHeight = 14;

  float[] logicalIndexToCharacterOffsetMap = 15;

  float minContentHeight = 17 [deprecated]; // Moved to layout data

  MentionBox[] mentionBoxes = 18;
  DerivedTextLineData[] derivedLines = 19;
}

message DerivedTextData {
  Vector layoutSize = 1;
  Baseline[] baselines = 2;
  Glyph[] glyphs = 3;
  Decoration[] decorations = 4;
  Blockquote[] blockquotes = 5;
  FontMetaData[] fontMetaData = 6; // Used for CSS export when font is not locally available
  HyperlinkBox[] hyperlinkBoxes = 7;
  int truncationStartIndex = 8;
  float truncatedHeight = 9;
  float[] logicalIndexToCharacterOffsetMap = 10;
  MentionBox[] mentionBoxes = 11;
  DerivedTextLineData[] derivedLines = 12;
}

message HyperlinkBox {
  Rect bounds = 1;

  // url/guid are copied directly from the Hyperlink object.
  string url = 2;
  GUID guid = 3;
  int hyperlinkID = 4;
}

message MentionBox {
  Rect bounds = 1; // bounds for mention background pill
  uint startIndex = 2; // first mention character index
  uint endIndex = 3; // last mention character index
  bool isValid = 4; // whether the mention is valid (i.e., file keys match)
  uint mentionKey = 5; // boxes with the same key refer to the same mention
}

message Baseline {
  Vector position = 1;
  float width = 2;
  float lineY = 3;
  float lineHeight = 4;
  float lineAscent = 7;
  float ignoreLeadingTrim = 8;

  uint firstCharacter = 5; // An index into "characters" in TextData
  uint endCharacter = 6; // An index past the last character into "characters" in TextData
}

message Glyph {
  uint commandsBlob = 1; // An index into "blobs"
  Vector position = 2;
  uint styleID = 3;
  float fontSize = 4;
  uint firstCharacter = 5; // An index into "characters" in TextData
  float advance = 6;
  uint[] emojiCodePoints = 7;
}

message Decoration {
  Rect[] rects = 1;
  uint styleID = 2;
}

message Blockquote {
  Rect verticalBar = 1;
  Rect quoteMarkBounds = 2;
  uint styleID = 3;
}

message VectorData {
  uint vectorNetworkBlob = 1; // An index into "blobs"
  Vector normalizedSize = 2;
  NodeChange[] styleOverrideTable = 3;
}

message GUIDPath {
  GUID[] guids = 1;
}

message SymbolData {
  GUID symbolID = 1;
  NodeChange[] symbolOverrides = 2; // Uses GUIDPath as map key
  float uniformScaleFactor = 3;
}

message GUIDPathMapping {
  GUID id = 1;
  GUIDPath path = 2;
}

message NodeGenerationData {
  // Uses GUIDPath as map key. These are details of the nodes that we should be generating.
  NodeChange[] overrides = 1;
  // Indicates whether overrides should be fine-grained synced over multiplayer,
  // keyed on the guid path and field. When true, if multiple clients are adding
  // overrides for different guid paths or changing values for different fields
  // on the same override path,  the multiplayer server merges the incoming diffs
  // so all changes are retained.
  bool useFineGrainedSyncing = 2;

  // Uses GUIDPath as map key. These indicate to multiplayer which fields should be removed
  // for an override path when using fine grained syncing. The reason why we use NodeChanges
  // here is to make the server-side diffing easier, since it's not safe to convert from a
  // uint32 indicating the field to a NodeChangeField. The actual value stored does not
  // matter; the only thing that matters is that there is a value stored.
  // See this Slack conversation for more context:
  // https://figma.slack.com/archives/CUWG9FWKH/p1668718183550959
  //
  // When using fine grained syncing, the messages sent to multiplayer for node generation
  // data are the diffs the client wants to apply, not the entire new value. This works well
  // for adding and changing values, but if a client wants to remove a field for an override
  // path, there is no way to represent that the diff using the just overrides field.
  //
  // This should *only* be used in the message from the client to multiplayer server, and
  // should always be empty when node generation data is saved to the file format.
  //
  // If a node generation data diff includes a path/field in both overrides and
  // diffOnlyRemovals, we will remove the path/field.
  NodeChange[] diffOnlyRemovals = 3;
}

message DerivedImmutableFrameData {
  NodeChange[] overrides = 1; // Uses GUIDPath as map key. These are details of the nodes that we should be generating.

  // A version number that we increment to invalidate derived
  // immutable frame data in the wild. See comment in FGNodeTypes
  // around DERIVED_IMMUTABLE_FRAME_DATA_VERSION for how to use this.
  uint version = 2;
}

message AssetIdMap {
  AssetIdEntry[] entries = 1;
}

message AssetIdEntry {
  string assetKey = 1;
  AssetId assetId = 2;
}

message AssetRef {
  string key = 1;
  string version = 2;
}

message AssetId {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message StateGroupId {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message StyleId {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message SymbolId {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message VariableID {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message VariableOverrideId {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message VariableSetID {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message ThemeID {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message SlideThemeData {
  ThemeID themeID = 1;
  string version = 2;
}

message SharedSymbolReference {
  string fileKey = 1; // The fileKey of the document that publishes the Symbol. Will soon be deprecated by componentKey
  GUID symbolID = 2; // The symbolID as it exists in publishing document. Will soon be deprecated by componentKey
  string versionHash = 3; // The hash of the version of the published Symbol
  GUIDPathMapping[] guidPathMappings = 4; // Maps volatile local GUIDs to stable GUID paths.
  byte[] bytes = 5; // The actual serialized Symbol fig file
  GUIDMapping[] libraryGUIDToSubscribingGUID = 6 [deprecated]; // The goal of this was to map stable GUIDs in the team library to stable GUIDs in a subscribing document. This work was never finished
  string componentKey = 7; // Uniquely identifies the component within all of Figma. Will be hex digest of a SHA1 hash.
  GUIDPathMapping[] unflatteningMappings = 8;  // Maps from the old, unflattened GUIDs on this root symbol to new GUIDPaths in this root symbol.
  bool isUnflattened = 9; // Stores whether this shared symbol was last published unflattened.
}

message SharedComponentMasterData {
  string componentKey = 1; // The globally unique component key that references this component.
  GUIDPathMapping[] publishingGUIDPathToTeamLibraryGUID = 2; // Maps volatile local GUIDPaths to stable GUIDs in the team library.
  bool isUnflattened = 3; // Stores whether this shared component was published unflattened.
}

// This is deprecated! It turns out keying based on componentKey is a bad idea.
// https://paper.dropbox.com/doc/Problems-with-OverrideStash--BElX~69l3h5Ny8AWHe~aWEGsAg-jXmtLTn2kZEF9tqvlNOo5
message InstanceOverrideStash {
  // The override path to the instance swap we're caching overrides for. This
  // uses exactly the same path convention as SymbolData. This means the GUIDs
  // may not refer to local IDs. They may refer to remote IDs if the symbol is a
  // subscribed symbol.
  GUIDPath overridePathOfSwappedInstance = 1;

  // Identifies which symbol we're swapping to. We use this rather than the
  // local ID of the symbol in order to avoid needing to remap the override
  // stash when updating from the team library.
  string componentKey = 2;

  // Use overrides.guidPath as the override path key. Note that regardless of the
  // overridePathOfSwappedInstance, the guidPath key is always relative to the
  // primary instance.
  //
  // The remainder of the fields are used as overrides.
  NodeChange[] overrides = 3;
}

// This is deprecated!
message InstanceOverrideStashV2 {
  // The override path to the instance swap we're caching overrides for. This
  // uses exactly the same path convention as SymbolData. This means the GUIDs
  // may not refer to local IDs. They may refer to remote IDs if the symbol is a
  // subscribed symbol.
  GUIDPath overridePathOfSwappedInstance = 1;

  // Identifies which symbol we're swapping to. We use this rather than a
  // componentKey because componentKeys change when a file is duplicated!
  GUID localSymbolID = 2;

  // Use overrides.guidPath as the override path key. Note that regardless of the
  // overridePathOfSwappedInstance, the guidPath key is always relative to the
  // primary instance.
  //
  // The remainder of the fields are used as overrides.
  NodeChange[] overrides = 3;
}

message Effect {
  EffectType type = 1;
  Color color = 2;
  Vector offset = 3;
  float radius = 4;
  bool visible = 5;
  BlendMode blendMode = 6;
  float spread = 7;
  bool showShadowBehindNode = 8;

  VariableData radiusVar = 9;
  VariableData colorVar = 10;
  VariableData spreadVar = 11;
  VariableData xVar = 12;
  VariableData yVar = 13;
}

message TransitionInfo {
  TransitionType type = 1;
  float duration = 2;
}

enum PrototypeDeviceType {
  NONE = 0;
  PRESET = 1;
  CUSTOM = 2;
  PRESENTATION = 3;
}

enum DeviceRotation {
  NONE = 0;

  // "Counter clock-wise 90 degrees"
  CCW_90 = 1;
}

message PrototypeDevice {
  // If type is ::PRESET, then the size is inferred from \`presetIdentifier\`.
  // If type is ::CUSTOM, the device size is encoded in \`size\`.
  PrototypeDeviceType type = 1;
  Vector size = 2;

  // A string that uniquely identifies a device and style, e.g. "APPLE_IPHONE_X_SILVER"
  // These are uppercase versions of the file names in the Facebook Design devices repo.
  string presetIdentifier = 3;

  // Right now we expose a portrait/landscape option on device frames that toggles
  // devices between DeviceRotation.NONE and DeviceRotation.CCW_90.
  //
  // We think it's possible users will want to be able to rotate their devices 270
  // degrees as well in future (iPhone X, for example, looks different when rotated
  // on one side vs. the other).
  DeviceRotation rotation = 4;
}

enum OverlayPositionType {
  CENTER = 0;
  TOP_LEFT = 1;
  TOP_CENTER = 2;
  TOP_RIGHT = 3;
  BOTTOM_LEFT = 4;
  BOTTOM_CENTER = 5;
  BOTTOM_RIGHT = 6;
  MANUAL = 7;
}

enum OverlayBackgroundInteraction {
  NONE = 0;
  CLOSE_ON_CLICK_OUTSIDE = 1;
}

enum OverlayBackgroundType {
  NONE = 0;
  SOLID_COLOR = 1;
}

message OverlayBackgroundAppearance {
  OverlayBackgroundType backgroundType = 1;
  Color backgroundColor = 2;
}

enum NavigationType {
  NAVIGATE = 0;
  OVERLAY = 1;
  SWAP = 2;
  SWAP_STATE = 3;
  SCROLL_TO = 4;
}

// Represents ICC color profiles.
// This is different from ColorProfile (node field index 341) since:
// 1. There can be different ICC color profiles that represent
// the color profile (ex. ICC V4 vs ICC V2).
// 2. ColorProfile is used to represent Figma's color space
// while ExportColorProfile is used to represent profiles found in
// images.
enum ExportColorProfile {
  // Export in the same color profile as the document
  DOCUMENT = 0;
  // No profile will be embedded (previous behavior of exports); web specs mandate that
  // images without profiles are assumed to be sRGB
  SRGB = 1;
  // Embed Display P3 V4 profile
  DISPLAY_P3_V4 = 2;
}

message ExportSettings {
  string suffix = 1;
  ImageType imageType = 2;
  ExportConstraint constraint = 3;
  bool svgDataName = 4;
  ExportSVGIDMode svgIDMode = 5;
  bool svgOutlineText = 6;
  bool contentsOnly = 7;
  bool svgForceStrokeMasks = 8;
  bool useAbsoluteBounds = 9;
  ExportColorProfile colorProfile = 10;
}

enum ExportSVGIDMode {
  IF_NEEDED = 0;
  ALWAYS = 1;
}

message LayoutGrid {
  LayoutGridType type = 1;
  Axis axis = 2;
  bool visible = 3;
  int numSections = 4;
  float offset = 5;
  float sectionSize = 6;
  float gutterSize = 7;
  Color color = 8;
  LayoutGridPattern pattern = 9;

  VariableData numSectionsVar = 10;
  VariableData offsetVar = 11;
  VariableData sectionSizeVar = 12;
  VariableData gutterSizeVar = 13;
}

message Guide {
  Axis axis = 1;
  float offset = 2;
  GUID guid = 3;
}

message Path {
  WindingRule windingRule = 1;
  uint commandsBlob = 2; // An index into "blobs"
  uint styleID = 3; // Used to support per-region paints
}

// IMPORTANT:
// If you add a value, you must add it to \`VALID_STYLE_TYPES\` in lib/models/style.rb.
// Please never remove any of the StyleType values!
// They are stored in Postgres as strings (eg: "FILL", "TEXT", "EFFECT")
enum StyleType {
  NONE = 0;
  FILL = 1;
  STROKE = 2;
  TEXT = 3;
  EFFECT = 4;
  EXPORT = 5;
  GRID = 6;
}

message SharedStyleReference {
  string styleKey = 1; // The globally unique style key that references this style
  string versionHash = 2; // The hash of the version of the published Style
}

message SharedStyleMasterData {
  string styleKey = 1; // The globally unique style key that references this style
  string sortPosition = 2; // The sort position of the style, within its defining file
  string fileKey = 3; // The file where this style belongs to
}

enum ScrollBehavior {
  SCROLLS = 0;
  FIXED_WHEN_CHILD_OF_SCROLLING_FRAME = 1;
  STICKY_SCROLLS = 2;
}

message ArcData {
  // These are stored in radians
  float startingAngle = 1;
  float endingAngle = 2;
  // This is store as a ratio from 0 to 1
  float innerRadius = 3;
}

message SymbolLink {
  string uri = 1;
  string displayName = 2;
  string displayText = 3;
}

message PluginData {
  string pluginID = 1;
  string value = 2;
  string key = 3;
}

message PluginRelaunchData {
  string pluginID = 1;
  // This is used as description
  string message = 2;
  string command = 3;
  bool isDeleted = 4;
}

message MultiplayerFieldVersion {
  // Incremented by multiplayer with each accepted write. Clients must send up the latest
  // value in order to have their writes accepted, or match the previous \`sessionID\`.
  uint counter = 1;
  // The last session to bump the counter. This ensures consecutive writes from the same
  // client are accepted, instead of conflicting with themselves!
  uint sessionID = 2;
}

// Keep the connector fields in sync with FGConnectorFields.h
enum ConnectorMagnet {
  NONE = 0;
  AUTO = 1;
  TOP = 2;
  LEFT = 3;
  BOTTOM = 4;
  RIGHT = 5;
  CENTER = 6;
  AUTO_HORIZONTAL = 7;
}

message ConnectorEndpoint {
  GUID endpointNodeID = 1;
  Vector position = 2;
  ConnectorMagnet magnet = 3;
}

message ConnectorControlPoint {
  Vector position = 1;
  Vector axis = 2;
}

enum ConnectorTextSection {
  MIDDLE_TO_START = 0;
  MIDDLE_TO_END = 1;
}

message ConnectorTextMidpoint {
  ConnectorTextSection section = 1;
  float offset = 2;
}

enum ConnectorLineStyle {
  ELBOWED = 0;
  STRAIGHT = 1;
  CURVED = 2;
}

enum ConnectorType {
  MANUAL = 0;
  DIAGRAM = 1;
}

enum AnnotationPropertyType {
  FILL = 0;
  STROKE = 1;

  WIDTH = 2;
  HEIGHT = 3;
  MIN_WIDTH = 4;
  MIN_HEIGHT = 5;
  MAX_WIDTH = 6;
  MAX_HEIGHT = 7;

  STROKE_WIDTH = 8;
  CORNER_RADIUS = 9;

  EFFECT = 10;

  TEXT_STYLE = 11;
  TEXT_ALIGN_HORIZONTAL = 12;
  FONT_FAMILY = 13;
  FONT_SIZE = 14;
  FONT_WEIGHT = 15;
  LINE_HEIGHT = 16;
  LETTER_SPACING = 17;

  STACK_SPACING = 18;
  STACK_PADDING = 19;
  STACK_MODE = 20;
  STACK_ALIGNMENT = 21;

  OPACITY = 22;
}

message AnnotationProperty {
  AnnotationPropertyType type = 1;
}

message Annotation {
  string label = 1;
  AnnotationProperty[] properties = 2;
}

enum AnnotationMeasurementNodeSide {
  TOP = 0;
  BOTTOM = 1;
  LEFT = 2;
  RIGHT = 3;
}

message AnnotationMeasurement {
  GUID id = 1;
  // This lives on fromNode, however keeping the ID here is useful when
  // we are just keeping refs to AnnotationMeasurement in our application code.
  GUID fromNode = 2;
  GUID toNode = 3;
  AnnotationMeasurementNodeSide fromNodeSide = 4;
  // If fromNodeSide is TOP or BOTTOM, then toNodeSide must also be TOP or
  // BOTTOM. (And vice versa for LEFT and RIGHT). So we only need to track if
  // it's the same side or opposite through toSameSide.
  bool toSameSide = 5;
  float innerOffsetRelative = 6;
  float outerOffsetFixed = 7;
}

message LibraryMoveInfo {
  string oldKey = 1;
  string pasteFileKey = 2;
}

message LibraryMoveHistoryItem {
  GUID sourceNodeId = 1;
  string sourceComponentKey = 2;
}

message DeveloperRelatedLink {
  string nodeId = 1;
  string fileKey = 2;
  string linkName = 3;
  string linkUrl = 4;
}

// This is a pointer to a widget node in the scene. It's
// a message in case we want to store an override path
// in future (e.g. if widgets end up living in symbols).
message WidgetPointer {
  GUID nodeId = 1;
}

// This message contains information related to the last
// edit made on a node. Currently only contains timestamp in ISO8601
// format but is part of a message to allow it to be extended in the future
// with author attribution.
message EditInfo {
  string timestampIso8601 = 1;
  string userId = 2;
  uint lastEditedAt = 3;
  uint createdAt = 4;
}

enum EditorType {
  DESIGN = 0;
  WHITEBOARD = 1;
  SLIDES = 2;
}

enum MaskType {
  ALPHA = 0;
  OUTLINE = 1;
  LUMINANCE = 2;
}

enum ModuleType {
  NONE = 0;
  SINGLE_NODE = 1;
  MULTI_NODE = 2;
}

// Note: This was renamed to NodeStatus in C++. We had to keep the legacy
//       name here because renaming enums in the Kiwi schema is not supported.
enum SectionStatus {
  NONE = 0;
  BUILD = 1; // AKA "Ready for dev"
  // In the future, we can add a CUSTOM field here
}

// Note: This was renamed to NodeStatusInfo in C++. We had to keep the legacy
//       name here because renaming enums in the Kiwi schema is not supported.
message SectionStatusInfo {
  SectionStatus status = 1;
  // In the future, we can add a string field here to hold a custom tag
}

// NodeChange is grouped into pseudo-classes. We'd eventually like these
// groupings to be reflected as actual structs on the C++ side. Each class has a
// header and uses "Class extend SuperClass" syntax. To start with, we will
// probably manually implement the C++ side classes
//
// TODO: Figure out whether to use inheritance or composition. See
// https://github.com/figma/figma/pull/71145/files#r918328436 for discussion.
//
// TODO: Consider adding a first class "NodeFieldGroup" concept to kiwi and auto
// generate the class structure. NodeFieldGroup would also allow us to add new
// invariants that are currently impossible in kiwi. In particular, all fields
// of a message are optional. We could make it so that all or some of the fields
// in a group are required, but the group itself is optional. Although we'd
// probably not change multiplayer atomicity to account for groups. It would
// still be strictly NodeField-based probably, i.e. it would pretend the fields
// within a group were just inline in the group's parent message. Compared to
// adding a struct inside a message, this doesn't actually change the wire
// format or multiplayer atomicity. It just gives some extra type-safety style
// guarantees (similar to how TypeScript relates to JS).
//
// Here's the inheritance hierarcy (everything also inherits from NodeBase):
// - Asset
//   - Style
//   - Componentish
//     - Symbol
//     - StateGroup
// - Text
// - RenderableNode
// - AutoLayout
// - Plugin
// - Connector
// - FigJamShape
// - Widget
// - ForTest

message NodeChange {
  ///////////////////////////////////////
  // Last used node field index. We group nodefields by pseudo-class, but that
  // means it's annoying to figure out the next available index, so we document
  // that here. Please update this and the comment with the node field you added
  // if you add a new field so we can trigger merge conflicts pre-merge.
  //
  // next free node field index: 385, last node field name => measurements (384)
  ///////////////////////////////////////

  // We used to ensure every property "foo" has a corresponding "fooTag" property of type "uint", but the tags are now deprecated.

  ///////////////////////////////////////
  // NodeBase
  ///////////////////////////////////////
  GUID guid = 1;                                uint guidTag = 53 [deprecated];
  NodePhase phase = 2;                          uint phaseTag = 54 [deprecated];
  ParentIndex parentIndex = 3;                  uint parentIndexTag = 55 [deprecated];
  NodeType type = 4;                            uint typeTag = 56 [deprecated];
  string name = 5;                              uint nameTag = 57 [deprecated];


  ///////////////////////////////////////
  // Asset : NodeBase
  ///////////////////////////////////////
  // A generic boolean indicating if the node (e.g. a Style node)
  // can be published
  bool isPublishable = 174;
  string description = 318;
  LibraryMoveInfo libraryMoveInfo = 256;
  LibraryMoveHistoryItem[] libraryMoveHistory = 281;
  // The asset key; currently used by variable assets only.
  // componentKey and styleKey can eventually be merged into this field.
  string key = 319;

  // Populated only on the document node.
  // For all consumptions of an asset whose key is specified within this field,
  // resolve to the specified version.
  AssetIdMap fileAssetIds = 383;

  ///////////////////////////////////////
  // Style extends Asset
  ///////////////////////////////////////
  uint styleID = 49;
  uint styleIDTag = 101 [deprecated];
  bool isSoftDeletedStyle = 176; // will be replaced by isSoftDeleted
  bool isNonUpdateable = 177;
  bool isFillStyle = 157 [deprecated]; // replaced by styleType
  bool isStrokeStyle = 161 [deprecated];
  bool isOverrideOverTextStyle = 376;
  StyleType styleType = 163;
  string styleDescription = 191;
  // A generic hash of the version of the node
  // E.g. a Main style node uses version as the
  // main style version
  string version = 171;
  SharedStyleMasterData sharedStyleMasterData = 172;
  SharedStyleReference sharedStyleReference = 173;
  // The sort position of the style, within its defining file. This is currently
  // unused. It will be used as part of S2 removing
  // sharedStyleMasterData/sharedStyleReference.
  string sortPosition = 320;

  // Ignore this field. It was the predecessor to sevMoonlitLilyData and we were
  // feeling mischevious when we named it, but we've since renamed it for
  // clarity. It's not used for anything.
  SharedStyleMasterData ojansSuperSecretNodeField = 345 [deprecated];
  // This is a field populated for #sev-1-2023-03-20-moonlit-lily. Unless you're
  // specifically writing code to address this sev, ignore this field.
  SharedStyleMasterData sevMoonlitLilyData = 348;

  ///////////////////////////////////////
  // Componentish (Symbol | State Group) extends Asset
  ///////////////////////////////////////
  GUID inheritFillStyleID = 158;
  GUID inheritStrokeStyleID = 162;
  GUID inheritTextStyleID = 167;
  GUID inheritExportStyleID = 168;
  GUID inheritEffectStyleID = 169;
  GUID inheritGridStyleID = 170;
  GUID inheritFillStyleIDForStroke = 185;

  StyleId styleIdForFill = 332;
  StyleId styleIdForStrokeFill = 333;
  StyleId styleIdForText = 334;
  StyleId styleIdForEffect = 335;
  StyleId styleIdForGrid = 336;

  // TODO: Background paints no longer exist. Delete these two.
  Paint[] backgroundPaints = 193;
  GUID inheritFillStyleIDForBackground = 194 [deprecated];


  ///////////////////////////////////////
  // StateGroup extends Componentish
  ///////////////////////////////////////
  bool isStateGroup = 225;
  StateGroupPropertyValueOrder[] stateGroupPropertyValueOrders = 238;


  ///////////////////////////////////////
  // Symbol extends Componentish
  ///////////////////////////////////////
  SharedSymbolReference sharedSymbolReference = 122;

  // TODO: isSymbolPublishable could be merged with isPublishable at some point in the future
  // because they serve a similar purpose.
  bool isSymbolPublishable = 123;
  GUIDPathMapping[] sharedSymbolMappings = 124;

  // TODO: sharedSymbolVersion could be merged with version at some point in the future
  // because they serve a similar purpose.
  string sharedSymbolVersion = 126;

  SharedComponentMasterData sharedComponentMasterData = 152;
  string symbolDescription = 144;

  // Stores the mappings this symbol needs to correctly remap
  // its overrides in remote instances.
  GUIDPathMapping[] unflatteningMappings = 164;
  GUIDPathMapping[] forceUnflatteningMappings = 228;

  // c2: the following replace SharedComponentMasterData and SharedSymbolReference,
  // which aren't used in c2.
  string publishFile = 214;
  GUID publishID = 215;
  string componentKey = 216;
  bool isC2 = 217;  // Indicates whether file is under component 2.0 format
  string publishedVersion = 218;  // C2 field representing current published symbol version.

  // Deprecated
  string originComponentKey = 252 [deprecated];

  // eng-spec: http://go/ds-props
  ComponentPropDef[] componentPropDefs = 266;
  ComponentPropRef[] componentPropRefs = 267;

  ///////////////////////////////////////
  // Instance extends NodeBase
  ///////////////////////////////////////
  SymbolData symbolData = 113;                  uint symbolDataTag = 114 [deprecated]; // used by instance to reference overrides
  NodeChange[] derivedSymbolData = 125; // Uses GUIDPath as map key
  GUID overriddenSymbolID = 143;
  ComponentPropAssignment[] componentPropAssignments = 268;
  // https://paper.dropbox.com/doc/Bubbled-Props-Eng-Spec--BjWiuLkMXiUypzdlIpN8XJ7zAg-hoNxNifj2y8pdQ88w4rmd
  bool propsAreBubbled = 305;
  InstanceOverrideStash[] overrideStash = 248;
  InstanceOverrideStashV2[] overrideStashV2 = 250 [deprecated];

  ///////////////////////////////////////
  // Only used for NodeChanges within SymbolData.symbolOverrides (on instances).
  // These fields are not used independently.
  ///////////////////////////////////////
  GUIDPath guidPath = 111;                      uint guidPathTag = 112 [deprecated]; // used by instance override map
  int overrideLevel = 321;

  ///////////////////////////////////////
  // Module extends Asset
  ///////////////////////////////////////
  ModuleType moduleType = 382;


  ///////////////////////////////////////
  // Text extends NodeBase
  ///////////////////////////////////////
  float fontSize = 21;                          uint fontSizeTag = 73 [deprecated];
  float paragraphIndent = 22;                   uint paragraphIndentTag = 74 [deprecated];
  float paragraphSpacing = 23;                  uint paragraphSpacingTag = 75 [deprecated];
  TextAlignHorizontal textAlignHorizontal = 32; uint textAlignHorizontalTag = 84 [deprecated];
  TextAlignVertical textAlignVertical = 33;     uint textAlignVerticalTag = 85 [deprecated];
  TextCase textCase = 34;                       uint textCaseTag = 86 [deprecated];
  TextDecoration textDecoration = 35;           uint textDecorationTag = 87 [deprecated];
  Number lineHeight = 40;                       uint lineHeightTag = 92 [deprecated];
  FontName fontName = 41;                       uint fontNameTag = 93 [deprecated];
  TextData textData = 42;                       uint textDataTag = 94 [deprecated];
  DerivedTextData derivedTextData = 359;
  bool fontVariantCommonLigatures = 127;
  bool fontVariantContextualLigatures = 128;
  bool fontVariantDiscretionaryLigatures = 129;
  bool fontVariantHistoricalLigatures = 130;
  bool fontVariantOrdinal = 131;
  bool fontVariantSlashedZero = 132;
  FontVariantNumericFigure fontVariantNumericFigure = 133;
  FontVariantNumericSpacing fontVariantNumericSpacing = 134;
  FontVariantNumericFraction fontVariantNumericFraction = 135;
  FontVariantCaps fontVariantCaps = 136;
  FontVariantPosition fontVariantPosition = 137;
  Number letterSpacing = 165;
  // The version of the font referenced in fontName
  string fontVersion = 202;
  LeadingTrim leadingTrim = 322;
  bool hangingPunctuation = 337;
  bool hangingList = 339;
  int maxLines = 351;

  // Deprecated, use sectionStatusInfo instead.
  SectionStatus sectionStatus = 352 [deprecated];
  SectionStatusInfo sectionStatusInfo = 355;

  uint textUserLayoutVersion = 203;

  OpenTypeFeature[] toggledOnOTFeatures = 205;
  OpenTypeFeature[] toggledOffOTFeatures = 206;
  // This is currently only ever set as a style override within a text object
  Hyperlink hyperlink = 223;

  // Used for tracking at-mentions
  Mention mention = 340;

  FontVariation[] fontVariations = 260;
  uint textBidiVersion = 279;
  TextTruncation textTruncation = 280;
  bool hasHadRTLText = 292;


  ///////////////////////////////////////
  // RenderableNode extends NodeBase
  ///////////////////////////////////////
  bool visible = 6;                             uint visibleTag = 58 [deprecated];
  bool locked = 7;                              uint lockedTag = 59 [deprecated];
  float opacity = 8;                            uint opacityTag = 60 [deprecated];
  BlendMode blendMode = 9;                      uint blendModeTag = 61 [deprecated];
  Vector size = 11;                             uint sizeTag = 63 [deprecated];
  Matrix transform = 12;                        uint transformTag = 64 [deprecated];
  float[] dashPattern = 13;                     uint dashPatternTag = 65 [deprecated];
  bool mask = 16;                               uint maskTag = 68 [deprecated];

  // Deprecated in favor of maskType
  bool maskIsOutline = 18;                      uint maskIsOutlineTag = 70 [deprecated];

  MaskType maskType = 317;
  float backgroundOpacity = 19;                 uint backgroundOpacityTag = 71 [deprecated];
  float cornerRadius = 20;                      uint cornerRadiusTag = 72 [deprecated];
  float strokeWeight = 26;                      uint strokeWeightTag = 78 [deprecated];
  StrokeAlign strokeAlign = 29;                 uint strokeAlignTag = 81 [deprecated];
  StrokeCap strokeCap = 30;                     uint strokeCapTag = 82 [deprecated];
  StrokeJoin strokeJoin = 31;                   uint strokeJoinTag = 83 [deprecated];
  Paint[] fillPaints = 38;                      uint fillPaintsTag = 90 [deprecated];
  Paint[] strokePaints = 39;                    uint strokePaintsTag = 91 [deprecated];
  Effect[] effects = 43;                        uint effectsTag = 95 [deprecated];
  Color backgroundColor = 50;                   uint backgroundColorTag = 102 [deprecated];
  Path[] fillGeometry = 51;                     uint fillGeometryTag = 103 [deprecated];
  Path[] strokeGeometry = 52;                   uint strokeGeometryTag = 104 [deprecated];

  // The following values address rectangle corner rounding:
  // Values 145-148 represent the radius of curvature of
  // each rectangle corner.  Value 149 controls whether the
  // rectangle is drawn using the global value (20) or the
  // four independent values (145-148).  We also need to keep
  // the state of the corner rounding tool (which is split
  // between web and fullscreen) because this behavior varies
  // independently of whether the rectangle's corners are
  // actually independent.  When the tool commits a change, we
  // update 145-148 and 149 appropriately.

  float rectangleTopLeftCornerRadius = 145;
  float rectangleTopRightCornerRadius = 146;
  float rectangleBottomLeftCornerRadius = 147;
  float rectangleBottomRightCornerRadius = 148;
  bool rectangleCornerRadiiIndependent = 149;
  bool rectangleCornerToolIndependent = 150;

  bool proportionsConstrained = 151;
  bool useAbsoluteBounds = 258 [deprecated];

  // These are no longer used! We realized it was simpler to represent a hidden border side by a
  // zero value on the border<side>Weight properties below
  bool borderTopHidden = 287 [deprecated];
  bool borderBottomHidden = 288 [deprecated];
  bool borderLeftHidden = 289 [deprecated];
  bool borderRightHidden = 290 [deprecated];

  bool bordersTakeSpace = 294;

  float borderTopWeight = 295;
  float borderBottomWeight = 296;
  float borderLeftWeight = 297;
  float borderRightWeight = 298;
  bool borderStrokeWeightsIndependent = 299;

  ///////////////////////////////////////
  // AutoLayout extends NodeBase
  ///////////////////////////////////////

  // TODO: Split this into two classes: 1. values on an AL frame, 2. values on children of AL frames

  ConstraintType horizontalConstraint = 28;     uint horizontalConstraintTag = 80 [deprecated];
  StackMode stackMode = 105;                    uint stackModeTag = 106 [deprecated];
  float stackSpacing = 107;                     uint stackSpacingTag = 108 [deprecated];
  float stackPadding = 109;                     uint stackPaddingTag = 110 [deprecated];
  // \`stackCounterAlign\` is being deprecated in favor of \`stackChildAlignSelf\`.
  // It's not marked [deprecated] because existing documents on prod which haven't been migrated may still depend on this field.
  // See https://paper.dropbox.com/doc/8272020-Auto-Layout-v3-server-side-migration-engineering-plan--A66p1t5jgmSnBoTeBJMAm~CkAg-cNFlCeZDA3JaJxB0DMe21
  StackCounterAlign stackCounterAlign = 120;

  // \`stackJustify\` is deprecated in favor of \`stackPrimaryAlignItems\`.
  // NOTE: This isn't marked deprecated yet because there are still some tests in file-importer that check this field.
  StackJustify stackJustify = 121;

  StackAlign stackAlign = 208 [deprecated];
  float stackHorizontalPadding = 209;
  float stackVerticalPadding = 210;

  // \`stackWidth\` and \`stackHeight\` are deprecated in favor of \`stackPrimarySizing\` and \`stackCounterSizing\`.
  StackSize stackWidth = 211 [deprecated];
  StackSize stackHeight = 212 [deprecated];

  StackSize stackPrimarySizing = 229;
  StackJustify stackPrimaryAlignItems = 230;
  StackAlign stackCounterAlignItems = 231;
  float stackChildPrimaryGrow = 232;
  float stackPaddingRight = 233;
  float stackPaddingBottom = 234;
  StackCounterAlign stackChildAlignSelf = 236;
  StackPositioning stackPositioning = 269;
  bool stackReverseZIndex = 271;
  StackWrap stackWrap = 323;
  float stackCounterSpacing = 324;
  OptionalVector minSize = 325;
  OptionalVector maxSize = 326;
  StackCounterAlignContent stackCounterAlignContent = 343;

  bool isSnakeGameBoard = 344 [deprecated];

  ///////////////////////////////////////
  // Prototyping extends NodeBase
  ///////////////////////////////////////
  GUID transitionNodeID = 139;
  GUID prototypeStartNodeID = 140;
  Color prototypeBackgroundColor = 141;
  // DEPRECATED - this was split into the individual fields below
  TransitionInfo transitionInfo = 153 [deprecated];
  TransitionType transitionType = 154;
  float transitionDuration = 155;
  EasingType easingType = 156;
  bool transitionPreserveScroll = 181;
  ConnectionType connectionType = 182;
  string connectionURL = 183;
  PrototypeDevice prototypeDevice = 184;
  // Describes the kind of interaction that triggers a navigation from
  // this node (e.g. click, mouse enter, mouse exit, etc.)
  InteractionType interactionType = 187;

  // DEPRECATED
  float transitionTimeout = 188;
  bool interactionMaintained = 189;
  float interactionDuration = 190;

  bool destinationIsOverlay = 192 [deprecated];
  bool transitionShouldSmartAnimate = 207;

  PrototypeInteraction[] prototypeInteractions = 226;
  PrototypeStartingPoint prototypeStartingPoint = 249;


  ///////////////////////////////////////
  // Plugin extends NodeBase
  ///////////////////////////////////////
  PluginData[] pluginData = 204;
  PluginRelaunchData[] pluginRelaunchData = 219;


  ///////////////////////////////////////
  // Connector extends NodeBase
  ///////////////////////////////////////
  ConnectorEndpoint connectorStart = 242;
  ConnectorEndpoint connectorEnd = 243;
  ConnectorLineStyle connectorLineStyle = 244;
  StrokeCap connectorStartCap = 245;
  StrokeCap connectorEndCap = 246;
  ConnectorControlPoint[] connectorControlPoints = 253;
  ConnectorTextMidpoint connectorTextMidpoint = 255;
  ConnectorType connectorType = 373;

  ///////////////////////////////////////
  // Annotations
  ///////////////////////////////////////
  Annotation[] annotations = 369;
  AnnotationMeasurement[] measurements = 384;

  ///////////////////////////////////////
  // FigJamShape extends NodeBase
  ///////////////////////////////////////
  ShapeWithTextType shapeWithTextType = 241;
  float shapeUserHeight = 247;

  // These are fields that are calculated as part of layout for immutable frames.
  // You can think of nodeGenerationData as the inputs or source of truth and derivedImmutableFrameData
  // as the outputs. This field is used as a cache so we don't have to recalculate these fields in the viewer.
  DerivedImmutableFrameData derivedImmutableFrameData = 254;

  // Sent over the wire only, not persisted. Used to prevent flickering between active clients.
  MultiplayerFieldVersion derivedImmutableFrameDataVersion = 338;

  // This is data that is used to build out child nodes in immutable frames (stickies, connectors, etc.)
  // these are the inputs that are used to generate the actualized nodes in the canvas.
  // A much better name for this field would be immutableFrameData, but we can't rename fields in kiwi.
  NodeGenerationData nodeGenerationData = 240;

  CodeBlockLanguage codeBlockLanguage = 259;
  LinkPreviewData linkPreviewData = 278;
  bool shapeTruncates = 282;
  bool sectionContentsHidden = 283;
  VideoPlayback videoPlayback = 300;
  StampData stampData = 301;
  SectionPresetInfo sectionPresetInfo = 370;


  ///////////////////////////////////////
  // Widget extends NodeBase
  ///////////////////////////////////////
  MultiplayerMap widgetSyncedState = 273;
  uint widgetSyncCursor = 274 [deprecated];
  WidgetDerivedSubtreeCursor widgetDerivedSubtreeCursor = 275 [deprecated];
  WidgetPointer widgetCachedAncestor = 276;
  WidgetInputBehavior widgetInputBehavior = 285;
  string widgetTooltip = 286;
  WidgetHoverStyle widgetHoverStyle = 291;
  bool isWidgetStickable = 293;
  bool shouldHideCursorsOnWidgetHover = 360;
  WidgetMetadata widgetMetadata = 262;
  WidgetEvent[] widgetEvents = 263;
  WidgetPropertyMenuItem[] widgetPropertyMenuItems = 265;

  ///////////////////////////////////////
  // Table extends NodeBase
  ///////////////////////////////////////
  TableRowColumnPositionMap tableRowPositions = 308;
  TableRowColumnPositionMap tableColumnPositions = 309;
  TableRowColumnSizeMap tableRowHeights = 310;
  TableRowColumnSizeMap tableColumnWidths = 311;

  ///////////////////////////////////////
  // InteractiveSlideElement extends NodeBase
  ///////////////////////////////////////
  MultiplayerMap interactiveSlideConfigData = 371;
  MultiplayerMap interactiveSlideParticipantData = 372;

  ///////////////////////////////////////
  // ThemeData for Slides
  ///////////////////////////////////////
  ThemeID themeID = 379;
  SlideThemeData slideThemeData = 381;

  ///////////////////////////////////////
  // Assisted layout                   //
  ///////////////////////////////////////

  GUID diagramParentId = 363 [deprecated];
  GUID layoutRoot = 362 [deprecated];
  string layoutPosition = 364 [deprecated];
  DiagramLayoutRuleType diagramLayoutRuleType = 366;
  DiagramParentIndex diagramParentIndex = 367;
  DiagramLayoutPaused diagramLayoutPaused = 368;

  ///////////////////////////////////////
  // Page dividers
  ///////////////////////////////////////
  bool isPageDivider = 380;

  ///////////////////////////////////////
  // ForTest
  ///////////////////////////////////////
  // We use this for unit testing schema compatibility
  InternalEnumForTest internalEnumForTest = 251;

  // We use this for kiwi schema compatibility testing
  InternalDataForTest internalDataForTest = 257;


  ///////////////////////////////////////
  // TODO: triage all these into appropriate groups
  ///////////////////////////////////////
  uint count = 10;                              uint countTag = 62 [deprecated];
  bool autoRename = 14;                         uint autoRenameTag = 66 [deprecated];
  bool backgroundEnabled = 15;                  uint backgroundEnabledTag = 67 [deprecated];
  bool exportContentsOnly = 17;                 uint exportContentsOnlyTag = 69 [deprecated];
  float starInnerScale = 24;                    uint starInnerScaleTag = 76 [deprecated];
  float miterLimit = 25;                        uint miterLimitTag = 77 [deprecated];
  float textTracking = 27;                      uint textTrackingTag = 79 [deprecated];
  BooleanOperation booleanOperation = 36;       uint booleanOperationTag = 88 [deprecated];
  ConstraintType verticalConstraint = 37;       uint verticalConstraintTag = 89 [deprecated];
  VectorMirror handleMirroring = 44;            uint handleMirroringTag = 96 [deprecated];
  ExportSettings[] exportSettings = 45;         uint exportSettingsTag = 97 [deprecated];
  TextAutoResize textAutoResize = 46;           uint textAutoResizeTag = 98 [deprecated];
  LayoutGrid[] layoutGrids = 47;                uint layoutGridsTag = 99 [deprecated];
  VectorData vectorData = 48;                   uint vectorDataTag = 100 [deprecated];
  bool frameMaskDisabled = 115;                 uint frameMaskDisabledTag = 116 [deprecated];
  bool resizeToFit = 117;                       uint resizeToFitTag = 118 [deprecated];

  // don't add tags anymore... they will be removed in a future update
  bool exportBackgroundDisabled = 119;

  Guide[] guides = 138;
  bool internalOnly = 142;

  // This field would be better named OverflowDirection, which is
  // what the user sees in the UI. For that reason, most places in
  // the C++ & viewer code (but not web) also access it as OverflowDirection.
  ScrollDirection scrollDirection = 159;
  float cornerSmoothing = 160;
  Vector scrollOffset = 166 [deprecated];
  bool exportTextAsSVGText = 175;
  ScrollContractedState scrollContractedState = 178 [deprecated];
  // Due to a bug, some nodes in production have contractedSize set to some
  // non-zero value even thought it was never used for a feature used in production.
  Vector contractedSize = 179 [deprecated];
  string fixedChildrenDivider = 180 [deprecated];
  ScrollBehavior scrollBehavior = 186;

  ArcData arcData = 195;
  int derivedSymbolDataLayoutVersion = 196;

  NavigationType navigationType = 197;
  OverlayPositionType overlayPositionType = 198;
  Vector overlayRelativePosition = 199; // Deprecated into PrototypeAction
  OverlayBackgroundInteraction overlayBackgroundInteraction = 200;
  OverlayBackgroundAppearance overlayBackgroundAppearance = 201;

  // c2: durable stable ID for override mapping
  GUID overrideKey = 213;

  // This is present on a frames/instances/symbols which have been migrated to support
  // fill/stroke/corners during the \`frame_properties_migration\`.
  // Spec: https://paper.dropbox.com/doc/Tech-spec-frame-properties-8n6mTCIBtcMS7PEn50nOS
  bool containerSupportsFillStrokeAndCorners = 220;
  StackSize stackCounterSizing = 221;

  bool containersSupportFillStrokeAndCorners = 222 [deprecated];
  KeyTrigger keyTrigger = 224;
  string voiceEventPhrase = 227;
  GUID[] ancestorPathBeforeDeletion = 235;
  SymbolLink[] symbolLinks = 237;
  TextListData textListData = 239 [deprecated];

  bool detachOpticalSizeFromFontSize = 261;
  float listSpacing = 264;
  EmbedData embedData = 270;

  RichMediaData richMediaData = 272;
  // This is the value for synced state that represents what is
  // actually on the sceneGraph at a given time. This is not actually
  // used as a multiplayer map and should be synced atomically it just
  // shares the exact same shape.
  MultiplayerMap renderedSyncedState = 277;

  // Set on a component and controls whether a simpler layer and property panel is
  // shown for instances.
  bool simplifyInstancePanels = 284;

  // Used for accessibility annotations
  HTMLTag accessibleHTMLTag = 302;
  ARIARole ariaRole = 303;
  string accessibleLabel = 304;

  VariableData variableData = 306 [deprecated];

  // The following fields encode variable bindings on variable consumers:
  // 1. The consumption map contains bindings of simple fields.
  VariableDataMap variableConsumptionMap = 307;
  // 2. The modeBySet map contains the specific mode of variable sets used by
  // the consumer.
  VariableModeBySetMap variableModeBySetMap = 316;

  // Present on variable set nodes only.
  VariableSetMode[] variableSetModes = 312;

  // The following fields are present variable nodes only.
  // Identifies the set that the variable belongs to.
  VariableSetID variableSetID = 313;
  VariableResolvedDataType variableResolvedType = 314;
  // Specifies the variable data for the variable under each mode.
  VariableDataValues variableDataValues = 315;
  string variableTokenName = 350 [deprecated];

  // What scopes this variable is shown in (i.e. what fields can
  // this variable be used in). null = all fields
  VariableScope[] variableScopes = 353;

  // User defined token names for a variable, used in Lego and import/export
  CodeSyntaxMap codeSyntax = 358;

  //////////////////////////////
  //// Extended collections ////
  //////////////////////////////

  // The ID of the base variable set or set extension a given variable set extension overrides
  VariableSetID backingVariableSetId = 377;
  // The ID of the base variable or variable override a given variable override applies to.
  VariableIdOrVariableOverrideId backingVariableId = 378;

  HandoffStatusMap handoffStatusMap = 361;

  AgendaPositionMap agendaPositionMap = 327;
  AgendaMetadataMap agendaMetadataMap = 328;

  // only set on the root DOCUMENT element
  MigrationStatus migrationStatus = 329;

  // generic replacement for isSoftDeletedStyle that can be applied to other asset types
  bool isSoftDeleted = 330;

  // only set on top level frames
  EditInfo editInfo = 331;

  // This is currently not being used but could be used in the future to allow for per node color profiles.
  // For the document color profile, see documentColorProfile.
  ColorProfile colorProfile = 341 [deprecated];

  // Set whenever an instance is detached, making it possible to find the original component later on.
  SymbolId detachedSymbolId = 342;

  // Controls the primary reading order for children of this node.
  ChildReadingDirection childReadingDirection = 346;
  // The explicit reading order for this node within its parent.
  string readingIndex = 347;

  // only set on the root DOCUMENT element
  DocumentColorProfile documentColorProfile = 349;

  // temporarily stores related links for copy and paste
  DeveloperRelatedLink[] developerRelatedLinks = 354;

  string slideActiveThemeLibKey = 356;

	// a map of ARIA attributes to their values (e.g. aria-checked="true")
  ARIAAttributesMap ariaAttributes = 357;

  // A list of the edit scope stacks that this node was changed under. May be multiple stacks if
  // this NodeChange sets multiple fields.
  // go/edit-scopes-backend
  EditScopeInfo editScopeInfo = 365;
  ///////////////////////////////////////
  // See top-level NodeChanges comment to find the next available field index.
  ///////////////////////////////////////

  SemanticWeight semanticWeight = 374;
  SemanticItalic semanticItalic = 375;
}

message VideoPlayback {
  bool autoplay = 1;
  bool mediaLoop = 2;
  bool muted = 3;
}

enum MediaAction {
  PLAY = 0;
  PAUSE = 1;
  TOGGLE_PLAY_PAUSE = 2;
  MUTE = 3;
  UNMUTE = 4;
  TOGGLE_MUTE_UNMUTE = 5;
  SKIP_FORWARD = 6;
  SKIP_BACKWARD = 7;
  SKIP_TO = 8;
}

message WidgetHoverStyle {
  Paint[] fillPaints = 1;
  Paint[] strokePaints = 2;
  float opacity = 3;
  bool areFillPaintsSet = 4;
  bool areStrokePaintsSet = 5;
  bool isOpacitySet = 6;
}

// Deprecated
message WidgetDerivedSubtreeCursor {
  uint sessionID = 1;
  uint counter = 2;
}

// A special type that knows how to diff and merge itself, allowing
// separate sessions to write to the map concurrently without
// clobbering each other's changes.
message MultiplayerMap {
  MultiplayerMapEntry[] entries = 1;
}

message MultiplayerMapEntry {
  string key = 1;
  string value = 2;
}

message VariableDataMap {
  VariableDataMapEntry[] entries = 1;
}

message VariableDataMapEntry {
  uint nodeField = 1; // deprecated, should write to variableField instead
  VariableData variableData = 2;
  VariableField variableField = 3;
}

enum VariableField {
  MISSING = 0;
  CORNER_RADIUS = 1; // deprecated, should write to RECTANGLE_X_X_CORNER_RADIUS instead
  PARAGRAPH_SPACING = 2;
  PARAGRAPH_INDENT = 3;
  STROKE_WEIGHT = 4; // deprecated, should write to BORDER_X_WEIGHT instead
  STACK_SPACING = 5;
  STACK_PADDING_LEFT = 6;
  STACK_PADDING_TOP = 7;
  STACK_PADDING_RIGHT = 8;
  STACK_PADDING_BOTTOM = 9;
  VISIBLE = 10;
  TEXT_DATA = 11;
  WIDTH = 12;
  HEIGHT = 13;
  RECTANGLE_TOP_LEFT_CORNER_RADIUS = 14;
  RECTANGLE_TOP_RIGHT_CORNER_RADIUS = 15;
  RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS = 16;
  RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS = 17;
  BORDER_TOP_WEIGHT = 18;
  BORDER_BOTTOM_WEIGHT = 19;
  BORDER_LEFT_WEIGHT = 20;
  BORDER_RIGHT_WEIGHT = 21;
  VARIANT_PROPERTIES = 22;
  STACK_COUNTER_SPACING = 23;
  MIN_WIDTH = 24;
  MAX_WIDTH = 25;
  MIN_HEIGHT = 26;
  MAX_HEIGHT = 27;
  FONT_FAMILY = 28;
  FONT_STYLE = 29;
  FONT_VARIATIONS = 30;
}

message VariableModeBySetMap {
  VariableModeBySetMapEntry[] entries = 1;
}

message VariableModeBySetMapEntry {
  VariableSetID variableSetID = 1;
  GUID variableModeID = 2;
}

message CodeSyntaxMap {
  CodeSyntaxMapEntry[] entries = 1;
}

message CodeSyntaxMapEntry {
  CodeSyntaxPlatform platform = 1;
  string value = 2;
}

message TableRowColumnPositionMap {
  TableRowColumnPositionMapEntry[] entries = 1;
}
message TableRowColumnPositionMapEntry {
  GUID id = 1;
  string position = 2;
}

message TableRowColumnSizeMap {
  TableRowColumnSizeMapEntry[] entries = 1;
}

message TableRowColumnSizeMapEntry {
  GUID id = 1;
  float size = 2;
}

message AgendaPositionMap {
  AgendaPositionMapEntry[] entries = 1;
}

message AgendaPositionMapEntry {
  GUID id = 1;
  string position = 2;
}

enum AgendaItemType {
  NODE = 0; // node (such as a section) associated with this particular agenda item
  BLOCK = 1; // free floating item not tied to any node, such as "break"
}

message AgendaMetadataMap {
  AgendaMetadataMapEntry[] entries = 1;
}

message AgendaMetadataMapEntry {
  GUID id = 1;
  AgendaMetadata data = 2;
}

message AgendaMetadata {
  string name = 1;
  AgendaItemType type = 2;
  GUID targetNodeID = 3; // optional node ID that points to a node on canvas, such as a section
  AgendaTimerInfo timerInfo = 4;
  AgendaVoteInfo voteInfo = 5;
  AgendaMusicInfo musicInfo = 6;
}

message AgendaTimerInfo {
  uint timerLength = 1;
}

message AgendaVoteInfo {
  uint voteCount = 1;
}

message AgendaMusicInfo {
  string songID = 1;
  uint startTimeMs = 2;
}

enum DiagramLayoutRuleType {
  NONE = 0;
  TREE = 1;
}

struct DiagramParentIndex {
  GUID guid;
  string position;
}

enum DiagramLayoutPaused {
  NO = 0;
  YES = 1;
}

message ComponentPropRef {
  uint nodeField = 1; // should not be written to and componentPropNodeField used instead
  GUID defID = 2;
  string zombieFallbackName = 3;
  ComponentPropNodeField componentPropNodeField = 4;
  bool isDeleted = 5; // deprecated
}

// Should be kept in sync with decodeComponentPropNodeField in serialization.sk
enum ComponentPropNodeField {
  VISIBLE = 0;
  TEXT_DATA = 1;
  OVERRIDDEN_SYMBOL_ID = 2;
  INHERIT_FILL_STYLE_ID = 3; // deprecated
}

message ComponentPropAssignment {
  GUID defID = 1;
  ComponentPropValue value = 2;
}

message ComponentPropDef {
  GUID id = 1;
  string name = 2;
  // NOTE: In most places in the code, we refer to the component prop value
  // as the default value. This field is called initial value for historical
  // reasons; since we can't easily rename this here, we continue to refer to
  // default value as initial value when encoding/decoding kiwi messages.
  ComponentPropValue initialValue = 3;
  string sortPosition = 4;
  GUID parentPropDefId = 5;
  ComponentPropType type = 6;
  bool isDeleted = 7; // deprecated
  ComponentPropPreferredValues preferredValues = 8;
}

// every ComponentPropDef and ComponentPropAssignment value
// will have exactly one field in ComponentPropValue set.
message ComponentPropValue {
  bool boolValue = 1;
  TextData textValue = 2;
  GUID guidValue = 3;
}

// Should be kept in sync with mapPublicComponentPropTypeToKiwi in jsvm_node_properties.ts
enum ComponentPropType {
  BOOL = 0;
  TEXT = 1;
  COLOR = 2; // deprecated
  INSTANCE_SWAP = 3;
}

message ComponentPropPreferredValues {
  string[] stringValues = 1 [deprecated];
  InstanceSwapPreferredValue[] instanceSwapValues = 2;
}

message InstanceSwapPreferredValue {
  InstanceSwapPreferredValueType type = 1;
  string key = 2;
}

enum InstanceSwapPreferredValueType {
  COMPONENT = 0;
  STATE_GROUP = 1;
}

enum WidgetEvent {
  MOUSE_DOWN = 0;
  CLICK = 1;
  TEXT_EDIT_END = 2;
  ATTACHED_STICKABLES_CHANGED = 3;
  STUCK_STATUS_CHANGED = 4;
}

enum WidgetInputBehavior {
  WRAP = 0;
  TRUNCATE = 1;
  MULTILINE = 2;
}

message WidgetMetadata {
  string pluginID = 1;
  string pluginVersionID = 2;
  string widgetName = 3;
}

enum WidgetPropertyMenuItemType {
  ACTION = 0;
  SEPARATOR = 1;
  COLOR = 2; // deprecated
  DROPDOWN = 3;
  COLOR_SELECTOR = 4;
  TOGGLE = 5;
  LINK = 6;
}

message WidgetPropertyMenuSelectorOption {
  string option = 1;
  string tooltip = 2;
}

message WidgetPropertyMenuItem {
  string propertyName = 1;
  string tooltip = 2;
  WidgetPropertyMenuItemType itemType = 3;
  string icon = 4; // svg string for the icon to display eg. "<svg ..."
  WidgetPropertyMenuSelectorOption[] options = 5; // array of strings used for selector menus
  string selectedOption = 6; // the selected value for selector menus
  bool isToggled = 7; // defaults to false, is true when button is selected
  string href = 8; // url to open for link menu items
  bool allowCustomColor = 9; // defaults to false, can be set to true to allow users to choose custom colors with the color selector
}

enum CodeBlockLanguage {
  TYPESCRIPT = 0;
  CPP = 1;
  RUBY = 2;
  CSS = 3;
  JAVASCRIPT = 4;
  HTML = 5;
  JSON = 6;
  GRAPHQL = 7;
  PYTHON = 8;
  GO = 9;
  SQL = 10;
  SWIFT = 11;
  KOTLIN = 12;
  RUST = 13;
  BASH = 14;
  PLAINTEXT = 15;
}

enum InternalEnumForTest {
  OLD = 1;
}

message InternalDataForTest {
  int testFieldA = 1;
}

message StateGroupPropertyValueOrder {
  string property = 1;
  string[] values = 2;
}

// Deprecated in favor of TextLineData
message TextListData {
  int listID = 1 [deprecated];
  BulletType bulletType = 2 [deprecated];
  int indentationLevel = 3 [deprecated];
  int lineNumber = 4 [deprecated];
}

// Deprecated in favor of LineType
enum BulletType {
  ORDERED = 0;
  UNORDERED = 1;
  INDENT = 2;
  NO_LIST = 3;
}

message TextLineData {
  LineType lineType = 1;
  int indentationLevel = 2;
  SourceDirectionality sourceDirectionality = 9;
  Directionality directionality = 3;
  DirectionalityIntent directionalityIntent = 4;
  int downgradeStyleId = 5;
  int consistencyStyleId = 6;
  int listStartOffset = 7;
  bool isFirstLineOfList = 8;
}

message DerivedTextLineData {
  Directionality directionality = 1;
}

enum LineType {
  PLAIN = 0;
  ORDERED_LIST = 1;
  UNORDERED_LIST = 2;
  BLOCKQUOTE = 3;
  HEADER = 4;
}

enum SourceDirectionality {
  AUTO = 0;
  LTR = 1;
  RTL = 2;
}

enum Directionality {
  LTR = 0;
  RTL = 1;
}

enum DirectionalityIntent {
  IMPLICIT = 0;
  EXPLICIT = 1;
}

message PrototypeInteraction {
  GUID id = 1;
  PrototypeEvent event = 2;
  PrototypeAction[] actions = 3;
  bool isDeleted = 4;
  int stateManagementVersion = 5;
}

message PrototypeEvent {
  InteractionType interactionType = 1;
  // When interactionType is MOUSE_IN/MOUSE_ENTER, MOUSE_OUT/MOUSE_LEAVE, MOUSE_DOWN or MOUSE_UP
  // and interactionMaintained is true, we wait for the interaction to "keep
  // going" for some specified duration before triggering its action.
  //
  // For example if interactionType is MOUSE_DOWN and interactionDuration
  // is 300, then we will wait for the user to continually mouse down for
  // 300ms before performing the requested action.
  bool interactionMaintained = 2;
  // Stored in milliseconds
  float interactionDuration = 3;
  // Used for keydown events transition triggers and in the future keyup
  KeyTrigger keyTrigger = 4;
  string voiceEventPhrase = 5;
  // If we transition to a node in the prototype view with
  // interactionType == AFTER_TIMEOUT, then after the duration specified
  // in transitionTimeout we should navigate again with whatever
  // transition properties are stored on this node.
  //
  // This duration is stored in ms.
  float transitionTimeout = 6;
  // Point in video to trigger ON_MEDIA_HIT events
  float mediaHitTime = 7;
}

// The information about a variable we're targetting for a
// Set Variable PrototypeAction. This may grow to include info about
// modes.
message PrototypeVariableTarget {
  VariableID id = 1;
}

// The list of actions to execute for Conditional actions in prototype interactions
message ConditionalActions {
  PrototypeAction[] actions = 1;
  VariableData condition = 2;
}

message PrototypeAction {
  GUID transitionNodeID = 1;
  TransitionType transitionType = 2;
  float transitionDuration = 3;
  EasingType easingType = 4;
  // This was moved into PrototypeEvent
  float transitionTimeout = 5 [deprecated];
  bool transitionShouldSmartAnimate = 6;
  ConnectionType connectionType = 7;
  string connectionURL = 8;
  Vector overlayRelativePosition = 9;
  NavigationType navigationType = 10;
  bool transitionPreserveScroll = 11;
  float[] easingFunction = 12;
  Vector extraScrollOffset = 13;

  // For Set Variable action
  // Deprecated for the VariableID version below
  GUID targetVariableID = 14 [deprecated];

  // For Set Variable action
  // Deprecated for targetVariableData
  VariableAnyValue targetVariableValue = 15 [deprecated];


  MediaAction mediaAction = 16;
  bool transitionResetVideoPosition = 17;
  bool openUrlInNewTab = 18;

  PrototypeVariableTarget targetVariable = 19;
  VariableData targetVariableData = 20;

  // Point in video for SET_TO media actions (in seconds)
  float mediaSkipToTime = 21;
  // Time delta to change the video by for SKIP_FORWARD/BACKWARD media actions (in seconds)
  float mediaSkipByAmount = 22;

  // This is deprecated in favor of the conditionalActions field
  VariableData[] conditions = 23;

  // This array holds the list of conditions and the actions to be run if said
  // condition is true.  We will iterate through each conditionalAction object
  // and find the first one with a true condition, then run its actions.
  ConditionalActions[] conditionalActions = 24;

  bool transitionResetScrollPosition = 25;
  bool transitionResetInteractiveComponents = 26;
}

message PrototypeStartingPoint {
  string name = 1;
  string description = 2;
  string position = 3;  // this is a string and not a number in order to use Fractional Indexing
}

enum TriggerDevice {
  KEYBOARD = 0;
  UNKNOWN_CONTROLLER = 1;
  XBOX_ONE = 2;
  PS4 = 3;
  SWITCH_PRO = 4;
}

message KeyTrigger {
  int[] keyCodes = 1;
  TriggerDevice triggerDevice = 2;
}

message Hyperlink {
  // This object either contains a url or a node ID -- never both!
  string url = 1;
  GUID guid = 2;
}

enum MentionSource {
  DEFAULT = 0;
  COPY_DUPLICATE = 1;
}

message Mention {
  GUID id = 1;
  string mentionedUserId = 2; // deprecated - use mentionedUserIdInt
  string mentionedByUserId = 3; // deprecated - use mentionedByUserIdInt
  // Allows us to ignore mentions that came from file duplication
  string fileKey = 4;
  // Where did the mention came from. Used to filter which ones should be processed
  MentionSource source = 5;

  uint64 mentionedUserIdInt = 6;
  uint64 mentionedByUserIdInt = 7;
}


message EmbedData {
  string url = 1;
  string srcUrl = 2;
  string title = 3;
  string thumbnailUrl = 4;
  float width = 5;
  float height = 6;

  string embedType = 7;
  string thumbnailImageHash = 8;
  string faviconImageHash = 9;
  string provider = 10;
  string originalText = 11;
  string description = 12;
  // embedVersionId is a string in the form of "v0", "v1", etc - each integer is a 1:1 mapping to which embed React component will be rendered
  string embedVersionId = 13;
}

message StampData {
  string userId = 1;
  string votingSessionId = 2;
  string stampedByUserId = 3;
}

message LinkPreviewData {
  string url = 1;
  string title = 2;
  string provider = 3;
  string description = 4;
  string thumbnailImageHash = 5;
  string faviconImageHash = 6;
  float thumbnailImageWidth = 7;
  float thumbnailImageHeight = 8;
}

message Viewport {
  Rect canvasSpaceBounds = 1;
  bool pixelPreview = 2;
  float pixelDensity = 3;
  GUID canvasGuid = 4;
}

message Mouse {
  MouseCursor cursor = 1;
  Vector canvasSpaceLocation = 2;
  Rect canvasSpaceSelectionBox = 3;
  GUID canvasGuid = 4;
  uint cursorHiddenReason = 5;
}

struct Click {
  uint id;
  Vector point; // In canvas space
}

struct ScrollPosition {
  GUID node;
  Vector scrollOffset;
}

// DEPRECATED
struct TriggeredOverlay {
  GUID overlayGuid;
  GUID hotspotGuid;
  GUID swapGuid;
}

message TriggeredOverlayData {
  GUID overlayGuid = 1;
  GUID hotspotGuid = 2; // TODO(achan): Deprecate
  GUID swapGuid = 3;
  GUID prototypeInteractionGuid = 4;

  GUIDPath hotspotBlueprintId = 5;
}

message TriggeredSetVariableActionData {
  GUID nodeForFindingTopmostScreenId = 1;
  string targetVariableId = 2;
  string targetVariableData = 3;
  string resolvedVariableModes = 4;
}

message VideoStateChangeData {
  GUID targetNodeId = 1;
  bool isPlaying = 2;
  bool isPlayingSound = 3;
  uint[] currentTimes = 4;
  uint actionTakenTimestamp = 5;
}

message PresentedState {
  GUID baseScreenID = 1;
  TriggeredOverlayData[] overlays = 2;
}

enum TransitionDirection {
  FORWARD = 0;
  REVERSE = 1;
}

message TopLevelPlaybackChange {
  PresentedState oldState = 1;
  PresentedState newState = 2;

  GUIDPath hotspotBlueprintID = 3;
  GUID interactionID = 4;
  bool isHotspotInNewPresentedState = 5;
  TransitionDirection direction = 6;
  GUIDPath instanceStablePath = 7;
}

message InstanceStateChange {
  GUID stateID = 1;
  GUID interactionID = 2;
  GUIDPath hotspotStablePath = 3;
  GUIDPath instanceStablePath = 4;
  PlaybackChangePhase phase = 5;
}

message TextCursor {
  Rect selectionBox = 1;
  GUID canvasGuid = 2 [deprecated];
  GUID textNodeGuid = 3;
}

message TextSelection {
  Rect[] selectionBoxes = 1;
  GUID canvasGuid = 2 [deprecated];
  GUID textNodeGuid = 3;
  Vector textSelectionRange = 4;
  GUID textNodeOrContainingIfGuid = 5;
  GUID tableCellRowId = 6;
  GUID tableCellColId = 7;
}

enum PlaybackChangePhase {
  INITIATED = 0;
  ABORTED = 1;
  COMMITTED = 2;
}

message PlaybackChangeKeyframe {
  PlaybackChangePhase phase = 1;
  float progress = 2; // Should be between 0 and 1
  float timestamp = 3; // Time in seconds
}

message StateMapping {
  GUIDPath stablePath = 1;
  TopLevelPlaybackChange lastTopLevelChange = 2;
  PlaybackChangeKeyframe lastTopLevelChangeStatus = 3; // Time at which lastChange entered lastChangeStatus on the driver client
  float timestamp = 4;
}

message ScrollMapping {
  GUIDPath blueprintID = 1;
  uint overlayIndex = 2;
  Vector scrollOffset = 3;
}

message PlaybackUpdate {
  TopLevelPlaybackChange lastTopLevelChange = 1;
  PlaybackChangeKeyframe lastTopLevelChangeStatus = 2;

  ScrollMapping[] scrollMappings = 3;
  float timestamp = 4; // Time in seconds
  Vector pointerLocation = 5; // Canvas-space mouse coordinates
  bool isTopLevelFrameChange = 6;
  StateMapping[] stateMappings = 7; // Deprecated
}

// This is a \`message\` (instead of just a \`string message\` on UserChange)
// so that we can add more properties to it in future if we want to.
message ChatMessage {
  string text = 1; // current message, not renamed to maintain backwards compatibility
  string previousText = 2;
}

// Message for all voice chat related metadata.
message VoiceMetadata {
  string connectedCallId = 1;
}

enum Heartbeat {
  FOREGROUND = 0;
  BACKGROUND = 1;
}

message UserChange {
  uint sessionID = 1;
  bool connected = 2;
  string name = 3;
  Color color = 4;
  string imageURL = 5;
  Viewport viewport = 6;
  Mouse mouse = 7;
  GUID[] selection = 8;
  uint[] observing = 9;
  string deviceName = 10; // Valid values: "viewer" | "editor" | "prototype"

  // Only keeps the last N around to avoid being a memory leak
  Click[] recentClicks = 11;
  ScrollPosition[] scrollPositions = 12; // TODO(achan): Deprecate
  TriggeredOverlay[] triggeredOverlays = 13 [deprecated];

  string userID = 14;

  GUID lastTriggeredHotspot = 15; // TODO(achan): Deprecate
  GUID lastTriggeredPrototypeInteractionID = 16; // TODO(achan): Deprecate
  TriggeredOverlayData[] triggeredOverlaysData = 17; // TODO(achan): Deprecate

  PlaybackUpdate[] playbackUpdates = 18 [deprecated];
  ChatMessage chatMessage = 19;
  VoiceMetadata voiceMetadata = 20;
  bool canWrite = 21;
  bool highFiveStatus = 22;
  InstanceStateChange[] instanceStateChanges = 23;
  TextCursor textCursor = 24;
  TextSelection textSelection = 25;
  uint connectedAtTimeS = 26; // Time in seconds connected since the start of multiplayer server
  bool focusOnTextCursor = 27;
  Heartbeat heartbeat = 28;
  TriggeredSetVariableActionData[] triggeredSetVariableActionData = 29;
  VideoStateChangeData[] videoStateChangeData = 30;
}

message InteractiveSlideElementChange {
  string userID = 1 [deprecated]; // This was before we realized we could infer the userId from MP.
  // anonyomousUserID is set if the user is anon, otherwise the userId is
  // inferred from the multiplayer connection.
  string anonymousUserID = 2;
  GUID nodeID = 3;
  string responseData = 4;
}

enum SceneGraphQueryBehavior {
  DEFAULT = 0;
  CONTAINING_PAGE = 1;
}

message SceneGraphQuery {
  GUID startingNode = 1;
  uint depth = 2;
  SceneGraphQueryBehavior behavior = 3;
}

// Deprecated.
message NodeChangesMetadata {
  uint blobsFieldOffset = 1;
}

message CursorReaction {
  string imageUrl = 1;
}

message TimerInfo {
  bool isPaused = 1;
  uint timeRemainingMs = 2;
  uint totalTimeMs = 3;
  uint timerID = 4;
  string setBy = 5;
  uint songID = 6 [deprecated];
  uint lastReceivedSongTimestampMs = 7;
  string songUUID = 8;
}

message MusicInfo {
  bool isPaused = 1;
  uint messageID = 2;
  string songID = 3;
  uint lastReceivedSongTimestampMs = 4;
  bool isStopped = 5;
}

message PresenterNomination {
  uint sessionID = 1;
  bool isCancelled = 2;
}

message PresenterInfo {
  uint sessionID = 1;
  PresenterNomination nomination = 2;
}

// ClientBroadcasts are a way to broadcast information verbatim from one
// client in a file to all others. If you're wondering whether to use a
// signal, a client broadcast, or UserChanges, here are some guidelines...
//
//  - Signals are for the behind-the-scenes functioning of our protocol
//    and have very simple payloads (always a short string). Examples: a
//    client telling the server why it's disconnecting, or the server telling
//    the client why it can't connect.
//  - ClientBroadcasts are a way to publish user actions to other clients. They
//    have arbitrarily complex payloads and are ephemeral (i.e. multiplayer
//    server can forget about them once they've been broadcast). Examples:
//    cursor reactions.
//  - UserChanges are a way to publish user actions to other clients. They have
//    arbitrarily complex payloads and are stateful. Multiplayer remembers their
//    last-sent values (per client) and sends them to new clients on connect.
//    Examples: mouse cursor position, selection.
message ClientBroadcast {
  // Describes which session this is from. The sessionID in Message is not sufficient
  // for this because, as an optimization, the multiplayer server collates broadcasts
  // from various sessions and sends them to clients as a single message.
  uint sessionID = 1;

  // Exactly one member of ClientBroadcast should be non-null at a given time.
  // If you're adding a new kind of broadcast, implement a message that
  // describes your broadcast and then add it as a member to ClientBroadcast.
  CursorReaction cursorReaction = 2;
  TimerInfo timer = 3;
  PresenterInfo presenter = 4;
  PresenterInfo prototypePresenter = 5;
  MusicInfo music = 6;
}

message Message {
  // NEXT ID: 33

  MessageType type = 1;
  uint sessionID = 2;
  uint ackID = 3;
  NodeChange[] nodeChanges = 4;
  UserChange[] userChanges = 5;
  InteractiveSlideElementChange interactiveSlideElementChange = 32;

  // All large arrays of bytes are pulled up to the top level and deduplicated to save space.
  // These blobs are referenced by index. blobBaseIndex determines how blob indices are resolved.
  // See the comment below for more details.
  Blob[] blobs = 6;

  // The value of this field controls how blob references inside this message should be resolved.
  // Specifically, blobs in this message are given indices starting with the number stored in this
  // field. Thus, if the value of this field is 0, all blob references this message refer to blobs
  // contained within the same message. But if the value of this field is non-zero, blob references
  // in this message may refer to blobs transmitted in an earlier message which the client is expected
  // to retain. For more information see:
  // https://paper.dropbox.com/doc/Chunked-File-Loads-Blobs-Handling--Bt509lHm1xl_rJZ9TFjQqZ7vAQ-7P7VnuIZ410PhfxEsJpXu
  uint blobBaseIndex = 30;

  string signalName = 7;
  Access access = 8;
  string styleSetName = 9;
  StyleSetType styleSetType = 10;
  StyleSetContentType styleSetContentType = 11;

  // This is used to support pasting with an offset from the original copied location if both the copy and paste are within the same document
  int pasteID = 12;
  Vector pasteOffset = 13;
  string pasteFileKey = 14; // designate whether paste came from same file or not, shallow vs. deep copy (eventually shared asset ref)

  // This was added so that signals can contain debugging information. In
  // practice it is used to send arbitrary data along with signals.
  string signalPayload = 15;
  SceneGraphQuery[] sceneGraphQueries = 16;

  // Deprecated.
  NodeChangesMetadata nodeChangesMetadata = 17 [deprecated];

  // Sent in JOIN_START messages. See https://www.notion.so/figma/The-fig-file-format-95aea405c2334eb0b753ca5524a12616
  uint fileVersion = 18;

  // This is used to further support pasting for copy/paste V4.
  bool pasteIsPartiallyOutsideEnclosingFrame = 19;
  GUID pastePageId = 20;

  // This is used to support pasting cut components as main components when
  // pasting into a different file.
  bool isCut = 21;

  // This is used to migrate the user's local undo/redo buffer at the same time
  // as the user's local pending changes. Each \`Message\` contains a single batch
  // of \`NodeChange\`s.
  Message[] localUndoStack = 22;
  Message[] localRedoStack = 23;

  // Used when this is a CLIENT_BROADCAST message
  ClientBroadcast[] broadcasts = 24;

  // The sequence number of the file is stored by clients and is sent up to the
  // server to determine if their local file is up-to-date and can use the fast
  // reconnect path.
  uint reconnectSequenceNumber = 25;

  // If a client copies (or cuts) from a branch, we populate this so that the
  // pasting client knows the source file for that branch. This is mainly needed
  // to compute component keys correctly when symbols are cloned from branch files.
  string pasteBranchSourceFileKey = 26;

  // The editor type of the file the client copies from
  EditorType pasteEditorType = 27;

  // Included in NODE_CHANGES messages sent from the client to multiplayer to
  // indicate actions to be taken after applying the changes in the message.
  // Currently used when merging a branch.
  string postSyncActions = 28;

  // Populated on the clipboard PasteData with the guids of cut assets that have been
  // published. Used to determine when to populate LibraryMoveInfo for an asset on paste.
  GUID[] publishedAssetGuids = 29;

  // Indicates that all \`nodeChanges\` contained in the message were generated
  // automatically on file load (fullscreen does this in various cases, like generating
  // derived data or geometry) and not in response to a user's explicit action.
  bool dirtyFromInitialLoad = 31;
}


// Uses the word "DiffChunk" instead of "MergeChunk" to indicate that it's
// appropriate to use for features beyond merging (e.g. version history).
// A good high-level explanation:
// https://paper.dropbox.com/doc/Sub-Spec-M2.5-Visualization--Bh3xREZiEPBaTpCWYMk4Pqv7Ag-PZ7rFvdL0QLRvSVECLuFK
message DiffChunk {

  // References DiffPayload.nodeChanges with indices (as opposed to GUIDs)
  // so that we have the future option of multiple changes per node GUID.
  // (e.g. if we wanted to separate each property change).
  uint[] nodeChanges = 1;

  NodePhase phase = 2 [deprecated];

  // Includes a complete copy of NodeChange for the display node to
  // separate the concern of identifying the display node vs selecting
  // which properties are necessary for display. This avoids updating
  // the schema for display-specific changes. (e.g. if a new property
  // type becomes necessary to select the correct icon) This means storing
  // more properties than may ultimately get used, but we\u2019re okay with
  // that trade-off to avoid error-prone maintenance.
  NodeChange displayNode = 3;

  // Containing canvas
  // Inlined because these properties are very unlikely to change and
  // small enough that duplication is not concerning.
  // The fields canvasId, canvasName, canvasIsInternal should be deprecated
  // but are still being used in web.
  GUID canvasId = 4;
  string canvasName = 5;
  bool canvasIsInternal = 6;

  // If present, this chunk is "affected by/downstream of" the referenced chunks
  // Using back-references here avoids duplicating "downstream" chunks,
  // and matches the direction of the underlying node dependencies.
  // Using array indexes instead of GUIDS allows for the unlikely future
  // possibilities of more than one chunk with the same display node but
  // different changes, or a chunk with multiple display nodes.
  // NOTE: Variants are a special case of dependency, eg:
  // isVariant(c) => c.isState && c.chunksAffectingThisChunk().filter(dc => dc.isStateGroup)
  uint[] chunksAffectingThisChunk = 7;

  // basisParentHierarchy is the hierarchy from the 'from' of the diff, and
  // parentHierarchy is the hierarchy from the 'to' of the diff.

  // Parent hierarchy is a bottom-ups array of parents that qualify as a chunk.
  // For example, if we have a variant in a state group in the internal canvas,
  // then that variant's parent hierarchy would be:
  // [<StateGroup NodeChanges>, <InternalCanvas NodeChanges>].
  // This information is used for a variety of purposes like doing special
  // grouping for removed nodes, grouping variants into their state groups,
  // and for determining information about that chunk's containing canvas.
  // NOTE: these fields should be deprecated once basisParentHierarchyGuids
  // and parentHierarchyGuids are rolled out.
  NodeChange[] basisParentHierarchy = 8;
  NodeChange[] parentHierarchy = 9;

  // basisParentHierarchyGuids is the hierarchy from the 'from' of the diff, and
  // parentHierarchyGuids is the hierarchy from the 'to' of the diff.

  // Parent hierarchy is a bottom-ups array of GUIDs corresponding to parent node changes that qualify as a chunk.
  // For example, if we have a variant in a state group in the internal canvas,
  // then that variant's parent hierarchy would be:
  // [<StateGroup NodeChange GUID>, <InternalCanvas NodeChange GUID>].
  // This information is used for a variety of purposes like doing special
  // grouping for removed nodes, grouping variants into their state groups,
  // and for determining information about that chunk's containing canvas.
  // The GUIDs reference to NodeChanges in the DiffPayload's basisParentNodeChanges and parentNodeChanges fields
  GUID[] basisParentHierarchyGuids = 10;
  GUID[] parentHierarchyGuids = 11;
}

message DiffPayload {
  // A list of changes for each node. Each NodeChange is guaranteed to have GUID
  // and at least one property.
  NodeChange[] nodeChanges = 1;

  // For fields that have potentially large and repetitive binary data,
  // we store references to external blob data. This allows de-duplication.
  // Blob data is serialized as a separate top-level array.
  Blob[] blobs = 2;

  // Metadata that groups every nodeChange from above into related changes based
  // on a heuristic. See rust/fig-diff/src/chunks.rs for the implementation.
  DiffChunk[] diffChunks = 3;

  // One for every item in nodeChanges above.
  NodeChange[] diffBasis = 4;

  // Distinct node changes corresponding to the superset of GUIDs from every DiffChunk's basisParentHierarchyGuids.
  NodeChange[] basisParentNodeChanges = 5;

  // Distinct node changes corresponding to the superset of GUIDs from every DiffChunk's parentHierarchyGuids.
  NodeChange[] parentNodeChanges = 6;
}

enum RichMediaType {
  // GIF1
  ANIMATED_IMAGE = 0;
  // Video
  VIDEO = 1;
}

message RichMediaData {
  string mediaHash = 1;
  RichMediaType richMediaType = 2;
}

// Each variable can be only one specific type.
// This informs what type this variable holds.
enum VariableDataType {
  BOOLEAN = 0;
  FLOAT = 1;
  STRING = 2;
  ALIAS = 3;
  COLOR = 4;
  EXPRESSION = 5;
  MAP = 6;
  SYMBOL_ID = 7;
  FONT_STYLE = 8;
}

// The resolved type of the variable.
// This is used to determine which variables can
// be bound to what field.
// KEEP_IN_SYNC(sinatra/lib/models/variable.rb)
enum VariableResolvedDataType {
  BOOLEAN = 0;
  FLOAT = 1;
  STRING = 2;
  COLOR = 4;
  MAP = 5;
  SYMBOL_ID = 6;
}

// This holds the value of a variable. Since we don't support Any we can use
// VariableAnyValue with one and only one of the fields populated.
message VariableAnyValue {
  bool boolValue = 1;
  string textValue = 2;
  float floatValue = 3;
  VariableID alias = 4;
  Color colorValue = 5;
  Expression expressionValue = 6;
  VariableMap mapValue = 7;
  SymbolId symbolIdValue = 8;
  VariableFontStyle fontStyleValue = 9;
}

// This holds either a VariableID or a VariableOverrideId, since kiwi doesn't
// support union types, only one of these values should ever be populated.
message VariableIdOrVariableOverrideId {
  VariableID variableId = 1;
  VariableOverrideId variableOverrideId = 2;
}

enum ExpressionFunction {
  ADDITION = 0;
  SUBTRACTION = 1;
  RESOLVE_VARIANT = 2;
  MULTIPLY = 3;
  DIVIDE = 4;
  EQUALS = 5;
  NOT_EQUAL = 6;
  LESS_THAN = 7;
  LESS_THAN_OR_EQUAL = 8;
  GREATER_THAN = 9;
  GREATER_THAN_OR_EQUAL = 10;
  AND = 11;
  OR = 12;
  NOT = 13;
  STRINGIFY = 14;
  TERNARY = 15;
  VAR_MODE_LOOKUP = 16;
}

message Expression {
  ExpressionFunction expressionFunction = 1;
  VariableData[] expressionArguments = 2;
}

// Most expressions will use a simple VariableData[] of args,
// but some functions like RESOLVE_VARIANT need it stored as a map
message VariableMapValue {
  string key = 1;
  VariableData value = 2;
}

message VariableMap {
  VariableMapValue[] values = 1;
}

message VariableFontStyle {
  VariableData asString = 1;
  VariableData asFloat = 2;
}

message VariableData {
  VariableAnyValue value = 1;
  VariableDataType dataType = 2;
  VariableResolvedDataType resolvedDataType = 3;
}

message VariableSetMode {
  GUID id = 1;
  string name = 2;
  string sortPosition = 3;
}

message VariableDataValues {
  VariableDataValuesEntry[] entries = 1;
}

message VariableDataValuesEntry {
  GUID modeID = 1;
  VariableData variableData = 2;
}

// KEEP_IN_SYNC(sinatra/lib/models/variable.rb)
// KEEP_IN_SYNC(plugin-docs/docs/api/api.ts:VariableScope)
enum VariableScope {
  // A special value that means that this variable will be shown
  // in all available scopes (including future ones)
  ALL_SCOPES = 0;

  // Currently only used by number variables, but will eventually
  // be shared by multiple variable types
  TEXT_CONTENT = 1;

  // Used by number variables
  CORNER_RADIUS = 2;
  WIDTH_HEIGHT = 3;
  GAP = 4;

  // Used by color variables
  // A special value that means that this variable will be shown
  // in all available fill scopes (including future ones)
  ALL_FILLS = 5;
  FRAME_FILL = 6;
  SHAPE_FILL = 7;
  TEXT_FILL = 8;
  STROKE = 9; // May by used by number variables in the future
}

enum CodeSyntaxPlatform {
  WEB = 0;
  ANDROID = 1;
  iOS = 2;
  // more options for code syntax platforms may be added in the future
}

message OptionalVector {
  Vector value = 1;
}

enum HTMLTag {
  // Use heuristics to determine the HTML tag.
  AUTO = 0;
  // Sectioning content https://html.spec.whatwg.org/dev/sections.html#sections
  ARTICLE = 1;
  SECTION = 2;
  NAV = 3;
  ASIDE = 4;
  H1 = 5;
  H2 = 6;
  H3 = 7;
  H4 = 8;
  H5 = 9;
  H6 = 10;
  HGROUP = 11;
  HEADER = 12;
  FOOTER = 13;
  ADDRESS = 14;
  // Grouping content https://html.spec.whatwg.org/dev/grouping-content.html
  P = 15;
  HR = 16;
  PRE = 17;
  BLOCKQUOTE = 18;
  OL = 19;
  UL = 20;
  MENU = 21;
  LI = 22;
  DL = 23;
  DT = 24;
  DD = 25;
  FIGURE = 26;
  FIGCAPTION = 27;
  MAIN = 28;
  DIV = 29;
  // Text-level semantics https://html.spec.whatwg.org/dev/text-level-semantics.html
  A = 30;
  EM = 31;
  STRONG = 32;
  SMALL = 33;
  S = 34;
  CITE = 35;
  Q = 36;
  DFN = 37;
  ABBR = 38;
  RUBY = 39;
  RT = 40;
  RP = 41;
  DATA = 42;
  TIME = 43;
  CODE = 44;
  VAR = 45;
  SAMP = 46;
  KBD = 47;
  SUB = 48;
  SUP = 49;
  I = 50;
  B = 51;
  U = 52;
  MARK = 53;
  BDI = 54;
  BDO = 55;
  SPAN = 56;
  BR = 57;
  WBR = 58;
  // Images https://html.spec.whatwg.org/dev/embedded-content.html
  PICTURE = 59;
  SOURCE = 60;
  IMG = 61;
  // Forms and inputs https://html.spec.whatwg.org/dev/forms.html
  FORM = 62;
  LABEL = 63;
  INPUT = 64;
  BUTTON = 65;
  SELECT = 66;
  DATALIST = 67;
  OPTGROUP = 68;
  OPTION = 69;
  TEXTAREA = 70;
  OUTPUT = 71;
  PROGRESS = 72;
  METER = 73;
  FIELDSET = 74;
  LEGEND = 75;
}

enum ARIARole {
  // This enum is quite messy. It has gone through a few iterations and
  // some values got deprecated and then brought back and some other abstracted
  // roles got added and then deprecated

  AUTO = 0; // Use heuristics to determine the role.
  NONE = 52;

  // Landmark roles
  APPLICATION = 30;
  BANNER = 67;
  COMPLEMENTARY = 68;
  CONTENTINFO = 69;
  FORM = 70;
  MAIN = 71;
  NAVIGATION = 72;
  REGION = 73;
  SEARCH = 74;

	// Document roles
  SEPARATOR = 13;
  ARTICLE = 31;
  COLUMNHEADER = 35;
  DEFINITION = 36;
  DIRECTORY = 38;
  DOCUMENT = 39;
  GROUP = 44;
  HEADING = 45;
  IMG = 46;
  LIST = 48;
  LISTITEM = 49;
  MATH = 50;
  NOTE = 53;
  PRESENTATION = 55;
  ROW = 56;
  ROWGROUP = 57;
  ROWHEADER = 58;
  TABLE = 62;
  TOOLBAR = 65;


	// Widget roles
  BUTTON = 1;
  CHECKBOX = 2;
  GRIDCELL = 3;
  LINK = 4;
  MENUITEM = 5;
  MENUITEMCHECKBOX = 6;
  MENUITEMRADIO = 7;
  OPTION = 8;
  PROGRESSBAR = 9;
  RADIO = 10;
  SCROLLBAR = 11;
  SLIDER = 14;
  SPINBUTTON = 15;
  TAB = 17;
  TABPANEL = 18;
  TEXTBOX = 19;
  TREEITEM = 20;
  COMBOBOX = 21;
  GRID = 22;
  LISTBOX = 23;
  MENU = 24;
  MENUBAR = 25;
  RADIOGROUP = 26;
  TABLIST = 27;
  TREE = 28;
  TREEGRID = 29;
  TOOLTIP = 66;
  ALERT = 75;
  LOG = 76;
  MARQUEE = 77;
  STATUS = 78;
  TIMER = 79;
  ALERTDIALOG = 80;
  DIALOG = 81;


  //========================================
	// These values are deprecated. DO NOT USE.
  // They only remain here for backwards compatibility
  SEARCHBOX = 12; // Deprecated
  SWITCH = 16; // Deprecated
  BLOCKQUOTE = 32; // Deprecated
  CAPTION = 33; // Deprecated
  CELL = 34; // Deprecated
  DELETION = 37; // Deprecated
  EMPHASIS = 40; // Deprecated
  FEED = 41; // Deprecated
  FIGURE = 42; // Deprecated
  GENERIC = 43; // Deprecated
  INSERTION = 47; // Deprecated
  METER = 51; // Deprecated
  PARAGRAPH = 54; // Deprecated
  STRONG = 59; // Deprecated
  SUBSCRIPT = 60; // Deprecated
  SUPERSCRIPT = 61; // Deprecated
  TERM = 63; // Deprecated
  TIME = 64; // Deprecated
  IMAGE = 82; // Deprecated
  HEADING_1 = 83; // Deprecated
  HEADING_2 = 84; // Deprecated
  HEADING_3 = 85; // Deprecated
  HEADING_4 = 86; // Deprecated
  HEADING_5 = 87; // Deprecated
  HEADING_6 = 88; // Deprecated
  HEADER = 89; // Deprecated
  FOOTER = 90; // Deprecated
  SIDEBAR = 91; // Deprecated
  SECTION = 92; // Deprecated
  MAINCONTENT = 93; // Deprecated
  TABLE_CELL = 94; // Deprecated
  WIDGET = 95; // Deprecated
}


message MigrationStatus {
  bool dsdCleanup = 1;
}

message NodeFieldMap {
  NodeFieldMapEntry[] entries = 1;
}

message NodeFieldMapEntry {
  GUID guid = 1;
  uint field = 2;
  uint lastModifiedSequenceNumber = 3;
}

enum ColorProfile {
  SRGB = 0;
  DISPLAY_P3 = 1;
}

// This is only meant to be used on the root DOCUMENT node
enum DocumentColorProfile {
  // In Figma Design, all files that were created before color management was released are considered "legacy"
  // In FigmJam, all files are considered "legacy"
  LEGACY = 0;
  SRGB = 1;
  DISPLAY_P3 = 2;
}

enum ChildReadingDirection {
  NONE = 0;
  LEFT_TO_RIGHT = 1;
  RIGHT_TO_LEFT = 2;
}

// This holds the value of an aria attribute. Since we don't support Any we can use
// ARIAAttributeAnyValue with one and only one of the fields populated.
message ARIAAttributeAnyValue {
  bool boolValue = 1;
  string stringValue = 2;
  float floatValue = 3;
  int intValue = 4;
  string[] stringArrayValue = 5;
}
// Each variable can be only one specific type.
// This informs what type this variable holds.
enum ARIAAttributeDataType {
  BOOLEAN = 0;
  STRING = 1;
  FLOAT = 2;
  INT = 3;
  STRING_LIST = 4;
}
message ARIAAttributeData {
  ARIAAttributeDataType type = 1;
  ARIAAttributeAnyValue value = 2;
}

message ARIAAttributesMap {
  ARIAAttributesMapEntry[] entries = 1;
}

message ARIAAttributesMapEntry {
  string attribute = 1; // There are too many aria attributes to enumerate them all here
  ARIAAttributeData value = 2;
}

message HandoffStatusMapEntry {
  GUID guid = 1;
  SectionStatusInfo handoffStatus = 2;
}

message HandoffStatusMap {
  HandoffStatusMapEntry[] entries = 1;
}

// All the edit scope stacks that apply to the fields in a NodeChange.
message EditScopeInfo {
  EditScopeStack[] editScopeStacks = 1;
}

// The stack of edit scopes for a single field change.
message EditScopeStack {
  EditScope[] stack = 1;
}

// The tuple of a given edit scope. A change can exist under one or more of these scopes.
message EditScope {
  EditScopeType type = 1;
  string label = 2;
}

// KEEP_IN_SYNC(fullscreen/lib/scenegraph/FGEditScopeData.h)
enum EditScopeType {
  INVALID = 0;
  TEST_SETUP = 1;
  USER = 2;
  PLUGIN = 3;
  SYSTEM = 4;
  REST_API = 5;
}

// The selected preset information for a section node.
message SectionPresetInfo {
  uint64 shelfId = 1;
  uint64 templateId = 2;
  string templateName = 3;
}

///////////////////////////////////////////////////////////////
// Deprecated
// !!! EVERYTHING BELOW THIS SECTION IS DEPRECATED !!!
//
// Because we cannot remove certain type for backwards
// compatibility and checkpointing, we need to keep the definitions
// around. To avoid cluster and to prevent accidental reuse
// we'll move the deprecated types below this section
////////////////////////////////////////////////////////////////
`))}),this.app=this.viewer.app,this.app.window().dangerouslyDisableOnFrameCallbackForTesting(),this.testMode==0)this.resize(600,600),this.readFile(s,0).then(c=>{this.commandQueue=JSON.parse(c.text).commands,this._mockTime=new Ta,Qe.dangerouslyPushMockTime(this._mockTime),this.runNextCommand()});else{this.app.canvasView().dangerouslyAccessProtoRenderManager().internalInitPerfTracking(),this.resizeToFit();let c=30;this.readFile(s,0).then(p=>{let u=JSON.parse(p.text).commands,h=u.tests,f=u.outFile;for(let m=0,A=h.length;m<A;m=m+1){let y=h[m];for(let S=0;S<c;S=S+1)for(let g=0,b=y.length;g<b;g=g+1){let T=y[g];this.commandQueue.push(T)}}let _=new Map([["runCount",c],["deviceMode",a[2]],["flags",Array.from(d.keys()).join(" ")]]);this.writePerformanceResultsWhenFinished(f,_),this.runNextCommand()})}})}constructor(){this.secret=null,this.app=null,this.viewer=null,this.basePath="",this.commandQueue=[],this.container=null,this._mockTime=null,this.testMode=0,this.figFileName="",this.initializePrototypeLib=null,this.bowser=null}};Qi._instance=null;var Df=Qi,II;(e=>{function i(t){return vI[t]}e.TestMode_toString=i})(II||(II={}));var Ki=!1;var Kp=class{clear(){this._images=[],this._imageByHash=new Map}allImages(){return this._images}appendIfMissing(e){this._imageByHash.has(e.objectHash())||(this._imageByHash.set(e.objectHash(),e),this._images.push(e))}count(){return this._images.length}isEmpty(){return this.count()==0}takeFirst(){let e=this._images.shift();return this._imageByHash.delete(e.objectHash()),e}constructor(){this._images=[],this._imageByHash=new Map}},wI=(t=>(t[t.ON_SCREEN=0]="ON_SCREEN",t[t.PRERENDERING=1]="PRERENDERING",t))(wI||{}),Mf=(t=>(t[t.IS_EMOJI=0]="IS_EMOJI",t[t.IS_NOT_EMOJI=1]="IS_NOT_EMOJI",t))(Mf||{}),qp=class{constructor(e,t,n,r){this._loadType=null,this._delaySeconds=0,this._startCondition=null,this._endCondition=null,this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0,this._numGIFs=0,this._loadType=e,this._delaySeconds=t,this._startCondition=n,this._endCondition=r}reset(){this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0}_hasMetStartCondition(){return this._startConditionSeconds>=0}_hasMetEndCondition(){return this._endConditionSeconds>=0}onFrame(){!this._hasMetStartCondition()&&this._startCondition()&&(this._startConditionSeconds=Qe.seconds()),this._hasMetStartCondition()&&!this._hasMetEndCondition()&&this._endCondition()&&(this._endConditionSeconds=Qe.seconds()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&Qe.seconds()-this._endConditionSeconds>=this._delaySeconds&&(this.trackEvent(),this.reset()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&!this._endCondition()&&(this._endConditionSeconds=-1)}trackSuccess(e){this._hasMetStartCondition()&&(this._numSuccesses=this._numSuccesses+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackFailure(e){this._hasMetStartCondition()&&(this._numFailures=this._numFailures+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackEvent(){Be.trackEvent2("images_loaded",new Map([["viewer_mode",X.getViewerMode()],["load_type",this._loadType],["num_successes",this._numSuccesses],["num_failures",this._numFailures],["num_gifs",this._numGIFs],["duration_s",this._endConditionSeconds-this._startConditionSeconds],["fast_image_decode",jn.browserSupportsFastImageDecoding()]]),new Map([["forwardToDatadog",!0]]))}};var Yp=class i{delayBetweenInvalidations(){return kr||Ki?0:2}constructor(e,t){this._scene=null,this._appState=null,this._prototypeStructure=null,this._previousFileKey="",this._imageResources=new Map,this._emojiResources=new Map,this._imageUseTracker=null,this.MAX_SIMULTANEOUS_PRELOADING=4,this._imageQueue=new Hp,this._outboundRequestPriorities=new Map,this._thumbLoadTracker=null,this._fullsizeImageLoadTracker=null,this._requestsInFlight=0,this._needsUpdate=!1,this._needAllThumbnails=!0,this._newlyLoadedImages=new Kp,this._topLevelGuidsNeeded=new Cr,this.onImageLoaded=null,this.lastImageLoadedCallbackTime=0,this._pendingRequestSuccessForImage=new Map,this._pendingRequestFailureForImage=new Map,this._shouldInvestigateNextImageFailure=!0,this._showImageFetchFailureUI=null,Zr()!==null&&!Zr().getImageMemoryStats&&(Zr().getImageMemoryStats=()=>{let r=Mn.getMax("WEBGL_TEXTURE (Image)"),o=Mn.getMax("Decoded image data in RAM (MB)");return{vramMaxForImages:r,ramMaxForImages:o}},Zr().getNumRequestsInFlight=()=>this._requestsInFlight),this._imageUseTracker=new fd(e),this._appState=e,this._prototypeStructure=e.prototypeStructure(),this._showImageFetchFailureUI=t,e.addAppObserver(this),e.addFrameObserver(this),e.prototypeState().addObserver(this);let n=2==0?0:2.5;this._thumbLoadTracker=new qp("thumbs_loaded",n,()=>this._computeTopImagePriority().type==4,()=>this._computeTopImagePriority().type<4),this._fullsizeImageLoadTracker=new qp("fullsize_images_loaded",n,()=>this._computeTopImagePriority().type>=3,()=>this._computeTopImagePriority().type<3)}handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){var t,n;if(Nr.advanceGeneration(),e.oldStateId()==null&&this._onTransitionGraphChange(),this._restartGIFsOnEnteringScreens(e),this.clearUnneededTextures(e),this._needAllThumbnails){let r=(n=(t=this._scene)==null?void 0:t.findNode1(e.newStateId()))==null?void 0:n.canvas();this.preloadAllThumbnails(r)}}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}clearQueuesAndDecodedDataForAllImages(e){this._imageQueue.clear(),this._clearDecodedDataForAllImagesRecursive(e)}_clearDecodedDataForAllImagesRecursive(e){if(e!=null){this.clearDecodedDataForAllImages(e);for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);this._clearDecodedDataForAllImagesRecursive(r)}}}clearDecodedDataForAllImages(e){e.forEachSinglePaint(t=>{if(t.image()==null)return;let n=this._imageUseTracker.nodesUsedByImage(t.image());t.image().freeMemoryForDecodedDataAndTexture()&&n.forEach(r=>{var o;(o=this._scene.findNode1(r))==null||o.invalidateRenderTreeForSelfAndParents()})}),e.forEachSinglePaint(t=>{if(t.imageThumbnail()==null)return;let n=this._imageUseTracker.nodesUsedByImage(t.imageThumbnail());t.imageThumbnail().freeMemoryForDecodedDataAndTexture()&&n.forEach(r=>{var o;(o=this._scene.findNode1(r))==null||o.invalidateRenderTreeForSelfAndParents()})}),e.forEachEmojiInTextData(t=>{let n=this._imageUseTracker.nodesUsedByImage(t);t.freeMemoryForDecodedDataAndTexture()&&n.forEach(r=>{var o;(o=this._scene.findNode1(r))==null||o.invalidateRenderTreeForSelfAndParents()})})}clearQueuesAndDecodedDataForFullResolutionImages(e){this._imageQueue.clear();let t=this._appState.currentFileKey();e!=null&&this._previousFileKey!=null&&this._previousFileKey.length>1&&t!=this._previousFileKey&&this._clearDecodedDataForFullResolutionImagesRecursive(e),this._previousFileKey=t}_clearDecodedDataForFullResolutionImagesRecursive(e){if(e!=null){this.clearDecodedDataForFullResolutionImages(e);for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);this._clearDecodedDataForFullResolutionImagesRecursive(r)}}}clearDecodedDataForFullResolutionImages(e){e.forEachSinglePaint(t=>{var r;if(t.image()==null)return;let n=this._imageUseTracker.nodesUsedByImage(t.image());if(!(t.imageThumbnail()!=null&&t.image().objectHash()==t.imageThumbnail().objectHash())){for(let o of n){let a=(r=this._scene.findNode1(o))==null?void 0:r.topLevelAncestor();if(a!=null&&this._topLevelGuidsNeeded._in(a.id()))return}t.image().freeMemoryForDecodedDataAndTexture()&&n.forEach(o=>{var a;(a=this._scene.findNode1(o))==null||a.invalidateRenderTreeForSelfAndParents()})}}),e.forEachEmojiInTextData(t=>{var r;let n=this._imageUseTracker.nodesUsedByImage(t);for(let o of n){let a=(r=this._scene.findNode1(o))==null?void 0:r.topLevelAncestor();if(a!=null&&this._topLevelGuidsNeeded._in(a.id()))return}t.freeMemoryForDecodedDataAndTexture()&&n.forEach(o=>{var a;(a=this._scene.findNode1(o))==null||a.invalidateRenderTreeForSelfAndParents()})})}_restartGIFsOnEnteringScreens(e){var r;if(e.newStateId()!=null&&e.newStateId()!=e.oldStateId()){let o=(r=this._scene)==null?void 0:r.findNode1(e.newStateId());o!=null&&this._restartGIFsInSubtree(o)}let t=e.newOverlayData(),n=e.oldOverlayData();for(let o=0,a=t.length;o<a;o=o+1)if(o>=n.length||n[o].id!=t[o].id){let s=this._scene.findNode1(t[o].id);s!=null&&this._restartGIFsInSubtree(s)}}_restartGIFsInSubtree(e){e.restartGifs(),e.forEachChild(t=>{this._restartGIFsInSubtree(t)})}clearUnneededTextures(e){if(this._scene!=null&&this._appState.baseScreenId()!=null){this._topLevelGuidsNeeded=new Cr,this._prototypeStructure.getPrerenderingJobs(null).forEach(t=>{let n=t.asScreen();n!=null&&this._topLevelGuidsNeeded.add(n.nodeId)}),e.oldStateId()!=null&&this._topLevelGuidsNeeded.add(e.oldStateId()),e.newStateId()!=null&&this._topLevelGuidsNeeded.add(e.newStateId());for(let t of this._imageUseTracker.nodesThatUseAnImage()){let n=this._scene.findNode1(ne.fromString(t));if(n==null)continue;let r=n.topLevelAncestor();r!=null&&this._topLevelGuidsNeeded._in(r.id())||this.clearDecodedDataForFullResolutionImages(n)}}}handleSceneChange(e,t){e!=null&&this.clearQueuesAndDecodedDataForFullResolutionImages(e.root()),this._scene=t,this._needAllThumbnails=!0,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._onTransitionGraphChange()}preloadAllThumbnails(e){this._scene==null||e==null||(Le.StringMap_each(i.getThumbnailsInSubtree(e),(t,n)=>{this._imageQueue.insertOrUpdate(n,Nr.OTHER)}),this._needAllThumbnails=!1)}handleActiveCanvasChange(e,t){this.clearQueuesAndDecodedDataForFullResolutionImages(e),this.preloadAllThumbnails(t)}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){(e.property==71||e.property==69||e.property==25)&&this._onTransitionGraphChange()}resetForRenderingTests(){this._imageQueue.clear(),this._newlyLoadedImages.clear(),this.lastImageLoadedCallbackTime=0}onFrame(){this._needsUpdate&&this._traverseSceneForImages(),!this._newlyLoadedImages.isEmpty()&&Qe.seconds()-this.lastImageLoadedCallbackTime>=this.delayBetweenInvalidations()&&(this.lastImageLoadedCallbackTime=Qe.seconds(),this._onImagesLoaded()),this._thumbLoadTracker.onFrame(),this._fullsizeImageLoadTracker.onFrame(),this._needsUpdate=!1}_computeTopImagePriority(){let e=Nr.OTHER;this._imageQueue.count()>0&&(e=Nr.max(e,this._imageQueue.maxPriority().value));for(let t of Array.from(this._outboundRequestPriorities.values()))e=Nr.max(e,t);return e}findImageByHexHash(e,t){return t==0?Le.StringMap_get(this._emojiResources,e,null):Le.StringMap_get(this._imageResources,e,null)}onNewImage(e,t,n){let r=t==0?this._emojiResources:this._imageResources;r.has(e)||(r.set(e,n),this._appState.baseScreenId()==null)||(this._imageQueue.insertOrUpdate(n,Nr.OTHER),this._processNextItemFromRenderQueues())}requestImageForRendering(e,t){this._imageQueue.insertOrUpdate(e,t),this._processNextItemFromRenderQueues()}_onImagesLoaded(){if(this.onImageLoaded!=null){if(this._scene!=null)for(let e=0,t=this._newlyLoadedImages.allImages().length;e<t;e=e+1){let n=this._newlyLoadedImages.allImages()[e];for(let r of this._imageUseTracker.nodesUsedByImage(n)){let o=this._scene.findNode1(r);o!=null&&this.onImageLoaded(o)}}this._newlyLoadedImages.clear()}}_onTransitionGraphChange(){this._needsUpdate=!0}_traverseSceneForImages(){let e=this._appState.baseScreenId();this._scene!=null&&e!=null&&this._processNextItemFromRenderQueues()}postMessageToPerfTests(e){Zr().figmaPerfTesting&&Zr().postMessage({name:e,value:0},"*")}incrementRequestsInFlight(e){this._requestsInFlight=this._requestsInFlight+e,Mn.trackInReleaseBuilds("Image requests in flight",this._requestsInFlight),this._requestsInFlight==0&&this.postMessageToPerfTests("IMAGES_FINISHED_LOADING")}_requestImage(e,t,n,r){this._pendingRequestSuccessForImage.has(e.objectHash())||this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestSuccessForImage.get(e.objectHash()).push(n),this._pendingRequestFailureForImage.has(e.objectHash())||this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.get(e.objectHash()).push(r),e!=null&&e.state()==1&&this._processNextItemFromRenderQueues(),this._outboundRequestPriorities.set(e.objectHash(),Nr.max(t,Le.StringMap_get(this._outboundRequestPriorities,e.objectHash(),Nr.OTHER))),this.incrementRequestsInFlight(1),e.fetchAndDecode(1,o=>{this._thumbLoadTracker.trackSuccess(e.imageType()),this._fullsizeImageLoadTracker.trackSuccess(e.imageType()),this.incrementRequestsInFlight(-1),this._newlyLoadedImages.appendIfMissing(e);for(let a of this._pendingRequestSuccessForImage.get(e.objectHash()))a(o);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash()),this._processNextItemFromRenderQueues()},o=>{if((Wa.ImagePriorityType_isOnScreen(t.type)||Wa.ImagePriorityType_isPrerender(t.type))&&o==0&&this._shouldInvestigateNextImageFailure){this._shouldInvestigateNextImageFailure=!1;let s=l=>{l==0?(this._showImageFetchFailureUI(),Be.trackEvent1("show_image_failure_ui",new Map([["imagePriority",Vl[t.type]]]))):this._shouldInvestigateNextImageFailure=!0};new Ur(e.url()).get().then(l=>{s(l.status)},l=>{s(l.status)})}this._thumbLoadTracker.trackFailure(e.imageType()),this._fullsizeImageLoadTracker.trackFailure(e.imageType()),this.incrementRequestsInFlight(-1),this._processNextItemFromRenderQueues();for(let s of this._pendingRequestFailureForImage.get(e.objectHash()))s(t);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash())})}_processNextItemFromRenderQueues(){if(this._requestsInFlight>=this.MAX_SIMULTANEOUS_PRELOADING||this._imageQueue.count()==0)return;let e=this._imageQueue.peek(),t=this._imageQueue.getPriority(e);this._imageQueue.remove(e),this._requestImage(e,t.value,n=>{},n=>{if(n.type==2||n.type==4)for(let o of this._imageUseTracker.nodesUsedByImage(e)){let a=this._scene.findNode1(o);a!=null&&a.forEachSinglePaint(s=>{let l=s.imageThumbnail()!=null&&s.imageThumbnail().objectHash()==e.objectHash(),d=s.imageThumbnail()!=null&&s.image()!=null&&s.image().objectHash()==s.imageThumbnail().objectHash();if(l&&!d&&s.image()!=null){let c=e!=null?e.objectHash():null,p=s.image()!=null?s.image().objectHash():null;console.warn(`Failed to fetch thumbnail ${c}; fetching full size image ${p}`);let u=n.type==2?Nr.forType(1):n.type==4?Nr.forType(3):Nr.OTHER;this.requestImageForRendering(s.image(),u)}})}})}hasPendingImages(){return this._needsUpdate||this._requestsInFlight>0||Wa.ImagePriorityType_isOnScreen(this._computeTopImagePriority().type)||!this._newlyLoadedImages.isEmpty()}static getThumbnailsInSubtree(e){let t=new Map,n=new Map;return i._getImagesInSubtree(e,t,n),n}static _getImagesInSubtree(e,t,n){e.forEachSinglePaint(r=>{r.image()!=null&&t.set(r.image().objectHash(),r.image()),r.imageThumbnail()!=null&&n.set(r.imageThumbnail().objectHash(),r.imageThumbnail())}),e.forEachEmojiInTextData(r=>{n.set(r.objectHash(),r)});for(let r=0,o=e.childCount();r<o;r=r+1){let a=e.childAt1(r);i._getImagesInSubtree(a,t,n)}}},EI;(e=>{function i(t){return wI[t]}e.RenderPurpose_toString=i})(EI||(EI={}));var CI;(e=>{function i(t){return Mf[t]}e.IsEmoji_toString=i})(CI||(CI={}));var Xp=class{track(e,t){this._frameRequestInfo.set(e,t)}getMetricsForRequestedNode(e){return this._frameRequestInfo.get(e)}clear(){this._frameRequestInfo.clear()}constructor(){this._frameRequestInfo=new Map}};var Bs=class Bs{static instance(){return Bs._instance==null&&(Bs._instance=new Bs),Bs._instance}requestLibrary(){this.startLibLoad()}onLoadComplete(e){this._videoJsLib=e,this.onSuccess!=null&&this.onSuccess()}hasRequestedLibrary(){return this._requestStarted}isLibAvailable(){return this._videoJsLib!==null}getPlayer(e){return this._videoJsLib===null?(console.warn("VideoJS used before initialized"),null):this._videoJsLib.videoJs(e).player()}constructor(){this._videoJsLib=null,this._requestStarted=!1,this.startLibLoad=null,this.onSuccess=null}};Bs._instance=null;var To=Bs,jp;(e=>{function i(t){let n=document.getElementById(t.id());return(n==null?void 0:n.getElementsByTagName("video"))[0]}e.VideoJsPlayer_getBackingVideo=i})(jp||(jp={}));var Zp=class{hash(){return jn.bytesToHex(this._hash)}getVideoManager(){return this._videoManager}size(e){return this._videoManager.getVideoRuntimeForPaint(e).size()}didLoad(e){let t=this._videoManager.getVideoRuntimeForPaint(e);return t==null?!1:t.isReadyToPlay()}getOrCreateTexture(e,t,n){let r=this._videoManager.getVideoRuntimeForPaint(e);return r==null||r.shouldDisplayThumbnail?null:r.getOrCreateTexture(t,n)}pause(e){let t=this._videoManager.getVideoRuntimeForPaint(e);t!=null&&t.pause()}constructor(e,t){this.id=(NI=NI+1)+-1,this._hash=e,this._videoManager=t,this._loadComplete=!1}},NI=0;var Hl=class Hl{clone(){let e=new Hl(this._hash,this._sourceURL,this._metaMP4Url,this._videoManager);return this._videoManager.enqueueVideoOrStartLoad(e),e}isReadyToPlay(){if(this._player==null||!this._loadComplete||this._isInErrorState)return!1;if(Xe.ios()||this._seeking)return this._player.readyState()>Gl.HAVE_NOTHING;{let e=this._player.currentTime()==this._player.duration()&&this._player.readyState()>=Gl.HAVE_CURRENT_DATA;return this._player.readyState()>=Gl.HAVE_FUTURE_DATA||e}}isInErrorState(){return this._isInErrorState}uninitialize(){this._player!=null&&(this.pause(),this.setMuted(!1),this.resetToStartTime(),this._player.dispose())}toString(){if(this._player==null)return`Runtime(id=${this.id},  <NO VIDEO INFORMATION> )`;let e=this._player.currentTime()|0,t=At.int_remainder(e,60)<10?`0${At.int_remainder(e,60)}`:`${At.int_remainder(e,60)}`,r=`${(e/60|0)<10?`0${e/60|0}`:`${e/60|0}`}:${t}`;return this._isInErrorState?`Runtime(id=${this.id}, <LOADING ERROR>)`:`Runtime(id=${this.id}, time=${r}, ready=${this.isReadyToPlay()}, P=${!this._player.paused()}, M=${this._player.muted()}, L=${this._loop})`}_setMuted(e,t){if(this._player!=null){Xe.ios()&&!e&&this._videoManager.muteAllOtherVideos(this);try{this._player.muted(e),t&&(this.overriddenMutedState=new Se(e))}catch{Be.trackEvent1("video_mute_failure",new Map([["errorState",this._isInErrorState],["loadComplete",this._loadComplete],["fileType",this._fileTypeLoading]]))}}}setMutedByVideoAction(e){this._setMuted(e,!0)}setMuted(e){this._setMuted(e,!1)}muted(){return this._player!=null?this._player.muted():!0}setLoop(e){this._loop=e}size(){return this._player==null?null:new E(this._player.videoWidth(),this._player.videoHeight())}_pause(e){yi.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Pausing"),this._player!=null&&(this._player.pause(),e&&(this.overriddenPlayingState=new Se(!1)))}pauseByVideoAction(){this._pause(!0)}pause(){this._pause(!1)}_play(e,t){yi.VERBOSE_LOGS&&(e?console.log("VideoResource #",this.id,": Loop playback"):console.log("VideoResource #",this.id,": Start playback")),this._player!=null&&this.isReadyToPlay()&&(X.getFeatureFlags().videoOnIOSStaging||(this.shouldDisplayThumbnail=!1),this._player.play().then(n=>{t&&(this.overriddenPlayingState=new Se(!0)),this.reportPlaySuccessAnalytics()},n=>{let r=n.message+"";r.indexOf("The play() request was interrupted")!=-1?this.reportPlayFailureAnalytics(e?`Loop error: ${r}`:r):(console.warn("User has yet to interact with page, starting video muted",n),this.setMuted(!0),this._player.play().then(o=>{},o=>{let a=o.message+"";e&&(a=`Loop error: ${a}`),this.reportPlayFailureAnalytics(a)}))}))}_playLoop(){this._play(!0,!1)}playByVideoAction(){this._play(!1,!0)}play(){this._play(!1,!1)}duration(){return this._player!=null?this._player.liveTracker!=null?this._player.liveTracker.seekableEnd():this._player.duration():0}currentTime1(){return this._player!=null?this._player.currentTime():0}currentTime2(e){this._player!=null&&(this._player.paused()&&this._player.one("timeupdate",t=>{this.invalidateTexture()}),this._player.currentTime(e))}resetToStartTime(){this.currentTime2(0)}isPlaying(){return this._player==null?!1:!this._player.paused()}invalidateTexture(){if(this._texture==null)return;this._texture.invalidateVideoFrame()}_handleOnLoadedMetadata(){var e;yi.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Loading completed"),this.reportLoadSuccessAnalytics(),this._loadComplete=!0,window.vid=this,(e=this._videoManager)==null||e.onVideoLoaded(this)}_beginLoadingHLS(e){this._loadTimeTracker.start(),this._fileTypeLoading="hls",this._player.src({type:"application/x-mpegURL",src:this._sourceURL}),this._player.one("error",t=>{this._loadTimeTracker.end(),console.warn("Reverting to fallback media source"),this.reportLoadFailureAnalytics("Failed to access HLS manifest"),this._beginLoadingMP4()})}_getMP4Url(){let e=new fo;return this._MP4VideoUrl!=null?(e.resolve(this._MP4VideoUrl),e):(new Ur(this._metaMP4Url).get().then(t=>{let n=null;try{n=JSON.parse(t.text)}catch{e.reject("Failed to parse response");return}let r=new Se(n.status);if(r.value===void 0){e.reject("Failed to parse status from response");return}if(r.value!=200){e.reject(`Status is ${r.value}: ${n.message}`);return}let o=n.meta;if(o===void 0){e.reject("Status is 200, but failed to parse signed_url");return}let a=o.signed_url;if(a===void 0){e.reject("Status is 200, but failed to parse signed_url");return}this._MP4VideoUrl=a,e.resolve(a)},t=>{e.reject(`Request failed with status: ${t.status}`)}),e)}_isWebMVideo(){let e=new fo;return this._getMP4Url().then2(t=>{new Ur(t).head().then(n=>{e.resolve(n.contentType=="video/webm")},n=>{e.resolve(!1)})},t=>{e.resolve(!1)}),e}_beginLoadingMP4(){this._loadTimeTracker.start(),this._fileTypeLoading="mp4",this._getMP4Url().then2(e=>{this._player.src({type:"video/mp4",src:e}),this._player.one("error",t=>{this._loadTimeTracker.end(),this._isInErrorState=!0;try{this.reportLoadFailureAnalytics(`Failed to access mp4. Status: ${t.status} Message: ${t.message}`)}catch{this.reportLoadFailureAnalytics("Failed to access mp4.")}})},e=>{this._loadTimeTracker.end(),this.reportLoadFailureAnalytics(`Failed to acquire mp4 url. ${e}`),this._isInErrorState=!0})}startLoadIfNeeded(){if(this._player!=null)return;let e=document.createElement("video");if(e.crossOrigin="anonymous",e.style.display="none",document.body.appendChild(e),this._player=To.instance().getPlayer(e),this._player==null){this._isInErrorState=!0,this.reportLoadFailureAnalytics("Failed to create VideoJS player");return}this._player.muted(!0),this._player.playsinline(!0),this._player.autoplay(!1),this._player.loop(!1),this._player.ready(()=>{this._player.on("ended",t=>{this._loop?this._playLoop():this.resetToDefaultState()}),this._player.on("seeking",t=>{this._seeking=!0}),this._player.on("seeked",t=>{this._seeking=!1}),this._player.on("loadedmetadata",t=>{this._handleOnLoadedMetadata()}),X.getFeatureFlags().videoOnIOSStaging&&this._player.on("loadeddata",t=>{this.shouldDisplayThumbnail=!1})}),X.getFeatureFlags().prototypeTransparentWebMVideo?this._isWebMVideo().then2(t=>{t?this._beginLoadingMP4():this._beginLoadingHLS(this._sourceURL)},t=>{this._beginLoadingHLS(this._sourceURL)}):this._beginLoadingHLS(this._sourceURL)}on(e,t){let n=r=>{t(this._player)};return this._player!=null&&this._player.on(e,n),n}off(e,t){this._player!=null&&this._player.off(e,t)}getOrCreateTexture(e,t){if(this._texture==null&&this._loadComplete){let n=jp.VideoJsPlayer_getBackingVideo(this._player);this._texture=e.createTexture3(t,n,"Video")}return!this.isReadyToPlay()||this.isInErrorState()?null:this._texture}resetToDefaultState(){this.overriddenPlayingState=null,this.overriddenMutedState=null}_getCurrentLocation(){return window.location.href.indexOf("/community/")!=-1?"community_viewer":"viewer"}reportLoadFailureAnalytics(e){this._loadTimeTracker.end();let t=this._loadTimeTracker.getLoadTime();t<0||(console.warn("Video failed to load:",e),Be.trackDefinedEvent("prototype.video_load",new Map([["status","failure"],["hash",this._hash],["load_time",t],["file_type",this._fileTypeLoading],["reason",e],["location",this._getCurrentLocation()]])))}reportLoadSuccessAnalytics(){this._loadTimeTracker.end();let e=this._loadTimeTracker.getLoadTime();e<0||Be.trackDefinedEvent("prototype.video_load",new Map([["status","success"],["hash",this._hash],["load_time",e],["file_type",this._fileTypeLoading],["width",this._player.videoWidth()],["height",this._player.videoHeight()],["location",this._getCurrentLocation()]]))}reportPlaySuccessAnalytics(){X.getFeatureFlags().prototypeLogVideoPlay&&Be.trackEvent1("video_play",new Map([["status","success"],["hash",this._hash],["location",this._getCurrentLocation()]]))}reportPlayFailureAnalytics(e){X.getFeatureFlags().prototypeLogVideoPlay&&Be.trackEvent1("video_play",new Map([["status","failure"],["hash",this._hash],["reason",e],["location",this._getCurrentLocation()]]))}constructor(e,t,n,r){this.id=(Hl.nextID=Hl.nextID+1)+-1,this._hash=e,this._sourceURL=t,this._metaMP4Url=n,this._videoManager=r,this._loadTimeTracker=new Lf,this._loadComplete=!1,this._texture=null,this._player=null,this._isInErrorState=!1,this._fileTypeLoading="hls",this._loop=!1,this._seeking=!1,this._prevReadyState=Gl.HAVE_NOTHING,this.overriddenPlayingState=null,this.overriddenMutedState=null,this.shouldDisplayThumbnail=!0,this._MP4VideoUrl=null}};Hl.nextID=0;var Sd=Hl,Gl;(o=>(o.HAVE_NOTHING=0,o.HAVE_METADATA=1,o.HAVE_CURRENT_DATA=2,o.HAVE_FUTURE_DATA=3,o.HAVE_ENOUGH_DATA=4))(Gl||(Gl={}));var Lf=class{start(){this._endConditionSeconds=-1,this._startConditionSeconds=Qe.seconds()}end(){this._endConditionSeconds=Qe.seconds()}getLoadTime(){return this._endConditionSeconds<0||this._startConditionSeconds<0?-1:this._endConditionSeconds-this._startConditionSeconds}constructor(){this._startConditionSeconds=-1,this._endConditionSeconds=-1}},yd=class extends xa{uninitialize1(){this.uninitialize2(e=>{e.uninitialize()})}toString1(){return this.toString2(e=>e.toString())}constructor(){super()}};var $p=class{constructor(e){this._visiblePaints=new Set([]),this._appState=null,this._lastStateChange=null,this._appState=e}isPaintVisible(e){return this._visiblePaints.has(e)}forEachVisiblePaint(e){for(let t=0,n=Array.from(this._visiblePaints.values()).length;t<n;t=t+1)e(Array.from(this._visiblePaints.values())[t])}refreshVisibleVideosIfNeeded(){this.handlePrototypeStateChange(this._lastStateChange)}handlePrototypeStateChange(e){var a;if(e==null)return;this._visiblePaints=new Set;let t=e.newStateId(),n=(a=this._appState.scene())==null?void 0:a.findNode1(t);if(n==null)return;this._lastStateChange=e,this._gatherVisibleVideoResources(n);let r=e.newOverlayData();for(let s=0,l=r.length;s<l;s=s+1){let d=this._appState.scene().findNode1(r[s].id);this._gatherVisibleVideoResources(d)}let o="";this.forEachVisiblePaint(s=>{o+=" "+s.id().toString()+","}),yi.VERBOSE_LOGS&&console.log("Found these visible paints:",o)}_gatherVisibleVideoResources(e){if(!e.visible())return;for(let n=0,r=e.childCount();n<r;n=n+1)this._gatherVisibleVideoResources(e.childAt1(n));let t=null;if(e.getCachedRenderTree()!=null)t=e.getCachedRenderTree();else if(e.getCachedRenderTreeForBaseScreen()!=null)t=e.getCachedRenderTreeForBaseScreen();else return;this._gatherVideosFromRenderNode(t.value)}_gatherVideosFromRenderNode(e){if(e!=null)switch(e.op()){case 3:{this._gatherVideosFromFillNode(e);break}case 4:{this._gatherVideosFromFillStrokeNode(e);break}case 5:{this._gatherVideosFromMaskNode(e);break}case 1:{this._gatherVideosFromGroupNode(e);break}case 6:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 2:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 9:{let t=e;this._gatherVideosFromRenderNode(t.alpha);break}case 7:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 8:{let t=e;this._gatherVideosFromRenderNode(t.tree);break}case 10:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 11:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 12:{let t=e;this._gatherVideosFromRenderNode(t.startChild),this._gatherVideosFromRenderNode(t.endChild);break}case 0:{let t=e;this._gatherVideosFromRenderNode(t.child);break}}}_gatherVideosFromFillNode(e){let t=e.geometry.paints;Oe.forEachPaintWithVideo(t,n=>{this._visiblePaints.add(n)})}_gatherVideosFromFillStrokeNode(e){let t=e.fillGeometries;for(let n=0,r=t.length;n<r;n=n+1){let o=t[n].paints;Oe.forEachPaintWithVideo(o,a=>{this._visiblePaints.add(a)})}for(let n=0,r=e.strokeGeometries.length;n<r;n=n+1){let o=e.strokeGeometries[n].paints;Oe.forEachPaintWithVideo(o,a=>{this._visiblePaints.add(a)})}}_gatherVideosFromMaskNode(e){this._gatherVideosFromRenderNode(e.color)}_gatherVideosFromGroupNode(e){for(let t=0,n=e.children.length;t<n;t=t+1)this._gatherVideosFromRenderNode(e.children[t])}getLastTopLevelStateChange(){return this._lastStateChange}};var Wl=class i{constructor(e,t,n,r){this.status=i.Status.PENDING,this.interactionType=e,this.interactionID=t,this.hotspotNodeID=n,this.listener=r,this.internalEventListeners=[]}};(t=>{let i;(a=>(a[a.PENDING=0]="PENDING",a[a.ACTIVE=1]="ACTIVE",a[a.SUPERCEDED=2]="SUPERCEDED"))(i=t.Status||(t.Status={}));let e;(r=>{function n(o){return t.Status[o]}r.Status_toString=n})(e=t.in_Status||(t.in_Status={}))})(Wl||(Wl={}));var zl=class{constructor(e,t){this.nodePath=e,this.videoPlayback=t}},bd=class{constructor(e,t){this.eventName=e,this.listener=t}},qi=class qi{runtimeStorage(){return this._runtimeStorage}associatePaintWithNode(e,t){this._needToRecalculateVisibleVideos=!0;let n=t.uniqueIdentifier();this._paintToNodeGUIDMap.set(e,n),this._guidToVideoMetadata.set(n,new zl(wn.getSemanticNodePath(t),t.videoPlayback())),this._paintsForPlaybackSettingsRefresh.add(e)}constructor(e){this._appState=null,this._guidToVideoMetadata=new Map,this._hashToRuntimeMap=new Map,this._paintToNodeGUIDMap=new Map,this._runtimeStorage=new yd,this._deferredRuntimes=new Set,this._deferredInteractionEvents=new Set,this._visibilityTracker=null,this._needToRecalculateVisibleVideos=!1,this._framePotentiallyReadyToPlay=!0,this._paintsForPlaybackSettingsRefresh=new Set,this._lastTransitionShouldForceStateRefresh=!1,this._userHasInteractedWithPage=!1,this._appState=e,this._visibilityTracker=new $p(e),this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._appState.addActionObserver(this),this._appState.addAppObserver(this)}getNodeMetadata(e){return this._guidToVideoMetadata.has(e)?this._guidToVideoMetadata.get(e):new zl([],null)}getVideoRuntimeForPaint(e){if(!this._paintToNodeGUIDMap.has(e))return null;let t=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(t).nodePath,r=e.video().hash();return this._runtimeStorage.getData(n,r)}getPlaybackSettingsForPaint(e){if(!this._paintToNodeGUIDMap.has(e))return null;let t=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(t).videoPlayback;return n==null&&(n={autoplay:!0,mediaLoop:!0,muted:!1}),n}_populateRuntimesForVisibleVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{if(!this._paintToNodeGUIDMap.has(e))return;let t=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(t).nodePath;if(this.getVideoRuntimeForPaint(e)!=null)return;let r=e.video().hash(),o=this._hashToRuntimeMap.get(r).clone();this._runtimeStorage.insert(n,r,o)})}getVideoRuntimesForNode(e){let t=this.getNodeMetadata(e).nodePath;return this._runtimeStorage.getAllDataForNode(t)}updateVideoRuntime(e,t){let n=ne.isValid(e.transitionNodeID())?e.transitionNodeID():t;if(!this._guidToVideoMetadata.has(n))return;let r,o,a=[];this.getVideoRuntimesForNode(n).forEach((l,d)=>{if(l!=null){switch(e.mediaAction()){case"PLAY":{l.playByVideoAction();break}case"PAUSE":{l.pauseByVideoAction();break}case"TOGGLE_PLAY_PAUSE":{l.isPlaying()?l.pauseByVideoAction():l.playByVideoAction();break}case"MUTE":{l.setMutedByVideoAction(!0);break}case"UNMUTE":{l.setMutedByVideoAction(!1);break}case"TOGGLE_MUTE_UNMUTE":{l.setMutedByVideoAction(!l.muted());break}case"SKIP_FORWARD":{let c=e.mediaSkipByAmount(),p=Math.min(l.currentTime1()+c,l.duration()-.01);l.currentTime2(p);break}case"SKIP_BACKWARD":{let c=e.mediaSkipByAmount(),p=Math.max(0,l.currentTime1()-c);l.currentTime2(p);break}case"SKIP_TO":{let c=e.mediaSkipToTime(),p=Math.max(0,c);p=Math.min(p,l.duration()-.01),l.currentTime2(p);break}}r=l.isPlaying(),o=!l.muted(),a.push(l.currentTime1()*1e3)}}),r!=null&&o!=null&&a.length>0&&this._createVideoStateChangeInPrototypeState(n,r,o,a)}_createVideoStateChangeInPrototypeState(e,t,n,r){this._appState.prototypeState().createVideoStateChange(e,t,n,r,this._currentTruncatedTimeInMilliseconds())}resetVideoStateChanges(e){e.forEach(t=>{let n=ne.fromFigGUID(t.targetNodeId);if(!this._guidToVideoMetadata.has(n))return;let r=this.getVideoRuntimesForNode(n),o=[];r.forEach((a,s)=>{o.push(a.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(n,o)})}_createDefaultVideoStateChangeInPrototypeState(e,t){var r;let n=(r=this.getNodeMetadata(e))==null?void 0:r.videoPlayback;this._appState.prototypeState().createVideoStateChange(e,n==null?void 0:n.autoplay,n==null?void 0:n.muted,t,this._currentTruncatedTimeInMilliseconds())}multiplayerUpdateVideoRuntimes(e,t){let n=ne.fromFigGUID(t.targetNodeId);if(!this._guidToVideoMetadata.has(n))return;let r=this.getVideoRuntimesForNode(n);if(r==null)return;let o=0;r.forEach((a,s)=>{if(a!=null){if(t.isPlaying!=a.isPlaying()&&(a.isPlaying()?a.pauseByVideoAction():a.playByVideoAction()),t.isPlayingSound!=!a.muted()&&a.setMutedByVideoAction(!t.isPlayingSound),!a.isPlaying()||t.currentTimes[o]!=e[o]){let l=this._currentTruncatedTimeInMilliseconds()-t.actionTakenTimestamp,c=(a.isPlaying()?t.currentTimes[o]+l:t.currentTimes[o])%(a.duration()*1e3);a.currentTime2(c/1e3)}o+=1}})}_currentTruncatedTimeInMilliseconds(){return Date.now()%1e6}_registerDeferredInteractionEvent(e){if(e.status==1)return;let t=this.getVideoRuntimesForNode(e.hotspotNodeID);if(t!=null){for(let n of Array.from(t.keys())){let r=t.get(n);if(e.interactionType=="ON_MEDIA_END"){let o=r.on("ended",a=>{e.listener(a)});e.internalEventListeners.push(new bd("ended",o))}else if(e.interactionType=="ON_MEDIA_HIT"){let o=r.on("timeupdate",a=>{e.listener(a)});e.internalEventListeners.push(new bd("timeupdate",o)),o=r.on("play",a=>{e.listener(a)}),e.internalEventListeners.push(new bd("play",o))}}e.status=1}}_deregisterDeferredInteractionEvent(e){if(e.status!=2)return;let t=this.getVideoRuntimesForNode(e.hotspotNodeID);if(t!=null)for(let n of Array.from(t.keys())){let r=t.get(n);for(let o of e.internalEventListeners)r.off(o.eventName,o.listener)}}_getListenerForInteractionEvent(e,t,n){let r=null;if(e=="ON_MEDIA_END")r=o=>{n()};else if(e=="ON_MEDIA_HIT"){let o=!1;r=a=>{let s=a.currentTime(),l=a.liveTracker?a.liveTracker.seekableEnd():a.duration();t>l&&(t=l);let d=.3;if(s>=t-d&&s<t){let c=Math.ceil((t-s)*1e3)|0;setTimeout(()=>{let p=a.currentTime(),u=a.paused()&&p<t,h=p>=t&&p<t+d;!o&&!u&&h&&(o=!0,n())},c)}else o=!1}}else console.error("videoManager.addInteractionEvent() should only be called with video trigger events");return r}addInteractionEvent(e,t,n,r){let o=e.event().interactionType(),a=this._getListenerForInteractionEvent(o,n,r),s=new Wl(o,e.id(),t,a);for(let l of Array.from(this._deferredInteractionEvents.values()))l.interactionID==s.interactionID&&(l.status=2,To.instance().isLibAvailable()&&(this._deregisterDeferredInteractionEvent(l),this._deferredInteractionEvents.delete(l)));To.instance().isLibAvailable()&&this._registerDeferredInteractionEvent(s),this._deferredInteractionEvents.add(s)}onFrame(){if(qi.VERBOSE_LOGS&&console.log(this.debugString()),this._visibilityTracker!=null){if(this._needToRecalculateVisibleVideos&&(this._visibilityTracker.refreshVisibleVideosIfNeeded(),this._populateRuntimesForVisibleVideos(),this._framePotentiallyReadyToPlay=!0,this._needToRecalculateVisibleVideos=!1,qi.VERBOSE_LOGS&&console.log(this.debugString())),this._framePotentiallyReadyToPlay&&this._allVisibleVideosAreLoaded()){this._framePotentiallyReadyToPlay=!1,this._applyPlaybackSettingsToVisibleVideos();for(let e of Array.from(this._deferredInteractionEvents.values()))e.status==0?this._registerDeferredInteractionEvent(e):e.status==2&&(this._deregisterDeferredInteractionEvent(e),this._deferredInteractionEvents.delete(e));qi.VERBOSE_LOGS&&console.log(this.debugString())}this._invalidateTexturesOfPlayingVideos()}}resetAllRuntimesWithinNode(e){let t=new nn(this._appState.scene().findNode1(e)),n=wn.getSemanticNodePath(t),r=this._runtimeStorage.getSubTrie(n),o=[];r!=null&&r.forEach(a=>{a.resetToStartTime(),o.push(a.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(e,o)}resetAllRuntimesWithinTLFNode(e){let t=this._appState.scene().findNode1(e);for(let o=0,a=t.childCount();o<a;o=o+1){let s=t.childAt1(o);this.resetAllRuntimesWithinNode(s.id())}let n=this._runtimeStorage.getSubTrie([new Is(t.name(),0)]),r=[];n!=null&&n.forEach(o=>{o.resetToStartTime(),r.push(o.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(e,r)}handleHsmAborted(e,t){}handleHsmCommitted(e,t,n){this._lastTransitionShouldForceStateRefresh=t.transitionParameters.transitionResetVideoPosition,t.transitionParameters.transitionResetVideoPosition&&this.resetAllRuntimesWithinNode(ce.List_last(e.guids)),this.reactToStateChange(this._visibilityTracker.getLastTopLevelStateChange(),t.getInsertedFrameIds())}handleHsmInitiated(e,t){}handleHsmRequested(e,t){}handleStateChangeCommitted(e,t){if(this._lastTransitionShouldForceStateRefresh=e.transitionParameters.transitionResetVideoPosition,e.transitionParameters.transitionResetVideoPosition){this.resetAllRuntimesWithinTLFNode(e.newStateId());let n=e.newOverlayData();for(let r=0,o=n.length;r<o;r=r+1)this.resetAllRuntimesWithinNode(n[r].id)}this.reactToStateChange(e,e.getInsertedFrameIds())}handleStateChangeAborted(e){}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._deleteVisibleRuntimes(),this._framePotentiallyReadyToPlay=!0}reactToStateChange(e,t){this._recalculateVisibleVideoPaints(e);let n=new Set;this._visibilityTracker.forEachVisiblePaint(r=>{if(!this._paintToNodeGUIDMap.has(r))return;let o=r.video().hash(),a=this._paintToNodeGUIDMap.get(r),s=this.getNodeMetadata(a).nodePath,l=this.getVideoRuntimeForPaint(r);l!=null&&n.add(l.id);let d=this._appState.scene().findNode2(a);for(let c of t){let p=this._appState.scene().findNode1(c);p!=null&&p.isAncestorOf(d)&&this._paintsForPlaybackSettingsRefresh.add(r)}if(l==null){let c=this._hashToRuntimeMap.get(o).clone();this._runtimeStorage.insert(s,o,c)}}),this._runtimeStorage.forEach(r=>{!n.has(r.id)&&r.isPlaying()&&r.pause()}),this._framePotentiallyReadyToPlay=!0}handleAction(e,t){this._userHasInteractedWithPage||(e==5||e==6||e==8||e==9||e==10)&&(this._userHasInteractedWithPage=!0,this._visibilityTracker.forEachVisiblePaint(n=>{let r=this.getVideoRuntimeForPaint(n),o=this.getPlaybackSettingsForPaint(n);r!=null&&o!=null&&!o.muted&&r.setMuted(o.muted)}),this._appState.removeActionObserver(this))}_applyPlaybackSettingsToVisibleVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{if(!this._paintsForPlaybackSettingsRefresh.has(e))return;this._paintsForPlaybackSettingsRefresh.delete(e);let t=this.getVideoRuntimeForPaint(e),n=this.getPlaybackSettingsForPaint(e);if(t!=null&&n!=null){t.setLoop(n.mediaLoop),this._lastTransitionShouldForceStateRefresh&&t.resetToDefaultState();let o=t.overriddenMutedState==null?n.muted:t.overriddenMutedState.value;t.setMuted(o),(t.overriddenPlayingState==null?n.autoplay:t.overriddenPlayingState.value)?t.play():t.pause()}})}_invalidateTexturesOfPlayingVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{let t=this.getVideoRuntimeForPaint(e);t!=null&&t.isPlaying()&&t.invalidateTexture()})}_recalculateVisibleVideoPaints(e){qi.VERBOSE_LOGS&&console.log("Recalculating visible paints"),this._visibilityTracker.handlePrototypeStateChange(e),this._visibilityTracker.forEachVisiblePaint(t=>{let n=this.getVideoRuntimeForPaint(t);n!=null&&n.startLoadIfNeeded()}),this._framePotentiallyReadyToPlay=!0}_deleteVisibleRuntimes(){qi.VERBOSE_LOGS&&console.log("Deleting existing runtimes"),this._runtimeStorage.uninitialize1()}buildVideoResource(e){To.instance().hasRequestedLibrary()||(To.instance().onSuccess=()=>{for(let n of Array.from(this._deferredRuntimes.values()))n.startLoadIfNeeded()},To.instance().requestLibrary());let t=new Zp(e,this);if(!this._hashToRuntimeMap.has(t.hash())){let n=wt.getVideoPrefixUrl(),r=n!=null&&n.endsWith("/")?n:n+"/",o=`${r}${t.hash()}/manifest`,a=`${r}${t.hash()}`,s=new Sd(t.hash(),o,a,this);this._hashToRuntimeMap.set(t.hash(),s)}return t}_allVisibleVideosAreLoaded(){let e=!0;return this._visibilityTracker.forEachVisiblePaint(t=>{let n=this.getVideoRuntimeForPaint(t);n!=null&&!n.isReadyToPlay()&&!n.isInErrorState()&&(e=!1)}),e}onVideoLoaded(e){this._appState.imageManager()==null||this._appState.imageManager().onImageLoaded==null||(this._allVisibleVideosAreLoaded()?(qi.VERBOSE_LOGS&&console.log("VideoManager - - : All videos in frame are loaded!"),this._appState.baseScreenNode()!=null&&this._appState.imageManager().onImageLoaded(this._appState.baseScreenNode())):qi.VERBOSE_LOGS&&console.log("VideoManager - - : Not all videos in frame are loaded"))}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){e.property==72&&(this._guidToVideoMetadata.set(e.node.id(),new zl(wn.getSemanticNodePath(new nn(e.node)),e.newVal)),this._paintToNodeGUIDMap.forEach((t,n)=>{t==e.node.id()&&this._paintsForPlaybackSettingsRefresh.add(n)}),this._framePotentiallyReadyToPlay=!0)}debugString(){let e=`VideoManager 
`;return e+="Need to recalculate visible videos: "+this._needToRecalculateVisibleVideos.toString()+`
`,e+="Frame may be ready to start playing videos: "+this._framePotentiallyReadyToPlay.toString()+`
`,e+=`	Loading Runtimes:
`,this._hashToRuntimeMap.forEach((t,n)=>{e+="		hash: "+n+" -> "+t.toString()+`
`}),e+=`	VisiblePaints:
`,this._visibilityTracker.forEachVisiblePaint(t=>{let n=this.getPlaybackSettingsForPaint(t);n!=null?e+="		"+t.debugString()+" muted="+n.muted.toString()+" loop="+n.mediaLoop.toString()+" autoplay="+n.autoplay.toString()+" hash: "+t.video().hash()+`
`:e+="		"+t.debugString()+` (no playback settings found) 
`}),e+=`	Paint -> GUID:
`,this._paintToNodeGUIDMap.forEach((t,n)=>{e+="		P="+n.id().toString()+" => "+t+`
`}),e}enqueueVideoOrStartLoad(e){To.instance().isLibAvailable()?e.startLoadIfNeeded():this._deferredRuntimes.add(e)}muteAllOtherVideos(e){this._runtimeStorage.forEach(t=>{t.id!=e.id&&t.setMuted(!0)})}};qi.VERBOSE_LOGS=!1;var yi=qi;var vn=class{emitter(){return this._emitter}scene(){return this._scene}prototypeState(){return this._prototypeState}prototypeStructure(){return this._prototypeStructure}imageManager(){return this._imageManager}videoManager(){return this._videoManager}requestedFrameMetricsTracker(){return this._requestedFrameMetricsTracker}serialization(){return this._serialization}currentFileKey(){return this._currentFileKey}setCurrentFileKey(e){this._currentFileKey=e}fontListPromise(){return this._fontListPromise}setFontListPromise(e){this._fontListPromise=e}renderDots(){return this._renderDots}setRenderDots(e){this._renderDots=e}baseScreenId(){return this._prototypeState.getCurrentBaseScreenId()}currentFitMode(){return this._prototypeState.getCurrentFitMode()}baseScreenNode(){return this._scene==null?null:this._prototypeState.getCurrentBaseScreenNode()}constructor(){this._appObservers=new nr,this._actionObservers=new nr,this._frameObservers=new nr,this._scene=null,this._canvas=null,this._prototypeState=null,this._prototypeStructure=null,this._imageManager=null,this._videoManager=null,this._requestedFrameMetricsTracker=new Xp,this._serialization=null,this._currentFileKey="",this._activePrototypeStartingPointNodeId=null,this._renderDots=!1,this._fontListPromise=Promise.resolve(pr.VOID),this._emitter=null,this._pendingSetActiveCanvas=null,this._emitter=$t.getEventEmitter(),this._prototypeState=new ko(this),this._prototypeStructure=new Wt(this),this._imageManager=new Yp(this,()=>{this._emitter.trigger("showImageFetchFailureUI",{})}),this._videoManager=new yi(this),this._serialization=new gt(this._imageManager,this._videoManager),kr&&L._prototypeLib==null&&L.initialize(Ri,this)}addAppObserver(e){this._appObservers.add(e)}removeAppObserver(e){this._appObservers.remove(e)}addActionObserver(e){this._actionObservers.add(e)}removeActionObserver(e){this._actionObservers.remove(e)}addFrameObserver(e){this._frameObservers.add(e)}removeFrameObserver(e){this._frameObservers.remove(e)}nodeTransitionTracker(){return this._prototypeStructure.nodeTransitionTracker()}triggerAction1(e){this.triggerAction2(e,null)}triggerAction2(e,t){this._actionObservers.forEach(n=>{n.handleAction(e,t)})}onFrame(){this._frameObservers.forEach(e=>{e.onFrame()})}resetStateForTests(){this._prototypeState.resetState()}setScene(e){var t;if(e!=this._scene){let n=this._scene;this._scene=e,(t=this._scene)==null||t.markLoaded(),this._appObservers.forEach(r=>{r.handleSceneChange(n,e)}),n!=null&&n.destroy(),this._scene==null?this.setActiveCanvas(null):this.setActiveCanvas(this._scene.firstUserCanvasOrNull())}}requestSetActiveCanvas(e){e.hasBeenLoaded()?this.setActiveCanvas(e):(this._pendingSetActiveCanvas=e,this.triggerAction2(11,$.new5(e)))}trySettingRequestedActiveCanvas(){this._pendingSetActiveCanvas!=null&&this._pendingSetActiveCanvas.hasBeenLoaded()&&(this.setActiveCanvas(this._pendingSetActiveCanvas),this._pendingSetActiveCanvas=null)}setActiveCanvas(e){if(this._canvas!=e){let t=this._canvas;this._canvas=e,this._appObservers.forEach(n=>{n.handleActiveCanvasChange(t,this._canvas)})}}getActiveCanvas(){return this._canvas!=null&&this._scene==null?(console.warn("getActiveCanvas called with null scene but non-null canvas"),null):this._canvas}activePrototypeDevice(){var e;return(e=this.getActiveCanvas())==null?void 0:e.prototypeDevice()}storedPrototypeDevice(){var e;return(e=this.getActiveCanvas())==null?void 0:e.storedPrototypeDevice()}activePrototypeStartingPointNodeId(){return this._activePrototypeStartingPointNodeId}setActivePrototypeStartingPointNodeId(e){let t=this._activePrototypeStartingPointNodeId;this._activePrototypeStartingPointNodeId=e,this._appObservers.forEach(n=>{n.handleActivePrototypeStartingPointChange(t,e)})}};var OI=$a(RI());var ir=class ir{constructor(e){this._valueBySnapshotId=null,this._isDirty=!1,this._valueBySnapshotId=e}getValueOrNull(e){return Le.StringMap_get(this._valueBySnapshotId,e,null)}updateValue(e,t){this._valueBySnapshotId.set(e,t),this._isDirty=!0}toString(){let e=Array.from(this._valueBySnapshotId.keys());e.sort((n,r)=>Wn.string_compare(n,r));let t="";for(let n of e)t+=`
${ir._PREFIX}snapshotId: ${n}
`,t+=this._valueBySnapshotId.get(n);return t}isDirty(){return this._isDirty}static _createEmptyDefaultDirtyAtPath(e){if(ir._snapshotFileCache.has(e))throw new Error("Snapshot file at path already exists in cache");return ir._snapshotFileCache.set(e,new ir(new Map)),ir._snapshotFileCache.get(e)._isDirty=!0,ir._snapshotFileCache.get(e)}static loadOrCreateFromPath(e){let t=Le.StringMap_get(ir._snapshotFileCache,e,null);return t!=null?Promise.resolve(t):ProtoTestHost_readFile(e).then(n=>{let r=Le.StringMap_get(ir._snapshotFileCache,e,null);return r!=null?r:n==null?(console.log(`[Snapshot] Create empty default dirty snapshot at path ${e}`),ir._createEmptyDefaultDirtyAtPath(e)):(ir._snapshotFileCache.set(e,new ir(ir._snapshotStringToMap(n))),ir._snapshotFileCache.get(e))})}static _snapshotStringToMap(e){let t=new Map,n=e.split(`
`),r=null,o=null;for(let a of n){let s=`${ir._PREFIX}snapshotId: `;a.startsWith(s)?(r!=null&&t.set(r,o.join(`
`)),r=a.slice(s.length),o=[]):o!=null&&o.push(a)}return r!=null&&t.set(r,o.join(`
`)),t}static flushSnapshotUpdates(){let e=[];return Le.StringMap_each(ir._snapshotFileCache,(t,n)=>{n.isDirty()&&e.push(ir._saveToPath(t,n))}),Promise.all(e)}static _saveToPath(e,t){return console.log(`[Snapshot] Saving to file ${e}`),ProtoTestHost_writeFile(e,t.toString())}};ir._PREFIX="#*#* ",ir._snapshotFileCache=new Map;var Ql=ir;var Ka=class{constructor(e){this._testFilepath=null,this._testFilepath=e}asyncAssertMatchesSnapshot(e,t){if(Jp==null)throw new Error("asyncAssertMatchesSnapshot called outside of a test");let r=this._testFilepath.split(".sk").join(".snapshot.txt"),o=Jp+" -- "+e,a=ProtoTestHost_env.UPDATE_SNAPSHOTS!==void 0;return Qw(r,o).then(s=>{let l=new RegExp("\\d+\\.\\d*","g"),d=t.replaceAll(l,c=>`${Math.round(parseFloat(c)*1e3)/1e3}`);if(s==null||a)return Ww(r,o,d),pr.VOID;if(s!==d)throw new Error(`${vd}Snapshot ${o} in file ${r} did not match previous value. Here's a diff that changes the ${xI}stored snapshot${vd} into the ${FI}received value${vd}:

${zw(s,d)}`);return pr.VOID})}},Qa;(o=>{function i(){return o.hasSetExpectedErrorsBeenCalled=!1,Ri.interactionTestHelpers.resetExpectedErrorsAndGetErrorString(1)}o.resetExpectedErrorsAndGetErrorString=i;function e(a){if(o.hasSetExpectedErrorsBeenCalled)throw new Error("Can only call setExpectedErrors once per test");o.hasSetExpectedErrorsBeenCalled=!0,Ri.interactionTestHelpers.setExpectedErrors(a)}o.setExpectedErrors=e;function t(){o.isUnhandledErrorsExpected=!0}o.setUnhandledErrorsExpected=t,o.hasSetExpectedErrorsBeenCalled=!1,o.isUnhandledErrorsExpected=!1})(Qa||(Qa={}));function we(i,e){Vf(i,()=>new Promise((t,n)=>{e(),setTimeout(()=>{t(pr.VOID)},0)}))}function Ie(i,e){Vf(i,e)}function Vs(i,e){Vf(i,()=>e().then(t=>pr.VOID))}function Vf(i,e){Id.push(i);let t=Id.join(" -- ");ce.List_removeLast(Id),it(i,()=>{Jp=t,Uo=[],Qa.isUnhandledErrorsExpected=!1;let n=Qa.resetExpectedErrorsAndGetErrorString();return n.length>0&&Uo.push(new Error("Errors detected from before test started. Maybe from test harness initialization, or from a previous test: "+n)),e().catch(r=>(Uo.push(r),pr.VOID)).then(r=>{let o=Qa.resetExpectedErrorsAndGetErrorString();if(o.length>0&&Uo.push(new Error(o)),L.destroy(),Jp=null,Qa.isUnhandledErrorsExpected){if(Uo.length==0)throw new Error("Expected errors, but none were triggered")}else{Uo=Uo.filter(s=>s.message.indexOf("/api/web_logger/metrics/unhandled_error")==-1);let a=Uo.length>1?Uo.length.toString()+`unhandled errors: 
`:`Unhandled error: 
`;if(Uo.length==1)throw Uo[0];if(Uo.length>1){for(let s of Uo)a+=s.message,a+=`
`,a+=s.stack;throw new Error(a)}}return pr.VOID})})}function Qt(i,e){Id.push(i),describe(i,()=>{e()}),ce.List_removeLast(Id)}function zw(i,e){let t=OI.diffLines(i,e),n="";return t.forEach(r=>{let o="",a="";r.added?(o="+ ",a=FI):r.removed?(o="- ",a=xI):(o="  ",a=vd),n+=`${a}${o}${r.value}${vd}
`}),n}function Ww(i,e,t){Ql.loadOrCreateFromPath(i).then(n=>{n.updateValue(e,t)})}function Qw(i,e){return Ql.loadOrCreateFromPath(i).then(t=>t.getValueOrNull(e))}var Uo=[],Id=[],Jp=null,FI="\x1B[32m",xI="\x1B[31m",vd="\x1B[0m";var Ed=class{imageType(){return this._imageType}setImageType(e){this._imageType=e}constructor(e,t){this._ctx=null,this._decodeCallback=null,this._failureCallback=null,this._texture=null,this._imageHash=null,this._isImageMockLoading=!1,this._mockDecodedData=null,this._imageType=1,this._ctx=e,this._imageHash=t}width(){return 0}height(){return 0}url(){return"https://dummy-url"}hash(){return this._imageHash}state(){return this._mockDecodedData!=null?2:this._isImageMockLoading?1:0}gif(){return null}decodedData(){return this._mockDecodedData}texture(){return this._texture}setTexture(e){this._texture=e}loadDidFail(){return!1}objectHash(){return`Image(${this._imageHash})`}fetchAndDecode(e,t,n){this._isImageMockLoading||(this._decodeCallback=t,this._failureCallback=n,this._isImageMockLoading=!0,this._ctx.markImageFetched(this))}imageLoads(){this._isImageMockLoading&&(this._mockDecodedData=new yn(0,1,1,new Uint8Array(1)),this._decodeCallback(this._mockDecodedData),this._isImageMockLoading=!1)}imageFailsToLoad(){this._isImageMockLoading=!1,this._failureCallback(0)}freeMemoryForDecodedDataAndTexture(){return this.freeMemoryForDecodedData(),this._texture=null,!0}freeMemoryForDecodedData(){return this._mockDecodedData=null,this._isImageMockLoading=!1,!0}isDecoded(){return this._mockDecodedData!=null}isGIF(){return!1}};var ah=$a(Xs());var Cd=class{constructor(){if(arguments[0]==0){let[,e]=arguments;this.ws=null,this.ws=e}else if(arguments[0]==1){let[,e]=arguments;this.ws=null,this.ws=new WebSocket(e)}}url(){return this.ws.url}readyState(){return this.ws.readyState}setBinaryType(e){this.ws.binaryType=e}binaryType(){return this.ws.binaryType}setOnclose(e){this.ws.onclose=t=>{e(t)}}setOnerror(e){this.ws.onerror=t=>{e(t)}}setOnmessage(e){this.ws.onmessage=t=>{e(new Uf(t))}}setOnopen(e){this.ws.onopen=t=>{e(t)}}close(){this.ws.close()}send1(e){this.ws.send(e)}send2(e){this.ws.send(e)}equals(e){var t;return this.ws==((t=e==null?void 0:e.asHTMLSocket())==null?void 0:t.ws)}asHTMLSocket(){return this}asMockSocket(){return null}},eh=class eh{simulateDidOpen(){if(this._readyState=bi.Socket_OPEN,this._onopen!=null){let e={meta:"Fake open event for testing"};this._onopen(e)}}simulateDidClose(){if(this._readyState=bi.Socket_CLOSED,this._onclose!=null){let e={meta:"Fake close event for testing"};this._onclose(e)}}simulateMessage(e){this._onmessage!=null&&this._onmessage(e)}url(){return eh.FAKE_URL}readyState(){return this._readyState}setBinaryType(e){this._binaryType=e}binaryType(){return this._binaryType}setOnclose(e){this._onclose=e}setOnerror(e){this._onerror=e}setOnmessage(e){this._onmessage=e}setOnopen(e){this._onopen=e}close(){this._readyState=bi.Socket_CLOSING}send1(e){this.sent.push(new Uint8Array(e))}send2(e){this.sent.push(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}equals(e){return(e==null?void 0:e.asMockSocket())==this}asHTMLSocket(){return null}asMockSocket(){return this}constructor(){this._readyState=bi.Socket_CONNECTING,this._binaryType="blob",this._onclose=null,this._onerror=null,this._onmessage=null,this._onopen=null,this.sent=[]}};eh.FAKE_URL="ws://fake_url_for_tests_value_does_not_matter.com";var kf=eh;var Uf=class{isArrayBuffer(){return this.messageEvent.data instanceof ArrayBuffer}isBlob(){return this.messageEvent.data instanceof Blob}isString(){return typeof this.messageEvent.data=="string"}dataAsArrayBuffer(){return this.messageEvent.data}dataAsBlob(){return this.messageEvent.data}dataAsString(){return this.messageEvent.data}constructor(e){this.messageEvent=e}},bi;(r=>(r.Socket_CONNECTING=0,r.Socket_OPEN=1,r.Socket_CLOSING=2,r.Socket_CLOSED=3))(bi||(bi={}));var th=class i{opacity1(){return this._opacity}translation1(){return this._translation}transform1(){return this._transform}scaling1(){return this._scaling}transformOrigin1(){return this._transformOrigin}fillPaints1(){return this._fillPaints}strokePaints1(){return this._strokePaints}cornerRadii1(){return this._cornerRadii}rectangleSize1(){return this._rectangleSize}clone(){var t,n;let e=new i;return e._opacity=this._opacity,e._translation=this._translation.clone(),e._transform=this._transform.clone(),e._scaling=this._scaling,e._transformOrigin=(t=this._transformOrigin)==null?void 0:t.clone(),e._fillPaints=this._fillPaints,e._strokePaints=this._strokePaints,e._cornerRadii=this._cornerRadii,e._rectangleSize=(n=this._rectangleSize)==null?void 0:n.clone(),e}_areVectorsEqual(e,t){return e==null&&t==null?!0:e==null||t==null?!1:e.equals(t)}equals(e){return this._opacity==e.opacity1()&&this._transform.equals1(e.transform1())&&this._scaling.equals(e.scaling1())&&this._areVectorsEqual(this._transformOrigin,e.transformOrigin1())&&this.translation1().equals(e.translation1())&&rn.FrozenList_equals(this._fillPaints,e.fillPaints1(),(t,n)=>t.equals1(n))&&rn.FrozenList_equals(this._strokePaints,e.strokePaints1(),(t,n)=>t.equals1(n))&&this._cornerRadii.equals(e.cornerRadii1())&&this._areVectorsEqual(this._rectangleSize,e.rectangleSize1())}equalTransformsUpToTranslation(e,t){return this.equalTransformsUpToTranslationAndScaling(e,t)&&this._scaling.equals(e.scaling1())}equalTransformsUpToTranslationAndScaling(e,t){let n=Jr.from(this.transform1()),r=Jr.from(e.transform1()),o=Math.abs(n.angleDegrees-r.angleDegrees)<=t,a=Math.abs(n.m00-r.m00)<=t&&Math.abs(n.m01-r.m01)<=t&&Math.abs(n.m10-r.m10)<=t&&Math.abs(n.m11-r.m11)<=t;return o&&a}opacity2(e){return this._opacity=e,this}translation2(e){return this._translation=e,this}transform2(e){return e!=null,this._transform=e,this}scaling2(e){return this._scaling=e,this}transformOrigin2(e){return this._transformOrigin=e,this}fillPaints2(e){return this._fillPaints=e,this}strokePaints2(e){return this._strokePaints=e,this}cornerRadii2(e){return this._cornerRadii=e,this}rectangleSize2(e){return this._rectangleSize=e,this}withScaledTranslation(e){return this.clone().translation2(this._translation.multiply1(e))}constructor(){this._opacity=1,this._translation=E.new2(),this._transform=Nt.FrozenAffineTransform_new1(),this._scaling=E.new2().withOnesForZeros(),this._transformOrigin=null,this._fillPaints=[],this._strokePaints=[],this._cornerRadii=uo.ZEROS,this._rectangleSize=null}},Sr=class i{constructor(){if(arguments.length==0)this._from=null,this._to=null,this._shouldDoLegacyImageRectSizeTransition=!1,this._shouldTransitionGeometryForRoundedRectangles=!1,this._isTransformEqual=!1,this._from=new th,this._to=new th,this._isTransformEqual=!0;else if(arguments.length==1){let e=arguments[0];this._from=null,this._to=null,this._shouldDoLegacyImageRectSizeTransition=!1,this._shouldTransitionGeometryForRoundedRectangles=!1,this._isTransformEqual=!1,this._from=e._from.clone(),this._to=e._to.clone(),this._shouldDoLegacyImageRectSizeTransition=e._shouldDoLegacyImageRectSizeTransition,this._shouldTransitionGeometryForRoundedRectangles=e._shouldTransitionGeometryForRoundedRectangles,this._isTransformEqual=e._isTransformEqual}}from(){return this._from}to(){return this._to}opacity(e,t){return this._from.opacity2(e),this._to.opacity2(t),this}translation(e,t){return this._from.translation2(e),this._to.translation2(t),this}transform(e,t){return this._isTransformEqual=e.equals2(t,1e-6),this._from.transform2(e),this._to.transform2(t),this}scaling(e,t){return this._from.scaling2(e),this._to.scaling2(t),this}shouldDoLegacyImageRectSizeTransition(e){return this._shouldDoLegacyImageRectSizeTransition=e,this}transitionGeometryForRoundedRectangles(e,t,n,r){return this._from.rectangleSize2(e),this._from.cornerRadii2(t),this._to.rectangleSize2(n),this._to.cornerRadii2(r),this._shouldTransitionGeometryForRoundedRectangles=!0,this}transformOrigin(e,t){return this._from.transformOrigin2(e),this._to.transformOrigin2(t),this}fillPaints1(e,t){return this._from.fillPaints2(e),this._to.fillPaints2(t),this}strokePaints1(e,t){return this._from.strokePaints2(e),this._to.strokePaints2(t),this}_getPaints(e,t,n){let r=[];for(let o=0,a=t.length;o<a;o=o+1){let s=t[o],l=n[o];if(s.equals2(l))r.push(s);else{let d=s,c=l;d.opacity()==0&&(d=l.cloneAsSinglePaint(),d.setOpacity(0)),c.opacity()==0&&(c=s.cloneAsSinglePaint(),c.setOpacity(0)),r.push(dc.create(d,c,this._from.transformOrigin1().multiply(2),this._to.transformOrigin1().multiply(2),e))}}return r}fillGeometryForRoundedRectangles(e,t){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let n=Math.max(1-t.top(),t.bottom(),1),r=U.new4(ve.FrozenVector_ZERO,this._from.rectangleSize1().multiply(n).max2(this._to.rectangleSize1().multiply(n))),o=new uc("NONZERO",0,()=>{let a=E.lerp(this._from.rectangleSize1(),this._to.rectangleSize1(),e()),s=this._from.cornerRadii1().toList(),l=this._to.cornerRadii1().toList(),d=[];for(let c=0;c<4;c=c+1)d.push(Math.max(tn.double_lerp(s[c],l[c],e()),0));return new Pt(new U(0,0,Math.abs(a.x()),Math.abs(a.y())),uo.fromList(d))},r);return new Dn([o],[],r,null)}fillGeometryForSpreadDynamic(e,t,n,r,o,a){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let s=this._from.rectangleSize1().add(2*t),l=this._to.rectangleSize1().add(2*t),d=Math.max(1-a.top(),a.bottom(),1),c=U.new4(ve.FrozenVector_ZERO,this._from.rectangleSize1().multiply(d).max2(this._to.rectangleSize1().multiply(d))).expandedBy1(t),p=this._from.cornerRadii1().toList(),u=this._to.cornerRadii1().toList();for(let f=0;f<4;f=f+1)p[f]=p[f]==0?0:p[f]+t,u[f]=u[f]==0?0:u[f]+t;let h=new uc("NONZERO",0,()=>{let f=E.lerp(s,l,n()),_=[];for(let m=0;m<4;m=m+1)_.push(Math.max(tn.double_lerp(p[m],u[m],n()),0));return new Pt(new U(-t,-t,Math.abs(f.x()),Math.abs(f.y())),uo.fromList(_))},c);return new Kl(()=>new Lt(h.path(),h.windingRule),r,h.bounds(),Et.forDynamicGeometry(o))}fillPaints2(e){return this._getPaints(e,this._from.fillPaints1(),this._to.fillPaints1())}strokePaints2(e){return this._getPaints(e,this._from.strokePaints1(),this._to.strokePaints1())}hasTransitioningPaints(){return this._to.fillPaints1().length!=0&&this._from.fillPaints1().length!=0||this._to.strokePaints1().length!=0&&this._from.strokePaints1().length!=0}hasLegacyTransitioningSizesForImageRect(){return this._shouldDoLegacyImageRectSizeTransition}hasTransitioningGeometryForRoundedRectangles(){return this._shouldTransitionGeometryForRoundedRectangles}hasTransitioningTranslation(){return this._from.translation1()==null&&this._to.translation1()==null?!1:this._from.translation1()==null||this.to().translation1()==null?!0:!this._from.translation1().equals(this.to().translation1())}hasTransitioningTransform(){return this._from.transform1()==null&&this._to.transform1()==null?!1:this._from.transform1()==null||this.to().transform1()==null?!0:!this._from.transform1().equals1(this.to().transform1())}hasTransitioningScaling(){return this._from.scaling1()==null&&this._to.scaling1()==null?!1:this._from.scaling1()==null||this.to().scaling1()==null?!0:!this._from.scaling1().equals(this.to().scaling1())}hasTransitioningTransformOrigin(){return this._from.transformOrigin1()==null&&this._to.transformOrigin1()==null?!1:this._from.transformOrigin1()==null||this.to().transformOrigin1()==null?!0:!this._from.transformOrigin1().equals(this.to().transformOrigin1())}interpolateOpacity(e){return tn.double_clamp(tn.double_lerp(this.from().opacity1(),this.to().opacity1(),e),0,1)}interpolateTranslation(e){return E.lerp(this.from().translation1(),this.to().translation1(),e)}interpolateTransform(e){let t=this.from().transform1(),n=this.to().transform1();if(t.toAngle()!=n.toAngle()&&this.from().transformOrigin1()!=null&&this.to().transformOrigin1()!=null){let r=t.clone().translatedBy1(this.from().transformOrigin1()),o=n.clone().translatedBy1(this.to().transformOrigin1()),a=Jr.lerp1(r,o,e),s=E.lerp(this.from().transformOrigin1(),this.to().transformOrigin1(),e),l=oe.new2().translatedBy1(s.negative());return a.multiply(l),a}else return this._isTransformEqual?t:Jr.lerp1(t,n,e)}interpolateScaling(e){return E.lerp(this.from().scaling1(),this.to().scaling1(),e)}clone(){return new i(this)}withScaledTranslation(e){let t=this.clone();return t._from=t._from.withScaledTranslation(e),t._to=t._to.withScaledTranslation(e),t}},ye=class ye{constructor(){if(arguments.length==0)this._enteringFrameTransition=null,this._exitingFrameTransition=null,this._drawsEnteringFrameOnTopOfExitingFrame=!1,this._isDissolve=!1,this._reversed=null,this._enteringFrameTransition=new Sr,this._exitingFrameTransition=new Sr,this._drawsEnteringFrameOnTopOfExitingFrame=!0,this._isDissolve=!1;else if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._enteringFrameTransition=null,this._exitingFrameTransition=null,this._drawsEnteringFrameOnTopOfExitingFrame=!1,this._isDissolve=!1,this._reversed=null,this._enteringFrameTransition=e,this._exitingFrameTransition=t,this._drawsEnteringFrameOnTopOfExitingFrame=n,this._isDissolve=r}}enteringFrameTransition(){return this._enteringFrameTransition}exitingFrameTransition(){return this._exitingFrameTransition}drawsEnteringFrameOnTopOfExitingFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame}isDissolve(){return this._isDissolve}enteringFrameTranslation(e,t){return this._enteringFrameTransition.translation(e,t),this._reversed=null,this}enteringFrameOpacity(e,t){return this._enteringFrameTransition.opacity(e,t),this._reversed=null,this}exitingFrameTranslation(e,t){return this._exitingFrameTransition.translation(e,t),this._reversed=null,this}exitingFrameOpacity(e,t){return this._exitingFrameTransition.opacity(e,t),this._reversed=null,this}drawExitingFrameOnTopOfEnteringFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame=!1,this._reversed=null,this}dissolve(){return this._isDissolve=!0,this._reversed=null,this}freeze(){return this}clone(){return new ye(this._enteringFrameTransition.clone(),this._exitingFrameTransition.clone(),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}reversed(){if(this._reversed==null){let e=new ye().enteringFrameTranslation(this.exitingFrameTransition().to().translation1(),this.exitingFrameTransition().from().translation1()).enteringFrameOpacity(this.exitingFrameTransition().to().opacity1(),this.exitingFrameTransition().from().opacity1()).exitingFrameTranslation(this.enteringFrameTransition().to().translation1(),this.enteringFrameTransition().from().translation1()).exitingFrameOpacity(this.enteringFrameTransition().to().opacity1(),this.enteringFrameTransition().from().opacity1());this.isDissolve()&&e.dissolve(),this.drawsEnteringFrameOnTopOfExitingFrame()&&e.drawExitingFrameOnTopOfEnteringFrame(),this._reversed=e}return this._reversed}withScaledTranslation(e){return new ye(this._enteringFrameTransition.withScaledTranslation(e),this._exitingFrameTransition.withScaledTranslation(e),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}static get(e){switch(e){case"INSTANT_TRANSITION":return ye.INSTANT_TRANSITION;case"DISSOLVE":return ye.DISSOLVE;case"SMART_ANIMATE":return ye.DISSOLVE;case"SLIDE_FROM_LEFT":return ye.SLIDE_FROM_LEFT;case"SLIDE_FROM_RIGHT":return ye.SLIDE_FROM_RIGHT;case"SLIDE_FROM_TOP":return ye.SLIDE_FROM_TOP;case"SLIDE_FROM_BOTTOM":return ye.SLIDE_FROM_BOTTOM;case"PUSH_FROM_LEFT":return ye.PUSH_FROM_LEFT;case"PUSH_FROM_RIGHT":return ye.PUSH_FROM_RIGHT;case"PUSH_FROM_TOP":return ye.PUSH_FROM_TOP;case"PUSH_FROM_BOTTOM":return ye.PUSH_FROM_BOTTOM;case"MOVE_FROM_LEFT":return ye.MOVE_FROM_LEFT;case"MOVE_FROM_RIGHT":return ye.MOVE_FROM_RIGHT;case"MOVE_FROM_TOP":return ye.MOVE_FROM_TOP;case"MOVE_FROM_BOTTOM":return ye.MOVE_FROM_BOTTOM;case"SLIDE_OUT_TO_LEFT":return ye.SLIDE_OUT_TO_LEFT;case"SLIDE_OUT_TO_RIGHT":return ye.SLIDE_OUT_TO_RIGHT;case"SLIDE_OUT_TO_TOP":return ye.SLIDE_OUT_TO_TOP;case"SLIDE_OUT_TO_BOTTOM":return ye.SLIDE_OUT_TO_BOTTOM;case"MOVE_OUT_TO_LEFT":return ye.MOVE_OUT_TO_LEFT;case"MOVE_OUT_TO_RIGHT":return ye.MOVE_OUT_TO_RIGHT;case"MOVE_OUT_TO_TOP":return ye.MOVE_OUT_TO_TOP;case"MOVE_OUT_TO_BOTTOM":return ye.MOVE_OUT_TO_BOTTOM;case"FADE":return ye.DISSOLVE;case"MAGIC_MOVE":return ye.DISSOLVE}throw new Error(`Unhandled transition type ${e}`)}};ye.SLIDE_BACK_FRAME_OPACITY_START=1,ye.SLIDE_BACK_FRAME_OPACITY_END=.5,ye.OFFSCREEN_LEFT=new E(-1,0),ye.OFFSCREEN_RIGHT=new E(1,0),ye.OFFSCREEN_TOP=new E(0,-1),ye.OFFSCREEN_BOTTOM=new E(0,1),ye.CENTER=E.new2(),ye.INSTANT_TRANSITION=new ye().freeze(),ye.DISSOLVE=new ye().dissolve().freeze(),ye.SLIDE_FROM_LEFT=new ye().enteringFrameTranslation(ye.OFFSCREEN_LEFT,ye.CENTER).exitingFrameTranslation(ye.CENTER,ye.OFFSCREEN_RIGHT.divide(4)).exitingFrameOpacity(ye.SLIDE_BACK_FRAME_OPACITY_START,ye.SLIDE_BACK_FRAME_OPACITY_END).freeze(),ye.SLIDE_FROM_RIGHT=new ye().enteringFrameTranslation(ye.OFFSCREEN_RIGHT,ye.CENTER).exitingFrameTranslation(ye.CENTER,ye.OFFSCREEN_LEFT.divide(4)).exitingFrameOpacity(ye.SLIDE_BACK_FRAME_OPACITY_START,ye.SLIDE_BACK_FRAME_OPACITY_END).freeze(),ye.SLIDE_FROM_TOP=new ye().enteringFrameTranslation(ye.OFFSCREEN_TOP,ye.CENTER).exitingFrameTranslation(ye.CENTER,ye.OFFSCREEN_BOTTOM.divide(4)).exitingFrameOpacity(ye.SLIDE_BACK_FRAME_OPACITY_START,ye.SLIDE_BACK_FRAME_OPACITY_END).freeze(),ye.SLIDE_FROM_BOTTOM=new ye().enteringFrameTranslation(ye.OFFSCREEN_BOTTOM,ye.CENTER).exitingFrameTranslation(ye.CENTER,ye.OFFSCREEN_TOP.divide(4)).exitingFrameOpacity(ye.SLIDE_BACK_FRAME_OPACITY_START,ye.SLIDE_BACK_FRAME_OPACITY_END).freeze(),ye.SLIDE_OUT_TO_LEFT=ye.SLIDE_FROM_RIGHT.reversed(),ye.SLIDE_OUT_TO_RIGHT=ye.SLIDE_FROM_LEFT.reversed(),ye.SLIDE_OUT_TO_TOP=ye.SLIDE_FROM_BOTTOM.reversed(),ye.SLIDE_OUT_TO_BOTTOM=ye.SLIDE_FROM_TOP.reversed(),ye.PUSH_FROM_LEFT=new ye().enteringFrameTranslation(ye.OFFSCREEN_LEFT,ye.CENTER).exitingFrameTranslation(ye.CENTER,ye.OFFSCREEN_RIGHT).freeze(),ye.PUSH_FROM_RIGHT=ye.PUSH_FROM_LEFT.reversed(),ye.PUSH_FROM_TOP=new ye().enteringFrameTranslation(ye.OFFSCREEN_TOP,ye.CENTER).exitingFrameTranslation(ye.CENTER,ye.OFFSCREEN_BOTTOM).freeze(),ye.PUSH_FROM_BOTTOM=ye.PUSH_FROM_TOP.reversed(),ye.MOVE_FROM_LEFT=new ye().enteringFrameTranslation(ye.OFFSCREEN_LEFT,ye.CENTER).freeze(),ye.MOVE_FROM_RIGHT=new ye().enteringFrameTranslation(ye.OFFSCREEN_RIGHT,ye.CENTER).freeze(),ye.MOVE_FROM_TOP=new ye().enteringFrameTranslation(ye.OFFSCREEN_TOP,ye.CENTER).freeze(),ye.MOVE_FROM_BOTTOM=new ye().enteringFrameTranslation(ye.OFFSCREEN_BOTTOM,ye.CENTER).freeze(),ye.MOVE_OUT_TO_LEFT=ye.MOVE_FROM_RIGHT.reversed(),ye.MOVE_OUT_TO_RIGHT=ye.MOVE_FROM_LEFT.reversed(),ye.MOVE_OUT_TO_TOP=ye.MOVE_FROM_BOTTOM.reversed(),ye.MOVE_OUT_TO_BOTTOM=ye.MOVE_FROM_TOP.reversed();var Rn=ye;var Kr=(t=>(t[t.FORWARD=0]="FORWARD",t[t.REVERSE=1]="REVERSE",t))(Kr||{}),Ti=(n=>(n[n.IGNORE=0]="IGNORE",n[n.REMEMBER=1]="REMEMBER",n[n.RESET=2]="RESET",n))(Ti||{}),ql=class ql{constructor(e,t){this.hotspotStablePath=e,this.interactionId=t}};ql.EXTERNAL_INTERACTION_ID=ne._new(-1,-2),ql.EXTERNAL=new ql(null,ql.EXTERNAL_INTERACTION_ID);var Io=ql,ar=class i{static getDefault(){let e=X.getFeatureFlags().prototypeStateManagement?1:0;return new i("INSTANT_TRANSITION",0,null,!1,ve.FrozenVector_new1(),"NAVIGATE",!1,ve.FrozenVector_new1(),!1,!0,!1,!1,e)}static fromPrototypeAction(e,t){return e==null?i.getDefault():new i(e.transitionType(),e.transitionDuration(),e.easingFunction,e.transitionShouldSmartAnimate(),e.overlayRelativePosition(),e.navigationType(),e.transitionPreserveScroll(),e.extraScrollOffset(),e.transitionResetVideoPosition(),e.openUrlInNewTab(),e.transitionResetScrollPosition(),e.transitionResetInteractiveComponents(),t)}withTransitionPreserveScroll(e){return new i(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,e,this.extraScrollOffset,this.transitionResetVideoPosition,this.openUrlInNewTab,this.transitionResetScrollPosition,this.transitionResetInteractiveComponents,this.stateManagementVersion)}withDefaultStateManagementSettings(){return new i(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,!1,this.openUrlInNewTab,!1,!1,this.stateManagementVersion)}withStateManagementSettings(e){return e==null?this:new i(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,e.transitionResetVideoPosition,this.openUrlInNewTab,e.transitionResetScrollPosition,e.transitionResetInteractiveComponents,e.stateManagementVersion)}constructor(e,t,n,r,o,a,s,l,d,c,p,u,h){this.transitionType=e,this.transitionDuration=t,this.easingFunction=n,this.transitionShouldSmartAnimate=r,this.overlayRelativePosition=o,this.navigationType=a,this.transitionPreserveScroll=s,this.extraScrollOffset=l,this.transitionResetVideoPosition=d,this.openUrlInNewTab=c,this.transitionResetScrollPosition=p,this.transitionResetInteractiveComponents=u,this.stateManagementVersion=h}},Cn=class{topId(){return this.overlays.length>0?ce.List_last(this.overlays).id:this.stateId}debugString(e){let t=o=>{var l;let a=e.findNode1(o);return`[nodeId.toString]: ${(l=a==null?void 0:a.name())!=null?l:"null"}`},n="  ",r="[";for(let o=0,a=this.overlays.length;o<a;o=o+1){let s=this.overlays[o];r+=n+t(s.id),o!=this.overlays.length-1&&(r+=`,
`)}return r+="]",`PresentedState(
`+n+t(this.stateId)+`
`+n+`,
`+n+r+`
)`}statesAndOverlaysIncluded(){let e=new Cr;this.stateId!=null&&ne.isValid(this.stateId)&&e.add(this.stateId);for(let t of this.overlays.slice())ne.isValid(t.id)&&e.add(t.id);return e}constructor(e,t){this.stateId=e,this.overlays=t}},Zn=class i{constructor(){if(arguments[0]==0){let[,e]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=ar.getDefault(),this.interactionAddress=Io.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new Cn(null,[]),this.newStateAndOverlays=new Cn(null,[])}else if(arguments[0]==1){let[,e,t,n]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=ar.getDefault(),this.interactionAddress=Io.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=n}else if(arguments[0]==2){let[,e,t,n,r,o,a,s]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=ar.getDefault(),this.interactionAddress=Io.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new Cn(t,[]),this.newStateAndOverlays=new Cn(n,[]),this.direction=0,this.cause=s,this.interactionAddress=r,this.transitionParameters=a,this.canvasSpaceTriggerBoundsOrNull=o}else if(arguments[0]==3){let[,e,t,n,r,o,a,s,l]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=ar.getDefault(),this.interactionAddress=Io.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=n,this.direction=s,this.cause=l,this.interactionAddress=r,this.transitionParameters=a,this.canvasSpaceTriggerBoundsOrNull=o}else if(arguments[0]==4){let[,e,t,n,r,o,a,s]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=ar.getDefault(),this.interactionAddress=Io.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=n,this.interactionAddress=o,this.direction=a,this.transitionParameters=s,this.cause=r}}static forClosingTopNOverlays(e,t,n,r,o,a){let l=n[n.length-e].openingTransition.withTransitionPreserveScroll(!0).withDefaultStateManagementSettings();return new i(3,ko.ROOT_STABLE_PATH(),new Cn(t,n),new Cn(t,n.slice().slice(0,n.length-e)),r,o,l,1,a)}oldStateId(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.stateId}newStateId(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.stateId}oldOverlayData(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.overlays}newOverlayData(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.overlays}oldOverlays(e){var t;return e.bindOverlays((t=this.oldStateAndOverlays)==null?void 0:t.overlays)}newOverlays(e){var t;return e.bindOverlays((t=this.newStateAndOverlays)==null?void 0:t.overlays)}isTransientChange(){let e=ne.equals(this.oldStateAndOverlays.stateId,this.newStateAndOverlays.stateId);switch(this.transitionParameters.navigationType){case"OVERLAY":case"SWAP":case"SCROLL_TO":return!0;default:break}return Kt.TransitionAction_isTransientAction(this.cause)||e}debugString(e){var t,n;return`${(t=this.oldStateAndOverlays)==null?void 0:t.debugString(e)}
=>
${(n=this.newStateAndOverlays)==null?void 0:n.debugString(e)}`}easingFunction(){return this.transitionParameters.easingFunction}preserveScroll(){return this.transitionParameters.transitionPreserveScroll?1:0}resetScroll(){return this.transitionParameters.transitionResetScrollPosition?0:1}resetInteractiveComponents(){return this.transitionParameters.transitionResetInteractiveComponents?0:1}stateManagementVersion(){return this.transitionParameters.stateManagementVersion}getFramePairTransition(){let e=Rn.get(this.transitionParameters.transitionType);return this.direction==1?e.reversed():e}getNewOrChangedFrameIds(){let e=[];!ne.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.newStateId());for(let t=0,n=this.newOverlayData().length;t<n;t=t+1)(t>=this.oldOverlayData().length||!ne.equals(this.oldOverlayData()[t].id,this.newOverlayData()[t].id))&&e.push(this.newOverlayData()[t].id);return e}getInsertedFrameIds(){let e=[];!ne.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.newStateId());let t=new Cr;this.oldOverlayData().forEach(n=>{t.add(n.id)});for(let n=0,r=this.newOverlayData().length;n<r;n=n+1){let o=this.newOverlayData()[n].id;t._in(o)||e.push(o)}return e}getRemovedFrameIds(){let e=[];!ne.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.oldStateId());let t=new Cr;this.newOverlayData().forEach(n=>{t.add(n.id)});for(let n=0,r=this.oldOverlayData().length;n<r;n=n+1){let o=this.oldOverlayData()[n].id;t._in(o)||e.push(o)}return e}},Qr=class i{static getDefaultExternalExecution(){return new i(Io.EXTERNAL,ar.getDefault(),null)}static forNoodle(e,t,n){let r=new Io(i.stablePathForHotspot(e),t.id()),o=t.action().value;if(n!=null)o=n;else for(let l of t.getAllValidTransitionActionsInInteraction()){o=l;break}let a=ar.fromPrototypeAction(o,X.getFeatureFlags().prototypeStateManagement?t.stateManagementVersion():0),s=t.event().interactionType()=="ON_HOVER"?e.canvasSpaceInteractiveBounds():null;return new i(r,a,s)}static forExternalOpenOverlay(e){let t=new Io(i.stablePathForHotspot(e),ne._new(-1,-2));return new i(t,ar.getDefault(),null)}static stablePathForHotspot(e){let t=null;return t=e.stablePath(),t}constructor(e,t,n){this.interactionAddress=e,this.transitionParameters=t,this.canvasSpaceTriggerBoundsOrNull=n}},DI;(e=>{function i(t){return Kr[t]}e.TransitionDirection_toString=i})(DI||(DI={}));var MI;(e=>{function i(t){return Ti[t]}e.HistoryPolicy_toString=i})(MI||(MI={}));var ks;(n=>{let i=()=>null;function e(r){r&&(i=r)}n.initialize=e;function t(r){return i(r)}n.getStatsigExpConfig=t})(ks||(ks={}));var On=class On{_initializeExperimentParams(){let e={max_distance:On.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH,infinite_count:!1,infinite_distance:!1};if(!Xe.isCurrentOSMobileOrIPad()){let t=ks.getStatsigExpConfig("exp_ifl_preload_distance_increase");t&&(e.max_distance=t.getValue("max_distance",On.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH),e.infinite_count=t.getValue("infinite_count",!1),e.infinite_distance=t.getValue("infinite_distance",!1))}return e}static logVerbose(e){On.VERBOSE_LOGS&&console.log("[IncrementalFrameLoader]",e())}static MAX_SLIDESHOW_PRELOAD_DISTANCE(){return X.protoPreloadMore()?3:2}constructor(e,t){this._multiplayer=null,this._appState=null,this._emitter=null,this._canvas=null,this._currentQueries=new Ii,this._previousSceneGraphReply=new Ii,this._rootLevelSceneGraphQuery=$n.create(ne._new(0,0),1),this._requestSectionsOnCanvas=!1,this._requestedTlfIds=new Cr,this._currentTlfIds=[],this._requestedSectionsQueue=[],this._bfsOrderWorkingSet=[],this._pendingNodeToRequest=null,this._multiplayer=t,this._multiplayer.addObserver(this),this._appState=e,e.addAppObserver(this),e.prototypeState().addObserver(this),this._emitter=$t.getEventEmitter(),this._emitter.on("Slow incremental load",n=>{Be.trackEventJSON1("Slow incremental load",n)}),this._iflExperimentParameters=this._initializeExperimentParams(),console.debug("Using incremental frame loading")}simulateRepliedQueriesForTests(e){this._currentQueries=Ii.fromList(e),this.handleSceneGraphReply(0,e)}requestTlf(e){return this._setCurrentTlfIds([e]),this._isFullyLoaded(e)?!0:(this._requestedTlfIds.add(e),this._redeferUpdate(0),!1)}_setCurrentTlfIds(e){this._currentTlfIds=e}_requestTlfs(e){this._setCurrentTlfIds(e);for(let t of e){if(this._isFullyLoaded(t)){this._appState.requestedFrameMetricsTracker().track(t,{wasAlreadyLoaded:!0,wasAlreadyInWorkingSet:!0});continue}else{let n={wasAlreadyLoaded:!1,wasAlreadyInWorkingSet:!1};for(let r of this._bfsOrderWorkingSet)if(r.nodeId==t){n.wasAlreadyInWorkingSet=!0;break}this._appState.requestedFrameMetricsTracker().track(t,n)}this._requestedTlfIds.add(t),this._redeferUpdate(0)}}_isFullyLoaded(e){var r;let t=(r=this._multiplayer.scene())==null?void 0:r.findNode1(e);if(t==null)return!1;let n=t;for(;n!=null;){if(this._previousSceneGraphReply.containsExactQuery($n.create(n.id(),0)))return!0;n=n.parent()}return!1}_isQueryPresent(e,t){for(let n of t)if(Rr.equals(n,e))return!0;return!1}_getQueriesToLoad(){let e=new Ii;return this._requestSectionsOnCanvas&&(this._getSectionSceneGraphQueriesGivenNode(this._canvas).each(n=>{e.add(n)}),this._requestSectionsOnCanvas=!1),this._addRequestedTlfs(e),this._appState.scene()!=null&&this._addScreenAdjacencies(e),e}_getSectionSceneGraphQueriesGivenNode(e){let t=new Ii;if(this._multiplayer.scene()!=null){if(e==null||e.type()!="DOCUMENT"&&e.type()!="CANVAS"&&e.type()!="SECTION")return t;be.forEachNode2(e,n=>{if(n.type()=="SECTION"){Be.trackDefinedEvent("prototype.ifl_section_infinite_query",new Map);let r=$n.create(n.id(),0);t.add(r)}})}return t}_getSectionSceneGraphQueries(){var n;let e=new Ii,t=[];if(this._multiplayer.scene()!=null){for(;this._requestedSectionsQueue.length!=0;){let r=this._requestedSectionsQueue.shift(),o=(n=this._multiplayer.scene())==null?void 0:n.findNode1(r);o==null||o.type()!="DOCUMENT"&&o.type()!="CANVAS"&&o.type()!="SECTION"||be.forEachNode2(o,a=>{if(a.id()!=o.id()&&a.type()=="SECTION"){let s=$n.create(a.id(),1);e.add(s),t.push(a.id())}})}this._requestedSectionsQueue=t}return e}_addRequestedTlfs(e){var t;On.logVerbose(()=>"Visiting requestedTlfs for next queries:"+this._requestedTlfIds.asList().map(n=>Wn.string_toString(n)).join(","));for(let n of this._requestedTlfIds.asList()){let r=ne.fromString(n);if(r==null)continue;if(!this._previousSceneGraphReply.containsNodeById(r)){e.add($n.create(r,1));continue}let a=(t=this._multiplayer.scene())==null?void 0:t.findNode1(r);if(this._requestedTlfIds.remove(r),a==null){let s=ne._new(0,0);e.add($n.create(s,1)),this._requestedTlfIds.add(s)}else if(a.type()=="DOCUMENT"){this._emitter.trigger("redirectingToFirstPageDueToInvalidStartNode",null);let s=this._multiplayer.scene().firstUserCanvasOrNull();if(s==null){console.error("No user-visible canvases");continue}this._requestedTlfIds.add(s.id()),e.add($n.create(s.id(),1))}else if(a.type()=="CANVAS"){let s=!1,l=this._getSectionSceneGraphQueriesGivenNode(a);s=l.count()>0,l.each(c=>{e.add(c)});let d=this._appState.prototypeStructure().nodeToRestartPrototypeOn(a);if(d==null){s||console.error("No top-level frames present");continue}this._requestedTlfIds.add(d.id()),e.add($n.create(d.id(),0)),this._setCurrentTlfIds([d.id()])}else{for(;a!=null&&!a.isTopLevel();)a=a.parent();a!=null&&(e.add($n.create(a.id(),0)),this._canvas=a.findContainingCanvasOrParent(),e.add($n.create(this._canvas.id(),1)),this._getSectionSceneGraphQueriesGivenNode(this._canvas).each(l=>{e.add(l)}),this._requestSectionsOnCanvas=!0)}}}_addScreenAdjacencies(e){X.getViewerMode()==X.ViewerMode.PROTOTYPE&&this._appState.prototypeStructure().currentType()==1?this._addScreenAdjacenciesForSlideshow(e):this._addScreenAdjacenciesForPrototype(e)}_getMaxBFSDistance(){return this._iflExperimentParameters?this._iflExperimentParameters.infinite_distance?Number.MAX_VALUE:this._iflExperimentParameters.max_distance:On.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH}_visitedCountWithinMaxCount(e){return this._iflExperimentParameters&&this._iflExperimentParameters.infinite_count?!0:e<On.MAX_PROTOTYPE_BFS_COUNT}_addScreenAdjacenciesForSlideshow(e){let t=Wt.visuallySortedTopLevelFrames(this._appState.getActiveCanvas()),n=t.map(o=>o.id());if(this._currentTlfIds.length==0||!ne.isValid(this._currentTlfIds[0]))return;let r=n.indexOf(this._currentTlfIds[0]);if(!(r<0)){for(let o=r-On.MAX_SLIDESHOW_PRELOAD_DISTANCE(),a=r+On.MAX_SLIDESHOW_PRELOAD_DISTANCE()+1;o<a;o=o+1)o>=0&&o<t.length&&e.add($n.create(t[o].id(),0));if(this._currentTlfIds.length>1)for(let o=1,a=this._currentTlfIds.length;o<a;o=o+1)ne.isValid(this._currentTlfIds[o])&&e.add($n.create(this._currentTlfIds[o],0))}}_addScreenAdjacenciesForPrototype(e){if(this._currentTlfIds.length==0||!ne.isValid(this._currentTlfIds[0]))return;let t=new On.Queue;for(let l=this._currentTlfIds.length-1;l>=0;l=l-1)t.pushBackIfUnseen(this._currentTlfIds[l],0);let n=0;this._bfsOrderWorkingSet=[];let r=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF();for(;t.nonempty()&&(t.front().depth<=1||this._visitedCountWithinMaxCount(n));){let l=t.popFront(),d=l.guid,c=this._previousSceneGraphReply.containsExactQuery($n.create(d,0));this._bfsOrderWorkingSet.push(new On.WorkingSetItem(d,c));let p=this._appState.scene().findNode1(d);if(p==null||(l.depth>0&&(n=n+1),l.depth>=this._getMaxBFSDistance()))continue;let u=Wt.adjacentBaseScreens(r,p);be.forEachNode2(p,h=>{var f;(f=h.prototypeInteractions())==null||f.forEach(_=>{for(let m of _.allActions())if(ne.isValid(m.transitionNodeID())&&u.add(m.transitionNodeID()),m.connectionType()=="BACK"){let A=this._appState.prototypeState().getLastChangeInHistory();A!=null&&A.getRemovedFrameIds().forEach(y=>{y!=null&&u.add(y)})}}),X.getFeatureFlags().iflEnhancements&&Wt.isNodeInteractableBecauseOfHyperlinks(h)&&h.textHyperlinkBoxes().forEach(_=>{_.guid&&u.add(ne.fromFigGUID(_.guid))})});for(let h of u.asList())t.pushBackIfUnseen(h,l.depth+1)}let o=this._appState.prototypeState().getInitiatedChange();if(o!=null)for(let l of o.oldStateAndOverlays.statesAndOverlaysIncluded().asList()){let d=ne.fromString(l);this._bfsOrderWorkingSet.unshift(new On.WorkingSetItem(d,this._previousSceneGraphReply.containsExactQuery($n.create(d,0))))}Mn.track2("[IFL] Working set size",this._bfsOrderWorkingSet.length);let a=0,s=0;for(let l of this._bfsOrderWorkingSet)if(e.add($n.create(l.nodeId,0)),l.isAlreadySubscribed?s=s+1:a=a+1,a>=On.MAX_PROTOTYPE_TLF_BATCH_SIZE)break;Mn.track2("[IFL] Working set frames loaded",s)}getMetricsForNode(e){return this._appState.requestedFrameMetricsTracker().getMetricsForRequestedNode(e.id())}_requestNextQueriesToLoad(e){if(e.add(this._rootLevelSceneGraphQuery),e.equals(this._currentQueries))return;X.protoUseFrameEviction()?(this._multiplayer.scene()!=null&&this._currentQueries.each(n=>{let r=this._multiplayer.scene().findNode2(Us.toString(n.startingNode));r!=null&&(r.type()=="DOCUMENT"||r.type()=="CANVAS"||r.type()=="SECTION")&&e.add(n)}),this._currentQueries=e):e.each(n=>{this._currentQueries.add(n)});let t=[];for(let n of this._currentQueries.asList())t.push(n);On.logVerbose(()=>"setting scene graph queries:"+t.map(n=>Rr.toString(n)).join(",")),this._multiplayer.setSceneGraphQueries(t)}_redeferUpdate(e){this._deferredUpdate!==void 0?this._deferredUpdate.redefer(e):this._deferredUpdate=new wd(()=>{On.logVerbose(()=>`update............
`+(On.VERBOSE_LOGS_SHOW_SCENEGRAPH?this._multiplayer.scene().root().hierarchyString():"")),this._requestNextQueriesToLoad(this._getQueriesToLoad()),this._deferredUpdate=void 0},e)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._redeferUpdate(0)}handleActiveCanvasChange(e,t){this._redeferUpdate(0)}handleActivePrototypeStartingPointChange(e,t){}handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){this._redeferUpdate(0)}handleStateChangeRequested(e){let t=e.newStateAndOverlays.statesAndOverlaysIncluded(),n=[];for(let r of t.asList())n.push(ne.fromString(r));this._requestTlfs(n)}handleFitModeChange(e,t){}handleRestartPrototype(){}handleConnect(e,t){e==0&&(this._previousSceneGraphReply=new Ii,this._currentQueries=new Ii,this._redeferUpdate(0),X.getViewerMode()==X.ViewerMode.PROTOTYPE&&t==null&&(t=ne._new(0,0)),t!=null&&(this._pendingNodeToRequest=t))}handleDisconnect(){}handleJoinStart(e,t,n){this._pendingNodeToRequest!=null&&this.requestTlf(this._pendingNodeToRequest),this._pendingNodeToRequest=null}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){}handleSceneChangedLoadingPhase(e,t){}handleSceneGraphReply(e,t){Be.handleMultiplayerFirstResponse(),On.logVerbose(()=>{let o="";return o+=`
-----handleSceneGraphReply-----
`,o+="sceneGraphQueries:"+t.map(a=>Rr.toString(a)).join(",")+`
`,On.VERBOSE_LOGS_SHOW_SCENEGRAPH&&(o+=this._multiplayer.scene().root().hierarchyString()+`
`),o+="-----------------------------------",o}),this._previousSceneGraphReply=Ii.fromList(t);let n=this._getQueriesToLoad();n.isSubsetOf(this._previousSceneGraphReply)?(Be.handleMultiplayerIFLSatisfied(),On.logVerbose(()=>"All queries satisfied! Calling finishIncrementalLoading..."),this._multiplayer.finishIncrementalLoading(),Be.handleIFLCompleted()):this._requestNextQueriesToLoad(n)}handleSceneGraphEvent(e){if(io.isPrototypeStructuralChange(e.property)){if(e.node.type()=="SECTION"&&e.property==25&&(this._requestSectionsOnCanvas=!0),this._deferredUpdate!=null&&this._deferredUpdate.delayMs==0)return;this._redeferUpdate(na||kr?0:250)}}};On.VERBOSE_LOGS=!1,On.VERBOSE_LOGS_SHOW_SCENEGRAPH=!1,On.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH=2,On.MAX_PROTOTYPE_BFS_COUNT=4,On.MAX_PROTOTYPE_TLF_BATCH_SIZE=4;var qa=On;(n=>{class i{constructor(o,a){this.guid=o,this.depth=a}}n.Entry=i;class e{constructor(o,a){this.nodeId=o,this.isAlreadySubscribed=a}}n.WorkingSetItem=e;class t{nonempty(){return this._queue.length>0}pushBackIfUnseen(o,a){this._seen.has(o)||(this._seen.set(o,!0),this._queue.push(new n.Entry(o,a)))}front(){return this._queue[0]}popFront(){return this._queue.shift()}constructor(){this._queue=[],this._seen=new Map}}n.Queue=t})(qa||(qa={}));var Ii=class i{add(e){let t=Rr.nodeIdString(e);if(!this._hash.has(t))this._hash.set(t,e);else{let n=this._hash.get(t);if(n.depth==0)return;(e.depth==0||e.depth>n.depth)&&this._hash.set(t,e)}}containsNodeById(e){return e!=null&&this._hash.has(e)}containsExactQuery(e){return this.containsNodeById(ne.fromFigGUID(e.startingNode))?this._hash.get(Rr.nodeIdString(e)).depth==e.depth:!1}remove(e){this._hash.delete(Rr.hash(e))}count(){return this._hash.size}asList(){return Array.from(this._hash.values())}each(e){Array.from(this._hash.values()).forEach(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of Array.from(this._hash.values()))if(!e.containsExactQuery(t))return!1;return!0}isSubsetOf(e){if(e==null||this.count()>e.count())return!1;for(let t of Array.from(this._hash.values()))if(!e.containsExactQuery(t))return!1;return!0}toJSObject(){return Le.StringMap_toJSObject(this._hash)}static fromList(e){let t=new i;for(let n of e)t.add(n);return t}constructor(){this._hash=new Map}},vo=class vo{constructor(e,t){this.complete=()=>{let e=this._executionTime-Date.now();e<=0||2==0?this.callback():this._timeoutID=vo._setTimeout(this.complete,e)};this.delayMs=t,this.callback=e,this._timeoutID=vo._setTimeout(this.complete,t),this._executionTime=Date.now()+t}redefer(e){this._executionTime=Date.now()+e}cancel(){vo._clearTimeout(this._timeoutID)}static _setTimeout(e,t){if(2==0){let n=(vo._nextMockTimeoutID=vo._nextMockTimeoutID+1)+-1;return vo._mockTimeouts.set(n,e),n}else return setTimeout(e,t)}static _clearTimeout(e){2==0?vo._mockTimeouts.delete(e):clearTimeout(e)}static fireAllMockedTimeouts(){let e=Array.from(vo._mockTimeouts.keys());for(let t of e)vo._mockTimeouts.get(t)(),vo._mockTimeouts.delete(t)}};vo._nextMockTimeoutID=1,vo._mockTimeouts=new Map;var wd=vo;var Nd=class Nd{age(){return fn.Math_clamp1((Qe.seconds()-this.startTimestamp)/Nd.LIFETIME,0,1)}constructor(e,t,n){this.sessionID=e,this.canvasSpaceLocation=t,this.startTimestamp=n}};Nd.LIFETIME=.25,Nd.RADIUS=25;var Yl=Nd,rh=class{constructor(e,t){this.nodeId=e,this.offset=t}},Gf=class{remainingParticles(){let e=Qe.seconds(),t=null;return this.particles!=null&&ce.List_removeIf(this.particles,n=>e-n.startTimestamp>Yl.LIFETIME?!0:(t==null&&(t=[]),t.push(n),!1)),t}toJSON(){return{sessionID:this.sessionID,userID:this.userID,name:this.name,color:this.color!=C.TRANSPARENT?C.toCSS(this.color):null,imageURL:this.imageURL,deviceName:this.deviceName,currentFrame:this.currentFrame!=null?this.currentFrame:null}}constructor(e){this.sessionID=e,this.userID=null,this.name=null,this.color=C.TRANSPARENT,this.imageURL=null,this.deviceName=null,this.currentFrame=null,this.canvasSpaceMouse=null,this.largestClickID=-1,this.particles=null,this.scrollPositions=new Map,this.observedSessions=[],this.lastTriggeredHotspot=null,this.lastTriggeredPrototypeInteractionID=null,this.triggeredOverlaysData=[],this.instanceStateChanges=[],this.triggeredSetVariableActionData=[],this.videoStateChangeData=[]}},Rd=class{userBySessionID(){return this._userBySessionID}handleUserChanges(e,t){if(e.userChanges===void 0){console.error("decoded node change message with missing required field: 'userChanges'");return}let n=!1,r=0;for(let o of e.userChanges){if(o.sessionID===void 0){Ke("skipping user change message without sessionID");continue}r=o.sessionID;let a=ma.debugUserChanges&&t!=null&&r!=t.sessionID();o.connected!==void 0&&(o.connected?(this._userBySessionID.set(r,new Gf(r)),a&&console.log(`user sessionID ${r} connected`,this._userBySessionID.get(r).toJSON()),t!=null&&(t.pushAllInstanceStateChanges(),t.pushAllSetVariableActions(),t.pushAllVideoStateChanges())):(a&&this._userBySessionID.has(r)&&console.log(`user sessionID ${r} disconnected`,this._userBySessionID.get(r).toJSON()),t!=null&&t.removeNominator(r),this._userBySessionID.delete(r)),n=!0);let s=qt.IntMap_get(this._userBySessionID,r,null);s!=null?(n=this._applyChangeToUser(o,s,a)||n,this._applyNullChecksToUserStrings(s)):a&&Ke("could not find existing user to apply user change message"),a&&console.log("recvUserChange",o,n)}n&&this.onChange!=null&&this.onChange(r)}_applyNullChecksToUserStrings(e){e.userID==null&&(e.userID=""),e.name==null&&(e.name=""),e.imageURL==null&&(e.imageURL="")}_applyChangeToUser(e,t,n){let r=!1,o=e.sessionID;if(e.color!==void 0&&(t.color=gt.decodeColor(e.color),r=!0),e.name!==void 0&&(t.name=e.name,r=!0),e.deviceName!==void 0&&(t.deviceName=e.deviceName,r=!0),e.imageURL!==void 0&&(t.imageURL=e.imageURL,r=!0),e.userID!==void 0&&(t.userID=e.userID,r=!0),e.observing!==void 0&&(t.observedSessions=e.observing,r=!0),e.selection!==void 0){let a=e.selection;t.currentFrame=a.length==1?gt.decodeGUID(a[0]):null,r=!0}if(e.mouse!==void 0){let a=e.mouse;if(a.canvasSpaceLocation!==void 0){let s=gt.decodeVector(a.canvasSpaceLocation);(t.canvasSpaceMouse==null||!t.canvasSpaceMouse.equals(s))&&(t.canvasSpaceMouse=s.equals(s)?s:null,this.onMouseCursorChange!=null&&this.onMouseCursorChange(o))}}if(e.recentClicks!==void 0)if(t.particles==null){t.particles=[];for(let a of e.recentClicks)a.id>t.largestClickID&&(t.largestClickID=a.id)}else for(let a of e.recentClicks)a.id>t.largestClickID&&(t.largestClickID=a.id,t.particles.push(new Yl(o,gt.decodeVector(a.point),Qe.seconds())),this.onMouseCursorChange!=null&&this.onMouseCursorChange(o));if(e.scrollPositions!==void 0)for(let a of e.scrollPositions)t.scrollPositions.set(gt.decodeGUID_instanceHACK(a.node),gt.decodeVector(a.scrollOffset));return e.lastTriggeredHotspot!==void 0&&(t.lastTriggeredHotspot=gt.decodeGUID_instanceHACK(e.lastTriggeredHotspot),r=!0),e.lastTriggeredPrototypeInteractionID!==void 0&&(t.lastTriggeredPrototypeInteractionID=gt.decodeGUID(e.lastTriggeredPrototypeInteractionID),r=!0),e.triggeredOverlaysData!==void 0&&(t.triggeredOverlaysData=e.triggeredOverlaysData.slice(),r=!0),e.instanceStateChanges!==void 0&&(e.instanceStateChanges.forEach(a=>{t.instanceStateChanges.push(a)}),r=!0),e.triggeredSetVariableActionData!==void 0&&(t.triggeredSetVariableActionData=e.triggeredSetVariableActionData.slice(),r=!0),e.videoStateChangeData!==void 0&&(t.videoStateChangeData=e.videoStateChangeData.slice(),r=!0),n&&console.log("_applyChangeToUser",e,t.toJSON()),r}constructor(){this._sessionID=-1,this._userBySessionID=new Map,this.onChange=null,this.onMouseCursorChange=null}};var oh=class{version(){return mpGlobal.version}sock(){return mpGlobal.sock!=null?new Cd(0,mpGlobal.sock):null}setSock(e){if(e!=null){let t=e.asHTMLSocket();t==null&&console.warn("Ignoring invalid socket binding for mpGlobal"),mpGlobal.sock=t.ws}else mpGlobal.sock=null}msgs(){return mpGlobal.msgs}setMsgs(e){mpGlobal.msgs=e}perfMetrics(){return mpGlobal.perfMetrics}setPerfMetrics(e){mpGlobal.perfMetrics=e}url(e){return mpGlobal.url(e)}preconnect(e){mpGlobal.preconnect(e)}newSocket(e){return new Cd(1,e)}constructor(){}},Hf=class i{static attemptToParseFrom(e){try{let t=JSON.parse(e);return new i(t.url,t.type)}catch{Ke("Failed to parse TooManyConnectionsPayload")}return null}constructor(e,t){this.url=e,this.type=t}},sh=(t=>(t[t.FLUSH_AT_NEXT_INTERVAL=0]="FLUSH_AT_NEXT_INTERVAL",t[t.FORCE_FLUSH=1]="FORCE_FLUSH",t))(sh||{}),sr=class sr{static hasPrefix(e,t){if(e.length>=t.length){for(let n=0,r=t.length;n<r;n=n+1)if(e[n]!=t.charCodeAt(n))return!1;return!0}return!1}constructor(e,t,n){this._appState=null,this._isWindowActive=null,this._emitter=null,this._mpContext=null,this._incrementalLoader=null,this._role="viewer",this._scene=null,this._userSyncing=null,this._heartbeatTimeout=0,this._consecutiveFailedConnectionAttempts=0,this._attemptsSinceLastConnectionSuccess=0,this._hasConnectedAtLeastOnce=!1,this._onlineChangeHandler=null,this._reconnectionTimeout=0,this._isConnected=!1,this._isJoined=!1,this._shouldReconnect=!0,this._socket=null,this._url=null,this._fileKey=null,this._oauthToken=null,this._nodeId=null,this._partialSnapshotInfo=new ih(null,null,null),this._reconnectKey=null,this._previousTlfID=null,this._previousCanvasSpaceMouseLocation=null,this._sessionID=0,this._observingSessionID=-1,this._presenterSessionID=null,this._sessionsNominatingCurrentUser=new Set,this._sessionNominatedByCurrentUser=null,this._cachedNextUserChange=null,this._canvasSpaceClicks=[],this._nextCanvasSpaceClickID=0,this._pendingSceneGraphQueriesOrNull=null,this._lastSceneGraphQueryTime=0,this._lastSceneGraphQueryConcurrency=0,this._lastSentSceneGraphQueriesOrNull=null,this._observers=new nr,this._sceneLoadingPhase=0,this._prototypeLibCppEnabledForPendingFile=1,this._connectType=0,this._sessionSchema=null,this._staticFileRequest=null,this.maxScrollPositionsToStore=10,this._recentlyChangedScrollPositions=[],this._lastFlush=-1,this._appState=e,this._isWindowActive=t,this._emitter=$t.getEventEmitter(),this._appState.addAppObserver(this),e.prototypeState().addObserver(this),e.prototypeState().addHsmObserver(this),this._mpContext=n,this._incrementalLoader=new qa(this._appState,this)}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}fileKey(){return this._fileKey}observingSessionID(){return this._observingSessionID}setObservingSessionID(e){this._observingSessionID=e,this._getOrCreateNextUserChange().observing=[e]}observedUser(){return this._userSyncing!=null?qt.IntMap_get(this._userSyncing.userBySessionID(),this._observingSessionID,null):null}isObserving(){return this.observingSessionID()!=-1}presenterSessionID(){return this._presenterSessionID}removeNominator(e){this._sessionsNominatingCurrentUser.delete(e)}sessionsNominatingCurrentUser(){return Array.from(this._sessionsNominatingCurrentUser.values())}sessionNominatedByCurrentUser(){return this._sessionNominatedByCurrentUser}setPresenterSessionID(e){this._presenterSessionID=e}scene(){return this._scene}incrementalLoader(){return this._incrementalLoader}socketForTesting(){var e;return(e=this._socket)==null?void 0:e.asMockSocket()}setMultiplayerUserSyncing(e){this._userSyncing=e}setScene(e){this._scene=e}isConnected(){return this._isConnected}fulfilledMultiplayerQueries(){return this._partialSnapshotInfo.fulfilledQueries}_setSceneLoadingPhase(e){let t=this._sceneLoadingPhase;switch(this._sceneLoadingPhase=e,t!=e&&this._observers.forEach(n=>{n.handleSceneChangedLoadingPhase(t,e)}),e){case 0:break;case 1:{console.log("sceneWillRebuildAfterReconnecting"),this._emitter.trigger("sceneWillRebuildAfterReconnecting",null);break}case 2:{t==0?this._appState.fontListPromise().then(n=>{console.debug("sceneDidCompleteInitialLoad"),this._emitter.trigger("sceneDidCompleteInitialLoad",null)}):t==1&&(console.log("sceneDidRebuildAfterReconnecting"),this._emitter.trigger("sceneDidRebuildAfterReconnecting",null)),this._socket!=null&&this._sendSignal("client-rendered","");break}}}setNodeLoadedStatusesAndUpdate(e){this._setCanvasLoadedStatuses(e),this._setTlfLoadedStatuses(e),this._appState.prototypeState().tryToInitiateRequestedStateChange(ko.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED),this._appState.trySettingRequestedActiveCanvas()}_setCanvasLoadedStatuses(e){this.scene().root().forEachChild(t=>{t.type()!="CANVAS"||t.isInternalOnly()||(e==null||e.some(n=>Rr.fullyLoadsNode(n,t)))&&t.setHasBeenLoaded(!0)})}_setTlfLoadedStatuses(e){var r,o,a;let t=0,n=0;sr.VERBOSE&&(console.log("-----------_setTlfLoadedStatuses-----------"),((r=this.scene())==null?void 0:r.root())!=null&&this.scene().root().forEachChild(s=>{s.forEachChild(l=>{l.hasBeenLoaded()&&(t=t+1)})})),this.scene().setTlfsLoaded(s=>e==null||e.some(l=>Rr.fullyLoadsNode(l,s))),sr.VERBOSE&&(((o=this.scene())==null?void 0:o.root())!=null&&this.scene().root().forEachChild(s=>{s.forEachChild(l=>{l.hasBeenLoaded()&&(n=n+1)})}),console.log(`\u{1F69A} numLoaded ${n-t} (${t} -> ${n})`),console.log("--------------------------------------------")),(a=L._prototypeLib)==null||a.applyExistingVariableChangesToIFLLoadedNodes()}_finishLoadingIfNecessary(){var t;if(this._sceneLoadingPhase==2)return;this._appState.setCurrentFileKey(this._fileKey),this._appState.setScene(this._scene);let e=null;if(this._nodeId!=null){let n=this._appState.scene().findNode1(this._nodeId),r=n==null?void 0:n.findContainingCanvasOrSelf();r!=null&&this._appState.setActiveCanvas(r),e=(t=this._appState.prototypeStructure())==null?void 0:t.validDestinationForPrototypeFromId(this._nodeId)}e!=null?this._appState.prototypeState().navigateToFrameAndCloseOverlays1(e.id()):this._appState.prototypeState().restartPrototype(0),X.getFeatureFlags().prototypeIflDelaySceneLoad?this._scene.isLoadedTlfsEmpty()||this._setSceneLoadingPhase(2):this._setSceneLoadingPhase(2)}finishIncrementalLoading(){this._finishLoadingIfNecessary(),this._emitter.trigger("incrementalLoadingInfo",{type:"finishIncrementalLoading",fileKey:this._fileKey})}sessionID(){return this._sessionID}role(){return this._role}setRole(e){this._role=e}currentSceneGraphQueries(){return this._pendingSceneGraphQueriesOrNull!=null?this._pendingSceneGraphQueriesOrNull:this._lastSentSceneGraphQueriesOrNull!=null?this._lastSentSceneGraphQueriesOrNull:[]}connectTo(e,t,n,r){this._connectTo(e,0,t,n,r)}attemptReconnect(){var t,n;if(this._scene==null||this._sceneLoadingPhase==0){this._scene!=null&&this._sceneLoadingPhase==0&&Be.trackEvent1("Viewer reconnected during initial load",new Map),this._connectTo(this._fileKey,0,this._nodeId,this._oauthToken,this._prototypeLibCppEnabledForPendingFile);return}let e=(n=this._appState.baseScreenId())!=null?n:(t=this._appState.getActiveCanvas())==null?void 0:t.id();this._connectTo(this._fileKey,1,e,this._oauthToken,this._prototypeLibCppEnabledForPendingFile)}_connectTo(e,t,n,r,o){this._attemptsSinceLastConnectionSuccess=this._attemptsSinceLastConnectionSuccess+1,Be.handleMultiplayerOpenConnection(),this.disconnect(),this._fileKey=e,this._connectType=t,this._oauthToken=r,this._nodeId=n,this._prototypeLibCppEnabledForPendingFile=o,this._staticFileRequest!=null&&(this._staticFileRequest.cancel(),this._staticFileRequest=null);let a="";switch(t){case 0:{a="initial-load",this._lastSentSceneGraphQueriesOrNull=null,this._pendingSceneGraphQueriesOrNull=null,this._partialSnapshotInfo=new ih(null,null,null);break}case 1:{a="reconnect",this._pendingSceneGraphQueriesOrNull==null&&this._lastSentSceneGraphQueriesOrNull!=null&&(this._pendingSceneGraphQueriesOrNull=this._lastSentSceneGraphQueriesOrNull,this._lastSentSceneGraphQueriesOrNull=null);break}}let s=this._mpContext.url({fileKey:e,role:this._role,oauthToken:r,connectionType:a}),l=this._partialSnapshotInfo.isValid()&&this._pendingSceneGraphQueriesOrNull!=null&&this._queriesAreEqual(this._partialSnapshotInfo.fulfilledQueries,this._pendingSceneGraphQueriesOrNull);if(this._scene!=null&&l){this._partialSnapshotInfo.snapshotHash!=null&&(s+=`&snapshot-hash=${encodeURIComponent(this._partialSnapshotInfo.snapshotHash)}`),this._partialSnapshotInfo.reconnectSequenceNumber!=null&&(s+=`&reconnect-sequence-number=${encodeURIComponent(this._partialSnapshotInfo.reconnectSequenceNumber.value.toString())}`);let _=encodeURIComponent($n.serializeListForMultiplayerURL(this._pendingSceneGraphQueriesOrNull));s+=`&scenegraph-queries=${_}`,this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,0),this._pendingSceneGraphQueriesOrNull=null}this._reconnectKey!=null&&(console.log(`reconnecting with reconnect key ${this._reconnectKey}`),s+=`&reconnect-key=${encodeURIComponent(this._reconnectKey)}`),this._url=s,console.debug(`attempting to connect to ${s}`);let d=this._mpContext.sock(),c=this._mpContext.msgs();if(d!=null&&d.url()==s&&(d.readyState()==bi.Socket_CONNECTING||d.readyState()==bi.Socket_OPEN))console.debug(`Applied the preconnect optimization for URL ${s}`),this._mpContext.setSock(null),this._mpContext.setMsgs([]),this._mpContext.setPerfMetrics([]);else{if(d!=null){console.warn(`Preconnect URL ${d.url()} doesn't match URL ${s}, skipping preconnect optimization`);try{d.close()}catch{}}d=this._mpContext.newSocket(s),d.setBinaryType("arraybuffer"),c=[]}let p=()=>this._socket==null?d==null:this._socket.equals(d),u=!0,h=null;d.setOnopen(_=>{if(!p()){console.warn("ignoring 'open' event on old socket");return}this._consecutiveFailedConnectionAttempts=0,h()}),h=()=>{this._isConnected=!0,console.debug(`connected to ${this._url}`),Be.handleMultiplayerSocketConnectionAttempt(!0,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this._hasConnectedAtLeastOnce=!0,this._attemptsSinceLastConnectionSuccess=0,this._observers.forEach(_=>{_.handleConnect(t,n)})};let f=null;d.setOnmessage(_=>{if(!p()){console.warn("ignoring 'message' event on old socket");return}if(!_.isArrayBuffer()){console.warn("ignoring 'message' event without an ArrayBuffer payload");return}let m=new Uint8Array(_.dataAsArrayBuffer());f(m)}),f=_=>{if(u){if(u=!1,!L._prototypeLib.modules().prototype.handleServerSchema(_)){this.disconnect();return}this._sendSignal("feature-flags",JSON.stringify(X.getFeatureFlags().originalObject))}else L._prototypeLib.modules().prototype.handleCompressedMultiplayerMessage(_,this.sessionID(),this._sceneLoadingPhase,na)},d.setOnclose(_=>{if(!p()){console.warn("ignoring 'close' event on old socket");return}if(this._isConnected?Be.handleMultiplayerSocketDisconnected(this._isWindowActive()):Be.handleMultiplayerSocketConnectionAttempt(!1,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this.disconnect(),!this._shouldReconnect){console.warn("File too busy, not reconnecting");return}let m=null,A=()=>{clearTimeout(this._reconnectionTimeout),this._onlineChangeHandler!=null&&(en.EventTarget_removeEventListener1(window,"online",this._onlineChangeHandler),this._onlineChangeHandler=null),this._isWindowActive()?this.attemptReconnect():m()};m=()=>{let y=Math.min(sr.RECONNECTION_DELAY_MAX,sr.RECONNECTION_DELAY_MIN*Math.pow(2,this._consecutiveFailedConnectionAttempts)),S=sr.RECONNECTION_DELAY_MIN+(y-sr.RECONNECTION_DELAY_MIN)*Math.random();console.debug(`attempting to reconnect to ${this._url} in ${S}s`),this._reconnectionTimeout=setTimeout(A,S*1e3|0),this._onlineChangeHandler=()=>{console.log("attempting to reconnect due to connectivity change"),navigator.onLine&&(this._consecutiveFailedConnectionAttempts=0,A())},en.EventTarget_addEventListener1(window,"online",this._onlineChangeHandler)},m(),this._consecutiveFailedConnectionAttempts=this._consecutiveFailedConnectionAttempts+1}),this._socket=d,d.readyState()==bi.Socket_OPEN&&h(),c.forEach(f)}_decodeConcatenatedUncompressedMessages(e,t){let n=new this._sessionSchema.ByteBuffer(e);for(;n.length!==n._index;){let r=null;try{r=this._sessionSchema.decodeMessage(n)}catch(o){console.error(`decoding failed: '${o.message}'`);return}sr.VERBOSE&&console.log(`got message of type '${r.type}'`),t(r)}}handleUncompressedMessage(e,t){this._decodeConcatenatedUncompressedMessages(e,n=>{switch(n.type){case"JOIN_START":case"JOIN_START_SKIP_RELOAD":{this._handleJoinStartOrJoinStartSkipReload(n,this._connectType);break}case"JOIN_END":{this._handleJoinEnd();break}case"SCENE_GRAPH_REPLY":{this._handleSceneGraphReply(n);break}case"NODE_CHANGES":throw new Error("handleUncompressedMessage cannot handle a NODE_CHANGES payload. Did you mean to process this message in C++ and call PrototypeApp::didReceiveNodeChanges instead?");case"USER_CHANGES":{this._userSyncing!=null&&this._userSyncing.handleUserChanges(n,this);break}case"SIGNAL":{this._handleSignal(n);break}case"NOTIFY_SHOULD_UPGRADE":{this._handleNotifyShouldUpgrade();break}case"CLIENT_BROADCAST":{this._handleClientBroadcast(n);break}}})}handleUncompressedSchema(e){try{this._sessionSchema=ah.compileSchema(ah.decodeBinarySchema(e))}catch(t){return console.error(`schema decoding failed: '${t.message}'; uncompressedBytes is ${e.length}`),!1}return!0}didReceiveNodeChanges(e,t){if(this._scene==null){console.warn("ignoring 'NODE_CHANGES' event without a scene");return}this._emitter.trigger("incrementalLoadingInfo",{type:"receiveNodeChanges",size:e}),this._partialSnapshotInfo.snapshotHash=null,t!==null&&t!=null&&(this._partialSnapshotInfo.reconnectSequenceNumber=new Se(t)),this._observers.forEach(n=>{n.handleNodeChanges()}),this._isJoined||(console.debug("server sent the full document (vs. incrementally loading)"),this.setNodeLoadedStatusesAndUpdate(null),this._finishLoadingIfNecessary())}_handleJoinStartOrJoinStartSkipReload(e,t){let n=0;if(e.type=="JOIN_START"?n=0:(n=1,console.debug("performing fast reconnect to skip scene reload")),t==0?this._setSceneLoadingPhase(0):t==1&&n!=1&&this._setSceneLoadingPhase(1),this._sessionID=e.sessionID,n!=1){let r=It.createScene(this._sessionID,this._prototypeLibCppEnabledForPendingFile);this.setScene(r),r.setFileKey(this.fileKey()),this._appState.setScene(null)}else this._sendSignal("client-rendered","");this._observers.forEach(r=>{r.handleJoinStart(n,e.sessionID,e.fileVersion)})}_handleJoinEnd(){this._isJoined=!0,this._enableHeartbeatTimer(),this._cachedNextUserChange!=null&&(this._getOrCreateNextUserChange().recentClicks=[]),this._pendingSceneGraphQueriesOrNull!=null&&(this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,1),this._pendingSceneGraphQueriesOrNull=null),this._observers.forEach(e=>{e.handleJoinEnd()}),this.handleStateChangeInitiated(new Zn(0,ko.ROOT_STABLE_PATH()))}_handleSceneGraphReply(e){this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency-1,Mn.increment("[IFL] sceneGraphQueriesReceived",1),Mn.track2("[IFL] Total Loaded Nodes",e.sceneGraphQueries.length),this._emitter.trigger("incrementalLoadingInfo",{type:"receiveSceneGraphReply",queries:e.sceneGraphQueries.map(t=>Rr.toString(t))}),this._partialSnapshotInfo.fulfilledQueries=e.sceneGraphQueries,this.setNodeLoadedStatusesAndUpdate(e.sceneGraphQueries),this._observers.forEach(t=>{t.handleSceneGraphReply(this._lastSceneGraphQueryConcurrency,e.sceneGraphQueries)}),this.handleStateChangeInitiated(new Zn(0,ko.ROOT_STABLE_PATH()))}_handleSignal(e){if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="invalid-permissions"){console.warn("received 'invalid-permissions' message."),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="client-too-old"){console.warn("received 'client-too-old' message. refreshing!"),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="snapshot-hash"&&(this._partialSnapshotInfo.snapshotHash=e.signalPayload),e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-sequence-number"&&(this._partialSnapshotInfo.reconnectSequenceNumber=new Se(parseInt(e.signalPayload))),e.signalName!==void 0&&e.signalName=="reconnect-immediately"&&(console.log("received 'reconnect-immediately' signal. reconnecting."),this.attemptReconnect()),e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-key"&&(this._reconnectKey=e.signalPayload,console.debug(`server sent reconnect key ${this._reconnectKey}`)),e.signalName!==void 0&&e.signalName=="too-many-connections"){let t=Hf.attemptToParseFrom(e.signalPayload!==void 0?e.signalPayload:"");t!=null&&(this._staticFileRequest=new Ur(t.url).format(1),this._staticFileRequest.get().then(n=>{this._observers.forEach(r=>{r.handleJoinStart(0,-1,-1)}),this._appState.serialization().decodeSceneForViewerAndPrototypeLib1(n.bytes,this._prototypeLibCppEnabledForPendingFile).then(r=>{r!=null?(this._scene=r,this.setNodeLoadedStatusesAndUpdate(null),this._observers.forEach(o=>{o.handleJoinEnd()}),this._finishLoadingIfNecessary()):Ke("Failed to parse scene")})})),console.warn("too many connections to multiplayer or example file, not reconnecting"),this._shouldReconnect=!1}}_handleNotifyShouldUpgrade(){console.warn("received NOTIFY_SHOULD_UPGRADE message. refreshing!"),location.reload()}_handleClientBroadcast(e){for(let t of e.broadcasts)t.prototypePresenter!=null&&(t.prototypePresenter.nomination!=null?this.updateNominatedPresenter(t.prototypePresenter.nomination,t.sessionID):(this.setPresenterSessionID(new Se(t.prototypePresenter.sessionID)),this._presenterSessionID!=null&&(this._sessionsNominatingCurrentUser.clear(),this._sessionNominatedByCurrentUser=null)));this._observers.forEach(t=>{t.handlePresenterChange()})}updateNominatedPresenter(e,t){e.isCancelled?(e.sessionID==this._sessionID&&(t==this._sessionID?this._sessionsNominatingCurrentUser.clear():this._sessionsNominatingCurrentUser.delete(t)),this._sessionNominatedByCurrentUser!=null&&this._sessionNominatedByCurrentUser.value==e.sessionID&&(this._sessionNominatedByCurrentUser=null)):(e.sessionID==this._sessionID&&this._sessionsNominatingCurrentUser.add(t),t==this._sessionID&&(this._sessionNominatedByCurrentUser=new Se(e.sessionID)))}disconnect(){if(this._isJoined=!1,this._socket!=null){try{this._socket.close()}catch{}this._socket=null}this._lastSceneGraphQueryConcurrency=0,clearTimeout(this._heartbeatTimeout),clearTimeout(this._reconnectionTimeout),this._isConnected&&(console.debug(`disconnected from ${this._url}`),this._isConnected=!1,this._observers.forEach(e=>{e.handleDisconnect()}))}_enableHeartbeatTimer(){if(2==0)return;let e=null,t=()=>{if(this._isWindowActive()){console.debug("sending heartbeat message");let n={};n.type="USER_CHANGES",n.userChanges=[],this._sendMessage(n)}e()};e=()=>{this._heartbeatTimeout=setTimeout(t,sr.HEARTBEAT_DELAY)},e()}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){e.property==97&&$.asString(e.newVal)=="CREATED"&&this._partialSnapshotInfo.fulfilledQueries!=null&&this._partialSnapshotInfo.fulfilledQueries.some(t=>Rr.fullyLoadsNode(t,e.node))&&e.node.setHasBeenLoaded(!0)}handleStateUpdate(e,t){this.pushAllInstanceStateChanges()}handleStateChangeAborted(e){e!=null&&(this.handleStateUpdate(e,"ABORTED"),this.handlePresentedStateChange(null,e.oldStateAndOverlays,null))}handleStateChangeCommitted(e,t){this.handleStateUpdate(e,"COMMITTED")}handleStateChangeInitiated(e){if(e==null||e.oldStateAndOverlays.stateId==null&&e.newStateAndOverlays.stateId==null)return;this.handleStateUpdate(e,"INITIATED");let t=this._getSynchronizableHotspotId_instanceHACK(e.interactionAddress.hotspotStablePath);this.handlePresentedStateChange(t,e.newStateAndOverlays,e.interactionAddress.interactionId)}handleStateChangeRequested(e){}_pushInstanceStateChange(e,t,n){let r=gt.encodeInstanceStateChange(t,n);r.hotspotStablePath==null&&(r.hotspotStablePath=gt.encodeGUIDPath(e)),this._getOrCreateNextUserChange().instanceStateChanges==null&&(this._getOrCreateNextUserChange().instanceStateChanges=[]),this._getOrCreateNextUserChange().instanceStateChanges.push(r)}handleHsmAborted(e,t){this._pushInstanceStateChange(e,t,"ABORTED")}handleHsmCommitted(e,t,n){this._pushInstanceStateChange(e,t,"COMMITTED")}handleHsmInitiated(e,t){this._pushInstanceStateChange(e,t,"INITIATED")}handleHsmRequested(e,t){}pushAllInstanceStateChanges(){let e=this._appState.prototypeState();e.getOnscreenStates().forEach(t=>{let n=e.getStateMachineLastChangeInHistory(t.a);this._pushInstanceStateChange(t.a,n,"INITIATED"),this._pushInstanceStateChange(t.a,n,"COMMITTED")})}onTransitionFrame(e){this._getOrCreateNextUserChange()}_getSynchronizableHotspotId_instanceHACK(e){var n,r;return(r=(n=this._appState.scene())==null?void 0:n.findNode3(e))==null?void 0:r.id()}_createTriggeredOverlaysDataForMultiplayer(e,t){let n=[];return t.overlays.forEach(r=>{let o=this._getSynchronizableHotspotId_instanceHACK(r.openingHotspotStablePath);n.push(gt.encodeOverlayData(r,o))}),n}_updateNextUserChangeForOverlay(e,t){this.observedUser()==null&&(this._getOrCreateNextUserChange().triggeredOverlaysData=this._createTriggeredOverlaysDataForMultiplayer(e,t))}handleVideoStateChange(e){this._getOrCreateNextUserChange().videoStateChangeData=e}pushAllVideoStateChanges(){this._getOrCreateNextUserChange().videoStateChangeData=this._appState.prototypeState().getVideoStateChanges()}handlePresentedStateChange(e,t,n){let r=this._previousTlfID,o=this._appState.baseScreenId();ne.equals(r,o)||(this._previousTlfID=o,this._getOrCreateNextUserChange().selection=[],o!=null&&this._getOrCreateNextUserChange().selection.push(ne.toFigGUID(o))),e!=null&&(this._getOrCreateNextUserChange().lastTriggeredHotspot=gt.encodeGUID(e)),n!=null&&(this._getOrCreateNextUserChange().lastTriggeredPrototypeInteractionID=gt.encodeGUID(n)),this._updateNextUserChangeForOverlay(e,t)}pushAllSetVariableActions(){this.handleSetVariableAction(this._appState.prototypeState()._setVariableActionHistory)}handleSetVariableAction(e){this._getOrCreateNextUserChange().triggeredSetVariableActionData=e}handleFitModeChange(e,t){}handleRestartPrototype(){}_getOrCreateNextUserChange(){return this._cachedNextUserChange==null&&(this._cachedNextUserChange={},this._cachedNextUserChange.sessionID=this._sessionID,this._cachedNextUserChange.instanceStateChanges=null),this._cachedNextUserChange}getParticles(){var e;return(e=this.observedUser())==null?void 0:e.remainingParticles()}getMouse(){var e;return(e=this.observedUser())==null?void 0:e.canvasSpaceMouse}getScrollPositions(){var e;return(e=this.observedUser())==null?void 0:e.scrollPositions}setCanvasSpaceMouse(e){let t=this._previousCanvasSpaceMouseLocation;if(e==null&&t==null||e!=null&&t!=null&&e.equals(t))return;this._previousCanvasSpaceMouseLocation=e==null?void 0:e.clone();let n={};e!=null?(n.x=e.x(),n.y=e.y()):(n.x=NaN,n.y=NaN);let r={};r.canvasSpaceLocation=n,r.cursor="DEFAULT",this._getOrCreateNextUserChange().mouse=r}recordCanvasSpaceClick(e){for(;this._canvasSpaceClicks.length>10;)this._canvasSpaceClicks.shift();let t={};t.x=e.x(),t.y=e.y();let n={};n.id=this._nextCanvasSpaceClickID=this._nextCanvasSpaceClickID+1,n.point=t,this._canvasSpaceClicks.push(n),this._getOrCreateNextUserChange().recentClicks=this._canvasSpaceClicks.slice()}setScrollPosition(e,t){for(ce.List_removeIf(this._recentlyChangedScrollPositions,n=>n.nodeId==e);this._recentlyChangedScrollPositions.length>this.maxScrollPositionsToStore;)this._recentlyChangedScrollPositions.shift();this._recentlyChangedScrollPositions.push(new rh(e,t)),this._getOrCreateNextUserChange().scrollPositions=this._recentlyChangedScrollPositions.map(n=>{let r={};return r.node=gt.encodeGUID(ne.fromString(n.nodeId)),r.scrollOffset=gt.encodeVector2(n.offset),r})}maybeFlushNextUserChange(e){let t=Qe.seconds();(this._lastFlush==-1||t-this._lastFlush>sr.FLUSH_INTERVAL_SEC||e==1)&&(this._flushNextUserChange(),this._lastFlush=t)}_flushNextUserChange(){if(this._isJoined&&this._cachedNextUserChange!=null){let e={};e.type="USER_CHANGES",e.userChanges=[this._cachedNextUserChange],sr.debugUserChanges&&console.log("flushNextUserChange",this._cachedNextUserChange),this._sendMessage(e),this._cachedNextUserChange=null}}_queriesAreEqual(e,t){let n=new Map;for(let o of e)n.set(Rr.hash(o),!0);let r=new Map;for(let o of t)r.set(Rr.hash(o),!0);if(n.size!=r.size)return!1;for(let o of Array.from(n.keys()))if(!r.has(o))return!1;return!0}setSceneGraphQueries(e){this._queriesAreEqual(e,this.currentSceneGraphQueries())||(this._isJoined?this._sendSceneGraphQueries(e,1):this._pendingSceneGraphQueriesOrNull=e)}_sendSceneGraphQueries(e,t){if(this._lastSceneGraphQueryConcurrency==0&&(this._lastSceneGraphQueryTime=Qe.milliseconds()),this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency+1,e.length>0&&(this._lastSentSceneGraphQueriesOrNull=e,t==1)){let n={};n.type="SCENE_GRAPH_QUERY",n.sceneGraphQueries=e,Mn.increment("[IFL] sceneGraphQueriesSent",1),this._emitter.trigger("incrementalLoadingInfo",{type:"sendSceneGraphQuery",queries:n.sceneGraphQueries.map(r=>Rr.toString(r))}),this._sendMessage(n)}}_sendSignal(e,t){let n={};n.type="SIGNAL",n.signalName=e,n.signalPayload=t,this._sendMessage(n)}nominatePresenter(e){let t=this.presenterClientBroadcastMessageWithNomination(e,!1);this._sendClientBroadcast(t)}cancelPresenterNomination(e){let t=this.presenterClientBroadcastMessageWithNomination(e,!0);this._sendClientBroadcast(t)}presenterClientBroadcastMessageWithNomination(e,t){let n={};n.type="CLIENT_BROADCAST";let r={};r.sessionID=this._sessionID;let o={},a={};return this._presenterSessionID!=null&&(o.sessionID=this._presenterSessionID.value),a.sessionID=e,a.isCancelled=t,o.nomination=a,r.prototypePresenter=o,n.broadcasts=[r],n}startPresenting(){let e=this.presenterClientBroadcastMessage(!0);this._sendClientBroadcast(e)}stopPresenting(){let e=this.presenterClientBroadcastMessage(!1);this._sendClientBroadcast(e)}setInteractiveSlideConfigData(e,t,n){if(t!="resultsShown"){console.error(`Could not set configData for ${e} to ${t}:${n}. Only allowed to set resultsShown from the viewer.`);return}let r={};r.type="NODE_CHANGES";let o={entries:[{key:t,value:n}]},a={guid:ne.toFigGUID(e),interactiveSlideConfigData:o};r.nodeChanges=[a],this._sendClientBroadcast(r)}setInteractiveSlideParticipantData(e,t,n){let r={};r.type="INTERACTIVE_SLIDE_CHANGE";let o={anonymousUserID:t,nodeID:ne.toFigGUID(e),responseData:n};r.interactiveSlideElementChange=o,this._sendClientBroadcast(r)}presenterClientBroadcastMessage(e){let t={};t.type="CLIENT_BROADCAST";let n={},r={};return e&&(r.sessionID=this._sessionID),n.prototypePresenter=r,t.broadcasts=[n],t}_sendClientBroadcast(e){this._socket!=null&&this._sendMessage(e)}_sendMessage(e){X.getFeatureFlags().logAllWebsocket&&console.log(e),this._socket.send2(Di.deflateRaw(be.schema.encodeMessage(e)))}};sr.debugUserChanges=!1,sr.VERBOSE=!1,sr.SCHEMA_PREFIX="fig-wire\0\0\0",sr.SCHEMA_PREFIX_BYTES=new Uint8Array([102,105,103,45,119,105,114,101,1,0,0,0]),sr.RECONNECTION_DELAY_MIN=1,sr.RECONNECTION_DELAY_MAX=128,sr.FLUSH_INTERVAL_SEC=1/30,sr.HEARTBEAT_DELAY=60*1e3;var ma=sr,zf=(t=>(t[t.NORMAL=0]="NORMAL",t[t.SKIP_RELOAD=1]="SKIP_RELOAD",t))(zf||{}),UI=(t=>(t[t.SKIP=0]="SKIP",t[t.DO_NOT_SKIP=1]="DO_NOT_SKIP",t))(UI||{}),ih=class{constructor(e,t,n){this.snapshotHash=null,this.reconnectSequenceNumber=null,this.fulfilledQueries=null,this.snapshotHash=e,this.reconnectSequenceNumber=t,this.fulfilledQueries=n}isValid(){return(this.snapshotHash!=null||this.reconnectSequenceNumber!=null)&&this.fulfilledQueries!=null}},nh=(t=>(t[t.INITIAL=0]="INITIAL",t[t.RECONNECT=1]="RECONNECT",t))(nh||{});var $n;(t=>{function i(n,r){let o={};return o.startingNode=ne.toFigGUID(n),o.depth=r,o}t.create=i;function e(n){if(n==null)return"";let r="";for(let o of n)r+=Rr.serializeForMultiplayerURL(o),r+=",";return r.slice(0,r.length-1)}t.serializeListForMultiplayerURL=e})($n||($n={}));var Us;(t=>{function i(n){return`${n.sessionID}:${n.localID}`}t.toString=i;function e(n,r){return n.sessionID==r.sessionID&&n.localID==r.localID}t.equals=e})(Us||(Us={}));var Od;(e=>{function i(t){return t.guid!==void 0?"VariableID:"+Us.toString(t.guid):t.assetRef!==void 0&&t.assetRef.key!=null&&t.assetRef.version!=null?"VariableID:"+Wn.string_toString(t.assetRef.key)+"/"+Wn.string_toString(t.assetRef.version):""}e.toString=i})(Od||(Od={}));var Rr;(a=>{function i(s){let l=s.depth!==void 0?s.depth:-1;return`${n(s)}-${l}`}a.hash=i;function e(s,l){return i(s)==i(l)}a.equals=e;function t(s){return i(s)}a.toString=t;function n(s){let l=s.startingNode!==void 0?s.startingNode:null;return l!=null?`${l.sessionID}:${l.localID}`:"-1:-1"}a.nodeIdString=n;function r(s){let l=s.startingNode!==void 0?s.startingNode:null,d=l!=null?`${l.sessionID}:${l.localID}`:"-1:-1",c=s.depth!==void 0?s.depth:-1;return`${d}-${c}`}a.serializeForMultiplayerURL=r;function o(s,l){if((s.depth!==void 0?s.depth:-1)!=0)return!1;let c=s.startingNode!==void 0?s.startingNode:null;for(;l!=null;){if(Us.equals(ne.toFigGUID(l.id()),c))return!0;l=l.parent()}return!1}a.fullyLoadsNode=o})(Rr||(Rr={}));var LI;(e=>{function i(t){return sh[t]}e.FlushThrottling_toString=i})(LI||(LI={}));var BI;(e=>{function i(t){return zf[t]}e.JoinKind_toString=i})(BI||(BI={}));var VI;(e=>{function i(t){return UI[t]}e.ShouldSkipSendQueryMessage_toString=i})(VI||(VI={}));var kI;(e=>{function i(t){return nh[t]}e.ConnectType_toString=i})(kI||(kI={}));function Wf(i){return i.x()==375&&i.y()==812?"APPLE_IPHONE_X_SILVER":i.x()==414&&i.y()==736?"APPLE_IPHONE_8_PLUS_SILVER":i.x()==375&&i.y()==667?"APPLE_IPHONE_8_SILVER":i.x()==320&&i.y()==568?"APPLE_IPHONE_SE_SILVER":i.x()==411&&i.y()==731?"GOOGLE_PIXEL_2_CLEARLY_WHITE":i.x()==768&&i.y()==1024?"APPLE_IPAD_MINI_4_SILVER":i.x()==1024&&i.y()==1366?"APPLE_IPAD_PRO_SILVER":i.x()==1440&&i.y()==990?"MICROSOFT_SURFACE_PRO_3":i.x()==1368&&i.y()==912?"MICROSOFT_SURFACE_PRO_4":i.x()==312&&i.y()==390?"APPLE_WATCH_42MM_STEEL_PLUS_WHITE_CLOSED":i.x()==272&&i.y()==340?"APPLE_WATCH_38MM_STEEL_PLUS_WHITE_CLOSED":null}var Ee=class Ee{constructor(){if(arguments.length==2){let e=arguments[0],t=arguments[1];this._paths=new Map,this._imageManager=null,this._videoManager=null,this._imageManager=e,this._videoManager=t}else if(arguments.length==1){let e=arguments[0];this._paths=new Map,this._imageManager=null,this._videoManager=null,this._imageManager=e}}static hash(e,t){return t instanceof Array&&t.length===0?e:t}static hasFileHeader(e){for(let t=0,n=Ee.FILE_HEADER.length;t<n;t=t+1)if(t>=e.length||e[t]!=Ee.FILE_HEADER[t])return!1;return!0}static parseChunkType(e){return e.length!=Ee.CHUNK_TAG_LEN?Ee.ChunkType.UNKNOWN:(n=>{for(let r=0,o=e.length;r<o;r=r+1)if(e[r]!=n[r])return!1;return!0})(Ee.THUMBNAIL_CHUNK_TAG)?Ee.ChunkType.THUMBNAIL:Ee.ChunkType.UNKNOWN}static readInt32(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}static _logVerbose(e){console.log(e)}static _logVerbosePropertyChange(e,t){console.log(`decoded property change '${t}' for node '${e}'`)}static encodeGUID(e){return ne.toFigGUID(e)}static encodeGUIDPath(e){let t={};return e.guids!=null&&(t.guids=e.guids.map(n=>Ee.encodeGUID(n))),t}static encodeInstanceStateChange(e,t){let n={};return n.stateID=Ee.encodeGUID(e.newStateId()),n.interactionID=Ee.encodeGUID(e.interactionAddress.interactionId),e.interactionAddress.hotspotStablePath!=null&&(n.hotspotStablePath=Ee.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),e.stablePath!=null&&(n.instanceStablePath=Ee.encodeGUIDPath(e.stablePath)),n.phase=t,n}static encodePrototypeStateChange(e){let t={};if(e.oldStateAndOverlays!=null){let n={};e.oldStateAndOverlays.stateId!=null&&(n.baseScreenID=Ee.encodeGUID(e.oldStateAndOverlays.stateId),n.overlays=e.oldStateAndOverlays.overlays.map(r=>Ee.encodeOverlayData(r,null))),t.oldState=n}if(e.newStateAndOverlays!=null){let n={};e.newStateAndOverlays.stateId!=null&&(n.baseScreenID=Ee.encodeGUID(e.newStateAndOverlays.stateId),n.overlays=e.newStateAndOverlays.overlays.map(r=>Ee.encodeOverlayData(r,null))),t.newState=n}return e.interactionAddress.hotspotStablePath!=null&&(t.hotspotBlueprintID=Ee.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),t.isHotspotInNewPresentedState=[6,7].indexOf(e.cause)==-1,t.interactionID=Ee.encodeGUID(e.interactionAddress.interactionId),t.direction=e.direction==0?"FORWARD":"REVERSE",t}static encodeOverlayData(e,t){let n={};return n.hotspotBlueprintId=Ee.encodeGUIDPath(e.openingHotspotStablePath),t!=null&&(n.hotspotGuid=Ee.encodeGUID(t)),n.overlayGuid=Ee.encodeGUID(e.id),n.prototypeInteractionGuid=Ee.encodeGUID(e.openingInteractionId),n.swapGuid=Ee.encodeGUID(e.overlayDataModelId),n}static encodeMatrix(e){let t={};return t.m00=e.m00(),t.m01=e.m01(),t.m02=e.m02(),t.m10=e.m10(),t.m11=e.m11(),t.m12=e.m12(),t}static encodeVector1(e){let t={};return t.x=e.x(),t.y=e.y(),t}static encodeVector2(e){let t={};return t.x=e.x(),t.y=e.y(),t}static decodeGUID(e){let t=null,n=e.sessionID|0;if(n<0){let r=e.localID|0;n==-1&&(r==-1||r==-2)?t=$.new33(ne._new(n,r)):(Ke("Negative session ID encountered in GUID deserialization"),t=$.new33(ne._new(e.sessionID,e.localID)))}else t=$.new33(ne._new(e.sessionID,e.localID));return $.asGUID(t)}static decodeGUID_instanceHACK(e){return ne._new(e.sessionID|0,e.localID)}static decodeGUIDPath(e){if(e.guids===void 0)return null;let t=[];for(let r of e.guids){let o=Ee.decodeGUID(r);if(o==null)return null;t.push(o)}let n=$.new6(new Mt(t));return $.asGUIDPath(n)}static decodeStyleId(e){let t=e.guid!=null?Ee.decodeGUID(e.guid):null,n=e.assetRef!=null?{key:e.assetRef.key,version:e.assetRef.version}:null,r=$.new32({guid:t,ref:n});return $.asStyleId(r)}static decodeParentIndex(e){return new qn(Ee.decodeGUID(e.guid),dn.fromString(e.position))}static decodeVector(e){return new E(e.x,e.y)}static decodeMatrix(e){return new oe(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}static decodeColor(e){return C.new3(e.r,e.g,e.b,e.a)}static decodeFontName(e){let t=e.postscript!==void 0?e.postscript:"";return new el(e.family,e.style,t)}static decodeNumber(e){return new Js(e.value,e.units)}static decodeStops(e){let t=[];for(let n of e)t.push(new at(Ee.decodeColor(n.color),n.position));return t}static decodePrototypeDevice(e){let t=Ee.decodeVector(e.size),n=e.presetIdentifier!==void 0?e.presetIdentifier:null;e.type=="PRESET"&&(n==null||n.length==0)&&(n=Wf(t));let r=e.rotation!==void 0?e.rotation:"NONE";return new er(e.type,t,n,r)}static decodePrototypeStartingPoint(e){return new Xo(e.name,e.description,dn.fromString(e.position))}static encodePrototypeStartingPoint(e){let t={};return t.name=e.name,t.description=e.description,t.position=dn.toString(e.position),t}static decodeOverlayBackgroundAppearance(e){return new Ro(e.backgroundType!==void 0?e.backgroundType:"NONE",e.backgroundColor!==void 0?Ee.decodeColor(e.backgroundColor):C.TRANSPARENT)}static decodeVideoPlayback(e){return{autoplay:e.autoplay!==void 0?e.autoplay:!1,mediaLoop:e.mediaLoop!==void 0?e.mediaLoop:!1,muted:e.muted!==void 0?e.muted:!1}}static decodeEffects(e){let t=[];for(let r of e){let o=new Fe;o.setType(r.type),r.color!==void 0&&(o.setBlurColor(C.withAlpha(Ee.decodeColor(r.color),255)),o.setOpacity(r.color.a)),r.blendMode!==void 0&&o.setBlendMode(r.blendMode),r.offset!==void 0&&o.setBlurOffset1(Ee.decodeVector(r.offset)),r.radius!==void 0&&o.setBlurRadius(r.radius),r.visible!==void 0&&o.setIsEnabled(r.visible),r.spread!==void 0&&o.setSpread(r.spread),r.showShadowBehindNode!==void 0?o.setShowShadowBehindNode(r.showShadowBehindNode):o.setShowShadowBehindNode(!0),t.push(o)}let n=$.new17(t);return $.asEffectList(n)}static decodeExportConstraint(e){return e.type!==void 0&&e.value!==void 0?new tl(e.type,e.value):new tl("CONTENT_SCALE",1)}static decodeExportSettings(e,t){let n=[];for(let r of e){let o=null;r.suffix!==void 0?o=r.suffix:o="";let a=null;r.imageType!==void 0?a=r.imageType:a="PNG";let s=null;r.constraint!==void 0?s=Ee.decodeExportConstraint(r.constraint):s=new tl("CONTENT_SCALE",1);let l=t;r.contentsOnly!==void 0&&(l=r.contentsOnly),n.push(new Au(o,a,s,l))}return n}static decodePrototypeInteractions(e){return e.map(t=>Ee.decodePrototypeInteraction(t))}static decodePrototypeInteraction(e){let t=e.id!==void 0?Ee.decodeGUID(e.id):null,n=e.event!==void 0?Ee.decodePrototypeEvent(e.event):null,r=e.actions!==void 0?e.actions.map(s=>Ee.decodePrototypeAction(s)):null,o=e.isDeleted!==void 0?e.isDeleted:!1,a=e.stateManagementVersion!==void 0?e.stateManagementVersion:0;return new jt(t,n,r,o,a)}static encodePrototypeInteractionForTests(e){let t={};t.id=Ee.encodeGUID(e.id()),t.isDeleted=e.isDeleted(),t.stateManagementVersion=e.stateManagementVersion(),t.event=Ee.encodePrototypeEventForTests(e.event());let n=[],r=e.actions();for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];n.push(Ee.encodePrototypeActionForTests(s))}return t.actions=n,t}static decodePrototypeEvent(e){let t=e.interactionType!==void 0?e.interactionType:null,n=e.interactionMaintained!==void 0?new Se(e.interactionMaintained):null,r=e.interactionDuration!==void 0?new Se(e.interactionDuration):null,o=e.keyTrigger!==void 0?e.keyTrigger:null,a=e.transitionTimeout!==void 0?new Se(e.transitionTimeout):null,s=e.mediaHitTime!==void 0?new Se(e.mediaHitTime):null;return new eo(t,n,r,o,a,s)}static encodePrototypeEventForTests(e){let t={};return t.interactionType=e.interactionType(),t.interactionMaintained=e.interactionMaintained(),t.interactionDuration=e.interactionDuration(),t.keyTrigger=e.keyTrigger(),t.keyTrigger.keyCodes=e.keyTrigger().keyCodes,t.keyTrigger.triggerDevice=e.keyTrigger().triggerDevice,t.transitionTimeout=e.transitionTimeout(),t.mediaHitTime=e.mediaHitTime(),t}static decodeConditionalActions(e){let t=[],n=e.actions!==void 0?e.actions.map(o=>Ee.decodePrototypeAction(o)):t,r=e.condition!==void 0?Ee.variableDataToJson(e.condition):"";return new gc(n,r)}static encodeConditionalActionsForTests(e){let t={},n=[],r=e.actions();for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];n.push(Ee.encodePrototypeActionForTests(s))}return t.actions=n,t}static decodePrototypeAction(e){let t=e.transitionNodeID!==void 0?Ee.decodeGUID(e.transitionNodeID):null,n=e.transitionType!==void 0?e.transitionType:null,r=e.transitionDuration!==void 0?new Se(e.transitionDuration):null,o=e.easingType!==void 0?e.easingType:null,a=e.easingFunction!==void 0?e.easingFunction:null,s=e.transitionShouldSmartAnimate!==void 0?new Se(e.transitionShouldSmartAnimate):null,l=e.connectionType!==void 0?e.connectionType:null,d=e.connectionURL!==void 0?e.connectionURL:null,c=e.overlayRelativePosition!==void 0?Ee.decodeVector(e.overlayRelativePosition):null,p=e.navigationType!==void 0?e.navigationType:null,u=e.transitionPreserveScroll!==void 0?new Se(e.transitionPreserveScroll):null,h=e.extraScrollOffset!==void 0?Ee.decodeVector(e.extraScrollOffset):null,f=e.mediaAction!==void 0?e.mediaAction:null,_=e.transitionResetVideoPosition!==void 0?new Se(e.transitionResetVideoPosition):null,m=e.openUrlInNewTab!==void 0?new Se(e.openUrlInNewTab):null,A=e.mediaSkipToTime!==void 0?new Se(e.mediaSkipToTime):null,y=e.mediaSkipByAmount!==void 0?new Se(e.mediaSkipByAmount):null,S=e.transitionResetScrollPosition!==void 0?new Se(e.transitionResetScrollPosition):null,g=e.conditionalActions!==void 0?e.conditionalActions.map(O=>Ee.decodeConditionalActions(O)):null,b=e.transitionResetInteractiveComponents!==void 0?new Se(e.transitionResetInteractiveComponents):null,T=e.targetVariable!==void 0?Od.toString(e.targetVariable.id):null,I=e.targetVariableData!==void 0?Ee.variableDataToJson(e.targetVariableData):null;return new tr(t,n,r,o,a,s,l,d,c,p,u,h,f,_,m,A,y,S,g,b,T,I)}static variableDataToJson(e){let t={},n=e.dataType;switch(t.type=Ee.variableDataTypeToEnumValue(n),t.resolvedType=Ee.variableResolvedDataTypeToEnumValue(e.resolvedDataType),n){case"BOOLEAN":{t.value=e.value.boolValue;break}case"STRING":{t.value=e.value.textValue;break}case"FLOAT":{t.value=e.value.floatValue;break}case"COLOR":{let r={};r.r=e.value.colorValue.r,r.g=e.value.colorValue.g,r.b=e.value.colorValue.b,r.a=e.value.colorValue.a,t.value=r;break}case"ALIAS":{t.value=Od.toString(e.value.alias);break}case"EXPRESSION":{t.value=Ee.expressionToJson(e.value.expressionValue);break}case"MAP":throw new Error("Did not implement variableDataToJson for MAP data type")}return t}static variableDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"ALIAS":return 3;case"COLOR":return 4;case"EXPRESSION":return 5;case"MAP":return 6;case"SYMBOL_ID":return 7}throw new Error(`Invalid variable data type: ${e}`)}static variableResolvedDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"COLOR":return 3;case"MAP":return 4;case"SYMBOL_ID":return 5}throw new Error(`Invalid resolved variable data type: ${e}`)}static expressionToJson(e){let t={};t.expressionFunction=Ee.expressionFunctionToEnumValue(e.expressionFunction);let n=[];for(let r=0;r<e.expressionArguments.length;r=r+1)n.push(Ee.variableDataToJson(e.expressionArguments[r]));return t.expressionArguments=n,t}static expressionFunctionToEnumValue(e){switch(e){case"ADDITION":return 0;case"SUBTRACTION":return 1;case"RESOLVE_VARIANT":return 2;case"MULTIPLY":return 3;case"DIVIDE":return 4;case"EQUALS":return 5;case"NOT_EQUAL":return 6;case"LESS_THAN":return 7;case"LESS_THAN_OR_EQUAL":return 8;case"GREATER_THAN":return 9;case"GREATER_THAN_OR_EQUAL":return 10;case"AND":return 11;case"OR":return 12;case"NOT":return 13;case"STRINGIFY":return 14;case"TERNARY":return 15;case"VAR_MODE_LOOKUP":return 16}throw new Error(`Invalid expression function: ${e}`)}static encodePrototypeActionForTests(e){let t={};t.transitionNodeID=Ee.encodeGUID(e.transitionNodeID()),t.transitionType=e.transitionType(),t.transitionDuration=e.transitionDuration(),t.easingType=e.easingType(),t.easingFunction=e.easingFunctionValues(),t.transitionShouldSmartAnimate=e.transitionShouldSmartAnimate(),t.connectionType=e.connectionType(),t.connectionURL=e.connectionURL(),t.overlayRelativePosition=Ee.encodeVector1(e.overlayRelativePosition()),t.navigationType=e.navigationType(),t.transitionPreserveScroll=e.transitionPreserveScroll(),t.extraScrollOffset=Ee.encodeVector1(e.extraScrollOffset()),t.mediaAction=e.mediaAction(),t.transitionResetVideoPosition=e.transitionResetVideoPosition(),t.openUrlInNewTab=e.openUrlInNewTab(),t.mediaSkipToTime=e.mediaSkipToTime(),t.mediaSkipByAmount=e.mediaSkipByAmount(),t.transitionResetScrollPosition=e.transitionResetScrollPosition();let n=[],r=e.conditionalActions();for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];n.push(Ee.encodeConditionalActionsForTests(s))}return t.conditionalActions=n,t.transitionResetInteractiveComponents=e.transitionResetInteractiveComponents(),t}static serializeValueToKiwiForTests1(e,t){let n={},r=[];return Ee.serializeValueToKiwiForTests2(e,t,n,r),new vr(n,r)}static serializeValueToKiwiForTests2(e,t,n,r){if(!L.isTestingEnv())throw new Error("Should only serialize values to kiwi when running tests");if(e==59||e==60){let o=$.asPaintList(t);if(o==null)throw new Error("attempt to set null paint list");let a=[];for(let s=0,l=o.length;s<l;s=s+1){let d=o[s].asSinglePaint(),c={};if(c.type=d.type(),c.opacity=d.opacity(),c.visible=d.isEnabled(),c.blendMode=d.blendMode(),d.colorStops()!=null){let u=[];for(let h=0,f=d.colorStops().length;h<f;h=h+1){let _=d.colorStops()[h],m={},A={};A.r=C.redF(_.color),A.g=C.greenF(_.color),A.b=C.blueF(_.color),A.a=C.alphaF(_.color),m.color=A,m.position=_.position,u.push(m)}c.stops=u}let p={};if(p.r=C.redF(d.color()),p.g=C.greenF(d.color()),p.b=C.blueF(d.color()),p.a=C.alphaF(d.color()),c.color=p,d.image()!=null){let u={};u.hash=jn.hexToBytes(d.image().hash()),c.image=u,c.imageScaleMode=d.imageScaleMode()}a.push(c)}e==59?n.fillPaints=a:e==60&&(n.strokePaints=a)}else if(e==75){let o=$.asSymbolData(t);if(o==null)throw new Error("attempt to set null symbol data");let a={};a.symbolID=Ee.encodeGUID(o.masterID);let s=[];No.map(o.instanceOverrides).each((l,d)=>{let c={};c.guidPath=Ee.encodeGUIDPath(l),Sn.each(d,(p,u)=>{Ee.serializeValueToKiwiForTests2(p,u,c,[])}),s.push(c)}),a.symbolOverrides=s,n.symbolData=a}else if(e==73||e==74){let o=$.asGeometry(t);if(o==null)throw new Error("attempt to set null geometry");let a=[];for(let s=0,l=o.regions.length;s<l;s=s+1){let d=o.regions[s],c={};c.windingRule=d.windingRule,c.styleID=d.styleID,c.commandsBlob=r.length,r.push(Rt.mutableData(d.path().toBezierPath().getMutableClone()).bytes()),a.push(c)}e==73?n.fillGeometry=a:n.strokeGeometry=a}else if(e==4){let o=$.asTextData(t);if(o==null)throw new Error("attempt to set null textData");let a={};a.characters=o.characters();let s=[];o.styleOverrideTable().forEachStyle((d,c)=>{Yo.each(c,(p,u)=>{let f=Ee.serializeValueToKiwiForTests1(p,u).a;f.styleID=d,s.push(f)})}),a.styleOverrideTable=s;let l=[];o.usedEmojiCodepointsDEPRECATED().forEach(d=>{let c={};c.emojiCodePoints=d,l.push(c)}),a.glyphs=l,n.textData=a}else if(e==5){let o=$.asDerivedTextData(t);if(o==null)throw new Error("attempt to set null textData");let a={},s=[];o.usedEmojiCodepoints().forEach(l=>{let d={};d.emojiCodePoints=l,s.push(d)}),a.glyphs=s,a.hyperlinkBoxes=o.hyperlinkBoxes().map(l=>({guid:l.guid,bounds:l.bounds,hyperlinkID:l.hyperlinkID,url:l.url})),n.derivedTextData=a}else if(e==61){let o=$.asEffectList(t);if(o==null)throw new Error("attempt to set null effects");let a=[];for(let s=0,l=o.length;s<l;s=s+1){let d=o[s],c={};c.blendMode=d.blendMode(),c.radius=d.blurRadius(),c.spread=d.spread(),c.visible=d.isEnabled(),c.showShadowBehindNode=d.showShadowBehindNode(),c.type=d.type();let p={};p.r=C.redF(d.blurColor()),p.g=C.greenF(d.blurColor()),p.b=C.blueF(d.blurColor()),p.a=d.opacity(),c.color=p;let u=Ee.encodeVector2(d.blurOffset());c.offset=u,a.push(c)}n.effects=a}else if(e==51){let o=$.asGUID(t);if(o==null)throw new Error("attempt to set null overridenSymbolID");n.overriddenSymbolID=Ee.encodeGUID(o)}else if(e==82){let o=$.asPrototypeInteractionList(t);if(o==null)throw new Error("attempt to set null prototypeInteractions");let a=[];for(let s=0,l=o.length;s<l;s=s+1){let d=o[s];a.push(Ee.encodePrototypeInteractionForTests(d))}n.prototypeInteractions=a}else if(e==97){let o=$.asStringEnum(t,null);if(o==null)throw new Error("Bad node phase");n.phase=o}else{let o=xd(e);throw new Error(`unsupported setter for node field ${Ot[e]} and type ${Fd[o]}`)}}_imageDecoded(e,t,n){this._imageManager!=null&&this._imageManager.onNewImage(e,t,n)}_imageByHexHashOrNull(e,t){var n;return(n=this._imageManager)==null?void 0:n.findImageByHexHash(e,t)}decodeImage(e,t,n){let r=jn.bytesToHex(e.hash),o=this._imageByHexHashOrNull(r,1);if(o==null){let a=null;if(e.dataBlob!==void 0){let s=e.dataBlob;s<0||s>=t.length?console.warn(`ignoring invalid compressed data index ${s} for blob count ${t.length}`):a=t[s].bytes}kr?o=new Ed(null,r):o=jn.createImage(e.hash,a,n),this._imageDecoded(r,1,o)}return o}decodeVideo(e){let t=new Uint8Array(e.hash);return this._videoManager.buildVideoResource(t)}decodeEmojiImage(e){let t=e.map(r=>r.toString(16)).join("-"),n=this._imageByHexHashOrNull(t,0);return n==null&&(n=jn.createEmojiImage2(t),this._imageDecoded(t,0,n)),n}decodePaints(e,t){let n=[];for(let o of e){let a=new se(o.type);if(o.blendMode!==void 0&&a.setBlendMode(o.blendMode),o.color!==void 0){let s=Ee.decodeColor(o.color);a.setOpacity(C.alphaF(s)),a.setColor(C.withAlpha(s,255))}if(o.opacity!==void 0&&a.setOpacity(a.opacity()*o.opacity),o.stops!==void 0&&a.setColorStops1(Ee.decodeStops(o.stops)),o.transform!==void 0&&a.setTransform1(Ee.decodeMatrix(o.transform)),o.visible!==void 0&&a.setIsEnabled(o.visible),o.imageScaleMode!==void 0&&a.setImageScaleMode(o.imageScaleMode),o.rotation!==void 0&&a.setRotationDeg(o.rotation),o.scale!==void 0&&a.setScalingFactor(o.scale),o.paintFilter!==void 0&&a.setFilterColorAdjust(o.paintFilter),o.originalImageWidth!==void 0&&a.setOriginalImageWidth(o.originalImageWidth),o.originalImageHeight!==void 0&&a.setOriginalImageHeight(o.originalImageHeight),o.emojiCodePoints!==void 0)a.setImage(this.decodeEmojiImage(o.emojiCodePoints));else{let s=!1;o.animatedImage!==void 0&&o.animatedImage.hash!==void 0?(a.setImage(this.decodeImage(o.animatedImage,t,0)),o.animationFrame!==void 0&&o.animationFrame!=0&&(s=!0)):o.video!==void 0&&o.video.hash!==void 0?(a.setVideo(this.decodeVideo(o.video)),o.image!==void 0&&o.image.hash!==void 0&&a.setImage(this.decodeImage(o.image,t,1))):o.image!==void 0&&o.image.hash!==void 0&&a.setImage(this.decodeImage(o.image,t,1)),!s&&o.imageThumbnail!==void 0&&o.imageThumbnail.hash!==void 0&&a.setImageThumbnail(this.decodeImage(o.imageThumbnail,t,1))}a.opacity()!=0&&a.opacity()<1/250&&a.setOpacity(1/250),n.push(a)}let r=$.new11(n);return $.asPaintList(r)}decodePath(e,t){let n=qt.IntMap_get(this._paths,e,null);return n==null&&(e<0||e>=t.length?(console.warn(`ignoring invalid path index ${e} for blob count ${t.length}`),n=new Rt(new br)):n=new Rt(new br(new Uint8Array(t[e].bytes))),this._paths.set(e,n)),n}decodeGeometry(e,t){let n=[],r=null;for(let a of e){let s="ODD";if(a.commandsBlob===void 0){console.warn("ignoring path with missing required field: 'commandsBlob'");continue}a.windingRule!==void 0&&(s=a.windingRule);let l=this.decodePath(a.commandsBlob,t);n.push(new Yn(s,0,l,l.bounds())),a.styleID!==void 0&&(r==null&&(r=[]),r.push(a.styleID))}Tt.INSTANCE.reset();for(let a of n)Tt.INSTANCE.include3(a.bounds());let o=$.new27(new Dn(n,r,Tt.INSTANCE.build(),null));return $.asGeometry(o)}decodeTextData(e,t){let n=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,t):new Xn,r=e.hyperlinkBoxes!==void 0?e.hyperlinkBoxes:[],o=$.new21(new Jo(n,0,r,e.characters!==void 0?e.characters:"",e.lines!==void 0?e.lines:[],e.characterStyleIDs!==void 0?e.characterStyleIDs:[],[],[]));return $.asTextData(o)}decodeDerivedTextData(e,t){let n=e.hyperlinkBoxes!==void 0?e.hyperlinkBoxes:[],r=$.new22(new Ni(0,n,[],[]));return $.asDerivedTextData(r)}decodeVectorData(e,t){let n=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,t):new Xn,r=$.new23(new nl(n));return $.asVectorData(r)}decodeSymbolData(e,t){return e.symbolID===void 0?(console.warn("ignoring symbol data with missing required field: 'symbolID'"),null):new pi(Ee.decodeGUID(e.symbolID),e.symbolOverrides!==void 0?this.decodeOverrides(e.symbolOverrides,t):No._new())}decodeOverrides(e,t){let n=No._new();for(let r of e)if(r.guidPath!==void 0){let o=Ee.decodeGUIDPath(r.guidPath),a=Sn._new();this.decodeNodeChange(r,t,(s,l)=>{Sn.set(a,s,l)}),No.map(n).set(o,a)}return n}decodeStyleOverrideTable(e,t){let n=new Map;for(let r of e)r.styleID!==void 0&&this.decodeNodeChange(r,t,(o,a)=>{n.has(r.styleID)||n.set(r.styleID,Sn._new()),Sn.set(n.get(r.styleID),o,a)});return new Xn(n)}decodeNodeChange(e,t,n){e.type!==void 0&&n(19,$.new8(e.type)),e.backgroundColor!==void 0&&n(64,$.new7(Ee.decodeColor(e.backgroundColor))),e.backgroundEnabled!==void 0&&n(9,$.new3(e.backgroundEnabled)),e.backgroundOpacity!==void 0&&n(38,$.new4(e.backgroundOpacity)),e.blendMode!==void 0&&n(22,$.new8(e.blendMode)),e.connectionType!==void 0&&n(26,$.new8(e.connectionType)),e.connectionURL!==void 0&&n(70,$.new8(e.connectionURL)),e.containerSupportsFillStrokeAndCorners!==void 0&&n(79,$.new3(e.containerSupportsFillStrokeAndCorners)),e.cornerRadius!==void 0&&n(44,$.new4(e.cornerRadius)),e.rectangleTopLeftCornerRadius!==void 0&&n(39,$.new4(e.rectangleTopLeftCornerRadius)),e.rectangleTopRightCornerRadius!==void 0&&n(40,$.new4(e.rectangleTopRightCornerRadius)),e.rectangleBottomLeftCornerRadius!==void 0&&n(41,$.new4(e.rectangleBottomLeftCornerRadius)),e.rectangleBottomRightCornerRadius!==void 0&&n(42,$.new4(e.rectangleBottomRightCornerRadius)),e.rectangleCornerRadiiIndependent!==void 0&&n(15,$.new3(e.rectangleCornerRadiiIndependent)),e.cornerSmoothing!==void 0&&n(45,$.new4(e.cornerSmoothing)),e.easingType!==void 0&&n(28,$.new8(e.easingType)),e.effects!==void 0&&n(61,$.new17(Ee.decodeEffects(e.effects))),e.arcData!==void 0&&n(63,$.new31(e.arcData)),e.shapeWithTextType!==void 0&&n(85,$.new44(e.shapeWithTextType)),e.fillGeometry!==void 0&&n(73,$.new27(this.decodeGeometry(e.fillGeometry,t))),e.fillPaints!==void 0&&n(59,$.new11(this.decodePaints(e.fillPaints,t))),e.frameMaskDisabled!==void 0&&n(13,$.new3(e.frameMaskDisabled)),e.interactionType!==void 0&&n(29,$.new8(e.interactionType)),e.internalOnly!==void 0&&n(12,$.new3(e.internalOnly)),e.isStateGroup!==void 0&&n(81,$.new3(e.isStateGroup)),e.mask!==void 0&&n(10,$.new3(e.mask)),e.maskIsOutline!==void 0&&n(11,$.new3(e.maskIsOutline)),e.name!==void 0&&n(62,$.new8(e.name)),e.navigationType!==void 0&&n(30,$.new39(e.navigationType)),e.opacity!==void 0&&n(37,$.new4(fn.Math_clamp1(e.opacity,0,1))),e.overlayBackgroundInteraction!==void 0&&n(32,$.new8(e.overlayBackgroundInteraction)),e.overlayBackgroundAppearance!==void 0&&n(67,$.new30(Ee.decodeOverlayBackgroundAppearance(e.overlayBackgroundAppearance))),e.overlayPositionType!==void 0&&n(31,$.new8(e.overlayPositionType)),e.overlayRelativePosition!==void 0&&n(57,$.new10(Ee.decodeVector(e.overlayRelativePosition))),e.overriddenSymbolID!==void 0&&n(51,$.new33(Ee.decodeGUID(e.overriddenSymbolID))),e.overrideKey!==void 0&&n(50,$.new33(Ee.decodeGUID(e.overrideKey))),e.parentIndex!==void 0&&n(25,$.new26(Ee.decodeParentIndex(e.parentIndex))),e.prototypeBackgroundColor!==void 0&&n(65,$.new7(Ee.decodeColor(e.prototypeBackgroundColor))),e.prototypeDevice!==void 0&&n(66,$.new28(Ee.decodePrototypeDevice(e.prototypeDevice))),e.prototypeStartNodeID!==void 0&&n(69,$.new33(Ee.decodeGUID(e.prototypeStartNodeID))),e.prototypeStartingPoint!==void 0&&n(84,$.new29(Ee.decodePrototypeStartingPoint(e.prototypeStartingPoint))),e.resizeToFit!==void 0&&n(14,$.new3(e.resizeToFit)),e.scrollDirection!==void 0&&n(34,$.new43(e.scrollDirection)),e.size!==void 0&&n(49,$.new10(Ee.decodeVector(e.size))),e.strokeAlign!==void 0&&n(23,$.new8(e.strokeAlign)),e.strokeGeometry!==void 0&&n(74,$.new27(this.decodeGeometry(e.strokeGeometry,t))),e.strokePaints!==void 0&&n(60,$.new11(this.decodePaints(e.strokePaints,t))),e.symbolData!==void 0&&n(75,$.new34(this.decodeSymbolData(e.symbolData,t))),e.videoPlayback!==void 0&&n(72,$.new47(Ee.decodeVideoPlayback(e.videoPlayback))),e.stackReverseZIndex!==void 0&&n(78,$.new3(e.stackReverseZIndex)),e.textData!==void 0&&n(4,$.new21(this.decodeTextData(e.textData,t))),e.derivedTextData!==void 0&&n(5,$.new22(this.decodeDerivedTextData(e.derivedTextData,t))),e.vectorData!==void 0&&n(76,$.new23(this.decodeVectorData(e.vectorData,t))),e.transform!==void 0&&n(24,$.new2(Ee.decodeMatrix(e.transform))),e.transitionNodeID!==void 0&&n(71,$.new33(Ee.decodeGUID(e.transitionNodeID))),e.transitionType!==void 0&&n(27,$.new8(e.transitionType)),e.transitionShouldSmartAnimate!==void 0&&n(18,$.new3(e.transitionShouldSmartAnimate)),e.transitionDuration!==void 0&&n(46,$.new4(e.transitionDuration)),e.transitionTimeout!==void 0&&n(47,$.new4(e.transitionTimeout)),e.interactionMaintained!==void 0&&n(16,$.new3(e.interactionMaintained)),e.interactionDuration!==void 0&&n(48,$.new4(e.interactionDuration)),e.transitionPreserveScroll!==void 0&&n(17,$.new3(e.transitionPreserveScroll)),e.visible!==void 0&&n(8,$.new3(e.visible)),e.styleType!==void 0&&n(33,$.new8(e.styleType)),e.inheritFillStyleID!==void 0&&n(52,$.new33(Ee.decodeGUID(e.inheritFillStyleID))),e.inheritFillStyleIDForStroke!==void 0&&n(53,$.new33(Ee.decodeGUID(e.inheritFillStyleIDForStroke))),e.inheritEffectStyleID!==void 0&&n(56,$.new33(Ee.decodeGUID(e.inheritEffectStyleID))),e.inheritTextStyleID!==void 0&&n(55,$.new33(Ee.decodeGUID(e.inheritTextStyleID))),e.styleIdForFill!==void 0&&n(92,$.new32(Ee.decodeStyleId(e.styleIdForFill))),e.styleIdForStrokeFill!==void 0&&n(93,$.new32(Ee.decodeStyleId(e.styleIdForStrokeFill))),e.styleIdForEffect!==void 0&&n(95,$.new32(Ee.decodeStyleId(e.styleIdForEffect))),e.styleIdForText!==void 0&&n(94,$.new32(Ee.decodeStyleId(e.styleIdForText))),e.horizontalConstraint!==void 0&&n(20,$.new8(e.horizontalConstraint)),e.verticalConstraint!==void 0&&n(21,$.new8(e.verticalConstraint)),e.scrollBehavior!==void 0&&n(35,$.new38(e.scrollBehavior)),e.keyTrigger!==void 0&&n(80,$.new45(e.keyTrigger)),e.prototypeInteractions!==void 0&&n(82,$.new46(Ee.decodePrototypeInteractions(e.prototypeInteractions))),e.fontSize!==void 0&&n(3,$.new4(e.fontSize)),e.textAlignHorizontal!==void 0&&n(1,$.new8(e.textAlignHorizontal)),e.textAlignVertical!==void 0&&n(2,$.new8(e.textAlignVertical)),e.strokeWeight!==void 0&&n(43,$.new4(e.strokeWeight)),e.hyperlink!==void 0&&n(6,$.new48(e.hyperlink)),e.mention!==void 0&&n(7,$.new49(e.mention)),e.interactiveSlideConfigData!==void 0&&n(86,$.new50(e.interactiveSlideConfigData)),e.interactiveSlideParticipantData!==void 0&&n(87,$.new50(e.interactiveSlideParticipantData)),e.transitionType!==void 0&&e.transitionType=="MAGIC_MOVE"&&n(27,$.new8("SMART_ANIMATE"))}decompressZlibOrZstd(e){let t=new fo;try{let n=Di.inflateRaw(e);t.resolve(n)}catch{let n=new Pp;n.init().then(o=>{t.resolve(n.decode(e))},o=>{t.resolve(null)})}return t}async decodeSceneForViewerAndPrototypeLib1(e,t){return this.decodeSceneForViewerAndPrototypeLib2(e,t,null)}_isProbablyZipFile(e){return e[0]=="P".charCodeAt(0)&&e[1]=="K".charCodeAt(0)}async decodeSceneForViewerAndPrototypeLib2(e,t,n){if(this._isProbablyZipFile(e)){let d=(await new Dl(new Ol(e)).getEntries()).find(c=>c.filename==="canvas.fig");if(!(d!=null&&d.getData))throw new Error("Cannot find canvas.fig in zip file");e=await d.getData(new Fl)}let r=new fo,o=e.length,a=Ee.FILE_HEADER.length;if(Ee.hasFileHeader(e)&&a+4<=o){let s=Ee.readInt32(e,a);if(a=a+4,s>=1&&a+4<=o){let l=Ee.readInt32(e,a);a=a+4,a+l+4<=o?this.decompressZlibOrZstd(e.subarray(a,a+l)).then1(d=>{let c=lh.compileSchema(lh.decodeBinarySchema(d));a=a+l;let p=Ee.readInt32(e,a);if(a=a+4,a+p<=o){let u=e.subarray(a,a+p);a=a+p;let h=!1;for(;a<o;){a+4>e.length&&r.resolve(null);let f=Ee.readInt32(e,a);if(a=a+4,f==0)continue;a+Ee.CHUNK_TAG_LEN>o&&r.resolve(null);let _=e.subarray(a,a+Ee.CHUNK_TAG_LEN);a=a+Ee.CHUNK_TAG_LEN;let m=f-Ee.CHUNK_TAG_LEN;switch(a+m>o&&r.resolve(null),a=a+m,Ee.parseChunkType(_)){case Ee.ChunkType.THUMBNAIL:{h&&r.resolve(null),h=!0;break}case Ee.ChunkType.UNKNOWN:break}}this.decompressZlibOrZstd(new Uint8Array(u)).then1(f=>{let _=c.decodeMessage(f);if(_.type!==void 0&&_.type=="NODE_CHANGES"){let m=It.createScene(It.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,t);n!=null&&m.setFileKey(n),m.applyMessageToScene(f),r.resolve(m)}else r.resolve(null)})}else r.resolve(null)}):r.resolve(null)}else r.resolve(null)}else r.resolve(null);return r.realPromise()}};Ee.VERBOSE=!1,Ee.FILE_HEADER=[102,105,103,45,107,105,119,105],Ee.CHUNK_TAG_LEN=8,Ee.THUMBNAIL_CHUNK_TAG=[137,80,78,71,13,10,26,10];var gt=Ee;(n=>{let i;(a=>(a[a.THUMBNAIL=0]="THUMBNAIL",a[a.UNKNOWN=1]="UNKNOWN"))(i=n.ChunkType||(n.ChunkType={}));class e{constructor(o){this.timeSpentApplyingMessageToSceneMs=o}}n.TimingInfo=e;let t;(o=>{function r(a){return n.ChunkType[a]}o.ChunkType_toString=r})(t=n.in_ChunkType||(n.in_ChunkType={}))})(gt||(gt={}));var io;(r=>{function i(o,a){return o==a?!0:o==26?a==71||a==70:!1}r.affects=i;function e(o){return o==59||o==60||o==52||o==53||o==92||o==93||o==4||o==5}r.affectsImagesUsedByNode=e;function t(o){switch(o){case 97:case 25:case 8:case 26:case 70:case 48:case 16:case 29:case 34:case 65:case 66:case 82:case 69:case 84:case 35:case 46:case 71:case 17:case 47:case 27:case 30:case 31:case 57:case 32:case 67:return!0}return!1}r.isPrototypeStructuralChange=t;function n(o){switch(o){case 29:case 16:case 48:case 80:case 83:case 71:case 27:case 46:case 28:case 47:case 18:case 26:case 70:case 57:case 30:case 17:case 4:case 5:return!0}return!1}r.isInteractionProperty=n})(io||(io={}));var Fd=(q=>(q[q.BOOL=0]="BOOL",q[q.DOUBLE=1]="DOUBLE",q[q.INT=2]="INT",q[q.STRING=3]="STRING",q[q.STRING_ENUM=4]="STRING_ENUM",q[q.AFFINE_TRANSFORM=5]="AFFINE_TRANSFORM",q[q.ARC_DATA=6]="ARC_DATA",q[q.GUID=7]="GUID",q[q.STYLE_ID=8]="STYLE_ID",q[q.OVERLAY_BACKGROUND_APPEARANCE=9]="OVERLAY_BACKGROUND_APPEARANCE",q[q.VECTOR=10]="VECTOR",q[q.EFFECT_LIST=11]="EFFECT_LIST",q[q.PAINT_LIST=12]="PAINT_LIST",q[q.PROTOTYPE_INTERACTION_LIST=13]="PROTOTYPE_INTERACTION_LIST",q[q.GEOMETRY=14]="GEOMETRY",q[q.PARENT_INDEX=15]="PARENT_INDEX",q[q.PROTOTYPE_DEVICE=16]="PROTOTYPE_DEVICE",q[q.PROTOTYPE_STARTING_POINT=17]="PROTOTYPE_STARTING_POINT",q[q.VIDEO_PLAYBACK=18]="VIDEO_PLAYBACK",q[q.KEY_TRIGGER=19]="KEY_TRIGGER",q[q.SYMBOL_DATA=20]="SYMBOL_DATA",q[q.TEXT_DATA=21]="TEXT_DATA",q[q.DERIVED_TEXT_DATA=22]="DERIVED_TEXT_DATA",q[q.VECTOR_DATA=23]="VECTOR_DATA",q[q.HYPERLINK=24]="HYPERLINK",q[q.MENTION=25]="MENTION",q[q.STRING_STRING_MULTIPLAYER_MAP=26]="STRING_STRING_MULTIPLAYER_MAP",q[q.OTHER__=27]="OTHER__",q[q.END__=28]="END__",q))(Fd||{}),GI;(e=>{function i(t){return Fd[t]}e.BindingType_toString=i})(GI||(GI={}));function xd(i){switch(i){case 79:case 91:case 12:case 9:case 13:case 10:case 11:case 14:case 81:case 8:case 16:case 15:case 17:case 18:case 89:case 78:return 0;case 38:case 44:case 45:case 3:case 48:case 37:case 39:case 40:case 41:case 42:case 43:case 46:case 47:return 1;case 64:case 65:return 2;case 70:case 62:case 83:return 3;case 22:case 26:case 20:case 21:case 28:case 29:case 30:case 32:case 34:case 31:case 97:case 35:case 85:case 77:case 23:case 33:case 1:case 2:case 27:case 19:return 4;case 24:return 5;case 63:return 6;case 50:case 51:case 69:case 52:case 53:case 54:case 56:case 55:case 71:return 7;case 92:case 93:case 94:case 95:case 96:return 8;case 67:return 9;case 90:case 57:case 88:case 49:return 10;case 61:return 11;case 58:case 59:case 60:return 12;case 82:return 13;case 73:case 74:return 14;case 25:return 15;case 66:return 16;case 84:return 17;case 80:return 19;case 75:return 20;case 4:return 21;case 5:return 22;case 76:return 23;case 72:return 18;case 6:return 24;case 7:return 25;case 86:case 87:return 26;case 68:case 36:return 27;default:return 28}}function HI(i,e){switch(e){case 22:return be.schema.BlendMode[i];case 26:return be.schema.ConnectionType[i];case 20:return be.schema.ConstraintType[i];case 21:return be.schema.ConstraintType[i];case 28:return be.schema.EasingType[i];case 29:return be.schema.InteractionType[i];case 30:return be.schema.NavigationType[i];case 32:return be.schema.OverlayBackgroundInteraction[i];case 34:return be.schema.ScrollDirection[i];case 31:return be.schema.OverlayPositionType[i];case 97:return be.schema.NodePhase[i];case 35:return be.schema.ScrollBehavior[i];case 85:return be.schema.ShapeWithTextType[i];case 77:return be.schema.StackMode[i];case 23:return be.schema.StrokeAlign[i];case 33:return be.schema.StyleType[i];case 1:return be.schema.TextAlignHorizontal[i];case 2:return be.schema.TextAlignVertical[i];case 27:return be.schema.TransitionType[i];case 19:return be.schema.NodeType[i];default:throw new Error(`Given field ${Ot[e]} is not a string enum field`)}}function ch(i,e,t){switch(xd(t)){case 0:return $.new3(i.getBool(e,t));case 1:return $.new4(i.getDouble(e,t));case 2:return $.new7(i.getInt(e,t));case 3:return $.new8(i.getString(e,t));case 4:return $.new8(HI(i.getInt(e,t),t));case 5:return $.new2(i.getAffineTransform(e,t));case 6:return $.new31(i.getArcData(e,t));case 7:return $.new33(i.getGUID(e,t));case 8:return $.new32(i.getStyleId(e,t));case 10:return $.new10(i.getVector(e,t));case 11:return $.new17(i.getEffectList(e));case 12:return $.new11(i.getPaintList(e,t));case 15:return $.new26(i.getParentIndex(e));case 13:case 9:case 19:case 17:case 16:case 18:case 24:case 25:case 26:return i.getField(e,t);case 20:case 23:return null;case 14:case 21:case 22:case 27:return null;default:return Ke(`Unhandled node field ${Ot[t]} in getCppNodeValue`),null}}function zI(i,e,t,n,r){switch(xd(n)){case 0:return $.new3(i.getBool_SGEO(r));case 1:return $.new4(i.getDouble_SGEO(r));case 2:return $.new7(i.getInt_SGEO(r,n));case 3:return $.new8(i.getString_SGEO(r));case 4:return $.new8(HI(i.getInt_SGEO(r,n),n));case 5:return $.new2(i.getAffineTransform_SGEO(r));case 6:return $.new31(i.getArcData_SGEO(r));case 7:return $.new33(i.getGUID_SGEO(r));case 8:return $.new32(i.getStyleId_SGEO(r));case 10:return $.new10(i.getVector_SGEO(r));case 11:return $.new17(i.getEffectList_SGEO(r));case 12:return $.new11(i.getPaintList_SGEO(r));case 15:return $.new26(i.getParentIndex_SGEO(r));case 13:return $.new46(i.getPrototypeInteractions_SGEO(r));case 9:case 19:case 17:case 16:case 18:case 24:case 25:case 26:return i.getField_SGEO(r);case 20:case 23:return null;case 14:case 21:case 22:case 27:return null;default:return Ke(`Unhandled node field ${Ot[n]} in getCppSGEOValue`),null}}function Or(i,e,t,n){let r=gt.serializeValueToKiwiForTests1(t,n),o=r.a,a=r.b;o.guid=gt.encodeGUID(e.id()),sp(o,a)}var ke=class ke extends lp{constructor(t,n,r){super();this._scene=null,this._id=null,this._scrollingLogic=null,this._handle=0,this._cachedType=null,this._absoluteTransform=Nt.FrozenAffineTransform_IDENTITY,this._flags=5,this._cachedChildren=[],this._cachedParent=null,this._isPartOfLoop=!1,this.transitioningFrom=null,this._lastParent=null,this._lazyInteractionsMigrationValue=null,this._cachedCanvasSpaceGeometryBounds=Jn.FrozenRect_EMPTY,this._cachedCanvasSpaceRenderedBounds=Jn.FrozenRect_EMPTY,this._cachedCanvasSpaceScrollingBounds=Jn.FrozenRect_EMPTY,this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlurs=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null,this._overlayCacheKey=null,this._scene=n,this._id=r,this._scrollingLogic=new Wu(this),this._handle=t}handle(){return this._handle}updateAfterPropertyChange(t){t==25?(this.updateDirtyFlagsForPropertyChange(t,this._lastParent),this._lastParent=this.parent()):this.updateDirtyFlagsForPropertyChange(t,null),t==19&&(this._cachedType=null)}linkToParent(t,n){t!=null&&(this._cachedParent=t,this._addFlagsToSelfAndChildren(1),t._cachedChildren.splice(n,0,this),this.updateIsRooted())}unlinkFromParent(){this._cachedParent!=null&&(ce.List_removeOne(this._cachedParent._cachedChildren,this),this._cachedParent=null,this.updateIsRooted())}hasOverflowingContentInScrollDirection(){return this._scrollingLogic.hasOverflowingContentInScrollDirection()}scrollsInPreferredDirection(t){return this._scrollingLogic.scrollsInPreferredDirection(t)}scrollAndClipBoundsBySelfAndAncestors(t,n){return this._scrollingLogic.scrollAndClipBoundsBySelfAndAncestors(t,n)}canvasSpaceScrolledBounds(t){return this._scrollingLogic.canvasSpaceScrolledBounds(t)}canvasSpaceScrolledInteractiveBounds(t){return this._scrollingLogic.canvasSpaceScrolledInteractiveBounds(t)}scrollDirection(){return this._scrollingLogic.scrollDirection()}scrollDirectionWithScrollableContent(){return this._scrollingLogic.scrollDirectionWithScrollableContent()}isFixed(){return this._scrollingLogic.isFixed()}isStandardScrolling(){return this._scrollingLogic.isStandardScrolling()}isStickyScrolling(){return this._scrollingLogic.isStickyScrolling()}defaultScrollOffset(){return this._scrollingLogic.defaultScrollOffset()}canvasSpaceContentBounds(){return this._scrollingLogic.canvasSpaceContentBounds()}nodeSpaceScrollableContentBounds(){return this._scrollingLogic.nodeSpaceScrollableContentBounds()}minScrollOffsetX(){return this._scrollingLogic.minScrollOffsetX()}minScrollOffsetY(){return this._scrollingLogic.minScrollOffsetY()}maxScrollOffsetX(){return this._scrollingLogic.maxScrollOffsetX()}maxScrollOffsetY(){return this._scrollingLogic.maxScrollOffsetY()}hasOverflowingContentInXDirection(){return this._scrollingLogic.hasOverflowingContentInXDirection()}hasOverflowingContentInYDirection(){return this._scrollingLogic.hasOverflowingContentInYDirection()}isSpreadEligibleNode(){return un.isFrameLike(this.type())?this.isFrameBackgroundVisible()&&this.clipsToBoundingRectangle():un.isRectOrEllipseLike(this.type())}id(){return this._id}isRooted(){return(2&this._flags)!=0}parent(){return this._cachedParent}scene(){return this._scene}isInvisibleOrTransparent(){return!this.visible()||this.opacity()<=0}fillPaintsToRender(){return this.containerSupportsFillStrokeAndCorners()?this.fillPaints():this.has(38)&&this.has(64)?[se.createSolid(this.computedBackgroundColor(),1)]:Oe.EMPTY}computedBackgroundColor(){return this.isBackgroundEnabled()?C.multiplyOpacity(this.backgroundColor(),this.backgroundOpacity()):C.TRANSPARENT}isInsideOutlineMask(){return this.isMask()&&(this.isMaskOutline_DEPRECATED()||this.maskType()=="OUTLINE")||(this.parent()!=null?this.parent().isInsideOutlineMask():!1)}isOrInSymbol(){return this.type()=="SYMBOL"?!0:this.parent()!=null?this.parent().isOrInSymbol():!1}isStack(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().getIsStack(2)}isInstanceSublayer(){return this.stablePath().guids.length>1}isPrimaryInstance(){return this.stablePath().guids.length==1&&this.isInstance()}isState(){return this.type()=="SYMBOL"&&this.parent()!=null&&this.parent().isStateGroup()}isInstance(){return this.type()=="INSTANCE"}isOrInInstance(){return this.isInstanceSublayer()||this.isPrimaryInstance()}isSymbol(){return this.type()=="SYMBOL"}findContainingPrimaryInstance(){return this.isOrInInstance()?this.scene().findNode1(this.stablePath().guids[0]):null}findNearestAncestorSectionOrNull(){let t=this;for(;t!=null&&t.type()!="CANVAS"&&t.type()!="DOCUMENT";){if(t.type()=="SECTION")return t;t=t.parent()}return null}findContainingCanvasOrSelf(){let t=this;for(;t!=null;){if(t.type()=="CANVAS")return t;if(t.parent()==null)break;t=t.parent()}return null}constrainsAnchoredChildren(){return un.isFrameLike(this.type())&&!this.isResizeToFit()}size(){return this._scrollingLogic.nodeSize()}prototypeDevice(){return X.deviceFramesSupported()?this.storedPrototypeDevice():er.DEFAULT}findContainingCanvasOrParent(){let t=this.parent();for(;t!=null&&t.type()!="CANVAS"&&t.parent()!=null;)t=t.parent();return t}guidPath(){return L._prototypeLib.getOverridePath(this)}stablePath(){return L._prototypeLib.getStablePath(this)}removeSelfAndSubtree(){L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().removeSelfAndChildren(2)}type(){if(this._cachedType==null||this._cachedType=="NONE"){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApiGenerated().getType(2);this._cachedType=ke.schema.NodeType[t]}return this._cachedType}setType(t){L._prototypeLib.prepareCppNodeForAccess(this);let n=ke.schema.NodeType[t];L._prototypeLib.nodeTsApiGenerated().setType(n,2)}name(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().getName(2)}setName(t){L._prototypeLib.prepareCppNodeForAccess(this);let n=L._prototypeLib.nodeTsApi().setName(t,2);n!=""&&Ke(n)}scrollOffset(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getScrollOffset(2);return new E(t.x,t.y)}setScrollOffset(t){L._prototypeLib.prepareCppNodeForAccess(this);let n=L._prototypeLib.nodeTsApi().setScrollOffset({x:t.x(),y:t.y()},2);n!=""&&Ke(n)}currentViewportSize(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getCurrentViewportSize(2);return new E(t.x,t.y)}setCurrentViewportSize(t){L._prototypeLib.prepareCppNodeForAccess(this);let n=L._prototypeLib.nodeTsApi().setCurrentViewportSize({x:t.x(),y:t.y()},2);n!=""&&Ke(n)}fullSize(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getSize(2);return new E(t.x,t.y)}setSize(t){L._prototypeLib.prepareCppNodeForAccess(this);let n=L._prototypeLib.nodeTsApi().setSize(t.x(),t.y(),2);n!=""&&Ke(n)}relativeTransform(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getRelativeTransform(2);return new oe(t.m00,t.m01,t.m02,t.m10,t.m11,t.m12)}setRelativeTransform(t){this.setRelativeTransform1(t)}setRelativeTransform1(t){L._prototypeLib.prepareCppNodeForAccess(this);let n=L._prototypeLib.nodeTsApi().setRelativeTransform(t.m00(),t.m01(),t.m02(),t.m10(),t.m11(),t.m12(),2);n!=""&&Ke(n)}interactiveSlideConfigData(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().getInteractiveSlideConfigData(2)}setInteractiveSlideConfigData(t,n){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().setInteractiveSlideConfigData(t,n,2)}interactiveSlideParticipantData(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().getInteractiveSlideParticipantData(2)}setInteractiveSlideParticipantData(t,n){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().setInteractiveSlideParticipantData(t,n,2)}stackMode(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getStackMode(2);return ke.schema.StackMode[t]}setStackMode(t){L._prototypeLib.prepareCppNodeForAccess(this);let n=ke.schema.StackMode[t];L._prototypeLib.nodeTsApi().setStackMode(n,2)}arcData(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().getArcData(2)}setArcData(t){L._prototypeLib.prepareCppNodeForAccess(this);let n=L._prototypeLib.nodeTsApi().setArcData(t.startingAngle,t.endingAngle,t.innerRadius,2);n!=""&&Ke(n)}backgroundColor(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getBackgroundColor(2);return C.new3(t.red,t.green,t.blue,t.alpha)}setBackgroundColor(t){L._prototypeLib.prepareCppNodeForAccess(this);let n=L._prototypeLib.nodeTsApi().setBackgroundColor(C.toColorF(t),2);n!=""&&Ke(n)}prototypeBackgroundColor(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getPrototypeBackgroundColor(2);return C.fromColorF(t)}setPrototypeBackgroundColor(t){L._prototypeLib.prepareCppNodeForAccess(this);let n={red:C.redF(t),green:C.greenF(t),blue:C.blueF(t),alpha:C.alphaF(t)},r=L._prototypeLib.nodeTsApi().setPrototypeBackgroundColor(n,2);r!=""&&Ke(r)}parentIndex(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getParentIndex(2),n=t.parent;return new qn(n,t.position)}setParentIndex(t){L._prototypeLib.prepareCppNodeForAccess(this);let n={parent:t.id,position:t.position},r=L._prototypeLib.nodeTsApi().setParentIndex(n,2);r!=""&&Ke(r)}fillPaints(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getFillPaints(2);return Hr.WeakHandle_isValid(t)?L._prototypeLib.modules().paintData_Internal.getOrCreateSkewCopy(t):[]}getBoundVariables(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().getBoundVariables(2)}getResolvedVariableModes(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().getResolvedVariableModes(2)}setTestOnlyFillPaints(t){or("Paint serialization only partially implemented in Skew"),Or(L._prototypeLib,this,59,$.new11(t))}setTestOnlyFillPaints1(t){or("Paint serialization only partially implemented in Skew"),Or(L._prototypeLib,this,59,$.new12(t))}setTestOnlyFillPaints2(t){or("Paint serialization only partially implemented in Skew"),Or(L._prototypeLib,this,59,$.new14(t))}setTestOnlyFillPaints3(t){or("Paint serialization only partially implemented in Skew"),Or(L._prototypeLib,this,59,$.new16(t))}strokePaints(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getStrokePaints(2);return Hr.WeakHandle_isValid(t)?L._prototypeLib.modules().paintData_Internal.getOrCreateSkewCopy(t):[]}setTestOnlyStrokePaints(t){or("Paint serialization only partially implemented in Skew"),Or(L._prototypeLib,this,60,$.new11(t))}setTestOnlyStrokePaints1(t){or("Paint serialization only partially implemented in Skew"),Or(L._prototypeLib,this,60,$.new12(t))}setTestOnlyStrokePaints2(t){or("Paint serialization only partially implemented in Skew"),Or(L._prototypeLib,this,60,$.new16(t))}setTestOnlyStrokePaints3(t){or("Paint serialization only partially implemented in Skew"),Or(L._prototypeLib,this,60,$.new14(t))}effects(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getEffects(2);return Hr.WeakHandle_isValid(t)?L._prototypeLib.modules().effectData_Internal.getOrCreateSkewCopy(t):null}setTestOnlyEffects(t){or("Effect serialization only partially implemented in Skew"),Or(L._prototypeLib,this,61,$.new17(t))}setTestOnlyEffects1(t){or("Effect serialization only partially implemented in Skew"),Or(L._prototypeLib,this,61,$.new19(t))}setTestOnlyEffects2(t){or("Effect serialization only partially implemented in Skew"),Or(L._prototypeLib,this,61,$.new18(t))}symbolID(){return this.isInstance()?(L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().getSymbolId(2)):ne.invalid()}setTestOnlySymbolData(t){or("SymbolData serialization only partially implemented in Skew"),Or(L._prototypeLib,this,75,$.new34(t))}fillGeometry(){if(2==0&&un.isFrameLike(this.type())&&this.containerSupportsFillStrokeAndCorners())return ii(this.canvasSpaceBoundingBox());L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getFillGeometryRegions(2);return L._prototypeLib.idlRegionsToGeometry(t,null)}setTestOnlyFillGeometry(t){or("Geometry serialization only partially implemented in Skew"),Or(L._prototypeLib,this,73,$.new27(t))}strokeGeometry(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getStrokeGeometryRegions(2);return L._prototypeLib.idlRegionsToGeometry(t,null)}setTestOnlyStrokeGeometry(t){or("Geometry serialization only partially implemented in Skew"),Or(L._prototypeLib,this,74,$.new27(t))}textGeometry(){let t=this.textData();if(t==null)return null;L._prototypeLib.prepareCppNodeForAccess(this);let n=L._prototypeLib.nodeTsApi().getTextGeometryRegions(2),r=new ho(t.styleOverrideTable());return L._prototypeLib.idlRegionsToTextGeometry(n,r)}prototypeInteractions(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getPrototypeInteractions(2);return Hr.WeakHandle_isValid(t)?L._prototypeLib.modules().prototypeInteractions_Internal.getOrCreateSkewCopy(t):[]}setTestOnlyPrototypeInteractions(t){or("PrototypeInteraction[] serialization only partially implemented in Skew"),Or(L._prototypeLib,this,82,$.new46(t))}prototypeStartingPoint(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getPrototypeStartingPoint(2);if(t==null)return null;let n=t;return new Xo(n.name,n.description,dn.fromString(n.position))}setPrototypeStartingPoint(t){L._prototypeLib.prepareCppNodeForAccess(this);let n={name:t.name,description:t.description,position:dn.toString(t.position)},r=L._prototypeLib.nodeTsApi().setPrototypeStartingPoint(n,2);r!=""&&Ke(r)}storedPrototypeDevice(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getPrototypeDevice(2);if(t==null)return null;let n=t;return new er(ke.schema.PrototypeDeviceType[n.type],new E(n.size.x,n.size.y),n.presetIdentifier,ke.schema.DeviceRotation[n.rotation])}setPrototypeDevice(t){L._prototypeLib.prepareCppNodeForAccess(this);let n={type:ke.schema.PrototypeDeviceType[t.type],size:{x:t.size().x(),y:t.size().y()},presetIdentifier:t.presetIdentifier,rotation:ke.schema.DeviceRotation[t.rotation]};L._prototypeLib.nodeTsApi().setPrototypeDevice(n,2)}overlayBackgroundAppearance(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getOverlayBackgroundAppearance(2);if(t==null)return null;let n=t;return new Ro(ke.schema.OverlayBackgroundType[n.backgroundType],C.fromColorF(n.backgroundColor))}setOverlayBackgroundAppearance(t){L._prototypeLib.prepareCppNodeForAccess(this);let n={backgroundType:ke.schema.OverlayBackgroundType[t.backgroundType],backgroundColor:C.toColorF(t.backgroundColor)},r=L._prototypeLib.nodeTsApi().setOverlayBackgroundAppearance(n,2);r!=""&&Ke(r)}textData(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getTextData(2);return Hr.WeakHandle_isValid(t)?L._prototypeLib.modules().textData_Internal.getOrCreateSkewCopy(t):null}setTestOnlyTextData(t){or("TextData serialization only partially implemented in Skew"),Or(L._prototypeLib,this,4,$.new21(t))}derivedTextData(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getDerivedTextData(2);return Hr.WeakHandle_isValid(t)?L._prototypeLib.modules().derivedTextData_Internal.getOrCreateSkewCopy(t):null}setTestOnlyDerivedTextData(t){or("DerivedTextData serialization only partially implemented in Skew"),Or(L._prototypeLib,this,5,$.new22(t))}vectorData(){L._prototypeLib.prepareCppNodeForAccess(this);let t=L._prototypeLib.nodeTsApi().getVectorData(2);return Hr.WeakHandle_isValid(t)?L._prototypeLib.modules().compiledVectorData_Internal.getOrCreateSkewCopy(t):null}videoPlayback(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().getVideoPlayback(2)}setVideoPlayback(t){L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().setVideoPlayback(t,2)}accessibleLabel(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().getAccessibleLabel(2)}has(t){return L._prototypeLib.getHas(this,t)}get1(t,n){let r=ch(L._prototypeLib,this,t);return r!=null?r:n}each(t){L._prototypeLib.forEachField(this,n=>{t(n,this.get2(n))})}isVisibleInCanvas(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().isVisibleInCanvas(2)}supportsBackgroundPaints(){return un.isFrameLike(this.type())&&!this.containerSupportsFillStrokeAndCorners()}supportsGeometry(){return un.isGeometryLeaf(this.type())||un.isFrameLike(this.type())&&this.containerSupportsFillStrokeAndCorners()}findPrototypeInteraction(t){if(t==null)return null;let n=this.prototypeInteractions().filter(r=>ne.equals(r.id(),t));return n.length==0?null:(n.length>1&&Ke("Found multiple prototype interactions with the same GUID"),n[0])}get2(t){return this.get1(t,null)}updateDirtyFlagsForPropertyChange(t,n){this._handlePropertyChangeForTransform(t),this._handlePropertyChangeForBounds(t,n),this._handlePropertyChangeForRenderTree(t,n),this._handlePropertyChangeForInteractions(t)}_handlePropertyChangeForTransform(t){if((t==89||t==24||t==66||t==35||t==90)&&this._addFlagsToSelfAndChildren(1),t==20||t==21){let n=this;for(;n!=null&&!(n.isFixed()||n.hasOwnConstraintValues());)n=n.parent();n!=null&&n.isFixed()&&n.dirtyTransform()}}_handlePropertyChangeForInteractions(t){io.isInteractionProperty(t)&&(this._lazyInteractionsMigrationValue=null)}map(t){return this._cachedChildren.map(t)}forEachChild(t){this._cachedChildren.forEach(t)}forEachDescendantPreorder(t){this._cachedChildren.forEach(n=>{t(n),n.forEachDescendantPreorder(t)})}childCount(){return this._cachedChildren.length}childAt1(t){return this.childAt2(t,!1)}childAt2(t,n){return n&&this.stackReverseZIndex()&&this.isStack()?this._cachedChildren[this.childCount()-t-1]:this._cachedChildren[t]}indexInParent(){if(this._cachedParent==null)return-1;let t=this._cachedParent._cachedChildren.indexOf(this);return this._cachedParent.stackReverseZIndex()&&this._cachedParent.isStack()&&(t=this._cachedParent.childCount()-t-1),t}updateIsRooted(){let t=this._cachedParent!=null?this._cachedParent.isRooted():this==this._scene.root();if(t!=this.isRooted()){this._flags=t?this._flags|2:this._flags&-3,t&&this._addFlagsToSelfAndChildren(1);for(let n of this._cachedChildren)n.updateIsRooted()}}appendChild(t){let n=this._cachedChildren.length==0?dn.FIRST_POSITION:dn.after(ce.List_last(this._cachedChildren).parentIndex().position);t.setParentIndex(new qn(this.id(),n))}collectUniqueUsedImages(){let t=new Map;return this.forEachSinglePaint(n=>{(n.type()=="IMAGE"||n.type()=="EMOJI"||n.type()=="VIDEO")&&(n.image()!=null&&t.set(n.image().objectHash(),n.image()),n.imageThumbnail()!=null&&t.set(n.imageThumbnail().objectHash(),n.imageThumbnail()))}),this.forEachEmojiInTextData(n=>{t.set(n.objectHash(),n)}),t}forEachSinglePaint(t){var r,o;let n=a=>{let s=a.asVolatilePaint();s!=null&&(t(s.from()),t(s.to()));let l=a.asSinglePaint();l!=null&&t(l)};this.fillPaints().forEach(n),this.strokePaints().forEach(n),(o=(r=this.textData())==null?void 0:r.styleOverrideTable())==null||o.forEachFillPaint(this.scene(),a=>{a.forEach(n)}),this.hasPerRegionFillPaints()&&this.forEachRegionWithFillPaintBatch((a,s)=>{s.forEach(n)})}forEachEmojiInTextData(t){var n,r,o;this._cachedType=="TEXT"&&(((n=this.derivedTextData())==null?void 0:n.usedEmojiImages())!=null?this.derivedTextData().usedEmojiImages().forEach(a=>{t(a)}):(o=(r=this.textData())==null?void 0:r.usedEmojiImagesDEPRECATED())==null||o.forEach(a=>{t(a)}))}textHyperlinkBoxes(){var t,n,r;return this._cachedType!="TEXT"?[]:((t=this.derivedTextData())==null?void 0:t.hyperlinkBoxes())!=null?this.derivedTextData().hyperlinkBoxes():(r=(n=this.textData())==null?void 0:n.hyperlinkBoxesDEPRECATED())!=null?r:[]}textHasMixedFontSizes(){return this._cachedType!="TEXT"?!1:this.derivedTextData()!=null?this.derivedTextData().hasMixedFontSizes():this.textData()!=null?this.textData().hasMixedFontSizesDEPRECATED():!1}restartGifs(){this.forEachSinglePaint(t=>{let n=t.image();if(n==null||!n.isGIF())return;let r=n.gif();r!=null&&r.restart()})}clipsToBoundingRectangle(){return un.isFrameLike(this.type())&&!this.isFrameMaskDisabled()&&!this.isResizeToFit()}isAxisAligned(){let n=this.absoluteTransform();return Math.abs(n.m00())<1e-4&&Math.abs(n.m11())<1e-4||Math.abs(n.m01())<1e-4&&Math.abs(n.m10())<1e-4}isAxisAlignedRectFill(){return this.fillGeometry()!=null&&this.fillPaints().length!=0&&this.strokePaints().length==0&&this.fillGeometry().isRect()&&this.isAxisAligned()}isInSymbol(){let t=!1;for(let n=this;n!=null;n=n.parent())if(n.type()=="SYMBOL"){t=!0;break}return t}_addScrollableChildFramesToListRecursive(t){for(let n of this._cachedChildren)n.scrollDirection()!="NONE"&&t.push(n),n._addScrollableChildFramesToListRecursive(t)}scrollableFrameDescendants(){let t=[];return this._addScrollableChildFramesToListRecursive(t),t}isGroup(){return un.isFrameLike(this.type())&&this.isResizeToFit()}hasOwnConstraintValues(){return this.type()!="BOOLEAN_OPERATION"&&this.type()!="CANVAS"&&this.type()!="DOCUMENT"&&!this.isGroup()}_collectConstraintValuesInSubtree(t){let n=null;return ke.forEachNode1(this,r=>{if(!r.hasOwnConstraintValues())return ke.Loop.CONTINUE;let o=t(r);if(n==null)n=new Se(o);else if(n.value!=o)return n=null,ke.Loop.BREAK;return ke.Loop.SKIP}),n}horizontalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(t=>t.horizontalConstraint())}verticalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(t=>t.verticalConstraint())}_withOverriddenFrameRole(t,n){this._scrollingLogic.overrideRole(t),this._addFlagsToSelfAndChildren(1),this._invalidateRenderTreeForSelf();for(let r=0,o=this.childCount();r<o;r=r+1){let a=this.childAt1(r);a.isFixed()&&ke.forEachNode2(a,s=>{s._invalidateRenderTreeForSelf()})}n(),this._scrollingLogic.clearRoleOverride()}actingAsOverlayOrSublayerForRendertreeGeneration(t){this._withOverriddenFrameRole(1,t)}actingAsBaseScreenForRendertreeGeneration(t){this._withOverriddenFrameRole(0,t)}_translateFixedElementIfNecessary(t){if(!this.isFixed()||this.parent()==null||this.parent().scrollDirection()=="NONE")return;let n=this.parent();if(hr.scrollsHorizontally(n.scrollDirection())){let r=this.horizontalConstraintOfSubtree();r!=null&&(r.value=="MAX"?t.translate2(n.size().x()-n.fullSize().x(),0):r.value=="CENTER"&&t.translate2((n.size().x()-n.fullSize().x())/2,0))}if(hr.scrollsVertically(n.scrollDirection())){let r=this.verticalConstraintOfSubtree();r!=null&&(r.value=="MAX"?t.translate2(0,n.size().y()-n.fullSize().y()):r.value=="CENTER"&&t.translate2(0,(n.size().y()-n.fullSize().y())/2))}}hasPerRegionFillPaints(){if(this.type()!="VECTOR"||this.fillGeometry()==null)return!1;let t=this.fillGeometry().styleIDs;return t==null?!1:t.some(n=>n!=0)}forEachRegionWithFillPaintBatch(t){var a;let n=this.fillGeometry(),r=(a=this.vectorData())==null?void 0:a.paintOverrides,o=this.fillPaints();if(!(r==null||n==null))for(let s=0;s<n.regions.length;s=s+1){let l=o;if(s<n.styleIDs.length){let c=n.styleIDs[s],p=r.get(c,this.scene());p!=null&&(l=p)}let d=n.regions[s];t(d,l)}}relativeTransformAccountingForFixedOffset(){let t=this.relativeTransform().clone();return this._translateFixedElementIfNecessary(t),t}absoluteTransform(){if(this.isRooted()&&1&this._flags){let t=this.relativeTransformAccountingForFixedOffset();if(this._cachedParent!=null){let n=this._cachedParent.absoluteTransform().clone();n.multiply(t),t=n}this._absoluteTransform=t,this._flags&=-2}return this._absoluteTransform}dirtyTransform(){this._addFlagsToSelfAndChildren(1),this._addFlagsToSelfAndChildren(4)}copyNodeCachedTransformAndBounds(t){this._absoluteTransform=t._absoluteTransform,this._cachedCanvasSpaceGeometryBounds=t._cachedCanvasSpaceGeometryBounds,this._cachedCanvasSpaceRenderedBounds=t._cachedCanvasSpaceRenderedBounds,this._cachedCanvasSpaceScrollingBounds=t._cachedCanvasSpaceScrollingBounds}_addFlagsToParents(t){this.parent()!=null&&this.parent()._addFlagsToSelfAndParents(t)}_addFlagsToSelfAndParents(t){for(let n=this;n!=null;n=n.parent())n._flags|=t}_addFlagsToSelfAndChildren(t){this._flags|=t;for(let n of this._cachedChildren)n._addFlagsToSelfAndChildren(t)}isFrameBackgroundVisible(){if(!un.isFrameLike(this.type()))return!1;let t=this.containerSupportsFillStrokeAndCorners()?this.fillPaints():null;if(t==null)return C.alpha(this.computedBackgroundColor())>0;for(let n=0,r=t.length;n<r;n=n+1)if(t[n].isEnabledAndVisible())return!0;return!1}hasBackgroundBlurs(){if(this.effects().filter(n=>n.type()=="BACKGROUND_BLUR").length>0)return!0;let t=!1;return this.forEachChild(n=>{n.hasBackgroundBlurs()&&(t=!0)}),t}hasNonZeroStrokeWeight(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().getHasNonZeroStrokeWeight(2)}styleId(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().styleId(2)}inheritedStyleId(t){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().inheritedStyleId(t,2)}setInheritStyleId(t,n){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().setInheritStyleId(t,n,2)}setStyleSortPosition(t){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().setStyleSortPosition(t,2)}tableCellRowId(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().tableCellColumnId(2)}tableCellColumnId(){return L._prototypeLib.prepareCppNodeForAccess(this),L._prototypeLib.nodeTsApi().tableCellColumnId(2)}getTableCellAt(t,n){L._prototypeLib.prepareCppNodeForAccess(this);let r=L._prototypeLib.nodeTsApi().getTableCellGuid(2,t,n);return this._scene.findNode1(r)}canvasSpaceGeometryBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceGeometryBounds}canvasSpaceRenderedBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceRenderedBounds}canvasSpaceScrollingBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceScrollingBounds}canvasSpaceInteractiveBounds(){let t=this.fillOrTextGeometry(),n=this.strokeGeometry(),r=U.new2(),o=this.size();r.setTo1(0,0,o.x(),o.y());let a=new Tt;a.include3(r),t!=null&&a.include3(t.bounds),n!=null&&this.strokeAlign()!="INSIDE"&&a.include3(n.bounds);let s=a.build();return s.transformInto1(s,this.absoluteTransform()),s}canvasSpacePreviewBounds(){let t=this.strokeGeometry(),n=U.new2();n.setTo1(0,0,this.fullSize().x(),this.fullSize().y());let r=new Tt;r.include3(n),t!=null&&this.strokeAlign()!="INSIDE"&&r.include3(t.bounds);let o=r.build();if(o.transformInto1(o,this.absoluteTransform()),this._scrollingLogic.shouldResizeToFitViewport()){let a=this.parent().prototypeDevice(),s=a.type=="NONE"||a.type=="PRESENTATION"?this.parent().currentViewportSize():a.size(),l=this.findContainingCanvasOrParent();if(a=l.prototypeDevice(),s=a.type=="NONE"||a.type=="PRESENTATION"?l.currentViewportSize():a.size(),!o.size().min2(s).equals(o.size())){let d=U.new4(this.canvasSpaceBoundingBox().topLeft(),s);o.intersectWith(d)}}return o}canvasSpaceBoundingBox(){let t=U.new2(),n=this.size();return t.setTo1(0,0,n.x(),n.y()),t.transformInto1(t,this.absoluteTransform()),t}fullSizeCanvasSpaceBoundingBox(){let t=U.new2();return t.setTo1(0,0,this.fullSize().x(),this.fullSize().y()),t.transformInto1(t,this.absoluteTransform()),t}_updateBoundsIfNeeded(){if(!this.isRooted()||!(4&this._flags))return;for(let r of this._cachedChildren)r._updateBoundsIfNeeded();ke._geometryBuilder.reset(),ke._renderedBuilder.reset(),ke._scrollingBuilder.reset(),ke._effectBuilder.reset();let t=0,n=this.effects();for(let r=0,o=n.length;r<o;r=r+1){let a=n[r];a.isEnabledAndVisible()&&a.type()=="FOREGROUND_BLUR"&&(t+=a.blurRadius())}t>0&&(ke._effectBuilder.include1(-t,-t),ke._effectBuilder.include1(t,t));for(let r=0,o=n.length;r<o;r=r+1){let a=n[r];if(a.isEnabledAndVisible()&&a.type()=="DROP_SHADOW"){let s=t+a.blurRadius()+a.spread();ke._effectBuilder.include1(a.blurOffset().x()-s,a.blurOffset().y()-s),ke._effectBuilder.include1(a.blurOffset().x()+s,a.blurOffset().y()+s)}}if(un.isGeometryLeaf(this.type())){let r=this.fillOrTextGeometry(),o=this.strokeGeometry(),a=this.absoluteTransform();r!=null&&ke._geometryBuilder.include4(r.bounds,a),o!=null&&(this.strokeAlign()!="INSIDE"||r==null||r.regions.length==0||r.bounds.isInvalid())&&ke._geometryBuilder.include4(o.bounds,a)}else for(let r of this._cachedChildren)r.isInvisibleOrTransparent()||(ke._geometryBuilder.include3(r._cachedCanvasSpaceGeometryBounds),ke._renderedBuilder.include3(r._cachedCanvasSpaceRenderedBounds)),r.visible()&&ke._scrollingBuilder.include3(r._cachedCanvasSpaceScrollingBounds);if(un.isFrameLike(this.type())){let r=this.canvasSpaceBoundingBox();if(this.clipsToBoundingRectangle()){let o=ke._geometryBuilder.build(),a=ke._renderedBuilder.build(),s=ke._scrollingBuilder.build();o.intersectWith(r),a.intersectWith(r),s.intersectWith(r),ke._geometryBuilder.reset(),ke._renderedBuilder.reset(),ke._scrollingBuilder.reset(),ke._geometryBuilder.include3(o),ke._renderedBuilder.include3(a),ke._scrollingBuilder.include3(s)}if(this.containerSupportsFillStrokeAndCorners()){let o=this.fillOrTextGeometry(),a=this.strokeGeometry(),s=this.absoluteTransform();o!=null&&ke._geometryBuilder.include4(o.bounds,s),a!=null&&(this.strokeAlign()!="INSIDE"||o==null||o.regions.length==0||o.bounds.isInvalid())&&ke._geometryBuilder.include4(a.bounds,s)}(this.isFrameBackgroundVisible()||this.parent()!=null&&this.parent().type()=="CANVAS"&&this.clipsToBoundingRectangle())&&(ke._geometryBuilder.include3(r),ke._renderedBuilder.include3(r)),ke._scrollingBuilder.include3(r)}this._cachedCanvasSpaceGeometryBounds=ke._geometryBuilder.build(),ke._renderedBuilder.include3(this._cachedCanvasSpaceGeometryBounds),ke._scrollingBuilder.include3(this._cachedCanvasSpaceGeometryBounds),ke._effectBuilder.isValidOrZeroArea()&&(ke._effectBuilder.buildTo(ke._effectBounds),ke._renderedBuilder.include3(ke._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,ke._effectBounds)),ke._scrollingBuilder.include3(ke._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,ke._effectBounds))),this._cachedCanvasSpaceRenderedBounds=ke._renderedBuilder.build(),this._cachedCanvasSpaceScrollingBounds=ke._scrollingBuilder.build(),this._flags&=-5}_handlePropertyChangeForBounds(t,n){switch(t){case 22:case 20:case 21:case 12:case 51:case 75:case 62:case 26:case 70:case 28:case 48:case 16:case 29:case 65:case 66:case 69:case 46:case 71:case 17:case 47:case 27:case 30:case 88:break;case 64:case 8:{this._addFlagsToParents(4);break}default:{this._addFlagsToParents(4),this._addFlagsToSelfAndChildren(4),t==25&&n!=null&&n._addFlagsToSelfAndParents(4);break}}}developerFriendlyId(){if(this.type()=="TABLE_CELL"){let r=this.parent();return r==null?(console.error("Orphaned table cell"),null):"T"+[r.id(),this.tableCellRowId(),this.tableCellColumnId()].map(a=>a).join(";")}if(!this.isInstanceSublayer())return this.id();let t=this;for(;t!=null&&!t.isPrimaryInstance();)t=t.parent();return t==null?(console.error("Unable to find primary instance backing node"),null):"I"+this.stablePath().guids.map(r=>r).join(";")}fillOrTextGeometry(){return this.type()=="TEXT"?this.textGeometry():this.fillGeometry()}fillRegionPaints(){return ke._computeRegionPaintsFromStyles(this.fillOrTextGeometry(),this.fillPaints(),this.scene())}strokeRegionPaints(){return ke._computeRegionPaintsFromStyles(this.strokeGeometry(),this.strokePaints(),this.scene())}hasMoreThanOneCornerRadius(){let t=this.rectangleTopLeftCornerRadius();return this.rectangleTopRightCornerRadius()!=t||this.rectangleBottomLeftCornerRadius()!=t||this.rectangleBottomRightCornerRadius()!=t}roundedRectInfo(){return this._instantiateRoundedRect()}_instantiateRoundedRect(){if(this.rectangleCornerRadiiIndependent()){let t=[this.rectangleTopLeftCornerRadius(),this.rectangleTopRightCornerRadius(),this.rectangleBottomRightCornerRadius(),this.rectangleBottomLeftCornerRadius()];return new os(1,ve.FrozenVector_ZERO,this.size(),t,this.cornerSmoothing())}else return new os(0,ve.FrozenVector_ZERO,this.size(),this.cornerRadius(),this.cornerSmoothing())}fillGeometryForSpread(t,n,r){let o=null;if(this.type()=="ELLIPSE")if(X.getFeatureFlags().arcsSpreadShadow){let a={m00:t.m00(),m01:t.m01(),m02:t.m02(),m10:t.m10(),m11:t.m11(),m12:t.m12()},s=L._prototypeLib.getFillGeometryForSpread(a,n,this);o=new Eo(s)}else{let a=new U(0,0,this.size().x(),this.size().y());t.transformRect(a),o=ui.fromBounds(a)}else{let a=this._instantiateRoundedRect();a.transform(t),a.adjustCornerRadiiForSpread(n),o=Pt.fromRoundedRect(a)}return new on(new Lt(o,"NONZERO"),r)}strokeGeometryForSpread(t,n,r,o){let a=null,s=this.strokeAlign()=="INSIDE"?2:this.strokeAlign()=="CENTER"?1:0,l=!r.subtract(2*n+s*this.strokeWeight()).isPositive(),d=2-s;if(Oe.containsAtLeastOneVisiblePaint(this.fillPaints())||l){let c=oe.new2(),u=r.add(this.strokeWeight()*d).add(2*n).divide1(r),h=-n-this.strokeWeight()*d/2;if(c.translate2(h,h),c.scale3(u),this.type()=="ELLIPSE"){let f=new U(0,0,this.size().x(),this.size().y());c.transformRect(f),a=Rt.forEllipse(f)}else{let f=this._instantiateRoundedRect();f.transform(c),a=Rt.fromRoundedRectWithSpread(f,n+d*this.strokeWeight()/2)}}else{if(this.strokeWeight()+2*n<=0)return null;if(this.type()=="ELLIPSE"){let c=U.new4(ve.FrozenVector_ZERO,this.size());t.transformRect(c),c.expand1(d*this.strokeWeight()/2),a=Rt.forEllipse(c),c.contract(2*n+this.strokeWeight()),a.append(Rt.forEllipse(c))}else{let c=this._instantiateRoundedRect();c.transform(t),c.expand(d*this.strokeWeight()/2),a=Rt.fromRoundedRectWithSpread(c,n+d*this.strokeWeight()/2),c.contract(2*n+this.strokeWeight()),a.append(Rt.fromRoundedRectWithSpread(c,-(2*n+this.strokeWeight())))}}return new on(new Lt(a,"ODD"),o)}isTopLevel(){return this.parent()!=null&&this.parent().isTopLevelParent()}isTopLevelParent(){return ke.isTopLevelParentNodeType(this.type())}static isTopLevelParentNodeType(t){return t=="CANVAS"||t=="SECTION"}isTopLevelFrame(){let t=this.type()=="FRAME";return this.isTopLevel()&&t}topLevelAncestor(){let t=this;for(;t!=null;){if(t.isTopLevel())return t;t=t.parent()}return null}canvas(){var r,o;let t=this.type()=="CANVAS"?this:(r=this.topLevelAncestor())==null?void 0:r.parent();return t=((o=this.topLevelAncestor())==null?void 0:o.parent().type())=="SECTION"?this.findContainingCanvasOrParent():t,t}isAncestorOf(t){for(let n=t;n!=null;n=n.parent())if(n==this)return!0;return!1}forSelfAndAncestors(t){for(let n=this;n!=null;n=n.parent())t(n)}findContainingStateGroupOrSelf(){for(let t=this;t!=null;t=t.parent())if(t.isStateGroup())return t;return null}findContainingScrollingFrameOrSelf(){for(let t=this;t!=null;t=t.parent())if(t.scrollDirection()!="NONE"&&!t.isTooRotatedToScroll())return t;return null}findContainingInstanceOrSelf(){for(let t=this;t!=null;t=t.parent())if(t.type()=="INSTANCE")return t;return null}findAllSectionsInNode(){let t=this,n=[];n.push(t);let r=[];for(;n.length>0;){let o=n.shift();for(let a=0,s=o.childCount();a<s;a=a+1){let l=o.childAt1(a);l!=null&&l.type()=="SECTION"&&(n.push(l),r.push(l))}}return r}findFirstTopLevelFrameInSection(){let t=this,n=[];for(n.push(t);n.length>0;){let r=n.shift();for(let o=0,a=r.childCount();o<a;o=o+1){let s=r.childAt1(o);if(s.isTopLevelFrame())return s;s.type()=="SECTION"&&n.push(s)}}return t}findAllTopLevelNodesInNode(t){let n=[];if(t.type()!="CANVAS"&&t.type()!="SECTION")return n;let r=[];for(r.push(t);r.length>0;){let o=r.shift();for(let a=0,s=o.childCount();a<s;a=a+1){let l=o.childAt1(a);l.type()=="SECTION"&&r.push(l),n.push(l)}}return n}buildAncestors(){let t=[];return this.forSelfAndAncestors(n=>{t.push(n)}),t.reverse(),t}isAboveInLayerOrder(t){let n=this.buildAncestors(),r=t.buildAncestors();for(let o=0,a=Math.min(n.length,r.length);o<a;o=o+1)if(n[o]!=r[o]){let s=n[o],l=r[o];return s.indexInParent()>l.indexInParent()}return n.length==r.length?!1:n.length>r.length}isTooRotatedToScroll(){return Math.abs(this.absoluteTransform().toAngle())>=Math.PI/180}debugString(){let t="";if(t+=this.hierarchyString()+`

`,this.type()=="INSTANCE"){let n=`stablePath: ${this.stablePath()}`;t+=n+`

`}return t+=`{
`,this.each((n,r)=>{t+=`  ${Ot[n]}: ${$.toString(r)}
`}),t+="}",t+=`

`,t}paintsDebugString(){let t=this.strokePaints().some(n=>n.isEnabledAndVisible())?` strokeAlign=${this.strokeAlign()} weight=${this.strokeWeight()}`:"";return`Node type=${this.type()} size=${this.size()}
 -- fills=[${this.fillPaints().map(n=>n.debugString()).join(", ")}]
 -- strokes=[${this.strokePaints().map(n=>n.debugString()).join(", ")}]`+t}_makeIndent(t,n){let o="";if(n){for(let a=0,s=2*(t-1);a<s;a=a+1)o+="-";return o+="> ",o}else{for(let a=0,s=2*t;a<s;a=a+1)o+=" ";return o}}hierarchyString(){let t=[],n=this._hierarchyStringForAncestors(t);return n==0&&(t.push("(null parent)"),n=n+1),this._hierarchyStringWithChildren(n,!0,t),t.join(`
`)}_hierarchyStringLocal(t,n){var o,a;let r=this._makeIndent(t,n);return r+=`${this.type()}: '${(o=this.name())!=null?o:"null"}' (${this.id()})`,(this.isInstanceSublayer()||this.isPrimaryInstance())&&(r+=` stablePath: ${this.stablePath()}`),this.isInSymbol()&&(r+=` (overrideKey: ${this.overrideKey()})`),this.type()=="INSTANCE"&&(r+=` (symbol: ${(a=this.symbolID())!=null?a:"null"})`),r+=` hasBeenLoaded: ${this.hasBeenLoaded()?"\u2714":"\u25FB\uFE0F"}`,r}_hierarchyStringForAncestors(t){let n=0,r=[];for(this.forSelfAndAncestors(o=>{o!=this&&r.push(o)});r.length>0;)t.push(r.pop()._hierarchyStringLocal(n,!1)),n=n+1;return n}_hierarchyStringWithChildren(t,n,r){r.push(this._hierarchyStringLocal(t,n));for(let o=0,a=this.childCount();o<a;o=o+1)this.childAt1(o)._hierarchyStringWithChildren(t+1,!1,r)}_invalidateRenderTreeForSelf(){this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlurs=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null}invalidateRenderTreeForSelfAndParents(){for(let t=this;t!=null;t=t.parent())t._invalidateRenderTreeForSelf()}invalidateRenderTreeForChildren(){for(let t=0,n=this.childCount();t<n;t=t+1){let r=this.childAt1(t);r._invalidateRenderTreeForSelf(),r.invalidateRenderTreeForChildren()}}invalidateNestedBackgroundBlurRenderTrees(t,n){var s;let r=this.topLevelAncestor();if(!this.isTopLevelParent()&&(r==null||!t.has(r.id()))&&(Un.didEncounterNestedBBNotInDirtyNodes(),X.viewerSkipNotDirtyTreeOpt()))return!1;let o=(s=this._renderTree)==null?void 0:s.value;if(o!=null&&!o.hasBackgroundBlurs())return!1;if(this.transitioningFrom!=null){if(o==null||o.hasBackgroundBlurs()){let l=this.topLevelAncestor();if(l!=null&&t.has(l.id()))return this._invalidateRenderTreeForSelf(),!0}return!1}if(this.isInvisibleOrTransparent()&&(Un.didEncounterNestedBBInvisible(),X.viewerSkipInvisibleTreeOpt()))return!1;let a=!1;for(let l=0,d=this.childCount();l<d;l=l+1)a=this.childAt2(l,!0).invalidateNestedBackgroundBlurRenderTrees(t,n)||a;if(a)return this._invalidateRenderTreeForSelf(),!0;if(!un.isGeometryLeaf(this.type())&&!un.isFrameLike(this.type()))return!1;if(this.effects().length!=0){let l=this.supportsGeometry()?this.canvasSpaceGeometryBounds():this.canvasSpaceBoundingBox();for(let d=0,c=this.effects().length;d<c;d=d+1){let p=this.effects()[d];if(p.isVisibleForRendering()&&p.type()=="BACKGROUND_BLUR"){let u=U.new3(l).expandedBy1(p.blurRadius()),h=!1,f=this.topLevelAncestor();if(f!=null&&t.has(f.id())&&(h=!0),h)return this._invalidateRenderTreeForSelf(),n.push(u),!0}}}return!1}getCachedRenderTree(){return this._renderTree}renderTree1(){return this.renderTree2(new nn(this))}renderTree2(t){if(t.overlayRenderData()!=null&&t.overlayRenderData().hasTransition()&&t.hasBackgroundBlurs()){let n=new Ce.GenerateArgs(Ce.RenderMode.NORMAL);return Ce.generateRenderTree(t,n)}if(this._renderTree==null){let n=new Ce.GenerateArgs(Ce.RenderMode.NORMAL);this.actingAsOverlayOrSublayerForRendertreeGeneration(()=>{this._renderTree=new Se(Ce.generateRenderTree(t,n))}),(this._renderTree.value==null||!this._renderTree.value.hasBackgroundBlurs())&&(this._renderTreeWithoutBackgroundBlurs=this._renderTree)}return this._renderTree.value}getCachedRenderTreeForBaseScreen(){return this._renderTreeAsBaseScreen}renderTreeForBaseScreen1(){return this.renderTreeForBaseScreen2(new nn(this))}renderTreeForBaseScreen2(t){if(this._renderTreeAsBaseScreen==null){let n=new Ce.GenerateArgs(Ce.RenderMode.NORMAL);this.actingAsBaseScreenForRendertreeGeneration(()=>{this._renderTreeAsBaseScreen=new Se(Ce.generateRenderTree(t,n))})}return this._renderTreeAsBaseScreen.value}renderTreeWithoutBackgroundBlurs(){if(this._renderTreeWithoutBackgroundBlurs==null){let t=new nn(this),n=new Ce.GenerateArgs(Ce.RenderMode.WITHOUT_BACKGROUND_BLURS);this._renderTreeWithoutBackgroundBlurs=new Se(Ce.generateRenderTree(t,n))}return this._renderTreeWithoutBackgroundBlurs.value}renderTreeForShadowRoot1(){return this.renderTreeForShadowRoot2(new nn(this))}renderTreeForShadowRoot2(t){if(this._renderTreeForShadowRoot==null){let n=new Ce.GenerateArgs(Ce.RenderMode.SHADOW,t.uniqueIdentifier());this._renderTreeForShadowRoot=new Se(Ce.generateRenderTree(t,n))}return this._renderTreeForShadowRoot.value}renderTreeForShadowDescendant1(){return this.renderTreeForShadowDescendant2(new nn(this))}renderTreeForShadowDescendant2(t){if(this._renderTreeForShadowDescendant==null){let n=new Ce.GenerateArgs(Ce.RenderMode.SHADOW);this._renderTreeForShadowDescendant=new Se(Ce.generateRenderTree(t,n))}return this._renderTreeForShadowDescendant.value}renderTreeForKnockoutShadowRoot1(){return this.renderTreeForKnockoutShadowRoot2(new nn(this))}renderTreeForKnockoutShadowRoot2(t){if(this._renderTreeForKnockoutShadowRoot==null){let n=new Ce.GenerateArgs(Ce.RenderMode.KNOCKOUT_SHADOW,t.uniqueIdentifier());this._renderTreeForKnockoutShadowRoot=new Se(Ce.generateRenderTree(t,n))}return this._renderTreeForKnockoutShadowRoot.value}renderTreeForKnockoutShadowDescendant1(){return this.renderTreeForKnockoutShadowDescendant2(new nn(this))}renderTreeForKnockoutShadowDescendant2(t){if(this._renderTreeForKnockoutShadowDescendant==null){let n=new Ce.GenerateArgs(Ce.RenderMode.KNOCKOUT_SHADOW);this._renderTreeForKnockoutShadowDescendant=new Se(Ce.generateRenderTree(t,n))}return this._renderTreeForKnockoutShadowDescendant.value}renderTreeForOverlay(t){let n=!1;t.overlayRenderData()!=null&&this._overlayCacheKey!=t.overlayRenderData().overlayCacheKey()&&(this._invalidateRenderTreeForSelf(),n=!0);let r=this.renderTree2(t);return n&&(this._overlayCacheKey=t.overlayRenderData().overlayCacheKey()),r}_handlePropertyChangeForRenderTree(t,n){switch(t){case 24:case 78:{this.invalidateRenderTreeForSelfAndParents(),this.invalidateRenderTreeForChildren();break}case 25:{this.invalidateRenderTreeForSelfAndParents(),n!=null&&n.invalidateRenderTreeForSelfAndParents();break}case 90:case 66:{let r=this.findAllTopLevelNodesInNode(this);for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];s!=null&&s.invalidateRenderTreeForSelfAndParents()}break}case 64:case 9:case 38:case 22:case 59:case 3:case 13:case 10:case 11:case 37:case 14:case 81:case 35:case 34:case 49:case 23:case 74:case 60:case 1:case 2:case 4:case 76:case 19:case 8:case 61:case 52:case 53:case 55:case 56:case 92:case 93:case 94:case 95:case 63:case 73:case 75:case 44:case 39:case 40:case 41:case 42:case 15:case 45:case 62:{this.invalidateRenderTreeForSelfAndParents();break}}}static _forEachNodeHelper(t,n){let r=n(t);switch(r){case ke.Loop.BREAK:return ke.Loop.BREAK;case ke.Loop.CONTINUE:break;case ke.Loop.SKIP:return ke.Loop.CONTINUE}for(let o=0,a=t.childCount();o<a;o=o+1)if(t.childAt1(o)!==void 0)switch(r=ke._forEachNodeHelper(t.childAt1(o),n),r){case ke.Loop.BREAK:return ke.Loop.BREAK;case ke.Loop.CONTINUE:break;case ke.Loop.SKIP:return ke.Loop.CONTINUE}return ke.Loop.CONTINUE}static forEachNode1(t,n){ke._forEachNodeHelper(t,n)}static forEachNode2(t,n){ke.forEachNode1(t,r=>(n(r),ke.Loop.CONTINUE))}static lowestCommonAncestor(t){if(t.length==0)return null;let n=t[0];for(;n!=null;){let r=!0;for(let o of t)if(!n.isAncestorOf(o)){n=n.parent(),r=!1;break}if(r)break}return n}static _areNodesOrderedCorrectly(t,n){let r=t.parentIndex(),o=n.parentIndex();return dn.compare(r.position,o.position)<0||r.position==o.position&&ne.compare(t.id(),n.id())<0}static _applyEffectSpread(t,n){if(n!=null){let r=t.clone();return r.translate1(n.centerX(),n.centerY()),r.expand2(n.width()/2,n.height()/2),r}return t}static _computeRegionPaintsFromStyles(t,n,r){if(t!=null){let o=n!=null?n.filter(l=>l.isEnabledAndVisible()):[],a=new Map,s=t.paintOverrides;return o.length==0&&o.push(se.TRANSPARENT),t.regions.map(l=>{let d=o,c=l.styleID;if(c!=0&&s!=null){let p=qt.IntMap_get(a,c,null);if(p==null){let u=s.get(c,r);u!=null&&(p=u.filter(h=>h.isEnabledAndVisible()),a.set(c,p))}p!=null&&(d=p)}return d})}return ke.EMPTY_REGION_PAINTS}};ke.schema=null,ke._geometryBuilder=new Tt,ke._renderedBuilder=new Tt,ke._scrollingBuilder=new Tt,ke._effectBuilder=new Tt,ke._effectBounds=U.new2(),ke.EMPTY_REGION_PAINTS=[];var be=ke;(t=>{let i;(a=>(a[a.CONTINUE=0]="CONTINUE",a[a.BREAK=1]="BREAK",a[a.SKIP=2]="SKIP"))(i=t.Loop||(t.Loop={}));let e;(r=>{function n(o){return t.Loop[o]}r.Loop_toString=n})(e=t.in_Loop||(t.in_Loop={}))})(be||(be={}));var Pd=class i{constructor(e,t,n,r,o){this.id=null,this.overlayDataModelId=null,this.openingHotspotStablePath=null,this.openingInteractionId=null,this.openingTransition=null,this.id=e,this.overlayDataModelId=t,this.openingHotspotStablePath=n,this.openingInteractionId=r,this.openingTransition=o}cloneWithId(e){return new i(e,this.overlayDataModelId,this.openingHotspotStablePath,this.openingInteractionId,this.openingTransition)}openingTransitionType(){return this.openingTransition.transitionType}},Xl=class{constructor(e,t,n,r,o,a,s,l){this.overlayId=e,this.overlayNode=t,this.bounds=n,this.baseTlfCursor=r,this.backgroundAppearance=o,this.backgroundTransitionProgress=a,this.transform=s,this.animationTransform=l}},ga=class{constructor(){if(arguments.length==0)this._multiOverlayMap=null,this._hasTransitionComputed=!1,this._hasTransition=!1,this._multiOverlayMap=new Map;else if(arguments.length==1){let e=arguments[0];this._multiOverlayMap=null,this._hasTransitionComputed=!1,this._hasTransition=!1,this._multiOverlayMap=e}}hasTransition(){if(this._hasTransitionComputed)return this._hasTransition;for(let e of Array.from(this._multiOverlayMap.keys()))if(this._multiOverlayMap.get(e).backgroundTransitionProgress!=null||this._multiOverlayMap.get(e).transform!=null||this._multiOverlayMap.get(e).animationTransform!=null){this._hasTransition=!0,this._hasTransitionComputed=!0;break}return this._hasTransition}count(){return this._multiOverlayMap.size}addEntry(e,t){this._multiOverlayMap.set(e,t),this._hasTransitionComputed=!1}removeEntry(e){this._multiOverlayMap.delete(e),this._hasTransitionComputed=!1}get1(e){return Le.StringMap_get(this._multiOverlayMap,e,null)}get2(e){return Le.StringMap_get(this._multiOverlayMap,e,null)}keys(){return Array.from(this._multiOverlayMap.keys())}overlayCacheKey(){let e=[];for(let t of this.keys())e.push(t);return new Mt(e)}},Dd=class{id(){return this._data.id}overlayDataModelId(){return this._data.overlayDataModelId}openingHotspotStablePath(){return this._data.openingHotspotStablePath}previousOverlay(){return this._previousOverlay}openingTransitionType(){return this._data.openingTransitionType()}node(){return this.scene.findNode1(this.id())}backgroundInteraction(){let e=this.scene.findNode1(this._data.overlayDataModelId);return e==null?"NONE":e.overlayBackgroundInteraction()}backgroundAppearance(){let e=this.scene.findNode1(this._data.overlayDataModelId);return e==null?new Ro:e.overlayBackgroundAppearance()}positionType(){let e=this.scene.findNode1(this._data.overlayDataModelId);return e==null?"CENTER":e.overlayPositionType()}relativePosition(){return this._data.openingTransition.overlayRelativePosition}renderedOrigin(e){let t=this.node();if(t==null)return ve.FrozenVector_new1();let n=null;if(this.positionType()=="MANUAL"){if(this._stackPosition>0){let o=this.scene.findNode1(this._previousOverlay.id()).canvasSpaceBoundingBox(),a=this._previousOverlay.renderedOrigin(e),s=this.scene.findNode3(this.openingHotspotStablePath());s!=null&&(n=s.canvasSpaceScrolledBounds(1).topLeft().add1(a.subtract1(o.topLeft())))}if(n==null){let r=this.scene.findNode3(this.openingHotspotStablePath());r!=null&&(n=r.canvasSpaceScrolledBounds(1).topLeft())}if(n==null)return ve.FrozenVector_new1()}return Md.BoundOverlay_computeOrigin(t,e,this._data.openingTransition,n,this.positionType())}renderedBounds(e){let t=this.scene.findNode1(this._data.id);if(t==null)return Jn.FrozenRect_new1();let n=t.canvasSpaceBoundingBox().size(),r=this.renderedOrigin(e);return Jn.FrozenRect_new4(r.x(),r.y(),n.x(),n.y())}deltaFromRenderedPositionToCanvasSpacePosition(e){let t=this.scene.findNode1(this._data.id);return t==null?new E(0,0):this.renderedOrigin(e).subtract1(t.canvasSpaceBoundingBox().topLeft())}baseTlfSpaceToOverlaySpace1(e,t){let n=this.scene.findNode1(this._data.id);if(n==null||t==null||e==null)return ve.FrozenVector_ZERO;let r=this.renderedOrigin(e),o=n.canvasSpaceBoundingBox().topLeft();return t.add1(o).subtract1(r)}baseTlfSpaceToOverlaySpace2(e,t){return U.new4(this.baseTlfSpaceToOverlaySpace1(e,t.topLeft()),t.size())}overlaySpaceToBaseTlfSpace1(e,t){let n=this.baseTlfSpaceToOverlaySpace1(e,t);return t.add1(t.subtract1(n))}overlaySpaceToBaseTlfSpace2(e,t){return U.new4(this.overlaySpaceToBaseTlfSpace1(e,t.topLeft()),t.size())}constructor(e,t,n,r){this.scene=e,this._data=t,this._previousOverlay=n,this._stackPosition=r}},Md;(t=>{function i(n,r,o,a,s){if(n==null)return E.new2();let l=n.canvasSpaceBoundingBox().size();if(s=="MANUAL")return new E(a.x()+o.overlayRelativePosition.x(),a.y()+o.overlayRelativePosition.y());{let d=r.canvasSpaceBoundingBox(),c=d.topLeft(),p=d.size(),u=c.x();switch(s){case"TOP_LEFT":case"BOTTOM_LEFT":break;case"TOP_CENTER":case"CENTER":case"BOTTOM_CENTER":{u+=p.x()/2-l.x()/2;break}case"TOP_RIGHT":case"BOTTOM_RIGHT":{u+=p.x()-l.x();break}}let h=c.y();switch(s){case"TOP_LEFT":case"TOP_CENTER":case"TOP_RIGHT":break;case"CENTER":{h+=p.y()/2-l.y()/2;break}case"BOTTOM_LEFT":case"BOTTOM_CENTER":case"BOTTOM_RIGHT":{h+=p.y()-l.y();break}}return new E(u,h)}}t.BoundOverlay_computeOrigin=i;function e(n,r,o,a,s){let l=n.canvasSpaceBoundingBox().size(),d=i(n,r,o,a,s);return Jn.FrozenRect_new4(d.x(),d.y(),l.x(),l.y())}t.BoundOverlay_computeNewBounds=e})(Md||(Md={}));var qI=(r=>(r[r.REQUESTED=0]="REQUESTED",r[r.INITIATED=1]="INITIATED",r[r.ABORTED=2]="ABORTED",r[r.COMMITTED=3]="COMMITTED",r))(qI||{}),ko=class i{static ROOT_STABLE_PATH(){return new Mt([])}constructor(e){this.VERBOSE_LOGS=!1,this._appState=null,this._observers=new nr,this._isNotifyingStateChangeObservers=!1,this._emitter=null,this._interactionsEnabled=!0,this._disableNewStateChanges=!1,this._currentFitMode=0,this.componentStateSyncer=null,this._onStateSwapFailedDueToCycle=null,this._isDragging=!1,this._actionCounter=0,this._transitionOnClick=!0,this._changeHistory=[],this._initiatedChange=null,this._initiatedHistory=null,this._lastInitiatedTopLevelStateChange=null,this._ongoingNavigateRepairsInvalidState=!1,this._shouldNotifyNavigationInfoInvalidated=!1,this._tlfHistory=[],this._upcomingTlfs=new Set,this._videoStateChangeHistory=[],this._screensNeedValidating=!1,this._removedPrimaryInstances=[],this._enqueueUpcomingTlfsDeadline=0,this._forceInitiateStateChangeForTests=!1,this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._visitedScreenIds=new Cr,this._isApplyingStateChangeMutation=!1,this._isResettingStateChangeMutations=!1,this._hsmRoot=null,this._initiatedInstanceChanges=new Map,this._lastInitiatedInstanceStateChange=null,this._setVariableActionHistory=[],this._hsmObservers=new nr,this._appState=e,this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this.componentStateSyncer=new Jc(this._appState,this,(t,n,r)=>this._getFullscreenNodeChangesForStateSwap(t,n,r)),this._emitter=$t.getEventEmitter(),this._hsmRoot=new jl(this),this._onStateSwapFailedDueToCycle=()=>{this._emitter.trigger("stateSwapFailedDueToCycle",{})},this.resetState()}hasRequestedStateChange(){return this._requestedStateChange!==null}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._hsmRoot=new jl(this),this._initiatedInstanceChanges=new Map,t!=null&&this.createOrRepairStateMachinesForInsertedSubtree(t.root()),this._visitedScreenIds=new Cr,this._enforceValidPrototypeState()}resetState(){this.resetPrototype(),this._currentFitMode=0,this._transitionOnClick=!0}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){this._enforceValidPrototypeState()}handleSceneGraphEvent(e){var t;if(io.isPrototypeStructuralChange(e.property)&&(this._screensNeedValidating=!0,this._deferEnqueueUpcomingTlfs()),e.property==97)$.asString(e.newVal)=="REMOVED"&&!this.isApplyingStateChangeMutation()&&e.node.isPrimaryInstance()&&this._removedPrimaryInstances.push(e.node.id());else if(e.property==75&&e.node.isInstance()){let n=(t=e.node.symbolID())!=null?t:ne.invalid();ne.isValid(n)||console.warn("Unexpected invalid symbolID for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(e.node,n)}else if(e.property==25){let n=e.oldVal!=null&&$.isParentIndex(e.oldVal)?$.asParentIndex(e.oldVal):null,r=e.newVal!=null&&$.isParentIndex(e.newVal)?$.asParentIndex(e.newVal):null,o=n!=null?e.node.scene().findNode1(n.id):null,a=r!=null?e.node.scene().findNode1(r.id):null,s=o!=null&&o.isRooted(),l=a!=null&&a.isRooted();!s&&l?this.createOrRepairStateMachinesForInsertedSubtree(e.node):s&&!l&&(this.isApplyingStateChangeMutation()||be.forEachNode1(e.node,d=>{if(d.isInstance()){let c=this._getStateMachineOrNull(d.stablePath());if(c!=null)return this.commitInstanceStateChange(c),be.Loop.SKIP}return be.Loop.CONTINUE}))}else e.property==62&&wn.clearCachedNodePaths()}didApplyNodeChanges(){if(this._screensNeedValidating&&(this._enforceValidPrototypeState(),this._screensNeedValidating=!1),this._removedPrimaryInstances.length>0){for(let e of this._removedPrimaryInstances)this.commitChangesBelowInstanceTransitionRoot(new Mt([e])),this._hsmRoot.removeChild(e);this._removedPrimaryInstances=[]}}onFrame(){this._shouldNotifyNavigationInfoInvalidated&&(this._emitter.trigger("navigationInfoInvalidated",null),this._shouldNotifyNavigationInfoInvalidated=!1),this._enqueueUpcomingTlfsDeadline!=0&&Qe.milliseconds()>this._enqueueUpcomingTlfsDeadline&&this._enqueueUpcomingTlfs()}_filterOverlays(e){let t=e.length;for(let n=0;n<e.length;n=n+1){let r=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e[n].id);if(r==null){t=n;break}r.setUsedAsBaseScreen(!1)}return t==e.length?e:e.slice(0,t)}_filterPresentedState(e){if(e==null)return null;if(e.stateId==null&&e.overlays.length==0)return e;let t=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e.stateId);if(t==null)return new Cn(null,[]);t.setUsedAsBaseScreen(!0);let n=this._filterOverlays(e.overlays);return n==e.overlays?e:new Cn(e.stateId,n)}_filterChange(e){if(e==null)return null;let t=this._filterPresentedState(e.oldStateAndOverlays),n=this._filterPresentedState(e.newStateAndOverlays);return t==e.oldStateAndOverlays&&n==e.newStateAndOverlays?e:new Zn(1,i.ROOT_STABLE_PATH(),t,n)}enforceValidPrototypeStateForTesting(){this._enforceValidPrototypeState()}_enforceValidPrototypeState(){let e=!1;if(this._initiatedChange!=null){let r=this._initiatedChange.oldStateId()!=null&&this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.oldStateId())==null,o=this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.newStateId())==null;e=r||o}else if(this._changeHistory.length>0){let r=ce.List_last(this._changeHistory).newStateId();e=this._appState.prototypeStructure().validDestinationForPrototypeFromId(r)==null}else return;if(e){this.restartPrototype(0);return}let t=null,n=null;if(this._initiatedChange!=null){let r=this._filterChange(this._initiatedChange);this._initiatedChange!=r&&(n=this._initiatedHistory.slice(),t=r)}else if(this._changeHistory.length>0){let r=ce.List_last(this._changeHistory),o=this._filterChange(r);o!=r&&(n=this._changeHistory.slice(),t=o)}t!=null&&n!=null&&(ce.List_removeLast(n),n.push(t),this._requestStateChange(t,n),this.commitStateChange())}getTlfHistory(){return this._tlfHistory}getLastChangeInHistory(){return this._changeHistory.length<1?null:ce.List_last(this._changeHistory)}getHistoryCount(){return this._changeHistory.length}getInitiatedChange(){return this._initiatedChange}getCurrentBaseScreenId(){return this._initiatedChange!=null?this._initiatedChange.newStateAndOverlays.stateId:this._changeHistory.length>0?ce.List_last(this._changeHistory).newStateAndOverlays.stateId:null}getCurrentBaseScreenNode(){var t;let e=this.getCurrentBaseScreenId();return e==null?null:(t=this._appState.scene())==null?void 0:t.findNode1(e)}getCurrentBaseScreenIndex(){let e=this.getCurrentBaseScreenId();return e==null?-1:this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(e)}getNextBaseScreenIdForPrototype(){let e=this.getCurrentBaseScreenIndex(),t=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();return e<0?null:e>=t.length-1?this._getUpcomingTlf():ne.fromString(t[e+1])}getNextBaseScreenNodeForPrototype(){return this._appState.scene().findNode1(this.getNextBaseScreenIdForPrototype())}getNextBaseScreenIdForFrameList(){let e=this.getCurrentBaseScreenIndex(),t=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();return e<0||e>=t.length-1?null:ne.fromString(t[e+1])}getNextBaseScreenNodeForFrameList(){return this._appState.scene().findNode1(this.getNextBaseScreenIdForFrameList())}getPreviousBaseScreenId(){let e=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder(),t=this.getCurrentBaseScreenIndex();return t<1?null:ne.fromString(e[t-1])}getPreviousBaseScreenNode(){return this._appState.scene().findNode1(this.getPreviousBaseScreenId())}getCurrentOverlays(){return this.bindOverlays(this.getCurrentOverlayData())}getCurrentOverlayData(){return this._initiatedChange!=null?this._initiatedChange.newOverlayData():this._changeHistory.length>0?ce.List_last(this._changeHistory).newOverlayData():[]}getCurrentOverlayIds(){return this.getCurrentOverlays().map(e=>e.id())}getOpenOverlayData(e){let t=this.getCurrentOverlays();for(let n=0,r=t.length;n<r;n=n+1){let o=t[n];if(ne.equals(o.id(),e))return o}return null}getTopmostScreenAndPoint(e){let t=this.getCurrentBaseScreenNode(),n=this.getTopmostOverlayNode();return n?[n,this.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(t,e)]:[t,e]}getTopmostScreen(){var e;return(e=this.getTopmostOverlayNode())!=null?e:this.getCurrentBaseScreenNode()}getTopmostScreenId(){var e;return(e=this.getTopmostOverlayId())!=null?e:this.getCurrentBaseScreenId()}getTopmostOverlay(){let e=this.getCurrentOverlays();return e.length>0?ce.List_last(e):null}getTopmostOverlayId(){let e=this.getCurrentOverlays();return e.length>0?ce.List_last(e).id():null}getTopmostOverlayNode(){var t;let e=this.getCurrentOverlays();return e.length==0?null:(t=this._appState.scene())==null?void 0:t.findNode1(ce.List_last(e).id())}getSecondTopmostOverlayNodeOrBaseScreen(){var t;let e=this.getCurrentOverlays();return e.length==0?null:e.length==1?this.getCurrentBaseScreenNode():(t=this._appState.scene())==null?void 0:t.findNode1(e[e.length-2].id())}getLayersIds(){let e=this.getCurrentBaseScreenId();if(e==null)return[];let t=this.getCurrentOverlayIds().slice();return t.unshift(e),t}getPreviousNonTransientChange(){let e=this._changeHistory.slice();for(;e.length>0&&ce.List_last(e).isTransientChange();)e.pop();if(e.length==0)return null;for(;e.length>0;){let t=e.pop();if(!(e.length>0&&ce.List_last(e).isTransientChange()||this._appState.prototypeStructure().validDestinationForPrototypeFromId(t.oldStateId())==null))return t}return null}bindOverlays(e){let t=[];for(let n=0,r=e.length;n<r;n=n+1)t.push(new Dd(this._appState.scene(),e[n],n>0?t[n-1]:null,n));return t}getOngoingNavigateRepairsInvalidState(){return this._ongoingNavigateRepairsInvalidState}lastNodeForBaseScreen(){var t;let e=null;return this._initiatedChange!=null?e=this._initiatedChange.oldStateId():this._changeHistory.length>0&&(e=ce.List_last(this._changeHistory).newStateId()),e==null?null:(t=this._appState.scene())==null?void 0:t.findNode1(e)}nextNodeForBaseScreen(){var e,t;return((e=this._initiatedChange)==null?void 0:e.newStateId())==null?null:(t=this._appState.scene())==null?void 0:t.findNode1(this._initiatedChange.newStateId())}lastNodeForOverlayAt(e){var n;let t=null;if(this._initiatedChange!=null)t=this._initiatedChange.oldOverlayData();else if(this._changeHistory.length>0)t=ce.List_last(this._changeHistory).newOverlayData();else return null;return t.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode1(t[e].id)}nextNodeForOverlayAt(e){var n;if(this._initiatedChange==null)return null;let t=this._initiatedChange.newOverlayData();return t.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode1(t[e].id)}displayedOverlayCount(){return this._initiatedChange!=null?Math.max(this._initiatedChange.oldOverlayData().length,this._initiatedChange.newOverlayData().length):this._changeHistory.length>0?ce.List_last(this._changeHistory).newOverlayData().length:0}nodeForOverlayAt(e){var n;let t=this.getCurrentOverlayData();return t.length<=e?null:(n=this._appState.scene())==null?void 0:n.findNode1(t[e].id)}getCurrentFitMode(){return this._currentFitMode}setFitModeFromParameter(e){let t=2;switch(e){case"contain":{t=1;break}case"scale-down":{t=2;break}case"min-zoom":{t=3;break}case"scale-down-width":{t=5;break}case"fit-width":{t=6;break}case"free":{t=4;break}default:break}if(t!=this._currentFitMode){let n=this._currentFitMode;this._currentFitMode=t,this._notifyFitModeChange(n,this._currentFitMode)}}_notifyFitModeChange(e,t){this._observers.forEach(n=>{n.handleFitModeChange(e,t)})}actionCounter(){return this._actionCounter}setTransitionOnClick(e){this._transitionOnClick=e}getTransitionOnClick(){return this._transitionOnClick}setInteractionsEnabled(e){this._interactionsEnabled=e}interactionsEnabled(){return this._interactionsEnabled}isDragging(){return this._isDragging}setIsDragging(e){this._isDragging=e}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}closeOverlayAtAndAbove(e,t){let n=Qr.getDefaultExternalExecution();this._closeOverlayAtAndAbove(e,n.interactionAddress,n.canvasSpaceTriggerBoundsOrNull,0,null,t)}closeOverlayForHotspot(e,t,n,r){var d;let o=null,a=null,s=0;e!=null&&t!=null?(o=(d=e.topLevelAncestor())==null?void 0:d.id(),a=Qr.forNoodle(e,t,r),s=Kt.TransitionAction_fromInteractionType(t.event().interactionType())):(Ke("closeOverlayForHotspot called with null hotspot"),o=this.getTopmostOverlayId(),a=Qr.getDefaultExternalExecution(),s=0);let l=this.getCurrentOverlayData();for(let c=l.length-1;c>=0;c=c-1)if(ne.equals(l[c].id,o)){this._closeOverlayAtAndAbove(c,a.interactionAddress,a.canvasSpaceTriggerBoundsOrNull,s,null,n);return}}_closeOverlayAtAndAbove(e,t,n,r,o,a){if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let s=this.getCurrentOverlayData();if(s.length>e){let l=Zn.forClosingTopNOverlays(s.length-e,this.getCurrentBaseScreenId(),s,t,n,r);if(o==null)switch(a){case 0:{o=this._changeHistory.slice();break}case 1:{o=rn.FrozenList_cloneAndAppendOne(this._changeHistory,l);break}case 2:{o=[l].slice();break}}this._requestStateChange(l,o)}}navigateToFrameAndCloseOverlays1(e){this.navigateToFrameAndCloseOverlays3(e,null,2,0,0,null,null)}navigateToFrameAndCloseOverlays2(e,t){var n;if(e!=null&&ne.isValid(e)){let r=(n=this._appState.scene())==null?void 0:n.findNode1(e),o=e;t!=null&&ne.isValid(t)&&(this._appState.setActivePrototypeStartingPointNodeId(t),r!=null&&r.topLevelAncestor()==null&&(o=t)),this.navigateToFrameAndCloseOverlays3(o,null,2,0,0,null,null)}}navigateToFrameAndCloseOverlays3(e,t,n,r,o,a,s){var S;if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let l=this.getCurrentBaseScreenNode(),d=(S=this._appState.prototypeStructure())==null?void 0:S.getDestinationFrame(e);if(d!=null)d.setUsedAsBaseScreen(!0),e=d.id();else if(!X.isInlinePreview())return;let c=this.getCurrentOverlayData();if(ne.equals(e,l==null?void 0:l.id())&&(l==null?void 0:l.scene())==(d==null?void 0:d.scene())&&c.length==0)return;let p=l!=null?l.id():null,u=[],h=t!=null&&a!=null?Qr.forNoodle(t,a,s):Qr.getDefaultExternalExecution(),f=new Zn(3,i.ROOT_STABLE_PATH(),new Cn(p,c),new Cn(e,u),h.interactionAddress,h.canvasSpaceTriggerBoundsOrNull,h.transitionParameters,r,o),_=null;switch(n){case 0:{_=this._changeHistory;break}case 1:{_=rn.FrozenList_cloneAndAppendOne(this._changeHistory,f);break}case 2:{_=[f].slice();break}}let m=!1,A=d,y=l;if(d!=null&&l!=null&&(A=d.findNearestAncestorSectionOrNull(),y=l.findNearestAncestorSectionOrNull(),m=A!=null&&y!=null),m){let g=this._getStateMachineOrNull(new Mt([A.id()]));if(g==null||this._shouldDisableNewChangesInStateMachine(g))return;g.clearInitiatedChangesInSelfAndSubstates();let b=null;switch(n){case 0:{b=g.changeHistory();break}case 1:{b=rn.FrozenList_cloneAndAppendOne(g.changeHistory(),f);break}case 2:{b=[f].slice();break}}if(this._requestAndSaveSectionStateChange(g,f,b,_),A!=y&&A.parent()==y){let T=new Zn(3,i.ROOT_STABLE_PATH(),new Cn(p,c),new Cn(A.id(),u),h.interactionAddress,h.canvasSpaceTriggerBoundsOrNull,h.transitionParameters,r,o),I=this._getStateMachineOrNull(new Mt([y.id()]));if(I==null||this._shouldDisableNewChangesInStateMachine(I))return;switch(I.clearInitiatedChangesInSelfAndSubstates(),n){case 0:{b=I.changeHistory();break}case 1:{b=rn.FrozenList_cloneAndAppendOne(I.changeHistory(),T);break}case 2:{b=[T].slice();break}}this._saveSectionStateChange(I,T,b)}}else this._requestStateChange(f,_)}overlayFrame(e,t,n,r,o,a){var f;if(!this._allowNewStateChanges()||this.getCurrentBaseScreenId()==null||t==null)return;this._clearInitiatedChangesBeforeNewChange();let s=o!=null?Qr.forNoodle(t,o,a):Qr.forExternalOpenOverlay(t),l=this.getCurrentOverlayData(),d=(f=this._appState.prototypeStructure())==null?void 0:f.getDestinationFrame(e);if(d==null){Ke("tried to open to null overlay");return}let c=new Pd(d.id(),e,s.interactionAddress.hotspotStablePath,s.interactionAddress.interactionId,s.transitionParameters),p=this.getCurrentBaseScreenId(),u=new Zn(3,i.ROOT_STABLE_PATH(),new Cn(p,l),new Cn(p,rn.FrozenList_cloneAndAppendOne(l,c)),s.interactionAddress,s.canvasSpaceTriggerBoundsOrNull,s.transitionParameters,n,r);d.setUsedAsBaseScreen(!1);let h=rn.FrozenList_cloneAndAppendOne(this._changeHistory,u);this._requestStateChange(u,h)}getSetVariableActionHistoryLength(){return this._setVariableActionHistory.length}createMultiplayerSetVariableAction(e,t,n,r){let o={nodeForFindingTopmostScreenId:ne.toFigGUID(e),targetVariableId:t,targetVariableData:JSON.stringify(n),resolvedVariableModes:JSON.stringify(r)};this._addVariableToHistory(o)}performMultiplayerSetVariableAction(e){L._prototypeLib.runSetVariable(ne.fromFigGUID(e.nodeForFindingTopmostScreenId),e.targetVariableId,JSON.parse(e.targetVariableData),JSON.parse(e.resolvedVariableModes)),this._addVariableToHistory(e)}_addVariableToHistory(e){this._setVariableActionHistory.push(e),this._notifyMultiplayerSetVariableActionHistory()}_notifyMultiplayerSetVariableActionHistory(){this._observers.forEach(e=>{var t;(t=e.handleSetVariableAction)==null||t.call(e,this._setVariableActionHistory)})}resetVariablePrototypeState(){L._prototypeLib.resetLocalVariableChanges(),this.resetSetVariableActionHistory()}resetSetVariableActionHistory(){this._setVariableActionHistory=[],this._notifyMultiplayerSetVariableActionHistory()}createVideoStateChange(e,t,n,r,o){if(e==null||t==null||n==null)return;let a={targetNodeId:ne.toFigGUID(e),isPlaying:t,isPlayingSound:n,currentTimes:r,actionTakenTimestamp:o};this._addVideoStateChangeToHistory(a)}performMultiplayerVideoStateChange(e,t){this._appState.videoManager().multiplayerUpdateVideoRuntimes(e,t),this._addVideoStateChangeToHistory(t)}_addVideoStateChangeToHistory(e){let t=!1;for(let n=0;n<this._videoStateChangeHistory.length;n++)if(ne.fromFigGUID(this._videoStateChangeHistory[n].targetNodeId)==ne.fromFigGUID(e.targetNodeId)){this._videoStateChangeHistory[n]=e,t=!0;break}t||this._videoStateChangeHistory.push(e),this._notifyMultiplayerVideoStateChangeToHistory()}_notifyMultiplayerVideoStateChangeToHistory(){this._observers.forEach(e=>{var t;(t=e.handleVideoStateChange)==null||t.call(e,this._videoStateChangeHistory)})}getVideoStateChange(e){return this._videoStateChangeHistory[e]}getVideoStateChanges(){return this._videoStateChangeHistory.slice()}resetVideoStateChangeHistory(){var t,n;let e=this._videoStateChangeHistory.slice();this._videoStateChangeHistory=[],(n=(t=this._appState.videoManager())==null?void 0:t.resetVideoStateChanges)==null||n.call(t,e)}resetSectionsState(){let e=this._appState.getActiveCanvas();if(e!=null){let t=e.findAllSectionsInNode();for(let n of t){let r=this._getStateMachineOrNull(new Mt([n.id()]));r!=null&&r.resetHistoryToFirstFrameInSection(n)}}}resetPrototype(){var e;this._appState.scene()!=null&&(this._clearInitiatedChangesBeforeNewChange(),this._isResettingStateChangeMutations=!0,(e=L._prototypeLib)==null||e.resetLocalChanges(),this._initiatedInstanceChanges=new Map,this._isResettingStateChangeMutations=!1,this.resetSectionsState(),wn.clearCachedNodePaths(),this.componentStateSyncer.handleRestartPrototype()),this._initiatedChange=null,this._initiatedHistory=null,this._changeHistory=[],this._tlfHistory=[],this._upcomingTlfs=new Set,this.resetSetVariableActionHistory(),this.resetVideoStateChangeHistory(),this._actionCounter=this._actionCounter+1,this._lastInitiatedTopLevelStateChange=null,this._lastInitiatedInstanceStateChange=null}restartPrototype(e){var r;if(this.logVerbose(()=>`[PrototypeState] restartPrototype started for ${Yi[e]}`),this.resetPrototype(),this._observers.forEach(o=>{o.handleRestartPrototype()}),X.getViewerMode()==X.ViewerMode.MIRROR)return;if(((r=this._appState.scene())==null?void 0:r.findNode1(this._appState.activePrototypeStartingPointNodeId()))==null){let o=this._appState.prototypeStructure().activePrototypeStartNodeOrDefault();o!=null&&this._appState.setActivePrototypeStartingPointNodeId(o.id())}let n=this._appState.prototypeStructure().nodeToRestartPrototypeOn(this._appState.getActiveCanvas());n!=null&&(e==0&&(this._ongoingNavigateRepairsInvalidState=!0),this.navigateToFrameAndCloseOverlays1(n.id()),this.tryToInitiateRequestedStateChange(i.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW)),this.logVerbose(()=>`[PrototypeState] restartPrototype finished for ${Yi[e]}`)}returnToState1(e){this.returnToState2(null,null,e,0,null,null)}returnToState2(e,t,n,r,o,a){var p;if(!this._allowNewStateChanges()||this._changeHistory.length<=1)return;let s=n!=2,l=null;this._clearInitiatedChangesBeforeNewChange();let d=this._changeHistory.slice(),c=null;for(e!=null&&t!=null?c=Qr.forNoodle(e,t,a):c=Qr.getDefaultExternalExecution();d.length>1&&(s&&ce.List_last(d).isTransientChange());)l=d.pop();if(n==0||d.length<=1){((p=t==null?void 0:t.event())==null?void 0:p.interactionType())=="DRAG"&&this._returnToOverlayState(c,r,l==null?void 0:l.oldOverlayData(),l,d);return}for(l=ce.List_last(d);d.length>1;){let u=d.pop();if(d.length>1&&s&&ce.List_last(d).isTransientChange())continue;let f=u.oldStateId();if(ne.equals(f,this.getCurrentBaseScreenId()))this._returnToOverlayState(c,r,u.oldOverlayData(),l,d);else{if(this._appState.prototypeStructure().validDestinationForPrototypeFromId(u.oldStateId())==null)continue;this._returnToFrame(f,c,r,l,d,o)}break}}_returnToFrame(e,t,n,r,o,a){var h;let s=(h=this._appState.prototypeStructure())==null?void 0:h.getDestinationFrame(e),l=r.transitionParameters.withStateManagementSettings(a),d=new Zn(4,i.ROOT_STABLE_PATH(),new Cn(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new Cn(e,[]),n,t.interactionAddress,1,l);if(s!=null)s.setUsedAsBaseScreen(!0);else{Ke("tried to return to deleted frame");return}let c=!1,p=s.findNearestAncestorSectionOrNull(),u=this.getCurrentBaseScreenNode().findNearestAncestorSectionOrNull();if(p!=null&&u!=null){if(p==u||p==u.parent()){let f=this._getStateMachineOrNull(new Mt([p.id()])),_=ce.List_last(f.changeHistory()),m=rn.FrozenList_cloneAndRemoveOne(f.changeHistory(),_);this._requestAndSaveSectionStateChange(f,d,m,o),c=!0}else if(u==p.parent()){d=new Zn(4,i.ROOT_STABLE_PATH(),new Cn(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new Cn(p.id(),[]),n,t.interactionAddress,1,r.transitionParameters);let f=this._getStateMachineOrNull(new Mt([u.id()])),_=ce.List_last(f.changeHistory()),m=rn.FrozenList_cloneAndRemoveOne(f.changeHistory(),_);this._requestAndSaveSectionStateChange(f,d,m,o),c=!0}}c||this._requestStateChange(d,o)}_returnToOverlayState(e,t,n,r,o){var s;let a=this.getCurrentOverlayData();if(n.length<a.length)this._closeOverlayAtAndAbove(n.length,e.interactionAddress,e.canvasSpaceTriggerBoundsOrNull,t,o,0);else{for(let c=0,p=n.length;c<p;c=c+1){let u=(s=this._appState.prototypeStructure())==null?void 0:s.getDestinationFrame(n[c].id);if(u==null)break;u.setUsedAsBaseScreen(!1)}let l=this.getCurrentBaseScreenId(),d=new Zn(4,i.ROOT_STABLE_PATH(),new Cn(l,this.getCurrentOverlayData()),new Cn(l,n),t,e.interactionAddress,1,r.transitionParameters);this._requestStateChange(d,o)}}swapTopOverlay(e,t,n,r,o){var f;if(!this._allowNewStateChanges())return;let a=this.getCurrentOverlayData(),s=this.getCurrentBaseScreenId();if(s==null||a.length==0)return;this._clearInitiatedChangesBeforeNewChange();let l=(f=this._appState.prototypeStructure())==null?void 0:f.getDestinationFrame(e),d=a.slice();d[d.length-1]=d[d.length-1].cloneWithId(l.id());let c=null,p=0;t!=null&&r!=null?(c=Qr.forNoodle(t,r,o),p=Kt.TransitionAction_fromInteractionType(r.event().interactionType())):(c=Qr.getDefaultExternalExecution(),p=0);let u=new Zn(3,i.ROOT_STABLE_PATH(),new Cn(s,a),new Cn(s,d),c.interactionAddress,c.canvasSpaceTriggerBoundsOrNull,c.transitionParameters,0,p);if(l==null){Ke("tried to swap to null overlay");return}l.setUsedAsBaseScreen(!1);let h=rn.FrozenList_cloneAndAppendOne(this._changeHistory,u);this._requestStateChange(u,h)}_clearInitiatedChangesBeforeNewChange(){this._disableNewStateChanges=!0,this._appState.scene()!=null&&this._forEachTransitioningStateMachine(e=>{let t=this._getStateMachineOrNull(e);return t!=null&&t.clearInitiatedChangesInSelfAndSubstates(),be.Loop.CONTINUE}),this._initiatedChange!=null&&this.commitStateChange(),this._disableNewStateChanges=!1}_allowNewStateChanges(){return this.interactionsEnabled()&&!this._disableNewStateChanges}abortStateChange(){if(this._initiatedChange==null)return;let e=this._initiatedChange;this._initiatedChange=null,this._initiatedHistory=null,this._broadcastStateChange(e,2,null),this._enforceValidPrototypeState()}commitStateChange(){if(this._initiatedChange==null)return;let e=this._initiatedChange;this._changeHistory=this._initiatedHistory,this._initiatedChange=null,this._initiatedHistory=null,this.logVerbose(()=>`[PrototypeState] commitTopLevelChange ${e.debugString(this._appState.scene())}`);let t=[],n=r=>{t.push(r)};if(this._broadcastStateChange(e,3,n),this._allowNewStateChanges())for(let r of t)r();X.isInlinePreview()||this._enforceValidPrototypeState()}_enqueueUpcomingTlfs(){let e=this.getCurrentBaseScreenNode();if(e==null)return;let t=Wt.adjacentBaseScreens(this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF(),e);for(let n of t.asList())this._upcomingTlfs.add(n);this._shouldNotifyNavigationInfoInvalidated=!0,this._enqueueUpcomingTlfsDeadline=0}_getUpcomingTlf(){for(;this._upcomingTlfs.size>0;){let e=Wt.visuallySortLayersLeftToRightAndTopToBottom2(this._appState.scene(),Array.from(this._upcomingTlfs.values()).map(t=>ne.fromString(t)))[0];if(this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(e)>=0){this._upcomingTlfs.delete(e);continue}return this._appState.scene().findNode2(e)==null?null:ne.fromString(e)}return null}setForceInitiateStateChangeForTests(e){this._forceInitiateStateChangeForTests=e}_requestStateChange(e,t){var n;this._broadcastStateChange(e,0,null),this._requestedStateChange=new i.StateChangeRequest(e,t),this._requestedStateChangeAtMs=Qe.milliseconds(),this._emitter.trigger("requestedStateChange",{interactionId:(n=e==null?void 0:e.interactionAddress)==null?void 0:n.interactionId,cause:En[e.cause],destinationId:e.newStateId()}),this._disableNewStateChanges=!0,this.tryToInitiateRequestedStateChange(i.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED)}_requestAndSaveSectionStateChange(e,t,n,r){this._appState.scene()!=null&&(e.stage(t,n),this._requestStateChange(t,r),ne.equals(t.oldStateId(),t.newStateId())||this.commitSectionStateChange(e))}_saveSectionStateChange(e,t,n){this._appState.scene()!=null&&(e.stage(t,n),ne.equals(t.oldStateId(),t.newStateId())||this.commitSectionStateChange(e))}tryToInitiateRequestedStateChange(e){this._requestedStateChange!=null&&(this._forceInitiateStateChangeForTests||e==i.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW?this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history):this._requestedStateChange.change.newStateAndOverlays.statesAndOverlaysIncluded().asList().every(r=>{var a;let o=(a=this._appState.scene())==null?void 0:a.findNode2(r);return o==null?!1:o.hasBeenLoaded()})&&this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history))}_maybeTrackStateChangeInitiated(e){var n;let t=e.newStateAndOverlays.statesAndOverlaysIncluded();for(let r of t.asList())this._visitedScreenIds._in(r)||this._visitedScreenIds.add(r);if(this._requestedStateChangeAtMs>0){let r=Qe.milliseconds()-this._requestedStateChangeAtMs;if(r>100){let o=new Map([["prototypeType",Wi[this._appState.prototypeStructure().currentType()]],["incrementalFrameLoading",!0],["timeWaitedForLoadingMs",r],["interactionId",(n=e==null?void 0:e.interactionAddress)==null?void 0:n.interactionId],["interactionCause",En[e.cause]],["destinationId",e.newStateId()]]),a=this._appState.requestedFrameMetricsTracker().getMetricsForRequestedNode(e.newStateId());this._appState.requestedFrameMetricsTracker().clear(),a&&(o.set("destinationWasLoaded",a.wasAlreadyLoaded),o.set("destinationWasInWorkingSet",a.wasAlreadyInWorkingSet)),Be.trackDefinedEvent("viewer_reached_unloaded_frame",o)}}}_initiateStateChange(e,t){this._disableNewStateChanges=!0;for(let o of e.getRemovedFrameIds())this._forEachMaterializedStateInTlf(o,a=>{if(a.changeHistory().length>0&&ce.List_last(a.changeHistory()).isTransientChange()){let s=Kt.TransitionAction_getOppositeTransientAction(ce.List_last(a.changeHistory()).cause);return this.returnInstanceToState(a.stablePath,0,s),a.clearInitiatedChangesInSelfAndSubstates(),be.Loop.SKIP}return be.Loop.CONTINUE});this._emitter.trigger("requestedStateChangeInitiated",{}),this._maybeTrackStateChangeInitiated(e),this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._disableNewStateChanges=!1,this._initiatedChange=e,this._initiatedHistory=t;let n=e.newStateId();this._tlfHistory.indexOf(n)<0&&ce.List_appendOne(this._tlfHistory,n),this._shouldNotifyNavigationInfoInvalidated=!0,this.logVerbose(()=>`[PrototypeState] initiateTopLevelChange ${e.debugString(this._appState.scene())}`),this._lastInitiatedTopLevelStateChange=e,this._actionCounter=this._actionCounter+1,this._broadcastStateChange(e,1,null),(e==null?void 0:e.oldStateId())!=(e==null?void 0:e.newStateId())&&(this._ongoingNavigateRepairsInvalidState=!1),e.direction==1&&e.transitionParameters.transitionType=="INSTANT_TRANSITION"&&this.commitStateChange(),this._deferEnqueueUpcomingTlfs()}lastInitiatedTopLevelStateChange(){return this._lastInitiatedTopLevelStateChange}_broadcastStateChange(e,t,n){let r=this._isNotifyingStateChangeObservers;switch(r&&Ke("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,t){case 0:{this._observers.forEach(o=>{o.handleStateChangeRequested(e)});break}case 1:{this._observers.forEach(o=>{o.handleStateChangeInitiated(e)});break}case 2:{this._observers.forEach(o=>{o.handleStateChangeAborted(e)});break}case 3:{this._observers.forEach(o=>{o.handleStateChangeCommitted(e,n)});break}}this._isNotifyingStateChangeObservers=r}debugHSMTree(){X.getFeatureFlags().prototypeStateManagement&&(console.log("== Component SST =="),console.log(this.componentStateSyncer.debugString()),console.log("== Component HSM ==")),console.log(this._hsmRoot.debugHierarchy(this._appState.scene()))}addHsmObserver(e){this._hsmObservers.add(e)}removeHsmObserver(e){this._hsmObservers.remove(e)}_getStateMachineOrNull(e){let t=e==null?void 0:e.guids;if(t==null)return null;let n=this._hsmRoot;for(let r of t){if(n==null)break;n=n.childOrNull(r)}return n}getStateMachineOrNull(e){return this._getStateMachineOrNull(e)}_getStateMachineOrNullWithString(e){return this._getStateMachineOrNull(Mt.fromString(e))}_getParentStateMachineOrNull(e){return e.guids.length==0?null:this._getStateMachineOrNull(e.slice2(0,e.guids.length-1))}_forMaterializedStateMachineAndDescendants(e,t){var o;let r=[this._getStateMachineOrNull(e)];for(;r.length>0;){let a=r.pop();if(a!=null){let s=((o=this._appState.scene())==null?void 0:o.findNode3(a.stablePath))==null,l=0;s?a==this._hsmRoot?l=be.Loop.CONTINUE:l=be.Loop.SKIP:l=t(a);let d=!1;switch(l){case be.Loop.BREAK:{d=!0;break}case be.Loop.CONTINUE:{ce.List_append2(r,a.getChildren());break}case be.Loop.SKIP:continue}if(d)break}}}createOrRepairStateMachinesForInsertedSubtree(e){be.forEachNode2(e,t=>{var n;if(t.isInstance()){let r=(n=t.symbolID())!=null?n:ne.invalid();ne.isValid(r)||console.warn("Unexpected null symbolData for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(t,r)}else t.type()=="SECTION"&&this.createOrRepairSectionStateMachineIfNeeded(t,t.id())})}createOrRepairSectionStateMachineIfNeeded(e,t){let n=this._getParentStateMachineOrNull(e.stablePath());if(n==null){Ke("Could not create or repair state machine for section with null parent");return}let r=ce.List_last(e.stablePath().guids),o=n.childOrNull(r);if(o!=null)if(ne.equals(o.stateId(),t)){this._isResettingStateChangeMutations&&o.resetHistoryToFirstFrameInSection(e);return}else o.initiatedChange()!=null&&this.commitSectionStateChange(o);n.setChild(r,new jl(this,e,t,!0))}createOrRepairInstanceStateMachineIfNeeded(e,t){let n=this._getParentStateMachineOrNull(e.stablePath());if(n==null){console.warn("Could not create or repair state machine with null parent");return}let r=ce.List_last(e.stablePath().guids),o=n.childOrNull(r);if(o!=null){if(ne.equals(o.stateId(),t)){this._isResettingStateChangeMutations&&o.resetHistoryToState(t);return}else if(o.initiatedChange()!=null){if(this.isApplyingStateChangeMutation())return;this.commitInstanceStateChange(o)}}n.setChild(r,new jl(this,e,t))}actionCounterForState(e){let t=this._getStateMachineOrNull(e);return t==null?-1:t.actionCounter}actionCountersForStateAndAncestors(e){let t=[this.actionCounter()];for(let n=0,r=e.guids.length;n<r;n=n+1)t.push(this.actionCounterForState(e.slice2(0,n+1)));return t}getStateMachineInitiatedChange(e){let t=this._getStateMachineOrNull(e);return t==null?void 0:t.initiatedChange()}getStateMachineLastChangeInHistory(e){let t=this._getStateMachineOrNull(e);return t==null||t.changeHistory().length==0?null:t!=null?ce.List_last(t.changeHistory()):null}getLastFrameOrSectionVisitedInSection(e){if(e==null)return null;let t=this.getStateMachineLastChangeInHistory(new Mt([e]));return t!=null?t.newStateAndOverlays.stateId:null}getState(e){let t=this._getStateMachineOrNull(e);return t==null?void 0:t.stateId()}_forEachMaterializedStateInTlf(e,t){var r;let n=(r=this._appState.scene())==null?void 0:r.findNode1(e);n==null||!n.isTopLevel()||be.forEachNode1(n,o=>{if(o.isInstance()){let a=this._getStateMachineOrNull(o.stablePath());if(a!=null)return t(a)}return be.Loop.CONTINUE})}_forEachTransitioningStateMachine(e){for(let t of Array.from(this._initiatedInstanceChanges.keys()))if(Array.from(this._initiatedInstanceChanges.keys()).indexOf(t)!=-1){let n=this._initiatedInstanceChanges.get(t);if(e(n.stablePath)==be.Loop.BREAK)break}}getOnscreenStates(){let e=[],t=this.getLayersIds();for(let n of t)this._forEachMaterializedStateInTlf(n,r=>{if(2==0){let o=this._appState.scene().findNode3(r.stablePath)}return e.push(new vr(r.stablePath,r.stateId())),be.Loop.CONTINUE});return e}forMaterializedStateInstanceAndDescendants(e,t){this._forMaterializedStateMachineAndDescendants(e,n=>t(n.stablePath))}_deferEnqueueUpcomingTlfs(){this._enqueueUpcomingTlfsDeadline=Qe.milliseconds()+(na?0:250)}lastInitiatedInstanceStateChange(){return this._lastInitiatedInstanceStateChange}_forStateMachineAndParents(e,t){let n=e.guids,r=[],o=this._hsmRoot,a=0;for(;o!=null&&a<n.length;)o=o.childOrNull(n[a]),o!=null&&r.push(o),a=a+1;if(!(r.length==0||!Mt.equals(ce.List_last(r).stablePath,e))){for(let s=r.length-1;s>=0;s=s-1)if(t(r[s])==be.Loop.BREAK)return}}_shouldDisableNewChangesInStateMachine(e){var r;let t=(r=this._appState.scene())==null?void 0:r.findNode3(e.stablePath);if(t==null)return!0;let n=t;for(;n!=null;){let o=this._getStateMachineOrNull(n.stablePath());if(o!=null&&o.isClearingChangesInSelfAndSubstates())return!0;n=n.parent()}return!1}swapInstanceToState1(e,t,n,r,o,a){this.swapInstanceToState2(e,t,n,r,o,a,null)}swapInstanceToState2(e,t,n,r,o,a,s){this.logVerbose(()=>`[HSM] >>>>>>>> swap instance ${e} to state -> ${t} cause: ${En[r]}`);let l=this._getStateMachineOrNull(e);if(l==null||this._shouldDisableNewChangesInStateMachine(l)||this._validatedStateSwapDestination(l.stateId(),t)==null)return;l.clearInitiatedChangesInSelfAndSubstates();let c=n!=null&&o!=null?Qr.forNoodle(n,o,s):Qr.getDefaultExternalExecution(),p=new Zn(2,l.stablePath,l.stateId(),t,c.interactionAddress,c.canvasSpaceTriggerBoundsOrNull,c.transitionParameters,r),u=null;switch(a){case 0:{u=l.changeHistory();break}case 1:{u=rn.FrozenList_cloneAndAppendOne(l.changeHistory(),p);break}case 2:{u=[p].slice();break}}let h=this._shouldDisallowSwap(e,t);h==1?this._onStateSwapFailedDueToCycle():h==0&&this._requestInstanceStateChange(l,p,u)}returnInstanceToState(e,t,n){this.logVerbose(()=>`[HSM] >>>>>>>> return instance ${e} to previous state cause: ${En[n]}`);let r=this._getStateMachineOrNull(e);if(r==null||this._shouldDisableNewChangesInStateMachine(r)||(r.clearInitiatedChangesInSelfAndSubstates(),r.changeHistory().length<=1))return;let o=r.cloneHistoryForReturnToState(t,(p,u)=>this._validatedStateSwapDestination(p,u)),a=o.a,s=o.b,l=this._validatedStateSwapDestination(r.stateId(),ce.List_last(s).newStateId());if(l==null)return;let d=new Zn(2,r.stablePath,r.stateId(),l.id(),a.interactionAddress,a.canvasSpaceTriggerBoundsOrNull,a.transitionParameters,n),c=this._shouldDisallowSwap(r.stablePath,l.id());c==1?this._onStateSwapFailedDueToCycle():c==0&&this._requestInstanceStateChange(r,d,s)}_requestInstanceStateChange(e,t,n){this._forMaterializedStateMachineAndDescendants(e.stablePath,o=>o!=e&&o.changeHistory().length>0&&ce.List_last(o.changeHistory()).isTransientChange()?(this.returnInstanceToState(o.stablePath,0,0),o.clearInitiatedChangesInSelfAndSubstates(),be.Loop.SKIP):be.Loop.CONTINUE);let r=this._appState.scene();if(r!=null){e.stage(t,n),this._initiatedInstanceChanges.set(e.stablePath.toString(),t),this._lastInitiatedInstanceStateChange=t;let o=this._appState.scene().findNode3(t.interactionAddress.hotspotStablePath),a=new Map,s=null;this._isApplyingStateChangeMutation=!0,e.broadcastHsmStateChange(this._hsmObservers,t,0,null),r.dangerouslyDeferNodeRemovalScope(()=>{let c=this._getFullscreenNodeChangesForStateSwap(e.stablePath,t.newStateId(),0);for(let p of c.cloneOps)p.clone.copyNodeCachedTransformAndBounds(p.source),a.set(p.source,p.clone);s=this._appState.scene().findNode3(c.transitionRootStablePath)});let l=jc.Map_getOrDefault(a,o,null),d=jc.Map_getOrDefault(a,s,null);s!=null&&d!=null?s.transitioningFrom=new pc(d,t.stablePath,l):Ke("Failed to find swapped out node after state swap"),ne.equals(t.oldStateId(),t.newStateId())||(this._forEachTransitioningStateMachine(c=>{if(!Mt.equals(t.stablePath,c)){let p=r.findNode3(c);if(s!=null&&s.isAncestorOf(p)){let u=this._getStateMachineOrNull(c);this.commitInstanceStateChange(u)}}return be.Loop.CONTINUE}),this._deferEnqueueUpcomingTlfs()),this._isApplyingStateChangeMutation=!1}e.actionCounter=e.actionCounter+1,e.broadcastHsmStateChange(this._hsmObservers,t,1,null),this.logVerbose(()=>`[HSM] initiate ${t.oldStateId()} -> ${t.newStateId()} finished for ${e.stablePath} -- ${t.transitionParameters.transitionType} !`)}commitChangesBelowStablePath(e){var n,r;let t=(n=this._appState.scene())==null?void 0:n.findNode3(e);for(let o of Array.from(this._initiatedInstanceChanges.keys())){let a=this._initiatedInstanceChanges.get(o),s=this._getStateMachineOrNull(a.stablePath);s!=null&&t!=null&&t.isAncestorOf((r=this._appState.scene())==null?void 0:r.findNode3(s.stablePath))&&this.commitInstanceStateChange(s)}}commitChangesBelowInstanceTransitionRoot(e){let t=this._findTransitionRootForSwappedPath(e),n=t==null?e:t.stablePath();this.commitChangesBelowStablePath(n)}commitInstanceStateChange(e){if(e.initiatedChange()==null)return;let t=e.initiatedChange();e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null),this._initiatedInstanceChanges.delete(e.stablePath.toString()),ne.equals(t.oldStateId(),t.newStateId())||this._finishStateSwapMutation(t.stablePath);let n=[],r=o=>{n.push(o)};if(e.broadcastHsmStateChange(this._hsmObservers,t,3,r),!e.isClearingChangesInSelfAndSubstates())for(let o of n)o();this.logVerbose(()=>`[HSM] commit ${t.oldStateId()} -> ${t.newStateId()} finished for ${t.stablePath} -- ${t.transitionParameters.transitionType} !`)}commitSectionStateChange(e){e.initiatedChange()!=null&&(e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null))}abortInstanceStateChange(e){let t=this._getStateMachineOrNull(e);if(t==null||t.initiatedChange()==null)return;let n=t.initiatedChange();if(this._appState.scene()!=null){t.stage(null,null),this._initiatedInstanceChanges.delete(t.stablePath.toString());let o=this._findTransitionRootForSwappedPath(e),a=o.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,o.transitioningFrom=null,a.removeSelfAndSubtree(),t.broadcastHsmStateChange(this._hsmObservers,n,0,null),this._getFullscreenNodeChangesForStateSwap(t.stablePath,n.oldStateId(),1),this._isApplyingStateChangeMutation=!1}t.broadcastHsmStateChange(this._hsmObservers,n,2,null),this.logVerbose(()=>`[HSM] abort ${n.oldStateId()} -> ${n.newStateId()} finished for ${t.stablePath} -- ${n.transitionParameters.transitionType} !`)}_validatedStateSwapDestination(e,t){var s,l;let n=(s=this._appState.scene())==null?void 0:s.findNode1(e),r=n==null?void 0:n.parent();if((n==null?void 0:n.type())!="SYMBOL"||r==null||!r.isStateGroup())return null;let o=(l=this._appState.scene())==null?void 0:l.findNode1(t),a=o==null?void 0:o.parent();return(o==null?void 0:o.type())!="SYMBOL"||a==null||!a.isStateGroup()||ne.equals(e,t)?null:ne.equals(r.id(),a.id())?o:null}isApplyingStateChangeMutation(){return this._isApplyingStateChangeMutation}isResettingStateChangeMutations(){return this._isResettingStateChangeMutations}_findTransitionRootForSwappedPath(e){var n;let t=(n=this._appState.scene())==null?void 0:n.findNode3(e);for(;t!=null;){if(t.transitioningFrom!=null&&t.transitioningFrom.swappedStablePath==e)return t;t=t.parent()}return null}_finishStateSwapMutation(e){let t=this._findTransitionRootForSwappedPath(e);if(this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation started for ${e}`),t==null)return;let n=t.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,t.transitioningFrom=null,n.removeSelfAndSubtree(),this._isApplyingStateChangeMutation=!1,t.invalidateRenderTreeForSelfAndParents(),t.invalidateRenderTreeForChildren(),this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation finished for ${e}`)}_getFullscreenNodeChangesForStateSwap(e,t,n){return L._prototypeLib.getNodeChangesForSwap(e,t,n)}_shouldDisallowSwap(e,t){return L._prototypeLib.shouldDisallowSwap(e,t)}logVerbose(e){this.VERBOSE_LOGS&&(this.debugHSMTree(),console.log(e()))}};(n=>{class i{constructor(o,a){this.change=o,this.history=a}}n.StateChangeRequest=i;let e;(a=>(a[a.WAIT_UNTIL_DESTINATIONS_LOADED=0]="WAIT_UNTIL_DESTINATIONS_LOADED",a[a.FORCE_INITIATE_NOW=1]="FORCE_INITIATE_NOW"))(e=n.InitiateRequestedStateChangePolicy||(n.InitiateRequestedStateChangePolicy={}));let t;(o=>{function r(a){return n.InitiateRequestedStateChangePolicy[a]}o.InitiateRequestedStateChangePolicy_toString=r})(t=n.in_InitiateRequestedStateChangePolicy||(n.in_InitiateRequestedStateChangePolicy={}))})(ko||(ko={}));var Yi=(t=>(t[t.FIX_INVALID_STATE=0]="FIX_INVALID_STATE",t[t.USER_REQUESTED=1]="USER_REQUESTED",t))(Yi||{}),Ld=(n=>(n[n.LAST_NONTRANSIENT_STATE=0]="LAST_NONTRANSIENT_STATE",n[n.BEFORE_LAST_NONTRANSIENT_STATE=1]="BEFORE_LAST_NONTRANSIENT_STATE",n[n.BEFORE_LAST_ANY_STATE=2]="BEFORE_LAST_ANY_STATE",n))(Ld||{}),Pa=(s=>(s[s.NONE=0]="NONE",s[s.CONTAIN=1]="CONTAIN",s[s.SCALE_DOWN=2]="SCALE_DOWN",s[s.MIN_ZOOM=3]="MIN_ZOOM",s[s.FREE=4]="FREE",s[s.SCALE_DOWN_TO_FIT_WIDTH=5]="SCALE_DOWN_TO_FIT_WIDTH",s[s.FIT_WIDTH=6]="FIT_WIDTH",s))(Pa||{});var dh=class{handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){this.callback(e)}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}handleSetVariableAction(e){}constructor(e){this.callback=e}},jl=class{constructor(){if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this.stablePath=null,this._changeHistory=null,this._initiatedChange=null,this._initiatedChangeHistory=null,this._isNotifyingStateChangeObservers=!1,this.actionCounter=0,this._children=new Map,this._isClearingChangesInSelfAndSubstates=!1,this._prototypeState=null,this._prototypeState=e,this.stablePath=t.stablePath(),this.resetHistoryToState(n)}else if(arguments.length==1){let e=arguments[0];this.stablePath=null,this._changeHistory=null,this._initiatedChange=null,this._initiatedChangeHistory=null,this._isNotifyingStateChangeObservers=!1,this.actionCounter=0,this._children=new Map,this._isClearingChangesInSelfAndSubstates=!1,this._prototypeState=null,this._prototypeState=e,this.stablePath=new Mt([]),this.setChangeHistory([])}else if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this.stablePath=null,this._changeHistory=null,this._initiatedChange=null,this._initiatedChangeHistory=null,this._isNotifyingStateChangeObservers=!1,this.actionCounter=0,this._children=new Map,this._isClearingChangesInSelfAndSubstates=!1,this._prototypeState=null,this._prototypeState=e,this.stablePath=t.stablePath(),r?this.resetHistoryToFirstFrameInSection(t):this.resetHistoryToState(n)}}changeHistory(){return this._changeHistory}setChangeHistory(e){this._changeHistory=e}debugHierarchy(e){return this._debugHierarchy(0,e)}_debugHierarchy(e,t){var u,h,f,_;let n="";for(let m=0,A=e;m<A;m=m+1)n+="  ";n+=this.stablePath.toString()+": ";let r="missing state name",o="(N/A)";if(this.stateId()!=null){let m=t.findNode1(this.stateId());m!=null&&(r=(u=m.name())!=null?u:"null state name"),o="("+this.stateId()+")"}n+="<"+r+" "+o+">";let a="[",s=0,l=3,d=this.changeHistory();d.length>l&&(a+="..., ",s=d.length-l);for(let m=s,A=d.length;m<A;m=m+1){let y=d[m];a+=`${(h=y==null?void 0:y.oldStateId())!=null?h:"null"}->${y==null?void 0:y.newStateId()}`,m!=d.length-1&&(a+=", ")}a+="]",n+=" "+a;let c=t.findNode3(this.stablePath);if(c!=null){let m=(f=c.name())!=null?f:"null node name";n+=" "+m}let p=this.initiatedChange()!=null?`{${(_=this.initiatedChange().oldStateId())!=null?_:"null"}->${this.initiatedChange().newStateId()}}`:"";n+=" "+p+`
`;for(let m of Array.from(this._children.values()))n+=m._debugHierarchy(e+1,t);return n}removeChild(e){this._children.delete(e)}setChild(e,t){this._children.set(e,t)}childOrNull(e){return Le.StringMap_get(this._children,e,null)}getChildren(){return Array.from(this._children.values())}stage(e,t){this._initiatedChange=e,this._initiatedChangeHistory=t}initiatedChange(){return this._initiatedChange}initiatedChangeHistory(){return this._initiatedChangeHistory}stateId(){var t,n;if(((t=this.initiatedChange())==null?void 0:t.newStateId())!=null)return(n=this.initiatedChange())==null?void 0:n.newStateId();let e=this.changeHistory();return e!=null&&e.length>0?ce.List_last(e).newStateId():ne.invalid()}clearInitiatedChangesInSelfAndSubstates(){this._isClearingChangesInSelfAndSubstates=!0,this._prototypeState.commitChangesBelowInstanceTransitionRoot(this.stablePath),this._isClearingChangesInSelfAndSubstates=!1}isClearingChangesInSelfAndSubstates(){return this._isClearingChangesInSelfAndSubstates}cloneHistoryForReturnToState(e,t){let n=e!=2,r=null,o=this.changeHistory().slice();for(;o.length>1&&(n&&ce.List_last(o).isTransientChange());)r=o.pop();if(e==0||o.length<=1)return new vr(r,o);for(r=ce.List_last(o);o.length>1;){let a=o.pop();if(!(o.length>1&&n&&ce.List_last(o).isTransientChange()||t(a.newStateId(),a.oldStateId())==null))break}return new vr(r,o)}resetHistoryToState(e){let t=new Zn(2,this.stablePath,null,e,Io.EXTERNAL,null,ar.getDefault(),0);this.setChangeHistory([t].slice())}resetHistoryToFirstFrameInSection(e){let t=Wt.visuallySortedTopLevelFrames(e);if(t.length>0){let n=t[0];if(n!=null){let r=new Zn(2,this.stablePath,null,n.id(),Io.EXTERNAL,null,ar.getDefault(),0);this.setChangeHistory([r].slice())}}else this.setChangeHistory([].slice())}broadcastHsmStateChange(e,t,n,r){let o=this._isNotifyingStateChangeObservers;switch(o&&console.warn("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,n){case 0:{e.forEach(a=>{a.handleHsmRequested(this.stablePath,t)});break}case 1:{e.forEach(a=>{a.handleHsmInitiated(this.stablePath,t)});break}case 2:{e.forEach(a=>{a.handleHsmAborted(this.stablePath,t)});break}case 3:{e.forEach(a=>{a.handleHsmCommitted(this.stablePath,t,r)});break}}this._isNotifyingStateChangeObservers=o}},WI;(e=>{function i(t){return qI[t]}e.StateChangePhase_toString=i})(WI||(WI={}));var QI;(e=>{function i(t){return Yi[t]}e.RestartCause_toString=i})(QI||(QI={}));var KI;(e=>{function i(t){return Ld[t]}e.ReturnTo_toString=i})(KI||(KI={}));var vs;(n=>{function i(r,o){return r!=1&&r!=2&&r!=5&&r!=6&&!(r==3&&o)}n.FitMode_userCanManuallyZoom=i;function e(r){return r!=1&&r!=2&&r!=0&&r!=4}n.FitMode_topLevelFramesCanScroll=e;function t(r){return Pa[r]}n.FitMode_toString=t})(vs||(vs={}));var YI=new Set(["https://app.maze.co","https://t.maze.co","https://app.testingmazeco.cloud","https://t.testingmazeco.cloud","https://app.stagingmazeco.cloud","https://app.stagingmazeco.cloud","http://localhost:8000","http://localhost:8001"]);function XI(){try{if(window.top===window)return null;if(window.location.origin===window.parent.location.origin)return window.location.origin}catch{return null}}var fa;(m=>{function i(A){m._mockEmbedListener=A}m.setMockListener=i;function e(A,y){y.addObserver(new p(A,y)),m._prototypeObserver=new u(A),A.prototypeState().addObserver(m._prototypeObserver),A.prototypeState().addHsmObserver(m._prototypeObserver),$t.getEventEmitter().on("sceneDidCompleteInitialLoad",g=>{A.scene().addObserver(m._prototypeObserver),n(0,{})}),$t.getEventEmitter().on("requestClose",g=>{n(5,{})});let S=window;S!==null&&S.addEventListener("message",g=>{if(X.getFeatureFlags().embedApiLimitOrigins&&!(XI()||YI.has(g.origin)))return;let b=g.data;if(b){let T=b.type,I=b.data;t(A,y,T,I)}})}m.init=e;function t(A,y,S,g){var b,T,I;switch(S){case"NAVIGATE_TO_FRAME_AND_CLOSE_OVERLAYS":{let O=ne.fromString(g.nodeId),w=ne.fromString(g.startingPointNodeId);X.isInlinePreview()&&(A.prototypeState().resetPrototype(),y.handleRestartPrototype(),A.videoManager().handleRestartPrototype()),X.isInlinePreview()&&O==null?A.prototypeState().navigateToFrameAndCloseOverlays2(O,w):ne.isValid(O)?((b=A.scene())==null?void 0:b.findNode1(O))!=null?A.prototypeState().navigateToFrameAndCloseOverlays2(O,w):m._prototypeObserver.setPendingNodeId(O):console.error(`Expected node id; got '${g.nodeId}' instead`);break}case"NAVIGATE_BACKWARD":{y.navigateBackward(18);break}case"NAVIGATE_FORWARD":{y.navigateForward(19);break}case"CHANGE_COMPONENT_STATE":{let O=(T=A.scene())==null?void 0:T.findNodeFromDeveloperFriendlyId(g.nodeId),w=(I=A.scene())==null?void 0:I.findNodeFromDeveloperFriendlyId(g.newVariantId);if(O==null){console.error(`Could not find node from specified node id '${g.nodeId}'`);return}if(w==null){console.error(`Could not find variant for CHANGE_COMPONENT_STATE from id '${g.newVariantId}'`);return}A.prototypeState().swapInstanceToState2(O.stablePath(),w.id(),null,0,null,1,null);break}case"RESTART":{A.prototypeState().restartPrototype(1);break}default:break}}m._receiveFromHost=t;function n(A,y){let S=Le.StringMap_toJSObject(new Map([["type",c[A]],["data",y]]));if(m._mockEmbedListener!=null){(0,m._mockEmbedListener)(S);return}let g=window;if(!(g===null||g.parent===null||g.parent.postMessage===void 0)&&g.top!==g)if(X.getFeatureFlags().embedApiLimitOrigins){let b=XI();if(b)g.parent.postMessage(S,b);else for(let T of YI)g.parent.postMessage(S,T)}else g.parent.postMessage(S,"*")}m._sendToHost=n;function r(A,y){for(let S=A.childCount()-1;S>=0;S=S-1)r(A.childAt2(S,!0),y);y(A)}m._forEachNodeInHitTestOrder=r;function o(A,y){let S=null,g=null;return r(A,b=>{if(S!=null)return;let T=b.canvasSpaceScrolledInteractiveBounds(0);if(b.isVisibleInCanvas()&&T.contains2(y)){S=b;let I=b.canvasSpaceScrolledInteractiveBounds(1);g=y.subtract1(I.topLeft())}}),S==null?null:new d(S,g)}m.findClickInfoForUnhandledMouseRelease=o;function a(A,y,S){if(y.node==null){Ke("Hotspot node is null");return}let g=A.baseScreenNode();if(g==null)return;let b=A.prototypeState().getTopmostOverlayNode(),T=b!=null?b:g,I=S;b!=null&&(I=A.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(g,S));let O=I.subtract1(y.node.canvasSpaceScrolledInteractiveBounds(1).topLeft()),w={};w.handled=!0,w.presentedNodeId=T.developerFriendlyId(),w.targetNodeId=y.node.developerFriendlyId(),w.targetNodeMousePosition=O.toJSON();let P=y.node.findContainingScrollingFrameOrSelf();if(P!=null){let H=P.canvasSpaceScrolledInteractiveBounds(1),re=I.subtract1(H.topLeft());w.nearestScrollingFrameId=P.developerFriendlyId(),w.nearestScrollingFrameMousePosition=re.toJSON(),w.nearestScrollingFrameOffset=P.scrollOffset().toJSON()}else w.nearestScrollingFrameId=null,w.nearestScrollingFrameMousePosition=null,w.nearestScrollingFrameOffset=null;n(1,w)}m.willTriggerClickLikeHotspot=a;function s(A,y){let S=A.baseScreenNode();if(S==null)return;let g=A.prototypeState().getTopmostOverlayNode(),b=y;g!=null&&(b=A.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(S,y));let T=g!=null?g:S,I=o(T,b),O={};O.handled=!1,O.presentedNodeId=T.developerFriendlyId(),O.targetNodeId=I!=null?I.node.developerFriendlyId():null,O.targetNodeMousePosition=I!=null?I.nodeSpacePoint.toJSON():null;let w=I!=null?I.node.findContainingScrollingFrameOrSelf():null;if(w!=null){let P=w.canvasSpaceScrolledInteractiveBounds(1),H=b.subtract1(P.topLeft());O.nearestScrollingFrameId=w.developerFriendlyId(),O.nearestScrollingFrameMousePosition=H.toJSON(),O.nearestScrollingFrameOffset=w.scrollOffset().toJSON()}else O.nearestScrollingFrameId=null,O.nearestScrollingFrameMousePosition=null,O.nearestScrollingFrameOffset=null;n(1,O)}m.notifyUnhandledMouseRelease=s;function l(){n(4,{})}m.notifyVariableUpdated=l;class d{constructor(y,S){this.node=y,this.nodeSpacePoint=S}}m.ClickedLayer=d;let c;(I=>(I[I.INITIAL_LOAD=0]="INITIAL_LOAD",I[I.MOUSE_PRESS_OR_RELEASE=1]="MOUSE_PRESS_OR_RELEASE",I[I.PRESENTED_NODE_CHANGED=2]="PRESENTED_NODE_CHANGED",I[I.NEW_STATE=3]="NEW_STATE",I[I.VARIABLE_UPDATED=4]="VARIABLE_UPDATED",I[I.REQUEST_CLOSE=5]="REQUEST_CLOSE"))(c=m.MessageType||(m.MessageType={}));class p{willTriggerHotspot(y,S,g,b){let T=g==4||g==8||g==9||g==3;if(b!=null&&T){let I=this._canvasView.viewport().viewSpaceToCanvasSpace1().transformPoint(b.clone());a(this._appState,y,I)}}didScrollNode(y){}constructor(y,S){this._appState=y,this._canvasView=S}}m.EmbedCanvasViewObserver=p;class u{constructor(y){this.appState=null,this._pendingNodeId=null,this.appState=y}setPendingNodeId(y){this._pendingNodeId=y}handleSceneGraphEvent(y){var S;this._pendingNodeId!=null&&((S=this.appState.scene())==null?void 0:S.findNode1(this._pendingNodeId))!=null&&(X.isInlinePreview()?this.appState.prototypeState().navigateToFrameAndCloseOverlays2(this._pendingNodeId,this._pendingNodeId):this.appState.prototypeState().navigateToFrameAndCloseOverlays1(this._pendingNodeId),this._pendingNodeId=null)}handlePresentedNodeChanged(y){if(y==null)return;let S=this.appState.baseScreenNode();if(!X.isInlinePreview()&&S==null)return;let g=this.appState.prototypeState().getTopmostOverlayNode(),b=g!=null?g:S,T={};T.presentedNodeId=b==null?void 0:b.developerFriendlyId(),T.isStoredInHistory=!Kt.TransitionAction_isTransientAction(y.cause);let I={};this.appState.prototypeState().getOnscreenStates().forEach(O=>{let w=O.a,P=O.b,H=this.appState.scene().findNode3(w);H!=null&&(I[H.developerFriendlyId()]=P)}),T.stateMappings=I,n(2,T)}handleInteractiveComponentStateChange(y,S){if(S==null)return;let g=this.appState.scene().findNode3(y);if(g==null)return;let b={};b.nodeId=g.developerFriendlyId(),b.currentVariantId=S.oldStateId(),b.newVariantId=S.newStateId(),b.isStoredInHistory=!Kt.TransitionAction_isTransientAction(S.cause),b.isTimedChange=S.cause==1,n(3,b)}handleStateChangeAborted(y){this.handlePresentedNodeChanged(y)}handleStateChangeCommitted(y,S){}handleStateChangeInitiated(y){this.handlePresentedNodeChanged(y)}handleStateChangeRequested(y){}handleFitModeChange(y,S){}handleRestartPrototype(){}handleHsmAborted(y,S){this.handleInteractiveComponentStateChange(y,S)}handleHsmCommitted(y,S,g){}handleHsmInitiated(y,S){this.handleInteractiveComponentStateChange(y,S)}handleHsmRequested(y,S){}}m.EmbedPrototypeObserver=u;let h;(y=>{function A(S){return c[S]}y.MessageType_toString=A})(h=m.in_MessageType||(m.in_MessageType={})),m._mockEmbedListener=null,m._prototypeObserver=null})(fa||(fa={}));var uh=class{onClick(){this._timeOfLastClick=Qe.seconds()}getOpacity(){let e=Qe.seconds()-this._timeOfLastClick;return e<this._animationDuration?1-this._easingFunction.get(e):0}constructor(){var e;this._animationDuration=.7,this._easingFunction=Vr.makeEasingFunction([0,0,.58,1],.7,(e=X)==null?void 0:e.viewerAnimationEasingCache()),this._timeOfLastClick=0}},ph=class{constructor(e,t){this._hotspotMaterial=null,this._hotspotQuad=null,this._context=null,this._context=e,this._hotspotMaterial=this._context.createMaterial("hotspot",N.VertexFormat.POSITION_F4,X_,j_);let n=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._hotspotQuad=t.allocate(N.VertexFormat.POSITION_F4,n)}draw(e,t,n,r,o){if(r<=0)return;let a=e;for(let s of n){let l=oe.new2();l.copyFrom(a);let d=s.canvasSpaceBounds;l.translate2(d.x(),d.y()),l.scale4(d.width(),d.height());let c=U.new2();s.canvasSpaceClipBounds.transformInto1(c,a);let p=new E(2/d.width(),2/d.height());p.divideUpdate(t*o),N.in_Material.Material_setUniformMat32(this._hotspotMaterial,Tn,l),N.in_Material.Material_setUniformVec22(this._hotspotMaterial,eS,p),this._hotspotMaterial.setUniformVec41(cS,c.x(),c.y(),c.width(),c.height()),this._hotspotMaterial.setUniformFloat(oS,r),N.in_Context.Context_setUnpremultipliedBlendState(this._context),this._context.draw(N.Primitive.TRIANGLE_STRIP,this._hotspotMaterial,this._hotspotQuad)}}},Bd=class{constructor(e,t){this.canvasSpaceBounds=e,this.canvasSpaceClipBounds=t}},hh=class{constructor(){this.backgroundColor=0,this.hotspots=null,this.hotspotOpacity=0,this.particles=null,this.mouse=null,this.renderDots=!1}};var mh=class{constructor(e,t){this._didFinishZooming=null,this._drawIdleCount=0,this._userIdleCount=0,this._isFirstFrame=!1,this._justInteracted=!1,this._zoomInProgress=!1,this._previousZoomScale=1,this._previousRenderStatus=1,this._emitter=null,this._didFinishZooming=e,this._emitter=t}handleSceneChange(){this._isFirstFrame=!0}updateZoomScaleNow(e){this._previousZoomScale=e,this._didFinishZooming(this._previousZoomScale)}handleInteraction(){this._justInteracted=!0}justInteracted(){return this._justInteracted}advanceFrame(e){e.isInvalid()||this._justInteracted?(this._userIdleCount=0,this._drawIdleCount=0):this._userIdleCount=this._userIdleCount+1,this._previousRenderStatus==0?this._drawIdleCount=0:this._drawIdleCount=this._drawIdleCount+1,this._isFirstFrame&&(this._userIdleCount=0,this._isFirstFrame=!1,this.updateZoomScaleNow(e.zoomScale()));let t=this._zoomInProgress;this._zoomInProgress=this._previousZoomScale!=e.zoomScale(),this._zoomInProgress&&!t&&this._emitter.trigger("zoomStart",null);let n=this._userIdleCount>=2;this._zoomInProgress&&n&&this.updateZoomScaleNow(e.zoomScale()),!this._zoomInProgress&&t&&this._emitter.trigger("zoomStop",null),this._justInteracted=!1}renderingIsComplete(){return this._drawIdleCount>0&&this._userIdleCount>0&&!this._justInteracted}shouldRenderOptionalTiles(){return Xe.isMobile(Xe.current())||Xe.current()==4&&navigator.maxTouchPoints>0||wt.forceMobileOptimizations()?this._userIdleCount>6&&this._drawIdleCount<120:this._userIdleCount>6}zoomInProgress(){return this._zoomInProgress}previousZoomScale(){return this._previousZoomScale}setPreviousRenderStatus(e){this._previousRenderStatus=e}};var kd=class{delayedHotspotId(){return this._delayedHotspotId}interaction(){return this._interaction}action(){return this._action}counter(){return this._counter}reset(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=this._counter+1}set(e,t,n){this._delayedHotspotId=e,this._interaction=t,this._action=n,this._counter=this._counter+1}constructor(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=0}},gh=class{resetEntry(e,t){this.resetAllEntriesMatchingPredicate((n,r)=>ne.equals(n,e)&&r==t)}resetAllEntries(){this._maintainedDataEntries.length=0}resetAllEntriesWithInteractionType(e){this.resetAllEntriesMatchingPredicate((t,n)=>n==e)}resetAllEntriesMatchingPredicate(e){this._maintainedDataEntries=this._maintainedDataEntries.filter(t=>!e(t.delayedHotspotId(),t.interaction()))}set(e,t,n){let r=this.getByHotspotAndInteractionType(e,t);if(r==null){let o=new kd;o.set(e,t,n),this._maintainedDataEntries.push(o),r=o}else r.set(e,t,n);return r.counter()}getByHotspotAndInteractionType(e,t){for(let n of this._maintainedDataEntries)if(ne.equals(n.delayedHotspotId(),e)&&n.interaction()==t)return n;return null}constructor(){this._maintainedDataEntries=[]}};var fh=class{constructor(e){this._appState=null,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=[],this.currentlyEnteredGUIDsSet=new Set,this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=[],this.previouslyEnteredGUIDsSet=new Set,this._appState=e}reset(){this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.currentlyEnteredGUIDsSet.clear(),this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.previouslyEnteredGUIDsSet.clear()}updateEnteredNodes(e,t){this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=X.getFeatureFlags().prototypeNewMousePerf?this._getNodesEnteredByCanvasSpacePointV2(e,t):this._getNodesEnteredByCanvasSpacePoint(e),this.currentlyEnteredGUIDsSet=new Set(this._currentlyEnteredNodesGUIDsOrderedInnerToOuter),this.previouslyEnteredGUIDsSet=new Set(this._previouslyEnteredNodesGUIDsOrderedInnerToOuter)}getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(e){let t=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(o=>!this.previouslyEnteredGUIDsSet.has(o));t.reverse();let n=new Map;for(let o=0,a=t.length;o<a;o=o+1)n.set(t[o],o);let r=e.filter(o=>n.has(o.node.id()));return r.sort((o,a)=>At.int_compare(n.get(o.node.id()),n.get(a.node.id()))),r}getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(e){let t=this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.filter(o=>!this.currentlyEnteredGUIDsSet.has(o)),n=new Map;for(let o=0,a=t.length;o<a;o=o+1)n.set(t[o],o);let r=e.filter(o=>n.has(o.node.id()));return r.sort((o,a)=>At.int_compare(n.get(o.node.id()),n.get(a.node.id()))),r}markNodesAsNotEnteredWithoutTriggeringMouseLeave(e){let t=new Set(e);this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(n=>!t.has(n))}resetNoLongerMaintainedMouseEnterOrLeaveInteractions(e){e.resetAllEntriesMatchingPredicate((t,n)=>{let r=n=="MOUSE_ENTER"&&!this.currentlyEnteredGUIDsSet.has(t),o=n=="MOUSE_LEAVE"&&this.currentlyEnteredGUIDsSet.has(t);return r||o})}_getNodesEnteredByCanvasSpacePointV2(e,t){if(this._appState.baseScreenNode()==null)return[];let r=[],[o,a]=this._appState.prototypeState().getTopmostScreenAndPoint(e),s=Wt.getNodeInteractionPairs("MOUSE_ENTER",t),l=Wt.getNodeInteractionPairs("MOUSE_LEAVE",t),d=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(o,0,p=>{let u=p.event().interactionType();return u=="MOUSE_LEAVE"||u=="MOUSE_ENTER"},[...s!=null?s:[],...l!=null?l:[]]),c=null;for(let p of d)p.canvasSpaceScrolledInteractiveBounds(0).contains2(a)&&(c==null||p.node.isAboveInLayerOrder(c.node))&&(c=p);if(c!=null&&c.node){let p=c.node;for(;p!=o;)r.push(p.id()),p=p.parent();r.push(o.id())}return r}_getNodesEnteredByCanvasSpacePoint(e){let t=this._appState.baseScreenNode();if(t==null)return[];let n=this._appState.prototypeState(),r=n.getTopmostOverlayNode(),o=r!=null?r:t,a=r!=null?n.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(t,e):e,s=[],d=o.canvasSpaceScrolledInteractiveBounds(0).contains2(a)?o:null;if(o.forEachDescendantPreorder(c=>{c.canvasSpaceScrolledInteractiveBounds(0).contains2(a)&&(d=c)}),d!=null){let c=d;for(;c!=o;)s.push(c.id()),c=c.parent();s.push(o.id())}return s}};var Zl=class{constructor(e,t){this._ballisticSimulation=null,this._scrollingNodeID=null,this._isValid=!1,this._ballisticSimulation=e,this._scrollingNodeID=t,this._isValid=e!=null}nodeID(){return this._scrollingNodeID}simulation(){return this._ballisticSimulation}isOverscrolled(){return this._ballisticSimulation.isOverscrolled()}isValid(e){return e!=null&&e.findNode1(this._scrollingNodeID)!=null}isDone(){return this._ballisticSimulation.isDone1()}performScroll(e,t){if(!this.isValid(t))return;let n=this._ballisticSimulation.pos1(),r=t.findNode1(this._scrollingNodeID);e.setScrollOffsetUnconditionally(r,n)}};var Ud=class{uninit(){this._semanticScrollStorage.uninitialize1()}getValueFromStorage(e){let t=new nn(e),n=wn.getSemanticNodePath(t);return this._semanticScrollStorage.getData(n,wn.DEFAULT_STORAGE_KEY)}setValueInStorage(e,t){let n=new nn(e),r=wn.getSemanticNodePath(n);this._semanticScrollStorage.insert(r,wn.DEFAULT_STORAGE_KEY,t)}_getOldNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode1(e.oldStateId()):this._appState.scene().findNode3(e.stablePath)}_getNewNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode1(e.newStateId()):this._appState.scene().findNode3(e.stablePath)}commitCurrentScrollStateToStorage(e){let t=this._getOldNode(e);this._recursivelyRecordOffsets(t);for(let n=0,r=e.oldStateAndOverlays.overlays.length;n<r;n=n+1){let o=e.oldStateAndOverlays.overlays[n].id,a=this._appState.scene().findNode1(o);this._recursivelyRecordOffsets(a)}}applyStoredScrollStateToScene(e){let t=this._getNewNode(e);this._recursivelySetOffsets(t);for(let n=0,r=e.newStateAndOverlays.overlays.length;n<r;n=n+1){let o=e.newStateAndOverlays.overlays[n].id,a=this._appState.scene().findNode1(o);this._recursivelySetOffsets(a)}}resetScrollStateToScene(e){let t=this._getNewNode(e);this._recursivelyResetOffsets(t);for(let n=0,r=e.newStateAndOverlays.overlays.length;n<r;n=n+1){let o=e.newStateAndOverlays.overlays[n].id,a=this._appState.scene().findNode1(o);this._recursivelyResetOffsets(a)}}_recursivelyRecordOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&this.setValueInStorage(e,e.scrollOffset()),e.forEachChild(t=>{this._recursivelyRecordOffsets(t)}))}_recursivelySetOffsets(e){if(e!=null){if(e.scrollDirection()!="NONE"){let t=this.getValueFromStorage(e);t!=null?t.equals(e.scrollOffset())||(Be.trackDefinedEvent("prototype.viewer_scroll_state_transferred",new Map),e.setScrollOffset(this._canvasView.restrictScrollDeltaAxes(e,t))):e.setScrollOffset(ve.FrozenVector_ZERO)}e.forEachChild(t=>{this._recursivelySetOffsets(t)})}}_recursivelyResetOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&(Be.trackDefinedEvent("prototype.viewer_scroll_state_reset",new Map),e.setScrollOffset(ve.FrozenVector_ZERO),this.setValueInStorage(e,ve.FrozenVector_ZERO)),e.forEachChild(t=>{this._recursivelyResetOffsets(t)}))}toString(){return this._semanticScrollStorage.toString2(e=>e.toString())}constructor(e,t){this._canvasView=e,this._appState=t,this._semanticScrollStorage=new xa}};var _h=class{constructor(e,t,n,r,o,a,s,l){this.hotspot=e,this.prototypeInteraction=t,this.action=n,this.viewSpacePointOrNull=r,this.prototypeAction=o,this.connectionType=a,this.actionIndexPath=s,this.resolvedVariableModes=l}},Ah=class{constructor(e,t){this._queue=null,this._canvasView=null,this._prototypeState=null,this._queue=[],this._canvasView=e,this._prototypeState=t,this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this),this._canvasView.addObserver(this)}appendToQueue(e,t,n,r,o,a,s,l){this._queue.push(new _h(e,t,n,r,o,a,s,l))}insertInQueue(e,t,n,r,o,a,s,l,d){this._queue.splice(l,0,new _h(e,t,n,r,o,a,s,d))}runNextAction(){if(this._queue.length>0){let e=this._queue.shift();e!=null&&this._runAction(e)}}_runAction(e){this._canvasView.runAction(e.hotspot,e.prototypeInteraction,e.action,e.viewSpacePointOrNull,e.prototypeAction,e.connectionType,e.actionIndexPath,e.resolvedVariableModes)}handleStateChangeAborted(e){this._queue.length=0}handleStateChangeCommitted(e,t){if(this._queue.length>0){let n=this._queue.shift();n!=null&&t(()=>{this._runAction(n)})}}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._queue.length=0}handleHsmAborted(e,t){this._queue.length=0}handleHsmCommitted(e,t,n){if(this._queue.length>0){let r=this._queue.shift();r!=null&&n(()=>{this._runAction(r)})}}handleHsmInitiated(e,t){}handleHsmRequested(e,t){}willTriggerHotspot(e,t,n,r){(n==4||n==8||n==9||n==3)&&(this._queue.length=0)}didScrollNode(e){}};var Gs;(r=>{function i(o){return X.getFeatureFlags().prototypeStateManagement&&o.stateManagementVersion()==1}r.newStateManagementRulesEnabledForChange=i;function e(){return r._seenOldStateManagementInteraction}r.seenOldStateManagementInteraction=e;function t(){r._seenOldStateManagementInteraction=!0}r.markOldStateManagementInteractionSeen=t,r._seenOldStateManagementInteraction=!1})(Gs||(Gs={}));var Yw=-1,jI=!1,an=class an{addProperty(e){return this.transition=e(this.transition!=null?this.transition:new Sr),this}dissolve(){return this.isDissolve=!0,this.transition=new Sr().transform(this.transition.from().transform1(),this.transition.to().transform1()),this}static buildStrategy(e,t){let n=new an;for(let r of an.propertyFunctions)if(r(e,t,n),n.isDissolve)return n;return n}static forDiscreteProperties(e,t,n){return n=an.nodeTypeToRenderSetMap.get(e.type())==an.nodeTypeToRenderSetMap.get(t.type())?n:n.dissolve(),n=e.blendMode()==t.blendMode()?n:n.dissolve(),n=e.clipsToBoundingRectangle()==t.clipsToBoundingRectangle()?n:n.dissolve(),n=e.isFixed()==t.isFixed()?n:n.dissolve(),n}static forSizes(e,t,n){let r=e.size(),o=t.size();if(n.addProperty(l=>l.transformOrigin(r.divide(2),o.divide(2))),n.transition.hasLegacyTransitioningSizesForImageRect()||n.transition.hasTransitioningGeometryForRoundedRectangles()||e.type()=="ROUNDED_RECTANGLE"&&t.type()=="ROUNDED_RECTANGLE")return n;let a=t.isResizeToFit()||un.isFrameLike(t.type())&&!t.clipsToBoundingRectangle();return(e.isResizeToFit()||un.isFrameLike(e.type())&&!e.clipsToBoundingRectangle())&&an._filterPaints3(e.fillPaintsToRender()).length==0&&a&&an._filterPaints3(t.fillPaintsToRender()).length==0||r.equals(o)?n:n.dissolve()}static forOpacity(e,t,n){return n.addProperty(r=>r.opacity(e,t))}static forRelativeTransforms(e,t,n){return n.addProperty(r=>r.transform(e,t))}static forFillPaints(e,t,n){let r=an._filterPaints2(e),o=an._filterPaints2(t);return an._maybeInterpolatePaints(r,o,n,a=>a.fillPaints1(r,o))}static forStrokePaints(e,t,n){let r=an._filterPaints2(e),o=an._filterPaints2(t);return an._maybeInterpolatePaints(r,o,n,a=>a.strokePaints1(r,o))}static _filterPaints1(e){return an._filterPaints2(e)}static _filterPaints2(e){return e.filter(t=>t.isEnabled())}static _filterPaints3(e){return an._filterPaints2(e)}static _maybeInterpolatePaints(e,t,n,r){return!n.transition.hasTransitioningGeometryForRoundedRectangles()&&rn.FrozenList_equals(e,t,(o,a)=>o.equals1(a))?n:rn.FrozenList_equals(e,t,(o,a)=>o.type()==a.type()&&o.blendMode()==a.blendMode())?n.addProperty(r):n.dissolve()}static forGeometryAndPaints(e,t,n){var c,p,u,h;let r=e.supportsGeometry(),o=t.supportsGeometry();if(!r&&!o)return n;if(r!=o)return n.dissolve();let a=(p=(c=e.fillGeometry())==null?void 0:c.regions)!=null?p:[],s=(h=(u=t.fillGeometry())==null?void 0:u.regions)!=null?h:[],l=(un.isFrameLike(e.type())&&e.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(e.type())!=-1)&&e.strokePaints().length==0&&a.length==1&&Pt.isRoundedRectSupported(e.roundedRectInfo()),d=(un.isFrameLike(t.type())&&t.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(t.type())!=-1)&&t.strokePaints().length==0&&s.length==1&&Pt.isRoundedRectSupported(t.roundedRectInfo());if(l&&d){if(a.length!=0&&s.length!=0){let f=e.fillGeometry().regions[0].bounds().size(),_=t.fillGeometry().regions[0].bounds().size(),m=uo.fromRoundedRect(e.roundedRectInfo()),A=uo.fromRoundedRect(t.roundedRectInfo());(!m.equals(A)||!f.equals(_))&&n.addProperty(y=>y.transitionGeometryForRoundedRectangles(f,m,_,A))}}else{let f=!1;if(e.isAxisAlignedRectFill()&&t.isAxisAlignedRectFill())for(let _ of[e.fillPaints(),t.fillPaints()]){for(let m=0,A=_.length;m<A;m=m+1)if(_[m].type()=="IMAGE"||_[m].type()=="VIDEO"){f=!0;break}if(f)break}if(f&&!e.fillOrTextGeometry().geometryEquals(t.fillOrTextGeometry())){let _=an._filterPaints1(e.fillRegionPaints()[0]),m=an._filterPaints1(t.fillRegionPaints()[0]);if(rn.FrozenList_equals(_,m,(A,y)=>A.type()==y.type()))return n.addProperty(A=>A.fillPaints1(_,m)),n.addProperty(A=>A.shouldDoLegacyImageRectSizeTransition(!0)),n}n=an._forGeometryStructure(e.fillOrTextGeometry(),t.fillOrTextGeometry(),n)}return n=an._forGeometryPaints(e.fillRegionPaints(),t.fillRegionPaints(),n,(f,_,m)=>an.forFillPaints(f,_,m)),n=an._forGeometryStructure(e.strokeGeometry(),t.strokeGeometry(),n),n=an._forGeometryPaints(e.strokeRegionPaints(),t.strokeRegionPaints(),n,(f,_,m)=>an.forStrokePaints(f,_,m)),n}static forEffects(e,t,n){let r=e.filter(a=>a.isVisibleForRendering()),o=t.filter(a=>a.isVisibleForRendering());return ce.List_equalsWithComparison(r,o,(a,s)=>a.equals(s))?n:n.dissolve()}static _forGeometryStructure(e,t,n){return e!=null&&t!=null?e.geometryEquals(t)?n:n.dissolve():e==null&&t==null?n:n.dissolve()}static _forGeometryPaints(e,t,n,r){if(e.length==t.length){for(let o=0,a=e.length;o<a;o=o+1)if(n=r(e[o],t[o],n),n.isDissolve)return n;return n}return n.dissolve()}constructor(){this.isDissolve=!1,this.transition=new Sr}};an.propertyFunctions=[(e,t,n)=>{an.forRelativeTransforms(e.relativeTransformAccountingForFixedOffset(),t.relativeTransformAccountingForFixedOffset(),n)},(e,t,n)=>{an.forGeometryAndPaints(e,t,n)},(e,t,n)=>{an.forSizes(e,t,n)},(e,t,n)=>{an.forDiscreteProperties(e,t,n)},(e,t,n)=>{an.forOpacity(e.opacity(),t.opacity(),n)},(e,t,n)=>{an.forEffects(e.effects(),t.effects(),n)}],an.nodeTypeToRenderSetMap=ce.List_reduce([["NONE","DOCUMENT","SLICE"].slice(),["CANVAS","GROUP","FRAME","SYMBOL","INSTANCE","CONNECTOR","STICKY","SHAPE_WITH_TEXT","CODE_BLOCK","MEDIA","SECTION_OVERLAY","TABLE","TABLE_CELL","SLIDE"].slice(),["ELLIPSE","LINE","RECTANGLE","REGULAR_POLYGON","ROUNDED_RECTANGLE","STAR","VECTOR","STAMP","WASHI_TAPE"].slice(),["BOOLEAN_OPERATION"].slice(),["TEXT"].slice()].slice(),(e,t,n)=>(t.forEach(r=>{e.set(r,n)}),e),new Map);var $l=an;var Go=class i{constructor(e,t,n,r){this._lastInputTForAbsoluteTransform=-1;this._oldSceneNode=e,this._oldCanvasToRenderTreeTransform=t,this._newSceneNode=n,this._newCanvasToRenderTreeTransform=r,this._children=[],this._enabledTraits=Yw,this._parent=null,this._transition=null,this._isDissolve=!1,this._scalesIndependentlyOfParent=!1,this._forceMask=!1,this._interpolateScalingToCachedAbsoluteTransform=new Map}get isDissolve(){return this._isDissolve}get scalesIndependentlyOfParent(){return this._scalesIndependentlyOfParent}get forceMask(){return this._forceMask}get enabledTraits(){return this._enabledTraits}get transition(){return this._transition}setTransition(e){this._transition=e}get parent(){return this._parent}get children(){return this._children}static debugStringRecursive(e,t,n,r){var s,l,d,c;t.result+=t.indent,n||(t.result+=r?"\u2514\u2500":"\u251C\u2500");let o=t.indent.length;n||(t.indent+=r?"  ":"\u2502 "),t.result+=`${(l=(s=e._oldSceneNode)==null?void 0:s.name())!=null?l:"null"} -> ${(c=(d=e._newSceneNode)==null?void 0:d.name())!=null?c:"null"}`,e.forceMask&&(t.result+=" (.MASK)");let a=e.transition;if(a!=null){t.result+=e.isDissolve?" (dissolve)":"",t.result+=a.hasTransitioningPaints()&&4&e.enabledTraits?" (paints)":"",t.result+=a.hasTransitioningGeometryForRoundedRectangles()&&16&e.enabledTraits?" (geometry)":"";let p=a.from(),u=a.to();if((p.opacity1()!=1||p.opacity1()!=u.opacity1())&&(t.result+=` (opacity: ${p.opacity1()} -> ${u.opacity1()})`),p.translation1().equals(u.translation1())||(t.result+=` (translation: ${p.translation1()} -> ${u.translation1()})`),!p.transform1().equals1(u.transform1())){let h=Jr.from(p.transform1()),f=Jr.from(u.transform1());h.translation.approximatelyEquals(f.translation,1e-6)||(t.result+=` (translation: ${h.translation} -> ${f.translation})`),h.scale.approximatelyEquals(f.scale,1e-6)||(t.result+=` (scale: ${h.scale} -> ${f.scale})`),h.angleDegrees!=f.angleDegrees&&(t.result+=` (angle: ${h.angleDegrees} deg -> ${f.angleDegrees} deg)`)}}t.result+=`
`;for(let p=0,u=e.children.length;p<u;p=p+1)this.debugStringRecursive(e.children[p],t,!1,p==e.children.length-1);e.isDissolve&&(this.debugStringRecursive(e.forDissolveStart1(),t,!1,!1),this.debugStringRecursive(e.forDissolveEnd1(),t,!1,!0)),t.indent=t.indent.slice(0,o)}static _generatePlanForMatchedNodes(e,t,n,r,o,a){let s=$l.buildStrategy(e,n);if(s.transition.hasLegacyTransitioningSizesForImageRect()){let p=s.transition;p.scaling(new E(1,1),n.size().divide1(e.size()));let u=new i(e,t,n,r);return u._isDissolve=!1,u._transition=p,u}let l=this.getMagicMovePlan1(e,t,n,r,o,null,e.isFixed()?Rn.DISSOLVE:a);return t.clone().multiply(e.absoluteTransform()),r.clone().multiply(n.absoluteTransform()),l._isDissolve=s.isDissolve,l._transition=s.transition,l}static _generatePlanForRemovedNode(e,t,n){let r=new i(e,t,null,null);if(n!=null&&n.isDissolve()){let o=new Sr().opacity(e.opacity(),0);o.transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset()),r._transition=o}else{let o=new Sr().transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset());n!=null?(o.translation(n.exitingFrameTransition().from().translation1(),n.exitingFrameTransition().to().translation1()),o.opacity(e.opacity()*n.exitingFrameTransition().from().opacity1(),e.opacity()*n.exitingFrameTransition().to().opacity1())):o.opacity(e.opacity(),e.opacity()),r._transition=o}return e.forEachChild(o=>{r._appendChild(this._generatePlanForRemovedNode(o,t,null))}),r}static _generatePlanForInsertedNode(e,t,n){let r=new i(null,null,e,t);if(n!=null&&n.isDissolve()){let o=new Sr().opacity(0,e.opacity());o.transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset()),r._transition=o}else{let o=new Sr().transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset());n!=null?(o.translation(n.enteringFrameTransition().from().translation1(),n.enteringFrameTransition().to().translation1()),o.opacity(e.opacity()*n.enteringFrameTransition().from().opacity1(),e.opacity()*n.enteringFrameTransition().to().opacity1())):o.opacity(e.opacity(),e.opacity()),r._transition=o}return e.forEachChild(o=>{r._appendChild(this._generatePlanForInsertedNode(o,t,null))}),r}static _matchKey(e){return e.name()}static _getNodeMatches(e,t,n,r){if(!r&&(e.type()=="BOOLEAN_OPERATION"||t.type()=="BOOLEAN_OPERATION"))return;let o=new Map;t.forEachChild(a=>{if(!a.visible())return;let s=this._matchKey(a),l=null;o.has(s)?l=o.get(s):(l=[],o.set(s,l)),l.push(a)}),e.forEachChild(a=>{if(!a.visible())return;let s=this._matchKey(a),l=Le.StringMap_get(o,s,null);if(l==null||l.length==0)return;let d=l.shift();n.set(a.id(),d),n.set(d.id(),a),this._getNodeMatches(a,d,n,r)})}static getNodeMatches(e,t){let n=new Map;return this._getNodeMatches(e,t,n,!1),n}static getMagicMovePlan1(e,t,n,r,o,a,s){a==null&&(a=new Sr);let l=e.isTopLevel()&&n.isTopLevel(),d=new i(e,t,n,r);if(e.type()=="BOOLEAN_OPERATION"||n.type()=="BOOLEAN_OPERATION")return d;for(let p=0;p<n.childCount();p=p+1){let u=n.childAt2(p,!0),h=Le.StringMap_get(o,u.id(),null);h==null?d._appendChild(this._generatePlanForInsertedNode(u,r,s)):d._appendChild(this._generatePlanForMatchedNodes(h,t,u,r,o,s))}let c=0;for(;c<e.childCount();){let p=[],u=c,h=c;for(;c<e.childCount();){let S=e.childAt2(c,!0);if(o.has(S.id()))break;p.push(this._generatePlanForRemovedNode(S,t,s)),h=c,c=c+1}if(p.length==0){c=c+1;continue}let f=-1,_=d.children.length;if(u-1>=0){let S=e.childAt2(u-1,!0);if(S!=null){let g=Le.StringMap_get(o,S.id(),null);g!=null&&(f=d.indexOfSceneNodeInChildren(g))}}if(h+1<e.childCount()){let S=e.childAt2(h+1,!0);if(S!=null){let g=Le.StringMap_get(o,S.id(),null);g!=null&&(_=d.indexOfSceneNodeInChildren(g))}}let m=Math.min(f,_),A=Math.max(f,_),y=s.drawsEnteringFrameOnTopOfExitingFrame()?m+1:A;d.insertChildren(y,p)}if(l){d._enabledTraits&=-5,d._enabledTraits&=-9,d._enabledTraits&=-65,d._enabledTraits&=-3,d._enabledTraits&=-33,d._enabledTraits&=-129;let p=e.clipsToBoundingRectangle()&&e.containerSupportsFillStrokeAndCorners()||n.clipsToBoundingRectangle()&&n.containerSupportsFillStrokeAndCorners(),u=new i(e,t,n,r);u._enabledTraits=156,p&&(u._enabledTraits&=-9),u._isDissolve=!0,u._transition=new Sr;let h=p;if(e.fillGeometry()!=null&&n.fillGeometry()!=null&&(h=h&&!e.fillGeometry().geometryEquals(n.fillGeometry())),h){let m=d,A=new i(e,t,n,r);A._enabledTraits=20,A._transition=new Sr,A._forceMask=!0,A._isDissolve=!0,d=new i(e,t,n,r),d._enabledTraits=0,d._isDissolve=!1,d._transition=new Sr,d._appendChild(A),d._appendChild(m)}else d._enabledTraits|=130;let f=[u,d];if(p){let m=new i(e,t,n,r);m._enabledTraits=24,m._isDissolve=!0,m._transition=new Sr,f.push(m)}a.opacity(e.opacity(),n.opacity());let _=new i(e,t,n,r);return _._enabledTraits=224,_.insertChildren(0,f),_._transition=a,_}else return d}static getMagicMovePlanForStateSwapTransition(e,t){var s,l;let n=this.getNodeMatches(e,t),r=(l=(s=t.parent())==null?void 0:s.absoluteTransform())!=null?l:Nt.FrozenAffineTransform_IDENTITY,o=this._generatePlanForMatchedNodes(e,Nt.FrozenAffineTransform_IDENTITY,t,Nt.FrozenAffineTransform_IDENTITY,n,Rn.DISSOLVE),a=o.transition;return o._transition=a.clone().transform(r.clone().multipliedBy1(a.from().transform1()),r.clone().multipliedBy1(a.to().transform1())),jI&&(console.log("------------------------------"),console.log("getMagicMovePlanForStateSwapTransition between interactive component states"),console.log(o.debugString()),console.log("------------------------------")),o}static getMagicMovePlan2(e,t,n,r,o){let a=this.getNodeMatches(e,n),s=new Sr().transform(t.clone().multipliedBy1(e.absoluteTransform()),r.clone().multipliedBy1(n.absoluteTransform()));return this.getMagicMovePlan1(e,t,n,r,a,s,o)}static renderTreeForMagicMove(e,t,n,r,o){let a=oe.new2().copyFrom(e.absoluteTransform());a.invert();let s=oe.new2();s.leftMultiply(a),s.leftMultiply(t.absoluteTransform());let l=Nt.FrozenAffineTransform_IDENTITY,d=e.size().max2(t.size()),c=this.getMagicMovePlan2(e,s,t,l,o.withScaledTranslation(d)),p=!0,u=()=>p?0:n(),h=new Xi(c,null,u,r),f=Ce.renderTreeWithPerfLogging1(h,"renderTreeForMagicMove");return jI&&(console.log("------------------------------"),console.log(`renderTreeForMagicMove between top-level frames ${e.id()} -> ${t.id()}`),console.log(c.debugString()),console.log(f.debugString1()),console.log("------------------------------")),p=!1,f}forDissolveStart1(){return this.forDissolveStart2(null)}forDissolveStart2(e){let t=new i(this._oldSceneNode,this._oldCanvasToRenderTreeTransform,null,null);t._enabledTraits=this._enabledTraits,t._forceMask=this._forceMask;let n=this._transition.clone().opacity(this._oldSceneNode.opacity(),this._oldSceneNode.opacity());return this._oldSceneNode!=null&&this._newSceneNode!=null&&(this._oldSceneNode.type()=="TEXT"||this._newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this._oldSceneNode,this._newSceneNode,r=>{n.scaling(ve.FrozenVector_ONE,new E(r,r))},n.to().transform1(),r=>{n.transform(n.from().transform1(),r)}):n.hasTransitioningGeometryForRoundedRectangles()||n.scaling(ve.FrozenVector_ONE,Sh(this._newSceneNode).divide1(Sh(this._oldSceneNode))),n.transformOrigin(this._oldSceneNode.size().divide(2),this._newSceneNode.size().divide(2))),t._isDissolve=!1,t._transition=n,e!=null&&(n.from().scaling1().divide1(n.to().scaling1()).equals(e.from().scaling1().divide1(e.to().scaling1()))||(t._scalesIndependentlyOfParent=!0)),this.children.forEach(r=>{r._oldSceneNode!=null&&t._appendChild(r.forDissolveStart2(n))}),t}forDissolveEnd1(){return this.forDissolveEnd2(null)}forDissolveEnd2(e){let t=new i(null,null,this._newSceneNode,this._newCanvasToRenderTreeTransform);t._enabledTraits=this._enabledTraits,t._forceMask=this._forceMask;let n=this._transition.clone().opacity(this._newSceneNode.opacity(),this._newSceneNode.opacity());return this._oldSceneNode!=null&&this._newSceneNode!=null&&(this._oldSceneNode.type()=="TEXT"||this._newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this._newSceneNode,this._oldSceneNode,r=>{n.scaling(new E(r,r),ve.FrozenVector_ONE)},n.from().transform1(),r=>{n.transform(r,n.to().transform1())}):n.hasTransitioningGeometryForRoundedRectangles()||n.scaling(Sh(this._oldSceneNode).divide1(Sh(this._newSceneNode)),ve.FrozenVector_ONE),n.transformOrigin(this._oldSceneNode.size().divide(2),this._newSceneNode.size().divide(2))),t._isDissolve=!1,t._transition=n,e!=null&&(n.from().scaling1().divide1(n.to().scaling1()).equals(e.from().scaling1().divide1(e.to().scaling1()))||(t._scalesIndependentlyOfParent=!0)),this.children.forEach(r=>{r._newSceneNode!=null&&t._appendChild(r.forDissolveEnd2(n))}),t}_maybeUpdateDissolveTransitionsForText(e,t,n,r,o){if(t.type()!="TEXT"||e.type()!="TEXT")return;let a=t.textGeometry(),s=e.textGeometry(),l=1;!t.textHasMixedFontSizes()&&!e.textHasMixedFontSizes()&&t.fontSize()>0&&e.fontSize()>0&&(l=t.fontSize()/e.fontSize(),n(l));let d=E.new2(),c=U.new4(t.relativeTransform().translation(),t.size()),p=U.new4(e.relativeTransform().translation(),e.size()),u=null,h=null,f=U.new2();switch(t.textAlignHorizontal()==e.textAlignHorizontal()?(u=a.bounds,h=s.bounds):(u=c,h=p),f.copyFrom(h).scaledBy1(l),e.textAlignHorizontal()){case"RIGHT":{d.setX(u.right()-h.right()-(f.right()-h.right()));break}case"CENTER":case"JUSTIFIED":{d.setX(u.center().x()-h.center().x()-(f.center().x()-h.center().x()));break}}switch(t.textAlignVertical()==e.textAlignVertical()?(u=a.bounds,h=s.bounds):(u=c,h=p),f.copyFrom(h).scaledBy1(l),e.textAlignVertical()){case"BOTTOM":{d.setY(u.bottom()-h.bottom()-(f.bottom()-h.bottom()));break}case"CENTER":{d.setY(u.center().y()-h.center().y()-(f.center().y()-h.center().y()));break}}if(!d.equals(E.new2())){let _=oe.new3(r);_.translate1(d),o(_)}}sceneNode(){var e;return(e=this._oldSceneNode)!=null?e:this._newSceneNode}isEverVisible(){return this._isSceneNodeEverVisible(this._oldSceneNode)||this._isSceneNodeEverVisible(this._newSceneNode)}_isSceneNodeEverVisible(e){return e!=null&&e.visible()&&e.opacity()>0}absoluteTransform1(e){return X.smartAnimateCacheTransform()?this.absoluteTransform2WithCaching(e,1):this.absoluteTransform2(e,1)}invalidateCachedAbsoluteTransformsForSelf(){X.smartAnimateCacheTransform()&&(this._lastInputTForAbsoluteTransform=-1,this._interpolateScalingToCachedAbsoluteTransform[0]=null,this._interpolateScalingToCachedAbsoluteTransform[1]=null)}absoluteTransform2WithCaching(e,t){return e!=this._lastInputTForAbsoluteTransform&&(this._lastInputTForAbsoluteTransform=e,this._interpolateScalingToCachedAbsoluteTransform[0]=null,this._interpolateScalingToCachedAbsoluteTransform[1]=null),this._interpolateScalingToCachedAbsoluteTransform[t]||(this._interpolateScalingToCachedAbsoluteTransform[t]=this.absoluteTransform2(e,t)),this._interpolateScalingToCachedAbsoluteTransform[t]}absoluteTransform2(e,t){let n=oe.new2();if(this._transition!=null){let r=this._transition.interpolateTranslation(e);n.translate1(r)}if(this._parent!=null&&n.multiply(this._parent.absoluteTransform2(e,0)),this._transition!=null){let r=this._transition.interpolateTransform(e);if(n.multiply(r),t){let o=this._transition.interpolateScaling(e);n.scale3(o)}}return n}rotatesOrScales1(){return this.rotatesOrScales2(!0)}rotatesOrScales2(e){let t=this._transition!=null;return e?t=t&&!this._transition.from().equalTransformsUpToTranslation(this._transition.to(),1e-10):t=t&&!this._transition.from().equalTransformsUpToTranslationAndScaling(this._transition.to(),1e-10),this._parent!=null&&(t=t||this._parent.rotatesOrScales2(!1)),t}_appendChild(e){e._parent=this,this._children.push(e)}insertChildren(e,t){for(let n of t)n._parent=this;ce.List_insert1(this._children,e,t)}removeChild(e){this._children.splice(e,1)}debugString(){let e=new Qf;return i.debugStringRecursive(this,e,!0,!0),e.result}indexOfSceneNodeInChildren(e){for(let t=0;t<this.children.length;t=t+1){let n=this.children[t];if(n._oldSceneNode==e||n._newSceneNode==e)return t}return-1}indexInParent(){return this._parent!=null?this._parent.children.indexOf(this):-1}},Qf=class{constructor(){this.result="",this.indent=""}},Xi=class i{constructor(){if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._planNode=null,this._node=null,this._sceneNodeCursor=null,this._getEasedT=null,this._easingFunction=null,this.initialize(e,t,n,r)}else if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this._planNode=null,this._node=null,this._sceneNodeCursor=null,this._getEasedT=null,this._easingFunction=null,this.initialize(e,null,t,n)}}initialize(e,t,n,r){this._planNode=e,this._node=t,this._getEasedT=n,this._easingFunction=r,this._updateSceneNodeCursorForCurrentPlanNode()}clone(){return new i(this._planNode,this._node,this._getEasedT,this._easingFunction)}_updateSceneNodeCursorForCurrentPlanNode(){let e=this._planNode.sceneNode();if(e==null){this._sceneNodeCursor=null;return}this._sceneNodeCursor==null?this._sceneNodeCursor=new nn(e):this._sceneNodeCursor.setNode(e)}moveToChildAt(e){this._planNode=this._planNode.children[e],this._node=this._node!=null&&e<this._node.childCount()?this._node.childAt2(e,!0):null,this._updateSceneNodeCursorForCurrentPlanNode()}moveToParent(){this._planNode=this._planNode.parent,this._node=this._node!=null?this._node.parent():null,this._updateSceneNodeCursorForCurrentPlanNode()}isRoot(){return this._planNode.parent==null}hasTransitioningPaints(){return this._planNode.transition.hasTransitioningPaints()}indexInParent(){return this._planNode.indexInParent()}renderableContentType(){return this.hasCustomRenderTree()?In.RenderableContentType.CUSTOM_RENDER_TREE:16&this._planNode.enabledTraits?this._sceneNodeCursor!=null?this._sceneNodeCursor.renderableContentType():In.RenderableContentType.NON_RENDERABLE:In.RenderableContentType.RENDERABLE_GROUP}isFrameLike(){return this._planNode.isDissolve?!1:un.isFrameLike(this.type())}isTopLevel(){return!1}paintsDebugString(){return`AnimationPlanNode [from=${this._planNode._oldSceneNode.paintsDebugString()}] [to=${this._planNode._newSceneNode.paintsDebugString()}]`}willChange(){if(this._planNode.transition==null||!this._planNode.isEverVisible())return 0;let e=0;return this._planNode.transition.from().opacity1()!=this._planNode.transition.to().opacity1()&&(e|=2),(this._planNode.transition.hasTransitioningTranslation()||this._planNode.transition.hasTransitioningTransform()||this._planNode.transition.hasTransitioningScaling()||this._planNode.transition.hasTransitioningTransformOrigin())&&(e|=1),this._planNode.scalesIndependentlyOfParent&&(e|=1),e}size(){return this._planNode.sceneNode().size()}shouldOptimizeShadowForAnimation(e){return e==null||e.equals(ve.FrozenVector_ZERO)?!1:this._planNode.rotatesOrScales1()}hasCustomRenderTree(){return this._planNode.isDissolve}customRenderTree(e){var t,n,r,o;if(this._planNode.isDissolve){let a=this._planNode.indexInParent(),s=this._planNode.forDissolveStart1();(t=this._planNode.parent)==null||t.insertChildren(a,[s]);let l=Ce.generateRenderTree(new i(s,this._getEasedT,this._easingFunction),e);(n=this._planNode.parent)==null||n.removeChild(a);let d=null;if(this._node!=null&&this._node.hasBackgroundBlurs())d=Ce.generateRenderTree(new nn(this._node),e);else{let u=this._planNode.forDissolveEnd1();(r=this._planNode.parent)==null||r.insertChildren(a,[u]),d=Ce.generateRenderTree(new i(u,this._getEasedT,this._easingFunction),e),(o=this._planNode.parent)==null||o.removeChild(a)}let c=new Ar(l,d,Et.forAnimateableDissolve(this._planNode.sceneNode().id()),this._getEasedT),p=this._planNode.transition.clone().transform(oe.new2(),oe.new2());return this._planNode.setTransition(p),this._planNode.invalidateCachedAbsoluteTransformsForSelf(),c}throw new Error("Unhandled customRenderTree case")}opacity(){return 32&this._planNode.enabledTraits?this._planNode.transition!=null?this._planNode.transition.interpolateOpacity(this._getEasedT()):this._sceneNodeCursor.opacity():1}absoluteTransform(){return Un.didEncounterSmartAnimateCacheTransform(),this._planNode.absoluteTransform1(this._getEasedT())}maxTransformScale(){let e=this._planNode.transition;if(e==null)return 1;let t=e.from().scaling1(),r=e.to().scaling1().divide1(t).min1();return Math.max(r,1)}scene(){return this._sceneNodeCursor.scene()}parent(){if(this._planNode.parent==null)return null;let e=this._node!=null?this._node.parent():null;return new i(this._planNode.parent,e,this._getEasedT,this._easingFunction)}blendMode(){return 32&this._planNode.enabledTraits?this._sceneNodeCursor.blendMode():"PASS_THROUGH"}visible(){return this._sceneNodeCursor.visible()}isVisibleMask(){return this._planNode.forceMask?!0:128&this._planNode.enabledTraits?this._sceneNodeCursor.isVisibleMask():!1}maskType(){return this._sceneNodeCursor.maskType()}isSpreadEligibleNode(){return this._sceneNodeCursor.isSpreadEligibleNode()}type(){return this._sceneNodeCursor.type()}childCount(){return this._planNode.children.length}clipsChildren(){return 2&this._planNode.enabledTraits?this._sceneNodeCursor.clipsChildren():!1}stopsMaskPropagation(){return this._planNode.forceMask?!0:128&this._planNode.enabledTraits?this._sceneNodeCursor.stopsMaskPropagation():!1}strokeAlign(){return this._sceneNodeCursor.strokeAlign()}strokeWeight(){return this._sceneNodeCursor.strokeWeight()}uniqueIdentifier(){return this._sceneNodeCursor.id()}isInsideOutlineMask(){return this._sceneNodeCursor.isInsideOutlineMask()}textData(){return this._sceneNodeCursor.textData()}derivedTextData(){return this._sceneNodeCursor.derivedTextData()}arcData(){return this._sceneNodeCursor.arcData()}roundedRectInfo(){return this._sceneNodeCursor.roundedRectInfo()}fillGeometry(){if(16&this._planNode.enabledTraits){if(this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles())return this._planNode.transition.fillGeometryForRoundedRectangles(this._getEasedT,this._easingFunction.bounds)}else return null;return this._sceneNodeCursor.fillGeometry()}strokeGeometry(){return 16&this._planNode.enabledTraits?this._sceneNodeCursor.strokeGeometry():null}fillGeometryForSpread(e,t,n){return 16&this._planNode.enabledTraits&&this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles()?this._planNode.transition.fillGeometryForSpreadDynamic(e,t,this._getEasedT,n,this.uniqueIdentifier(),this._easingFunction.bounds):this._sceneNodeCursor.fillGeometryForSpread(e,t,n)}strokeGeometryForSpread(e,t,n,r){return this._sceneNodeCursor.strokeGeometryForSpread(e,t,n,r)}textGeometry(){return 16&this._planNode.enabledTraits?this._sceneNodeCursor.textGeometry():null}getCachedRenderTree(){return null}renderTree(){let e=new Ce.GenerateArgs(Ce.RenderMode.NORMAL);return Ce.generateRenderTree(this.clone(),e)}renderTreeWithoutBackgroundBlurs(){let e=new Ce.GenerateArgs(Ce.RenderMode.WITHOUT_BACKGROUND_BLURS);return Ce.generateRenderTree(this.clone(),e)}renderTreeForShadowRoot(){let e=new Ce.GenerateArgs(Ce.RenderMode.SHADOW,this.uniqueIdentifier());return Ce.generateRenderTree(this.clone(),e)}renderTreeForShadowDescendant(){let e=new Ce.GenerateArgs(Ce.RenderMode.SHADOW);return Ce.generateRenderTree(this.clone(),e)}renderTreeForKnockoutShadowRoot(){let e=new Ce.GenerateArgs(Ce.RenderMode.KNOCKOUT_SHADOW,this.uniqueIdentifier());return Ce.generateRenderTree(this.clone(),e)}renderTreeForKnockoutShadowDescendant(){let e=new Ce.GenerateArgs(Ce.RenderMode.KNOCKOUT_SHADOW);return Ce.generateRenderTree(this.clone(),e)}isFixed(){return this._sceneNodeCursor.isFixed()}isStandardScrolling(){return this._sceneNodeCursor.isStandardScrolling()}isStickyScrolling(){return this._sceneNodeCursor.isStickyScrolling()}scrollOffset(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.scrollOffset():ve.FrozenVector_ZERO}scrollDirection(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.scrollDirection():"NONE"}hasOverflowingContentInScrollDirection(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.hasOverflowingContentInScrollDirection():!1}effects(){return this._planNode.isDissolve||!(64&this._planNode.enabledTraits)?[]:this._sceneNodeCursor.effects()}fillPaints(){var t,n;if(!(4&this._planNode.enabledTraits))return Oe.EMPTY;if(this._planNode.forceMask)return[se.createSolid(C.BLACK,1)];let e=(n=(t=this._planNode.transition)==null?void 0:t.fillPaints2(this._getEasedT))!=null?n:[];return e.length==0?this._sceneNodeCursor.fillPaints():e}strokePaints(){var t,n;if(!(8&this._planNode.enabledTraits))return Oe.EMPTY;let e=(n=(t=this._planNode.transition)==null?void 0:t.strokePaints2(this._getEasedT))!=null?n:[];return e.length==0?this._sceneNodeCursor.strokePaints():e}fillPaintsToRender(){return 4&this._planNode.enabledTraits?this._sceneNodeCursor.fillPaintsToRender():Oe.EMPTY}videoPlayback(){return this._sceneNodeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._sceneNodeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._sceneNodeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._sceneNodeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._sceneNodeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this._sceneNodeCursor.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this._sceneNodeCursor.node.overrideKey()}name(){return this._sceneNodeCursor.node.name()}getSemanticNodePath(){return this._sceneNodeCursor.getSemanticNodePath()}hasBackgroundBlurs(){return this._sceneNodeCursor.hasBackgroundBlurs()}overlayRenderData(){return this._sceneNodeCursor.overlayRenderData()}};function Sh(i){if(i.fillGeometry()!=null&&i.fillGeometry().regions.length!=0)return i.size();let e=i.size().x()<=.1,t=i.size().y()<=.1;if(e==t)return i.size();let n=Math.max(i.strokeWeight(),.1),r=E.new3(i.size());return e?r.setX(n):r.setY(n),r}var qr=class i{willStartTransitionWithDuration(e){this._durationSeconds=e,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=Qe.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0,this._progressAtStart=0,this._lastProgress=0}transitionEnded(){this._lastProgress=-1,this._progressType=i.ProgressType.FORWARD,this._externalOnTickProgress=null;let e=this._externalOnTransitionEnded;return this._externalOnTransitionEnded=null,e!=null?e():i.TransitionEndedAction.COMMIT}isTransitionInProgress(){return this.isProgressControlledExternally()?!0:this._progressType==i.ProgressType.REVERSE?0<this._lastProgress&&this._lastProgress<=1:0<=this._lastProgress&&this._lastProgress<1}duration(){return this._durationSeconds}progress(){return this._lastProgress}isProgressControlledExternally(){return this._progressType==i.ProgressType.EXTERNAL}pinProgressToRealTimeWithDuration(e,t,n){this._progressAtStart=e,this._durationSeconds=t,this._progressType=n?i.ProgressType.REVERSE:i.ProgressType.FORWARD,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=Qe.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0}pinProgressToExternalControl(e,t){this._externalOnTickProgress=e,this._externalOnTransitionEnded=t,this._progressType=i.ProgressType.EXTERNAL,this._timeOfTransitionStart=Qe.seconds(),this.frameTimesMs.length=0}advanceToNextFrame(){if(this.isProgressControlledExternally())this._lastProgress=this._externalOnTickProgress();else if(this._durationSeconds>0){let e=Qe.seconds(),t=e-this._timeOfLastTransitionFrame;this.frameTimesMs.push(1e3*t),t=Math.min(t,1/30),this._elapsedSeconds+=t,this._timeOfLastTransitionFrame=e;let n=this._progressType==i.ProgressType.REVERSE?-1:1;this._lastProgress=fn.Math_clamp1(n*this._elapsedSeconds/this._durationSeconds+this._progressAtStart,0,1)}else this._lastProgress=this._progressType==i.ProgressType.REVERSE?0:1}constructor(){this._lastProgress=-1,this._durationSeconds=-1,this._elapsedSeconds=-1,this._timeOfLastTransitionFrame=-1,this._progressAtStart=0,this._timeOfTransitionStart=-1,this.frameTimesMs=[],this._progressType=i.ProgressType.FORWARD,this._externalOnTickProgress=null,this._externalOnTransitionEnded=null}};(r=>{let i;(l=>(l[l.FORWARD=0]="FORWARD",l[l.REVERSE=1]="REVERSE",l[l.EXTERNAL=2]="EXTERNAL"))(i=r.ProgressType||(r.ProgressType={}));let e;(s=>(s[s.ABORT=0]="ABORT",s[s.COMMIT=1]="COMMIT"))(e=r.TransitionEndedAction||(r.TransitionEndedAction={}));let t;(a=>{function o(s){return r.ProgressType[s]}a.ProgressType_toString=o})(t=r.in_ProgressType||(r.in_ProgressType={}));let n;(a=>{function o(s){return r.TransitionEndedAction[s]}a.TransitionEndedAction_toString=o})(n=r.in_TransitionEndedAction||(r.in_TransitionEndedAction={}))})(qr||(qr={}));var Hs;(t=>{function i(n,r){n(r)}t.applyTo=i;function e(n){return n}t._new=e})(Hs||(Hs={}));var yh=class{constructor(e){this._dragToAnimateBehavior=null,this._canvasView=null,this._canvasView=e}clearDrag(e){this._dragToAnimateBehavior==e&&(this._canvasView.removeInteractionObserver(this._dragToAnimateBehavior),this._dragToAnimateBehavior=null)}removeFrom(e){this.clearDrag(this._dragToAnimateBehavior)}getTransitionMixin(e,t,n){let r=t.interactionAddress.hotspotStablePath!=null?e.findNode3(t.interactionAddress.hotspotStablePath):null;if(r==null)return null;switch(t.cause){case 5:{if(!n&&Kt.TransitionAction_getControlSource(t.cause)!=0){let o=_n.computeDragVector2(t,r,e);if(o!=null&&o.length()>0)return Hs._new(a=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new _n(this,o,a,t.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}getTransitionMixinForStateSwap(e,t,n){switch(t.cause){case 5:{if(!n&&Kt.TransitionAction_getControlSource(t.cause)!=0){let r=_n.computeDragVectorForStateSwap(t,e);if(r!=null&&r.length()>0)return Hs._new(o=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new _n(this,r,o,t.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}},ji=class ji{static computeOverlaySwipeDragVector(e,t,n){let r=n.size(),o=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return r.multiply1(o.to().translation1().subtract1(o.from().translation1()))}static computeScreenSwipeDragVector(e,t,n){let r=t.size().max2(n.size()),o=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return r.multiply1(o.to().translation1().subtract1(o.from().translation1()))}static computeSmartAnimateDragVector(e,t,n){if(t!=null&&n!=null&&e!=null){let r=Go.getNodeMatches(t,n),o=Le.StringMap_get(r,e.id(),null);if(o!=null){let a=t.absoluteTransform().inverse().multipliedBy1(e.absoluteTransform()).transformPoint(e.size().divide(2));return n.absoluteTransform().inverse().multipliedBy1(o.absoluteTransform()).transformPoint(o.size().divide(2)).subtract1(a)}}return null}static computeDragVectorImpl(e,t,n,r,o,a,s){if(e==null)return null;if(t!=null&&n!=null){if(o=="SMART_ANIMATE"||kn.supportsSmartAnimate(o)&&s){let c=ji.computeSmartAnimateDragVector(e,t,n);if(c!=null&&c.length()>0)return c}if(["DISSOLVE","INSTANT_TRANSITION","SMART_ANIMATE"].indexOf(o)==-1){let c=Rn.get(o);r==1&&(c=c.reversed());let p=null;if(["OVERLAY","SWAP"].indexOf(a)!=-1?p=ji.computeOverlaySwipeDragVector(c,t,n):p=ji.computeScreenSwipeDragVector(c,t,n),p.length()>0)return p}}return null}static computeDragVector1(e,t,n,r,o){if(e==null||t==null)return null;let a=null;for(let f of t.allActions())if(["INTERNAL_NODE","BACK","CLOSE"].indexOf(f.connectionType())!=-1){a=f;break}if(a==null)return null;let s=a.connectionType(),l=null,d=null,c=a.transitionShouldSmartAnimate(),p=0,u=n,h=null;if(s=="INTERNAL_NODE")if(d=a.navigationType(),l=a.transitionType(),d=="SWAP_STATE"){let f=jt.whichInstanceToSwap(e,a.transitionNodeID());f!=null&&(u=f,h=e.scene().findNode1(a.transitionNodeID()))}else d=="SWAP"&&(u=e.topLevelAncestor()),h=r.getDestinationFrame(a.transitionNodeID());else if(s=="BACK"){let f=o.getPreviousNonTransientChange();if(f==null)return null;h=r.getDestinationFrame(f.oldStateId()),l=f.transitionParameters.transitionType,d="NAVIGATE",p=1}else if(s=="CLOSE"){h=e.topLevelAncestor();let f=o.getOpenOverlayData(h.id());if(f==null)return null;l=f.openingTransitionType(),d="OVERLAY",p=1}return ji.computeDragVectorImpl(e,u,h,p,l,d,c)}static computeDragVector2(e,t,n){let r=null,o=null;if(e.oldStateId()==e.newStateId()&&e.oldOverlayData().length>0&&e.oldOverlayData().length==e.newOverlayData().length){let s=e.oldOverlayData()[e.oldOverlayData().length-1],l=e.newOverlayData()[e.newOverlayData().length-1];r=n.findNode1(s.id),o=n.findNode1(l.id)}else if(r=n.findNode1(e.oldStateId()),e.transitionParameters.navigationType=="OVERLAY"){let s=e.direction==1?e.getRemovedFrameIds():e.getInsertedFrameIds();o=n.findNode1(s[0])}else o=n.findNode1(e.newStateId());return ji.computeDragVectorImpl(t,r,o,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}static computeDragVectorForStateSwap(e,t){var a,s;let n=t.findNode3(e.stablePath),r=(a=n==null?void 0:n.transitioningFrom)==null?void 0:a.exitingTransitionRoot,o=(s=n==null?void 0:n.transitioningFrom)==null?void 0:s.hotspotInExitingTree;return ji.computeDragVectorImpl(o,r,n,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}constructor(e,t,n,r){var o;this._dragStartPosition=null,this._currPointerPosition=null,this._lastPointerPosition=null,this._currPointerTime=-1,this._lastPointerTime=-1,this._didRecordPointerPosition=!1,this._pointerVelocity=null,this._shouldRevertTransition=!1,this._behaviorManager=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._lastPointerTime=Qe.seconds(),this._behaviorManager=e,this._dragVector=t,this._easingFunction=r,this._transitionProgress=n,(o=this._transitionProgress)==null||o.pinProgressToExternalControl(()=>this.onTickProgress(),()=>this.onTransitionEnded())}handleDrag(e){this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,this._currPointerTime=Qe.seconds(),this._currPointerPosition=e,this._didRecordPointerPosition=!0}handleDragStart(e){this._dragStartPosition=e}handleRelease(e){if(this._transitionProgress!=null&&this._transitionProgress.isProgressControlledExternally()){let t=this._transitionProgress.progress(),n=this._easingFunction!=null?this._easingFunction.invert(t):t,r=this.signedDragSpeed(),o=this._transitionProgress.duration(),a=o>0?ji.DRAG_SPEED_THRESHOLD_MULTIPLE/o:0,s=r>=a,l=r<=-a;this._shouldRevertTransition=!1,t>=.5?this._shouldRevertTransition=l:this._shouldRevertTransition=!s;let d=1;if(this._shouldRevertTransition&&(d=fn.Math_clamp1(Math.log(n+.5)/Math.log(2)+1,.02,1)),Math.abs(r)>=1/o){let c=this._easingFunction!=null?this._easingFunction.getDerivative(n,r):1;d=Math.abs(r/c)}this._transitionProgress.pinProgressToRealTimeWithDuration(n,o/d,this._shouldRevertTransition)}}onTickProgress(){if(this._dragVector!=null){if(this._currPointerPosition!=null&&this._dragStartPosition!=null){if(this._lastPointerPosition!=null&&this._lastPointerTime!=-1){let n=this._currPointerTime;this._didRecordPointerPosition||(this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,n=Qe.seconds(),this._currPointerTime=n),this._pointerVelocity=this._currPointerPosition.subtract1(this._lastPointerPosition).divide(n-this._lastPointerTime)}let e=this._currPointerPosition.subtract1(this._dragStartPosition),t=fn.Math_clamp1(e.dot(this._dragVector)/Math.pow(this._dragVector.length(),2),0,1);return this._didRecordPointerPosition=!1,t}return this._didRecordPointerPosition=!1,0}return this._didRecordPointerPosition=!1,1}onTransitionEnded(){return this._dragStartPosition=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._behaviorManager!=null&&this._behaviorManager.clearDrag(this),this._shouldRevertTransition?qr.TransitionEndedAction.ABORT:qr.TransitionEndedAction.COMMIT}signedDragSpeed(){return this._pointerVelocity==null||this._dragVector==null?0:this._dragVector.length()>0?this._pointerVelocity.dot(this._dragVector)/Math.pow(this._dragVector.length(),2):0}};ji.DRAG_SPEED_THRESHOLD_MULTIPLE=.15;var _n=ji;var Th=class{check(e){(!this._lastOffset.equals(e.offset())||this._lastZoomScale!=e.zoomScale())&&(this._lastOffset=e.offset(),this._lastZoomScale=e.zoomScale(),this.onChange!=null&&this.onChange(this._lastOffset,this._lastZoomScale))}resetStateForTests(){this._lastOffset=ve.FrozenVector_ZERO,this._lastZoomScale=0}constructor(){this._lastOffset=ve.FrozenVector_ZERO,this._lastZoomScale=0,this.onChange=null}};var Vd=(t=>(t[t.DID_WORK=0]="DID_WORK",t[t.IDLE=1]="IDLE",t))(Vd||{}),Ch=(t=>(t[t.SHORTCUT=0]="SHORTCUT",t[t.SCROLL=1]="SCROLL",t))(Ch||{}),bh=(t=>(t[t.AUTOMATIC=0]="AUTOMATIC",t[t.USER_INITIATED=1]="USER_INITIATED",t))(bh||{}),En=(T=>(T[T.UNKNOWN=0]="UNKNOWN",T[T.TIMER=1]="TIMER",T[T.ON_HOVER=2]="ON_HOVER",T[T.ON_PRESS=3]="ON_PRESS",T[T.ON_CLICK=4]="ON_CLICK",T[T.DRAG=5]="DRAG",T[T.REVERSE_HOVER=6]="REVERSE_HOVER",T[T.REVERSE_PRESS=7]="REVERSE_PRESS",T[T.MOUSE_DOWN=8]="MOUSE_DOWN",T[T.MOUSE_UP=9]="MOUSE_UP",T[T.MOUSE_IN=10]="MOUSE_IN",T[T.MOUSE_OUT=11]="MOUSE_OUT",T[T.MOUSE_ENTER=12]="MOUSE_ENTER",T[T.MOUSE_LEAVE=13]="MOUSE_LEAVE",T[T.ON_KEY_DOWN=14]="ON_KEY_DOWN",T[T.ON_GAMEPAD_DOWN=15]="ON_GAMEPAD_DOWN",T[T.ON_VOICE=16]="ON_VOICE",T[T.MOBILE_NAV=17]="MOBILE_NAV",T[T.LEFT_ARROW=18]="LEFT_ARROW",T[T.RIGHT_ARROW=19]="RIGHT_ARROW",T[T.ON_MEDIA_HIT=20]="ON_MEDIA_HIT",T[T.ON_MEDIA_END=21]="ON_MEDIA_END",T))(En||{}),tv=(r=>(r[r.MISS=0]="MISS",r[r.LEFT_THIRD=1]="LEFT_THIRD",r[r.CENTER_THIRD=2]="CENTER_THIRD",r[r.RIGHT_THIRD=3]="RIGHT_THIRD",r))(tv||{}),Ih=class{constructor(e,t){this.swappedStablePath=e,this.hotspotStablePath=t}},vh=class{willTriggerHotspot(e,t,n,r){this.willTriggerHotspotCallback!=null&&this.willTriggerHotspotCallback(e,t,n,r)}didScrollNode(e){this.didScrollNodeCallback!=null&&this.didScrollNodeCallback(e)}constructor(e,t){this.willTriggerHotspotCallback=e,this.didScrollNodeCallback=t}},Jl=class i{constructor(e,t){this.FRAMES_TO_FINISH_RENDERING=3,this._state=i.State.INACTIVE,this._framesToFinishRendering=0,this._observers=new nr,this._emitter=null,e.addObserver(this),this._emitter=t}onFrame(){this._state==i.State.WAITING_TO_FINISH&&(this._framesToFinishRendering==0?(this._emitter.trigger("renderingStop",null),this._observers.forEach(e=>{e.handleRenderingStop()}),this._state=i.State.INACTIVE):this._framesToFinishRendering=this._framesToFinishRendering-1)}handleSetNeedsBlit(e){this._state==i.State.INACTIVE?e&&(this._emitter.trigger("renderingStart",null),this._observers.forEach(t=>{t.handleRenderingStart()}),this._state=i.State.ACTIVE):this._state==i.State.ACTIVE?e||(this._state=i.State.WAITING_TO_FINISH,this._framesToFinishRendering=this.FRAMES_TO_FINISH_RENDERING):e&&(this._state=i.State.ACTIVE)}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}};(t=>{let i;(a=>(a[a.ACTIVE=0]="ACTIVE",a[a.INACTIVE=1]="INACTIVE",a[a.WAITING_TO_FINISH=2]="WAITING_TO_FINISH"))(i=t.State||(t.State={}));let e;(r=>{function n(o){return t.State[o]}r.State_toString=n})(e=t.in_State||(t.in_State={}))})(Jl||(Jl={}));var _e=class _e extends zc{constructor(t){super();this._appState=null,this._observers=new nr,this._renderer=null,this._renderingStateTracker=null,this._idlenessTracker=null,this._transitionBehaviorManager=null,this._scrollSyncer=null,this._sequentialActionManager=null,this._viewportTracker=new Th,this._viewport=new hi,this._hotspotAnimation=new uh,this._uiRenderData=new hh,this._showHotspots=!0,this._multiplayer=null,this._mostRecentTransitionViaArrows=!1,this._mostRecentFrameNum=0,this._microtasksSinceLastFrame=0,this.MAX_MICROTASKS_PER_FRAME=2,this.onResize=null,this.onBaseScreenIdChanged=null,this.userDidAttemptZoom=null,this.disengageObservationMode=null,this.onURLClicked=null,this.onNavigateToPrototype=null,this.afterFrame=null,this.afterFirstRenderOfScreenStack=null,this._emitter=null,this._pointerEventDelegate=null,this.INTERACTION_REPORTING_RATE=10/100,this._currentMouseLocation=null,this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedDataLegacy=new kd,this._maintainedData=new gh,this._mouseEnteredNodesManager=null,this._initialFlingVelocity=new E(0,0),this._interactionObservers=new nr,this.ALT_CODE=18,this.SHIFT_CODE=16,this.META_CODE=91,this.CONTROL_CODE=17,this._appState=t,this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._emitter=$t.getEventEmitter(),this.makeRenderer(),this.setPhysicsForOS(this.getRelevantOS()),this._idlenessTracker=new mh(n=>{this._renderer.setZoomScale(n)},this._emitter),this._pointerEventDelegate=new _e.CanvasPointerEventDelegate(this),this._scrollSyncer=new Ud(this,this._appState),this._sequentialActionManager=new Ah(this,this._appState.prototypeState()),this._mouseEnteredNodesManager=new fh(this._appState)}addObserver(t){this._observers.add(t)}removeObserver(t){this._observers.remove(t)}setBackgroundEnabled(t){this._renderer.setBackgroundEnabled(t)}renderingStateTracker(){return this._renderingStateTracker}makeRenderer(){let t=this._renderer;t!=null&&t.removeFrom(this),X.getFeatureFlags().disableRendering?this._renderer=new wh:this._renderer=new Xa(this._viewport,this._appState,this._appState.imageManager()),this._transitionBehaviorManager!=null&&this._transitionBehaviorManager.removeFrom(this),this._transitionBehaviorManager=new yh(this),this._renderingStateTracker!=null&&this._appState.removeFrameObserver(this._renderingStateTracker),this._renderingStateTracker=new Jl(this._renderer,this._emitter),this._appState.addFrameObserver(this._renderingStateTracker),t!=null&&this._renderer!=null&&this._renderer.attachTo(this)}graphicsCardName(){return this._renderer.graphicsCardName()}deviceRenderer(){return this._renderer.deviceRenderer()}getContext(){return this._renderer.getContext()}appState(){return this._appState}idlenessTracker(){return this._idlenessTracker}viewport(){return this._viewport}viewportTracker(){return this._viewportTracker}mostRecentFrameNum(){return this._mostRecentFrameNum}setScrollPadding(t,n,r,o){this._viewport.setScrollPadding([t,n,r,o])}setMultiplayer(t){this._multiplayer=t}setShowHotspots(t){this._showHotspots=t}handleSceneChange(t,n){t!=null&&t.removeObserver(this),n!=null&&n.addObserver(this),this._viewport.invalidate(),this._invalidateZoomScaleForRender(),this._idlenessTracker.handleSceneChange(),this._setCurrentViewportSizeOnCanvas()}resetStateForTests(){this._viewport.resetStateForTests(),this._viewportTracker.resetStateForTests(),this._appState.resetStateForTests(),this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedDataLegacy.reset(),X.getFeatureFlags().prototypeNewMouseEvents&&this._maintainedData.resetAllEntries(),this._pointerEventDelegate.resetStateForTests(),this._mouseEnteredNodesManager.reset(),this._appState.prototypeState().addHsmObserver(this)}handleActiveCanvasChange(t,n){n!=null?this._viewport.invalidate():this._currentMouseLocation=null}handleActivePrototypeStartingPointChange(t,n){}afterEnteredViewer(){this._appState.nodeTransitionTracker().triggerPotentialTimedTransition=()=>{let t=this._appState.prototypeState(),n=[];t.getCurrentBaseScreenNode()!=null&&n.push(t.getCurrentBaseScreenNode());for(let r=0,o=t.getCurrentOverlayData().length;r<o;r=r+1)n.push(t.nodeForOverlayAt(r));this._triggerPotentialTimedTransition(n,0)},this._appState.nodeTransitionTracker().createVideoTriggerEventsForNodesInFrame=t=>{t&&this._createVideoTriggerEvents([t])},this._appState.nodeTransitionTracker().createVideoTriggerEventsForAllNodesOnscreen=()=>{let t=[],n=this._appState.prototypeState();n.getCurrentBaseScreenNode()!=null&&t.push(n.getCurrentBaseScreenNode());for(let r=0,o=n.getCurrentOverlayData().length;r<o;r=r+1)t.push(n.nodeForOverlayAt(r));this._createVideoTriggerEvents(t)}}navigateForward(t){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let r=this._appState.prototypeState().getCurrentBaseScreenNode();if(r==null)return;let o=null;this._appState.prototypeStructure().currentType()==1?o=this._appState.prototypeState().getNextBaseScreenNodeForFrameList():o=this._appState.prototypeState().getNextBaseScreenNodeForPrototype(),o!=null&&this.navigateViaArrows(r.id(),o.id(),0,t)}navigateBackward(t){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let r=this._appState.prototypeState().getCurrentBaseScreenNode();if(r==null)return;let o=this._appState.prototypeState().getPreviousBaseScreenNode();o!=null&&this.navigateViaArrows(r.id(),o.id(),1,t)}navigateViaArrows(t,n,r,o){this._mostRecentTransitionViaArrows=!0,Math.random()<this.INTERACTION_REPORTING_RATE&&Be.trackEvent1("prototype_view_interaction",new Map([["type","navigateViaArrows"],["direction",Kr[r]],["nonInteraction",0],["prototypeType",Wi[this._appState.prototypeStructure().currentType()]]]));let a=this._appState.prototypeState().getCurrentBaseScreenNode();if(a!=null&&a.prototypeInteractions().length!=0){let s=null;for(let l=0,d=a.prototypeInteractions().length;l<d;l=l+1){let c=a.prototypeInteractions()[l],p=(c==null?void 0:c.action())!=null?c.action().value:null;if(c!=null&&c.allActions().length>0)for(let h of c.allActions())h.transitionNodeID()!=null&&h.transitionNodeID()==n&&(p=h);let u=p!=null?this._appState.scene().findNode1(p.transitionNodeID()):null;if(u!=null){let h=Wt.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),a==null?void 0:a.id(),u==null?void 0:u.id(),p.navigationType(),p.connectionType());s=h==null?null:h}if(ne.equals(s,n)){this._appState.prototypeState().navigateToFrameAndCloseOverlays3(n,a,1,r,o,c,p);return}}}this._appState.prototypeState().navigateToFrameAndCloseOverlays3(n,null,1,r,o,null,null)}_navigateToHyperlink(t,n){var r;if(t.hyperlink.url!==void 0){this.onURLClicked(t.hyperlink.url,!0);return}else if(t.hyperlink.guid!==void 0){let o=gt.decodeGUID(t.hyperlink.guid);if(ne.equals(o,this._appState.getActiveCanvas().id())){this._appState.prototypeState().restartPrototype(1);return}let a=this._appState.scene().findNode1(o),s=Wt.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),(r=t.node)==null?void 0:r.id(),a==null?void 0:a.id(),n,"URL");if(s!=null){this._appState.prototypeState().navigateToFrameAndCloseOverlays1(s);return}let l=this._appState.currentFileKey();this.onNavigateToPrototype(l,o)}}triggerHotspot(t,n,r,o){if(this._multiplayer.isObserving()||(this._observers.forEach(s=>{s.willTriggerHotspot(t,n,r,o)}),n==null||n.actions().length==0))return;X.getFeatureFlags().prototypeStateManagement&&!Gs.seenOldStateManagementInteraction()&&n.stateManagementVersion()==0&&(Be.trackDefinedEvent("prototype.viewer_old_noodle_used",new Map),Gs.markOldStateManagementInteractionSeen());let a=t.node.getResolvedVariableModes();for(let s=0,l=n.actions().length;s<l;s=s+1){let d=n.actions()[s],c=d.connectionType();Math.random()<this.INTERACTION_REPORTING_RATE&&Be.trackEvent1("prototype_view_interaction",new Map([["type","triggerHotspot"],["transitionAction",En[r]],["transitionType",d==null?void 0:d.transitionType()],["action",c=="INTERNAL_NODE"?d==null?void 0:d.navigationType():c=="UPDATE_MEDIA_RUNTIME"?d==null?void 0:d.mediaAction():c],["nonInteraction",0]])),this._sequentialActionManager.appendToQueue(t,n,r,o,d,c,[s],a)}this._sequentialActionManager.runNextAction()}runAction(t,n,r,o,a,s,l,d){let c=!0;switch(s){case"INTERNAL_NODE":{let p=a.transitionNodeID();this._performNavigationOrOverlayChangeForHotspot(t.node,p,r,n,o,l),a.navigationType()=="SCROLL_TO"&&a.transitionType()!="SCROLL_ANIMATE"||(c=!1);break}case"URL":{t.hyperlink==null?this.onURLClicked(a.connectionURL(),a.openUrlInNewTab()):this._navigateToHyperlink(t,a.navigationType());break}case"BACK":{this.requestBack(t.node,n,1,Kt.TransitionAction_fromInteractionType(n.event().interactionType()),ar.fromPrototypeAction(a,n.stateManagementVersion()),a),c=!1;break}case"CLOSE":{this._appState.prototypeState().closeOverlayForHotspot(t.node,n,1,a),c=!1;break}case"SET_VARIABLE":{if(L._prototypeLib.fonts().isWaitingForFontList())return;let p=t.node.id();t.node.isOrInInstance()&&(p=t.node.findContainingPrimaryInstance().id());let u=L._prototypeLib.getICActionsForSetVariableAction(p,a.targetVariableID(),a.targetVariableData(),this._appState.prototypeState().getTopmostScreenId(),d);if(u.length>0){let h=lr.instance.setReverseVariantBindingsForICsDisabled(!0);for(let f of u){let m=t.node.scene().findNode1(f.nodeToSwap),A=m.prototypeInteractions()[f.interactionIndex];this.runAction(new Bo(m),A,0,null,A.actions()[f.actionIndex],"INTERNAL_NODE",[f.actionIndex],d)}lr.instance.setReverseVariantBindingsForICsDisabled(h),c=!1}L._prototypeLib.runSetVariable(p,a.targetVariableID(),a.targetVariableData(),d),this._appState.prototypeState().createMultiplayerSetVariableAction(p,a.targetVariableID(),a.targetVariableData(),d),fa.notifyVariableUpdated();break}case"UPDATE_MEDIA_RUNTIME":{this._appState.videoManager().updateVideoRuntime(a,t.node.id());break}case"CONDITIONAL":{if(L._prototypeLib.fonts().isWaitingForFontList()||a.conditionalActions().length==0)return;let p=t.node.id();t.node.isOrInInstance()&&(p=t.node.findContainingPrimaryInstance().id());let u=L._prototypeLib.getFirstTruthyConditionalIndex(p,a.conditionalActions()[0].condition());if(u>=0&&u<a.conditionalActions().length){let f=a.conditionalActions()[u].actions();for(let _=0,m=f.length;_<m;_=_+1){let A=f[_],y=[l[0],u,_];this._sequentialActionManager.insertInQueue(t,n,r,o,A,A.connectionType(),y,_,d)}}break}}c&&this._sequentialActionManager.runNextAction()}triggerDelayedHotspot(t,n,r){var a;let o=(a=this._appState.scene())==null?void 0:a.findNode1(t);o!=null&&this.triggerHotspot(new Bo(o),n,r,null)}_findPrototypeActionGivenActionIndexPath(t,n){let r=t.actions(),o=n[0];if(o<r.length){let a=r[o];if(n.length>2){let s=n[1],l=n[2];if(a.conditionalActions()!=null&&a.conditionalActions().length>s){let d=a.conditionalActions()[s];if(d.actions()!=null&&d.actions().length>l)return d.actions()[l]}}return a}return null}_performNavigationOrOverlayChangeForHotspot(t,n,r,o,a,s){var d;this._mostRecentTransitionViaArrows=X.getFeatureFlags().prototypeNewMouseEvents?!1:a==null;let l=this._findPrototypeActionGivenActionIndexPath(o,s);if(t==null&&Ke("Hotspot node unexepectedly null when performing navigation or overlay change for hotspot"),t==null||l.navigationType()=="NAVIGATE"||l.navigationType()=="SWAP"&&this._appState.prototypeState().getTopmostOverlayId()==null)this._appState.prototypeState().navigateToFrameAndCloseOverlays3(n,t,1,0,r,o,l);else if(l.navigationType()=="SCROLL_TO")this.scrollToDestinationInFrame(n,o);else if(l.navigationType()=="OVERLAY")this._appState.prototypeState().overlayFrame(n,t,0,r,o,l);else if(l.navigationType()=="SWAP")this._appState.prototypeState().swapTopOverlay(n,t,r,o,l);else if(l.navigationType()=="SWAP_STATE"){if(L._prototypeLib.fonts().isWaitingForFontList())return;let c=(d=jt.whichInstanceToSwap(t,l.transitionNodeID()))==null?void 0:d.stablePath();c!=null&&this._appState.prototypeState().swapInstanceToState2(c,n,t,r,o,1,l)}}requestBack(t,n,r,o,a,s){this._appState.prototypeState().returnToState2(t,n,r,o,a,s)}handleHsmAborted(t,n){this._renderer.abortHsmTransition(t,n),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(n.stablePath);let r=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(t,o=>(r.push(this._appState.scene().findNode3(o)),be.Loop.CONTINUE)),this._onCommitOrAbortForInteractions(r,n.cause,n.oldStateId())}handleHsmCommitted(t,n,r){this._renderer.commitHsmTransition(t,n),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(n.stablePath);let o=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(t,a=>(o.push(this._appState.scene().findNode3(a)),be.Loop.CONTINUE)),r(()=>{this._onCommitOrAbortForInteractions(o,n.cause,n.oldStateId())})}handleHsmRequested(t,n){Gs.newStateManagementRulesEnabledForChange(n)&&this._scrollSyncer.commitCurrentScrollStateToStorage(n)}handleHsmInitiated(t,n){Gs.newStateManagementRulesEnabledForChange(n)&&(n.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(n):this._scrollSyncer.resetScrollStateToScene(n));let r=this._transitionBehaviorManager.getTransitionMixinForStateSwap(this._appState.scene(),n,this._multiplayer.isObserving());this._renderer.triggerHsmTransition(t,n,r),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(n.stablePath)}handleStateChangeAborted(t){this._updateCanvasForCurrentBaseScreen();let n=null,r=[];ne.equals(t.oldStateId(),t.newStateId())||r.push(t.oldStateId());let o=t.oldOverlayData(),a=t.newOverlayData();for(let s=0,l=o.length;s<l;s=s+1)(s>=a.length||!ne.equals(o[s].id,a[s].id))&&r.push(o[s].id);n=r.map(s=>{var l;return(l=this._appState.scene())==null?void 0:l.findNode1(s)}).filter(s=>s!=null),!ne.equals(t.oldStateId(),t.newStateId())&&this.onBaseScreenIdChanged!=null&&this.onBaseScreenIdChanged(t.oldStateId(),Kt.TransitionAction_getControlSource(t.cause),!t.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState()),this._renderer.handleAbortedTransition(t),this._updateViewportForCurrentPreview(),this._appState.currentFitMode()==4&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate(),this._onCommitOrAbortForInteractions(n,t.cause,t.oldStateId())}handleStateChangeCommitted(t,n){this._updateCanvasForCurrentBaseScreen(),this._renderer.handleCommittedTransition(t);let r=t.getNewOrChangedFrameIds().map(o=>{var a;return(a=this._appState.scene())==null?void 0:a.findNode1(o)}).filter(o=>o!=null);if(this._appState.scene().interactiveComponentsEnabled()){let o=this._appState.scene().findNode1(this._appState.prototypeState().getTopmostScreenId());o!=null&&be.forEachNode1(o,a=>(a!=o&&a.isInstance()&&r.push(a),be.Loop.CONTINUE))}n(()=>{this._onCommitOrAbortForInteractions(r,t.cause,t.oldStateId())})}handleStateChangeInitiated(t){if(this._updateCanvasForCurrentBaseScreen(),this._appState.baseScreenNode()==null&&!X.isInlinePreview()){console.warn("no current TLF after receiving update");return}this.setPhysicsForOS(this.getRelevantOS());let n=this._transitionBehaviorManager.getTransitionMixin(this._appState.scene(),t,this._multiplayer.isObserving());this._renderer.triggerTransition(t,this._viewport,n),this.setPhysicsForOS(this.getRelevantOS()),!ne.equals(t==null?void 0:t.oldStateId(),t==null?void 0:t.newStateId())&&this.onBaseScreenIdChanged!=null&&this.onBaseScreenIdChanged(t.newStateId(),Kt.TransitionAction_getControlSource(t.cause),!t.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState());let r=this._appState.prototypeState();if(X.getFeatureFlags().prototypeStateManagement&&t.stateManagementVersion()==1)this._scrollSyncer.commitCurrentScrollStateToStorage(t),t.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(t):this._scrollSyncer.resetScrollStateToScene(t);else if(t.preserveScroll()==1)_e.matchNodesAndPreserveScroll(this,r,t);else{let o=t.getNewOrChangedFrameIds().map(a=>{var s;return(s=this._appState.scene())==null?void 0:s.findNode1(a)});for(let a of o)this._resetScrollForTlf(a)}this._pointerEventDelegate.unlockScroll(),this._updateViewportForCurrentPreview(),this._appState.currentFitMode()==4&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate()}handleStateChangeRequested(t){}handleFitModeChange(t,n){this._appState.baseScreenNode()!=null&&!vs.FitMode_topLevelFramesCanScroll(this._appState.prototypeState().getCurrentFitMode())&&(this._appState.activePrototypeDevice()!=null&&ba.hasDevice(this._appState.activePrototypeDevice().type)||this.updateScrollOffsetForNode(this._appState.baseScreenNode(),new E(0,0))),this._renderer.changeFitMode(n),this._setCurrentViewportSizeOnCanvas()}handleRestartPrototype(){this._scrollSyncer.uninit(),this.cancelAnimationManager(),this._mouseEnteredNodesManager.reset()}_updateCanvasForCurrentBaseScreen(){let t=this._appState.baseScreenNode();(t==null?void 0:t.canvas())!=null&&(this._appState.setActiveCanvas(t.canvas()),this._setCurrentViewportSizeOnCanvas())}_updateViewportForCurrentPreview(){let t=this._renderer.currentCanvasSpaceFrameBounds(),n=this._renderer.currentCanvasSpacePreviewBounds();t!=null&&n!=null?this._viewport.updateForCurrentPreview(t,n,this._appState.currentFitMode(),this._appState.activePrototypeDevice()):this._viewport.updateForBaseScreen(this._appState.baseScreenNode(),this._appState.currentFitMode(),this._appState.activePrototypeDevice())}_invalidateZoomScaleForRender(){this._idlenessTracker.updateZoomScaleNow(this._viewport.zoomScale())}handleSceneGraphEvent(t){ne.equals(t.node.id(),this._appState.baseScreenId())?t.property==25?this._updateCanvasForCurrentBaseScreen():t.property==49&&this._updateViewportForCurrentPreview():t.property==66&&(this._updateViewportForCurrentPreview(),this._invalidateZoomScaleForRender(),this._maybeChangePhysicsForDevice($.asPrototypeDevice(t.oldVal))),this._handleScrollingPropertyChange(t.node,t.property,t.oldVal,t.newVal),t.property!=62&&this._viewport.invalidate()}handleAction(t,n){switch(t){case 1:{if(X.isInlinePreview())break;this._viewport.adjustCameraZoomRounded(1,2),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 2:{if(X.isInlinePreview())break;this._viewport.adjustCameraZoomRounded(1,.5),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 3:{this._viewport.setCameraZoom(1,1),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 4:{if(X.isInlinePreview())break;this.canvasContentBounds()!=null&&this._viewport.zoomToFit2(1,this.canvasContentBounds()),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}}}setup(){this._setupInteractionHandlers(this._emitter),rr.addUpdate(Jt.windowResize(this.events()),t=>{this._resize()}),rr.addUpdate(Jt.windowFrame(this.window().events()),t=>{this._onFrame()}),this._renderer.attachTo(this),this._resize(),this._appState.addActionObserver(this),this._appState.addAppObserver(this)}canvasSpaceToWindowSpace(){let t=_o.new2();return t.translate2(this._viewport.viewSpaceBounds().topLeft()),t.multiply(this._viewport.canvasSpaceToViewSpace1()),t}_tryResizingTo(t){this._viewport.setBounds(new U(0,0,t.x(),t.y())),this._updateViewportForCurrentPreview();let n=this._renderer.resize(t.x(),t.y(),this._viewport.zoomScale(),mr());return this.onResize!=null&&(this._setCurrentViewportSizeOnCanvas(),this.onResize()),this._idlenessTracker.handleInteraction(),n}_resize(){let t=this.absoluteBounds(),n=ve.FrozenVector_new4(t.width(),t.height()),r=this._tryResizingTo(n),o=r.canvasSize;if(r.webGLDidAdjustCanvasSize){let a=this._tryResizingTo(o).canvasSize}}_setCurrentViewportSizeOnCanvas(){let t=this._appState.baseScreenNode();if(t==null)return;let n=t.findContainingCanvasOrSelf();if(n==null)return;let r=null,o=this._appState.prototypeState().getCurrentFitMode();if(o==1||o==2)r=ve.FrozenVector_INFINITY;else if(o==5||o==6){let a=this._viewport.getScaleFactorForCurrentTlf(t.fullSize(),o,n.prototypeDevice()),s=this._viewport.viewSpaceBounds().size().y()/a;r=new E(1/0,s)}else r=this._viewport.viewSpaceBounds().size();n.currentViewportSize().equals(r)||n.setCurrentViewportSize(r)}renderingIsComplete(){return this._renderer.isRenderingDone()}isTopLevelTransitionOngoing(){return this._renderer.isTopLevelTransitionOngoing()}dangerouslyAccessProtoRenderManager(){return this._renderer}clearTileCaches(){this._renderer.clearTileCaches()}_onFrame(){this._mostRecentFrameNum=this._mostRecentFrameNum+1,this._microtasksSinceLastFrame=0,this._appState.onFrame();let t=this._appState.getActiveCanvas();if(t==null)return;this._clampDirtyScrollContainers(),_e._scrollAnimationManager!=null&&this._updateForAnimation(),(this._idlenessTracker.justInteracted()||this._renderer.checkNeedsBlit())&&this._renderer.setNeedsBlit(!0),this._idlenessTracker.advanceFrame(this._viewport),this._viewportTracker.check(this._viewport),this._viewport.prepareForRendering(),this._updateViewportForCurrentPreview(),this._appState.baseScreenNode()!=null&&this._sendMouseCursorUpdate(),this._updateScrollOffsetsFromMultiplayer();let n=this._appState.baseScreenNode()!=null&&this._appState.baseScreenNode().visible();if(!n)this._renderer.drawBlank();else{this._appState.renderDots()?this._uiRenderData.backgroundColor=C.WHITE:this._uiRenderData.backgroundColor=Up(this._appState.baseScreenId(),this._appState.currentFitMode(),t),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspots=this._findHotspotsToAnimate(),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspotOpacity=this._hotspotAnimation.getOpacity(),this._uiRenderData.particles=this._multiplayer.getParticles(),this._uiRenderData.mouse=this._multiplayer.getMouse(),this._uiRenderData.renderDots=this._appState.renderDots(),Be.appTimerStart("rendererDraw");let o=this._renderer.draw(this._idlenessTracker.zoomInProgress(),this._idlenessTracker.shouldRenderOptionalTiles(),this._viewport,this._uiRenderData);Be.appTimerStop("rendererDraw"),this._idlenessTracker.setPreviousRenderStatus(o),this._uiRenderData.particles!=null&&this._uiRenderData.particles.length!=0&&this._viewport.invalidate(),this.isTopLevelTransitionOngoing()&&this._multiplayer.onTransitionFrame(this._renderer.transitionProgressTracker().progress())}this.afterFrame!=null&&this.afterFrame(),this.afterFirstRenderOfScreenStack!=null&&n&&this.afterFirstRenderOfScreenStack(),this._pointerEventDelegate.maybeProcessStoredPointerRelease()}_findHotspotsToAnimate(){let t=a=>{let s=a.canvasSpaceScrolledInteractiveBounds(1),l=a.canvasSpaceScrolledInteractiveBounds(0);return new Bd(s,l)},n=this._appState.prototypeState(),r=this._appState.baseScreenNode();if(!(!this._showHotspots||!n.getTransitionOnClick()||this._hotspotAnimation.getOpacity()<=0)&&r!=null){let a=(l,d)=>{var u;let c=d.event().interactionType(),p=(u=d.action())==null?void 0:u.value;if(c=="ON_MEDIA_HIT"||c=="ON_MEDIA_END")return!1;if(d.actions().length==1&&p.navigationType()=="SWAP_STATE"){if(["ON_HOVER","ON_PRESS","AFTER_TIMEOUT"].indexOf(c)!=-1)return!1;if(l!=null)return jt.whichInstanceToSwap(l,p==null?void 0:p.transitionNodeID())!=null}return!0},s=n.getTopmostOverlayNode();if(s!=null){let l=n.getTopmostOverlay();return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(s,0,a).map(d=>{let c=t(d),p=l.overlaySpaceToBaseTlfSpace2(r,c.canvasSpaceBounds),u=l.overlaySpaceToBaseTlfSpace2(r,c.canvasSpaceClipBounds);return new Bd(p,u)})}else return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(r,1,a).map(t)}return null}hitTestDeviceFrame(t){let n=this._appState.getActiveCanvas();if(n==null)return!1;let r=this._appState.baseScreenNode();if(r==null)return!1;let o=this._renderer.deviceRenderer();if(o==null||!o.canRenderDeviceFrame(n.prototypeDevice()))return!1;let a=o.pixelAtPosition(t,r.canvasSpaceBoundingBox(),n.prototypeDevice());return C.alpha(a)>0}hitTestBaseScreen(t){let n=this._appState.baseScreenNode();if(n==null)return 0;let r=this._canvasSpacePoint(t),o=n.canvasSpaceBoundingBox();return o.contains2(r)?o.leftThird().contains2(r)?1:o.rightThird().contains2(r)?3:2:0}_canvasSpacePoint(t){return this._viewport.canvasSpaceToViewSpace1().clone().inverseTransformPoint(t.clone())}canvasContentBounds(){var t;return(t=this._appState.getActiveCanvas())==null?void 0:t.canvasSpaceRenderedBounds()}setMaximumDrawingBufferSizeForTesting(t){this._renderer.getContext().setMaximumDrawingBufferSizeForTesting(t)}clearMaximumDrawingBufferSizeForTesting(){this._renderer.getContext().clearMaximumDrawingBufferSizeForTesting()}triggerResizeForTesting(){let t=this._cachedAbsoluteBounds,n=t.clone();n.setWidth(n.width()-1),this._cachedAbsoluteBounds=n,this._resize(),this._cachedAbsoluteBounds=t,this._resize()}toggleRenderTreePrinting(){this._renderer.toggleRenderTreePrinting()}invalidateIdlenessTracker(){this._idlenessTracker.handleInteraction()}_nonNull(t){return t}_setupInteractionHandlers(t){let n=a=>s=>{Be.appTimerStart("discreteUserAction"),a(s),Be.appTimerStop("discreteUserAction")},r=a=>s=>{Be.appTimerStart("mouseMove"),a(s),Be.appTimerStop("mouseMove")},o=a=>s=>{Be.appTimerStart("dragUserAction"),a(s),Be.appTimerStop("dragUserAction")};rr.addUpdate(Jt.mousePress(this.events()),n(a=>{this._pointerEventDelegate.onMousePress(this._nonNull(a.asMouseEvent()))})),rr.addUpdate(Jt.mouseDrag(this.events()),o(a=>{this._pointerEventDelegate.onDrag(this._nonNull(a.asMouseEvent()))})),rr.addUpdate(Jt.mouseRelease(this.events()),n(a=>{this._pointerEventDelegate.onMouseRelease(this._nonNull(a.asMouseEvent()))})),rr.addUpdate(Jt.mouseMove(this.events()),r(a=>{this._pointerEventDelegate.onMouseMove(this._nonNull(a.asMouseEvent()))})),rr.addUpdate(Jt.mouseScroll(this.events()),o(a=>{this._pointerEventDelegate.onMouseScroll(this._nonNull(a.asMouseEvent()))})),rr.addUpdate(Jt.mouseLeave(this.window().root().events()),n(a=>{this._pointerEventDelegate.onMouseLeave(this._nonNull(a.asMouseEvent()))})),rr.addUpdate(Jt.touchPress(this.events()),n(a=>{this._pointerEventDelegate.onTouchPress(this._nonNull(a.asTouchEvent()))})),rr.addUpdate(Jt.touchDrag(this.events()),o(a=>{this._pointerEventDelegate.onDrag(this._nonNull(a.asTouchEvent()))})),rr.addUpdate(Jt.touchRelease(this.events()),n(a=>{this._pointerEventDelegate.onTouchRelease(this._nonNull(a.asTouchEvent()))})),rr.addUpdate(Jt.keyPress(this.events()),n(a=>{this._pointerEventDelegate.onKeyPress(a.asKeyEvent(),t)})),rr.addUpdate(Jt.gamepadDown(this.events()),n(a=>{this._pointerEventDelegate.onGamepadDown(a.asGamepadEvent())}))}_updateHoveredStateInstanceIfNeeded(t){var o;let n=this._appState.prototypeState(),r=(o=n.getStateMachineInitiatedChange(t))!=null?o:n.getStateMachineLastChangeInHistory(t);r!=null&&r.cause==2?this._hoveredStateInstances.set(t.toString(),r):this._hoveredStateInstances.delete(t.toString())}_onCommitOrAbortForInteractions(t,n,r){if(this._triggerPotentialTimedTransition(t,n),this._createVideoTriggerEvents(t),X.getFeatureFlags().prototypeNewMouseEvents&&this._mouseEnteredNodesManager.markNodesAsNotEnteredWithoutTriggeringMouseLeave(t.map(o=>o.id())),r!=null&&this._currentMouseLocation!=null&&!this._mostRecentTransitionViaArrows){let o=this._currentMouseLocation;this._microtasksSinceLastFrame=this._microtasksSinceLastFrame+1,this._microtasksSinceLastFrame<=this.MAX_MICROTASKS_PER_FRAME&&Uu(()=>{this.handleInteractionsForMove(o)})}}_createCallbackForMediaEvent(t,n,r){return()=>{this.triggerHotspot(t,n,r,null)}}_createVideoTriggerEvents(t){if(!this._appState.prototypeState().interactionsEnabled())return;let n=new Set([Kt.TransitionAction_mapToInteractionType(20),Kt.TransitionAction_mapToInteractionType(21)]),r=a=>n.has(a.event().interactionType()),o=this._appState.prototypeStructure().findHotspotsWithInteractionFilterWithinMultipleNodes(new Set(t),0,r);for(let a of o)this._registerMediaEventsForHotspot(a)}_registerMediaEventsForHotspot(t){let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,Kt.TransitionAction_mapToInteractionType(20));for(let o of n){let a=o.event().mediaHitTime();this._appState.videoManager().addInteractionEvent(o,t.node.id(),a,this._createCallbackForMediaEvent(t,o,20))}let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,Kt.TransitionAction_mapToInteractionType(21));for(let o=0,a=r.length;o<a;o=o+1){let s=r[o],l=this._createCallbackForMediaEvent(t,s,21);if(this._appState.videoManager().addInteractionEvent(s,t.node.id(),0,l),o+1<r.length){let d=r[o+1];if(this._shouldTriggerVariantInteractionWithMediaAction(s,d)){let c=this._createCallbackForMediaEvent(t,d,21);this._appState.videoManager().addInteractionEvent(d,t.node.id(),0,c)}}}}_triggerPotentialTimedTransition(t,n){if(!this._appState.prototypeState().interactionsEnabled())return;let r=[],o=[],a=null,s=null;for(let d of t){let c=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(d,Kt.TransitionAction_mapToInteractionType(1));for(let p of c)p.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE")!=null?(r.push(p),o.push(d)):(a==null||p.event().transitionTimeout()<a.event().transitionTimeout())&&(a=p,s=d)}a!=null&&(r.push(a),o.push(s));let l=0;r.forEach(d=>{var S;let c=o[l];l=l+1;let p=d.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),u=p!=null?(S=jt.whichInstanceToSwap(c,p.transitionNodeID()))==null?void 0:S.stablePath():null,h=this._appState.prototypeState(),f=u!=null?h.actionCountersForStateAndAncestors(u):[h.actionCounter()],_=this._appState.nodeTransitionTracker().topmostScreenChangeCounter(),m=c.stablePath(),A=()=>{var O;let g=(O=this._appState.scene())==null?void 0:O.findNode3(m);if(g==null)return;let b=u!=null?h.actionCountersForStateAndAncestors(u):[h.actionCounter()];this._appState.nodeTransitionTracker().topmostScreenChangeCounter()==_&&ce.List_equalsWithComparison(f,b,(w,P)=>w==P)&&this.triggerDelayedHotspot(g.id(),d,1)},y=d.event().transitionTimeout()*1e3|0;(n==18||n==19)&&(y=Math.max(500,y)),setTimeout(A,y)})}updateCursorType(t,n){if(!this._appState.prototypeState().interactionsEnabled()){this.setCursor(0);return}if(Xe.isMobile(this.getRelevantOS())){this.setCursor(2);return}let r=this._appState.baseScreenNode();if(r==null){this.setCursor(0);return}let o=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_CLICK",Wt.getNodeInteractionPairs("ON_CLICK",n));o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_PRESS",Wt.getNodeInteractionPairs("ON_PRESS",n))),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_DOWN",Wt.getNodeInteractionPairs("MOUSE_DOWN",n))),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_UP",Wt.getNodeInteractionPairs("MOUSE_UP",n))),o!=null&&!ne.equals(o.node.id(),r.id())?this.setCursor(1):this.setCursor(0)}_handleMaintainedInteraction(t,n,r){var _;if(!this._appState.prototypeState().interactionsEnabled()||n==null)return;let o=t.node.id(),a=n.event().interactionType(),s=0;if(X.getFeatureFlags().prototypeNewMouseEvents){if(this._maintainedData.getByHotspotAndInteractionType(o,a)!=null)return;s=this._maintainedData.set(o,a,r)}else{if(ne.equals(this._maintainedDataLegacy.delayedHotspotId(),o))return;this._maintainedDataLegacy.set(o,a,r),s=this._maintainedDataLegacy.counter()}let l=n.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),d=l!=null?(_=jt.whichInstanceToSwap(t.node,l.transitionNodeID()))==null?void 0:_.stablePath():null,c=d!=null?this._appState.prototypeState().actionCounterForState(d):-1,p=this._appState.prototypeState().actionCounter(),u=()=>{var I;let m=this._maintainedData.getByHotspotAndInteractionType(o,a);if(m==null)return;let A=m.counter(),y=d!=null?this._appState.prototypeState().actionCounterForState(d):-1,S=this._appState.prototypeState().actionCounter(),g=(I=this._appState.scene())==null?void 0:I.findNode1(o),b=s==A,T=b&&p==S&&c==y;b&&this._maintainedData.resetEntry(o,a),T&&g!=null&&this.triggerDelayedHotspot(g.id(),n,m.action())},h=()=>{var b;if(this._maintainedDataLegacy.delayedHotspotId()==null)return;let m=this._maintainedDataLegacy.counter(),A=d!=null?this._appState.prototypeState().actionCounterForState(d):-1,y=this._appState.prototypeState().actionCounter(),S=(b=this._appState.scene())==null?void 0:b.findNode1(this._maintainedDataLegacy.delayedHotspotId());s==m&&p==y&&c==A&&S!=null&&(this.triggerDelayedHotspot(S.id(),n,this._maintainedDataLegacy.action()),this._maintainedDataLegacy.reset())},f=X.getFeatureFlags().prototypeNewMouseEvents?u:h;setTimeout(f,n.event().interactionDuration()*1e3|0)}_handleMouseEnterMouseLeave(t,n){let r=this._canvasSpacePoint(t);this._mouseEnteredNodesManager.updateEnteredNodes(r,n),this._mouseEnteredNodesManager.resetNoLongerMaintainedMouseEnterOrLeaveInteractions(this._maintainedData);let o=_e.WasHandled.NOT_HANDLED,a=this._appState.prototypeState().actionCounter(),s=this._appState.prototypeState(),l=s.getTopmostOverlayNode(),d=this._appState.baseScreenNode(),c=l!=null?l:d,p=s.getSecondTopmostOverlayNodeOrBaseScreen(),u=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(c,0,m=>m.event().interactionType()=="MOUSE_LEAVE",Wt.getNodeInteractionPairs("MOUSE_LEAVE",n));if(p!=null){let m=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(p,0,A=>A.event().interactionType()=="MOUSE_LEAVE");ce.List_append2(u,m)}let h=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(c,0,m=>m.event().interactionType()=="MOUSE_ENTER",Wt.getNodeInteractionPairs("MOUSE_ENTER",n)),f=this._mouseEnteredNodesManager.getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(u);for(let m of f){let A=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(m.node,"MOUSE_LEAVE"),y=this._appState.prototypeState().actionCounter();if(a!=y)return o;o=this._triggerOrHandleMaintainedInteractions(A,m,13,t)}let _=this._mouseEnteredNodesManager.getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(h);for(let m of _){let A=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(m.node,"MOUSE_ENTER"),y=this._appState.prototypeState().actionCounter();if(a!=y)return o;o=this._triggerOrHandleMaintainedInteractions(A,m,12,t)}return o}handleInteractionsForMove(t){if(this._appState.scene()==null||!this._appState.prototypeState().interactionsEnabled())return;let n=X.prototypeMouseMovePerf(),r=this._appState.prototypeState().getTopmostScreen(),o=n?this._appState.prototypeStructure().getInteractionsGroupedByType([r]):null;this.updateCursorType(t,o);let a=_e.WasHandled.NOT_HANDLED;if(X.getFeatureFlags().prototypeNewMouseEvents){let s=o,l=X.getFeatureFlags().prototypeNewMousePerf;l?!n&&l&&(s=this._appState.prototypeStructure().getInteractionsGroupedByType([r])):s=null,a=this._handleMouseEnterMouseLeave(t,s)}a=this._handleGranularMoveForDeprecatedMouseInMouseOut(t,o),a==_e.WasHandled.NOT_HANDLED&&(this._handleHover1(t,o),this._handleReverseHover(t))}_handleGranularMoveForDeprecatedMouseInMouseOut(t,n){let r=10,o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_IN",Wt.getNodeInteractionPairs("MOUSE_IN",n));if(!X.getFeatureFlags().prototypeNewMouseEvents&&o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_ENTER",Wt.getNodeInteractionPairs("MOUSE_ENTER",n)),r=12),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_OUT",Wt.getNodeInteractionPairs("MOUSE_OUT",n)),r=11),!X.getFeatureFlags().prototypeNewMouseEvents&&o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_LEAVE",Wt.getNodeInteractionPairs("MOUSE_LEAVE",n)),r=13),X.getFeatureFlags().prototypeNewMouseEvents?this._maintainedData.resetAllEntriesMatchingPredicate((s,l)=>["MOUSE_IN","MOUSE_OUT"].indexOf(l)!=-1&&!ne.equals(o!=null?o.node.id():null,s)):["MOUSE_IN","MOUSE_OUT","MOUSE_ENTER","MOUSE_LEAVE"].indexOf(this._maintainedDataLegacy.interaction())!=-1&&!ne.equals(o!=null?o.node.id():null,this._maintainedDataLegacy.delayedHotspotId())&&this._maintainedDataLegacy.reset(),o==null)return _e.WasHandled.NOT_HANDLED;let a=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(o.node,Kt.TransitionAction_mapToInteractionType(r));return this._triggerOrHandleMaintainedInteractions(a,o,r,t)}_handleHover1(t,n){let r=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_HOVER",Wt.getNodeInteractionPairs("ON_HOVER",n));return this._handleHover2(r,t)}handleHoverAtHotspot(t){return this._mostRecentTransitionViaArrows=!0,this._handleHover2(t,null)}_handleHover2(t,n){if(t!=null){let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,Kt.TransitionAction_mapToInteractionType(2));for(let o of r)return this.triggerHotspot(t,o,2,n),o.setHoverLastHandledFrameNum(this.mostRecentFrameNum()),_e.WasHandled.HANDLED}return _e.WasHandled.NOT_HANDLED}handleReverseHoverAtHotspot(t){var o;let n=t.node,r=Le.StringMap_get(this._hoveredStateInstances,t.node.stablePath().toString(),null);return r==null||!ne.equals((o=n.topLevelAncestor())==null?void 0:o.id(),this._appState.prototypeState().getTopmostScreenId())?_e.WasHandled.NOT_HANDLED:(this._appState.prototypeState().returnInstanceToState(r.stablePath,2,6),_e.WasHandled.HANDLED)}_handleReverseHover(t){var _,m,A,y;if(this._multiplayer.isObserving())return _e.WasHandled.HANDLED;let n=this._appState.prototypeState();if(this._appState.scene().interactiveComponentsEnabled()){let S=_e.WasHandled.NOT_HANDLED;for(let g of Array.from(this._hoveredStateInstances.keys())){let b=Le.StringMap_get(this._hoveredStateInstances,g,null);if(b==null)continue;let T=this._appState.scene().findNode3(b.stablePath);if(T==null||!ne.equals((_=T.topLevelAncestor())==null?void 0:_.id(),n.getTopmostScreenId()))continue;let I=(m=b==null?void 0:b.canvasSpaceTriggerBoundsOrNull)==null?void 0:m.clone(),O=n.getCurrentBaseScreenNode();if(I!=null&&O!=null){let w=null,P=this._canvasSpacePoint(t),H=this._appState.prototypeState().getTopmostOverlay();if(w=(A=H==null?void 0:H.baseTlfSpaceToOverlaySpace1(O,P))!=null?A:P,T.scrollAndClipBoundsBySelfAndAncestors(I,0).contains2(w))continue;n.returnInstanceToState(b.stablePath,2,6),S=_e.WasHandled.HANDLED;break}}if(S==_e.WasHandled.HANDLED)return S}let r=(y=this._appState.prototypeState().getInitiatedChange())!=null?y:this._appState.prototypeState().getLastChangeInHistory(),o=r==null?void 0:r.canvasSpaceTriggerBoundsOrNull;if(!(o!=null&&r.cause==2))return _e.WasHandled.NOT_HANDLED;let s=null;if(s=this._appState.scene().findNode1(r==null?void 0:r.oldStateId()),s==null)return _e.WasHandled.NOT_HANDLED;let l=null,d=this._canvasSpacePoint(t);ne.equals(r==null?void 0:r.oldStateId(),r==null?void 0:r.newStateId())||(d=this._canvasSpacePointInPreviousFrame(s,this._appState.baseScreenNode(),d));let c=r==null?void 0:r.oldOverlays(this._appState.prototypeState());c.length>0?l=ce.List_last(c).baseTlfSpaceToOverlaySpace1(s,d):l=d;let p=r!=null?r.interactionAddress.hotspotStablePath:null,u=this._retrieveReverseInteractionHotspotFromStoredData(p);if(u==null||u.scrollAndClipBoundsBySelfAndAncestors(o,0).contains2(l))return _e.WasHandled.NOT_HANDLED;let f=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(this._retrieveReverseInteractionHotspotFromStoredData(p),Kt.TransitionAction_mapToInteractionType(2));for(let S of f){if(S.getHoverLastHandledFrameNum()==this.mostRecentFrameNum())break;return this.requestBack(u,S,2,6,null,null),_e.WasHandled.HANDLED}return _e.WasHandled.NOT_HANDLED}_retrieveReverseInteractionHotspotFromStoredData(t){return this._appState.scene().findNode3(t)}handleInteractionsForPress(t){if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return _e.WasHandled.HANDLED;X.getFeatureFlags().prototypeNewMouseEvents?this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_UP"):this._maintainedDataLegacy.interaction()=="MOUSE_UP"&&this._maintainedDataLegacy.reset();let n=this._handleMouseDown(t);return n==_e.WasHandled.NOT_HANDLED&&(n=this._handlePress(t)),n}_handleMouseDown(t){if(!this._appState.prototypeState().interactionsEnabled())return _e.WasHandled.HANDLED;let n=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_DOWN");if(n==null)return _e.WasHandled.NOT_HANDLED;let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n.node,Kt.TransitionAction_mapToInteractionType(8));return this._triggerOrHandleMaintainedInteractions(r,n,8,t)}_handlePress(t){if(!this._appState.prototypeState().interactionsEnabled())return _e.WasHandled.HANDLED;let n=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_PRESS");if(n==null)return _e.WasHandled.NOT_HANDLED;let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n.node,Kt.TransitionAction_mapToInteractionType(3));for(let o of r){let a=n.node.stablePath(),s=o.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE");if(s!=null){let l=jt.whichInstanceToSwap(n.node,s.transitionNodeID());this._lastPressData=new Ih(l==null?void 0:l.stablePath(),a)}else this._lastPressData=new Ih(null,a);return this.triggerHotspot(n,o,3,t),_e.WasHandled.HANDLED}return _e.WasHandled.NOT_HANDLED}maybeHandleSingleTapAsNavigation(t){if(this._appState.scene()==null||this._appState.getActiveCanvas()==null)return!1;if(this._appState.prototypeStructure().currentType()==1){let o=this.hitTestBaseScreen(t);if(o!=0&&o!=2){let a=o==1?-1:1;return a==1?this.navigateForward(17):this.navigateBackward(17),Math.random()<this.INTERACTION_REPORTING_RATE&&Be.trackEvent1("prototype_view_interaction",new Map([["type","navigateViaArrows"],["direction",a==1?"FORWARD":"REVERSE"],["inputType","tap"],["nonInteraction",0],["prototypeType",Wi[this._appState.prototypeStructure().currentType()]]])),!0}}return!1}maybeAdvanceViaSwipeGesture(t,n){if(!this._appState.prototypeState().interactionsEnabled())return!1;let r=this._appState.getActiveCanvas();if(!(this._appState.prototypeStructure().currentType()==0)||this._appState.storedPrototypeDevice().type=="PRESENTATION"||this._appState.storedPrototypeDevice().type=="NONE"){let a=t==null?!1:t.overflowDirection()=="BOTH"||t.overflowDirection()=="HORIZONTAL",s=t==null||t==r||!a;if(X.getViewerMode()==X.ViewerMode.PROTOTYPE&&Math.abs(n.x())>Math.abs(n.y())&&s)return n.x()>0?this.navigateBackward(18):this.navigateForward(19),!0}return!1}handleInteractionsForRelease(t,n,r){let o=this._lastPressData;if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return _e.WasHandled.HANDLED;X.getFeatureFlags().prototypeNewMouseEvents?this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"):this._maintainedDataLegacy.interaction()=="MOUSE_DOWN"&&this._maintainedDataLegacy.reset();let a=this._appState.prototypeState().isDragging(),s=this._viewport.viewSpaceToCanvasSpace1().transformPoint(t.clone());if(this._interactionObservers.forEach(p=>{p.handleRelease(s)}),a)return this._appState.prototypeState().setIsDragging(!1),_e.WasHandled.HANDLED;let l=this._handleMouseUp(t);l==_e.WasHandled.NOT_HANDLED&&n&&(l=this._handleClick(t)),l==_e.WasHandled.NOT_HANDLED&&(l=this._handleReversePress(o));let d=l==_e.WasHandled.NOT_HANDLED,c=r==_e.WasHandled.NOT_HANDLED;return d&&c&&fa.notifyUnhandledMouseRelease(this._appState,s),l}_handleMouseUp(t){if(!this._appState.prototypeState().interactionsEnabled())return _e.WasHandled.HANDLED;let n=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_UP");if(n==null)return _e.WasHandled.NOT_HANDLED;let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n.node,Kt.TransitionAction_mapToInteractionType(9));return this._triggerOrHandleMaintainedInteractions(r,n,9,t)}_handleReversePress(t){if(!this._appState.prototypeState().interactionsEnabled()||this._multiplayer.isObserving())return _e.WasHandled.HANDLED;if(t==null)return _e.WasHandled.NOT_HANDLED;if(t.swappedStablePath!=null)return this._appState.prototypeState().returnInstanceToState(t.swappedStablePath,2,7),_e.WasHandled.HANDLED;{let n=t.hotspotStablePath!=null?this._retrieveReverseInteractionHotspotFromStoredData(t.hotspotStablePath):null,r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n,Kt.TransitionAction_mapToInteractionType(3));for(let o of r)return this.requestBack(n,o,2,7,null,null),_e.WasHandled.HANDLED}return _e.WasHandled.NOT_HANDLED}_handleClick(t){if(this.disengageObservationMode(),!this._appState.prototypeState().interactionsEnabled())return _e.WasHandled.HANDLED;let n=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_CLICK");if(n!=null){let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n.node,Kt.TransitionAction_mapToInteractionType(4));for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];if(this.triggerHotspot(n,s,4,t),o+1<r.length){let l=r[o+1];this._shouldTriggerVariantInteractionWithMediaAction(s,l)&&this.triggerHotspot(n,l,4,t)}return _e.WasHandled.HANDLED}}if(this._shouldCloseTopmostOverlayOnClickOutside(t)){let r=this._appState.prototypeState().getCurrentOverlayData().length-1;return this._appState.prototypeState().closeOverlayAtAndAbove(r,1),_e.WasHandled.HANDLED}return _e.WasHandled.NOT_HANDLED}performHotspotAnimationOnClick(){this._hotspotAnimation.onClick()}handleInteractionsForDrag(t){if(X.getFeatureFlags().prototypeNewMouseEvents){let r=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_DOWN");this._maintainedData.resetAllEntriesMatchingPredicate((o,a)=>a=="MOUSE_DOWN"&&!ne.equals(r!=null?r.node.id():null,o))}else if(this._maintainedDataLegacy.interaction()=="MOUSE_DOWN"){let r=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_DOWN");ne.equals(r!=null?r.node.id():null,this._maintainedDataLegacy.delayedHotspotId())||this._maintainedDataLegacy.reset()}let n=this._viewport.viewSpaceToCanvasSpace1().transformPoint(t.clone());this._interactionObservers.forEach(r=>{r.handleDrag(n)})}handleDragStart(t,n,r){if(!this._appState.prototypeState().interactionsEnabled()||this._appState.prototypeState().isDragging())return _e.WasHandled.HANDLED;if(n==null)return _e.WasHandled.NOT_HANDLED;let o=this._appState.prototypeStructure().findPrototypeInteractionWithId(n!=null?n.id():null,r);if(o==null)return _e.WasHandled.NOT_HANDLED;this.triggerHotspot(new Bo(n),o,5,t),this._appState.prototypeState().setIsDragging(!0);let a=this._viewport.viewSpaceToCanvasSpace1().transformPoint(t.clone());return this._interactionObservers.forEach(s=>{s.handleDragStart(a)}),_e.WasHandled.HANDLED}handleInteractionsForScroll(){this.handleScrollAndFindNewNodeToScroll(null)}handleScrollAndFindNewNodeToScroll(t){if(X.getFeatureFlags().prototypeNewMouseEvents?this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"):this._maintainedDataLegacy.interaction()=="MOUSE_DOWN"&&this._maintainedDataLegacy.reset(),this._lastPressData!=null){if(t==null)return null;let n=t==this._appState.baseScreenNode();this._handleReversePress(this._lastPressData),this._lastPressData=null;let r=this._appState.baseScreenNode();if(r==null)return null;if(n)return this._appState.baseScreenNode();{let o=r.scrollableFrameDescendants();return _e.findMatchingTransitionNode(t,o)}}return t}handleFling(t,n){var d;let r=n.length,o=Qe.seconds(),a=this._appState.getActiveCanvas();if(a==null)return _e.WasHandled.NOT_HANDLED;if(!this._appState.prototypeState().interactionsEnabled())return _e.WasHandled.HANDLED;let s=(d=a.scene())==null?void 0:d.findNode1(t),l=50*mr();this._initialFlingVelocity=new E(0,0);for(let c=r-1;c>=0;c=c-1)if(c==0||o-n[c-1].startTime>.1){let p=n[c],u=n[r-1],h=u.startLocation.subtract1(p.startLocation).divide(u.startTime-p.startTime),f=h.length(),_=Math.log(1+f)/5,m=f*_/5,A=h.multiply(m/f);if(p!=u&&f>l){if(X.getFeatureFlags().swipePresentation&&this.maybeAdvanceViaSwipeGesture(s,h))break;if(s==null||s==a)this._viewport.flingCameraOffset(A,_);else{this._initialFlingVelocity=this.restrictScrollDeltaAxes(s,h).negative();let y=_e._scrollPhysics.createBallisticScrollSimulation(s.scrollOffset(),this._initialFlingVelocity,s.minScrollOffsetX(),s.maxScrollOffsetX(),s.minScrollOffsetY(),s.maxScrollOffsetY());return y!=null&&(_e._scrollAnimationManager=new Zl(y,s.id())),_e.WasHandled.HANDLED}}break}return _e.WasHandled.NOT_HANDLED}handleInteractionsForLeave(){X.getFeatureFlags().prototypeNewMouseEvents?(this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"),this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_IN")):(this._maintainedDataLegacy.interaction()=="MOUSE_DOWN"||this._maintainedDataLegacy.interaction()=="MOUSE_IN")&&this._maintainedDataLegacy.reset(),this.handleInteractionsForMove(ve.FrozenVector_new4(-1,-1))}handleInteractionsForKeyPress(t){let n=this._appState.prototypeState().getTopmostScreen(),r=this._appState.prototypeStructure().findHotspotsWithInteractionType(n,0,"ON_KEY_DOWN"),o=this._createListFromKeyEvent(t),a=l=>(l=Xe.current()!=4&&l==this.META_CODE?this.CONTROL_CODE:l,o.some(d=>d.indexOf(l)!=-1)),s=l=>{let d=l.event().keyTrigger().triggerDevice=="KEYBOARD",c=l.event().keyTrigger().keyCodes;if(c==null)return!1;let p=c.length==o.length;return d&&p&&c.every(a)};for(let l of r){let c=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(l.node,Kt.TransitionAction_mapToInteractionType(14)).filter(s);for(let p=0,u=c.length;p<u;p=p+1){let h=c[p];if(this.triggerHotspot(l,h,14,null),p+1<c.length){let f=c[p+1];this._shouldTriggerVariantInteractionWithMediaAction(h,f)&&this.triggerHotspot(l,f,14,null)}return t.accept(),_e.WasHandled.HANDLED}}return _e.WasHandled.NOT_HANDLED}_createListFromKeyEvent(t){let n=[];return 1&t.modifiers()&&n.push([this.ALT_CODE]),4&t.modifiers()&&n.push([this.SHIFT_CODE]),2&t.modifiers()&&n.push([this.META_CODE]),8&t.modifiers()&&n.push([this.CONTROL_CODE]),Hc.Key_isModifier(t.key)||n.push(Hc.Key_keyToKeyCode(t.key)),n}handleInteractionsForGamepadDown(t){let n=this._appState.prototypeState().getTopmostScreen(),r=a=>{let s=a.event().keyTrigger().triggerDevice!="KEYBOARD";return a.event().keyTrigger().keyCodes==null?!1:s&&a.event().keyTrigger().keyCodes.indexOf(t.button)!=-1},o=this._appState.prototypeStructure().findHotspotsWithInteractionType(n,0,"ON_KEY_DOWN");for(let a of o){let l=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(a.node,Kt.TransitionAction_mapToInteractionType(14)).filter(r);for(let d=0,c=l.length;d<c;d=d+1){let p=l[d];if(this.triggerHotspot(a,p,14,null),d+1<l.length){let u=l[d+1];this._shouldTriggerVariantInteractionWithMediaAction(p,u)&&this.triggerHotspot(a,u,14,null)}return t.accept(),_e.WasHandled.HANDLED}}return _e.WasHandled.NOT_HANDLED}addInteractionObserver(t){this._interactionObservers.add(t)}removeInteractionObserver(t){this._interactionObservers.remove(t)}_hotspotAtViewportSpacePointWithInteractionType(t,n,r){if(!this._appState.prototypeState().getTransitionOnClick())return null;let o=this._canvasSpacePoint(t);return this._hotspotAtCanvasSpacePointWithInteractionType(o,n,r)}_hotspotAtCanvasSpacePointWithInteractionType(t,n,r){let o=this._appState.baseScreenNode();if(o==null||!o.canvasSpaceBoundingBox().contains2(t)&&n!="MOUSE_OUT")return null;let a=this._appState.prototypeState(),s=a.getTopmostOverlayNode();if(s!=null){let l=a.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(o,t);return this._appState.prototypeStructure().hotspotOnPresentedNode(s,l,n,r)}else return this._appState.prototypeStructure().hotspotOnPresentedNode(o,t,n,r)}_canvasSpacePointInPreviousFrame(t,n,r){if(t==n)return r;let o=n.absoluteTransform().clone();if(!o.invert())return r;let a=t.absoluteTransform(),s=r.clone();return o.transformPoint(s),a.transformPoint(s),s}updateUserCursor(t){this._currentMouseLocation=t==null?void 0:t.locationInView(this),this._sendMouseCursorUpdate()}_shouldCloseTopmostOverlayOnClickOutside(t){let n=this._appState.prototypeState().getTopmostOverlay(),r=this._appState.prototypeState().getTopmostOverlayNode(),o=this._appState.baseScreenNode();if(o==null||r==null||n.backgroundInteraction()!="CLOSE_ON_CLICK_OUTSIDE")return!1;let a=this._canvasSpacePoint(t),s=n.baseTlfSpaceToOverlaySpace1(o,a);return!r.canvasSpaceBoundingBox().contains2(s)}recordViewportSpaceClick(t){let n=this._canvasSpacePoint(t);n!=null&&this._multiplayer.recordCanvasSpaceClick(n)}_sendMouseCursorUpdate(){if(this._currentMouseLocation==null)this._multiplayer.setCanvasSpaceMouse(null);else{let t=this._canvasSpacePoint(this._currentMouseLocation);t!=null&&this._multiplayer.setCanvasSpaceMouse(t)}}triggerMouseAction(t,n){this._appState.triggerAction2(t,$.new9(n))}_triggerOrHandleMaintainedInteractions(t,n,r,o){for(let a=0,s=t.length;a<s;a=a+1){let l=_e.WasHandled.NOT_HANDLED,d=t[a];if(d.event().interactionMaintained()?(this._handleMaintainedInteraction(n,d,r),l=_e.WasHandled.MAINTAINED):(this.triggerHotspot(n,d,r,o),l=_e.WasHandled.HANDLED),a+1<t.length){let c=t[a+1];this._shouldTriggerVariantInteractionWithMediaAction(d,c)&&(d.event().interactionMaintained()?(this._handleMaintainedInteraction(n,c,r),l=_e.WasHandled.MAINTAINED):(this.triggerHotspot(n,c,r,o),l=_e.WasHandled.HANDLED))}return l}return _e.WasHandled.NOT_HANDLED}_shouldTriggerVariantInteractionWithMediaAction(t,n){let r=t.allActions().length>=1&&t.allActions().every(d=>d.connectionType()=="UPDATE_MEDIA_RUNTIME"),o=t.allActions().length>=1&&t.allActions().every(d=>ne.isValid(d.transitionNodeID())),a=n.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),s=a!=null&&a.connectionType()=="INTERNAL_NODE",l=r&&o&&s;return l&&X.getFeatureFlags().prototypeLogVideoAndICSwap&&Be.trackEvent1("prototype_interaction_conflict_override_triggered",new Map([["interaction_type",t.event().interactionType()],["action_type",t.actions().map(d=>d.mediaAction())]])),l}getRelevantOS(){return this._appState.getActiveCanvas()==null?0:_e._getRelevantOSForDevice(this._appState.getActiveCanvas().prototypeDevice())}_resetScrollForTlf(t){if(t!=null){this.updateScrollOffsetForNode(t,ve.FrozenVector_ZERO);let n=t.scrollableFrameDescendants();for(let r of n)this.updateScrollOffsetForNode(r,ve.FrozenVector_ZERO)}}getBestScrollOrDragProposal(t,n,r){let o=this._appState.getActiveCanvas();if(o==null)return null;if(this._appState.currentFitMode()==3&&this._viewport.zoomScale()!=1)return new _e.ScrollOrDragProposal(_e.ScrollOrDragProposal.InteractionType.SCROLL,1,o==null?void 0:o.id(),null);let a=this._canvasSpacePoint(n);if(a==null||this._appState.baseScreenNode()==null)return null;let s=null;t==_e.ScrollOrDragQuerySet.SCROLL_OR_DRAG&&(s=(d,c)=>_n.computeDragVector1(d,c,this._appState.baseScreenNode(),this._appState.prototypeStructure(),this._appState.prototypeState()));let l=this._appState.prototypeState().getCurrentOverlays();for(let d=0,c=l.length;d<c;d=d+1){let p=l[l.length-d-1],u=p.node();if(u==null)continue;let h=p.baseTlfSpaceToOverlaySpace1(this._appState.baseScreenNode(),a);if(!u.canvasSpaceBoundingBox().contains2(h)){if(p.backgroundAppearance().backgroundType=="SOLID_COLOR")return null;continue}let f=_e.findBestScrollOrDragProposalInFrame(o,h,r,u,this._appState.activePrototypeDevice(),s);return ne.equals(f==null?void 0:f.targetNodeId,o==null?void 0:o.id())?null:f}return _e.findBestScrollOrDragProposalInFrame(o,a,r,this._appState.baseScreenNode(),this._appState.activePrototypeDevice(),s)}_updateForAnimation(){if(_e._scrollAnimationManager==null)return;let t=!_e._scrollAnimationManager.isValid(this._appState.scene());t||(_e._scrollAnimationManager.performScroll(this,this._appState.scene()),t=_e._scrollAnimationManager.isDone()),t&&(this.cancelAnimationManager(),this._sequentialActionManager.runNextAction())}cancelAnimationManager(){_e._scrollAnimationManager=null}maybeHandleOverdragRelease(){var r;if(_e._overscrolledNodeID==null)return;let t=(r=this._appState.scene())==null?void 0:r.findNode1(_e._overscrolledNodeID);_e._overscrolledNodeID=null,!(t==null||_e.clampScrollOffsetForNode(t,t.scrollOffset()).equals(t.scrollOffset()))&&(_e._scrollAnimationManager=new Zl(new yl(t.scrollOffset(),new E(0,0),t.minScrollOffsetX(),t.maxScrollOffsetX(),t.minScrollOffsetY(),t.maxScrollOffsetY()),t.id()))}setPhysicsForOS(t){switch(fg(t)){case 0:{_e._scrollPhysics=new qc;break}case 1:{_e._scrollPhysics=new Yc;break}case 2:{_e._scrollPhysics=new gl;break}}}_maybeChangePhysicsForDevice(t){let n=this.getRelevantOS(),r=_e._getRelevantOSForDevice(t);n!=r&&this.setPhysicsForOS(n)}updateScrollOffsetForNode(t,n){let r=_e.clampScrollOffsetForNode(t,n),o=this.restrictScrollDeltaAxes(t,n),a=this._pointerEventDelegate.isDragging();if(t.scrollOffset().equals(r)&&(!a||t.scrollOffset().equals(n)))return!1;if(a&&!r.equals(n)){let l=_e._scrollPhysics.applyOverscrollBehavior(o,r,t.scrollOffset(),t.size());l.equals(r)||(_e._overscrolledNodeID=t.id(),r=l)}t.setScrollOffset(r),this._observers.forEach(l=>{l.didScrollNode(t)}),this._emitter.trigger("scrollNode",t.id());let s=t.id();return this._multiplayer.setScrollPosition(s,t.scrollOffset()),!0}setScrollOffsetUnconditionally(t,n){t.setScrollOffset(n);let r=t.id();this._multiplayer.setScrollPosition(r,n)}restrictScrollDeltaAxes(t,n){let r=n.clone();switch(t.scrollDirection()){case"HORIZONTAL":{r.setY(0);break}case"VERTICAL":{r.setX(0);break}case"NONE":{r.setX(0),r.setY(0);break}case"BOTH":{let o=null;switch(t.overflowDirection()){case"NONE":{o="NONE";break}case"HORIZONTAL":{o="HORIZONTAL";break}case"VERTICAL":{o="VERTICAL";break}case"BOTH":{o="BOTH";break}}!hr.scrollsHorizontally(o)&&!t.hasOverflowingContentInXDirection()&&r.setX(0),!hr.scrollsVertically(o)&&!t.hasOverflowingContentInYDirection()&&r.setY(0);break}}return r}scrollToDestinationInFrame(t,n){let r=this._appState.scene().findNode1(t),o=r.parent();for(;o!=null&&!((o.scrollDirection()!="NONE"||o.isTopLevel())&&!o.isTooRotatedToScroll());)o=o.parent();if(o!=null){let a=n.action().value;for(let d of n.getAllActionsWithSpecificTransitionType("SCROLL_ANIMATE"))a=d;let s=ar.fromPrototypeAction(a,X.getFeatureFlags().prototypeStateManagement?n.stateManagementVersion():0),l=r.absoluteTransform().translation().add1(s.extraScrollOffset).subtract1(o.absoluteTransform().translation());if(a.transitionType()=="SCROLL_ANIMATE"){let d=_e.clampScrollOffsetForNode(o,l);_e._scrollAnimationManager=new Zl(new Xc(o.scrollOffset(),d,s.transitionDuration,s.easingFunction),o.id())}else this.updateScrollOffsetForNode(o,l)}}scrollNode(t,n,r){var l,d;let o=(l=this._appState.scene())==null?void 0:l.findNode1(t);if(o==null)return!1;if(_e._scrollAnimationManager!=null&&_e._scrollAnimationManager.isOverscrolled()){let c=_e._scrollAnimationManager;if(o.id()!=c.nodeID()){let p=(d=this._appState.scene())==null?void 0:d.findNode1(c.nodeID());p!=null&&p.setScrollOffset(c.simulation().endPos())}this.cancelAnimationManager()}else _e._scrollAnimationManager!=null&&n!=_e.ScrollSource.FLING&&this.cancelAnimationManager();if(o.isTooRotatedToScroll()||o.scrollDirection()=="NONE")return!1;let a=o.scrollOffset().clone();o.scrollDirection()=="HORIZONTAL"?a.setX(a.x()+(r.x()==0&&n==_e.ScrollSource.SCROLL_EVENT?r.y():r.x())):a.addUpdate1(r);let s=this.updateScrollOffsetForNode(o,a);return this.disengageObservationMode(),s}_updateScrollOffsetsFromMultiplayer(){var n;let t=this._multiplayer.getScrollPositions();if(t!=null)for(let r of Array.from(t.keys())){let o=ne.fromString(r),a=(n=this._appState.scene())==null?void 0:n.findNode1(o);a!=null&&a.setScrollOffset(t.get(r))}}_clampDirtyScrollContainers(){let t=this._appState.scene();if(t==null)return;let n=new Set;for(let r of Array.from(_e._dirtyNodesForScrollClamping.values())){let o=t.findNode2(r);for(let a=o;a!=null&&!(n.has(a.id())||a!=o&&un.isFrameLike(a.type())&&a.clipsToBoundingRectangle());a=a.parent())a.scrollDirection()!="NONE"&&this.updateScrollOffsetForNode(a,a.scrollOffset()),n.add(a.id())}_e._dirtyNodesForScrollClamping=new Set}_handleScrollingPropertyChange(t,n,r,o){if(n==34)t.setScrollOffset(ve.FrozenVector_ZERO);else if(n==49||n==24)_e._dirtyNodesForScrollClamping.add(t.id());else if(n==66){let a=this._appState.baseScreenNode();a!=null&&this.updateScrollOffsetForNode(a,a.scrollOffset())}else n==88&&(this._renderer.updateScroll(t),this._emitter.trigger("scrollEvent",null))}renderLayerByLayerActivate(){this._renderer.renderLayerByLayerActivate(()=>{this.viewport().invalidate()})}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}static findBestScrollOrDragProposalInTree(t,n,r,o,a){let s=o==0,l=null;return l=(d,c)=>{var g,b,T;let p=d.canvasSpaceGeometryBounds().contains2(c),u=d.canvasSpaceBoundingBox().contains2(c);if(d.clipsToBoundingRectangle()&&!p&&!u)return null;let h=null;for(let I=0,O=d.childCount();I<O;I=I+1){let w=d.childAt2(d.childCount()-I-1,!0),P=c,H=X.getFeatureFlags().prototypeTemporaryStickyScroll?Li.getScrollTranslationOfNodeRelativeToParent1(w):Li.getScrollOffsetOfNodeFromParent_DEPRECATED(w);P=c.add1(H);let re=l(w,P);h=(g=h==null?void 0:h.updateToBestProposal1(re))!=null?g:re}let f=d.scrollDirectionWithScrollableContent(),_=u||p,m=f!="NONE"&&_&&!d.isInvisibleOrTransparent(),A=_&&d.visible()&&d.prototypeInteractions().some(I=>I.event().interactionType()=="DRAG"&&I.allActions().some(O=>Ad.isValidForConnection(I.event().interactionType(),O.connectionType()))),y=n.length()>0?n.divide(n.length()):n,S=null;if(_){if(m){let I=tb(f),O=_e.ScrollOrDragProposal.InteractionType.OVERSCROLL;Math.abs(y.y())>0&&Math.abs(I.y())>0&&(y.y()>0?d.scrollOffset().y()<d.maxScrollOffsetY():d.scrollOffset().y()>d.minScrollOffsetY())&&(O=_e.ScrollOrDragProposal.InteractionType.SCROLL),Math.abs(y.x())>0&&Math.abs(I.x())>0&&(y.x()>0?d.scrollOffset().x()<d.maxScrollOffsetX():d.scrollOffset().x()>d.minScrollOffsetX())&&(O=_e.ScrollOrDragProposal.InteractionType.SCROLL);let w=hr.getDirectionSimilarity(f,y);(O==_e.ScrollOrDragProposal.InteractionType.SCROLL||s)&&(S=new _e.ScrollOrDragProposal(O,w,d.id(),null))}if(a!=null&&A){let I=y.multiply(-1);for(let O of d.prototypeInteractions().filter(w=>w.event().interactionType()=="DRAG")){let w=a(d,O),P=w!=null?I.dot(w.divide(w.length())):0;S=(b=S==null?void 0:S.updateToBestProposal2(_e.ScrollOrDragProposal.InteractionType.DRAG,P,d.id(),O.id()))!=null?b:new _e.ScrollOrDragProposal(_e.ScrollOrDragProposal.InteractionType.DRAG,P,d.id(),O.id())}}}return S=(T=h==null?void 0:h.updateToBestProposal1(S))!=null?T:S,S},l(r,t)}static _canvasSpaceBoundsOfDeviceBackground(t,n){let r=Gr.infoForDevice(n);if(r==null)return Jn.FrozenRect_EMPTY;let o=t.canvasSpaceBoundingBox().topLeft(),a=n.canvasSpaceFramePresetSize(r);return new U(o.x(),o.y(),a.x(),a.y())}static findBestScrollOrDragProposalInFrame(t,n,r,o,a,s){if(o==null)return null;let l=a!=null&&ba.hasDevice(a.type),d=fg(_e._getRelevantOSForDevice(a)),c=Math.abs(r.y())>Math.abs(r.x())?"VERTICAL":"HORIZONTAL",p=o.scrollsInPreferredDirection(c)&&o.hasOverflowingContentInScrollDirection();if(o.canvasSpaceBoundingBox().contains2(n)){let u=_e.findBestScrollOrDragProposalInTree(n,r,o,d,s);if(u!=null)return u;if(l)return null}else if(l){if(_e._canvasSpaceBoundsOfDeviceBackground(o,a).contains2(n))return null}else if(p)return new _e.ScrollOrDragProposal(_e.ScrollOrDragProposal.InteractionType.SCROLL,1,o.id(),null);return new _e.ScrollOrDragProposal(_e.ScrollOrDragProposal.InteractionType.SCROLL,1,t==null?void 0:t.id(),null)}static copyScrollOffset(t,n,r){n!=null&&r!=null&&(t==null?r.setScrollOffset(n.scrollOffset()):t.updateScrollOffsetForNode(r,n.scrollOffset()))}static findMatchingTransitionNode(t,n){let r=n.filter(d=>d.name()==t.name());if(r.length==1)return r[0];let o=t.canvasSpaceBoundingBox(),a=n.filter(d=>d.canvasSpaceBoundingBox().size().approximatelyEquals(o.size(),1));if(a.length==0)return null;if(a.length==1)return a[0];let s=t.topLevelAncestor(),l=o.topLeft();s!=null&&l.subtractUpdate1(s.canvasSpaceBoundingBox().topLeft());for(let d of a){let c=d.canvasSpaceBoundingBox().topLeft(),p=d.topLevelAncestor();if(p!=null&&c.subtractUpdate1(p.canvasSpaceBoundingBox().topLeft()),l.approximatelyEquals(c,1))return d}return null}static matchNodesAndPreserveScroll(t,n,r){if(!ne.equals(r.oldStateId(),r.newStateId())){let s=n.lastNodeForBaseScreen(),l=n.nextNodeForBaseScreen();_e.findMatchingNodesAndPreserveScroll(t,s,l)}let o=r.oldStateAndOverlays.overlays,a=r.newStateAndOverlays.overlays;for(let s=0,l=Math.min(o.length,a.length);s<l;s=s+1)if(!ne.equals(o[s].id,a[s].id)){let d=n.lastNodeForOverlayAt(s),c=n.nextNodeForOverlayAt(s);_e.findMatchingNodesAndPreserveScroll(t,d,c)}}static findMatchingNodesAndPreserveScroll(t,n,r){if(n!=null&&r!=null){_e.copyScrollOffset(t,n,r);let o=n.scrollableFrameDescendants(),a=r.scrollableFrameDescendants();for(let s of o){if(a.length==0)break;let l=_e.findMatchingTransitionNode(s,a);l!=null&&(_e.copyScrollOffset(t,s,l),ce.List_removeOne(a,l))}}}static clampScrollOffsetForNode(t,n){if(t.scrollDirection()=="NONE")return ve.FrozenVector_ZERO.clone();let r=E.new2();return t.scrollDirection()=="HORIZONTAL"?r.setX(fn.Math_clamp1(n.x(),t.minScrollOffsetX(),t.maxScrollOffsetX())):t.scrollDirection()=="VERTICAL"?r.setY(fn.Math_clamp1(n.y(),t.minScrollOffsetY(),t.maxScrollOffsetY())):t.scrollDirection()=="BOTH"&&(r.setX(fn.Math_clamp1(n.x(),t.minScrollOffsetX(),t.maxScrollOffsetX())),r.setY(fn.Math_clamp1(n.y(),t.minScrollOffsetY(),t.maxScrollOffsetY()))),r}static _getRelevantOSForDevice(t){return Xe.current()==2||Xe.current()==1||t==null?Xe.current():t.os()==2||t.os()==1?t.os():Xe.current()}};_e._scrollPhysics=new gl,_e._scrollAnimationManager=null,_e._overscrolledNodeID=null,_e._dirtyNodesForScrollClamping=new Set;var Ya=_e;(l=>{class i{constructor(c){this._canvasView=null,this._dragStart=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1,this._activeScrollOrDrag=null,this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._currentTimeoutForMouseMove=0,this._lastPointerPressHandled=0,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0,this._canvasView=c}unlockScroll(){this._lastScrollEvent=0,this._scrollingNodeId=null}resetStateForTests(){this._resetDragInfo(),this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._lastPointerPressHandled=0,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0}isDragging(){return this._isDragging}_handleSinglePointerPress(c,p){let u=c.locationInView(this._canvasView);this._canvasView.triggerMouseAction(p,u),this._dragStart=u,this._isDragGestureConfirmed=!1,this._canvasView.recordViewportSpaceClick(this._dragStart),c.accept(),this._flingPoints=[],this._currentGesture=new Eh(u,Qe.seconds(),c.interactionType()),this._lastPointerPressHandled=this._canvasView.handleInteractionsForPress(u),this._lastPointerPressHandled!=0&&(this._lastPointerPressHandledAt=Qe.seconds())}onMousePress(c){this._handleSinglePointerPress(c,6),this._canvasView.cancelAnimationManager()}onTouchPress(c){this._canvasView.cancelAnimationManager(),c.touches.length==1?this._handleSinglePointerPress(c,10):c.accept()}_processPointerRelease(c){var S;if(!this._canvasView.appState().prototypeState().interactionsEnabled())return!1;let p=this._isDragGestureConfirmed,u=!p&&this._lastPointerPressHandled!=2,h=p&&this._lastPointerPressHandled==1&&(this._activeScrollOrDrag==null||this._activeScrollOrDrag.interactionType==l.ScrollOrDragProposal.InteractionType.DRAG),f=u||h,_=this._canvasView.handleInteractionsForRelease(c,f,this._lastPointerPressHandled);return(this._isDragging?this._canvasView.handleFling((S=this._activeScrollOrDrag)==null?void 0:S.targetNodeId,this._flingPoints):0)==0&&this._canvasView.maybeHandleOverdragRelease(),!p&&_==0&&this._lastPointerPressHandled==0&&this._canvasView.performHotspotAnimationOnClick(),!p&&this._canvasView.appState().scene()!=null&&X.getViewerMode()==X.ViewerMode.MIRROR&&this._canvasView.appState().triggerAction1(5),this._canvasView.updateCursorType(c,null),this._resetDragInfo(),p||_==1||this._lastPointerPressHandled==1}_storeOrProcessPointerReleaseAtPoint(c){if(Qe.seconds()-this._lastPointerPressHandledAt<Jw)this._storedPointerReleasePoint=c;else if(this._processPointerRelease(c))return 1;return this._lastPointerPressHandledAt=0,0}onMouseRelease(c){let p=c.locationInView(this._canvasView);this._canvasView.triggerMouseAction(9,p),this._storeOrProcessPointerReleaseAtPoint(p)}onTouchRelease(c){c.touches.length==0&&this._currentGesture!=null?(this._currentGesture!=null&&(this._currentGesture.endTime=Qe.seconds(),this.isSingleTap()?this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation)==0&&this._canvasView.appState().prototypeState().getTransitionOnClick()&&this._canvasView.maybeHandleSingleTapAsNavigation(this._currentGesture.endLocation):this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation)),this._resetDragInfo()):c.touches.length==0&&this._canvasView.maybeHandleOverdragRelease(),this._previousGesture=this._currentGesture,this._currentGesture=null}_resetDragInfo(){this._dragStart=null,this._activeScrollOrDrag=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1}onDrag(c){var u;let p=c.locationInView(this._canvasView);if(this._isDragging=!0,this._dragStart!=null&&!this._isDragGestureConfirmed&&(this._isDragGestureConfirmed=c.interactionCount()>1||p.distanceTo(this._dragStart)>Xw),this._dragStart!=null&&this._isDragGestureConfirmed&&!this._isDragInteractionLocked){let h=p.subtract1(this._dragStart).multiply(-1);this._activeScrollOrDrag=this._canvasView.getBestScrollOrDragProposal(1,this._dragStart,h)}if(!this._canvasView.appState().prototypeState().isDragging()){if(this._isDragGestureConfirmed&&X.getDragToPan()&&this._activeScrollOrDrag!=null){let h=c.delta(),f=(u=this._canvasView.appState().scene())==null?void 0:u.findNode1(this._activeScrollOrDrag.targetNodeId);switch(this._activeScrollOrDrag.interactionType){case l.ScrollOrDragProposal.InteractionType.SCROLL:case l.ScrollOrDragProposal.InteractionType.OVERSCROLL:{if(f!=null&&f!=this._canvasView.appState().getActiveCanvas()){if(this._canvasView.scrollNode(f.id(),1,h.negative().divide(this._canvasView.viewport().zoomScale()))){this._lastPointerPressHandled=1,this._isDragInteractionLocked=!0;let m=this._canvasView.handleScrollAndFindNewNodeToScroll(f);m==null&&Ke("new scroll node is null"),this._activeScrollOrDrag.targetNodeId=m==null?void 0:m.id()}}else this._canvasView.viewport().panCamera(h);break}case l.ScrollOrDragProposal.InteractionType.DRAG:{this._lastPointerPressHandled=this._canvasView.handleDragStart(p,f,this._activeScrollOrDrag.targetInteractionId),this._isDragInteractionLocked=!0;break}}c.interactionCount()!=1?this._currentGesture=null:this._currentGesture!=null&&(this._flingPoints.push(new Eh(p,Qe.seconds(),c.interactionType())),this._currentGesture.endLocation=p,this._currentGesture.endTime=Qe.seconds())}}this._canvasView.idlenessTracker().handleInteraction(),this._canvasView.handleInteractionsForDrag(p),c.interactionType()==0&&(this._canvasView.updateUserCursor(c),this._canvasView.triggerMouseAction(8,p))}onMouseScroll(c){var _;let p=this._canvasView.appState().getActiveCanvas();if(p==null)return;let u=Qe.seconds();u-this._lastScrollEvent>nv&&(this._scrollingNodeId=null);let h=c.locationInView(this._canvasView),f=this._canvasView.appState().activePrototypeDevice()!=null&&ba.hasDevice(this._canvasView.appState().activePrototypeDevice().type);if((8&c.modifiers()||2&c.modifiers())&&vs.FitMode_userCanManuallyZoom(this._canvasView.appState().prototypeState().getCurrentFitMode(),f))this._canvasView.viewport().adjustCameraZoomWithPin(Math.pow(.99,c.scrollDelta.y()),h.subtract1(this._canvasView.viewport().viewSpaceBounds().topLeft())),c.accept(),this._canvasView.userDidAttemptZoom!=null&&this._canvasView.userDidAttemptZoom(1);else{let m=(_=p.scene())==null?void 0:_.findNode1(this._scrollingNodeId);if(m==null){let A=this._canvasView.getBestScrollOrDragProposal(0,h,c.scrollDelta);m=this._canvasView.appState().scene().findNode1(A==null?void 0:A.targetNodeId),this._scrollingNodeId=m==null?void 0:m.id()}if(m!=null)if(m!=p){if(this._canvasView.scrollNode(this._scrollingNodeId,0,c.scrollDelta.divide(this._canvasView.viewport().zoomScale())))if(this._canvasView.handleInteractionsForScroll(),X.optimizationExposureLogging()&&Un.didEncounterDebounceScrollHover(),X.debounceMouseMoveScrolling()){let y=()=>{c.locationInView(this._canvasView).distanceTo(h)<.001&&this._canvasView.handleInteractionsForMove(h)};clearTimeout(this._currentTimeoutForMouseMove),this._currentTimeoutForMouseMove=setTimeout(y,jw*1e3|0)}else this._canvasView.handleInteractionsForMove(h);c.accept()}else X.getScrollToPan()&&(this._canvasView.viewport().panCamera(c.scrollDelta.negative()),this._scrollingNodeId=p.id(),c.accept(),this._canvasView.handleInteractionsForMove(h))}this._lastScrollEvent=u,this._canvasView.idlenessTracker().handleInteraction()}onMouseMove(c){let p=c.locationInView(this._canvasView);this._canvasView.updateUserCursor(c),this._canvasView.triggerMouseAction(7,p),this._canvasView.handleInteractionsForMove(p),this._scrollingNodeId=null}onMouseLeave(c){this._canvasView.updateUserCursor(null),this._canvasView.handleInteractionsForLeave()}onKeyPress(c,p){let u=this._canvasView.handleInteractionsForKeyPress(c);X.isInlinePreview()&&u==0&&c.key==8&&4&c.modifiers()&&p.trigger("requestClose",{})}onGamepadDown(c){this._canvasView.handleInteractionsForGamepadDown(c)}maybeProcessStoredPointerRelease(){this._storedPointerReleasePoint!=null&&(this._processPointerRelease(this._storedPointerReleasePoint),this._storedPointerReleasePoint=null)}isSingleTap(){return this._canvasView.appState().baseScreenNode()!=null&&this._currentGesture!=null&&this._currentGesture.isTap()}}l.CanvasPointerEventDelegate=i;let e;(u=>(u[u.NOT_HANDLED=0]="NOT_HANDLED",u[u.HANDLED=1]="HANDLED",u[u.MAINTAINED=2]="MAINTAINED"))(e=l.WasHandled||(l.WasHandled={}));let t;(p=>(p[p.SCROLL_ONLY=0]="SCROLL_ONLY",p[p.SCROLL_OR_DRAG=1]="SCROLL_OR_DRAG"))(t=l.ScrollOrDragQuerySet||(l.ScrollOrDragQuerySet={}));class n{updateToBestProposal1(c){return c!=null&&this.updateToBestProposal2(c.interactionType,c.directionSimilarity,c.targetNodeId,c.targetInteractionId),this}updateToBestProposal2(c,p,u,h){return(this.interactionType==l.ScrollOrDragProposal.InteractionType.OVERSCROLL&&c==l.ScrollOrDragProposal.InteractionType.DRAG||p>this.directionSimilarity)&&(this.interactionType=c,this.directionSimilarity=p,this.targetNodeId=u,this.targetInteractionId=h),this}constructor(c,p,u,h){this.interactionType=c,this.directionSimilarity=p,this.targetNodeId=u,this.targetInteractionId=h}}l.ScrollOrDragProposal=n,(p=>{let d;(_=>(_[_.OVERSCROLL=0]="OVERSCROLL",_[_.SCROLL=1]="SCROLL",_[_.DRAG=2]="DRAG"))(d=p.InteractionType||(p.InteractionType={}));let c;(h=>{function u(f){return l.ScrollOrDragProposal.InteractionType[f]}h.InteractionType_toString=u})(c=p.in_InteractionType||(p.in_InteractionType={}))})(n=l.ScrollOrDragProposal||(l.ScrollOrDragProposal={}));let r;(u=>(u[u.SCROLL_EVENT=0]="SCROLL_EVENT",u[u.DRAGGING=1]="DRAGGING",u[u.FLING=2]="FLING"))(r=l.ScrollSource||(l.ScrollSource={}));let o;(c=>{function d(p){return l.WasHandled[p]}c.WasHandled_toString=d})(o=l.in_WasHandled||(l.in_WasHandled={}));let a;(c=>{function d(p){return l.ScrollOrDragQuerySet[p]}c.ScrollOrDragQuerySet_toString=d})(a=l.in_ScrollOrDragQuerySet||(l.in_ScrollOrDragQuerySet={}));let s;(c=>{function d(p){return l.ScrollSource[p]}c.ScrollSource_toString=d})(s=l.in_ScrollSource||(l.in_ScrollSource={}))})(Ya||(Ya={}));var Eh=class{constructor(e,t,n){this.startLocation=null,this.startTime=0,this.endLocation=null,this.endTime=0,this.type=0,this.startLocation=e,this.startTime=t,this.endLocation=e,this.endTime=t,this.type=n}isTap(){return(this.endLocation==null||this.startLocation.distanceTo(this.endLocation)<$w)&&this.endTime-this.startTime<Zw}},ZI;(e=>{function i(t){return Vd[t]}e.RenderCallStatus_toString=i})(ZI||(ZI={}));var $I;(e=>{function i(t){return Ch[t]}e.ZoomMethod_toString=i})($I||($I={}));var JI;(e=>{function i(t){return bh[t]}e.TransitionSource_toString=i})(JI||(JI={}));var Kt;(s=>{function i(l){switch(l){case 1:case 20:case 21:case 4:case 5:case 9:case 17:case 18:case 19:return!1;case 2:case 3:case 6:case 7:case 8:case 10:case 11:case 12:case 13:return!0;default:return!1}}s.TransitionAction_isTransientAction=i;function e(l){switch(l){case 2:return 6;case 3:return 7;case 6:return 2;case 7:return 3;case 10:return 11;case 11:return 10;case 12:return 13;case 13:return 12;case 8:return 9;default:return 0}}s.TransitionAction_getOppositeTransientAction=e;function t(l){switch(l){case"TIMER":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"REVERSE_HOVER":return 6;case"REVERSE_PRESS":return 7;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_GAMEPAD_DOWN":return 15;case"ON_VOICE":return 16;case"MOBILE_NAV":return 17;case"LEFT_ARROW":return 18;case"RIGHT_ARROW":return 19;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21}return 0}s.TransitionAction_fromString=t;function n(l){return[1,18,19,20,21].indexOf(l)!=-1?0:1}s.TransitionAction_getControlSource=n;function r(l){switch(l){case"AFTER_TIMEOUT":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"DRAG":return 5;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_VOICE":return 16;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21}return Ke("fromInteractionType InteractionType not handled"),0}s.TransitionAction_fromInteractionType=r;function o(l){switch(l){case 1:return"AFTER_TIMEOUT";case 2:return"ON_HOVER";case 3:return"ON_PRESS";case 4:return"ON_CLICK";case 5:return"DRAG";case 8:return"MOUSE_DOWN";case 9:return"MOUSE_UP";case 10:return"MOUSE_IN";case 11:return"MOUSE_OUT";case 12:return"MOUSE_ENTER";case 13:return"MOUSE_LEAVE";case 14:return"ON_KEY_DOWN";case 15:return"ON_KEY_DOWN";case 16:return"ON_VOICE";case 20:return"ON_MEDIA_HIT";case 21:return"ON_MEDIA_END"}return Ke("mapToInteractionType TransitionAction not handled"),null}s.TransitionAction_mapToInteractionType=o;function a(l){return En[l]}s.TransitionAction_toString=a})(Kt||(Kt={}));var ev;(e=>{function i(t){return tv[t]}e.BaseScreenHitTestResult_toString=i})(ev||(ev={}));var Xw=5,nv=.2,jw=1.5*nv,Zw=.4,$w=50,Jw=.1;var Nh=class{constructor(e,t){this._context=null,this._bufferPool=null,this._deviceImageManager=new Gr,this._deviceFrameMaterial=null,this._deviceFrameQuad=null,this._hasPendingFrame=!1,this._context=e,this._bufferPool=t;let n=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._deviceFrameQuad=this._bufferPool.allocate(N.VertexFormat.POSITION_F4,n),this._deviceFrameMaterial=this._context.createMaterial("deviceFrame",N.VertexFormat.POSITION_F4,Z_,$_)}clearOnContextReset(){this._hasPendingFrame=!1,this._deviceImageManager.clearOnContextReset()}flush(){this._hasPendingFrame&&(N.in_Context.Context_setPremultipliedBlendState(this._context),this._context.draw(N.Primitive.TRIANGLE_STRIP,this._deviceFrameMaterial,this._deviceFrameQuad),this._hasPendingFrame=!1)}isWaitingForDeviceFrameToLoad(e){let t=Gr.infoForDevice(e);if(t==null)return!1;let n=this._deviceImageManager.getImage(t,this._context);return!n.isDecoded()&&!n.loadDidFail()}canRenderDeviceFrame(e){let t=Gr.infoForDevice(e);return t==null?!1:this._deviceImageManager.getImage(t,this._context).isDecoded()}pixelAtPosition(e,t,n){if(t==null)return C.TRANSPARENT;let r=Gr.infoForDevice(n);if(r==null)return C.TRANSPARENT;let o=this._deviceImageManager.getImage(r,this._context);if(!o.isDecoded()||o.width()<=0||o.height()<=0)return C.TRANSPARENT;let a=o.decodedData(),s=n.canvasSpaceTopLeftOffset(r),l=t.topLeft().subtract1(s),d=n.canvasSpaceImageSize(r),c=e.subtract1(l).divide1(d);switch(n.rotation){case"NONE":break;case"CCW_90":{c=new E(1-c.y(),c.x());break}default:break}let p=c.x()*r.nonRotatedImageSize.x()|0,u=c.y()*r.nonRotatedImageSize.y()|0;return a.pixelAtIndex(p,u)}drawPrototypeDeviceIfAny(e,t,n,r){if(n==null)return;let o=Gr.infoForDevice(t);if(o==null)return;let a=this._deviceImageManager.getImage(o,this._context);if(!a.isDecoded()&&!a.loadDidFail()){e.invalidate();return}if(a.width()<=0||a.height()<=0)return;let s=a.texture().width()/o.scaleFactor,l=a.texture().height()/o.scaleFactor,d=o.nonRotatedOffset,c=n.topLeft().subtract1(d),p=U.new2();p.setTo1(c.x(),c.y(),s,l);let u=oe.new2();u.copyFrom(r),u.translate2(p.x(),p.y()),t.rotation=="CCW_90"&&(u.translate1(o.nonRotatedOffset),u.rotate(-Math.PI/2),u.translate1(o.nonRotatedOffset.negative()),u.translate2(-o.nonRotatedFramePresetSize.x(),0)),u.scale4(p.width(),p.height()),N.in_Material.Material_setUniformMat32(this._deviceFrameMaterial,Tn,u),this._deviceFrameMaterial.setUniformSampler(Yt,a.texture(),0),this._hasPendingFrame=!0}};var Gd=class{constructor(e){this._dirtyNewBoundsBuilder=new Tt,this._dirtyOldBoundsBuilder=new Tt,this._onBoundsInvalidate=null,this._cachedCanvasSpaceBounds=new Map,this._dirtyNodes=new Map,this._canvasSpaceDirtyNewBounds=U.new2(),this._canvasSpaceDirtyOldBounds=U.new2(),this._onBoundsInvalidate=e}initCanvas(e){this._dirtyNodes=new Map,this._cachedCanvasSpaceBounds=new Map,e!=null&&this._initCachedBounds(e)}handleSceneGraphEvent(e){switch(e.property){case 62:case 26:case 70:case 28:case 48:case 16:case 29:case 69:case 46:case 71:case 17:case 47:case 27:case 30:case 88:break;case 20:case 21:case 34:case 66:{this.dirtyNode(e.node);break}default:{this.dirtyNode(e.node);break}}}handleImageLoaded(e){this.dirtyNode(e)}dirtyNode(e){this._dirtyNodes.set(e.id(),e.id())}invalidateDirtyTiles(e,t){if(e==null||this._dirtyNodes.size==0)return;let n=[],r=new Map;this._dirtyOldBoundsBuilder.reset(),this._dirtyNewBoundsBuilder.reset(),Le.StringMap_each(this._dirtyNodes,(o,a)=>{let s=e.scene().findNode1(a);if(s!=null&&s.type()=="CANVAS"){this._onBoundsInvalidate(null);return}let l=s==null?void 0:s.topLevelAncestor();if(l!=null){if(!l.hasBeenLoaded())return;r.set(l.id(),!0)}let d=Le.StringMap_get(this._cachedCanvasSpaceBounds,o,null),c=s==null?void 0:s.canvasSpaceRenderedBounds();if(d!=null&&this._dirtyOldBoundsBuilder.include3(d),c!=null?(this._dirtyNewBoundsBuilder.include3(c),this._cachedCanvasSpaceBounds.set(o,c)):this._cachedCanvasSpaceBounds.delete(o),t.overlayRenderData()!=null){let p=t.overlayRenderData();if(p!=null)for(let u of p.keys()){let h=p.get2(u),f=d!=null&&d.overlaps(h.bounds),_=c!=null&&c.overlaps(h.bounds);(f||_)&&r.set(h.overlayId,!0)}}}),Be.appTimerStart("invalidateNestedBackgroundBlurRenderTrees"),e.invalidateNestedBackgroundBlurRenderTrees(r,n),Be.appTimerStop("invalidateNestedBackgroundBlurRenderTrees");for(let o=0,a=n.length;o<a;o=o+1){let s=n[o];this._dirtyOldBoundsBuilder.include3(s)}this._dirtyOldBoundsBuilder.isValid()&&(this._dirtyOldBoundsBuilder.buildTo(this._canvasSpaceDirtyOldBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyOldBounds)),this._dirtyNewBoundsBuilder.isValid()&&(this._dirtyNewBoundsBuilder.buildTo(this._canvasSpaceDirtyNewBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyNewBounds)),this._dirtyNodes=new Map}_initCachedBounds(e){for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);this._cachedCanvasSpaceBounds.set(r.id(),r.canvasSpaceRenderedBounds()),this._initCachedBounds(r)}}};var li=class i{constructor(){var e,t;if(arguments.length==3){let n=arguments[0],r=arguments[1],o=arguments[2];if(this._sceneCursor=null,this._planTrees=null,this._activeCursor=null,this._activeTransitionKey=null,this._activeTransitionIndexInParent=-1,this.transitionMap=null,this._planTrees=new Map,this.transitionMap=r,n.transitioningFrom!=null){let a=n.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=a;let s=this._getOrCreateSmartAnimatePlanTreeAt(n,this._activeTransitionKey);if(s!=null){let l=this.transitionMap.get(a).progress,d=this.transitionMap.get(a).change.transitionParameters;this._activeCursor=new Xi(s,n,l,d.easingFunction);return}}this._sceneCursor=new nn(n,o),this._activeCursor=this._sceneCursor}else if(arguments.length==1){let n=arguments[0];this._sceneCursor=null,this._planTrees=null,this._activeCursor=null,this._activeTransitionKey=null,this._activeTransitionIndexInParent=-1,this.transitionMap=null,this._sceneCursor=(e=n._sceneCursor)==null?void 0:e.clone(),this._planTrees=n._planTrees,n._activeCursor==n._sceneCursor?this._activeCursor=this._sceneCursor:this._activeCursor=(t=n._activeCursor)==null?void 0:t.clone(),this._activeTransitionKey=n._activeTransitionKey,this._activeTransitionIndexInParent=n._activeTransitionIndexInParent,this.transitionMap=n.transitionMap}}clone(){return new i(this)}_getOrCreateSmartAnimatePlanTreeAt(e,t){let n=this.transitionMap.get(t).change.transitionParameters;if(n.transitionType=="SMART_ANIMATE"||kn.supportsSmartAnimate(n.transitionType)&&n.transitionShouldSmartAnimate){if(!this._planTrees.has(t)){let r=Go.getMagicMovePlanForStateSwapTransition(e.transitioningFrom.exitingTransitionRoot,e);this._planTrees.set(t,r)}return this._planTrees.get(t)}return null}moveToChildAt(e){if(this._activeTransitionKey==null&&this._sceneCursor!=null){let t=this._sceneCursor.node.childAt2(e,!0);if(t.transitioningFrom!=null){this._activeTransitionIndexInParent=e;let n=t.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=n;let r=this._getOrCreateSmartAnimatePlanTreeAt(t,this._activeTransitionKey);if(r!=null){let o=this.transitionMap.get(n).progress,a=this.transitionMap.get(n).change.transitionParameters;this._sceneCursor.moveToChildAt(e),this._activeCursor=new Xi(r,t,o,a.easingFunction);return}}}this._activeCursor.moveToChildAt(e)}moveToParent(){this._activeCursor.isRoot()?(this._sceneCursor.moveToParent(),this._activeCursor=this._sceneCursor,this._activeTransitionIndexInParent=-1,this._activeTransitionKey=null):(this._activeCursor==this._sceneCursor&&(this._activeTransitionKey=null),this._activeCursor.moveToParent())}isRoot(){return this._activeCursor.isRoot()?this._sceneCursor==null||this._sceneCursor==this._activeCursor:!1}indexInParent(){return!this.isRoot()&&this._activeCursor.isRoot()?this._activeTransitionIndexInParent:this._activeCursor.indexInParent()}renderableContentType(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?In.RenderableContentType.CUSTOM_RENDER_TREE:this._activeCursor.renderableContentType()}isFrameLike(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?!1:this._activeCursor.isFrameLike()}isTopLevel(){return this._activeTransitionKey!=null||this._sceneCursor==null?!1:this._sceneCursor.node.isTopLevel()}paintsDebugString(){return`PlaybackCursor ${this._sceneCursor.node.paintsDebugString()}`}willChange(){return this._activeCursor.willChange()}shouldOptimizeShadowForAnimation(e){return this._activeCursor.shouldOptimizeShadowForAnimation(e)}customRenderTree(e){if(this._sceneCursor==this._activeCursor&&this._sceneCursor.node.transitioningFrom!=null){let t=this.transitionMap.get(this._activeTransitionKey).progress,n=this.transitionMap.get(this._activeTransitionKey).change,r=n.transitionParameters,o=Rn.get(r.transitionType);n.direction==1&&(o=o.reversed());let a=this._sceneCursor.node,s=a.transitioningFrom.exitingTransitionRoot,l=Ce.generateRenderTree(new nn(a),e),d=Ce.generateRenderTree(new nn(s),e),c=a.size().max2(s.size()),p=null;l!=null&&(p=pt.forTransformIsolation(l)),p!=null?(p=pt.forOpacity(p,Et.forAnimateableOpacity(a.id()),()=>o.enteringFrameTransition().interpolateOpacity(t())),p=pt.forTranslation(p,Et.forAnimateableTranslation(a.id()),()=>c.multiply1(o.enteringFrameTransition().interpolateTranslation(t())))):p=new ze([]);let u=null;if(d!=null&&(u=pt.forTransformIsolation(d)),u!=null?(u=pt.forOpacity(u,Et.forAnimateableOpacity(s.id()),()=>o.exitingFrameTransition().interpolateOpacity(t())),u=pt.forTranslation(u,Et.forAnimateableTranslation(s.id()),()=>c.multiply1(o.exitingFrameTransition().interpolateTranslation(t())))):u=new ze([]),o.isDissolve()){let h=Et.forAnimateableDissolve(a.id());return new Ar(u,p,h,t)}else return o.drawsEnteringFrameOnTopOfExitingFrame()?ze.wrap([u,p]):ze.wrap([p,u])}return this._activeCursor.customRenderTree(e)}name(){return this._activeCursor.name()}scene(){return this._activeCursor.scene()}parent(){if(this.isRoot())return null;let e=this.clone();return e.moveToParent(),e}blendMode(){return this._activeCursor.blendMode()}opacity(){return this._activeCursor.opacity()}visible(){return this._activeCursor.visible()}isVisibleMask(){return this._activeCursor.isVisibleMask()}maskType(){return this._activeCursor.maskType()}isSpreadEligibleNode(){return this._activeCursor.isSpreadEligibleNode()}type(){return this._activeCursor.type()}childCount(){return this._activeCursor.childCount()}absoluteTransform(){return this._activeCursor.absoluteTransform()}maxTransformScale(){return this._activeCursor.maxTransformScale()}clipsChildren(){return this._activeCursor.clipsChildren()}stopsMaskPropagation(){return this._activeCursor.stopsMaskPropagation()}arcData(){return this._activeCursor.arcData()}roundedRectInfo(){return this._activeCursor.roundedRectInfo()}fillGeometry(){return this._activeCursor.fillGeometry()}strokeGeometry(){return this._activeCursor.strokeGeometry()}fillGeometryForSpread(e,t,n){return this._activeCursor.fillGeometryForSpread(e,t,n)}strokeGeometryForSpread(e,t,n,r){return this._activeCursor.strokeGeometryForSpread(e,t,n,r)}size(){return this._activeCursor.size()}strokeAlign(){return this._activeCursor.strokeAlign()}strokeWeight(){return this._activeCursor.strokeWeight()}uniqueIdentifier(){return this._activeCursor.uniqueIdentifier()}isInsideOutlineMask(){return this._activeCursor.isInsideOutlineMask()}textData(){return this._activeCursor.textData()}derivedTextData(){return this._activeCursor.derivedTextData()}textGeometry(){return this._activeCursor.textGeometry()}getCachedRenderTree(){return this._activeCursor.getCachedRenderTree()}_shouldPreemptivelyMarkAsVolatile(){if(X.shouldPreventVolatileCaching())return!1;let e=this._sceneCursor.node.canvas().parent().scene(),t=this._sceneCursor.node;if(!t.isInstance())return!1;let n=1;if(t.stablePath().guids.length>n+1)return!1;let r=e.findNode1(t.symbolID());return(r==null?void 0:r.parent())==null?!1:r.parent().isStateGroup()}renderTree(){if(this._sceneCursor==null){let e=new Ce.GenerateArgs(Ce.RenderMode.NORMAL);return Ce.generateRenderTree(this.clone(),e)}else if(this._activeCursor==this._sceneCursor){let e=this._sceneCursor.node.renderTree2(this);return this._activeCursor.scene().interactiveComponentsEnabled()&&this._shouldPreemptivelyMarkAsVolatile()&&e!=null?pt.forStateSwap(e):e}else{if(this._activeCursor.isRoot())return this._sceneCursor.node.renderTree2(this);{let e=new Ce.GenerateArgs(Ce.RenderMode.NORMAL);return Ce.generateRenderTree(this.clone(),e)}}}renderTreeWithoutBackgroundBlurs(){return this._activeCursor.renderTreeWithoutBackgroundBlurs()}renderTreeForShadowRoot(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowRoot2(this);{let e=new Ce.GenerateArgs(Ce.RenderMode.SHADOW,this.uniqueIdentifier());return Ce.generateRenderTree(this.clone(),e)}}renderTreeForShadowDescendant(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowDescendant2(this);{let e=new Ce.GenerateArgs(Ce.RenderMode.SHADOW);return Ce.generateRenderTree(this.clone(),e)}}renderTreeForKnockoutShadowRoot(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowRoot2(this);{let e=new Ce.GenerateArgs(Ce.RenderMode.KNOCKOUT_SHADOW,this.uniqueIdentifier());return Ce.generateRenderTree(this.clone(),e)}}renderTreeForKnockoutShadowDescendant(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowDescendant2(this);{let e=new Ce.GenerateArgs(Ce.RenderMode.KNOCKOUT_SHADOW);return Ce.generateRenderTree(this.clone(),e)}}isFixed(){return this._activeCursor.isFixed()}isStandardScrolling(){return this._activeCursor.isStandardScrolling()}isStickyScrolling(){return this._activeCursor.isStickyScrolling()}scrollOffset(){return this._activeCursor.scrollOffset()}scrollDirection(){return this._activeCursor.scrollDirection()}hasOverflowingContentInScrollDirection(){return this._activeCursor.hasOverflowingContentInScrollDirection()}effects(){return this._activeCursor.effects()}fillPaints(){return this._activeCursor.fillPaints()}strokePaints(){return this._activeCursor.strokePaints()}fillPaintsToRender(){return this._activeCursor.fillPaintsToRender()}videoPlayback(){return this._activeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._activeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._activeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._activeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._activeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this._activeCursor.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this._activeCursor.overrideKey()}getSemanticNodePath(){return wn.getSemanticNodePathHelper(this)}hasBackgroundBlurs(){return this._activeCursor.hasBackgroundBlurs()}overlayRenderData(){return this._activeCursor.overlayRenderData()}};var zs;(a=>{function i(){let s=null;try{s=localStorage}catch{return 1}let l=+s.getItem("cursorScaleFactor");return l||1}a._globalCursorScaleFactor=i;function e(s,l,d,c,p,u){let h=U.new2(),f=U.new2(),_=d.clone(),m=1/l;if(X.isInlinePreview()&&_.expand1(3),f.copyFrom(c),f.expand1(m),f.left()<_.left()&&s.fillRect(h.setTo1(f.left(),f.top(),_.left()-f.left(),f.height()),p),_.right()<f.right()&&s.fillRect(h.setTo1(_.right(),f.top(),f.right()-_.right(),f.height()),p),f.top()<_.top()&&s.fillRect(h.setTo1(_.left()-m,f.top(),_.width()+2*m,_.top()-f.top()),p),_.bottom()<f.bottom()&&s.fillRect(h.setTo1(_.left()-m,_.bottom(),_.width()+2*m,f.bottom()-_.bottom()),p),u>0){_.expand1(m);let A=u*Math.cos(Math.PI/4);s.fillConvexPolygon([_.topLeft(),_.topLeft().add1(new E(A,0)),_.topLeft().add1(new E(0,A))],p),s.fillConvexPolygon([_.topRight(),_.topRight().add1(new E(0,A)),_.topRight().add1(new E(-A,0))],p),s.fillConvexPolygon([_.bottomRight(),_.bottomRight().add1(new E(-A,0)),_.bottomRight().add1(new E(0,-A))],p),s.fillConvexPolygon([_.bottomLeft(),_.bottomLeft().add1(new E(0,-A)),_.bottomLeft().add1(new E(A,0))],p)}}a.drawPreviewStencil=e;function t(s,l,d,c){for(let p of l){let u=E.new3(p.canvasSpaceLocation);if(!c.contains2(u))continue;let h=[],f=p.age(),_=f*Yl.RADIUS,m=Math.max(8,(_|0)*2);for(let A=0;A<m;A=A+1){let y=Math.PI*2*A/m;h.push(new E(u.x()+Math.cos(y)*_*d,u.y()+Math.sin(y)*_*d))}s.fillConvexPolygon(h,C.new3(.9,.9,.9,.5*(1-f)))}}a.drawParticles=t;function n(s,l,d){let c=l.x(),p=l.y(),u=i()/d,h=[],f=[];for(let S of a.cursorOutlineOuter)h.push(E.new2());for(let S of a.cursorOutlineInner)f.push(E.new2());let _=2,m=.5,A=(_+1)*(_+1)*(_+1)*(_+1),y=m/A;for(let S=-_,g=_+1;S<g;S=S+1)for(let b=-_,T=_+1;b<T;b=b+1){let O=(_+1-Math.abs(S))*(_+1-Math.abs(b))*y;if(!(O<1/255)){for(let w=0,P=a.cursorOutlineOuter.length;w<P;w=w+1){let H=a.cursorOutlineOuter[w],re=h[w];re.setX(c+(H.x()+S)*u),re.setY(p+(H.y()+b+1)*u)}s.fillConvexPolygon(h,C.new3(0,0,0,O))}}for(let S=0,g=a.cursorOutlineOuter.length;S<g;S=S+1){let b=a.cursorOutlineOuter[S],T=h[S];T.setX(c+b.x()*u),T.setY(p+b.y()*u)}s.fillConvexPolygon(h,C.WHITE);for(let S=0,g=a.cursorOutlineInner.length;S<g;S=S+1){let b=a.cursorOutlineInner[S],T=f[S];T.setX(c+b.x()*u),T.setY(p+b.y()*u)}s.fillConvexPolygon(f,C.BLACK)}a.drawMouseCursor=n,a.cursorOutlineOuter=[new E(14.933,9.027),new E(7.755,10.975),new E(3.57,17.299),new E(0,0)],a.cursorOutlineInner=[new E(12.416,8.674),new E(7.13,10.109),new E(4.063,14.742),new E(1.442,2.04)]})(zs||(zs={}));var Kf=class{constructor(e,t){this.tree=null,this.bounds=null,this.hash=0,this.tree=e,this.bounds=t;let n=new co;n.hash1(t.x()),n.hash1(t.y()),n.hash1(t.width()),n.hash1(t.height()),this.hash=n.value()}equals(e){return this.bounds.equals(e.bounds)&&this.tree.equals(e.tree)}},Rh=class{constructor(e,t){this._tileAtlas=null,this._keyToTileHandle=null,this._keyToNeededImages=null,this._tileHandleToKey=null,this._resetMaps();let n=(r,o)=>{o.isValid=!1;let a=Le.StringMap_get(this._tileHandleToKey,r,null);a!=null&&(this._tileHandleToKey.delete(r),this._keyToTileHandle.remove(a),this._keyToNeededImages.remove(a))};this._tileAtlas=new gn(e,n)}_resetMaps(){this._keyToTileHandle=new wi(e=>e.hash,(e,t)=>e.equals(t),e=>null),this._keyToNeededImages=new wi(e=>e.hash,(e,t)=>e.equals(t),e=>null),this._tileHandleToKey=new Map}_allocateTileHandle(e){let t=this._tileAtlas.allocateTile();return this._tileHandleToKey.set(t,e),this._keyToTileHandle.set(e,t),t}getOrInsertOrNull(e,t){let n=new _r(Kn.solidColorRect(t,C.BLACK,1),e).optimized();if(n==null)return null;let r=new Kf(n,t),o=new Oh(r,this);return o.tileHandleOrNull=this._keyToTileHandle.get(r,null),o.neededImagesOrNull=this._keyToNeededImages.get(r,null),o}setNeededImagesForTile(e,t){this._keyToNeededImages.set(e.key,t),e.neededImagesOrNull=t}maximumCapacity(){return this._tileAtlas.maximumCapacity()}tilesPerAtlasTexture(){return this._tileAtlas.tilesPerTexture()}prepareForNewFrame(){this._tileAtlas.prepareForNewFrame()}totalVRAM(){return this._tileAtlas.totalVRAM()}hasValidRenderedContent(e){return e.tileHandleOrNull!=null&&this._tileAtlas.tileIsStillValid(e.tileHandleOrNull)}prepareToRenderTo(e,t){return this.hasValidRenderedContent(e)||(e.tileHandleOrNull=this._allocateTileHandle(e.key)),this._tileAtlas.viewportForTile(e.tileHandleOrNull,t),this._tileAtlas.framebufferForTile(e.tileHandleOrNull)}textureRegionOrNull(e){if(!this.hasValidRenderedContent(e))return null;let t=U.new2();this._tileAtlas.viewportForTile(e.tileHandleOrNull,t);let n=this._tileAtlas.framebufferForTile(e.tileHandleOrNull).colorTexture();return new N.TextureRegion(n,t.scaledBy1(1/n.width()))}clear(){this._tileAtlas.clearCache(),this._resetMaps()}};var _a=class _a{constructor(e,t,n){this._context=null,this._compositeTileCache=null,this._renderer=null,this._boundsCache=ja._new(),this._backbuffer=null,this._prepareForEfficientCompositingMemoized=null,this._context=e,this._compositeTileCache=t,this._renderer=n,this._prepareForEfficientCompositingMemoized=lg(r=>{let o=this._prepareForEfficientCompositing(r);return _a._VERBOSE_LOGS&&(console.log("Before Preparation for Rasterization"),console.log("--------------"),console.log(r.debugString1()),console.log(""),console.log("After Preparation for Rasterization"),console.log("--------------"),console.log(o.debugString1())),o})}beginFrameAndCreateBudget(){this._compositeTileCache.prepareForNewFrame(),ja.clear(this._boundsCache),this._context.resetNumFramebufferSwitches();let e=.016,t=2,n=250,r=this._compositeTileCache.maximumCapacity();return r>=1e3&&(_a._alreadyLoggedTooManyTiles||(Be.trackEvent1("viewer_prototype_too_many_tiles",new Map([["numTiles",r]])),_a._alreadyLoggedTooManyTiles=!0)),new _a.FrameBudget(this._context,e,t,r,n)}prepareForEfficientCompositing(e){return this._prepareForEfficientCompositingMemoized(e)}_prepareForEfficientCompositing(e){if(e!=null&&e.isAxisAlignedRectFill()){let t=e;if(Oe.onlySolidPaintOrNull(t.geometry.paints)!=null)return e}if(e.canCacheRasterized())return new Fh(e,this._compositeTileCache);switch(e.op()){case 0:{let t=e;return new Ha(this._prepareForEfficientCompositing(t.child),t.flags)}case 2:{let t=e;return new si(this._prepareForEfficientCompositing(t.child))}case 1:{let t=e,n=[],r=[];for(let o of t.children)if(o.canCacheRasterized())r.push(o);else{if(r.length!=0){let a=ze.wrap(r);n.push(this._prepareForEfficientCompositing(a)),r=[]}n.push(this._prepareForEfficientCompositing(o))}if(r.length!=0){let o=ze.wrap(r);n.push(this._prepareForEfficientCompositing(o))}return ze.wrap(n)}case 5:{let t=e;return new _r(this._prepareForEfficientCompositing(t.alpha),this._prepareForEfficientCompositing(t.color),t.type,t.innerShadowFill,t.innerShadowAlphaRequiresHardMask)}case 6:{let t=e;return t.radius>=1?t:new ro(t.radius,this._prepareForEfficientCompositing(t.child),t.clamp)}case 7:{let t=e;return new oo(t.blendMode,t.opacity,this._prepareForEfficientCompositing(t.child))}case 9:{let t=e;return new bo(this._prepareForEfficientCompositing(t.alpha),t.color)}case 10:{let t=e;return new pt(this._prepareForEfficientCompositing(t.child),t.id,t.property,t.getter)}case 11:{let t=e;return new Hi(this._prepareForEfficientCompositing(t.child),t.transform)}case 12:{let t=e;return new Ar(this._prepareForEfficientCompositing(t.startChild),this._prepareForEfficientCompositing(t.endChild),t.id,t.progressFn)}case 3:case 4:{if(e.hasAnimatingMedia()||e.hasVolatileContent()&&e.op()!=8)return e;throw new Error(`Unexpectedly received ${fr[e.op()]} node`)}case 8:throw new Error(`Unexpectedly received ${fr[e.op()]} node`);default:throw new Error(`Node type ${fr[e.op()]} is unhandled`)}}getPrioritizedListOfTilesToPopulate(e,t,n,r){let o=[oe.new2()],a=[oe.new2()],s=[1],l=[],d=p=>{switch(p.op()){case 10:{let u=p;switch(u.property){case 2:{let h=oe.new3(ce.List_last(o));h.multipliedBy1(u.transform()),o.push(h);let f=oe.new3(u.transform());f.invert()||f.copyFrom(Nt.FrozenAffineTransform_IDENTITY),f.multipliedBy1(ce.List_last(a)),a.push(f);break}case 0:{let h=oe.new3(ce.List_last(o));h.multipliedBy1(ce.List_last(a)),o.push(h);let f=oe.new2();a.push(f);break}case 1:{a.push(oe.new2());break}case 3:{s.push(u.maxTransformScale());break}}break}case 11:{let u=p,h=oe.new3(ce.List_last(o));h.multipliedBy1(u.transform),o.push(h);let f=oe.new3(u.transform);f.invert()||f.copyFrom(Nt.FrozenAffineTransform_IDENTITY),f.multipliedBy1(ce.List_last(a)),a.push(f);break}case 8:{let u=p,h=ce.List_last(o),f=oe.new3(h);f.invert();let _=U.new3(n);f.transformRect(_);let m=U.new3(t);f.transformRect(m);let A=e*ce.List_last(s);for(let y=0;y<10;y=y+1){u.setDevicePixelPerCanvasPixel(A);let S=u.numTilesNeededForBounds(m),g=this._compositeTileCache.tilesPerAtlasTexture();if(S>g){A/=2;continue}break}u.forEachTileWithinBounds(0,_,y=>{let g=y.bounds().distanceTo(m)*h.scale1().max1();l.push(new _a.TileWithPriority(y,g))});break}}},c=p=>{switch(p.op()){case 10:{let u=p.property;(u==2||u==0||u==1)&&ce.List_removeLast(a),(u==2||u==0)&&ce.List_removeLast(o),u==3&&ce.List_removeLast(s);break}case 11:{ce.List_removeLast(a),ce.List_removeLast(o);break}}};return Un.didEncounterCullTreesDuringTilePrioritization(),X.cullTreesDuringTilePrioritization()?Fn.visitEachNodeInTree(r,d,c,n,this._boundsCache):Fn.visitEachNodeInTree(r,d,c),l.sort((p,u)=>p.canvasSpaceDistanceToViewport<u.canvasSpaceDistanceToViewport?-1:1),l}ensureTileIsPopulated(e,t,n){if(t.recordTileCacheSlotWasUsed(),this._compositeTileCache.hasValidRenderedContent(e))return 1;let r=U.new2(),o=this._compositeTileCache.prepareToRenderTo(e,r),a=!1,s=C.TRANSPARENT,l=!0,d=!0,c=new zi.Options(e.key.tree,a,s,l,this._boundsCache,n,!1,d,!0),p=this._renderer.drawTile2(r,e.canvasSpaceBounds().x(),e.canvasSpaceBounds().y(),e.canvasSpaceBounds().width(),o,c);return t.recordTileWasRendered(),this._compositeTileCache.setNeededImagesForTile(e,p.neededImagesOrNull),0}drawToScreen(e,t,n,r,o,a){this._context.annotate("Composite",()=>{let s=_o.new2();s.copyFrom(t);let l=s.invert();if(this._backbuffer==null||this._backbuffer.colorTexture().width()!=(n.size().x()|0)||this._backbuffer.colorTexture().height()!=(n.size().y()|0)){this._backbuffer!=null&&this._backbuffer.deleteTexture();let T=N.in_Context.Context_createTexture1(this._context,N.TextureFormat.RGBA_LINEAR_CLAMP,n.size().x()|0,n.size().y()|0,"Compositor Backbuffer"),I=N.in_Context.Context_createTexture1(this._context,N.TextureFormat.STENCIL,n.size().x()|0,n.size().y()|0,"Compositor Backbuffer");this._backbuffer=this._context.createFramebuffer(T,I,"Compositor Backbuffer")}let d=this._context.currentFramebuffer();this._context.setFramebuffer(this._backbuffer),N.in_Context.Context_clear1(this._context,N.Clear.ALL),this._context.setFramebuffer(d);let c=gn.TILE_SIZE,p=new U(0,0,c,c),u=U.new2();X.internalDebugTools()&&(e=this._renderer.treeToRender(e));let h=!1,f=C.TRANSPARENT,_=!1,m=!0,A=!0,y=new zi.Options(e,h,f,_,this._boundsCache,a,m,A,!1);for(let T=n.left();T<=n.right();T+=c)for(let I=n.top();I<=n.bottom();I+=c)p.setX(T),p.setY(I),u.copyFrom(p),s.transformRect(u),p.translate2(n.topLeft().negative()),this._renderer.drawTile2(p,u.x(),u.y(),u.width(),this._backbuffer,y);X.internalDebugTools()&&this._renderer.finishLayerByLayerDrawToScreen();let S=oe.new2();S.translate2(-1,1),S.scale4(2/r.width(),-2/r.height());let g=U.new2();g.copyFrom(n),g.transformBy1(S),g.setY(g.y()+g.height()),g.setHeight(-g.height()),this._context.setFramebuffer(null),this._context.setViewport(r.left()|0,r.top()|0,r.width()|0,r.height()|0),this._context.clear2(N.Clear.ALL,o);let b=U.UNIT;this._renderer.drawTextureToCurrentFramebuffer(this._backbuffer.colorTexture(),b,null,g,Nt.FrozenAffineTransform_IDENTITY,1,1),this._renderer.context().endFrame()})}};_a._VERBOSE_LOGS=!1,_a._alreadyLoggedTooManyTiles=!1;var Ws=_a;(t=>{class i{overlapsViewport(){return this.canvasSpaceDistanceToViewport==0}constructor(r,o){this.node=r,this.canvasSpaceDistanceToViewport=o}}t.TileWithPriority=i;class e{constructor(r,o,a,s,l){this._context=r,this._renderingDeadline=0,this._tileRenderingBudgetRemaining=0,this._tileCacheCapacityRemaining=0,this._overrideFrameBudget=!1,this._renderingDeadline=Qe.seconds()+o,this._tileRenderingBudgetRemaining=a,this._tileCacheCapacityRemaining=s,this._framebufferSwitchBudget=l}recordTileWasRendered(){this._tileRenderingBudgetRemaining=this._tileRenderingBudgetRemaining-1}recordTileCacheSlotWasUsed(){this._tileCacheCapacityRemaining=this._tileCacheCapacityRemaining-1}tileCacheCapacityRemaining(){return this._tileCacheCapacityRemaining}permitsMoreWork(){return this._overrideFrameBudget?!0:!(Qe.seconds()>=this._renderingDeadline||this._tileRenderingBudgetRemaining<=0||this._tileCacheCapacityRemaining<=0||this._framebufferSwitchBudget-this._context.getNumFramebufferSwitches()<=0&&(Un.didEncounterFramebufferSwitchBudget(),X.enableFramebufferSwitchBudget()))}permitWorkAfterBudgetExceeded(){this._overrideFrameBudget=!0}forbidWorkAfterBudgetExceeded(){this._overrideFrameBudget=!1}}t.FrameBudget=e})(Ws||(Ws={}));var Et;(y=>{function i(S){return`SCROLL_OFFSET::${S}`}y.forScrollOffset=i;function e(S){return`OVERLAY_POSITION::${S}`}y.forOverlayPosition=e;function t(S){return`ANIMATEABLE_TRANSLATION::${S}`}y.forAnimateableTranslation=t;function n(S){return`SHADOW_TRANSFORMATION::${S}`}y.forShadowTransformation=n;function r(S){return`ANIMATEABLE_OPACITY::${S}`}y.forAnimateableOpacity=r;function o(S){return`ANIMATEABLE_DISSOLVE::${S}`}y.forAnimateableDissolve=o;function a(S){return`DYNAMIC_GEOMETRY::${S}`}y.forDynamicGeometry=a;function s(S){return S.id.startsWith("SCROLL_OFFSET")}y.isScrollingTransform=s,y.ENTERING_TLF="ENTERING_TLF",y.EXITING_TLF="EXITING_TLF",y.ENTERING_OVERLAY="ENTERING_OVERLAY",y.EXITING_OVERLAY="EXITING_OVERLAY",y.ENTERING_OVERLAY_BACKGROUND="ENTERING_OVERLAY_BACKGROUND",y.EXITING_OVERLAY_BACKGROUND="EXITING_OVERLAY_BACKGROUND",y.OVERLAY_BACKGROUND="OVERLAY_BACKGROUND",y.SMART_ANIMATE_OVERLAY_TRANSLATION="SMART_ANIMATE_OVERLAY_TRANSLATION",y.OVERLAY_BACKGROUND_DISSOLVE="OVERLAY_BACKGROUND_DISSOLVE",y.DISSOLVE_TRANSITION="DISSOLVE_TRANSITION"})(Et||(Et={}));var wh=class{toggleRenderTreePrinting(){}addObserver(e){}removeObserver(e){}setBackgroundEnabled(e){}internalInitPerfTracking(){}isRenderingDone(){return!0}getContext(){return null}graphicsCardName(){return""}setNeedsBlit(e){}checkNeedsBlit(){return!1}deviceRenderer(){return null}changeFitMode(e){}setZoomScale(e){}updateScroll(e){}handleSceneChange(e,t){}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}resize(e,t,n,r){return new N.ComputedCanvasSize(new E(0,0),!1)}drawBlank(){}draw(e,t,n,r){return 1}clearTileCaches(){}getAggregateTransitionStats(){return{}}triggerTransition(e,t,n){}handleAbortedTransition(e){}handleCommittedTransition(e){}triggerHsmTransition(e,t,n){}abortHsmTransition(e,t){}commitHsmTransition(e,t){}isTopLevelTransitionOngoing(){return!1}easedTransitionProgress(){return 1}currentCanvasSpacePreviewBounds(){return new U(0,0,0,0)}currentCanvasSpaceFrameBounds(){return new U(0,0,0,0)}canvasSpacePreviewBoundsForTransition(e,t){return new U(0,0,0,0)}canvasSpaceFrameBoundsForTransition(e,t){return new U(0,0,0,0)}ongoingPrototypeStateChange(){return null}transitionProgressTracker(){return null}renderLayerByLayerActivate(e){}renderLayerByLayerDeactivate(){}renderLayerByLayerPlay(){}renderLayerByLayerPause(){}renderLayerByLayerForward(){}renderLayerByLayerBackward(){}renderLayerByLayerRewind(){}renderLayerByLayerIncreaseSpeed(){}renderLayerByLayerDecreaseSpeed(){}attachTo(e){}removeFrom(e){}},Yr=class Yr{toggleRenderTreePrinting(){this._printRenderTree=!this._printRenderTree,this._printRenderTree&&this._activeRenderTree!=null&&console.log(this._activeRenderTree.debugString1())}_currentBaseScreenId(){var e;return(e=this._appState.prototypeState().getCurrentBaseScreenNode())==null?void 0:e.id()}_currentOverlayData(){return this._appState.prototypeState().getCurrentOverlayData()}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}setBackgroundEnabled(e){}constructor(e,t,n){this._context=null,this._bufferPool=null,this._compositeTileCache=null,this._compositor=null,this._renderer=null,this._viewport=null,this._dirtinessTracker=null,this._appState=null,this._hotspotRenderer=null,this._smoothPath=null,this._deviceRenderer=null,this._prerenderViewport=new hi,this._devicePixelRatio=0,this._needsBlit=!0,this._isAnimatedMediaPlaying=!1,this._printRenderTree=!1,this._activeRenderTree=null,this._overlayBaseScreenId=null,this._generatedOverlays=new Map,this._debouncedDevicePixelsPerCanvasPixel=null,this._didRasterizeContentOnLastDraw=!0,this._observers=new nr,this._blittingDueToScroll=!1,this._requestImageOnScreen=null,this._requestImageForPrerendering=null,this.PORTION_TO_LOG=50/100,this.MAX_TRANSITION_LOGS=50,this._numTransitionsLogged=0,this._transitionStats=new Map,this._transitionWasInterruptedByVisibilityChange=!1,this._visibilityListener=null,this.HEADERS=["frame_count","transition_count","mean_frame_ms","median_transition_mean","median_transition_max","count_0_to_20ms","count_20_to_40ms","count_40_to_80ms","count_80_to_160ms","count_160_to_320ms","count_320_to_640ms","count_640_ms_or_higher"],this._ongoingTransition=null,this._drewFirstFrameOfTransition=!0,this._transitionProgressTracker=new qr,this._hsmTransitionMap=new Map,this._renderTreeForMagicMoveBaseScreen=null,this._renderTreeForMagicMoveOverlay=null,this._context=this._createContext(),this._bufferPool=new N.BufferPool(this._context),this._compositeTileCache=new Rh(this._context,this._bufferPool),this._renderer=new zi(this._context,this._bufferPool),this._compositor=new Ws(this._context,this._compositeTileCache,this._renderer),this._viewport=e,this._appState=t,this._appState.addAppObserver(this),this._renderer.context().addContextResetHandler(()=>{this._deviceRenderer.clearOnContextReset(),this._viewport.invalidate(),(Xe.isMobile(Xe.current())||Xe.current()==4&&navigator.maxTouchPoints>0||wt.forceMobileOptimizations())&&n.clearQueuesAndDecodedDataForAllImages(this._canvas())}),n.onImageLoaded=o=>{o.invalidateRenderTreeForSelfAndParents(),this._dirtinessTracker.handleImageLoaded(o),this._viewport.invalidate()};let r=o=>{this._onBoundsInvalidate(o)};this._dirtinessTracker=new Gd(r),this._smoothPath=new N.SmoothPath(this._context,this._bufferPool),this._deviceRenderer=new Nh(this._context,this._bufferPool),this._hotspotRenderer=new ph(this._context,this._bufferPool),this._debouncedDevicePixelsPerCanvasPixel=new Uc(o=>{t.addFrameObserver(o)},2,(o,a)=>o==a,()=>{this.setNeedsBlit(!0)}),this._initMagicMoveRenderTreeCache(),this._requestImageOnScreen=(o,a)=>{let s=Nr.forOnScreenPurpose(a);n.requestImageForRendering(o,s)},this._requestImageForPrerendering=(o,a)=>{let s=Nr.forPrerenderPurpose(a);n.requestImageForRendering(o,s)},console.debug(`Graphics card: '${this._context.graphicsCardName()}'`),Yr.PERF_TRACKING&&(this._initTransitionStats(),window.getTransitionStats=o=>this._formatStatsForGoogleSheets(this.getAggregateTransitionStats(),o!=null?o:!1))}_uninitialize(){this._debouncedDevicePixelsPerCanvasPixel.unregister(e=>{this._appState.removeFrameObserver(e)}),this._appState.removeAppObserver(this)}internalInitPerfTracking(){3==0&&(Yr.PERF_TRACKING=!0,this._initTransitionStats())}isRenderingDone(){return!this._didRasterizeContentOnLastDraw}getContext(){return this._context}graphicsCardName(){return this._context.graphicsCardName()}setNeedsBlit(e){e||(this._blittingDueToScroll=!1),this._needsBlit=e,this._observers.forEach(t=>{t.handleSetNeedsBlit(e)})}checkNeedsBlit(){return this.setNeedsBlit(this._needsBlit||this._viewport.isInvalid()||this.isTopLevelTransitionOngoing()||this._animatedMediaPlaying()||this._hsmTransitionMap.size>0),this._needsBlit||sa.hasUnexpectedCompositingBug()}deviceRenderer(){return this._deviceRenderer}changeFitMode(e){this._viewport.invalidate()}setZoomScale(e){}updateScroll(e){this._blittingDueToScroll=!0,this.setNeedsBlit(!0)}handleSceneChange(e,t){this._debouncedDevicePixelsPerCanvasPixel.clear()}handleActiveCanvasChange(e,t){this._renderer.setCanvas(t),e!=null&&e.scene().removeObserver(this._dirtinessTracker),t!=null&&t.scene().addObserver(this._dirtinessTracker),this._dirtinessTracker.initCanvas(t)}handleActivePrototypeStartingPointChange(e,t){}resize(e,t,n,r){let a=new E(e,t).multiply(r),s=this._context.resize(Math.round(a.x())|0,Math.round(a.y())|0);return this._devicePixelRatio=r,this.setZoomScale(n),this._debouncedDevicePixelsPerCanvasPixel.clear(),new N.ComputedCanvasSize(s.canvasSize.divide(r),s.webGLDidAdjustCanvasSize)}drawBlank(){this._context.annotate("Draw blank",()=>{X.isInlinePreview()&&this._ongoingTransition!=null&&this._onBeforeFrameForTransition(),this._renderer.context().beginFrame(),N.in_Context.Context_clear1(this._renderer.context(),N.Clear.ALL),this._renderer.context().endFrame()})}_renderTreeToDraw(e){if(this.isTopLevelTransitionOngoing())return this._renderTreeForTransition(e);{let t=this._appState.prototypeState().getCurrentBaseScreenNode(),n=this._appState.prototypeState().bindOverlays(this._currentOverlayData());return Be.appTimerStart("invalidateDirtyTiles"),this._dirtinessTracker.invalidateDirtyTiles(this._canvas(),new li(this._canvas(),this._hsmTransitionMap,new ga(this._generatedOverlays))),Be.appTimerStop("invalidateDirtyTiles"),this._generatedOverlays=new Map,this._renderTreeForBaseScreenAndOverlays(t,n)}}_renderTreeForBaseScreenAndOverlays(e,t){if(e==null)return null;let n=Ce.renderTreeForBaseScreenWithPerfLogging(e,new li(e,this._hsmTransitionMap,null),"_renderTreeForBaseScreenAndOverlays");return n==null?null:pt.forTransformIsolation(ze.wrap([this._compositor.prepareForEfficientCompositing(n),this._renderTreeForOverlays(e,t)]).optimized())}_renderTreeForOverlays(e,t){let n=[],r=new ga;for(let o=0,a=t.length;o<a;o=o+1){let s=Ce.renderTreeForOverlayBackground(t[o].backgroundAppearance(),e.canvasSpaceBoundingBox());s!=null&&n.push(s);let l=this._renderTreeForOverlay1(t[o],e,o,r,null);l!=null&&n.push(l)}return ze.wrap(n)}_renderTreeForOverlay1(e,t,n,r,o){return this._renderTreeForOverlay2(e,t,n,null,r,o)}_renderTreeForOverlay2(e,t,n,r,o,a){if(t==null)return null;let s=e.node();if(s==null)return null;let l=e.renderedBounds(t),d=s.canvasSpaceBoundingBox(),c=l.center().subtract1(d.center());this._overlayBaseScreenId!=null&&t.id()!=this._overlayBaseScreenId&&(s.invalidateRenderTreeForSelfAndParents(),s.invalidateRenderTreeForChildren()),this._overlayBaseScreenId=t.id();let p=new nn(t,null),u=new Xl(e.id(),e.node(),l,p,e.backgroundAppearance(),r,()=>c,a);o.addEntry(e.id(),u),this._generatedOverlays.set(e.id(),u);let h=Ce.renderTreeForOverlayWithPerfLogging(s,new li(s,this._hsmTransitionMap,o),"_renderTreeForOverlay");if(h==null)return null;let f=this._compositor.prepareForEfficientCompositing(h);return f=pt.forTranslation(f,Et.forOverlayPosition(n),()=>c),f}_animatedMediaPlaying(){return this._isAnimatedMediaPlaying}_setAnimatedMediaPlaying(e){this._isAnimatedMediaPlaying=e}draw(e,t,n,r){var o;return this._didRasterizeContentOnLastDraw=!1,this._renderer.context().isContextLost()?1:((o=this._canvas())==null?void 0:o.scene())==null?1:this._currentTlf()==null?1:n.viewSpaceBounds().isEmpty()?1:this._context.annotateAndReturn("draw",()=>{var y,S,g,b,T,I;let a=this._compositor.beginFrameAndCreateBudget(),s=a.tileCacheCapacityRemaining();this._renderer.context().beginFrame();let l=this._ongoingTransition!=null,d=this.isTopLevelTransitionOngoing();l&&this._onBeforeFrameForTransition(),this._onBeforeFrameForHsm();let c=this._renderTreeToDraw(n);this._activeRenderTree=c,c!=null&&this._setAnimatedMediaPlaying(c.hasAnimatingMedia()),this._debouncedDevicePixelsPerCanvasPixel.queueValue(n.zoomScale()*this._devicePixelRatio);let p=this._debouncedDevicePixelsPerCanvasPixel.hasQueuedValue()&&!(d&&!this._drewFirstFrameOfTransition);this._drewFirstFrameOfTransition=!0;let u=[],h=0,f=U.new2();n.computeCanvasSpaceBounds1(f);let _=this.currentCanvasSpacePreviewBounds();if(_==null)return Be.trackEvent1("prototype_null_canvas_space_preview_bounds",new Map([["currentTlfID",(S=(y=this._currentTlf())==null?void 0:y.id)!=null?S:"null"],["baseScreenNodeID",(b=(g=this._appState.baseScreenNode())==null?void 0:g.id)!=null?b:"null"],["sceneNull",((T=this._canvas())==null?void 0:T.scene())==null],["transitionOngoing",this._ongoingTransition!=null]])),1;let m=this.currentCanvasSpaceFrameBounds()!=null?this.currentCanvasSpaceFrameBounds().topLeft():new E(0,0);_.intersectWith(f);let A=!1;if(Be.appTimerStart("drawOnScreenTiles"),this._context.annotate("On-screen tiles",()=>{if(!p){let O=U.new3(_);O.expandedBy1(_.height()),u=this._compositor.getPrioritizedListOfTilesToPopulate(this._debouncedDevicePixelsPerCanvasPixel.getValue(),_,O,c);let w=X.respectRenderBudgetOnScroll()&&this._blittingDueToScroll;for(w||a.permitWorkAfterBudgetExceeded();h<u.length;){let P=u[h];if(!P.overlapsViewport())break;if(w&&!a.permitsMoreWork()){A=!0;break}let H=this._compositor.ensureTileIsPopulated(P.node,a,this._requestImageOnScreen);H==0&&(this._didRasterizeContentOnLastDraw=!0),H==0&&Yr.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame INSIDE of viewport. Capacity left: ${a.tileCacheCapacityRemaining()} / ${s}`),h=h+1}w||a.forbidWorkAfterBudgetExceeded()}}),Be.appTimerStop("drawOnScreenTiles"),Be.appTimerStart("drawToScreen"),this._needsBlit){this._printRenderTree&&console.log(c.debugString1());let O=U.new2(),w=0,P=(I=this._canvas())==null?void 0:I.prototypeDevice();P!=null&&P.type=="PRESET"?(O.setTo2(m,P.size()),w=C.BLACK):(O.copyFrom(_),w=r.backgroundColor);let H=_o.new2().scaledBy(this._devicePixelRatio).multipliedBy(n.canvasSpaceToViewSpace1());H.transformRect(O),O.round();let re=n.viewSpaceBounds(),q=new U(re.left()*this._devicePixelRatio,re.top()*this._devicePixelRatio,re.width()*this._devicePixelRatio,re.height()*this._devicePixelRatio).rounded();this._compositor.drawToScreen(c,H,O,q,w,this._requestImageOnScreen),this._drawUI(n,r),this.setNeedsBlit(!1)}return Be.appTimerStop("drawToScreen"),Be.appTimerStart("drawOffScreenTiles"),this._context.annotate("Off-screen tiles",()=>{if(!p){for(;a.permitsMoreWork()&&h<u.length;){let O=this._compositor.ensureTileIsPopulated(u[h].node,a,this._requestImageForPrerendering);O==0&&(this._didRasterizeContentOnLastDraw=!0),O==0&&Yr.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame OUTSIDE of viewport. Capacity left: ${a.tileCacheCapacityRemaining()} / ${s}`),h=h+1}if(t){let O=this._appState.prototypeState().bindOverlays(this._currentOverlayData()),w=null,P=this._appState.baseScreenNode().canvasSpaceBoundingBox().topLeft();for(let H of this._appState.prototypeStructure().getPrerenderingJobs(()=>a.permitsMoreWork())){let re=null,q=null,W=null,x=null,F=H.asScreen(),k=H.asSmartAnimate();if(F!=null){if(F.role==Qn.FrameRole.BASE_SCREEN&&ne.equals(F.nodeId,this._currentBaseScreenId())||(W=this._canvas().scene().findNode1(F.nodeId),W==null||!W.hasBeenLoaded()))continue;if(!a.permitsMoreWork())break;let B=null;if(F.role==Qn.FrameRole.OVERLAY){let j=ar.fromPrototypeAction(F.prototypeAction,0);B=Md.BoundOverlay_computeNewBounds(W,this._appState.baseScreenNode(),j,P,W.overlayPositionType()),P=B.topLeft();let ie=new nn(this._appState.baseScreenNode(),null),de=new Xl(W.id(),W,B,ie,W.overlayBackgroundAppearance(),null,()=>W.canvasSpaceBoundingBox().topLeft().negative().add1(P),null);this._generatedOverlays.set(W.id(),de),w==null&&(w=new ga),w.addEntry(W.id(),de),re==null&&F.precedingOverlays!=null&&(re=new ga)}if(F.role==Qn.FrameRole.OVERLAY&&O.some(j=>ne.equals(F.nodeId,j.id())))continue;if(x=this.canvasSpacePreviewBoundsForTransition(W,W),re!=null){let j=!1;for(let ie of F.precedingOverlays){let de=w.get2(ie);if(de==null){j=!0;break}re.addEntry(ie,de)}if(j)break}let te=new li(W,this._hsmTransitionMap,re);q=F.role==Qn.FrameRole.BASE_SCREEN?Ce.renderTreeForBaseScreenWithPerfLogging(W,te,"_draw"):Ce.renderTreeForOverlayWithPerfLogging(W,te,"_draw")}else if(k!=null){let B=this._canvas().scene().findNode1(k.srcNodeId),te=this._canvas().scene().findNode1(k.dstNodeId);if(B==null||te==null||!B.hasBeenLoaded()||!te.hasBeenLoaded())continue;x=this.canvasSpacePreviewBoundsForTransition(B,te);let j=Rn.get(k.transitionType);q=this._renderTreeForMagicMove(B,te,j,k.role,k.easingFunction),W=te}if(q==null)continue;if(!a.permitsMoreWork())break;let G=this._compositor.prepareForEfficientCompositing(q);if(!a.permitsMoreWork())break;this._prerenderViewport.copyFrom(this._viewport),this._prerenderViewport.updateForCurrentPreview(W.canvasSpaceBoundingBox(),x,this._appState.currentFitMode(),this._appState.activePrototypeDevice());let M=U.new2();this._prerenderViewport.computeCanvasSpaceBounds1(M),x.intersectWith(M);let Q=this._prerenderViewport.zoomScale()*this._devicePixelRatio,Y=this._compositor.getPrioritizedListOfTilesToPopulate(Q,x,x,G);for(let B of Y)if(a.tileCacheCapacityRemaining()==0||this._compositor.ensureTileIsPopulated(B.node,a,this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0,Yr.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendering tile for future frame. Capacity left: ${a.tileCacheCapacityRemaining()} / ${s}`),!a.permitsMoreWork()))break}}}}),Be.appTimerStop("drawOffScreenTiles"),A&&this.setNeedsBlit(!0),this._context.endFrame(),0})}_canvas(){return this._appState.getActiveCanvas()}_currentTlf(){var e;return(e=this._canvas())==null?void 0:e.scene().findNode1(this._currentBaseScreenId())}_drawUI(e,t){this._context.annotate("Draw UI",()=>{if(this._appState.getActiveCanvas()==null)return;let n=this.currentCanvasSpacePreviewBounds(),r=this.currentCanvasSpaceFrameBounds().topLeft(),o=U.new2();e.computeCanvasSpaceBounds1(o);let l=1/(e.zoomScale()*this._devicePixelRatio);if(n==null)return;this._smoothPath.setTransformAndPixelScale(e.canvasSpaceToClipSpace1(),l);let d=this._canvas().prototypeDevice(),c=!X.getFeatureFlags().removePreviewStencil,p=0;if(d!=null&&d.type=="PRESET"&&ob(d.presetIdentifier)&&(c=!0,p=25),c)if(d==null||d.type!="PRESET")n.intersectWith(o),zs.drawPreviewStencil(this._smoothPath,e.zoomScale(),n,o,t.backgroundColor,p);else{let h=U.new2();h.setTo2(r,d.size()),h.expand1(1/e.zoomScale()),n.intersectWith(o),h.intersectWith(o),zs.drawPreviewStencil(this._smoothPath,e.zoomScale(),h,o,t.backgroundColor,p)}3!=0&&(this._drawDeviceFrameIfNecessary(this._smoothPath,e,this._currentTlf().canvasSpaceBoundingBox(),o),t.particles!=null&&zs.drawParticles(this._smoothPath,t.particles,1/e.zoomScale(),n),t.mouse!=null&&n.contains2(t.mouse)&&zs.drawMouseCursor(this._smoothPath,t.mouse,e.zoomScale()),t.hotspots!=null&&this._hotspotRenderer.draw(e.canvasSpaceToClipSpace1(),e.zoomScale(),t.hotspots,t.hotspotOpacity,this._devicePixelRatio),this._smoothPath.flush(),this.deviceRenderer().flush())})}_drawDeviceFrameIfNecessary(e,t,n,r){this._canvas()!=null&&this._context.annotate("Draw device frame",()=>{var o;if(this.deviceRenderer().drawPrototypeDeviceIfAny(t,this._canvas().prototypeDevice(),n,t.canvasSpaceToClipSpace1()),this.deviceRenderer().isWaitingForDeviceFrameToLoad(this._canvas().prototypeDevice())){let a=Up((o=this._appState.baseScreenNode())==null?void 0:o.id(),this._appState.currentFitMode(),this._canvas());e.fillRect(r,a)}})}_totalVRAM(){let e=0;return e=e+this._bufferPool.totalVRAM(),e=e+this._compositeTileCache.totalVRAM(),e=e+this._renderer.totalVRAM(),e}_onBoundsInvalidate(e){this._viewport.invalidate()}clearTileCaches(){this._compositeTileCache.clear()}_initTransitionStats(){if(this._visibilityListener===null){let e=()=>{this._transitionWasInterruptedByVisibilityChange=!0};en.EventTarget_addEventListener1(document,"visibilitychange",e)}this._transitionWasInterruptedByVisibilityChange=!1;for(let e of["SA","nonSA"])this._transitionStats.set(e,new Map([["transition_mean",[]],["transition_max",[]],["frame_counts",[]],["count_0_to_20ms",0],["count_20_to_40ms",0],["count_40_to_80ms",0],["count_80_to_160ms",0],["count_160_to_320ms",0],["count_320_to_640ms",0],["count_640_ms_or_higher",0]]))}_maybeLogPerformanceMetricsForTransition(){let e=this._transitionWasInterruptedByVisibilityChange;if(this._transitionWasInterruptedByVisibilityChange=!1,!(e||document.hidden)&&!this._transitionProgressTracker.isProgressControlledExternally()&&this._transitionProgressTracker.duration()>0){let t=Math.random()<this.PORTION_TO_LOG&&this._numTransitionsLogged<this.MAX_TRANSITION_LOGS;if(Yr.VERBOSE_LOGS||t||Yr.PERF_TRACKING){let n=this._transitionProgressTracker.frameTimesMs,r=n.length,o=0,a=0,s=0,l=0,d=0,c=0,p=0,u=0,h=0;for(let S of n)u=Math.max(u,S),h+=S,S<20?o=o+1:S<40?a=a+1:S<80?s=s+1:S<160?l=l+1:S<320?d=d+1:S<640?c=c+1:p=p+1;if(u>60*1e3)return;let f=h/r,_=this._ongoingTransition.change,m=_.transitionParameters.transitionType,A=m=="SMART_ANIMATE"||kn.supportsSmartAnimate(m)&&_.transitionParameters.transitionShouldSmartAnimate,y=new Map([["is_smart_animate",A],["mean_frame_ms",f],["max_frame_ms",u],["frame_count",r],["count_0_to_20ms",o],["count_20_to_40ms",a],["count_40_to_80ms",s],["count_80_to_160ms",l],["count_160_to_320ms",d],["count_320_to_640ms",c],["count_640_ms_or_higher",p]]);Yr.VERBOSE_LOGS&&(console.group("ProtoRenderManager: Transition complete"),console.table(Le.StringMap_toJSObject(y)),console.groupEnd()),t&&(Be.trackEvent1("viewer_transition_frame_times_v2",y),this._numTransitionsLogged=this._numTransitionsLogged+1),Yr.PERF_TRACKING&&this._aggregateTransitionStats(y)}}}_aggregateTransitionStats(e){let t=e.get("is_smart_animate")?"SA":"nonSA",n=this._transitionStats.get(t);n.get("frame_counts").push(e.get("frame_count")),n.get("transition_mean").push(e.get("mean_frame_ms")),n.get("transition_max").push(e.get("max_frame_ms"));for(let r of["count_0_to_20ms","count_20_to_40ms","count_40_to_80ms","count_80_to_160ms","count_160_to_320ms","count_320_to_640ms","count_640_ms_or_higher"])n.set(r,n.get(r)+e.get(r))}getAggregateTransitionStats(){let e=new Map;for(let t of["SA"]){let n=new Map(this._transitionStats.get(t)),r=0;for(let s=0,l=n.get("transition_mean").length;s<l;s=s+1)r=r+n.get("transition_mean")[s]*n.get("frame_counts")[s];n.set("frame_count",n.get("frame_counts").reduce((s,l,d)=>s+l,0)),n.delete("frame_counts"),n.set("mean_frame_ms",r/n.get("frame_count")|0),n.get("transition_mean").sort(),n.get("transition_max").sort();let o=n.get("transition_mean").length%2===0,a=Math.floor(n.get("transition_mean").length/2);for(let s of["mean","max"]){let l=n.get(`transition_${s}`)[a];o&&(l+=n.get(`transition_${s}`)[a-1],l/=2),n.set(`median_transition_${s}`,l)}return n.set("transition_count",n.get("transition_mean").length),n.set("max_frame_ms",n.get("transition_max")[n.get("transition_max").length-1]),n.delete("transition_mean"),n.delete("transition_max"),n}return Le.StringMap_toJSObject(e)}_formatStatsForGoogleSheets(e,t){let n=`
`;t&&(n+=`=SPLIT("${this.HEADERS.join(",")}", ",")
`);let r=[];for(let o of this.HEADERS)r.push(e.get(o).toString());return n+=`=SPLIT("${r.join(",")}", ",")
`,n}triggerTransition(e,t,n){this._drewFirstFrameOfTransition=!1,this._ongoingTransition=new Yr.TransitionState(e,t),this._transitionProgressTracker.willStartTransitionWithDuration(e.transitionParameters.transitionDuration),n!=null&&Hs.applyTo(n,this._transitionProgressTracker)}handleAbortedTransition(e){var t;e==((t=this._ongoingTransition)==null?void 0:t.change)&&(this._ongoingTransition=null)}handleCommittedTransition(e){var t;e==((t=this._ongoingTransition)==null?void 0:t.change)&&(this._ongoingTransition=null)}triggerHsmTransition(e,t,n){let r=e.toString(),o=new qr;o.willStartTransitionWithDuration(t.transitionParameters.transitionDuration),n!=null&&Hs.applyTo(n,o),this._hsmTransitionMap.set(r,new Yr.InstanceSwapTransition(o,()=>{let a=o.progress();return t.transitionParameters.easingFunction==null||o.isProgressControlledExternally()?a:t.easingFunction().get(a)},t))}abortHsmTransition(e,t){this._hsmTransitionMap.delete(e.toString())}commitHsmTransition(e,t){this._hsmTransitionMap.delete(e.toString())}isTopLevelTransitionOngoing(){return this._ongoingTransition!=null&&this._transitionProgressTracker.isTransitionInProgress()}easedTransitionProgress(){let e=this._ongoingTransition;if(e==null)return 0;let t=this._transitionProgressTracker.progress();return e.change.easingFunction()==null||this._transitionProgressTracker.isProgressControlledExternally()?t:e.change.easingFunction().get(t)}_renderTreeForTransition(e){let t=this._ongoingTransition;return t==null?null:t.cachedRenderTree!=null?t.cachedRenderTree:ne.equals(t.change.oldStateId(),t.change.newStateId())?this._renderTreeForOverlayTransition(t):this._renderTreeForBaseScreenTransition(t,e)}_initMagicMoveRenderTreeCache(){let e=a=>Ce.renderTreeWithPerfLogging2(a,new li(a,this._hsmTransitionMap,null),"_initMagicMoveRenderTreeCache"),t=a=>Ce.renderTreeForBaseScreenWithPerfLogging(a,new li(a,this._hsmTransitionMap,null),"_initMagicMoveRenderTreeCache"),n=a=>a,r=a=>a,o=(a,s,l,d)=>{let c=null;try{c=Go.renderTreeForMagicMove(a,s,()=>this.easedTransitionProgress(),d,l)}catch(p){c=new ze([]),Zs(p)}return Yr.VERBOSE_LOGS&&(console.log("Smart animate render tree"),console.log("-------------------------"),console.log(c.debugString1())),c};this._renderTreeForMagicMoveBaseScreen=cg(o,t,t,n,r),this._renderTreeForMagicMoveOverlay=cg(o,e,e,n,r)}_renderTreeForMagicMove(e,t,n,r,o){return r==Qn.FrameRole.OVERLAY?this._renderTreeForMagicMoveOverlay(e,t,n,o):this._renderTreeForMagicMoveBaseScreen(e,t,n,o)}_preparedRenderTreeForMagicMove(e,t,n,r,o,a){let s=this._renderTreeForMagicMove(n,r,t,o,a);return e.cachedRenderTree=this._compositor.prepareForEfficientCompositing(s),e.cachedRenderTree}_renderTreeForBaseScreenTransition(e,t){let n=e.change,r=e.viewportBeforeTransition.zoomScale()*this._devicePixelRatio,o=this._appState.prototypeState().lastNodeForBaseScreen();if(o==null)return null;let a=t.zoomScale()*this._devicePixelRatio,s=this._appState.prototypeState().nextNodeForBaseScreen();if(s==null)return null;let l=n.oldOverlays(this._appState.prototypeState()),d=n.newOverlays(this._appState.prototypeState()),c=Rn.get(n.transitionParameters.transitionType);n.direction==1&&(c=c.reversed());let p=n.transitionParameters.transitionType=="SMART_ANIMATE"||kn.supportsSmartAnimate(n.transitionParameters.transitionType)&&n.transitionParameters.transitionShouldSmartAnimate,u=l.length!=0;if(p){let A=this._preparedRenderTreeForMagicMove(e,c,o,s,Qn.FrameRole.BASE_SCREEN,n.easingFunction());if(u){let y=s.size().max2(o.size()),S=oe.new2(),g=this._renderTreeForOverlays(o,l);if(g=pt.forOpacity(g,Et.EXITING_TLF,()=>c.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),g=pt.forTransform(g,Et.EXITING_TLF,()=>S.copyFrom(Nt.FrozenAffineTransform_IDENTITY).translatedBy1(y.multiply1(c.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress()))).translatedBy1(s.canvasSpaceBoundingBox().center()).scaledBy2(r/a).translatedBy1(o.canvasSpaceBoundingBox().center().negative())),n.transitionParameters.transitionType=="SMART_ANIMATE"){let b=Et.DISSOLVE_TRANSITION;g=new Ar(g,A,b,()=>this.easedTransitionProgress())}return e.cachedRenderTree=ze.wrap([A,g]).optimized(),e.cachedRenderTree}else return A}let h=s.size().max2(o.size()),f=oe.new2(),_=this._renderTreeForBaseScreenAndOverlays(o,l);_!=null?(_=pt.forOpacity(_,Et.EXITING_TLF,()=>c.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),_=pt.forTransform(_,Et.EXITING_TLF,()=>f.copyFrom(Nt.FrozenAffineTransform_IDENTITY).translatedBy1(h.multiply1(c.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress()))).translatedBy1(s.canvasSpaceBoundingBox().center()).scaledBy2(r/a).translatedBy1(o.canvasSpaceBoundingBox().center().negative()))):_=new ze([]);let m=this._renderTreeForBaseScreenAndOverlays(s,d);if(m!=null?(m=pt.forOpacity(m,Et.ENTERING_TLF,()=>c.enteringFrameTransition().interpolateOpacity(this.easedTransitionProgress())),m=pt.forTranslation(m,Et.ENTERING_TLF,()=>h.multiply1(c.enteringFrameTransition().interpolateTranslation(this.easedTransitionProgress())))):m=new ze([]),c.isDissolve()){let A=Et.DISSOLVE_TRANSITION;e.cachedRenderTree=new Ar(_,m,A,()=>this.easedTransitionProgress())}else c.drawsEnteringFrameOnTopOfExitingFrame()?e.cachedRenderTree=ze.wrap([_,m]):e.cachedRenderTree=ze.wrap([m,_]);return e.cachedRenderTree}_renderTreeForOverlayTransition(e){var y,S,g,b;let t=e.change,n=t.oldOverlays(this._appState.prototypeState()),r=t.newOverlays(this._appState.prototypeState()),o=this._appState.prototypeState().lastNodeForBaseScreen(),a=o.canvasSpaceBoundingBox().topLeft();if(o==null)return null;let s=Ce.renderTreeForBaseScreenWithPerfLogging(o,new li(o,this._hsmTransitionMap,null),"_renderTreeForOverlayTransition");if(s==null)return null;let l=[],d=this._compositor.prepareForEfficientCompositing(s);d!=null&&l.push(pt.forTransformIsolation(d));let c=t.getFramePairTransition(),p=new ga,u=0;for(let T=0,I=Math.min(n.length,r.length);T<I&&ne.equals(n[T].id(),r[T].id());T=T+1){let O=Ce.renderTreeForOverlayBackground(n[T].backgroundAppearance(),o.canvasSpaceBoundingBox());O!=null&&l.push(O);let w=this._renderTreeForOverlay1(n[T],o,T,p,null);w!=null&&l.push(w),u=u+1}if(n.length==r.length&&u==n.length-1&&t.transitionParameters.transitionType=="SMART_ANIMATE"){let T=n[n.length-1],I=r[r.length-1],O=this._appState.prototypeState().lastNodeForOverlayAt(n.length-1),w=this._appState.prototypeState().nextNodeForOverlayAt(r.length-1);if(O!=null&&w!=null){let P=[];ce.List_append2(P,l);let H=Ce.renderTreeForOverlayBackground(T.backgroundAppearance(),o.canvasSpaceBoundingBox()),re=Ce.renderTreeForOverlayBackground(I.backgroundAppearance(),o.canvasSpaceBoundingBox());(H!=null||re!=null)&&P.push(new Ar(H,re,Et.OVERLAY_BACKGROUND_DISSOLVE,()=>this.easedTransitionProgress()));let q=this._preparedRenderTreeForMagicMove(e,c,O,w,Qn.FrameRole.OVERLAY,t.easingFunction());return q=pt.forTranslation(q,Et.SMART_ANIMATE_OVERLAY_TRANSLATION,()=>{let W=I.deltaFromRenderedPositionToCanvasSpacePosition(o),x=T.renderedOrigin(o).subtract1(w.canvasSpaceBoundingBox().topLeft());return W.multiply(this.easedTransitionProgress()).add1(x.multiply(1-this.easedTransitionProgress()))}),P.push(q),e.cachedRenderTree=ze.wrap(P).optimized(),e.cachedRenderTree}}let _=[];for(let T=u,I=n.length;T<I;T=T+1){let O=Ce.renderTreeForOverlayBackground(n[T].backgroundAppearance(),o.canvasSpaceBoundingBox()),w=null;O!=null&&(w=()=>1-this.easedTransitionProgress(),_.push(pt.forOpacity(O,Et.EXITING_OVERLAY_BACKGROUND,w)));let P=n[T].renderedOrigin(o).subtract1(a),H=(S=(y=n[T].node())==null?void 0:y.size())!=null?S:ve.FrozenVector_new1(),re=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(t.transitionParameters.transitionType)!=-1?o.size().subtract1(P.add1(H)):P,q=H.add1(re),W=()=>q.multiply1(c.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress())),x=this._renderTreeForOverlay2(n[T],o,T,w,p,W);p!=null&&p.removeEntry(n[T].id()),x!=null&&(x=pt.forOpacity(x,Et.EXITING_OVERLAY,()=>c.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),x=pt.forTranslation(x,Et.EXITING_OVERLAY,W),_.push(x))}let m=[];for(let T=u,I=r.length;T<I;T=T+1){let O=Ce.renderTreeForOverlayBackground(r[T].backgroundAppearance(),o.canvasSpaceBoundingBox()),w=null;O!=null&&(w=()=>this.easedTransitionProgress(),m.push(pt.forOpacity(O,Et.ENTERING_OVERLAY_BACKGROUND,w)));let P=r[T].renderedOrigin(o).subtract1(a),H=(b=(g=r[T].node())==null?void 0:g.size())!=null?b:ve.FrozenVector_new1(),re=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(t.transitionParameters.transitionType)!=-1?o.size().subtract1(P.add1(H)):P,q=H.add1(re),W=()=>q.multiply1(c.enteringFrameTransition().interpolateTranslation(this.easedTransitionProgress())),x=this._renderTreeForOverlay2(r[T],o,T,w,p,W);x!=null&&(x=pt.forOpacity(x,Et.ENTERING_OVERLAY,()=>c.enteringFrameTransition().interpolateOpacity(this.easedTransitionProgress())),x=pt.forTranslation(x,Et.ENTERING_OVERLAY,W),m.push(x))}let A=[];if(ce.List_append2(A,l),c.isDissolve()){let T=Et.DISSOLVE_TRANSITION,I=ze.wrap(_),O=ze.wrap(m);A.push(new Ar(I,O,T,()=>this.easedTransitionProgress()))}else ce.List_append2(A,_),ce.List_append2(A,m);return e.cachedRenderTree=ze.wrap(A),e.cachedRenderTree}_onBeforeFrameForTransition(){if(this._ongoingTransition!=null&&(this._transitionProgressTracker.advanceToNextFrame(),!this._transitionProgressTracker.isTransitionInProgress()))switch(this._maybeLogPerformanceMetricsForTransition(),this._transitionProgressTracker.transitionEnded()){case qr.TransitionEndedAction.COMMIT:{this._appState.prototypeState().commitStateChange();break}case qr.TransitionEndedAction.ABORT:{this._appState.prototypeState().abortStateChange();break}}}_onBeforeFrameForHsm(){this._hsmTransitionMap.size!=0&&Array.from(this._hsmTransitionMap.keys()).forEach(e=>{if(Array.from(this._hsmTransitionMap.keys()).indexOf(e)!=-1){let t=this._hsmTransitionMap.get(e),n=t.tracker;if(n.advanceToNextFrame(),!n.isTransitionInProgress()){let r=n.transitionEnded(),o=this._appState.prototypeState(),a=t.change;if(o.getStateMachineInitiatedChange(a.stablePath)==a)switch(r){case qr.TransitionEndedAction.COMMIT:{o.commitChangesBelowInstanceTransitionRoot(a.stablePath);let s=this._appState.scene().findNode3(a.stablePath);s!=null&&this._dirtinessTracker.dirtyNode(s);break}case qr.TransitionEndedAction.ABORT:{o.abortInstanceStateChange(a.stablePath);break}}}}})}currentCanvasSpacePreviewBounds(){var n;if(this._ongoingTransition!=null&&this.ongoingPrototypeStateChange().transitionParameters.transitionType!="INSTANT_TRANSITION"){let o=this._appState.prototypeState(),a=o.lastNodeForBaseScreen(),s=(n=o.nextNodeForBaseScreen())!=null?n:o.lastNodeForBaseScreen();return this.canvasSpacePreviewBoundsForTransition(a,s)}let t=this._appState.baseScreenNode();return this.canvasSpacePreviewBoundsForTransition(t,t)}currentCanvasSpaceFrameBounds(){var n;if(this._ongoingTransition!=null&&this.ongoingPrototypeStateChange().transitionParameters.transitionType!="INSTANT_TRANSITION"){let o=this._appState.prototypeState(),a=o.lastNodeForBaseScreen(),s=(n=o.nextNodeForBaseScreen())!=null?n:o.lastNodeForBaseScreen();return this.canvasSpaceFrameBoundsForTransition(a,s)}let t=this._appState.baseScreenNode();return this.canvasSpaceFrameBoundsForTransition(t,t)}canvasSpacePreviewBoundsForTransition(e,t){if(e==null&&t==null)return null;if(!ne.equals(e==null?void 0:e.id(),t==null?void 0:t.id())){let n=ve.FrozenVector_ZERO,r=ve.FrozenVector_ZERO,o=0,a=0;e!=null&&(n=e.canvasSpaceBoundingBox().size(),e.strokeGeometry()!=null&&e.strokeGeometry().bounds.isFinite()&&e.strokeAlign()!="INSIDE"&&(o=Math.abs(e.strokeGeometry().bounds.left()))),r=t.canvasSpaceBoundingBox().size(),t.strokeGeometry()!=null&&t.strokeGeometry().bounds.isFinite()&&t.strokeAlign()!="INSIDE"&&(a=Math.abs(t.strokeGeometry().bounds.left()));let s=n.max2(r),l=new U(0,0,s.x(),s.y()),d=Math.max(o,a),c=oe.new2().translatedBy1(t.canvasSpaceBoundingBox().center()).translatedBy1(l.center().negative());return l.transformInto1(l,c),l.expand1(d),l}return t.canvasSpacePreviewBounds()}canvasSpaceFrameBoundsForTransition(e,t){if(e==null&&t==null)return null;if(!ne.equals(e==null?void 0:e.id(),t==null?void 0:t.id())){let n=e!=null?e.size():ve.FrozenVector_ZERO,r=t.size(),o=n.max2(r),a=new U(0,0,o.x(),o.y());return a.transformInto1(a,t.absoluteTransform()),a}return e.canvasSpaceBoundingBox()}ongoingPrototypeStateChange(){var e;return(e=this._ongoingTransition)==null?void 0:e.change}transitionProgressTracker(){return this._transitionProgressTracker}renderLayerByLayerActivate(e){this._renderer.renderLayerByLayerActivate(e)}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}_createContext(){return new N.HTMLContext}attachTo(e){e.element().appendChild(this._context.gl().canvas)}removeFrom(e){e.element().removeChild(this._context.gl().canvas),this._uninitialize()}};Yr.VERBOSE_LOGS=!1,Yr.PERF_TRACKING=!1;var Xa=Yr;(t=>{class i{constructor(r,o){this.change=null,this.viewportBeforeTransition=null,this.cachedRenderTree=null,this.change=r,this.viewportBeforeTransition=new hi,this.viewportBeforeTransition.copyFrom(o)}}t.TransitionState=i;class e{constructor(r,o,a){this.tracker=r,this.progress=o,this.change=a}}t.InstanceSwapTransition=e})(Xa||(Xa={}));var Ce;(Ge=>{function i(D,V,J){if(D>Ge.GEN_DURATION_LOG_THRESHOLD_S){let le=`${kc[V]}${J}`;Ge._trackingKeys.has(le)||(Be.trackEvent1("Slow Render Tree Generation",new Map([["duration",D],["frameRole",V],["callSite",J]])),Ge._trackingKeys.add(le))}}Ge._logIfNecessary=i;function e(D,V){let J=new cs;Be.appTimerStart("generateRenderTree");let le=D.renderTree();return Be.appTimerStop("generateRenderTree"),i(J.elapsedSeconds(),1,V),le}Ge.renderTreeWithPerfLogging1=e;function t(D,V,J){let le=new cs;Be.appTimerStart("generateRenderTree");let ue=D.renderTree2(V);return Be.appTimerStop("generateRenderTree"),i(le.elapsedSeconds(),1,J),ue}Ge.renderTreeWithPerfLogging2=t;function n(D,V,J){let le=new cs;Be.appTimerStart("generateRenderTree");let ue=D.renderTreeForBaseScreen2(V);return Be.appTimerStop("generateRenderTree"),i(le.elapsedSeconds(),0,J),ue}Ge.renderTreeForBaseScreenWithPerfLogging=n;function r(D,V,J){let le=new cs;Be.appTimerStart("generateRenderTree");let ue=D.renderTreeForOverlay(V);return Be.appTimerStop("generateRenderTree"),i(le.elapsedSeconds(),1,J),ue}Ge.renderTreeForOverlayWithPerfLogging=r;function o(D,V,J){if(J!=null){let ue=D.getCachedRenderTree();if(ue!=null&&(ue.value==null||!J.overlaps(ue.value.maxBounds)))return null}let le=null;switch(V.mode){case 0:{le=D.renderTree();break}case 2:{le=D.renderTreeWithoutBackgroundBlurs();break}case 1:{le=V.shadowOwnerID==D.uniqueIdentifier()?D.renderTreeForShadowRoot():D.renderTreeForShadowDescendant();break}case 3:{le=V.shadowOwnerID==D.uniqueIdentifier()?D.renderTreeForKnockoutShadowRoot():D.renderTreeForKnockoutShadowDescendant();break}default:throw new Error(`Unhandled render tree GenerateArgs mode: ${Ze[V.mode]}`)}return J!=null&&(le==null||!J.overlaps(le.maxBounds))?null:le}Ge._generateRenderTreeForChild=o;function a(D){return D.scrollDirection()!="NONE"&&D.hasOverflowingContentInScrollDirection()}Ge._nodeCanScroll=a;function s(D,V,J){return X.useBackgroundBlurOpts()?J==null?!0:J.hasVolatileContent()?!1:!re(D,V):!1}Ge._canSkipWrappingInVolatileTransforms=s;function l(D,V){if(D.isRoot())return V;V=W(V,D);let J=D.indexInParent();if(D.moveToParent(),a(D)&&J<u(D)){let le=D.clone(),ue=Et.forScrollOffset(D.uniqueIdentifier());V=pt.forTranslation(V,ue,()=>le.scrollOffset().negative())}return V=l(D,V),D.moveToChildAt(J),V}Ge._wrapInVolatileTransformsForAncestors=l;function d(D,V,J,le,ue,ge){return X.getFeatureFlags().prototypeTemporaryStickyScroll?c(D,V,J,le,ue,ge):p(D,V,J,le,ue,ge)}Ge._generateChildrenWithMasking=d;function c(D,V,J,le,ue,ge){let fe=a(D),Re=V.clone(),me=fe?D.clone():null,Ae=[],qe=[],Pe=J,Ve=le;for(;Pe<Ve;){D.moveToChildAt((Pe=Pe+1)+-1);let ct=Ae.length==0||!ce.List_last(Ae).isStandardScrolling(),Ue=D.parent()!=null&&D.isStickyScrolling(),ee=me!=null&&D.isFixed();Ue?(Ae.push(new An("STICKY_SCROLLS")),ce.List_last(Ae).stickyScrollSceneNodes.push(D.clone())):!Ue&&!ee&&ct&&Ae.push(new An("SCROLLS"));let xn=ee?qe:ce.List_last(Ae).nodes,ao=me==null||D.isFixed()?ue:null;if(!D.isVisibleMask()){let qs=o(D,Re,ao);qs!=null&&xn.push(qs),D.moveToParent();continue}let Zi=D.maskType(),Wo=Re.clone(),ci=o(D,Wo,ao),Aa=[];D.moveToParent();let Sa=u(D);for(;Pe<Ve;){if(D.moveToChildAt(Pe),D.stopsMaskPropagation()||Pe==Sa){D.moveToParent();break}if(ci!=null){let qs=o(D,Re,ao);qs!=null&&Aa.push(qs)}Pe=Pe+1,D.moveToParent()}ci!=null&&Aa.length!=0&&(ge==0&&Pe==Ve?xn.push(ze.wrap(Aa)):Zi=="LUMINANCE"?xn.push(_r.createForLuminanceMask(ci,ze.wrap(Aa))):xn.push(new _r(ci,ze.wrap(Aa))))}let lt=Ae.filter(ct=>ct.nodes.length!=0),He=Et.forScrollOffset(D.uniqueIdentifier()),Je=[];for(let ct of lt)if(ct.isStandardScrolling())if(me!=null){let Ue=h(me,ze.wrap(ct.nodes).optimized());Je.push(pt.forTranslation(Ue,He,()=>me.scrollOffset().negative()))}else ce.List_append2(Je,ct.nodes);else if(ct.isStickyScrolling()){let Ue=[];for(let zn=0,xn=ct.nodes.length;zn<xn;zn=zn+1){let ao=ct.nodes[zn],Zi=ct.stickyScrollSceneNodes[zn];Ue.push(new vr(ao,Zi))}let ee=Ue.map(zn=>{let xn=zn.a,ao=zn.b;return pt.forTranslation(xn,He,()=>Li.getScrollTranslationOfNodeRelativeToParent2(ao).negative())});ce.List_append2(Je,ee)}if(qe.length!=0){let ct=ze.wrap(qe).optimized();Je.push(ct)}return new ze(Je).optimized()}Ge._generateChildrenWithMaskingNew=c;function p(D,V,J,le,ue,ge){let fe=a(D),Re=V.clone(),me=fe?D.clone():null,Ae=[],qe=[],Pe=J,Ve=le;for(;Pe<Ve;){D.moveToChildAt((Pe=Pe+1)+-1);let Je=Ae.length==0||!ce.List_last(Ae).isStandardScrolling(),ct=D.isStandardScrolling()||me==null,Ue=me!=null&&D.isFixed();me!=null&&D.isStickyScrolling()?(Ae.push(new An("STICKY_SCROLLS")),ce.List_last(Ae).stickyScrollNodeStartingTopBounds_DEPRECATED.push(D.absoluteTransform().m12())):ct&&Je&&Ae.push(new An("SCROLLS"));let zn=Ue?qe:ce.List_last(Ae).nodes,xn=me==null||D.isFixed()?ue:null;if(!D.isVisibleMask()){let Sa=o(D,Re,xn);Sa!=null&&zn.push(Sa),D.moveToParent();continue}let ao=D.maskType(),Zi=Re.clone(),Wo=o(D,Zi,xn),ci=[];D.moveToParent();let Aa=u(D);for(;Pe<Ve;){if(D.moveToChildAt(Pe),D.stopsMaskPropagation()||Pe==Aa){D.moveToParent();break}if(Wo!=null){let Sa=o(D,Re,xn);Sa!=null&&ci.push(Sa)}Pe=Pe+1,D.moveToParent()}Wo!=null&&ci.length!=0&&(ge==0&&Pe==Ve?zn.push(ze.wrap(ci)):ao=="LUMINANCE"?zn.push(_r.createForLuminanceMask(Wo,ze.wrap(ci))):zn.push(new _r(Wo,ze.wrap(ci))))}let lt=Ae.filter(Je=>Je.nodes.length!=0);if(me!=null){let Je=Et.forScrollOffset(D.uniqueIdentifier()),ct=[];for(let Ue of lt)if(Ue.isStandardScrolling()){let ee=h(me,ze.wrap(Ue.nodes).optimized());ct.push(pt.forTranslation(ee,Je,()=>me.scrollOffset().negative()))}else if(Ue.isStickyScrolling()){let ee=[];for(let xn=0,ao=Ue.nodes.length;xn<ao;xn=xn+1){let Zi=Ue.nodes[xn],Wo=Ue.stickyScrollNodeStartingTopBounds_DEPRECATED[xn];ee.push(new vr(Zi,Wo))}let zn=ee.map(xn=>{let ao=xn.a,Wo=xn.b-me.absoluteTransform().m12();return pt.forTranslation(ao,Je,()=>me.scrollOffset().y()>Wo?ve.FrozenVector_new4(me.scrollOffset().x(),Wo).negative():me.scrollOffset().negative())});ce.List_append2(ct,zn)}if(qe.length!=0){let Ue=ze.wrap(qe).optimized();ct.push(Ue)}return new ze(ct).optimized()}let He=[];for(let Je of lt)Je.isStandardScrolling()?ce.List_append2(He,Je.nodes):Ke("If the parent frame is not scrolling, there should be no fixed or sticky nodes");return ze.wrap(He).optimized()}Ge._generateChildrenWithMaskingWithoutTemporaryStickyScroll=p;function u(D){for(let V=D.childCount()-1;V>=0;V=V-1){if(D.moveToChildAt(V),!D.isFixed())return D.moveToParent(),V+1;D.moveToParent()}return 0}Ge._indexOfFirstValidFixedChild=u;function h(D,V){if(V.hasAnimatingMedia()||V.hasVolatileContent()||V.hasBackgroundBlurs()||!V.hasNonIsolatedBlends())return V;let J=Oe.firstPaintIfSolidAndOpaqueOrNull(D.fillPaintsToRender());return J==null?V:ze.wrapWithSolidBackground(V,J.color())}Ge._wrapScrollingContentWithSolidBackground=h;function f(D,V,J,le,ue,ge,fe){if(X.useBackgroundBlurOpts(),V.parent()==null)return null;let Re=V.indexInParent();V.moveToParent();let me=_(D,V,J,le,ue,ge,Re,fe);return V.moveToChildAt(Re),me}Ge._generateBackground=f;function _(D,V,J,le,ue,ge,fe,Re){let me=new Ht(2),Ae=d(V,me,0,fe,J,0);if(le!=null){if(a(V)&&fe<u(V)){let Ve=V.clone(),lt=Et.forScrollOffset(Ve.uniqueIdentifier());le=pt.forTranslation(le,lt,()=>Ve.scrollOffset().negative())}Ae==null?Ae=le:Ae=ze.wrap([Ae,le]).optimized()}Ae=Q(Ae,V.clone(),me,1,ue);let qe=!1;V.isFrameLike()&&V.clipsChildren()&&(qe=Oe.containsAtLeastOneVisibleOpaquePaint(V.fillPaintsToRender()));let Pe=X.getViewerMode()==X.ViewerMode.PROTOTYPE&&V.isTopLevel();if(!V.isRoot()&&!qe&&!Pe)Ae=f(me,V,J,Ae,ue,ge,Re);else{let Ve=!Re&&!s(ge,V,Ae);Ve&&(Ae=l(V,Ae)),Ae!=null&&(Ae=new ze([Ae,T(ge,new Ht(2))]),q(ge)&&Ve&&(Ae=pt.forInverseTransform(Ae)))}return Ae}Ge._generateBackgroundFromParent=_;function m(D,V,J){let le=null;switch(V){case 1:{le=D.renderTreeForShadowRoot();break}case 3:{le=D.renderTreeForKnockoutShadowRoot();break}default:throw new Error(`Unhandled shadow mode: ${Ze[V]}`)}if(le!=null&&J!=null){if(D.shouldOptimizeShadowForAnimation(J)){let ue=D.clone(),ge=ue.absoluteTransform(),fe=ge.inverse();le=pt.forTransform(le,Et.forShadowTransformation(ue.uniqueIdentifier()),()=>{let Re=ue.absoluteTransform(),me=Re.inverse();me.multiply(oe.new2().translatedBy1(J)),me.multiply(Re);let Ae=oe.new2();return Ae.multiply(ge),Ae.multiply(me),Ae.multiply(fe),Ae})}else{let ue=oe.translated(J.x(),J.y());le=new Hi(le,ue)}le=le.optimized()}return le}Ge._generateRenderTreeForShadow=m;function A(D,V){if(V.effects()!=null)for(let J=0,le=V.effects().length;J<le;J=J+1){let ue=V.effects()[J];if(ue.type()!="INNER_SHADOW"||!ue.isVisibleForRendering())continue;let ge=m(V,1,null);if(ge!=null){let fe=m(V,1,ue.blurOffset());if(fe==null)fe=new ze([]);else{if(ue.spread()!=0&&(fe=b(fe,-ue.spread(),V,ue.type()),fe==null))continue;fe=new bo(fe,C.BLACK)}ge=new bo(ge,C.BLACK);let Re=_r.createForInnerShadow(ge,new ro(ue.blurRadius(),fe,U.INVALID),C.withAlpha(ue.blurColor(),Math.ceil(ue.opacity()*255)|0));Re=new oo(ue.blendMode(),1,Re),D!=null?D=new si(new ze([D,Re])):D=Re}}return D}Ge._wrapWithInnerShadows=A;function y(D){let V=D.renderableContentType();if(V!=In.RenderableContentType.RENDERABLE_GEOMETRY&&V!=In.RenderableContentType.RENDERABLE_TEXT&&V!=In.RenderableContentType.RENDERABLE_GROUP||V==In.RenderableContentType.RENDERABLE_GROUP&&D.childCount()>0&&!D.clipsChildren())return!1;let J=D.fillPaints(),le=D.strokePaints(),ue=D.fillGeometry(),ge=ue!=null&&ue.regions.length!=0,fe=D.strokeGeometry(),Re=fe!=null&&fe.regions.length!=0,me=ge&&J!=null&&Oe.containsAtLeastOneVisibleOpaquePaint(J),Ae=!Re||le==null||Oe.containsAtLeastOneVisibleOpaquePaint(le);if(V==In.RenderableContentType.RENDERABLE_TEXT){let Pe=D.textData().styleOverrideTable().styleByID2();for(let Ve of Array.from(Pe.keys())){let lt=Pe.get(Ve),He=Sn.get(lt,59,null);if(He!=null&&!Oe.containsAtLeastOneVisibleOpaquePaint($.asPaintData(He))){me=!1;break}}}return me&&(Ae||D.strokeAlign()=="INSIDE")}Ge._hasOpaqueGeometry=y;function S(D,V){let J=D.isInsideOutlineMask(),le=[],ue=[],ge=null,fe=M(V,D,0),Re=M(V,D,1);if(D.renderableContentType()==In.RenderableContentType.RENDERABLE_TEXT)bt(le,D,fe,D.scene(),J,V);else{let He=V.mode==3?0:1;tt(le,D,0,fe,D.uniqueIdentifier(),V,He)}tt(ue,D,1,Re,D.uniqueIdentifier(),V,1);let me=D.size().withOnesForZeros(),Ae=D.strokeAlign();V.isForShadows()&&Ae=="INSIDE"&&xt(le)&&xt(ue)&&(ue.length=0);let qe=D.effects(),Pe=D.absoluteTransform();if(Vn(le)&&Vn(ue)&&!V.isForShadows()&&sn(qe)&&!(Ge.emulateFullscreenRenderingBugs&&Vt(qe,"FOREGROUND_BLUR")&&Vt(qe,"INNER_SHADOW"))){let He=[],Je=[];ht(Pe,le,me,He);let ct=A(ze.wrap(He),D);return ge=new Se(2),Je.push(ct),Ae=="CENTER"?ht(Pe,ue,me,Je):Ut(Ae,Pe,le,ue,me,Je),new hn(ze.wrap(Je),ge)}if(Ae=="CENTER"||le.length==0){let He=[];for(let Je of[le,ue])ht(Pe,Je,me,He);return new hn(ze.wrap(He),ge)}if(fe!=null&&Re!=null&&(Oe.isIsolated(fe)&&Oe.isIsolated(Re)||V.isForShadows())&&ue.length!=0){let He=[],Je=[];for(let Ue of le)Oe.isEmojiPaint(Ue.paints)?He.push(Ue):Je.push(Ue);let ct=[];return ht(Pe,He,me,ct),ct.push(new Hd(Pe,Je,ue,me,Ae=="INSIDE"?0:1)),new hn(ze.wrap(ct),ge)}let lt=[];return ht(Pe,le,me,lt),Ut(Ae,Pe,le,ue,me,lt),new hn(ze.wrap(lt),ge)}Ge._generateRenderTreeForGeometry=S;function g(D,V){if(!D.visible()||D.opacity()<=0&&!(2&D.willChange()))return null;let J=null,le=0;switch(D.renderableContentType()){case In.RenderableContentType.NON_RENDERABLE:return null;case In.RenderableContentType.RENDERABLE_GEOMETRY:case In.RenderableContentType.RENDERABLE_TEXT:{let ue=S(D,V);J=ue.node,ue.layerWrap!=null&&(le=ue.layerWrap.value);break}case In.RenderableContentType.RENDERABLE_GROUP:{!(V.isForShadows()&&D.clipsChildren()&&Oe.containsAtLeastOneVisibleNotFullyTransparentPaint(D.fillPaintsToRender()))&&(J=d(D,V,0,D.childCount(),null,1));break}case In.RenderableContentType.CUSTOM_RENDER_TREE:{le=2,J=D.customRenderTree(V);break}}return Q(J,D,V,le,0)}Ge.generateRenderTree=g;function b(D,V,J,le){if(!J.isSpreadEligibleNode())return D;if(D.op()==10){let Ue=D,ee=b(Ue.child,V,J,le);return ee==null?null:new pt(ee,Ue.id,Ue.property,Ue.getter)}else if(D.op()==11){let Ue=D,ee=b(Ue.child,V,J,le);return ee==null?null:new Hi(ee,Ue.transform)}else if(D.op()==2){let ee=b(D.child,V,J,le);return ee==null?null:new si(ee)}else if(D.op()==12){let Ue=D,ee=Ue.startChild!=null?b(Ue.startChild,V,J,le):null,zn=Ue.endChild!=null?b(Ue.endChild,V,J,le):null;return ee!=null||zn!=null?new Ar(ee,zn,Ue.id,Ue.progressFn):null}let ue=J.fillGeometry()!=null&&J.fillGeometry().regions.length!=0&&Oe.containsAtLeastOneVisiblePaint(J.fillPaints()),ge=J.strokeGeometry()!=null&&J.strokeGeometry().regions.length!=0&&Oe.containsAtLeastOneVisiblePaint(J.strokePaints()),fe=ue&&!ge,Re=!ue&&ge,me=null,Ae=D,qe=()=>{Be.trackEvent1("unexpected_spread_shadow_node",new Map([["sceneNode",J.paintsDebugString()],["renderNode",D.debugString1()]]))};for(;me==null;)switch(Ae.op()){case 3:case 4:{me=Ae;break}case 5:{Ae=Ae.alpha;break}case 7:{Ae=Ae.child;break}case 1:{let Ue=null;Fn.visitEachNodeInTree(Ae,ee=>{(ee.op()==3||ee.op()==4)&&(Ue==null||Fn.geometryNodePaintSize(ee).area()>Fn.geometryNodePaintSize(Ue).area())&&(Ue=ee)},null),Ae=Ue;break}case 0:{Ae=Ae.child,qe();break}case 9:{Ae=Ae.alpha,qe();break}case 6:{Ae=Ae.child,qe();break}default:return qe(),Ke("Unexpected wrapped node for spread shadow"),D}if(me==null||me.op()!=3&&me.op()!=4)return Ke(`Failed to find geometryNode after search; got ${fr[me.op()]}`),D;let Pe=null,Ve=null,lt=null;switch(me.op()){case 3:{let Ue=me;Pe=Ve=Ue.paintSize,lt=Ue.transform;break}case 4:{let Ue=me;Pe=Ve=Ue.paintSize,lt=Ue.transform;break}default:return Ke(`Unexpected node type ${fr[me.op()]}`),D}if(ge&&J.strokeAlign()!="INSIDE"){let Ue=J.strokeAlign()=="OUTSIDE"?2:1;Pe=Pe.add(J.strokeWeight()*Ue)}if(le=="DROP_SHADOW"){if(Pe.x()<=-(2*V)||Pe.y()<=-(2*V))return null}else le=="INNER_SHADOW"&&(V=Math.max(V,-Math.min(Pe.x(),Pe.y())/2));let He=Ve.add(2*V),Je=He.divide1(Ve),ct=oe.new2().translatedBy2(-V,-V).scaledBy1(Je);if(fe){let Ue=J.fillGeometryForSpread(ct,V,Oe.SOLID_BLACK);return new Kn(lt,Ue,He)}else if(Re){let Ue=J.strokeGeometryForSpread(ct,V,Ve,Oe.SOLID_BLACK);if(Ue==null){if(le=="DROP_SHADOW")return null;Ue=new on(new Lt(Pt.fromRect(Jn.FrozenRect_EMPTY),"NONZERO"),Oe.SOLID_BLACK)}return new Kn(lt,Ue,He)}else{let Ue=J.strokeGeometryForSpread(ct,V,Ve,Oe.SOLID_BLACK);return Ue==null?null:new Kn(lt,Ue,He)}}Ge._blurChildWithSpread=b;function T(D,V){let J=[];for(let le=0,ue=D.effects().length;le<ue;le=le+1){let ge=D.effects()[le];if(ge.type()=="DROP_SHADOW"&&ge.isVisibleForRendering()){if(V.mode==2&&!ge.showShadowBehindNode())continue;let fe=m(D,1,ge.blurOffset());if(fe!=null){if(ge.spread()!=0&&(fe=b(fe,ge.spread(),D,ge.type()),fe==null))continue;let Re=new bo(fe,C.multiplyOpacity(ge.blurColor(),ge.opacity())),me=null,Ae=Re.optimized();if(Ae!=null&&(me=new ro(ge.blurRadius(),new si(Ae),U.INVALID)),me!=null&&!ge.showShadowBehindNode()&&!y(D)){let qe=m(D,3,null);me=new si(_r.createForKnockoutShadow(qe,me))}me!=null&&J.push(new oo(ge.blendMode(),1,me))}}}return new ze(J)}Ge._dropShadowsForNode=T;function I(D){let V=D.parent();if(V==null)return D.absoluteTransform();let J=V.absoluteTransform().clone();return J.invert()?(J.multiply(D.absoluteTransform()),J):oe.new2()}Ge._transformRelativeToParent=I;function O(D,V,J,le,ue,ge){let fe=V.size(),Re=le>0&&V.clipsChildren()&&J!=0,me=null,Ae=null,qe=M(ge,V,0);ge.isForShadows()&&Oe.containsAtLeastOneVisibleNotFullyTransparentPaint(qe)&&(qe=vt(1)),Oe.forEachPaintWithVideo(qe,lt=>{let He=lt.video().getVideoManager();He!=null&&He.associatePaintWithNode(lt,V)});let Pe=V.absoluteTransform(),Ve=[];if(Re){me=Lt.getOrCreate(Pt.fromRect(U.new4(ve.FrozenVector_ZERO,fe).expandedBy1(le)),"ODD");let lt=Oe.isolatedPaints(qe);for(let He=0,Je=lt.length;He<Je;He=He+1)ue.push(new on(me,lt[He]))}else if(V.fillGeometry()!=null&&V.fillGeometry().regions.length!=0)tt(ue,V,0,qe,V.uniqueIdentifier(),ge,1);else if(de(0,V)){Ae=Lt.getOrCreate(Pt.fromRect(U.new4(ve.FrozenVector_ZERO,fe)),"ODD");let lt=Oe.isolatedPaints(qe);for(let He=0,Je=lt.length;He<Je;He=He+1)ue.push(new on(Ae,lt[He]))}if(ht(Pe,ue,fe,Ve),!V.clipsChildren()){let lt=[],He=M(ge,V,1);tt(lt,V,1,He,V.uniqueIdentifier(),ge,1),V.strokeAlign()=="CENTER"||ue.length==0?ht(Pe,lt,fe,Ve):Ut(V.strokeAlign(),Pe,ue,lt,fe,Ve)}return D!=null&&Ve.push(D),D=ze.wrap(Ve),D}Ge._wrapTreeWithFrameFillPaints=O;function w(D,V,J,le,ue){let ge=V.size(),fe=le>0&&V.clipsChildren()&&J!=0,Re=null,me=null,Ae=V.absoluteTransform();if(fe?Re=Lt.getOrCreate(Pt.fromRect(U.new4(ve.FrozenVector_ZERO,ge).expandedBy1(le)),"ODD"):me=Lt.getOrCreate(Pt.fromRect(U.new4(ve.FrozenVector_ZERO,ge)),"ODD"),V.clipsChildren()){let qe=[],Pe=[];fe?qe.push(new on(Re,vt(1))):V.fillGeometry()!=null&&V.fillGeometry().regions.length!=0?tt(qe,V,0,vt(1),V.uniqueIdentifier(),ue,1):qe.push(new on(me,vt(1))),ht(Ae,qe,ge,Pe),D=new _r(ze.wrap(Pe),D)}return D}Ge._wrapTreeWithFrameMasks=w;function P(D){return D.containerSupportsFillStrokeAndCorners()?D.fillPaints():D.fillPaintsToRender()}Ge._fillPaintsToRender=P;function H(D,V,J,le){let ue=V.size();if(!ue.isZero()){let ge=null,fe=V.clipsChildren(),Re=P(V);if(Oe.containsAtLeastOneVisiblePaint(Re)){let me=[],Ae=[],qe=null;J.isForShadows()&&Oe.containsAtLeastOneVisibleNotFullyTransparentPaint(Re)?qe=vt(1):qe=te(J,Re,0),ge=Lt.getOrCreate(Pt.fromRect(U.new4(ve.FrozenVector_ZERO,ue).expandedBy1(fe?le:0)),"ODD");let Pe=Oe.isolatedPaints(qe);for(let Ve=0,lt=Pe.length;Ve<lt;Ve=Ve+1){let He=Pe[Ve];me.push(new on(ge,He))}ht(V.absoluteTransform(),me,ue,Ae),D!=null&&Ae.push(D),D=ze.wrap(Ae)}if(D!=null&&fe){ge==null&&(ge=Lt.getOrCreate(Pt.fromRect(U.new4(ve.FrozenVector_ZERO,ue).expandedBy1(le)),"ODD"));let me=new on(ge,vt(1));D=new _r(new Kn(V.absoluteTransform(),me,ue),D)}}return D}Ge._wrapTreeWithFrameBackgroundOrFillIgnoringGeometry=H;function re(D,V){let J=D.clone(),le=J.parent(),ue=!0;for(;J!=null;){if(V!=null&&J.uniqueIdentifier()==V.uniqueIdentifier())return!1;if(1&J.willChange()||J.overlayRenderData()!=null)return!0;if(le==null||V!=null&&le.uniqueIdentifier()==V.uniqueIdentifier())return!1;if(!ue){let ge=J.indexInParent();if(a(le)&&ge<u(le))return!0}ue=!1,J=le,le=le.parent()}return!1}Ge._hasVolatileTransformOnAncestor=re;function q(D){return X.useBackgroundBlurOpts()?re(D,null):!0}Ge._needInverseTransform=q;function W(D,V){if(1&V.willChange()){let J=Nt.FrozenAffineTransform_IDENTITY,le=V.parent();le!=null&&(J=le.absoluteTransform());let ue=V.absoluteTransform().clone(),ge=ue.invert(),fe=V.clone();D=pt.forTransform(D,Et.forAnimateableTranslation(V.uniqueIdentifier()),()=>{let me=oe.new2();return me.multiply(J),me.multiply(I(fe)),me.multiply(ue),me});let Re=V.maxTransformScale();Re!=1&&(D=pt.forMaxTransformScale(Re,D))}return D}Ge._wrapTreeInVolatileTransform=W;function x(D,V){if(D.backgroundAppearance.backgroundType=="NONE")return null;let J=ie(D.backgroundAppearance,V.scene().findNode1(V.overrideKey()).canvasSpaceBoundingBox());return J!=null?(D.backgroundTransitionProgress!=null&&(J=pt.forOpacity(J,Et.OVERLAY_BACKGROUND,D.backgroundTransitionProgress)),pt.forInverseTransform(J)):null}Ge._generateRenderTreeForOverlayBackground=x;function F(D,V,J){let le=[];for(let ue=0,ge=D.count();ue<ge;ue=ue+1){let fe=D.keys()[ue];if(fe==V)break;let Re=D.get2(fe),me=Re.overlayNode,Ae=x(Re,J.clone()),qe=me.renderTreeWithoutBackgroundBlurs();if(Ae!=null&&le.push(Ae),qe!=null){let Pe=Re.bounds.center(),Ve=me.canvasSpaceBoundingBox().center(),lt=Pe.subtract1(Ve),He=ct=>()=>ct,Je=pt.forInverseTransform(pt.forTranslation(qe,Et.forOverlayPosition(ue),He(lt)));le.push(Je)}}return new ze(le)}Ge._generateIntermediateOverlays=F;function k(D,V,J,le,ue){let ge=U.new2();ge.copyFrom(D.bounds);let fe=D.baseTlfCursor.clone(),Re=V.overlayRenderData(),me=[],Ae=_(le,fe.clone(),ge,null,ue,V.clone(),fe.childCount(),!1);Ae!=null&&me.push(Ae);let qe=F(Re,D.overlayId,fe.clone());qe!=null&&me.push(qe);let Pe=x(D,fe);Pe!=null&&me.push(Pe);let Ve=null;return D.overlayId!=V.uniqueIdentifier()&&(Ve=f(le,V,J,null,ue,V.clone(),!0),Ve!=null&&(Ve=pt.forInverseTransform(pt.forTranslation(Ve,Et.ENTERING_OVERLAY,()=>(D.transform!=null?D.transform():ve.FrozenVector_new4(0,0)).add1(D.animationTransform!=null?D.animationTransform():ve.FrozenVector_new4(0,0)))))),Ve!=null&&me.push(Ve),new ze(me)}Ge._generateBackgroundBlurForOverlays=k;function G(D,V,J,le){let ue=m(D,1,null);if(ue!=null){let ge=null,fe=null;if(X.useBackgroundBlurOpts()&&(ge=U.new2(),ge.copyFrom(ue.maxBounds)),D.overlayRenderData()!=null){let Re=D.clone(),me=null,Ae=D.overlayRenderData();for(;Re!=null&&(me=Ae.get2(Re.uniqueIdentifier()),me==null);)Re=Re.parent();if(Re==null||me==null)return Ke("Blurred node with overlay data cannot be found in an overlay"),V;ge=U.new2(),ge.copyFrom(me.bounds),fe=k(me,D.clone(),ue.maxBounds,J,le)}else fe=f(J,D,ge,null,le,D.clone(),!1);if(fe!=null){let Re=null,me=xh(ue),Ae=me.op()==3?me:null;Ae!=null&&Ae.geometry.type==_i.PaintedGeometryType.STATIC?Re=Ae.geometryBounds():Re=ue.maxBounds;let qe=new ro(le,fe,Re),Pe=_r.createForBackgroundBlur(ue,qe);V=new ze([Pe,V])}V=Ha.createForBackgroundBlur(V)}return V}Ge._generateBackgroundBlur=G;function M(D,V,J){let le=V.isInsideOutlineMask(),ue=J==0?V.fillPaints():V.strokePaints(),ge=ue!=null&&Oe.containsAtLeastOneVisiblePaint(ue);return le?vt(ge?1:0):te(D,ue,J)}Ge._getFinalizedPaintData=M;function Q(D,V,J,le,ue){let ge=[],fe=le==0&&V.isFrameLike()&&V.containerSupportsFillStrokeAndCorners()&&!V.isGroup()&&V.clipsChildren(),Re=V.isFrameLike()&&!V.size().isZero(),me=V.overlayRenderData()==null&&V.isTopLevel()&&V.isFrameLike()&&Oe.containsAtLeastOneVisibleOpaquePaint(V.fillPaintsToRender()),Ae=!V.containerSupportsFillStrokeAndCorners()||V.isGroup(),qe=Re&&!Ae;Re&&(Ae?D=H(D,V,J,ue):D=O(D,V,le,ue,ge,J)),D!=null&&(D=D.optimized());let Pe=!J.isForShadows()&&V.effects()!=null,Ve=[];if(Pe)if(D!=null){if(J.mode==0)for(let Je=0,ct=V.effects().length;Je<ct;Je=Je+1){let Ue=V.effects()[Je];if(Ue.type()=="BACKGROUND_BLUR"){Ue.isVisibleForRendering()&&!y(V)&&(D=G(V,D,J,Ue.blurRadius()));break}}(le==1||le==0)&&(D=A(D,V)),me||Ve.push(T(V,J))}else me||Ve.push(T(V,J));if(D==null&&Ve.length==0&&!fe)return D;let lt=fe&&V.strokeAlign()=="INSIDE";if(qe&&!lt&&D!=null&&(D=w(D,V,le,ue,J)),fe&&!Ft(V,J,ge)){let Je=V.absoluteTransform(),ct=[],Ue=M(J,V,1),ee=[];D!=null&&ee.push(D),tt(ct,V,1,Ue,V.uniqueIdentifier(),J,1),V.strokeAlign()=="CENTER"||ge.length==0||lt?ht(Je,ct,V.size(),ee):Ut(V.strokeAlign(),Je,ge,ct,V.size(),ee),D=ze.wrap(ee)}else lt=!1;if(fe&&V.strokeAlign()=="OUTSIDE"&&V.clipsChildren()&&(D=si.thatShouldNotBeUnwrappedInOptimization(D)),qe&&lt&&D!=null&&(D=w(D,V,le,ue,J)),D!=null?D=new ze([new ze(Ve),D]):D=new ze(Ve),D!=null&&Pe)for(let Je=0,ct=V.effects().length;Je<ct;Je=Je+1){let Ue=V.effects()[Je];if(Ue.type()=="FOREGROUND_BLUR"){Ue.isVisibleForRendering()&&(D=new ro(Ue.blurRadius(),D,U.INVALID));break}}if(J.isForShadows()&&J.shadowOwnerID==V.uniqueIdentifier())return D.optimized();let He=2&V.willChange()?1:V.opacity();if(D=new oo(V.blendMode(),He,D),D=D.optimized(),D!=null&&2&V.willChange()){let Je=V.clone();D=new pt(D,Et.forAnimateableOpacity(Je.uniqueIdentifier()),4,()=>Je.opacity())}return D!=null&&(D=W(D,V)),D}Ge._wrapTreeWithLayerProperties=Q;function Y(D){if(D==null)return null;let V=!1;for(let le=0,ue=D.length;le<ue;le=le+1){let ge=D[le].asVolatilePaint();if(ge!=null){if(ge.from().image()!=null&&ge.from().image().isDecoded()||ge.from().imageThumbnail()!=null&&ge.from().imageThumbnail().isDecoded()||ge.to().image()!=null&&ge.to().image().isDecoded()||ge.to().imageThumbnail()!=null&&ge.to().imageThumbnail().isDecoded()){V=!0;break}}else if(D[le].asSinglePaint()!=null){let fe=D[le].asSinglePaint();if(fe.image()!=null&&fe.image().isDecoded()||fe.imageThumbnail()!=null&&fe.imageThumbnail().isDecoded()){V=!0;break}}if(!D[le].isEnabledAndVisible()){V=!0;break}}if(!V)return D;let J=[];for(let le=0,ue=D.length;le<ue;le=le+1){if(!D[le].isEnabledAndVisible())continue;let ge=D[le].asVolatilePaint();if(ge!=null){let fe=ge.cloneAsVolatilePaint();fe.from().setDecodedImageIsReady(fe.from().image()!=null&&fe.from().image().isDecoded()),fe.to().setDecodedImageIsReady(fe.to().image()!=null&&fe.to().image().isDecoded()),fe.from().setDecodedImageThumbnailIsReady(fe.from().imageThumbnail()!=null&&fe.from().imageThumbnail().isDecoded()),fe.to().setDecodedImageThumbnailIsReady(fe.to().imageThumbnail()!=null&&fe.to().imageThumbnail().isDecoded()),J.push(fe)}else if(D[le].asSinglePaint()!=null){let fe=D[le].asSinglePaint().cloneAsSinglePaint();fe.setDecodedImageIsReady(fe.image()!=null&&fe.image().isDecoded()),fe.setDecodedImageThumbnailIsReady(fe.imageThumbnail()!=null&&fe.imageThumbnail().isDecoded()),J.push(fe)}}return J}Ge._filteredPaintsWithImageAvailability=Y;function B(D,V,J){if(D!=3||J==1&&V.length==0)return V;let le=[];for(let ue=0,ge=V.length;ue<ge;ue=ue+1){let fe=V[ue];if(fe.type()=="IMAGE"||fe.type()=="EMOJI"||fe.type()=="VIDEO")le.push(fe);else return[se.createSolid(C.BLACK,1)]}return le.length==0&&le.push(se.SOLID_BLACK),le}Ge._filteredPaintsForKnockoutShadow=B;function te(D,V,J){return B(D.mode,Y(V),J)}Ge._substitutePaintsAsNeeded=te;function j(D,V,J,le,ue,ge){if(ne.equals(V.overrideKey(),ne._new(4e7,2)))return!1;let Re=V.strokeGeometry()!=null&&V.strokeGeometry().regions.length!=0&&Oe.containsAtLeastOneVisiblePaint(V.strokePaints());if(le!=0||Re&&!Gt(V,ge,ue))return!1;for(let me of J.regions)if(me.type==1)return!1;switch(V.type()){case"ELLIPSE":{if(V.arcData()==null||Oe.hasEmoji(ue))return!1;let me=V.arcData(),Ae=me.innerRadius<=0,qe=me.endingAngle-me.startingAngle,Pe=Math.abs(qe)>2*Math.PI-.001,Ve=V.size().withOnesForZeros();if(Ae&&Pe&&J.regions.length==1&&J.regions[0].type==0){let He=Ve.divide(2),Je=new ui(He,He.x(),He.y()),ct=new Lt(Je,"NONZERO"),Ue=Oe.isolatedPaints(ue);for(let ee=0,zn=Ue.length;ee<zn;ee=ee+1){let xn=Ue[ee];D.push(new on(ct,xn))}return!0}break}case"RECTANGLE":case"ROUNDED_RECTANGLE":case"FRAME":case"STAMP":case"SYMBOL":case"INSTANCE":{let me=V.roundedRectInfo();if(!Pt.isRoundedRectSupported(me))return!1;let Ae=Pt.fromRoundedRect(me),qe=new Lt(Ae,"NONZERO"),Pe=Oe.isolatedPaints(ue);for(let Ve=0,lt=Pe.length;Ve<lt;Ve=Ve+1){let He=Pe[Ve];D.push(new on(qe,He))}return!0}}return!1}Ge._attemptToGenerateAAAGeometry=j;function ie(D,V){switch(D.backgroundType){case"NONE":return null;case"SOLID_COLOR":{if(V==null)return null;let J=D.backgroundColor,le=1;return Kn.solidColorRect(V,J,le)}}throw new Error(`Unhandled backgroundType ${D.backgroundType}`)}Ge.renderTreeForOverlayBackground=ie;function de(D,V){if(D==0){let J=V.fillPaints(),le=V!=null&&V.clipsChildren();return V!=null&&(le||Oe.containsAtLeastOneVisiblePaint(J)||V.strokeAlign()!="CENTER"&&de(1,V))}else if(D==1){let J=V.strokePaints();return Oe.containsAtLeastOneVisiblePaint(J)&&V.hasNonZeroStrokeWeight()}return!1}Ge._isGeometryNecessary=de;function tt(D,V,J,le,ue,ge,fe){let Re=J==0?V.fillGeometry():V.strokeGeometry();if(J==0&&fe==1&&!de(J,V)&&(Re=null),Re==null||le==null)return;if(Oe.forEachPaintWithVideo(le,Ae=>{let qe=Ae.video().getVideoManager();qe!=null&&qe.associatePaintWithNode(Ae,V)}),V.hasPerRegionFillPaints()&&J==0){V.forEachRegionWithFillPaintBatch((Ae,qe)=>{let Pe=Oe.isolatedPaints(qe);for(let Ve=0,lt=Pe.length;Ve<lt;Ve=Ve+1){let He=Y(Pe[Ve]);Oe.forEachPaintWithVideo(He,ct=>{let Ue=ct.video().getVideoManager();Ue!=null&&Ue.associatePaintWithNode(ct,V)});let Je=Lt.getOrCreate(Ae.path(),Ae.windingRule);D.push(new on(Je,He))}});return}if(j(D,V,Re,J,le,ge))return;let me=Oe.isolatedPaints(le);for(let Ae=0,qe=me.length;Ae<qe;Ae=Ae+1){let Pe=me[Ae],Ve=null,lt=()=>{if(Ve!=null){let He=Ve.compilePaths(),Je=Lt.getOrCreate(He,Ve.windingRule);D.push(new on(Je,Pe)),Ve=null}};for(let He of Re.regions)He.bounds().isEmpty()||(He.type==0?Ve!=null&&Ve.canAddRegion(He)?Ve.add(He):(lt(),Ve=new kt(He)):(lt(),D.push(new Kl(()=>new Lt(He.path(),He.windingRule),Pe,He.bounds(),Et.forDynamicGeometry(ue)))));lt()}}Ge._generateGeometries=tt;function bt(D,V,J,le,ue,ge){let fe=V.textGeometry();if(fe==null||J==null)return;let Re=Ae=>{var Ve,lt,He;let qe=jn.getEmojiImageUrl(Ae),Pe=(He=(Ve=V.derivedTextData())==null?void 0:Ve.usedEmojiImages())!=null?He:(lt=V.textData())==null?void 0:lt.usedEmojiImagesDEPRECATED();for(let Je of Pe)if(Je.url()==qe){let ct=new se("EMOJI");ct.setOpacity(1),ct.setBlendMode("NORMAL"),ct.setImage(Je);let Ue=[ct].slice();return te(ge,Ue,0)}return null},me=Ae=>{let qe=fe.paintOverrides.get(Ae,le);return qe!=null?te(ge,qe,0):te(ge,J,0)};for(let Ae=0,qe=fe.regions.length;Ae<qe;Ae=Ae+1){let Pe=fe.regions[Ae];if(fe.emojiCodepoints[Ae].length>0){let He=Lt.getOrCreate(Pe.path(),Pe.windingRule),Je=Re(fe.emojiCodepoints[Ae]);if(Je==null)continue;D.push(new on(He,Je));continue}let Ve=me(Pe.styleID);if(Ve==null)continue;for(let He=0,Je=Ve.length;He<Je;He=He+1){let ct=Ve[He].asSinglePaint();(ct==null?void 0:ct.video())!=null&&ct.video().getVideoManager().associatePaintWithNode(ct,V)}let lt=Oe.isolatedPaints(Ve);for(let He=0,Je=lt.length;He<Je;He=He+1){let ct=lt[He];if(!Pe.bounds().isEmpty()){let Ue=Lt.getOrCreate(Pe.path(),Pe.windingRule);D.push(new on(Ue,ct))}}}}Ge._generateGeometriesForText=bt;function ht(D,V,J,le){for(let ue=0,ge=V.length;ue<ge;ue=ue+1){let fe=V[ue];if(Oe.containsAtLeastOneVisiblePaint(fe.paints)){let Re=new Kn(D,fe,J),me=fe.paints;me.length!=0&&me[0].blendMode()!="NORMAL"?le.push(new oo(me[0].blendMode(),1,Re)):le.push(Re)}}}Ge._generateFills=ht;function Ft(D,V,J){if(V.mode!=1||D.strokeAlign()!="INSIDE")return!1;for(let le=0,ue=J.length;le<ue;le=le+1){let ge=J[le];if(Oe.containsAtLeastOneVisibleOpaquePaint(ge.paints))return!0}return!1}Ge._canSkipInsideStrokesForShadows1=Ft;function Gt(D,V,J){return V.mode!=1||D.strokeAlign()!="INSIDE"?!1:Oe.containsAtLeastOneVisibleOpaquePaint(J)}Ge._canSkipInsideStrokesForShadows2=Gt;function Ut(D,V,J,le,ue,ge){let fe=[];for(let Re=0,me=J.length;Re<me;Re=Re+1){let Ae=J[Re];fe.push(new on(Ae.path(),Oe.EMPTY))}for(let Re=0,me=le.length;Re<me;Re=Re+1){let Ae=le[Re],qe=Ae.paints,Pe=[Ae],Ve=new Hd(V,fe,Pe,ue,D=="INSIDE"?0:1);qe.length!=0&&ge.push(new oo(qe[0].blendMode(),1,Ve))}}Ge._generateFillStrokes=Ut;function vt(D){return D==1?Oe.SOLID_BLACK:Oe.EMPTY}Ge._outlineMaskPaintData=vt;function Vn(D){for(let V=0,J=D.length;V<J;V=V+1){let le=D[V];if(Oe.containsAtLeastOneVisiblePaint(le.paints))return!0}return!1}Ge._isAnyGeometryVisible=Vn;function Vt(D,V){for(let J=0,le=D.length;J<le;J=J+1){let ue=D[J];if(ue.type()==V&&ue.isEnabledAndVisible())return!0}return!1}Ge._hasVisibleEffectsOfType=Vt;function sn(D){for(let V=0,J=D.length;V<J;V=V+1)if(D[V].isEnabledAndVisible())return!0;return!1}Ge._hasVisibleEffects=sn;function xt(D){if(D.length!=1)return!1;let V=D[0].paints;return V.length==1&&V[0].type()=="SOLID"}Ge._isSingleSolidGeometry=xt;function mt(){return Ge._flushBeforeMasks}Ge.flushBeforeMasks=mt;function _t(D){Ge._flushBeforeMasks=D}Ge.setFlushBeforeMasks=_t;let Ze;(ue=>(ue[ue.NORMAL=0]="NORMAL",ue[ue.SHADOW=1]="SHADOW",ue[ue.WITHOUT_BACKGROUND_BLURS=2]="WITHOUT_BACKGROUND_BLURS",ue[ue.KNOCKOUT_SHADOW=3]="KNOCKOUT_SHADOW"))(Ze=Ge.RenderMode||(Ge.RenderMode={}));let Ct;(J=>(J[J.INCLUDE=0]="INCLUDE",J[J.IGNORE=1]="IGNORE"))(Ct=Ge.IncludeUnnecessaryGeometry||(Ge.IncludeUnnecessaryGeometry={}));class Ht{constructor(){if(arguments.length==2){let V=arguments[0],J=arguments[1];this.mode=0,this.shadowOwnerID=null,this.mode=V,this.shadowOwnerID=J}else if(arguments.length==1){let V=arguments[0];this.mode=0,this.shadowOwnerID=null,this.mode=V,this.shadowOwnerID=null}}clone(){return new Ht(this.mode,this.shadowOwnerID)}isForShadows(){return this.mode==1||this.mode==3}}Ge.GenerateArgs=Ht;let xe;(J=>(J[J.FILL=0]="FILL",J[J.STROKE=1]="STROKE"))(xe=Ge.GeometryType||(Ge.GeometryType={}));let Dt;(J=>(J[J.IGNORE=0]="IGNORE",J[J.INCLUDE=1]="INCLUDE"))(Dt=Ge.LastMask||(Ge.LastMask={}));class An{constructor(V){this.nodes=null,this.scrollBehavior=null,this.stickyScrollSceneNodes=null,this.stickyScrollNodeStartingTopBounds_DEPRECATED=null,this.nodes=[],this.scrollBehavior=V,this.stickyScrollSceneNodes=[],this.stickyScrollNodeStartingTopBounds_DEPRECATED=[]}isFixed(){return this.scrollBehavior=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"}isStickyScrolling(){return this.scrollBehavior=="STICKY_SCROLLS"}isStandardScrolling(){return this.scrollBehavior=="SCROLLS"}}Ge.ContiguousRenderNodes=An;class hn{constructor(V,J){this.node=V,this.layerWrap=J}}Ge.GeometryRenderTreeResult=hn;let Xt;(le=>(le[le.WITH_INNER_SHADOWS_AND_TOP_STROKE=0]="WITH_INNER_SHADOWS_AND_TOP_STROKE",le[le.WITH_INNER_SHADOWS_ONLY=1]="WITH_INNER_SHADOWS_ONLY",le[le.WITHOUT_LAYER_WRAPS=2]="WITHOUT_LAYER_WRAPS"))(Xt=Ge.LayerWrap||(Ge.LayerWrap={}));let Me;(J=>(J[J.FILL_PAINT_DATA=0]="FILL_PAINT_DATA",J[J.STROKE_PAINT_DATA=1]="STROKE_PAINT_DATA"))(Me=Ge.PaintType||(Ge.PaintType={}));class st{constructor(V){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.minX=V.left(),this.maxX=V.right(),this.minY=V.top(),this.maxY=V.bottom()}}Ge.RBushRect=st;class kt{constructor(V){this.windingRule=null,this._uniquePathsOnly=!1,this._collisionTracker=new rv.default,this._paths=[],this.windingRule=V.windingRule,this._uniquePathsOnly=V.path()instanceof Eo,this.add(V)}compilePaths(){if(this._paths.length==1)return this._paths[0];if(this._uniquePathsOnly){let J=[];for(let ge of this._paths)J.push(ge.handle);let le=L._prototypeLib.modules().uniquePathHelpers.getVolatileConcatenatedPaths(J),ue=new Uint8Array(le);return new $e(new br(ue))}let V=this._paths[0].toBezierPath().getMutableClone();for(let J=1,le=this._paths.length;J<le;J=J+1)V.append(this._paths[J].toBezierPath());return V}canAddRegion(V){return V.windingRule==this.windingRule&&this._uniquePathsOnly==V.path()instanceof Eo&&!this._collisionTracker.collides(new st(V.path().bounds()))}add(V){this._paths.push(V.path()),this._collisionTracker.insert(new st(V.path().bounds()))}}Ge.PathBatch=kt;let Ne;(J=>(J[J.ALL_PAINTS_INVISIBLE=0]="ALL_PAINTS_INVISIBLE",J[J.HAS_VISIBLE_PAINTS=1]="HAS_VISIBLE_PAINTS"))(Ne=Ge.PaintVisibility||(Ge.PaintVisibility={}));let We;(V=>{function D(J){return Ze[J]}V.RenderMode_toString=D})(We=Ge.in_RenderMode||(Ge.in_RenderMode={}));let nt;(V=>{function D(J){return Ct[J]}V.IncludeUnnecessaryGeometry_toString=D})(nt=Ge.in_IncludeUnnecessaryGeometry||(Ge.in_IncludeUnnecessaryGeometry={}));let v;(V=>{function D(J){return xe[J]}V.GeometryType_toString=D})(v=Ge.in_GeometryType||(Ge.in_GeometryType={}));let R;(V=>{function D(J){return Dt[J]}V.LastMask_toString=D})(R=Ge.in_LastMask||(Ge.in_LastMask={}));let z;(V=>{function D(J){return Xt[J]}V.LayerWrap_toString=D})(z=Ge.in_LayerWrap||(Ge.in_LayerWrap={}));let Z;(V=>{function D(J){return Me[J]}V.PaintType_toString=D})(Z=Ge.in_PaintType||(Ge.in_PaintType={}));let ae;(V=>{function D(J){return Ne[J]}V.PaintVisibility_toString=D})(ae=Ge.in_PaintVisibility||(Ge.in_PaintVisibility={})),Ge.GEN_DURATION_LOG_THRESHOLD_S=.15,Ge._trackingKeys=new Set,Ge.EPSILON=.001,Ge.emulateFullscreenRenderingBugs=!0,Ge._flushBeforeMasks=!1})(Ce||(Ce={}));var Dh=class{constructor(e,t,n,r){this.bufferArea=e,this.hasNoCurves=t,this.hasNoOverlaps=n,this.hasNoCurvesAndSameOrientation=r}},_i=class{path(){throw new Error("Not implemented")}optimized(){throw new Error("Not implemented")}equals(e){throw new Error("Not implemented")}withNewPaints(e){throw new Error("Not implemented")}canBeAnalyticallyAntialiased(){return this.path().path().canBeAnalyticallyAntialiased()}constructor(e,t,n){this.type=e,this.paints=t,this.maxBounds=n}};(t=>{let i;(o=>(o[o.STATIC=0]="STATIC",o[o.DYNAMIC=1]="DYNAMIC"))(i=t.PaintedGeometryType||(t.PaintedGeometryType={}));let e;(r=>{function n(o){return t.PaintedGeometryType[o]}r.PaintedGeometryType_toString=n})(e=t.in_PaintedGeometryType||(t.in_PaintedGeometryType={}))})(_i||(_i={}));var on=class i extends _i{constructor(t,n){super(0,n,t.bounds());this._isOptimized=!1,this._path=null,this._path=t}path(){return this._path}withNewPaints(t){return new i(this._path,t)}equals(t){if(this.type!=t.type)return!1;if(this.path()==null||t.path()==null){if(this.path()==null!=(t.path()==null))return!1}else if(!this.path().equals(t.path()))return!1;if(this.paints==null||t.paints==null){if(this.paints==null!=(t.paints==null))return!1}else if(!Oe.equals(this.paints,t.paints))return!1;return!0}optimized(){if(this._isOptimized)return this;let t=Oe.optimize(this.paints);return this.paints!=t?new i(this.path(),t):(this._isOptimized=!0,this)}},Kl=class i extends _i{constructor(t,n,r,o){super(1,n,r);this._isOptimized=!1,this._computePath=null,this.id=null,this._computePath=t,this.id=o}path(){return this._computePath()}withNewPaints(t){return new i(this._computePath,t,this.maxBounds,this.id)}equals(t){return this.type==t.type&&this.id==t.id}optimized(){if(this._isOptimized)return this;let t=Oe.optimize(this.paints);return this.paints!=t?new i(this._computePath,t,this.maxBounds,this.id):(this._isOptimized=!0,this)}},fr=(h=>(h[h.METADATA=0]="METADATA",h[h.GROUP=1]="GROUP",h[h.SUPERSAMPLE_GROUP=2]="SUPERSAMPLE_GROUP",h[h.FILL=3]="FILL",h[h.FILL_STROKE=4]="FILL_STROKE",h[h.MASK=5]="MASK",h[h.BLUR=6]="BLUR",h[h.BLEND=7]="BLEND",h[h.COMPOSITE_TILE_GRID=8]="COMPOSITE_TILE_GRID",h[h.HARD_MASK_WITH_COLOR=9]="HARD_MASK_WITH_COLOR",h[h.VOLATILE_PROPERTY_BINDING=10]="VOLATILE_PROPERTY_BINDING",h[h.STATIC_TRANSFORM_BINDING=11]="STATIC_TRANSFORM_BINDING",h[h.DISSOLVE=12]="DISSOLVE",h))(fr||{});var ja;(o=>{function i(a,s){return a.has(s)}o.has=i;function e(a,s){return a.get(s)}o.get=e;function t(a,s,l){a.set(s,l)}o.set=t;function n(a){a.clear()}o.clear=n;function r(){return new Map}o._new=r})(ja||(ja={}));var Fn=class i{currentBounds(e){if(e==null)return this.maxBounds;if(ja.has(e,this))return ja.get(e,this);let t=this.computeBounds(e);return ja.set(e,this,t),t}constructor(e,t){this.maxBounds=null,this._isOptimized=!1,this.flags=0,this.maxBounds=e,this.flags=t}hasNonIsolatedBlends(){return(1&this.flags)!=0}hasBackgroundBlurs(){return(2&this.flags)!=0}canBeUsedInBackgroundBlurs(){return!(4&this.flags)}hasVolatileContent(){return(8&this.flags)!=0}hasAnimatingMedia(){return(16&this.flags)!=0}maskNeedsSSAA(){return(32&this.flags)!=0}canCacheRasterized(){return!(this.hasNonIsolatedBlends()||this.hasBackgroundBlurs()||this.hasAnimatingMedia()||this.hasVolatileContent())}isRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.hasPerpendicularAxes(Ce.EPSILON))return!0}return!1}isAxisAlignedRoundedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().path().asRoundedRectPath()!=null&&e.transform.isAxisAligned(Ce.EPSILON))return!0}return!1}isAxisAlignedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.isAxisAligned(Ce.EPSILON))return!0}return!1}isRoundedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().path()instanceof Pt&&e.transform.hasPerpendicularAxes(Ce.EPSILON))return!0}return!1}desiredAntialiasing(){return this.op()!=3&&this.op()!=4?0:this.hasAnimatingMedia()||this.hasVolatileContent()?0:this.op()==3&&this.geometry.canBeAnalyticallyAntialiased()?1:2}opProfileString(){let e="RenderNodeOp: ";switch(this.op()){case 0:{e+="METADATA";break}case 2:{e+="SUPERSAMPLE_GROUP";break}case 1:{e+="GROUP";break}case 3:{e+="FILL";break}case 4:{let t=this;switch(e+="FILL_STROKE",t.mode){case 0:{e+=" mode=INSIDE";break}case 1:{e+=" mode=OUTSIDE";break}}break}case 5:{let t=this;switch(e+="MASK",t.type){case 0:{e+=" type=NORMAL";break}case 3:{e+=" type=BACKGROUND_BLUR";break}case 2:{e+=" type=INNER_SHADOW";break}case 4:{e+=" type=KNOCKOUT_SHADOW";break}case 1:{e+=" type=LUMINANCE";break}}break}case 6:{e+="BLUR";break}case 7:{e+="BLEND mode="+this.blendMode;break}case 9:{e+="HARD_MASK_WITH_COLOR";break}case 8:{e+="COMPOSITE_TILE_GRID";break}case 10:{let t=this;e+=`VOLATILE_PROPERTY_BINDING property=${za.VolatileProperty_toString(t.property)}`;break}case 11:{e+=`STATIC_TRANSFORM_BINDING transform=${this.transform}`;break}case 12:{e+="DISSOLVE";break}default:throw new Error(`Unhandled node op ${fr[this.op()]}`)}return e}debugString1(){return this.debugString2(i.DebugStringType.BASIC)}debugString2(e){let t=new i.GenerateStringState;return this._debugStringRecursive(this,t,!0,!1,e),t.result}_debugStringRecursive(e,t,n,r,o){let a=o!=i.DebugStringType.BASIC;t.result+=t.indent,n||(t.result+=r?"\u2514\u2500":"\u251C\u2500");let s=t.indent.length;switch(n||(t.indent+=r?"  ":"\u2502 "),e.op()){case 0:{let l=e;t.result+="METADATA",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 2:{let l=e;t.result+="SUPERSAMPLE_GROUP",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 1:{let l=e;t.result+="GROUP",this._appendFlagsToString(t,e),t.result+=`
`;for(let d=0,c=l.children.length;d<c;d=d+1){let p=l.children[d];this._debugStringRecursive(p,t,!1,d+1==l.children.length,o)}break}case 3:{let l=e,d=l.geometry.path().path(),c=d instanceof ui?"CirclePath":d instanceof Pt?"RoundedRectPath":d instanceof Rt?"BezierPath":d instanceof $e?"FrozenBezierPath":d instanceof Eo?"UniquePath":"UnknownPath";t.result+=`FILL path=${c} paints=`,this._appendPaintDataToString(t,l.geometry.paints,o),a&&(t.result+=` transform=${l.transform}`,t.result+=` paintSize=${l.paintSize}`),e.isRectFill()?t.result+=" isRect":e.isRoundedRectFill()&&(t.result+=" isRoundedRect"),this._appendFlagsToString(t,e),t.result+=`
`;break}case 4:{let l=e;switch(t.result+="FILL_STROKE",l.mode){case 0:{t.result+=" mode=INSIDE";break}case 1:{t.result+=" mode=OUTSIDE";break}}t.result+=" fills=",this._appendGeometriesToString(t,l.fillGeometries,o),t.result+=" strokes=",this._appendGeometriesToString(t,l.strokeGeometries,o),a&&(t.result+=` transform=${l.transform}`),this._appendFlagsToString(t,l),t.result+=`
`;break}case 5:{let l=e;switch(t.result+="MASK",l.type){case 0:{t.result+=" type=NORMAL";break}case 3:{t.result+=" type=BACKGROUND_BLUR";break}case 2:{t.result+=" type=INNER_SHADOW color=",this._appendColorToString(t,l.innerShadowFill);break}case 4:{t.result+=" type=KNOCKOUT_SHADOW";break}}this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.alpha,t,!1,!1,o),this._debugStringRecursive(l.color,t,!1,!0,o);break}case 6:{let l=e;t.result+=`BLUR radius=${l.radius}`,a&&(t.result+=` clamp=${l.clamp}`),this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 7:{let l=e;t.result+="BLEND mode=",t.result+=l.blendMode,t.result+=` opacity=${l.opacity}`,this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 9:{let l=e;t.result+="HARD_MASK_WITH_COLOR color=",this._appendColorToString(t,l.color),this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.alpha,t,!1,!0,o);break}case 8:{let l=e;t.result+="COMPOSITE_TILE_GRID",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.tree,t,!1,!0,o);break}case 10:{let l=e;switch(t.result+=`VOLATILE_PROPERTY_BINDING property=${za.VolatileProperty_toString(l.property)}`,a&&(t.result+=` id=${l.id}`),l.property){case 3:{t.result+=` value=${l.maxTransformScale()}`;break}case 2:{t.result+=` value=${l.transform()}`,l.id.startsWith("SHADOW_TRANSFORMATION")&&(t.result+=" SHADOW_TRANSFORMATION");break}case 4:{t.result+=` value=${l.opacity()}`;break}}this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 11:{let l=e;t.result+=`STATIC_TRANSFORM_BINDING transform=${l.transform}`,this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 12:{let l=e;t.result+="DISSOLVE",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.startChild,t,!1,!1,o),this._debugStringRecursive(l.endChild,t,!1,!0,o);break}default:throw new Error(`Unhandled node op ${fr[e.op()]}`)}t.indent=t.indent.slice(0,s)}_appendGeometriesToString(e,t,n){e.result+="[";for(let r=0,o=t.length;r<o;r=r+1){let a=t[r];r!=0&&(e.result+=", ");let s=a.path().path();s instanceof Rt?e.result+=`(${s.countCommands()} commands, `:s instanceof ui?e.result+="EllipsePath, ":s instanceof Pt&&(e.result+="RoundedRectPath, "),this._appendPaintDataToString(e,a.paints,n),e.result+=")"}e.result+="]"}_appendFlagsToString(e,t){t.hasNonIsolatedBlends()&&(e.result+=" hasBlends"),t.hasBackgroundBlurs()&&(e.result+=" hasBgBlurs"),t.canBeUsedInBackgroundBlurs()&&(e.result+=" bgBlurSafe"),t.maskNeedsSSAA()&&(e.result+=" maskNeedsSSAA"),t.hasVolatileContent()&&(e.result+=" volatile"),t.canCacheRasterized()||(e.result+=" nocache")}_appendSinglePaintToString(e,t,n){let r=n!=i.DebugStringType.BASIC,o=t.asVolatilePaint();if(o!=null){e.result+="VOLATILE [",this._appendSinglePaintToString(e,o.from(),n),e.result+=" -> ",this._appendSinglePaintToString(e,o.to(),n),e.result+="]";return}let a=t.asSinglePaint();switch(a.type()){case"SOLID":{e.result+="color=",this._appendColorToString(e,a.color());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{e.result+="stops=[";let s=a.colorStops();for(let l=0,d=s.length;l<d;l=l+1){l>0&&(e.result+=", ");let c=s[l];e.result+=`${c.position}`,e.result+=" ",this._appendColorToString(e,c.color)}e.result+="]";break}case"IMAGE":case"VIDEO":{r&&(e.result+=` hash=${a.image()!=null?a.image().hash():"NULL"}`,e.result+=` thumbnail=${a.imageThumbnail()!=null?a.imageThumbnail().hash():"NULL"}`,e.result+=` imageScaleMode=${a.imageScaleMode()}`,e.result+=` imageRotationDeg=${a.rotationDeg()}`,e.result+=` imageScalingFactor=${a.scalingFactor()}`);break}default:break}r&&a.transform()!=null&&(e.result+=` transform=${a.transform()}`),e.result+=` opacity=${a.opacity()}`}_appendPaintDataToString(e,t,n){e.result+="[";for(let r=0,o=t.length;r<o;r=r+1){r>0&&(e.result+=",");let a=t[r];e.result+=a.type()+" ",this._appendSinglePaintToString(e,a,n)}e.result+="]"}_appendColorToString(e,t){C.isOpaque(t)?e.result+=C.toCSS(t):e.result+=`rgba(${C.red(t)}, ${C.green(t)}, ${C.blue(t)}, ${C.alpha(t)})`}static visitEachNodeInTree(e,t,n,r,o){if(e!=null&&!(r!=null&&o!=null&&!e.currentBounds(o).overlaps(r))){switch(t!=null&&t(e),e.op()){case 0:{let a=e;i.visitEachNodeInTree(a.child,t,n,r,o);break}case 2:{let a=e;i.visitEachNodeInTree(a.child,t,n,r,o);break}case 1:{let a=e;for(let s of a.children)i.visitEachNodeInTree(s,t,n,r,o);break}case 3:case 4:case 8:break;case 5:{let a=e;i.visitEachNodeInTree(a.alpha,t,n,r,o),i.visitEachNodeInTree(a.color,t,n,r,o);break}case 6:{let a=e;i.visitEachNodeInTree(a.child,t,n,r,o);break}case 7:{let a=e;i.visitEachNodeInTree(a.child,t,n,r,o);break}case 9:{let a=e;i.visitEachNodeInTree(a.alpha,t,n,r,o);break}case 10:{let a=e;i.visitEachNodeInTree(a.child,t,n,r,o);break}case 11:{let a=e;i.visitEachNodeInTree(a.child,t,n,r,o);break}case 12:{let a=e;i.visitEachNodeInTree(a.startChild,t,n,r,o),i.visitEachNodeInTree(a.endChild,t,n,r,o);break}default:throw new Error(`Unhandled node op ${fr[e.op()]}`)}n!=null&&n(e)}}static geometryNodePaintSize(e){return e==null?null:e.op()==3||e.op()==4?e.paintSize:null}};(n=>{let i;(a=>(a[a.BASIC=0]="BASIC",a[a.EXTENDED=1]="EXTENDED"))(i=n.DebugStringType||(n.DebugStringType={}));class e{constructor(){this.result="",this.indent=""}}n.GenerateStringState=e;let t;(o=>{function r(a){return n.DebugStringType[a]}o.DebugStringType_toString=r})(t=n.in_DebugStringType||(n.in_DebugStringType={}))})(Fn||(Fn={}));var ze=class i extends Fn{constructor(){var e=(...args)=>{super(...args)};if(arguments.length==1){let t=arguments[0];e(qf(t,null),uv(t)),this.children=null,this._isFirstChildSolidBackground=!1,this.children=t}else if(arguments.length==2){let t=arguments[0],n=arguments[1];e(qf(t,null),uv(t)),this.children=null,this._isFirstChildSolidBackground=!1,this.children=t,this._isFirstChildSolidBackground=n,this._isFirstChildSolidBackground}}op(){return 1}isFirstChildSolidBackground(){return this._isFirstChildSolidBackground}canCacheRasterized(){return this.hasAnimatingMedia()||this.hasVolatileContent()||this.hasBackgroundBlurs()?!1:this._isFirstChildSolidBackground?!0:!this.hasNonIsolatedBlends()}computeBounds(t){return qf(this.children,t)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let t=this.children.length;for(let n=0;n<t;n=n+1){if(n==0&&this._isFirstChildSolidBackground)continue;let r=this.children[n],o=r.optimized();if(o==r&&r.op()!=1)continue;let a=this.children.slice(0,n),s=(l,d)=>{if(d.op()==1){let c=d;for(let p of c.children)l.push(p)}else l.push(d)};for(o!=null&&s(a,o);(n=n+1)<t;){let l=this.children[n].optimized();l!=null&&s(a,l)}return a.length==0?null:this._isFirstChildSolidBackground?a.length==1?null:new i(a,this._isFirstChildSolidBackground):i.wrap(a)}return this.children.length==1?this.children[0]:(this._isOptimized=!0,this)}equals(t){if(t==this)return!0;if(t.op()!=this.op())return!1;let r=t.children;if(this.children.length!=r.length)return!1;for(let o=0,a=this.children.length;o<a;o=o+1)if(!this.children[o].equals(r[o]))return!1;return!0}static wrap(t){return t.length==1?t[0]:new i(t)}static wrapWithSolidBackground(t,n){let r=Kn.solidColorRect(t.maxBounds,n,1);return new i([r,t],!0)}},si=class i extends Fn{constructor(){var e=(...args)=>{super(...args)};if(arguments.length==1){let t=arguments[0];e(t.maxBounds,t.flags),this.child=null,this.child=t}else if(arguments.length==2){let t=arguments[0],n=arguments[1];e(t.maxBounds,t.flags|n),this.child=null,this.child=t}}op(){return 2}computeBounds(t){return this.child.computeBounds(t)}optimized(){if(this._isOptimized)return this;let t=r=>r.op()==5&&r.type==4,n=t(xh(this.child));return this.child=this.child.optimized(),this.child==null?null:n&&!t(xh(this.child))?this.child:!this.child.maskNeedsSSAA()&&!this.maskNeedsSSAA()?this.child:(this._isOptimized=!0,this)}equals(t){if(t==this)return!0;if(t.op()!=this.op())return!1;let n=t;return this.child.equals(n.child)}static thatShouldNotBeUnwrappedInOptimization(t){return new i(t,32)}},Ha=class i extends Fn{constructor(t,n){super(t.maxBounds,n|t.flags);this.child=null,this.child=t}op(){return 0}computeBounds(t){return this.child.computeBounds(t)}optimized(){if(this._isOptimized)return this;let t=this.child.optimized();return t==null?null:t==this.child?(this._isOptimized=!0,this):new i(t,this.flags)}equals(t){if(t==this)return!0;if(t.op()!=this.op())return!1;let n=t;return this.flags==t.flags&&this.child.equals(n.child)}static createForBackgroundBlur(t){return new i(t,6)}},Kn=class i extends Fn{constructor(t,n,r){super(nN(t,n),lN(n));this.transform=null,this.geometry=null,this.paintSize=null,this.transform=t,this.geometry=n,this.paintSize=r}op(){return 3}geometryBounds(){return this.geometry.canBeAnalyticallyAntialiased()?this.transform.clone().transformRect(this.geometry.path().bounds().clone()):this.maxBounds}computeBounds(t){return this.maxBounds}withPaints(t){return new i(this.transform,this.geometry.withNewPaints(t),this.paintSize)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty()||!Oe.containsAtLeastOneVisiblePaint(this.geometry.paints))return null;let t=this.geometry.optimized(),n=t.type==0,r=t.canBeAnalyticallyAntialiased();if(n&&!r&&!t.path().isRect()&&(Oe.hasAnimatingMediaPaints(t.paints)||Oe.hasVolatilePaints(t.paints))){let o=new i(this.transform,new on(t.path(),[se.createSolid(C.BLACK,1)]),this.paintSize),a=new i(this.transform,new on(Lt.getOrCreate(Pt.fromRect(t.path().bounds()),"ODD"),t.paints),this.paintSize);return new _r(o,a).optimized()}return t==this.geometry?(this._isOptimized=!0,this):new i(this.transform,t,this.paintSize)}equals(t){if(t==this)return!0;if(t.op()!=this.op())return!1;let n=t;return this.transform.equals1(n.transform)&&this.geometry.equals(n.geometry)&&this.paintSize.equals(n.paintSize)}static solidColorRect(t,n,r){let o=[se.createSolid(n,r)],a=oe.new2().translatedBy1(t.topLeft()).scaledBy1(t.size()),s=new on(Lt.UNIT_RECT(),o),l=ve.FrozenVector_ZERO;return new i(a,s,l)}};var Hd=class i extends Fn{constructor(t,n,r,o,a){super(tN(t,n,r,a),eN([n,r]));this.transform=null,this.fillGeometries=null,this.strokeGeometries=null,this.paintSize=null,this.mode=0,this.transform=t,this.fillGeometries=n,this.strokeGeometries=r,this.paintSize=o,this.mode=a}op(){return 4}computeBounds(t){return this.maxBounds}optimized(){if(this._isOptimized)return this;let t=[];for(let o=0,a=this.strokeGeometries.length;o<a;o=o+1){let s=this.strokeGeometries[o];Oe.containsAtLeastOneVisiblePaint(s.paints)&&t.push(s)}if(this.maxBounds.isEmpty()||this.fillGeometries.length==0&&t.length==0)return null;let n=o=>{let a=[];for(let s=0,l=o.length;s<l;s=s+1){let d=o[s];a.push(new Kn(this.transform,d,this.paintSize))}return ze.wrap(a).optimized()};return t.length==0?n(this.fillGeometries):this.fillGeometries.length==0?this.mode==0?null:n(t):rn.FrozenList_equals(t,this.strokeGeometries,(o,a)=>o.equals(a))?(this._isOptimized=!0,this):new i(this.transform,this.fillGeometries,t,this.paintSize,this.mode).optimized()}equals(t){if(t==this)return!0;if(t.op()!=this.op())return!1;let n=t;return this.transform.equals1(n.transform)&&rn.FrozenList_equals(this.fillGeometries,n.fillGeometries,(r,o)=>r.equals(o))&&rn.FrozenList_equals(this.strokeGeometries,n.strokeGeometries,(r,o)=>r.equals(o))&&this.paintSize.equals(n.paintSize)&&this.mode==n.mode}},Ff=(o=>(o[o.NORMAL=0]="NORMAL",o[o.LUMINANCE=1]="LUMINANCE",o[o.INNER_SHADOW=2]="INNER_SHADOW",o[o.BACKGROUND_BLUR=3]="BACKGROUND_BLUR",o[o.KNOCKOUT_SHADOW=4]="KNOCKOUT_SHADOW",o))(Ff||{}),_r=class i extends Fn{constructor(){var e=(...args)=>{super(...args)};if(arguments.length==5){let t=arguments[0],n=arguments[1],r=arguments[2],o=arguments[3],a=arguments[4];e(Yf(t,n,r,null),pv(t,n,r)),this.alpha=null,this.color=null,this.type=0,this.innerShadowFill=0,this.innerShadowAlphaRequiresHardMask=!1,this.alpha=t,this.color=n,this.type=r,this.innerShadowFill=o,this.innerShadowAlphaRequiresHardMask=a}else if(arguments.length==2){let t=arguments[0],n=arguments[1];e(Yf(t,n,0,null),pv(t,n,0)),this.alpha=null,this.color=null,this.type=0,this.innerShadowFill=0,this.innerShadowAlphaRequiresHardMask=!1,this.alpha=t,this.color=n,this.type=0,this.innerShadowFill=C.TRANSPARENT,this.innerShadowAlphaRequiresHardMask=!1}}op(){return 5}computeBounds(t){return Yf(this.alpha,this.color,this.type,t)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let t=this.alpha.optimized();if(t==null)return null;let n=this.color.optimized(),r=this.type!=4,o=this.type!=4&&this.type!=2;if(n!=null&&r&&(n=i.cullGroupChildren(n,t.maxBounds)),n!=null&&o&&(t=i.cullGroupChildren(t,n.maxBounds),t==null))return null;switch(this.type){case 0:case 1:{if(n==null)return null;let a=!1,s=t;if(t.isAxisAlignedRectFill()){let l=U.new2();l.copyFrom(s.geometryBounds()),l.expand1(Ce.EPSILON),a=l.contains1(n.maxBounds)}else if(t.isAxisAlignedRoundedRectFill()&&(X.optimizationExposureLogging()&&Un.didEncounterRoundedRectOptimization(),X.roundedMaskOptimization())){let d=s.geometry.path().path().asRoundedRectPath().radii(),c=U.new2();c.copyFrom(s.geometryBounds()),c.expand1(Ce.EPSILON);let p=Math.max(Math.max(d.topLeft,d.topRight),Math.max(d.bottomLeft,d.bottomRight)),u=Math.min(c.width()/2,c.height()/2);if(p<=u){let h=U.new2();if(h.copyFrom(s.geometryBounds()),h.expand1(Ce.EPSILON),h.contains1(n.maxBounds)){let _=n.maxBounds,m=_.left(),A=_.right(),y=_.top(),S=_.bottom(),g=new E(h.left()+d.topLeft,h.top()+d.topLeft),b=new E(h.right()-d.topRight,h.top()+d.topRight),T=new E(h.left()+d.bottomLeft,h.bottom()-d.bottomLeft),I=new E(h.right()-d.bottomRight,h.bottom()-d.bottomRight);(m>=g.x()||y>=g.y()||Math.sqrt(Math.pow(m-g.x(),2)+Math.pow(y-g.y(),2))<=d.topLeft)&&(A<=b.x()||y>=b.y()||Math.sqrt(Math.pow(A-b.x(),2)+Math.pow(y-g.y(),2))<=d.topRight)&&(m>=T.x()||S<=T.y()||Math.sqrt(Math.pow(m-T.x(),2)+Math.pow(S-T.y(),2))<=d.bottomLeft)&&(A<=I.x()||S<=I.y()||Math.sqrt(Math.pow(A-I.x(),2)+Math.pow(S-I.y(),2))<=d.bottomRight)&&(a=!0)}}}if(a){let l=s.geometry.paints;if(Oe.containsAtLeastOneVisibleOpaquePaint(l))return n;let d=Oe.onlySolidPaintOrNull(l);if(d!=null)return new oo("PASS_THROUGH",C.alphaF(d.color())*d.opacity(),n).optimized()}break}case 4:{if(n==null)return null;let a=t.maxBounds,s=n.maxBounds;if(!a.overlaps(s))return n;if(!t.hasVolatileContent()&&a.contains1(s))return null;break}case 2:{if(C.alpha(this.innerShadowFill)==0)return null;if(n==null&&t.op()==3&&!this.innerShadowAlphaRequiresHardMask){let a=t,s=a.geometry.paints,l=Oe.onlySolidPaintOrNull(s);if(l!=null)return a.withPaints([se.createSolid(C.multiplyOpacity(this.innerShadowFill,C.alphaF(l.color())),1)])}if(t.op()==9&&n!=null){let a=t;return new i(a.alpha,n,this.type,this.innerShadowFill,!0)}break}case 3:break}return t==this.alpha&&n==this.color?(this._isOptimized=!0,this):(n==null&&(n=new ze([])),new i(t,n,this.type,this.innerShadowFill,this.innerShadowAlphaRequiresHardMask))}equals(t){if(t==this)return!0;if(t.op()!=this.op())return!1;let n=t;return this.alpha.equals(n.alpha)&&this.color.equals(n.color)&&this.type==n.type&&this.innerShadowFill==n.innerShadowFill}static createForInnerShadow(t,n,r){return new i(t,n,2,r,!1)}static createForBackgroundBlur(t,n){return new i(t,n,3,C.TRANSPARENT,!1)}static createForKnockoutShadow(t,n){return new i(t,n,4,C.TRANSPARENT,!1)}static createForLuminanceMask(t,n){return new i(t,n,1,C.TRANSPARENT,!1)}static cullGroupChildren(t,n){if(t!=null&&!t.maxBounds.overlaps(n))return null;if(t!=null&&t.op()==1){let r=t,o=r.children.length;for(let a=0;a<o;a=a+1)if(!r.children[a].maxBounds.overlaps(n)){let l=r.children.slice(0,a);for(;(a=a+1)<o;)r.children[a].maxBounds.overlaps(n)&&l.push(r.children[a]);return ze.wrap(l).optimized()}}return t}},bo=class i extends Fn{constructor(t,n){super(C.alpha(n)>0?t.maxBounds:U.INVALID,iN(t));this.alpha=null,this.color=0,this.alpha=t,this.color=n}op(){return 9}computeBounds(t){return C.alpha(this.color)>0?this.alpha.currentBounds(t):U.INVALID}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let t=this.alpha.optimized();if(t==null)return null;if(t.op()==10){let r=t;return new pt(new i(r.child,this.color),r.id,r.property,r.getter).optimized()}t=sv(t,r=>(r.op()==7&&(r=r.child),r));let n=sv(t,r=>{if(r.op()==3){let o=r;if(!Oe.hasVolatilePaints(o.geometry.paints)&&!Oe.hasAnyFullyTransparentAreas(o.geometry.paints))return o.withPaints([se.createSolid(this.color,1)])}return r});return n!=t?n:t==this.alpha?(this._isOptimized=!0,this):new i(t,this.color)}equals(t){if(t==this)return!0;if(t.op()!=this.op())return!1;let n=t;return this.alpha.equals(n.alpha)&&this.color==n.color}},ro=class i extends Fn{constructor(t,n,r){super(lv(t,n,null),aN(n));this.radius=0,this.child=null,this.clamp=null,this.radius=t,this.child=n,this.clamp=r}op(){return 6}computeBounds(t){return lv(this.radius,this.child,t)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let t=this.child.optimized();if(t==null)return null;if(this.radius==0)return t;if(t.op()==10&&this.clamp.isInvalid()){let n=t;return new pt(new i(this.radius,n.child,this.clamp),n.id,n.property,n.getter).optimized()}return t==this.child?(this._isOptimized=!0,this):new i(this.radius,t,this.clamp)}equals(t){if(t==this)return!0;if(t.op()!=this.op())return!1;let n=t;return this.radius==n.radius&&this.child.equals(n.child)&&this.clamp.equals(n.clamp)}},oo=class i extends Fn{constructor(t,n,r){super(n>0?r.maxBounds:U.INVALID,sN(t,r));this.blendMode=null,this.opacity=0,this.child=null,this.blendMode=t,this.opacity=n,this.child=r}op(){return 7}computeBounds(t){return this.opacity>0?this.child.currentBounds(t):U.INVALID}optimized(){var r;if(this._isOptimized)return this;if(this.opacity==0||this.maxBounds.isEmpty())return null;let t=this.child.optimized();if(t==null)return null;if(this.opacity==1&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL"&&!t.hasNonIsolatedBlends()))return t;if((this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&t.op()==3){let o=t,a=(r=Oe.onlyPaintOrNull(o.geometry.paints))==null?void 0:r.asSinglePaint();if(a!=null){let s=a.cloneAsSinglePaint();s.setOpacity(s.opacity()*this.opacity);let l=[s].slice();return o.withPaints(l)}}let n=this.opacity;if(t.op()==7){let o=t;this.blendMode==o.blendMode&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&(n=o.opacity*n,t=o.child)}return n==this.opacity&&t==this.child?(this._isOptimized=!0,this):new i(this.blendMode,n,t)}equals(t){if(t==this)return!0;if(t.op()!=this.op())return!1;let n=t;return this.blendMode==n.blendMode&&this.opacity==n.opacity&&this.child.equals(n.child)}},Oh=class{constructor(e,t){this.key=null,this._cache=null,this.tileHandleOrNull=null,this.neededImagesOrNull=null,this.key=e,this._cache=t}canvasSpaceBounds(){return this.key.bounds}textureRegionOrNull(){return this._cache.textureRegionOrNull(this)}bounds(){return this.key.bounds}},Gp=(t=>(t[t.ALL=0]="ALL",t[t.ONLY_IN_CACHE=1]="ONLY_IN_CACHE",t))(Gp||{}),Fh=class extends Fn{constructor(t,n){super(dv(t,null),t.flags);this.tree=null,this._tileCache=null,this._tiles=new Map,this._devicePixelsPerCanvasPixel=-1,this.tree=t,this._tileCache=n}op(){return 8}optimized(){return this._isOptimized=!0,this}computeBounds(t){return dv(this.tree,t)}equals(t){if(t==this)return!0;if(t.op()!=this.op())return!1;let n=t;return this._tileCache==n._tileCache&&this.maxBounds.equals(n.maxBounds)&&this.tree.equals(n.tree)}setDevicePixelPerCanvasPixel(t){this._devicePixelsPerCanvasPixel!=t&&(this._tiles=new Map,this._devicePixelsPerCanvasPixel=t)}numTilesNeededForBounds(t){let n=U.new3(t);n.intersectWith(this.maxBounds);let r=new E(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),o=gn.TILE_SIZE/this._devicePixelsPerCanvasPixel,a=Math.floor((n.left()-r.x())/o)|0,s=Math.ceil((n.right()-r.x())/o)|0,l=Math.floor((n.top()-r.y())/o)|0,d=Math.ceil((n.bottom()-r.y())/o)|0;return(s-a)*(d-l)}forEachTileWithinBounds(t,n,r){if(!n.overlaps(this.maxBounds))return;let o=U.new3(n);o.intersectWith(this.maxBounds);let a=new E(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),s=gn.TILE_SIZE/this._devicePixelsPerCanvasPixel,l=Math.floor((o.left()-a.x())/s)|0,d=Math.ceil((o.right()-a.x())/s)|0,c=Math.floor((o.top()-a.y())/s)|0,p=Math.ceil((o.bottom()-a.y())/s)|0,u=a.y()+c*s;for(let h=c;h<p;h=h+1,u+=s){let f=qt.IntMap_get(this._tiles,h,null);f==null&&(f=new Map,this._tiles.set(h,f));let _=a.x()+l*s;for(let m=l;m<d;m=m+1,_+=s){let A=qt.IntMap_get(f,m,null);if(A!=null){let g=A.value;g!=null&&r(g);continue}if(t==1)continue;let y=new U(_,u,s,s),S=this._tileCache.getOrInsertOrNull(this.tree,y);f.set(m,new Se(S)),S!=null&&r(S)}}}};var pt=class i extends Fn{constructor(t,n,r,o){super(rN(t,r),t.flags|8);this.child=null,this.id=null,this.property=0,this.getter=null,this.child=t,this.id=n,this.property=r,this.getter=o}op(){return 10}computeBounds(t){switch(this.property){case 2:{let n=this.child.currentBounds(t).clone();return this.transform().transformRect(n),n}case 1:case 3:case 4:case 5:return this.child.currentBounds(t);case 0:return this.maxBounds;default:throw new Error(`Unhandled VolatileProperty value: ${za.VolatileProperty_toString(this.property)}`)}}transform(){return this.getter()}opacity(){return+this.getter()}maxTransformScale(){return+this.getter()}optimized(){if(this._isOptimized)return this;let t=this.child.optimized();return t==null||t.maxBounds.isEmpty()?null:t!=this.child?new i(t,this.id,this.property,this.getter):(this._isOptimized=!0,this)}equals(t){if(t==this)return!0;if(t.op()!=this.op())return!1;let n=t;return this.id==n.id&&this.property==n.property&&this.child.equals(n.child)}static forTranslation(t,n,r){let o=oe.new2();return i.forTransform(t,n,()=>(o.copyFrom(Nt.FrozenAffineTransform_IDENTITY),o.translatedBy1(r())))}static forTransform(t,n,r){return new i(t,n,2,r)}static forOpacity(t,n,r){return new i(t,n,4,r)}static forTransformIsolation(t){let n="ID_FOR_TRANSFORM_ISOLATION";return new i(t,n,1,null)}static forMaxTransformScale(t,n){let r=`ID_FOR_MAX_TRANSFORM_SCALE_${t}`;return new i(n,r,3,()=>t)}static forInverseTransform(t){let n="ID_FOR_INVERSE_TRANSFORM";return new i(t,n,0,null)}static forStateSwap(t){let n="ID_FOR_STATE_SWAP";return new i(t,n,5,null)}},Hi=class i extends Fn{constructor(t,n){super(oN(t,n),t.flags);this.child=null,this.transform=null,this.child=t,this.transform=n}op(){return 11}computeBounds(t){return this.maxBounds}optimized(){if(this._isOptimized)return this;let t=this.child.optimized();return t==null||t.maxBounds.isEmpty()?null:this.transform.equals1(Nt.FrozenAffineTransform_IDENTITY)?t:t!=this.child?new i(t,this.transform):(this._isOptimized=!0,this)}equals(t){if(t==this)return!0;if(t.op()!=this.op())return!1;let n=t;return this.transform.equals1(n.transform)&&this.child.equals(n.child)}},Ar=class i extends Fn{constructor(t,n,r,o){super(cv(t,n,null),(t!=null?t.flags:0)|(n!=null?n.flags:0)|8);this.startChild=null,this.endChild=null,this.id=null,this.progressFn=null,this.startChild=t,this.endChild=n,this.id=r,this.progressFn=o}op(){return 12}computeBounds(t){return cv(this.startChild,this.endChild,t)}progress(){return this.progressFn()}optimized(){if(this._isOptimized)return this;let t=this.startChild!=null?this.startChild.optimized():null,n=this.endChild!=null?this.endChild.optimized():null,r=t!=null&&!t.maxBounds.isEmpty(),o=n!=null&&!n.maxBounds.isEmpty();if(!r&&!o)return null;if(r)if(o){if(this.startChild.equals(this.endChild))return this.startChild}else return new pt(t,this.id,4,()=>1-this.progressFn());else return new pt(n,this.id,4,()=>this.progressFn());return this.startChild!=t||this.endChild!=n?new i(t,n,this.id,this.progressFn):(this._isOptimized=!0,this)}equals(t){if(t==this)return!0;if(t.op()!=this.op())return!1;let n=t;return this.id==n.id&&this.startChild.equals(n.startChild)&&this.endChild.equals(n.endChild)}},ov;(e=>{function i(t){return fr[t]}e.RenderNodeOp_toString=i})(ov||(ov={}));var iv;(e=>{function i(t){return Ff[t]}e.MaskType_toString=i})(iv||(iv={}));var av;(e=>{function i(t){return Gp[t]}e.TileFilter_toString=i})(av||(av={}));var za;(e=>{function i(t){switch(t){case 0:return"INVERSE_TRANSFORM";case 1:return"TRANSFORM_ISOLATION";case 2:return"TRANSFORM";case 3:return"MAX_TRANSFORM_SCALE";case 4:return"OPACITY";case 5:return"STATE_SWAP";default:throw new Error("Unhandled VolatileProperty value")}}e.VolatileProperty_toString=i})(za||(za={}));function eN(i){let e=0;for(let t of i)for(let n=0,r=t.length;n<r;n=n+1)Oe.hasAnimatingMediaPaints(t[n].paints)&&(e|=16),Oe.hasVolatilePaints(t[n].paints)&&(e|=8);return e}function sv(i,e){if(i.op()==11){let t=i,n=e(t.child);return n==t.child?t:n!=null?new Hi(n,t.transform):null}else return e(i)}function xh(i){return i.op()==11?i.child:i}function _I(i){if(i.op()==11){let e=i;return new vr(e.child,e.transform)}else if(i.op()==10){let e=i;if(e.property==2)return new vr(e.child,e.transform())}return new vr(i,null)}function qf(i,e){let t=new Tt;for(let n of i)t.include3(n.currentBounds(e));return t.isValid()?t.build():U.INVALID}function Yf(i,e,t,n){if(t==2)return i.currentBounds(n);if(t==4)return e.currentBounds(n);if(Ce.emulateFullscreenRenderingBugs&&t==3)return i.currentBounds(n);let r=i.currentBounds(n).clone();return r.intersectWith(e.currentBounds(n)),r}function lv(i,e,t){if(e.currentBounds(t).isEmpty())return e.currentBounds(t);let n=e.currentBounds(t).clone();return n.expand1(i),n}function Ph(i,e){let t=new Tt,n=!1;for(let o=0,a=e.length;o<a;o=o+1){let s=e[o];t.include3(s.maxBounds),s.canBeAnalyticallyAntialiased()&&(n=!0)}if(!t.isValid())return U.INVALID;let r=t.build();return i.transformRect(r),n&&r.expand1(4),r}function tN(i,e,t,n){if(n==0)return Ph(i,e);let r=new Tt;return r.include3(Ph(i,e)),r.include3(Ph(i,t)),r.isValid()?r.build():U.INVALID}function nN(i,e){return Ph(i,[e].slice())}function rN(i,e){switch(e){case 2:case 0:{let t=U.new2();return t.copyFrom(i.maxBounds),t.expandedBy1(1e6),t}case 4:case 3:case 1:case 5:return i.maxBounds;default:throw new Error(`Unhandled property ${za.VolatileProperty_toString(e)}`)}}function oN(i,e){return e.transformRect(U.new3(i.maxBounds))}function cv(i,e,t){let n=new Tt;return i!=null&&n.include3(i.currentBounds(t)),e!=null&&n.include3(e.currentBounds(t)),n.build()}function dv(i,e){let t=i.currentBounds(e).clone();return t.expand1(1),t}function uv(i){let e=0;for(let t of i)e|=t.flags;return e}function pv(i,e,t){let n=i.flags&-2|e.flags;return t!=0&&t!=4&&t!=1&&(n&=-2),t==2&&(n|=32),n}function iN(i){return i.flags&-2|32}function aN(i){return i.flags&-2}function sN(i,e){let t=e.flags;return i!="PASS_THROUGH"&&(t&=-2,t|=i!="NORMAL"?1:0),t}function lN(i){let e=0;return Oe.hasAnimatingMediaPaints(i.paints)&&(e|=16),(Oe.hasVolatilePaints(i.paints)||i.type==1)&&(e|=8),e}var Ho;(c=>{function i(p){if(At.int_remainder(p.byteCount(),c.NUM_BYTES_PER_FLOAT)!=0)return!1;let u=p.byteCount()/c.NUM_BYTES_PER_FLOAT|0;if(At.int_remainder(u,c.NUM_FLOATS_PER_VERTEX)!=0)return!1;let h=u/c.NUM_FLOATS_PER_VERTEX|0;if(At.int_remainder(h,3)!=0)return!1;if(p.byteCount()>N.BufferChunk.BYTE_COUNT)throw new Error("This triangles chunk exceeds the maximum buffer size and will crash if we try to render it");return!0}c.isValid=i;function e(p){return p.byteCount()/(c.NUM_BYTES_PER_FLOAT*c.NUM_FLOATS_PER_VERTEX)|0}c.numVertices=e;function t(p,u){let h=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(h)}c.xValueAt=t;function n(p,u){let h=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(h+1*c.NUM_BYTES_PER_FLOAT)}c.yValueAt=n;function r(p,u){let h=t(p,u),f=n(p,u);return new E(h,f)}c.xyValueAt=r;function o(p,u){let h=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(h+2*c.NUM_BYTES_PER_FLOAT)}c.kValueAt=o;function a(p,u){let h=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(h+3*c.NUM_BYTES_PER_FLOAT)}c.lValueAt=a;function s(p,u){let h=u*c.NUM_FLOATS_PER_VERTEX*c.NUM_BYTES_PER_FLOAT;return p.floatAt(h+4*c.NUM_BYTES_PER_FLOAT)}c.mValueAt=s,c.NUM_BYTES_PER_FLOAT=4,c.NUM_FLOATS_PER_VERTEX=5})(Ho||(Ho={}));var Xr=class Xr{static UNIT_RECT(){return Xr._UNIT_RECT!=null||(Xr._UNIT_RECT=new Xr(Pt.fromRect(new U(0,0,1,1)),"NONZERO")),Xr._UNIT_RECT}static getOrCreate(e,t){return Xr._uniqueValues.getOrInsertFallback(new Xr.PathAndWindingRuleArgs(e,t))}constructor(e,t){this._path=null,this._windingRule=null,this._cachedTriangles=null,this._path=e,this._windingRule=t}equals(e){return e==null?!1:this._windingRule==e._windingRule&&this._path.equals2(e._path)}bounds(){return this._path.bounds()}isRect(){return this._path.isRect()}path(){return this._path}windingRule(){return this._windingRule}triangles(e,t){return this._cachedTriangles==null&&(this._cachedTriangles=this._convertToTriangles(e,t)),this._cachedTriangles}_allTrianglesHaveSameOrientation(e){let t=0;for(let n=0;n<Ho.numVertices(e);n=n+3){let r=Ho.xyValueAt(e,n),o=Ho.xyValueAt(e,n+1),a=Ho.xyValueAt(e,n+2),s=E.cross(o.subtract1(r),a.subtract1(r)),l=s<0?-1:s>0?1:0;if(l!=0){if(t==-l)return!1;t=l}}return!0}_convertToTriangles(e,t){let n=[],r=null;if(this._path instanceof Eo)r=this._path.compileLoopBlinnAndReturnVolatileTriangles();else{Xr.TEMP_ARRAY.clear();let d=this._path.toBezierPath();su.compile(d,Xr.TEMP_ARRAY),r=Xr.TEMP_ARRAY.bytes()}let o=t.stride()*3,a=N.BufferChunk.BYTE_COUNT,s=a-At.int_remainder(a,o),l=(r.length+s-1)/s|0;for(let d=0,c=l;d<c;d=d+1){let p=r.subarray(d*s,d*s+s),u=new br(p),h=e.allocate(t,p);if(h==null)continue;let f=!0;for(let A=0,y=Ho.numVertices(u);A<y;A=A+1){let S=Ho.kValueAt(u,A),g=Ho.lValueAt(u,A),b=Ho.mValueAt(u,A);if(S!=.5||g!=.5||b!=.5){f=!1;break}}let _=Ho.numVertices(u)==3||this.isRect(),m=f&&this._allTrianglesHaveSameOrientation(u);n.push(new Dh(h,f,_,m))}return l>1&&console.warn(`splitting ${r.length} byte geometry buffer into ${l} chunks`),n}};Xr.TEMP_ARRAY=new br,Xr._UNIT_RECT=null,Xr._uniqueValues=new wi(e=>e.hash,(e,t)=>e.equals(t),e=>new Xr(e.path,e.windingRule));var Lt=Xr;(e=>{class i{constructor(n,r){this.path=null,this.windingRule=null,this.hash=0,this.path=n,this.windingRule=r,this.hash=co.combine(n.hash(),r=="ODD"?1:0)}equals(n){return this.windingRule==n.windingRule&&this.path.equals2(n.path)}}e.PathAndWindingRuleArgs=i})(Lt||(Lt={}));function hv(i,e,t){if(e==5&&i[4].equals(i[0])&&(e=e-1),e!=4)return!1;let s=.001,l=0,d=0;for(let c=0;c<e;c=c+1){let p=i[c],u=0;if(p.x()<t.left()+s)if(p.y()<t.top()+s)u=0;else if(p.y()>t.bottom()-s)u=2;else return!1;else if(p.x()>t.right()-s)if(p.y()<t.top()+s)u=1;else if(p.y()>t.bottom()-s)u=3;else return!1;else return!1;if(c>0){let h=l^u;if(h!=1&&h!=2)return!1}d|=1<<u,l=u}return d==15}var zd=class{constructor(e,t){this.bounds=e,this.isRect=t}},$e=class i{constructor(){if(arguments.length==1){let e=arguments[0];this._data=null,this._cachedInfo=null,this._hash=null,this.VERTEX_PATTERN_COUNT=5,this.VERTEX_PATTERN=[null,null,null,null,null],this._data=e,this._cachedInfo=null,this._hash=null}else if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this._data=null,this._cachedInfo=null,this._hash=null,this.VERTEX_PATTERN_COUNT=5,this.VERTEX_PATTERN=[null,null,null,null,null],this._data=e,this._cachedInfo=t,this._hash=new Se(n)}}_invalidateCachedData(){this._cachedInfo=null,this._hash=null}equals2(e){return e instanceof i?this.equals1(e):!1}equals1(e){return this._data.byteCount()!=e._data.byteCount()||this.hash()!=e.hash()?!1:lu.FrozenDataArray_equals(this._data,e._data)}clone(){return this.getMutableClone()}getMutableClone(){return new Rt(this._data.clone())}isEmpty(){return this._data.isEmpty()}start(){return 0}bounds(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.bounds}isRect(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.isRect}asRoundedRectPath(){return null}canBeAnalyticallyAntialiased(){return!1}hash(){if(this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._hash==null){let e=new co;for(let t=0,n=this._data.byteCount();t<n;t=t+1)e.hash2(this._data.byteAt(t));this._hash=new Se(e.value())}return this._hash.value}countCommands(){let e=0;for(let t=this.start();i.Command.isValid(t,this);t=i.Command.next(t,this))e=e+1;return e}_computeBoundsAndRectInfo(){let e=Tt.INSTANCE;e.reset();for(let d=0,c=this.VERTEX_PATTERN_COUNT;d<c;d=d+1)this.VERTEX_PATTERN[d]=null;let t=!1,n=!1,r=0,o=E.new2(),a=d=>{r<this.VERTEX_PATTERN_COUNT&&(this.VERTEX_PATTERN[r]=d),e.include2(d),r=r+1};for(let d=this.start();i.Command.isValid(d,this);d=i.Command.next(d,this))switch(i.Command.kind(d,this)){case i.Command.Kind.CLOSE:{n=!1;break}case i.Command.Kind.MOVE_TO:{o=i.Command.point(d,this),n=!1;break}case i.Command.Kind.LINE_TO:case i.Command.Kind.QUADRATIC_TO:case i.Command.Kind.CUBIC_TO:{n||(a(o),n=!0),i.Command.kind(d,this)==i.Command.Kind.QUADRATIC_TO?(e.include2(i.Command.control1(d,this)),t=!0):i.Command.kind(d,this)==i.Command.Kind.CUBIC_TO&&(e.include2(i.Command.control1(d,this)),e.include2(i.Command.control2(d,this)),t=!0),o=i.Command.point(d,this),a(o);break}default:break}let s=e.isValid()?e.build():U.INVALID,l=!t&&r<=this.VERTEX_PATTERN_COUNT&&hv(this.VERTEX_PATTERN,r,s);return new zd(s,l)}toBezierPath(){return this}toString(){let e="";for(let t=this.start();i.Command.isValid(t,this);t=i.Command.next(t,this))switch(t!=this.start()&&(e+=" "),i.Command.kind(t,this)){case i.Command.Kind.CLOSE:{e+="Z";break}case i.Command.Kind.MOVE_TO:{e+=`M ${i.Command.moveToX(t,this)} ${i.Command.moveToY(t,this)}`;break}case i.Command.Kind.LINE_TO:{e+=`L ${i.Command.lineToX(t,this)} ${i.Command.lineToY(t,this)}`;break}case i.Command.Kind.QUADRATIC_TO:{e+=`Q ${i.Command.quadraticToFirstX(t,this)} ${i.Command.quadraticToFirstY(t,this)} ${i.Command.quadraticToX(t,this)} ${i.Command.quadraticToY(t,this)}`;break}case i.Command.Kind.CUBIC_TO:{e+=`C ${i.Command.cubicToFirstX(t,this)} ${i.Command.cubicToFirstY(t,this)} ${i.Command.cubicToSecondX(t,this)} ${i.Command.cubicToSecondY(t,this)} ${i.Command.cubicToX(t,this)} ${i.Command.cubicToY(t,this)}`;break}default:{break}}return e}data(){return this._data}};(e=>{let i;(te=>{function t(j,ie){return ie.data().byteAt(j)}te.kind=t;function n(j,ie){let de=t(j,ie);return j+(de==4?1+4*6:de==3?1+4*4:de==0?1:1+4*2)}te.next=n;function r(j,ie){if(j>=ie.data().byteCount())return!1;let de=0;switch(t(j,ie)){case 0:{de=1;break}case 1:case 2:{de=1+1*8;break}case 3:{de=1+2*8;break}case 4:{de=1+3*8;break}default:return!1}return j+de<=ie.data().byteCount()}te.isValid=r;function o(j,ie){return l(j,ie,t(j,ie)==3?1:t(j,ie)==4?2:0)}te.point=o;function a(j,ie){return l(j,ie,0)}te.control1=a;function s(j,ie){return l(j,ie,1)}te.control2=s;function l(j,ie,de){return new E(ie.data().floatAt(j+1+8*de),ie.data().floatAt(j+1+8*de+4))}te.pointAtIndex=l;function d(j,ie){return ie.data().floatAt(j+1)}te.moveToX=d;function c(j,ie){return ie.data().floatAt(j+(1+4))}te.moveToY=c;function p(j,ie,de){ie.setFloatAt(j+1,de)}te.setMoveToX=p;function u(j,ie,de){ie.setFloatAt(j+(1+4),de)}te.setMoveToY=u;function h(j,ie){return ie.data().floatAt(j+1)}te.lineToX=h;function f(j,ie){return ie.data().floatAt(j+(1+4))}te.lineToY=f;function _(j,ie,de){ie.setFloatAt(j+1,de)}te.setLineToX=_;function m(j,ie,de){ie.setFloatAt(j+(1+4),de)}te.setLineToY=m;function A(j,ie){return ie.data().floatAt(j+1)}te.quadraticToFirstX=A;function y(j,ie){return ie.data().floatAt(j+(1+4))}te.quadraticToFirstY=y;function S(j,ie){return ie.data().floatAt(j+(1+4*2))}te.quadraticToX=S;function g(j,ie){return ie.data().floatAt(j+(1+4*3))}te.quadraticToY=g;function b(j,ie,de){ie.setFloatAt(j+1,de)}te.setQuadraticToFirstX=b;function T(j,ie,de){ie.setFloatAt(j+(1+4),de)}te.setQuadraticToFirstY=T;function I(j,ie,de){ie.setFloatAt(j+(1+4*2),de)}te.setQuadraticToX=I;function O(j,ie,de){ie.setFloatAt(j+(1+4*3),de)}te.setQuadraticToY=O;function w(j,ie){return ie.data().floatAt(j+1)}te.cubicToFirstX=w;function P(j,ie){return ie.data().floatAt(j+(1+4))}te.cubicToFirstY=P;function H(j,ie){return ie.data().floatAt(j+(1+4*2))}te.cubicToSecondX=H;function re(j,ie){return ie.data().floatAt(j+(1+4*3))}te.cubicToSecondY=re;function q(j,ie){return ie.data().floatAt(j+(1+4*4))}te.cubicToX=q;function W(j,ie){return ie.data().floatAt(j+(1+4*5))}te.cubicToY=W;function x(j,ie,de){ie.setFloatAt(j+1,de)}te.setCubicToFirstX=x;function F(j,ie,de){ie.setFloatAt(j+(1+4),de)}te.setCubicToFirstY=F;function k(j,ie,de){ie.setFloatAt(j+(1+4*2),de)}te.setCubicToSecondX=k;function G(j,ie,de){ie.setFloatAt(j+(1+4*3),de)}te.setCubicToSecondY=G;function M(j,ie,de){ie.setFloatAt(j+(1+4*4),de)}te.setCubicToX=M;function Q(j,ie,de){ie.setFloatAt(j+(1+4*5),de)}te.setCubicToY=Q;let Y;(ht=>(ht[ht.CLOSE=0]="CLOSE",ht[ht.MOVE_TO=1]="MOVE_TO",ht[ht.LINE_TO=2]="LINE_TO",ht[ht.QUADRATIC_TO=3]="QUADRATIC_TO",ht[ht.CUBIC_TO=4]="CUBIC_TO"))(Y=te.Kind||(te.Kind={}));let B;(ie=>{function j(de){return Y[de]}ie.Kind_toString=j})(B=te.in_Kind||(te.in_Kind={}))})(i=e.Command||(e.Command={}))})($e||($e={}));var ft=class ft extends $e{constructor(e){super(e)}static mutableData(e){return e._data}append(e){this._invalidateCachedData(),!this.isEmpty()&&!e.isEmpty()&&$e.Command.kind(e.start(),e)!=1&&this.moveTo1(0,0),this._data.appendBytes(e.data())}setFloatAt(e,t){this._invalidateCachedData(),this._data.setFloatAt(e,t)}moveTo1(e,t){return this._invalidateCachedData(),this._data.appendByte(1),this._data.appendFloat(e),this._data.appendFloat(t),this}moveTo2(e){return this.moveTo1(e.x(),e.y())}lineTo(e,t){return this._invalidateCachedData(),this._data.appendByte(2),this._data.appendFloat(e),this._data.appendFloat(t),this}quadraticTo(e,t,n,r){return this._invalidateCachedData(),this._data.appendByte(3),this._data.appendFloat(e),this._data.appendFloat(t),this._data.appendFloat(n),this._data.appendFloat(r),this}cubicTo1(e,t,n,r,o,a){return this._invalidateCachedData(),this._data.appendByte(4),this._data.appendFloat(e),this._data.appendFloat(t),this._data.appendFloat(n),this._data.appendFloat(r),this._data.appendFloat(o),this._data.appendFloat(a),this}cubicTo2(e,t,n){return this.cubicTo1(e.x(),e.y(),t.x(),t.y(),n.x(),n.y())}close(){return this._invalidateCachedData(),this._data.appendByte(0),this}transformBy(e){this._invalidateCachedData(),!this.isEmpty()&&$e.Command.kind(this.start(),this)!=1&&this._data.prependBytes(new ft(new br).moveTo1(0,0)._data);for(let t=this.start();$e.Command.isValid(t,this);t=$e.Command.next(t,this))switch($e.Command.kind(t,this)){case 0:break;case 1:{ft._p0.setTo($e.Command.moveToX(t,this),$e.Command.moveToY(t,this)),e.transformPoint(ft._p0),$e.Command.setMoveToX(t,this,ft._p0.x()),$e.Command.setMoveToY(t,this,ft._p0.y());break}case 2:{ft._p0.setTo($e.Command.lineToX(t,this),$e.Command.lineToY(t,this)),e.transformPoint(ft._p0),$e.Command.setLineToX(t,this,ft._p0.x()),$e.Command.setLineToY(t,this,ft._p0.y());break}case 3:{ft._p0.setTo($e.Command.quadraticToFirstX(t,this),$e.Command.quadraticToFirstY(t,this)),e.transformPoint(ft._p0),$e.Command.setQuadraticToFirstX(t,this,ft._p0.x()),$e.Command.setQuadraticToFirstY(t,this,ft._p0.y()),ft._p0.setTo($e.Command.quadraticToX(t,this),$e.Command.quadraticToY(t,this)),e.transformPoint(ft._p0),$e.Command.setQuadraticToX(t,this,ft._p0.x()),$e.Command.setQuadraticToY(t,this,ft._p0.y());break}case 4:{ft._p0.setTo($e.Command.cubicToFirstX(t,this),$e.Command.cubicToFirstY(t,this)),e.transformPoint(ft._p0),$e.Command.setCubicToFirstX(t,this,ft._p0.x()),$e.Command.setCubicToFirstY(t,this,ft._p0.y()),ft._p0.setTo($e.Command.cubicToSecondX(t,this),$e.Command.cubicToSecondY(t,this)),e.transformPoint(ft._p0),$e.Command.setCubicToSecondX(t,this,ft._p0.x()),$e.Command.setCubicToSecondY(t,this,ft._p0.y()),ft._p0.setTo($e.Command.cubicToX(t,this),$e.Command.cubicToY(t,this)),e.transformPoint(ft._p0),$e.Command.setCubicToX(t,this,ft._p0.x()),$e.Command.setCubicToY(t,this,ft._p0.y());break}default:break}}static new2(){return new ft(new br)}static fromRect(e){return ft._fromRect(e.x(),e.y(),e.width(),e.height())}static _fromRect(e,t,n,r){let o=ft.new2();return o.moveTo1(e,t).lineTo(e+n,t).lineTo(e+n,t+r).lineTo(e,t+r).close(),o}static fromRoundedRectWithSpread(e,t){return e.adjustCornerRadiiForSpread(t),ft.fromRoundedRect1(e)}static fromRoundedRect1(e){return e.vertexRadii()!=null?ft.fromRoundedRect3(e.left(),e.top(),e.width(),e.height(),e.vertexRadii()):ft.fromRoundedRect2(e.left(),e.top(),e.width(),e.height(),e.nodeRadius())}static fromRoundedRect2(e,t,n,r,o){if(o=Math.min(o,Math.min(n/2,r/2)),o==0)return ft._fromRect(e,t,n,r);let a=ft.new2(),s=ft.CIRCLE_APPROXIMATION_CONSTANT*o;return a.moveTo1(e,t+o).cubicTo1(e,t+o-s,e+o-s,t,e+o,t).lineTo(e+n-o,t).cubicTo1(e+n-o+s,t,e+n,t+o-s,e+n,t+o).lineTo(e+n,t+r-o).cubicTo1(e+n,t+r-o+s,e+n-o+s,t+r,e+n-o,t+r).lineTo(e+o,t+r).cubicTo1(e+o-s,t+r,e,t+r-o+s,e,t+r-o).close(),a}static fromRoundedRect3(e,t,n,r,o){let a=!0;for(let d=0,c=o.length;d<c;d=d+1)o[d]!=0&&(a=!1),o[d]=Math.min(o[d],Math.min(n/2,r/2));if(a)return ft._fromRect(e,t,n,r);let s=ft.new2(),l=o.map(d=>ft.CIRCLE_APPROXIMATION_CONSTANT*d);return s.moveTo1(e,t+o[0]).cubicTo1(e,t+o[0]-l[0],e+o[0]-l[0],t,e+o[0],t).lineTo(e+n-o[1],t).cubicTo1(e+n-o[1]+l[1],t,e+n,t+o[1]-l[1],e+n,t+o[1]).lineTo(e+n,t+r-o[2]).cubicTo1(e+n,t+r-o[2]+l[2],e+n-o[2]+l[2],t+r,e+n-o[2],t+r).lineTo(e+o[3],t+r).cubicTo1(e+o[3]-l[3],t+r,e,t+r-o[3]+l[3],e,t+r-o[3]).close(),s}static forEllipse(e){let t=new E(e.left()+e.width()/2,e.top()+e.height()/2),n=new E(e.width()/2,0),r=new E(0,e.height()/2),o=n.multiply(ft.CIRCLE_APPROXIMATION_CONSTANT),a=r.multiply(ft.CIRCLE_APPROXIMATION_CONSTANT),s=ft.new2();return s.moveTo2(t.add1(n)).cubicTo2(t.add1(n).add1(a),t.add1(o).add1(r),t.add1(r)).cubicTo2(t.subtract1(o).add1(r),t.subtract1(n).add1(a),t.subtract1(n)).cubicTo2(t.subtract1(n).subtract1(a),t.subtract1(o).subtract1(r),t.subtract1(r)).cubicTo2(t.add1(o).subtract1(r),t.add1(n).subtract1(a),t.add1(n)).close(),s}static forCenterStrokeAroundRect(e,t){let n=e.x(),r=e.y(),o=e.width(),a=e.height(),s=t/2,l=ft.new2();return l.moveTo1(n-s,r-s).lineTo(n+o+s,r-s).lineTo(n+o+s,r+a+s).lineTo(n-s,r+a+s).lineTo(n-s,r-s).lineTo(n+s,r+s).lineTo(n+s,r+a-s).lineTo(n+o-s,r+a-s).lineTo(n+o-s,r+s).lineTo(n+s,r+s).close(),l}};ft.CIRCLE_APPROXIMATION_CONSTANT=4/3*(Math.sqrt(2)-1),ft._p0=E.new2(),ft._p1=E.new2(),ft._p2=E.new2(),ft._p3=E.new2(),ft._r=U.new2();var Rt=ft;var Eo=class i{constructor(e){this.handle=0,this._cachedInfo=null,this._hash=0,this.handle=e}_updateCachedInfoIfNecessary(){if(this._cachedInfo==null){let e=L._prototypeLib.modules().uniquePath_Internal.bounds(this.handle),t=e.max.x-e.min.x,n=e.max.y-e.min.y,r=new U(e.min.x,e.min.y,t,n);this._cachedInfo=new zd(r,L._prototypeLib.modules().uniquePath_Internal.isRect(this.handle))}}bounds(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.bounds}equals2(e){return e instanceof i?this.handle==e.handle:!1}clone(){return new i(this.handle)}hash(){return this._hash==null&&(this._hash=L._prototypeLib.modules().uniquePath_Internal.getHash(this.handle)),this._hash}isRect(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.isRect}canBeAnalyticallyAntialiased(){return!1}toBezierPath(){throw new Error("We should never need to copy UniquePath data into JS")}asRoundedRectPath(){return null}compileLoopBlinnAndReturnVolatileTriangles(){let e=L._prototypeLib.modules().uniquePath_Internal.loopBlinnCompile(this.handle);return e==null?(Ke("Failed to compile UniquePath"),cN):e}},cN=new Uint8Array([]);var Mh=class Mh{setSerialization(e){this._serialization=e}decodeFillPaintData(e){if(e.length==0)return Oe.EMPTY;let t=be.schema.decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let n=null;try{let r=t.nodeChanges[0],o=r.fillPaints!=null?r.fillPaints:r.strokePaints;n=this._serialization.decodePaints(o,t.blobs)}catch(r){Ke("Caught error during fill paints marshaling. Rendered output may be incorrect"),Zs(r),n=Oe.EMPTY}return n}decodeSingleSolidFillWithNormalBlendMode(e,t,n){if(e.alpha!=1)throw new Error("Alpha from C++ is always expected to be 1");let r=new se("SOLID");return r.setColor(C.new3(e.red,e.green,e.blue,e.alpha)),r.setOpacity(t),r.setIsEnabled(n),[r].slice()}decodeEffectData(e){let t=be.schema.decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return gt.decodeEffects(t.nodeChanges[0].effects)}decodePrototypeInteractions(e){let t=be.schema.decodeNodeChange(e);if(t==null)throw new Error("Got bad node change from C++");return gt.decodePrototypeInteractions(t.prototypeInteractions)}decodeVectorData(e){let t=be.schema.decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return this._serialization.decodeVectorData(t.nodeChanges[0].vectorData,t.blobs)}decodeTextData(e,t,n){let r=be.schema.decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let o=this._serialization.decodeTextData(r.nodeChanges[0].textData,r.blobs),a=[];for(let s of n)a.push(this._serialization.decodeEmojiImage(s));return new Jo(o.styleOverrideTable(),t?1:0,o.hyperlinkBoxesDEPRECATED(),o.characters(),o.lines(),o.characterStyleIds(),n,a)}decodeDerivedTextData(e,t,n){let r=be.schema.decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let o=this._serialization.decodeDerivedTextData(r.nodeChanges[0].derivedTextData,r.blobs),a=[];for(let s of n)a.push(this._serialization.decodeEmojiImage(s));return new Ni(t?1:0,o.hyperlinkBoxes(),n,a)}constructor(){this._serialization=null}};Mh.instance=new Mh;var Za=Mh;var Vo=(t=>(t[t.INTERACTIVE_COMPONENTS_ENABLED=0]="INTERACTIVE_COMPONENTS_ENABLED",t[t.INTERACTIVE_COMPONENTS_DISABLED=1]="INTERACTIVE_COMPONENTS_DISABLED",t))(Vo||{}),Xf=class{constructor(e,t){this.clone=e,this.source=t}},jf=class{constructor(e,t){this.transitionRootStablePath=e,this.cloneOps=t}},zo=class zo{constructor(e,t){this._appState=null,this._modules=null,this._cachedViewNode=null,this._modules=e,this._appState=t}modules(){return this._modules}nodeTsApi(){var e;return(e=this._modules)==null?void 0:e.nodeTsApi}nodeTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.nodeTsApiGenerated}sceneGraphTsApi(){var e;return(e=this._modules)==null?void 0:e.sceneGraphTsApi}_prototype(){var e;return(e=this._modules)==null?void 0:e.prototype}fonts(){var e;return(e=this._modules)==null?void 0:e.fonts}dumpFileForTests(){return this._prototype().dumpFile()}getNodeChangesForSwap(e,t,n){let r=this._prototype().getNodeChangesForSwap(e.guids,t,n),o=this._appState.scene(),a=r.clones.map(s=>{let l=o.findNode1(s.clone),d=o.findNode1(s.source);return new Xf(l,d)});return new jf(new Mt(r.transitionRootStablePath),a)}runSetVariable(e,t,n,r){this._prototype().runSetVariable(e,t,n,r)}getFirstTruthyConditionalIndex(e,t){return this._prototype().getFirstTruthyConditionalIndex(e,t)}getICActionsForSetVariableAction(e,t,n,r,o){return this._prototype().getICActionsForSetVariableAction(e,t,n,r,o)}shouldDisallowSwap(e,t){return this._prototype().shouldDisallowSwap(e.guids,t)}applyExistingVariableChangesToIFLLoadedNodes(){this._prototype().applyExistingVariableChangesToIFLLoadedNodes()}prepareCppNodeForAccess(e){e!=this._cachedViewNode&&(this.nodeTsApi().setGlobalUnstableNodeByHandle(e.handle()),this._cachedViewNode=e)}createSceneAndSetActive(e,t){lr.instance.interactiveComponentsStatusForNewScene=t;let n=this._prototype().createSceneWithDangerousLoadingFlag(e);this._prototype().setActiveScene(n);let r=lr.instance.findScene(n);if(r==null)throw new Error("Failed to create scene in C++");return this._setSceneAsActiveIfNeeded(r),r}destroyScene(e){this._prototype().destroyScene(e.handle())}markSceneLoaded(e){this._prototype().markSceneLoaded(e.handle())}resetLocalChanges(){this._prototype().resetLocalChanges()}resetLocalVariableChanges(){this._prototype().resetLocalVariableChanges()}resetLocalInstanceChanges(e){this._prototype().resetLocalInstanceChanges(e)}resetLocalNestedInstanceChanges(e){this._prototype().resetLocalNestedInstanceChanges(e)}nodeHasLocalSymbolChanges(e){return this._prototype().nodeHasLocalSymbolChanges(e)}getNumStateTransitions(e){return this._prototype().getNumStateTransitions(e)}_setSceneAsActiveIfNeeded(e){this._prototype().getActiveScene()!=e.handle()&&this._prototype().setActiveScene(e.handle())}applyNodeChanges(e){this._prototype().applyNodeChanges(e,na)}reset(){this._prototype()!=null&&this._prototype().reset()}findNode(e,t){return this._setSceneAsActiveIfNeeded(e),this._prototype().findNodeByStablePath(t.guids)}idlRegionsToGeometry(e,t){if(e===null||e==null)return null;let n=[],r=[];Tt.INSTANCE.reset();for(let a of e){let s=new Eo(a.path),l=new Yn(a.windingRule==1?"ODD":"NONZERO",a.styleID,s,s.bounds());n.push(l),r.push(a.styleID),Tt.INSTANCE.include3(l.bounds())}let o=t!=null?t:new ho(new Xn(new Map));return new Dn(n,r,Tt.INSTANCE.build(),o)}idlRegionsToTextGeometry(e,t){if(e==null)return null;let n=[],r=[],o=[];Tt.INSTANCE.reset();for(let s of e){let l=new Eo(s.path),d=new Yn(s.windingRule==1?"ODD":"NONZERO",s.styleID,l,l.bounds());n.push(d),r.push(s.styleID),o.push(s.emojiCodePoints),Tt.INSTANCE.include3(d.bounds())}let a=t!=null?t:new ho(new Xn(new Map));return new _u(n,r,Tt.INSTANCE.build(),a,o)}getFillGeometryForSpread(e,t,n){return this.prepareCppNodeForAccess(n),this._prototype().getFillGeometryForSpread(e,t,2)}getAffineTransform(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getAffineTransform(t),new oe(yt.retAffineTransform_m00,yt.retAffineTransform_m01,yt.retAffineTransform_m02,yt.retAffineTransform_m10,yt.retAffineTransform_m11,yt.retAffineTransform_m12)}getAffineTransform_SGEO(e){return this._prototype().getAffineTransform_SGEO(e),new oe(yt.retAffineTransform_m00,yt.retAffineTransform_m01,yt.retAffineTransform_m02,yt.retAffineTransform_m10,yt.retAffineTransform_m11,yt.retAffineTransform_m12)}getArcData(e,t){this.prepareCppNodeForAccess(e),this._prototype().getArcData(t);let n={};return n.startingAngle=yt.retArcData_startAngle,n.endingAngle=yt.retArcData_endAngle,n.innerRadius=yt.retArcData_innerRadius,n}getArcData_SGEO(e){this._prototype().getArcData_SGEO(e);let t={};return t.startingAngle=yt.retArcData_startAngle,t.endingAngle=yt.retArcData_endAngle,t.innerRadius=yt.retArcData_innerRadius,t}getBool(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getBool(t)}getBool_SGEO(e){return this._prototype().getBool_SGEO(e)}getDouble(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getDouble(t)}getDouble_SGEO(e){return this._prototype().getDouble_SGEO(e)}getEffectList(e){this.prepareCppNodeForAccess(e);let t=this._prototype().getEffectList();return Hr.WeakHandle_isValid(t)?this._modules.effectData_Internal.getOrCreateSkewCopy(t):[]}getEffectList_SGEO(e){let t=this._prototype().getEffectList_SGEO(e);return Hr.WeakHandle_isValid(t)?this._modules.effectData_Internal.getOrCreateSkewCopy(t):[]}getGUID(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getGUID(t),ne._new(yt.retGUID_sessionId,yt.retGUID_localId)}getGUID_SGEO(e){return this._prototype().getGUID_SGEO(e),ne._new(yt.retGUID_sessionId,yt.retGUID_localId)}getStyleId(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getStyleId(t),{guid:yt.retStyleId.guid,ref:yt.retStyleId.ref}}getStyleId_SGEO(e){return this._prototype().getStyleId_SGEO(e),{guid:yt.retStyleId.guid,ref:yt.retStyleId.ref}}getInt(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getInt(t)}getInt_SGEO(e,t){return this._prototype().getInt_SGEO(e,t)}getPaintList(e,t){this.prepareCppNodeForAccess(e);let n=this._prototype().getPaintList(t);return Hr.WeakHandle_isValid(n)?this._modules.paintData_Internal.getOrCreateSkewCopy(n):[]}getPaintList_SGEO(e){let t=this._prototype().getPaintList_SGEO(e);return Hr.WeakHandle_isValid(t)?this._modules.paintData_Internal.getOrCreateSkewCopy(t):[]}getField(e,t){this.prepareCppNodeForAccess(e);let n=this._prototype().getField(t);if(n.length==0)return null;let r=be.schema.decodeMessage(n);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField");let o=r.nodeChanges[0],a=[],s=null;return this._appState.serialization().decodeNodeChange(o,a,(l,d)=>{s=d}),s}getField_SGEO(e){let t=this._prototype().getField_SGEO(e);if(t.length==0)return null;let n=be.schema.decodeMessage(t);if(n.nodeChanges===void 0||n.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField_SGEO");let r=n.nodeChanges[0],o=[],a=null;return this._appState.serialization().decodeNodeChange(r,o,(s,l)=>{a=l}),a}getParentIndex(e){this.prepareCppNodeForAccess(e);let t=this._prototype().getParentIndex();return qn.fromString(t)}getParentIndex_SGEO(e){return qn.fromString(this._prototype().getParentIndex_SGEO(e))}getPrototypeInteractions_SGEO(e){let t=this._prototype().getPrototypeInteractions_SGEO(e);return Hr.WeakHandle_isValid(t)?this._modules.prototypeInteractions_Internal.getOrCreateSkewCopy(t):[]}getString(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getString(t)}getString_SGEO(e){return this._prototype().getString_SGEO(e)}getVector(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getVector(t),new E(yt.retVector_x,yt.retVector_y)}getVector_SGEO(e){return this._prototype().getVector_SGEO(e),new E(yt.retVector_x,yt.retVector_y)}getOverridePath(e){return this.prepareCppNodeForAccess(e),new Mt(this._prototype().overridePath())}getStablePath(e){return this.prepareCppNodeForAccess(e),new Mt(this._prototype().stablePath())}getHas(e,t){return this.prepareCppNodeForAccess(e),this._prototype().has(t)}forEachField(e,t){this.prepareCppNodeForAccess(e),yt.forEachFieldCallback=t,this._prototype().forEachField(),yt.forEachFieldCallback=null}applyLocalNodeChangesForTests(e){if(!zo.isTestingEnv())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().applyLocalNodeChangesForTests(e)}clearDirtyTextLayoutForTests(e){if(!zo.isTestingEnv())throw new Error("Should not be calling flushLayoutForTests outside of tests");this._prototype().clearDirtyTextLayoutForTests(e.handle())}updateSymbolInstancesForTests(){if(!zo.isTestingEnv())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().updateSymbolInstancesForTests()}updateStylesForTests(){if(!zo.isTestingEnv())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().updateStylesForTests()}static destroy(){zo._prototypeLib!=null&&zo._prototypeLib.reset(),zo._prototypeLib=null}static initialize(e,t){if(zo._prototypeLib!=null){Ke("Attempt to initialize PrototypeLib, but PrototypeLib is already initialized");return}zo._prototypeLib=new zo(e,t),Za.instance.setSerialization(t.serialization()),Ki&&e.interactionTestHelpers.setIsRunningViewerRenderServer()}static isTestingEnv(){return kr||Ki}};zo._prototypeLib=null;var L=zo,Wd=class Wd{isReady(){return this._isReady}createScene(e){return new It(e,Wd.instance.interactiveComponentsStatusForNewScene)}setViewer(e){this._viewer=e}getViewer(){return this._viewer}handleUncompressedMessage(e,t){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.handleUncompressedMessage(e,t)}handleUncompressedSchema(e){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");return this._multiplayer.handleUncompressedSchema(e)}didReceiveNodeChanges(e,t){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.didReceiveNodeChanges(e,t)}setSerialization(e){this._serialization=e}setMultiplayer(e){this._multiplayer=e}findScene(e){return L._prototypeLib.modules().prototype.getScene(e)}findNode(e){return qt.IntMap_get(this._nodes,e,null)}setReverseVariantBindingsForICsDisabled(e){let t=this._reverseVariantBindingsForICsDisabled;return this._reverseVariantBindingsForICsDisabled=e,t}reverseVariantBindingsForICsDisabled(){return this._reverseVariantBindingsForICsDisabled}ready(){this._isReady=!0}track(e,t){Be.trackEventJSON1(e,t)}triggerViewerEvent(e,t){this._viewer!==null&&this._viewer.trigger(e,t)}Node_created(e,t,n,r){if(t!=null){let o=new be(e,t,ne._new(n,r));this._nodes.set(e,o),t.dangerouslyRegisterNode(o)}else throw new Error("Cannot create node with null scene")}Node_destroyed(e){let t=this.findNode(e);if(t!=null){let n=t.scene();n!=null&&n.dangerouslyUnregisterNode(t.id()),this._nodes.delete(e)}}triggerSceneGraphEvent(e,t,n){let r=this.findNode(e);if(r==null)return;let o=r.scene();if(o!=null){let a=t,s=r.id(),l=zI(L._prototypeLib,o,s,a,n),d=null,c=!1;a==97?$.asStringEnum(l,"CREATED")=="CREATED"?(d=$.new8("REMOVED"),c=!0):d=$.new8("CREATED"):d=ch(L._prototypeLib,r,a),o.broadcastPropertyChange(new Wp(r,a,l,d)),c&&o.dangerouslyUnregisterNode(s)}}updateNodeAfterPropertyChange(e,t){let n=this.findNode(e);n!=null&&n.updateAfterPropertyChange(t)}linkNodeToParent(e,t,n){let r=this.findNode(e);r!=null&&r.linkToParent(this.findNode(t),n)}unlinkNodeFromParent(e){let t=this.findNode(e);t!=null&&t.unlinkFromParent()}debugPrototypeActionFromPreview(e){top.postMessage({debugPrototypeActionFromPreview:e},window.origin)}retAffineTransform(e,t,n,r,o,a){yt.retAffineTransform_m00=e,yt.retAffineTransform_m01=t,yt.retAffineTransform_m02=n,yt.retAffineTransform_m10=r,yt.retAffineTransform_m11=o,yt.retAffineTransform_m12=a}retArcData(e,t,n){yt.retArcData_startAngle=e,yt.retArcData_endAngle=t,yt.retArcData_innerRadius=n}retGUID(e,t){yt.retGUID_sessionId=e,yt.retGUID_localId=t}retStyleId(e){yt.retStyleId=e}retVector(e,t){yt.retVector_x=e,yt.retVector_y=t}forEachFieldCallback(e){yt.forEachFieldCallback!=null&&yt.forEachFieldCallback(e)}constructor(){this._viewer=null,this._isReady=!1,this._serialization=new gt(null),this._multiplayer=null,this.interactiveComponentsStatusForNewScene=1,this._nodes=new Map,this._reverseVariantBindingsForICsDisabled=!1}};Wd.instance=new Wd;var lr=Wd,yt;(_=>(_.retAffineTransform_m00=0,_.retAffineTransform_m01=0,_.retAffineTransform_m02=0,_.retAffineTransform_m10=0,_.retAffineTransform_m11=0,_.retAffineTransform_m12=0,_.retArcData_startAngle=0,_.retArcData_endAngle=0,_.retArcData_innerRadius=0,_.retGUID_sessionId=0,_.retGUID_localId=0,_.retStyleId=null,_.retVector_x=0,_.retVector_y=0,_.forEachFieldCallback=null))(yt||(yt={}));var mv;(e=>{function i(t){return Vo[t]}e.InteractiveComponentsEnabled_toString=i})(mv||(mv={}));var X;(Me=>{function i(){return w().useIntBoundariesForScissor}Me.useIntBoundariesForScissor=i;function e(){return w().optimizationExposureLogging}Me.optimizationExposureLogging=e;function t(){return w().viewerPerfH22023Holdout}function n(){return!t()&&w().viewerPerfH22023Combined}function r(){return!t()&&!n()&&w().viewerSkipInvisibleTreeOpt}Me.viewerSkipInvisibleTreeOpt=r;function o(){return!t()&&!n()&&w().viewerSkipNotDirtyTreeOpt}Me.viewerSkipNotDirtyTreeOpt=o;function a(){return!t()&&!n()&&w().viewerAnimationEasingCache}Me.viewerAnimationEasingCache=a;function s(){return!t()&&!n()&&w().debounceMouseMoveScrolling}Me.debounceMouseMoveScrolling=s;function l(){return!t()&&!n()&&w().roundedMaskOptimization}Me.roundedMaskOptimization=l;function d(){return!t()&&!n()&&w().cullTreesDuringTilePrioritization}Me.cullTreesDuringTilePrioritization=d;function c(){return!t()&&!n()&&w().enableFramebufferSwitchBudget}Me.enableFramebufferSwitchBudget=c;function p(){return!t()&&!n()&&w().smartAnimateCacheTransform}Me.smartAnimateCacheTransform=p;function u(){return!t()&&!n()&&w().prototypeMouseMovePerf}Me.prototypeMouseMovePerf=u;function h(){return(Xe.isMobile(Xe.current())||Xe.current()==4&&navigator.maxTouchPoints>0||wt.forceMobileOptimizations())&&w().respectRenderBudgetOnScroll}Me.respectRenderBudgetOnScroll=h;function f(){return w().backgroundBlurOpts}Me.useBackgroundBlurOpts=f;function _(){return w().flushAfterClear}Me.shouldFlushAfterClear=_;function m(){return w().flushAfterStencilCover}Me.shouldFlushAfterStencilCover=m;function A(){return w().flushAfterRenderGeometryDirectly}Me.shouldFlushAfterRenderGeometryDirectly=A;function y(){return w().flushAfterDraws}Me.shouldFlushAfterDraws=y;function S(){return Xe.isMobile(Xe.current())||Xe.current()==4&&navigator.maxTouchPoints>0||wt.forceMobileOptimizations()}Me.shouldPreventVolatileCaching=S;function g(){return window.devicePixelRatio>3}Me.isHighDPR=g;function b(){return w().internalDebugTools}Me.internalDebugTools=b;function T(){return!g()}Me.useSSAA=T;function I(st){return Me._bowser.version===null||Me._bowser.version===void 0?!1:Me._bowser.compareVersions([Me._bowser.version,st])>=0}Me.isBrowserVersionAtLeast=I;function O(st){return Me._bowser.osversion===null||Me._bowser.osversion===void 0?!1:Me._bowser.compareVersions([Me._bowser.osversion,st])>=0}Me.isOSVersionAtLeast=O;function w(){return Me._featureFlags}Me.getFeatureFlags=w;function P(st){var kt,Ne;Me._featureFlags=Ft.create(st),kr?Ri.featureFlagsCppApi.updateFeatureFlags(st):((Ne=(kt=L._prototypeLib)==null?void 0:kt.modules())==null?void 0:Ne.featureFlagsCppApi)!=null&&L._prototypeLib.modules().featureFlagsCppApi.updateFeatureFlags(st)}Me.setFeatureFlags=P;function H(st){var Ne;let kt=Object.assign({},(Ne=Me._featureFlags)==null?void 0:Ne.originalObject);P(Object.assign(kt,st))}Me.updateFeatureFlags=H;function re(){return Me._viewerMode}Me.getViewerMode=re;function q(st){Me._viewerMode=st}Me.setViewerMode=q;function W(){return Me._scrollToPan}Me.getScrollToPan=W;function x(st){Me._scrollToPan=st}Me.setScrollToPan=x;function F(){return Me._dragToPan}Me.getDragToPan=F;function k(st){Me._dragToPan=st}Me.setDragToPan=k;function G(){return Me._disablePrototypeDeviceFrames}Me.disablePrototypeDeviceFrames1=G;function M(st){Me._disablePrototypeDeviceFrames=st}Me.disablePrototypeDeviceFrames2=M;function Q(){return Me._gameControllerListener}Me.gameControllerListener=Q;function Y(){return Me._isInlinePreview}Me.isInlinePreview=Y;function B(st){Me.protoUseFrameEvictionForUnitTests=st}Me.setProtoUseFrameEvictionForUnitTests=B;function te(){return 2==0?Me.protoUseFrameEvictionForUnitTests:Xe.isMobile(Xe.current())||Xe.current()==4&&navigator.maxTouchPoints>0||wt.forceMobileOptimizations()}Me.protoUseFrameEviction=te;function j(){return!te()&&w().prototypeIflPreloadMore}Me.protoPreloadMore=j;function ie(st){let kt=nt=>{if(!(nt in st))throw new Error(`Missing required parameter '${nt}'`);return st[nt]},Ne=(nt,v)=>nt in st?st[nt]:v,We=kt("featureFlags");P(We),Me._viewerMode=Ut.ViewerMode_create(kt("viewerMode")),Be.initialize(Ne("trackAnalyticsEvent",null),Ne("definedAnalyticsHandler",null),Ne("appTimerStart",null),Ne("appTimerStop",null),Ne("loadTimeTracker",null),Ne("socketConnectionTracker",null)),Me._bowser=kt("bowser"),Xe.initialize(Me._bowser),Me._scrollToPan=Ne("scrollToPan",Me._scrollToPanDefault),Me._disablePrototypeDeviceFrames=Ne("disablePrototypeDeviceFrames",Me._disablePrototypeDeviceFramesDefault),Me._gameControllerListener=Ne("gameControllerListener",null),Me._isInlinePreview=Ne("isInlinePreview",!1)}Me.initialize=ie;function de(){return!Me._disablePrototypeDeviceFrames&&Me._viewerMode==1}Me.deviceFramesSupported=de;function tt(st){Me.prototypeBackgroundColorOverride=st}Me.setPrototypeBackgroundColorOverride=tt;function bt(){if(Me._htmlImageDecodeMethodIsPresent==null){let st=jr.HTMLDocument_createElementImage(document),kt=st.decode!==null&&st.decode!==void 0;Me._htmlImageDecodeMethodIsPresent=new Se(kt)}return Me._htmlImageDecodeMethodIsPresent.value}Me.htmlImageDecodeMethodIsPresent=bt;function ht(){return Xe.isMobile(Xe.current())||Xe.current()==4&&navigator.maxTouchPoints>0||wt.forceMobileOptimizations()}Me.shouldApplyMobileOptimizations=ht;class Ft{static create(kt){let Ne=nt=>kt===null?!1:!!kt[nt],We=new Ft;return We.embedApiLimitOrigins=Ne("embed_api_limit_origins"),We.viewerWebGLClearWorkaround=Ne("viewer_webgl_clear_workaround"),We.viewerWebGLClearWorkaroundDisable=Ne("viewer_clear_workaround_disable"),We.swipePresentation=Ne("swipe_presentation"),We.flushBeforeMasks=Ne("flush_before_masks"),We.animatedGIFs=Ne("animated_gifs"),We.removePreviewStencil=Ne("viewer_remove_preview_stencil"),We.mergeInteractiveBounds=Ne("viewer_merge_interactive_bounds"),We.internalDebugTools=Ne("internal_only_debug_tools"),We.viewerServerDownsample1024=Ne("viewer_server_downsample_1024"),We.prototypeLogVideoAndICSwap=Ne("prototype_log_video_and_ic_swap"),We.respectRenderBudgetOnScroll=Ne("viewer_respect_budget_on_scroll"),We.fontIndex220528=Ne("font_index_220528"),We.fontIndexEmoji=Ne("font_index_emoji"),We.fontIndexEmojiLowRes=Ne("font_index_emoji_low_res"),We.backgroundBlurOpts=Ne("viewer_background_blur_opts"),We.flushAfterClear=Ne("viewer_flush_after_clear"),We.flushAfterStencilCover=Ne("viewer_flush_after_stencil_cover"),We.flushAfterRenderGeometryDirectly=Ne("flush_after_render_geometry_dir"),We.flushAfterDraws=Ne("flush_after_draws"),We.variables=Ne("variables"),We.prototypeTemporaryStickyScroll=Ne("prototype_temporary_stickyscroll"),We.logAllWebsocket=Ne("prototype_log_all_ws"),We.prototypeIflPreloadMore=Ne("prototype_ifl_preload_more"),We.overlayBackgroundBlurs=Ne("viewer_overlay_background_blurs"),We.prototypeStateManagement=Ne("prototype_state_management"),We.prototypeIflDelaySceneLoad=Ne("prototype_ifl_delay_scene_load"),We.videoOnIOSStaging=Ne("video_on_ios_staging"),We.prototypeCombineTlfLogic=Ne("prototype_combine_tlf_logic"),We.prototypeNewMouseEvents=Ne("prototype_new_mouse_events"),We.prototypeTransparentWebMVideo=Ne("prototype_transparent_webm_video"),We.textDataDerivedSepRead=Ne("text_data_derived_sep_read"),We.textDataDerivedSepDw=Ne("text_data_derived_sep_dw"),We.roundedMaskOptimization=Ne("rounded_mask_optimization"),We.debounceMouseMoveScrolling=Ne("debounce_mouse_move_scrolling"),We.viewerPerfH22023Holdout=Ne("viewer_perf_h2_2023_holdout"),We.viewerPerfH22023Combined=Ne("viewer_perf_h2_2023_combined"),We.viewerSkipInvisibleTreeOpt=Ne("viewer_skip_invisible_tree_opt"),We.viewerSkipNotDirtyTreeOpt=Ne("viewer_skip_not_dirty_tree_opt"),We.cullTreesDuringTilePrioritization=Ne("viewer_tile_list_culling"),We.arcsSpreadShadow=Ne("viewer_arcs_spread_shadow"),We.smartAnimateCacheTransform=Ne("smart_animate_cache_transform"),We.iflEnhancements=Ne("viewer_ifl_enhancements"),We.enableFramebufferSwitchBudget=Ne("framebuffer_switch_budget_viewer"),We.viewerAnimationEasingCache=Ne("viewer_animation_easing_cache"),We.optimizationExposureLogging=Ne("optimization_exposure_logging"),We.disableRendering=Ne("viewer_disable_rendering"),We.useIntBoundariesForScissor=Ne("use_int_boundaries_for_scissor"),We.prototypeMouseMovePerf=Ne("prototype_mousemove_perf"),We.prototypeNewMousePerf=Ne("prototype_new_mouse_perf"),We.originalObject=kt,We}constructor(){this.embedApiLimitOrigins=!1,this.viewerWebGLClearWorkaround=!1,this.viewerWebGLClearWorkaroundDisable=!1,this.swipePresentation=!1,this.flushBeforeMasks=!1,this.animatedGIFs=!1,this.removePreviewStencil=!1,this.originalObject=null,this.mergeInteractiveBounds=!1,this.internalDebugTools=!1,this.canvasLoadGrowOnly=!1,this.viewerServerDownsample1024=!1,this.prototypeLogVideoAndICSwap=!1,this.prototypeLogVideoPlay=!1,this.respectRenderBudgetOnScroll=!1,this.fontIndex220528=!1,this.fontIndexEmoji=!1,this.fontIndexEmojiLowRes=!1,this.backgroundBlurOpts=!1,this.flushAfterClear=!1,this.flushAfterStencilCover=!1,this.flushAfterRenderGeometryDirectly=!1,this.flushAfterDraws=!1,this.variables=!1,this.prototypeTemporaryStickyScroll=!1,this.logAllWebsocket=!1,this.multipleActions=!1,this.prototypeStateManagement=!1,this.prototypeIflPreloadMore=!1,this.overlayBackgroundBlurs=!1,this.prototypeIflDelaySceneLoad=!1,this.videoOnIOSStaging=!1,this.prototypeAllowInvisibleSource=!1,this.prototypeCombineTlfLogic=!1,this.prototypeNewMouseEvents=!1,this.prototypeTransparentWebMVideo=!1,this.textDataDerivedSepRead=!1,this.textDataDerivedSepDw=!1,this.roundedMaskOptimization=!1,this.debounceMouseMoveScrolling=!1,this.cullTreesDuringTilePrioritization=!1,this.smartAnimateCacheTransform=!1,this.iflEnhancements=!1,this.viewerPerfH22023Holdout=!1,this.viewerPerfH22023Combined=!1,this.viewerSkipInvisibleTreeOpt=!1,this.viewerSkipNotDirtyTreeOpt=!1,this.enableFramebufferSwitchBudget=!1,this.viewerAnimationEasingCache=!1,this.optimizationExposureLogging=!1,this.useIntBoundariesForScissor=!1,this.prototypeMouseMovePerf=!1,this.prototypeNewMousePerf=!1}}Me.FeatureFlags=Ft;let Gt;(Ne=>(Ne[Ne.MIRROR=0]="MIRROR",Ne[Ne.PROTOTYPE=1]="PROTOTYPE"))(Gt=Me.ViewerMode||(Me.ViewerMode={}));let Ut;(Ne=>{function st(We){if(typeof We=="string")switch(We){case"MIRROR":return 0;case"PROTOTYPE":return 1}throw new Error(`Invalid viewer mode: ${We}`)}Ne.ViewerMode_create=st;function kt(We){return Gt[We]}Ne.ViewerMode_toString=kt})(Ut=Me.in_ViewerMode||(Me.in_ViewerMode={})),Me._bowser=null,Me._featureFlags=new Ft,Me._viewerMode=1,Me._scrollToPanDefault=!0,Me._scrollToPan=Me._scrollToPanDefault,Me._dragToPanDefault=!0,Me._dragToPan=Me._dragToPanDefault,Me._disablePrototypeDeviceFramesDefault=!1,Me._disablePrototypeDeviceFrames=Me._disablePrototypeDeviceFramesDefault,Me._gameControllerListener=null,Me._isInlinePreview=!1,Me.protoUseFrameEvictionForUnitTests=!1,Me.prototypeBackgroundColorOverride=null,Me._htmlImageDecodeMethodIsPresent=null,Me.forceInitiateStateChangeForTests=!1})(X||(X={}));var N;(xe=>{function i(){return xe._supportsWebGLExtensionOESStandardDerivatives}xe.supportsWebGLExtensionOESStandardDerivatives=i;function e(nt){xe._supportsWebGLExtensionOESStandardDerivatives=nt}xe.setSupportsWebGLExtensionOESStandardDerivatives=e;function t(nt){return nt==0?4:1}xe.byteCount=t;function n(nt){window.testFakeLostContext=()=>{let v=nt.getExtension("WEBGL_lose_context");v.loseContext();let R=3;setTimeout(()=>{console.log(`waiting ${R} seconds to restore the context...`)},500),setTimeout(()=>{v.restoreContext()},R*1e3)},window.testRealLostContext=()=>{let v=[];for(let R=0;R<32;R=R+1)v.push(lo.HTMLCanvasElement_getContextWebGL1(jr.HTMLDocument_createElementCanvas(document)))}}xe.addContextLossTestFunctionsToGlobalScope=n;function r(nt){let v=nt==null?void 0:nt.graphicsCardName();return v!=null&&v.indexOf("SwiftShader")!=-1}xe.isUsingSoftwareRenderer=r;let o;(D=>(D[D.ZERO=0]="ZERO",D[D.ONE=1]="ONE",D[D.SOURCE_COLOR=2]="SOURCE_COLOR",D[D.TARGET_COLOR=3]="TARGET_COLOR",D[D.INVERSE_SOURCE_COLOR=4]="INVERSE_SOURCE_COLOR",D[D.INVERSE_TARGET_COLOR=5]="INVERSE_TARGET_COLOR",D[D.SOURCE_ALPHA=6]="SOURCE_ALPHA",D[D.TARGET_ALPHA=7]="TARGET_ALPHA",D[D.INVERSE_SOURCE_ALPHA=8]="INVERSE_SOURCE_ALPHA",D[D.INVERSE_TARGET_ALPHA=9]="INVERSE_TARGET_ALPHA",D[D.CONSTANT=10]="CONSTANT",D[D.INVERSE_CONSTANT=11]="INVERSE_CONSTANT"))(o=xe.BlendOperation||(xe.BlendOperation={}));let Dt=class Dt{static createInterpolateBlendState(v){return new Dt(10,11,10,11,v)}constructor(v,R,z,Z,ae){this.sourceColor=v,this.targetColor=R,this.sourceAlpha=z,this.targetAlpha=Z,this.constant=ae}};Dt.ZERO=new Dt(0,0,0,0,0),Dt.COPY=new Dt(1,0,1,0,0),Dt.KEEP=new Dt(0,1,0,1,0),Dt.PREMULTIPLIED=new Dt(1,8,1,8,0),Dt.PREMULTIPLIED_SOURCE_UNDER_TARGET=new Dt(9,1,9,1,0),Dt.UNPREMULTIPLIED=new Dt(6,8,6,8,0),Dt.SCREEN=new Dt(1,4,1,8,0);let a=Dt;xe.BlendState=Dt;let s;(z=>(z[z.ALL=0]="ALL",z[z.COLOR=1]="COLOR",z[z.DEPTH_STENCIL=2]="DEPTH_STENCIL"))(s=xe.Clear||(xe.Clear={}));let l;(R=>(R[R.TRIANGLES=0]="TRIANGLES",R[R.TRIANGLE_STRIP=1]="TRIANGLE_STRIP"))(l=xe.Primitive||(xe.Primitive={}));let d;(De=>(De[De.ALWAYS=0]="ALWAYS",De[De.EQUAL=1]="EQUAL",De[De.GREATER_THAN=2]="GREATER_THAN",De[De.GREATER_THAN_OR_EQUAL=3]="GREATER_THAN_OR_EQUAL",De[De.LESS_THAN=4]="LESS_THAN",De[De.LESS_THAN_OR_EQUAL=5]="LESS_THAN_OR_EQUAL",De[De.NEVER=6]="NEVER",De[De.NOT_EQUAL=7]="NOT_EQUAL"))(d=xe.Comparison||(xe.Comparison={}));let c;(De=>(De[De.DECREMENT_CLAMP=0]="DECREMENT_CLAMP",De[De.DECREMENT_WRAP=1]="DECREMENT_WRAP",De[De.INCREMENT_CLAMP=2]="INCREMENT_CLAMP",De[De.INCREMENT_WRAP=3]="INCREMENT_WRAP",De[De.INVERT=4]="INVERT",De[De.KEEP=5]="KEEP",De[De.REPLACE=6]="REPLACE",De[De.ZERO=7]="ZERO"))(c=xe.StencilOperation||(xe.StencilOperation={}));let An=class An{equals(v){return this==v||this.reference==v.reference&&this.comparison==v.comparison&&this.readMask==v.readMask&&this.writeMask==v.writeMask&&this.stencilFail==v.stencilFail&&this.stencilPassDepthFail==v.stencilPassDepthFail&&this.stencilPassDepthPass==v.stencilPassDepthPass}constructor(v,R,z,Z,ae,pe,Te){this.reference=v,this.comparison=R,this.readMask=z,this.writeMask=Z,this.stencilFail=ae,this.stencilPassDepthFail=pe,this.stencilPassDepthPass=Te}};An.NONE=new An(0,6,0,-1,5,5,5);let p=An;xe.StencilFaceState=An;let hn=class hn{constructor(){if(arguments.length==0)this.isEnabled=!1,this.frontFace=null,this.backFace=null,this.isEnabled=!1,this.frontFace=p.NONE,this.backFace=p.NONE;else if(arguments.length==1){let v=arguments[0];this.isEnabled=!1,this.frontFace=null,this.backFace=null,this.isEnabled=!0,this.frontFace=v,this.backFace=v}else if(arguments.length==2){let v=arguments[0],R=arguments[1];this.isEnabled=!1,this.frontFace=null,this.backFace=null,this.isEnabled=!0,this.frontFace=v,this.backFace=R}}equals(v){return this==v||this.isEnabled==v.isEnabled&&this.frontFace.equals(v.frontFace)&&this.backFace.equals(v.backFace)}};hn.NONE=new hn;let u=hn;xe.StencilState=hn;class h{constructor(v,R){this.canvasSize=v,this.webGLDidAdjustCanvasSize=R}}xe.ComputedCanvasSize=h;let f;(R=>(R[R.FLOAT=0]="FLOAT",R[R.BYTE=1]="BYTE"))(f=xe.AttributeType||(xe.AttributeType={}));class _{constructor(v,R,z,Z){this.name=v,this.type=R,this.count=z,this.byteOffset=Z}}xe.Attribute=_;let Xt=class Xt{attributes(){return this._attributes}stride(){return this._stride}add(v,R,z){return this._attributes.push(new _(v,R,z,this._stride)),this._stride=this._stride+z*t(R),this}constructor(){this._attributes=[],this._stride=0}};Xt.POSITION_F2=new Xt().add(am,0,2),Xt.POSITION_F2_COORD_F3=new Xt().add(am,0,2).add(uS,0,3),Xt.POSITION_F4_COORD_F4=new Xt().add(uu,0,4).add(_m,0,4),Xt.POSITION_F4_COORD_B4=new Xt().add(uu,0,4).add(_m,1,4),Xt.POSITION_F4=new Xt().add(uu,0,4);let m=Xt;xe.VertexFormat=Xt;let A;(R=>(R[R.RGBA_32=0]="RGBA_32",R[R.DEPTH_24_STENCIL_8=1]="DEPTH_24_STENCIL_8"))(A=xe.PixelFormat||(xe.PixelFormat={}));let y;(R=>(R[R.NEAREST=0]="NEAREST",R[R.LINEAR=1]="LINEAR"))(y=xe.PixelFilter||(xe.PixelFilter={}));let S;(R=>(R[R.REPEAT=0]="REPEAT",R[R.CLAMP=1]="CLAMP"))(S=xe.PixelWrap||(xe.PixelWrap={}));let Me=class Me{constructor(v,R,z,Z){this.pixelFormat=v,this.minFilter=R,this.magFilter=z,this.wrap=Z}};Me.RGBA_LINEAR_CLAMP=new Me(0,1,1,1),Me.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP=new Me(0,1,0,1),Me.RGBA_NEAREST_CLAMP=new Me(0,0,0,1),Me.RGBA_NEAREST_REPEAT=new Me(0,0,0,0),Me.STENCIL=new Me(1,0,0,1);let g=Me;xe.TextureFormat=Me;class b{constructor(v,R){this.texture=null,this.uvSpaceRect=null,this.texture=v,this.uvSpaceRect=R}}xe.TextureRegion=b;let T;(Z=>{function nt(ae){return ae.length==0}Z.isEmpty=nt;function v(ae,pe){return ae[pe]}Z.get=v;function R(ae){return ce.List_last(ae)}Z.last=R;function z(ae){return ae.length}Z.count=z})(T=xe.FrozenScissors||(xe.FrozenScissors={}));class I{totalVRAM(){return this._chunks.length*O.BYTE_COUNT}allocate(v,R){if(R.length==0)return null;R.length<=O.BYTE_COUNT;let z=v.stride();for(let ae of this._chunks){let pe=ae.tryToAllocate(z,R);if(pe!=null)return pe}let Z=new O(this,this._context.createVertexBuffer(O.BYTE_COUNT));return this._chunks.push(Z),Z.tryToAllocate(z,R)}constructor(v){this._context=v,this._chunks=[]}}xe.BufferPool=I;let st=class st{tryToAllocate(v,R){let z=R.length,Z=this.areas,ae=null;if(this.bytesUsed+z<=st.BYTE_COUNT){for(;Z.length!=0&&ce.List_last(Z).wasFreed();)ce.List_removeLast(Z);ae=this.allocateAtEnd(v,R),ae==null&&(this.runCompactingGC(),ae=this.allocateAtEnd(v,R)),ae!=null&&(this.buffer.upload2(R,ae.byteOffset()),this.bytesUsed=this.bytesUsed+z,Z.push(ae))}return ae}allocateAtEnd(v,R){let z=this.areas.length==0?0:st._alignToNextMultiple(ce.List_last(this.areas).byteOffset()+ce.List_last(this.areas).byteCount(),v);return z+R.length<=st.BYTE_COUNT?new w(this,R.length,v,z,R):null}runCompactingGC(){let v=0;ce.List_removeIf(this.areas,R=>R.wasFreed()?!0:(v=st._alignToNextMultiple(v,R.stride()),R.byteOffset()!=v&&(this.buffer.move(R.byteOffset(),v,R.byteCount()),R.wasMovedTo(v)),v=v+R.byteCount(),!1)),xe.DISABLE_BUFFER_ASSERT||this.areas.forEach(R=>{R.assertBytesAreAsExpected()})}static _alignToNextMultiple(v,R){return v+At.int_remainder(R-At.int_remainder(v,R),R)}constructor(v,R){this.pool=v,this.buffer=R,this.areas=[],this.bytesUsed=0}};st.BYTE_COUNT=4*1024*1024;let O=st;xe.BufferChunk=st;class w{constructor(v,R,z,Z,ae){this._chunk=null,this._byteCount=0,this._stride=0,this._byteOffset=0,this._wasFreed=!1,this._expectedArray=null,this._chunk=v,this._byteCount=R,this._stride=z,this._byteOffset=Z,this._saveBytes(ae)}_saveBytes(v){this._expectedArray=new Uint8Array(v)}assertBytesAreAsExpected(){for(let v=0,R=this._byteCount;v<R;v=v+1)this._expectedArray[v]!=this._chunk.buffer.bytes()[v+this._byteOffset]}byteCount(){return this._byteCount}stride(){return this._stride}byteOffset(){return this._byteOffset}wasFreed(){return this._wasFreed}buffer(){return this._chunk.buffer}free(){this._wasFreed||(this._wasFreed=!0,this._chunk.bytesUsed-=this.byteCount())}wasMovedTo(v){this._byteOffset=v}}xe.BufferArea=w;class P{constructor(v,R){this._rectPoints=[E.new2(),E.new2(),E.new2(),E.new2()],this._inside=[],this._material=null,this._outside=[],this._vertices=new br,this._context=null,this._pixelScale=1,this._pool=null,this._previousColor=C.TRANSPARENT,this._previousU=0,this._previousV=0,this._previousX=0,this._previousY=0,this._context=v,this._pool=R,this._material=v.createMaterial("smooth",m.POSITION_F4_COORD_B4,q_,Y_)}pixelScale(){return this._pixelScale}setTransformAndPixelScale(v,R){3!=0,vt.Material_setUniformMat32(this._material,Tn,v),this._pixelScale=R}flush(){let v=this._pool.allocate(m.POSITION_F4_COORD_B4,this._vertices.bytes());v!=null&&(Ut.Context_setPremultipliedBlendState(this._context),this._context.draw(1,this._material,v),v.free()),this._vertices.clear()}_loadPoints(v){this._rectPoints[0].setTo(v.left(),v.top()),this._rectPoints[1].setTo(v.right(),v.top()),this._rectPoints[2].setTo(v.right(),v.bottom()),this._rectPoints[3].setTo(v.left(),v.bottom())}fillRect(v,R){this._loadPoints(v),this.fillConvexPolygon(this._rectPoints,R)}strokeRect(v,R,z){this._loadPoints(v),this.strokeNonOverlappingPolyline(this._rectPoints,R,z,P.Loop.CLOSED)}fillConvexPolygon(v,R){let z=this._inside,Z=this._outside,ae=v.length;if(!(ae<3)){for(R=C.premultiplied(R);z.length<ae;)z.push(E.new2()),Z.push(E.new2());for(let pe=0,Te=ae;pe<Te;pe=pe+1){let De=v[At.int_remainder(pe+ae-1,ae)],St=v[pe],ot=v[At.int_remainder(pe+1,ae)],Ge=De.y()-St.y(),D=St.x()-De.x(),V=this._length(Ge,D),J=St.y()-ot.y(),le=ot.x()-St.x(),ue=this._length(J,le),ge=Ge/V+J/ue,fe=D/V+le/ue,Re=.5*this._pixelScale*V/(Ge*ge+D*fe),me=ge*Re,Ae=fe*Re;Z[pe].setTo(St.x()-me,St.y()-Ae),z[pe].setTo(St.x()+me,St.y()+Ae)}for(let pe=0,Te=ae-1;pe<=Te;pe=pe+1,Te=Te-1){let De=z[pe],St=z[Te];this._appendVertex(De.x(),De.y(),1,1,R),pe==0&&this._appendPreviousVertex(),pe<Te&&this._appendVertex(St.x(),St.y(),1,1,R)}this._appendPreviousVertex();for(let pe=0;pe<=ae;pe=pe+1){let Te=At.int_remainder(pe,ae),De=z[Te],St=Z[Te];this._appendVertex(St.x(),St.y(),0,0,R),pe==0&&this._appendPreviousVertex(),this._appendVertex(De.x(),De.y(),1,1,R)}this._appendPreviousVertex()}}strokeNonOverlappingPolyline(v,R,z,Z){let ae=(z+this._pixelScale)/this._pixelScale,pe=(z+this._pixelScale)/2,Te=v.length;if(Te<2)return;if(R=C.premultiplied(R),Z==P.Loop.OPEN){let ot=v[0],Ge=v[1],D=Ge.x()-ot.x(),V=Ge.y()-ot.y(),J=this._length(D,V),le=.5*this._pixelScale/J,ue=D*le,ge=V*le,fe=pe/J,Re=-V*fe,me=D*fe;this._appendVertex(ot.x()-ue-Re,ot.y()-ge-me,0,-ae,R),this._appendPreviousVertex(),this._appendVertex(ot.x()-ue+Re,ot.y()-ge+me,-ae,0,R),this._appendVertex(ot.x()+ue-Re,ot.y()+ge-me,0,ae,R),this._appendVertex(ot.x()+ue+Re,ot.y()+ge+me,ae,0,R)}let De=Z==P.Loop.CLOSED?0:1,St=Z==P.Loop.CLOSED?Te+1:Te-1;for(let ot=De,Ge=St;ot<Ge;ot=ot+1){let D=v[At.int_remainder(ot+Te-1,Te)],V=v[At.int_remainder(ot,Te)],J=v[At.int_remainder(ot+1,Te)],le=D.y()-V.y(),ue=V.x()-D.x(),ge=this._length(le,ue),fe=V.y()-J.y(),Re=J.x()-V.x(),me=this._length(fe,Re),Ae=le/ge+fe/me,qe=ue/ge+Re/me,Pe=pe*ge/(le*Ae+ue*qe),Ve=Ae*Pe,lt=qe*Pe;this._appendVertex(V.x()-Ve,V.y()-lt,0,ae,R),ot==0&&this._appendPreviousVertex(),this._appendVertex(V.x()+Ve,V.y()+lt,ae,0,R)}if(Z==P.Loop.OPEN){let ot=v[Te-2],Ge=v[Te-1],D=Ge.x()-ot.x(),V=Ge.y()-ot.y(),J=this._length(D,V),le=.5*this._pixelScale/J,ue=D*le,ge=V*le,fe=pe/J,Re=-V*fe,me=D*fe;this._appendVertex(Ge.x()-ue-Re,Ge.y()-ge-me,0,ae,R),this._appendVertex(Ge.x()-ue+Re,Ge.y()-ge+me,ae,0,R),this._appendVertex(Ge.x()+ue-Re,Ge.y()+ge-me,0,-ae,R),this._appendVertex(Ge.x()+ue+Re,Ge.y()+ge+me,-ae,0,R)}this._appendPreviousVertex()}_appendVertex(v,R,z,Z,ae){this._previousX=v,this._previousY=R,this._previousU=z,this._previousV=Z,this._previousColor=ae,this._vertices.appendFloat(v).appendFloat(R).appendFloat(z).appendFloat(Z),this._vertices.appendByte(C.red(ae)).appendByte(C.green(ae)).appendByte(C.blue(ae)).appendByte(C.alpha(ae))}_appendPreviousVertex(){this._appendVertex(this._previousX,this._previousY,this._previousU,this._previousV,this._previousColor)}_length(v,R){return Math.sqrt(v*v+R*R)}}xe.SmoothPath=P,(R=>{let nt;(ae=>(ae[ae.CLOSED=0]="CLOSED",ae[ae.OPEN=1]="OPEN"))(nt=R.Loop||(R.Loop={}));let v;(Z=>{function z(ae){return R.Loop[ae]}Z.Loop_toString=z})(v=R.in_Loop||(R.in_Loop={}))})(P=xe.SmoothPath||(xe.SmoothPath={}));let H;(R=>(R[R.WEBGL_TEXTURE=0]="WEBGL_TEXTURE",R[R.WEBGL_BUFFER=1]="WEBGL_BUFFER"))(H=xe.MemoryType||(xe.MemoryType={}));class re{increment(v,R,z){let Z=null;this._vramUsedByTypeAndPurpose.has(v)?Z=this._vramUsedByTypeAndPurpose.get(v):(Z=new Map,this._vramUsedByTypeAndPurpose.set(v,Z)),Z.has(R)||Z.set(R,0);let ae=Z.get(R)+z;Z.set(R,ae),Mn.trackInReleaseBuilds(H[v]+` (${R})`,ae/(1024*1024)|0)}decrement(v,R,z){this.increment(v,R,-z)}resetOnContextRestored(){this._vramUsedByTypeAndPurpose=new Map}constructor(){this._vramUsedByTypeAndPurpose=new Map}}xe.MemoryStats=re;let kt=class kt{stats(){return this._stats}width(){return this._cachedSize.x()|0}height(){return this._cachedSize.y()|0}maxTextureSize(){return this._cachedMaxTextureSize}_loadOESStandardDerivativesExtension(v){let R=this._gl.getExtension("OES_standard_derivatives");e(R!==null),v&&!xe._supportsWebGLExtensionOESStandardDerivatives&&Be.trackEvent1("missing_webgl_extensions",new Map([["extensions",["OES_standard_derivatives"]]]))}constructor(){this._stats=new re,this._attributeCount=0,this._currentBlendState=a.ZERO,this._currentBlendOperations=0,this._blendOperationMap=null,this._comparisonMap=null,this._contextResetHandlers=[],this._currentClearColor=C.TRANSPARENT,this._currentScissors=null,this._currentStencilState=u.NONE,this._currentFramebuffer=null,this._currentProgramInUse=null,this._currentVertexBuffer=null,this._currentVertexFormat=null,this._defaultViewport=U.new2(),this._forceStateUpdate=!0,this._generation=1,this._gl=null,this._oldBlendState=null,this._oldBlendOperations=0,this._oldScissors=null,this._oldStencilState=u.NONE,this._oldFramebuffer=null,this._oldViewport=U.new2(),this._operationMap=null,this._cachedGraphicsCardName=null,this._cachedMaxTextureSize=0,this._cachedSize=new E(0,0),this._mockMaximumDrawingBufferSize=null,this._materialsToCheckProgramCreationStatus=[],this._hasLoggedHighpPrecisionUnsupported=!1,this._shouldFlushAfterDraws=!1,this._boundWebGLFramebuffer=null,this._webGLFramebufferUsedForLastClearOrDraw=null,this._numFramebufferSwitches=0,this.hackToAvoidMissingTextureWarningInChrome=null;let v={antialias:!1,depth:!1,stencil:!1,alpha:!1,preserveDrawingBuffer:Ki,powerPreference:"high-performance"};if(this._gl=lo.HTMLCanvasElement_getContextWebGL2(jr.HTMLDocument_createElementCanvas(document),v),this._gl==null)throw console.error("WebGL initialization failed"),new Error("Could not initialize WebGL");this._loadOESStandardDerivativesExtension(!0);let R=this._gl.canvas,z=R.style;R.width=0,R.height=0,z.display="block",z.left="0",z.top="0",en.EventTarget_addEventListener2(R,"webglcontextlost",Z=>{console.warn("WebGL context was lost"),Qo.Event_preventDefault(Z)}),en.EventTarget_addEventListener1(R,"webglcontextrestored",()=>{console.warn("WebGL context was restored"),this._attributeCount=0,this._currentClearColor=C.TRANSPARENT,this._currentScissors=null,this._forceStateUpdate=!0,this._loadOESStandardDerivativesExtension(!1),this._generation=this._generation+1,this._stats.resetOnContextRestored();for(let Z of this._contextResetHandlers)Z()}),n(this._gl),this._blendOperationMap=new Map([[0,this._gl.ZERO],[1,this._gl.ONE],[2,this._gl.SRC_COLOR],[3,this._gl.DST_COLOR],[4,this._gl.ONE_MINUS_SRC_COLOR],[5,this._gl.ONE_MINUS_DST_COLOR],[6,this._gl.SRC_ALPHA],[7,this._gl.DST_ALPHA],[8,this._gl.ONE_MINUS_SRC_ALPHA],[9,this._gl.ONE_MINUS_DST_ALPHA],[10,this._gl.CONSTANT_COLOR],[11,this._gl.ONE_MINUS_CONSTANT_COLOR]]),this._comparisonMap=new Map([[0,this._gl.ALWAYS],[1,this._gl.EQUAL],[2,this._gl.GREATER],[3,this._gl.GEQUAL],[4,this._gl.LESS],[5,this._gl.LEQUAL],[6,this._gl.NEVER],[7,this._gl.NOTEQUAL]]),this._operationMap=new Map([[0,this._gl.DECR],[1,this._gl.DECR_WRAP],[2,this._gl.INCR],[3,this._gl.INCR_WRAP],[4,this._gl.INVERT],[5,this._gl.KEEP],[6,this._gl.REPLACE],[7,this._gl.ZERO]]),this._cachedMaxTextureSize=Math.min(4096,this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE))|0,yn.setMaxRes(this._cachedMaxTextureSize),this.hackToAvoidMissingTextureWarningInChrome=new j(this,g.RGBA_NEAREST_CLAMP,1,1,new yn(0,1,1,new Uint8Array(4)),null,"ChromeHack"),this._shouldFlushAfterDraws=this._detectShouldFlushAfterDraws()}gl(){return this._gl}generation(){return this._generation}addContextResetHandler(v){ce.List_appendOne(this._contextResetHandlers,v)}removeContextResetHandler(v){ce.List_removeOne(this._contextResetHandlers,v)}currentFramebuffer(){return this._currentFramebuffer}currentStencilState(){return this._currentStencilState}currentBlendState(){return this._currentBlendState}beginFrame(){this._checkMaterialProgramCreationStatuses(),this.setFramebuffer(null)}endFrame(){}flush(){this._gl.flush()}readPixels(v,R,z,Z,ae){var De;let pe=new Uint8Array(Z*ae*4),Te=(De=ie.from(v))==null?void 0:De.framebuffer();return this.bindWebGLFramebufferAndTrackForBudget(Te),this._gl.readPixels(R,z,Z,ae,this.gl().RGBA,this.gl().UNSIGNED_BYTE,pe),pe}setBlendState(v){this._currentBlendState=v,this._currentBlendOperations=kt._packBlendModes(v.sourceColor,v.targetColor,v.sourceAlpha,v.targetAlpha)}setViewport(v,R,z,Z){this._currentFramebuffer!=null?this._currentFramebuffer.setViewport(v,R,z,Z):this._defaultViewport.setTo1(v,R,z,Z)}_reportClearOrDraw(){this._boundWebGLFramebuffer!=this._webGLFramebufferUsedForLastClearOrDraw&&this._numFramebufferSwitches++,this._webGLFramebufferUsedForLastClearOrDraw=this._boundWebGLFramebuffer}draw(v,R,z){z!=null&&ic.WebGLRenderingContext_annotateBlock(this._gl,`material:${R.name()}`,()=>{this._updateFramebufferAndViewport(),B.from(R).prepare(),te.from(z.buffer()).prepare(R.format()),this._updateDeferredStates(),this._gl.drawArrays(v==0?this._gl.TRIANGLES:this._gl.TRIANGLE_STRIP,z.byteOffset()/z.stride()|0,z.byteCount()/z.stride()|0),this._forceStateUpdate=!1,this._shouldFlushAfterDraws&&this.flush(),this._reportClearOrDraw()})}_setCanvasSize(v,R){this._mockMaximumDrawingBufferSize!=null&&(v=Math.min(this._mockMaximumDrawingBufferSize.value,v)|0,R=Math.min(this._mockMaximumDrawingBufferSize.value,R)|0);let z=v/mr(),Z=R/mr(),ae=this._gl.canvas;ae.width=v,ae.height=R,ae.style.width=`${z}px`,ae.style.height=`${Z}px`;let pe=this._gl.drawingBufferWidth,Te=this._gl.drawingBufferHeight,De=pe!=v||Te!=R;return De&&(z=pe/mr(),Z=Te/mr(),ae.width=pe,ae.height=Te,ae.style.width=`${z}px`,ae.style.height=`${Z}px`),new h(new E(pe,Te),De)}resize(v,R){let z=!1;if((this._cachedSize.x()|0)!=v||(this._cachedSize.y()|0)!=R){let Z=this._setCanvasSize(v,R);this._cachedSize=Z.canvasSize,z=Z.webGLDidAdjustCanvasSize,this.setViewport(0,0,this._cachedSize.x()|0,this._cachedSize.y()|0)}return new h(this._cachedSize,z)}_detectShouldFlushAfterDraws(){return!!(["Adreno (TM) 725","Adreno (TM) 730","Adreno (TM) 740"].indexOf(this.graphicsCardName())!=-1||X.shouldFlushAfterDraws())}_shouldFlushAfterClear(){return!!(sa.hasDrawClearReorderingBug()||["Mesa Intel(R) Graphics (ADL GT2)","Mesa Intel(R) Xe Graphics (TGL GT2)"].indexOf(this.graphicsCardName())!=-1||X.shouldFlushAfterClear())}clear2(v,R){var z,Z;this._updateFramebufferAndViewport(),this._updateDeferredStates(),R!=this._currentClearColor&&(this._gl.clearColor(C.redF(R),C.greenF(R),C.blueF(R),C.alphaF(R)),this._currentClearColor=R),this._gl.clear((v!=2?this._gl.COLOR_BUFFER_BIT:0)|(v!=1?this._gl.DEPTH_BUFFER_BIT|this._gl.STENCIL_BUFFER_BIT:0)),this._shouldFlushAfterClear()&&this._gl.flush(),this._currentFramebuffer!=null&&((v==0||v==1)&&((z=this._currentFramebuffer.colorTexture())==null||z.markContentHasBeenInitialized()),(v==0||v==2)&&((Z=this._currentFramebuffer.depthStencilTexture())==null||Z.markContentHasBeenInitialized())),this._reportClearOrDraw()}setStencilState(v){this._currentStencilState=v}setFramebuffer(v){var R;this._currentFramebuffer=ie.from(v),(R=this._currentFramebuffer)==null||R.updateScissor()}setScissor(v){v==null?this._currentScissors=null:(this._currentScissors==null&&(this._currentScissors=U.new2()),this._currentScissors.copyFrom(v))}useProgram(v){(this._forceStateUpdate||this._currentProgramInUse!=v)&&(this._gl.useProgram(v),this._currentProgramInUse=v)}bindVertexBufferWithFormat(v,R){if((this._forceStateUpdate||this._currentVertexBuffer!=v)&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,v),this._currentVertexBuffer=v,this._currentVertexFormat=null),this._currentVertexFormat!=R){let z=this._gl,Z=R.attributes(),ae=Z.length;for(let pe=0,Te=ae;pe<Te;pe=pe+1){let De=Z[pe],St=De.type==1;z.vertexAttribPointer(pe,De.count,St?z.UNSIGNED_BYTE:z.FLOAT,St,R.stride(),De.byteOffset)}for(;this._attributeCount<ae;)z.enableVertexAttribArray(this._attributeCount),this._attributeCount=this._attributeCount+1;for(;this._attributeCount>ae;)this._attributeCount=this._attributeCount-1,z.disableVertexAttribArray(this._attributeCount);this._attributeCount=ae,this._currentVertexFormat=R}}isContextLost(){return this._gl.isContextLost()}graphicsCardName(){if(this._cachedGraphicsCardName!=null)return this._cachedGraphicsCardName;let v=this._gl.getExtension("WEBGL_debug_renderer_info");return v===null?this._cachedGraphicsCardName="Unknown":this._cachedGraphicsCardName=this._gl.getParameter(v.UNMASKED_RENDERER_WEBGL),this._cachedGraphicsCardName}setMaximumDrawingBufferSizeForTesting(v){this._mockMaximumDrawingBufferSize=new Se(v)}clearMaximumDrawingBufferSizeForTesting(){this._mockMaximumDrawingBufferSize=null}createMaterial(v,R,z,Z){return new B(this,v,R,z,Z)}createVertexBuffer(v){return new te(this,v)}createTexture2(v,R,z,Z,ae){return new j(this,v,R,z,new yn(0,R,z,Z),null,ae)}createTexture3(v,R,z){return new j(this,v,R.videoWidth,R.videoHeight,null,R,z)}createFramebuffer(v,R,z){return new ie(this,j.from(v),j.from(R),z)}annotate(v,R){R()}annotateAndReturn(v,R){return R()}addMaterialToCheckProgramCreationStatusAsync(v){this._materialsToCheckProgramCreationStatus.push(v)}_checkMaterialProgramCreationStatuses(){if(this._materialsToCheckProgramCreationStatus.length!=0){for(let v of this._materialsToCheckProgramCreationStatus)v.haveCheckedProgramCreationStatus()||v.checkProgramCreationStatus();this._materialsToCheckProgramCreationStatus.length=0}}annotateProfile(v,R){R()}takeSpectorSnapshot(){de.takeSnapshot(this.gl().canvas)}_updateFramebufferAndViewport(){let v=this._currentFramebuffer,R=v!=null?v.viewport():this._defaultViewport,z=this._gl;if(this._forceStateUpdate||this._oldFramebuffer!=v){let Z=v==null?void 0:v.framebuffer();this.bindWebGLFramebufferAndTrackForBudget(Z),this._oldFramebuffer=v,sa.hasViewportBug()&&this._oldViewport.equals(R)&&(this._oldViewport.setX(R.x()+1),z.viewport(this._oldViewport.x()|0,this._oldViewport.y()|0,this._oldViewport.width()|0,this._oldViewport.height()|0),z.clear(0))}(this._forceStateUpdate||!this._oldViewport.equals(R))&&(z.viewport(R.x()|0,R.y()|0,R.width()|0,R.height()|0),this._oldViewport.copyFrom(R))}_updateDeferredStates(){this._updateBlendState(),this._updateStencilState(),this._updateScissorState()}_updateBlendState(){if(this._forceStateUpdate||this._oldBlendOperations!=this._currentBlendOperations||this._oldBlendState.constant!=this._currentBlendState.constant){let v=this._gl,R=this._currentBlendOperations,z=this._oldBlendOperations,Z=R&255,ae=R>>8&255,pe=R>>16&255,Te=R>>24,De=this._currentBlendState.constant;R==kt.KEEP_BLEND_OPERATIONS?v.colorMask(!1,!1,!1,!1):((this._forceStateUpdate||z==kt.KEEP_BLEND_OPERATIONS)&&v.colorMask(!0,!0,!0,!0),R==kt.COPY_BLEND_OPERATIONS?v.disable(v.BLEND):((this._forceStateUpdate||z==kt.COPY_BLEND_OPERATIONS||z==kt.KEEP_BLEND_OPERATIONS)&&v.enable(v.BLEND),v.blendFuncSeparate(this._blendOperationMap.get(Z),this._blendOperationMap.get(ae),this._blendOperationMap.get(pe),this._blendOperationMap.get(Te)),v.blendColor(De,De,De,De))),this._oldBlendState=this._currentBlendState,this._oldBlendOperations=R}}_updateStencilState(){let v=this._gl,R=this._oldStencilState,z=this._currentStencilState,Z=z.frontFace,ae=z.backFace,pe=Z==ae?v.FRONT_AND_BACK:v.FRONT;(this._forceStateUpdate||!R.equals(z))&&((this._forceStateUpdate||R.isEnabled!=z.isEnabled)&&(z.isEnabled?v.enable(v.STENCIL_TEST):v.disable(v.STENCIL_TEST)),v.stencilFuncSeparate(pe,this._comparisonMap.get(Z.comparison),Z.reference,Z.readMask),v.stencilOpSeparate(pe,this._operationMap.get(Z.stencilFail),this._operationMap.get(Z.stencilPassDepthFail),this._operationMap.get(Z.stencilPassDepthPass)),v.stencilMaskSeparate(pe,Z.writeMask),Z!=ae&&(v.stencilFuncSeparate(v.BACK,this._comparisonMap.get(ae.comparison),ae.reference,ae.readMask),v.stencilOpSeparate(v.BACK,this._operationMap.get(ae.stencilFail),this._operationMap.get(ae.stencilPassDepthFail),this._operationMap.get(ae.stencilPassDepthPass)),v.stencilMaskSeparate(v.BACK,ae.writeMask)),this._oldStencilState=z)}_updateScissorState(){this._currentScissors==null?(this._oldScissors!=null&&this._gl.disable(this._gl.SCISSOR_TEST),this._oldScissors=null):(this._oldScissors==null&&this._gl.enable(this._gl.SCISSOR_TEST),(this._oldScissors==null||!this._currentScissors.equals(this._oldScissors))&&(this._gl.scissor(this._currentScissors.x()|0,this._currentScissors.y()|0,Math.max(this._currentScissors.width(),0)|0,Math.max(this._currentScissors.height(),0)|0),this._oldScissors==null&&(this._oldScissors=U.new2()),this._oldScissors.copyFrom(this._currentScissors)))}hasLoggedHighpPrecisionUnsupported(){return this._hasLoggedHighpPrecisionUnsupported}setHasLoggedHighpPrecisionUnsupported(){this._hasLoggedHighpPrecisionUnsupported=!0}static from(v){return v}static _packBlendModes(v,R,z,Z){return v|R<<8|z<<16|Z<<24}getNumFramebufferSwitches(){return this._numFramebufferSwitches}resetNumFramebufferSwitches(){this._numFramebufferSwitches=0}bindWebGLFramebufferAndTrackForBudget(v){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,v),this._boundWebGLFramebuffer=v}};kt.COPY_BLEND_OPERATIONS=kt._packBlendModes(1,0,1,0),kt.KEEP_BLEND_OPERATIONS=kt._packBlendModes(0,1,0,1);let q=kt;xe.HTMLContext=kt;class W{location(){let v=q.from(this._material.context());if(this._generation!=v.generation()&&(this._location=v.gl().getUniformLocation(this._material.program(),this._name),this._generation=v.generation(),!1)){for(let Z=0,ae=z.getProgramParameter(R,z.ACTIVE_UNIFORMS);Z<ae;Z=Z+1)if(pe.name==this._name)switch(pe.type){case z.FLOAT:case z.FLOAT_MAT3:case z.FLOAT_VEC2:case z.FLOAT_VEC3:case z.FLOAT_VEC4:case z.INT:case z.BOOL:case z.SAMPLER_2D:default:}}return this._location}constructor(v,R){this._material=v,this._name=R,this._generation=0,this._location=null,this._isDirty=!0}}xe.HTMLUniform=W;class x extends W{constructor(R,z){super(R,z);this._x=0}set(R){R!=this._x&&(this._x=R,this._isDirty=!0)}prepare(){let R=q.from(this._material.context());(this._generation!=R.generation()||this._isDirty)&&(R.gl().uniform1f(this.location(),this._x),this._isDirty=!1)}}xe.HTMLUniformFloat=x;class F extends W{constructor(R,z){super(R,z);this._x=0}set(R){R!=this._x&&(this._x=R,this._isDirty=!0)}prepare(){let R=q.from(this._material.context());(this._generation!=R.generation()||this._isDirty)&&(R.gl().uniform1i(this.location(),this._x),this._isDirty=!1)}}xe.HTMLUniformInt=F;class k extends W{constructor(R,z){super(R,z);this._x=0,this._y=0}set(R,z){(R!=this._x||z!=this._y)&&(this._x=R,this._y=z,this._isDirty=!0)}prepare(){let R=q.from(this._material.context());(this._generation!=R.generation()||this._isDirty)&&(R.gl().uniform2f(this.location(),this._x,this._y),this._isDirty=!1)}}xe.HTMLUniformVec2=k;class G extends W{constructor(R,z){super(R,z);this._x=0,this._y=0,this._z=0}set(R,z,Z){(R!=this._x||z!=this._y||Z!=this._z)&&(this._x=R,this._y=z,this._z=Z,this._isDirty=!0)}prepare(){let R=q.from(this._material.context());(this._generation!=R.generation()||this._isDirty)&&(R.gl().uniform3f(this.location(),this._x,this._y,this._z),this._isDirty=!1)}}xe.HTMLUniformVec3=G;class M extends W{constructor(R,z){super(R,z);this._x=0,this._y=0,this._z=0,this._w=0}set(R,z,Z,ae){(R!=this._x||z!=this._y||Z!=this._z||ae!=this._w)&&(this._x=R,this._y=z,this._z=Z,this._w=ae,this._isDirty=!0)}prepare(){let R=q.from(this._material.context());(this._generation!=R.generation()||this._isDirty)&&(R.gl().uniform4f(this.location(),this._x,this._y,this._z,this._w),this._isDirty=!1)}}xe.HTMLUniformVec4=M;let Ne=class Ne extends W{constructor(R,z){super(R,z);this._values=[1,0,0,0,1,0,0,0,1]}set(R,z,Z,ae,pe,Te,De,St,ot){Ne._cachedValues[0]=R,Ne._cachedValues[1]=ae,Ne._cachedValues[2]=De,Ne._cachedValues[3]=z,Ne._cachedValues[4]=pe,Ne._cachedValues[5]=St,Ne._cachedValues[6]=Z,Ne._cachedValues[7]=Te,Ne._cachedValues[8]=ot;for(let Ge=0;Ge<9;Ge=Ge+1)if(Ne._cachedValues[Ge]!=this._values[Ge]){let D=this._values;this._values=Ne._cachedValues,Ne._cachedValues=D,this._isDirty=!0;break}}prepare(){let R=q.from(this._material.context());(this._generation!=R.generation()||this._isDirty)&&(R.gl().uniformMatrix3fv(this.location(),!1,this._values),this._isDirty=!1)}};Ne._cachedValues=[1,0,0,0,1,0,0,0,1];let Q=Ne;xe.HTMLUniformMat3=Ne;class Y extends W{constructor(R,z){super(R,z);this._texture=null,this._index=-1}set(R,z){(this._texture!=R||this._index!=z)&&(this._texture=j.from(R),this._index=z,this._isDirty=!0)}prepare(){let R=q.from(this._material.context()),z=this._texture,Z=R.gl();z==null&&(z=R.hackToAvoidMissingTextureWarningInChrome),(this._generation!=R.generation()||this._isDirty)&&(Z.uniform1i(this.location(),this._index),this._isDirty=!1),Z.activeTexture(ic.WebGLRenderingContext_TEXTURE_N(Z,this._index)),Z.bindTexture(Z.TEXTURE_2D,z.texture())}}xe.HTMLUniformSampler=Y;class B{constructor(v,R,z,Z,ae){this._context=null,this._name=null,this._format=null,this._vertexSource=null,this._fragmentSource=null,this._uniformsMap=new Map,this._uniformsList=[],this._generation=0,this._program=null,this._haveCheckedProgramCreationStatus=!1,this._context=v,this._name=R,this._format=z,this._vertexSource=Z,this._fragmentSource=ae,this._createProgram(),this._context.addMaterialToCheckProgramCreationStatusAsync(this)}context(){return this._context}name(){return this._name}format(){return this._format}setUniformFloat(v,R){let z=Le.StringMap_get(this._uniformsMap,v,null);z==null&&(z=new x(this,v),this._uniformsMap.set(v,z),this._uniformsList.push(z)),z.set(R)}setUniformInt(v,R){let z=Le.StringMap_get(this._uniformsMap,v,null);z==null&&(z=new F(this,v),this._uniformsMap.set(v,z),this._uniformsList.push(z)),z.set(R)}setUniformVec21(v,R,z){let Z=Le.StringMap_get(this._uniformsMap,v,null);Z==null&&(Z=new k(this,v),this._uniformsMap.set(v,Z),this._uniformsList.push(Z)),Z.set(R,z)}setUniformVec3(v,R,z,Z){let ae=Le.StringMap_get(this._uniformsMap,v,null);ae==null&&(ae=new G(this,v),this._uniformsMap.set(v,ae),this._uniformsList.push(ae)),ae.set(R,z,Z)}setUniformVec41(v,R,z,Z,ae){let pe=Le.StringMap_get(this._uniformsMap,v,null);pe==null&&(pe=new M(this,v),this._uniformsMap.set(v,pe),this._uniformsList.push(pe)),pe.set(R,z,Z,ae)}setUniformMat31(v,R,z,Z,ae,pe,Te,De,St,ot){let Ge=Le.StringMap_get(this._uniformsMap,v,null);Ge==null&&(Ge=new Q(this,v),this._uniformsMap.set(v,Ge),this._uniformsList.push(Ge)),Ge.set(R,z,Z,ae,pe,Te,De,St,ot)}setUniformSampler(v,R,z){let Z=Le.StringMap_get(this._uniformsMap,v,null);Z==null&&(Z=new Y(this,v),this._uniformsMap.set(v,Z),this._uniformsList.push(Z)),Z.set(R,z)}program(){return this._generation!=this._context.generation()&&(this._createProgram(),this.checkProgramCreationStatus()),this._program}prepare(){this._context.useProgram(this.program());for(let v of this._uniformsList)v.prepare()}haveCheckedProgramCreationStatus(){return this._haveCheckedProgramCreationStatus}checkProgramCreationStatus(){if(this._generation!=this._context.generation())return;let v=this._context.gl();if((()=>{if(v.getProgramParameter(this._program,v.LINK_STATUS))return;let z=pe=>pe.replace(new RegExp("\\bhighp\\b","g"),"mediump"),Z=v.getAttachedShaders(this._program),ae=!1;for(let pe of Z){if(v.getShaderParameter(pe,v.COMPILE_STATUS))continue;ae=!0;let Te=v.getShaderParameter(pe,v.SHADER_TYPE);if(Te===v.VERTEX_SHADER)this._vertexSource=z(this._vertexSource);else if(Te===v.FRAGMENT_SHADER)this._fragmentSource=z(this._fragmentSource);else{if(v.isContextLost())return;throw new Error(`Unexpected shader type: ${Te}`)}}if(!ae){if(v.isContextLost())return;throw new Error(`Failed to link shader ${this.name()}: ${v.getProgramInfoLog(this._program)}`)}if(this._createProgram(),v.getProgramParameter(this._program,v.LINK_STATUS)){this.context().hasLoggedHighpPrecisionUnsupported()||(Be.trackEvent1("highp_unsupported_device",new Map),this.context().setHasLoggedHighpPrecisionUnsupported());return}Z=v.getAttachedShaders(this._program);for(let pe of Z)if(!v.getShaderParameter(pe,v.COMPILE_STATUS)){if(v.isContextLost())return;{let Te=v.getShaderInfoLog(pe);throw new Error(Te)}}if(!v.isContextLost())throw new Error(`Failed to link shader ${this.name()}: ${v.getProgramInfoLog(this._program)}`)})(),!1){for(let z of this.format().attributes())for(let Z=0,ae=v.getProgramParameter(this._program,v.ACTIVE_ATTRIBUTES);Z<ae;Z=Z+1)if(pe.name==z.name)switch(z.count){case 1:case 2:case 3:case 4:default:}}this._haveCheckedProgramCreationStatus=!0}_createProgram(){let v=this._context.gl();this._program=v.createProgram(),de.addDebugMetadataToWebGLObject(this._program,{name:this._name}),this._compileShader(v,v.VERTEX_SHADER,this._vertexSource),this._compileShader(v,v.FRAGMENT_SHADER,this._fragmentSource);let R=this.format().attributes();for(let z=0,Z=R.length;z<Z;z=z+1)v.bindAttribLocation(this._program,z,R[z].name);v.linkProgram(this._program),this._generation=this._context.generation(),this._haveCheckedProgramCreationStatus=!1}_compileShader(v,R,z){let Z=v.createShader(R);v.shaderSource(Z,z),v.compileShader(Z),v.attachShader(this._program,Z)}static from(v){return v}}xe.HTMLMaterial=B;let We=class We{constructor(v,R){this._context=null,this._generation=0,this._buffer=null,this._bytes=null,this._isDirty=!0,this._dirtyMin=We.INT_MAX,this._dirtyMax=0,this._totalMin=We.INT_MAX,this._totalMax=0,this._byteCount=0,this._glByteCount=0,this._context=v,this._byteCount=R,this._bytes=new Uint8Array(R)}context(){return this._context}bytes(){return this._bytes}byteCount(){return this._byteCount}move(v,R,z){v!=R&&z!=0&&(this._bytes.set(this._bytes.subarray(v,v+z),R),this._growDirtyRegion(Math.min(v,R),Math.max(v,R)+z))}upload2(v,R){this._bytes.set(v,R),this._growDirtyRegion(R,R+v.length)}prepare(v){let R=this._context.gl();if(this._generation!=this._context.generation()&&(this._buffer=R.createBuffer(),de.addDebugMetadataToWebGLObject(this._buffer,{purpose:"Vertex Buffer"}),this._generation=this._context.generation(),this._isDirty=!0),this._context.bindVertexBufferWithFormat(this._buffer,v),this._isDirty){let z=this._glByteCount;R.bufferData(R.ARRAY_BUFFER,this._byteCount,R.DYNAMIC_DRAW),this._glByteCount=this.byteCount(),this._context.stats().increment(1,"all",this._glByteCount-z),this._dirtyMin=this._totalMin,this._dirtyMax=this._totalMax,this._isDirty=!1}this._dirtyMin<this._dirtyMax&&(R.bufferSubData(R.ARRAY_BUFFER,this._dirtyMin,this._bytes.subarray(this._dirtyMin,this._dirtyMax)),this._dirtyMin=We.INT_MAX,this._dirtyMax=0)}_growDirtyRegion(v,R){this._dirtyMin=Math.min(this._dirtyMin,v),this._dirtyMax=Math.max(this._dirtyMax,R),this._totalMin=Math.min(this._totalMin,v),this._totalMax=Math.max(this._totalMax,R)}static from(v){return v}};We.INT_MAX=2147483647;let te=We;xe.HTMLVertexBuffer=We;class j{context(){return this._context}format(){return this._format}width(){return this._width}height(){return this._height}hasContentBeenInitialized(){return this.isRenderbuffer()?this.renderbuffer():this.texture(),this._hasContentBeenInitialized}markContentHasBeenInitialized(){this._hasContentBeenInitialized=!0}setShouldUnloadImageBuffer(v){this._shouldUnloadImageBuffer=v}_currentGlTextureSizeInBytes(){let v=this._glTextureWidth*this._glTextureHeight*sn.PixelFormat_byteCount(this._format.pixelFormat);return this._useMipmap&&(v+=v*.33),v|0}deleteTexture(){this._texture!=null&&(this._context.gl().deleteTexture(this._texture),this._context.stats().decrement(0,this._purpose,this._currentGlTextureSizeInBytes()))}resize1(v,R,z,Z){this._width=v,this._height=R,this._pixels=z,this._useMipmap=Z,this._isContentDirty=!0}_needsUploadToGPUTexture(){return this._isContentDirty||this._video!=null}setFormat(v){this._format!=v&&(this._format=v,this._isFormatDirty=!0)}isRenderbuffer(){return this._format.pixelFormat==1}invalidateVideoFrame(){this._isVideoFrameDirty=!0}texture(){let v=this._context.gl();if(this._generation!=this._context.generation()&&(this._texture=v.createTexture(),de.addDebugMetadataToWebGLObject(this._texture,{purpose:this._purpose}),this._generation=this._context.generation(),this._isFormatDirty=!0,this._isContentDirty=!0,this._hasContentBeenInitialized=!1),this._isFormatDirty&&(v.bindTexture(v.TEXTURE_2D,this._texture),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,this.format().magFilter==0?v.NEAREST:v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.format().minFilter==0?v.NEAREST:v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,this.format().wrap==0?v.REPEAT:v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,this.format().wrap==0?v.REPEAT:v.CLAMP_TO_EDGE),this._isFormatDirty=!1),this._needsUploadToGPUTexture()){let R=this._currentGlTextureSizeInBytes();if(v.bindTexture(v.TEXTURE_2D,this._texture),this._video!=null)this._isVideoFrameDirty&&(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,this._video),this._isVideoFrameDirty=!1,this._hasContentBeenInitialized=!0);else{let Z=this._pixels.pixels;Z.img!=null?(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,Z.img),this._hasContentBeenInitialized=!0):Z.canvas!=null?(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,Z.canvas),this._hasContentBeenInitialized=!0):(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,this._width,this._height,0,v.RGBA,v.UNSIGNED_BYTE,Z.array),this._hasContentBeenInitialized=Z.array!=null),this._shouldUnloadImageBuffer&&(this._pixels=null)}this._glTextureWidth=this._width,this._glTextureHeight=this._height,this._useMipmap&&(v.generateMipmap(v.TEXTURE_2D),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR_MIPMAP_LINEAR));let z=this._currentGlTextureSizeInBytes();this._context.stats().increment(0,this._purpose,z-R),this._isContentDirty=!1}return this._texture}renderbuffer(){let v=this._context.gl();return this._generation!=this._context.generation()&&(this._renderbuffer=v.createRenderbuffer(),de.addDebugMetadataToWebGLObject(this._renderbuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isContentDirty=!0,this._hasContentBeenInitialized=!1),this._isContentDirty&&(v.bindRenderbuffer(v.RENDERBUFFER,this._renderbuffer),v.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_STENCIL,this._width,this._height),this._isContentDirty=!1,this._hasContentBeenInitialized=!1),this._renderbuffer}static from(v){return v}constructor(v,R,z,Z,ae,pe,Te){this._context=v,this._format=R,this._width=z,this._height=Z,this._pixels=ae,this._video=pe,this._purpose=Te,this._shouldUnloadImageBuffer=!1,this._useMipmap=!1,this._renderbuffer=null,this._texture=null,this._generation=0,this._isFormatDirty=!0,this._isContentDirty=!0,this._isVideoFrameDirty=!0,this._hasContentBeenInitialized=!1,this._glTextureWidth=0,this._glTextureHeight=0}}xe.HTMLTexture=j;class ie{context(){return this._context}colorTexture(){return this._colorTexture}depthStencilTexture(){return this._depthStencilTexture}setColorTexture(v){this._colorTexture!=v&&(this._colorTexture=j.from(v),this._isDirty=!0)}resize(v,R){this._colorTexture!=null&&(v!=this._colorTexture.width()||R!=this._colorTexture.height())&&(this._colorTexture.resize1(v,R,null,!1),this._isDirty=!0),this._depthStencilTexture!=null&&(v!=this._depthStencilTexture.width()||R!=this._depthStencilTexture.height())&&(this._depthStencilTexture.resize1(v,R,null,!1),this._isDirty=!0)}viewport(){return this._viewport}setViewport(v,R,z,Z){this._viewport.setTo1(v,R,z,Z)}pushScissor1(v,R,z,Z){let ae=new U(v,R,z,Z);this.pushScissor2(ae)}pushScissor2(v){this._scissorStack.length!=0&&v.intersectWith(ce.List_last(this._scissorStack)),this._scissorStack.push(v),this.updateScissor()}popScissor(){ce.List_removeLast(this._scissorStack),this.updateScissor()}takeScissor(){let v=this._scissorStack.pop();return this.updateScissor(),v}takeAllScissors(){let v=this._scissorStack;return this._scissorStack=[],this.updateScissor(),v}replaceAllScissors(v){this._scissorStack=v,this.updateScissor()}scissors(){return this._scissorStack}clearScissors(){this._scissorStack.length=0}updateScissor(){this._context.setScissor(this._scissorStack.length==0?null:ce.List_last(this._scissorStack))}setDepthStencil(v){this._depthStencilTexture!=v&&(this._depthStencilTexture=j.from(v),this._isDirty=!0)}framebuffer(){let v=this._context.gl();return this._generation!=this._context.generation()&&(this._framebuffer=v.createFramebuffer(),de.addDebugMetadataToWebGLObject(this._framebuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isDirty=!0),this._isDirty&&(this._context.bindWebGLFramebufferAndTrackForBudget(this._framebuffer),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,this._colorTexture.texture(),0),this._depthStencilTexture!=null&&v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_STENCIL_ATTACHMENT,v.RENDERBUFFER,this._depthStencilTexture.renderbuffer()),this._isDirty=!1),this._framebuffer}deleteTexture(){var v,R;(v=this._colorTexture)==null||v.deleteTexture(),(R=this._depthStencilTexture)==null||R.deleteTexture(),this._context.gl().deleteFramebuffer(this._framebuffer)}static from(v){return v}constructor(v,R,z,Z){this._context=v,this._colorTexture=R,this._depthStencilTexture=z,this._purpose=Z,this._scissorStack=[],this._framebuffer=null,this._generation=0,this._isDirty=!0,this._viewport=U.new2()}}xe.HTMLFramebuffer=ie;let de;(De=>{function nt(St){if(!window.spector){console.error("Can't take a Spector.js snapshot because Spector isn't loaded. Go here to install the Chrome extension: https://chrome.google.com/webstore/detail/spectorjs/denbgaamihkadbghdceggmchnflmhpmk?hl=en");return}window.spector.captureNextFrame(St)}De.takeSnapshot=nt;function v(St,ot){}De.addDebugMetadataToWebGLObject=v;function R(St,ot){ot()}De.annotate=R;function z(St,ot){return ot()}De.annotateAndReturn=z;function Z(St){De._scopeStack.push(St),pe()}De._beginScope=Z;function ae(St){De._scopeStack.pop(),pe()}De._endScope=ae;function pe(){if(De._scopeStack.length==0)window.spector.clearMarker();else{let St=De._scopeStack.join(" > ");window.spector.setMarker(St)}}De._updateMarker=pe,De._scopeStack=[]})(de=xe.Spector||(xe.Spector={}));let tt;(v=>{function nt(R){return o[R]}v.BlendOperation_toString=nt})(tt=xe.in_BlendOperation||(xe.in_BlendOperation={}));let bt;(v=>{function nt(R){return s[R]}v.Clear_toString=nt})(bt=xe.in_Clear||(xe.in_Clear={}));let ht;(v=>{function nt(R){return l[R]}v.Primitive_toString=nt})(ht=xe.in_Primitive||(xe.in_Primitive={}));let Ft;(v=>{function nt(R){return d[R]}v.Comparison_toString=nt})(Ft=xe.in_Comparison||(xe.in_Comparison={}));let Gt;(v=>{function nt(R){return c[R]}v.StencilOperation_toString=nt})(Gt=xe.in_StencilOperation||(xe.in_StencilOperation={}));let Ut;(St=>{function nt(ot,Ge){ot.clear2(Ge,C.TRANSPARENT)}St.Context_clear1=nt;function v(ot,Ge,D,V,J){return ot.createTexture2(Ge,D,V,null,J)}St.Context_createTexture1=v;function R(ot){ot.setBlendState(a.COPY)}St.Context_setCopyBlendState=R;function z(ot){ot.setBlendState(a.KEEP)}St.Context_setKeepBlendState=z;function Z(ot,Ge){ot.setBlendState(a.createInterpolateBlendState(Ge))}St.Context_setInterpolateBlendState=Z;function ae(ot){ot.setBlendState(a.PREMULTIPLIED)}St.Context_setPremultipliedBlendState=ae;function pe(ot){ot.setBlendState(a.PREMULTIPLIED_SOURCE_UNDER_TARGET)}St.Context_setPremultipliedSourceUnderTargetState=pe;function Te(ot){ot.setBlendState(a.UNPREMULTIPLIED)}St.Context_setUnpremultipliedBlendState=Te;function De(ot){ot.setBlendState(a.SCREEN)}St.Context_setScreenBlendState=De})(Ut=xe.in_Context||(xe.in_Context={}));let vt;(Z=>{function nt(ae,pe,Te){ae.setUniformVec21(pe,Te.x(),Te.y())}Z.Material_setUniformVec22=nt;function v(ae,pe,Te){ae.setUniformVec41(pe,C.redF(Te),C.greenF(Te),C.blueF(Te),C.alphaF(Te))}Z.Material_setUniformVec42=v;function R(ae,pe,Te){ae.setUniformVec41(pe,Te.x(),Te.y(),Te.x()+Te.width(),Te.y()+Te.height())}Z.Material_setUniformVec43=R;function z(ae,pe,Te){ae.setUniformMat31(pe,Te.m00(),Te.m01(),Te.m02(),Te.m10(),Te.m11(),Te.m12(),0,0,1)}Z.Material_setUniformMat32=z})(vt=xe.in_Material||(xe.in_Material={}));let Vn;(v=>{function nt(R){return f[R]}v.AttributeType_toString=nt})(Vn=xe.in_AttributeType||(xe.in_AttributeType={}));let Vt;(v=>{function nt(R,z){R.upload2(z,0)}v.VertexBuffer_upload1=nt})(Vt=xe.in_VertexBuffer||(xe.in_VertexBuffer={}));let sn;(R=>{function nt(z){return 4}R.PixelFormat_byteCount=nt;function v(z){return A[z]}R.PixelFormat_toString=v})(sn=xe.in_PixelFormat||(xe.in_PixelFormat={}));let xt;(v=>{function nt(R){return y[R]}v.PixelFilter_toString=nt})(xt=xe.in_PixelFilter||(xe.in_PixelFilter={}));let mt;(v=>{function nt(R){return S[R]}v.PixelWrap_toString=nt})(mt=xe.in_PixelWrap||(xe.in_PixelWrap={}));let _t;(z=>{function nt(Z,ae,pe){Z.resize1(ae,pe,null,!1)}z.Texture_resize2=nt;function v(Z,ae,pe,Te){Z.resize1(ae,pe,Te,!1)}z.Texture_resize3=v;function R(Z){return Z.width()*Z.height()*sn.PixelFormat_byteCount(Z.format().pixelFormat)}z.Texture_totalVRAM=R})(_t=xe.in_Texture||(xe.in_Texture={}));let Ze;(v=>{function nt(R){return H[R]}v.MemoryType_toString=nt})(Ze=xe.in_MemoryType||(xe.in_MemoryType={})),xe._supportsWebGLExtensionOESStandardDerivatives=!0,xe.DISABLE_BUFFER_ASSERT=!0})(N||(N={}));var Qs=class{constructor(e,t,n){var r;this._property=0,this._activeCanvasGUID=null,this._onChange=null,this._property=t,this._activeCanvasGUID=(r=e.getActiveCanvas())==null?void 0:r.id(),this._onChange=n,e.addAppObserver(this)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){if(t==null)return;this._activeCanvasGUID=t.id();let n=e==null?void 0:e.get2(this._property),r=t.get2(this._property);n!=r&&this._onChange(r)}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){var t;e.property==this._property&&ne.equals((t=e.node)==null?void 0:t.id(),this._activeCanvasGUID)&&e.oldVal!=e.newVal&&this._onChange(e.newVal)}};var $f=$a(Xs());var Lh=class{constructor(e,t,n){this._appState=null,this._canvasView=null,this._emitter=null,this._session=null,this._userSyncing=null,this._isFirst=!1,this._appState=e,this._canvasView=t,this._emitter=$t.getEventEmitter(),this._session=n,this._userSyncing=null,this._isFirst=!0,this._session.addObserver(this),this._appState.addFrameObserver(this)}reset(){this._isFirst=!0}userInfoJSON(){if(this._userSyncing==null)return null;let e=[],t=this._userSyncing.userBySessionID(),n=this._session.sessionID();t.has(n)&&e.push(t.get(n).toJSON());for(let o of Array.from(this._userSyncing.userBySessionID().values()))o.sessionID!=n&&e.push(o.toJSON());let r=0;if(this._session.presenterSessionID()!=null&&this._session.presenterSessionID().value==n)for(let o of Array.from(this._userSyncing.userBySessionID().values()))o.sessionID!=n&&o.observedSessions.indexOf(n)!=-1&&(r=r+1);return{deviceNameFilter:this._session.role(),sessionID:n,allUsers:e,followerCount:r,observingSessionID:this._session.observingSessionID(),presenterSessionID:this._session.presenterSessionID()!=null?this._session.presenterSessionID().value:null,sessionNominatedByCurrentUser:this._session.sessionNominatedByCurrentUser()!=null?this._session.sessionNominatedByCurrentUser().value:null,sessionsNominatingCurrentUser:this._session.sessionsNominatingCurrentUser()}}performSetVariableActions(e){var o;let t=this._appState.prototypeState(),n=this._session.observedUser();if(n==null)return;e&&t.resetVariablePrototypeState();let r=(o=n.triggeredSetVariableActionData)!=null?o:[];if(t.getSetVariableActionHistoryLength()>r.length&&t.resetVariablePrototypeState(),t.getSetVariableActionHistoryLength()<r.length)for(let a=t.getSetVariableActionHistoryLength();a<r.length;a++){let s=r[a];t.performMultiplayerSetVariableAction(s)}}performVideoStateChanges(e){var o;let t=this._appState.prototypeState(),n=this._session.observedUser();if(n==null)return;e&&t.resetVideoStateChangeHistory();let r=(o=n.videoStateChangeData)!=null?o:[];for(let a=0;a<r.length;a++){let s=r[a],l=t.getVideoStateChange(a);(!l||!this._videoStateEqual(s,l))&&t.performMultiplayerVideoStateChange((l==null?void 0:l.currentTimes)||[],s)}}_videoStateEqual(e,t){return ne.fromFigGUID(e.targetNodeId)!=ne.fromFigGUID(t.targetNodeId)||e.isPlaying!=t.isPlaying||e.isPlayingSound!=t.isPlayingSound||e.actionTakenTimestamp!=t.actionTakenTimestamp?!1:(e.currentTimes.forEach((n,r)=>{if(n!=t.currentTimes[r])return!1}),!0)}setPreviewToObservedFrameOrOverlay(e){var l;let t=this._appState.prototypeState(),n=this._appState.prototypeStructure(),r=this._session.observedUser();if(r==null)return;this.applyInstanceStateSwaps(e);let o=(l=r.triggeredOverlaysData)!=null?l:[],a=r.currentFrame;if(a!=null&&!ne.equals(this._appState.baseScreenId(),a)){let d=null,c=null;o.length==0&&(d=r.lastTriggeredHotspot,c=r.lastTriggeredPrototypeInteractionID);let p=null;if(d!=null&&c!=null)p=n.findPrototypeInteractionWithId(d,c);else if(d!=null){let u=this._appState.getActiveCanvas().scene().findNode1(d),h=Wt.cleanedInteractionsForNode(this._appState,u);h.length!=0&&(p=h[0])}this._appState.prototypeState().navigateToFrameAndCloseOverlays3(a,this._appState.scene().findNode1(d),1,0,0,p,null)}let s=t.getCurrentOverlays();s.length>o.length&&(t.closeOverlayAtAndAbove(o.length,1),s=t.getCurrentOverlays());for(let d=0,c=o.length;d<c;d=d+1){let p=gt.decodeGUID(o[d].overlayGuid),u=gt.decodeGUID(o[d].swapGuid),h=gt.decodeGUID_instanceHACK(o[d].hotspotGuid),f=gt.decodeGUID(o[d].prototypeInteractionGuid),_=null;if(f!=null)_=n.findPrototypeInteractionWithId(h,f);else{let m=this._appState.prototypeStructure().findPrototypeInteractionsWithTransition(h,u);m.length!=0&&(_=m[0])}if(s.length<=d){let m=this._appState.scene().findNode1(h);if(m==null)return;t.overlayFrame(u,m,0,0,_,null),s=t.getCurrentOverlays()}if(!ne.equals(s[d].id(),p)||!ne.equals(s[d].overlayDataModelId(),u)){if(d<s.length-1&&t.closeOverlayAtAndAbove(d+1,1),!ne.equals(s[d].overlayDataModelId(),u)){t.closeOverlayAtAndAbove(d,1);let b=this._appState.scene().findNode1(h);t.overlayFrame(u,b,0,0,_,null)}let m=this._appState.scene().findNode1(s[d].id()),A=r.lastTriggeredHotspot,y=this._appState.scene().findNode1(A);y=m!=null&&m.isAncestorOf(y)?y:null;let S=r.lastTriggeredPrototypeInteractionID,g=null;y!=null&&S!=null?g=n.findPrototypeInteractionWithId(y.id(),S):y!=null&&n.nodeTransitionTracker().cleanedUpInteractionMap()._in(y.id())&&(g=n.nodeTransitionTracker().cleanedUpInteractionMap().getHotspotInteractions(y.id())[0]),t.swapTopOverlay(p,y,0,g,null)}s=t.getCurrentOverlays()}t.getInitiatedChange()!=null&&!e&&t.commitStateChange()}_initiateStateSwap(e){var a;let t=this._appState.prototypeState(),n=gt.decodeGUIDPath(e.hotspotStablePath),r=(a=this._appState.scene())==null?void 0:a.findNode3(n),o=gt.decodeGUID(e.interactionID);t.swapInstanceToState2(gt.decodeGUIDPath(e.instanceStablePath),gt.decodeGUID(e.stateID),r,0,r==null?void 0:r.findPrototypeInteraction(o),1,null)}_commitStateSwap(e){let t=this._appState.prototypeState(),n=gt.decodeGUIDPath(e.instanceStablePath);t.commitChangesBelowInstanceTransitionRoot(n)}applyInstanceStateSwaps(e){let t=this._session.observedUser();if(t.instanceStateChanges!=null){for(let n of t.instanceStateChanges)n.phase=="INITIATED"&&this._initiateStateSwap(n),(n.phase=="COMMITTED"||!e)&&this._commitStateSwap(n);t.instanceStateChanges=[]}}handleConnect(e,t){this._userSyncing=new Rd,this._session.setMultiplayerUserSyncing(this._userSyncing),this._userSyncing.onChange=n=>{this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())},this._userSyncing.onMouseCursorChange=n=>{var r;n==this._session.observingSessionID()&&((r=this._canvasView)==null||r.viewport().invalidate())}}handleDisconnect(){this._userSyncing=null,this._session.setMultiplayerUserSyncing(null),this._emitter.trigger("multiplayerUserInfoChange",null)}handleJoinStart(e,t,n){e!=1&&this._emitter.trigger("joinStart",null)}handleJoinEnd(){var t;this._session.scene()!=this._appState.scene()&&this._appState.setActiveCanvas(null),this._isFirst&&(this._isFirst=!1);let e=this._appState.getActiveCanvas();e!=null&&this._emitter.trigger("prototypeDeviceChanged",e.prototypeDevice().toJSON()),(t=this._canvasView)==null||t.afterEnteredViewer()}handleNodeChanges(){this._appState.prototypeState().didApplyNodeChanges()}handlePresenterChange(){this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())}handleSceneGraphReply(e,t){}handleSceneChangedLoadingPhase(e,t){}onFrame(){this.setPreviewToObservedFrameOrOverlay(!0),this.performSetVariableActions(!1),this.performVideoStateChanges(!1)}};var Bh;(p=>{function i(u){return u}p._shortcut1=i;function e(u,h){return u|h<<p.MODIFIERS_SHIFT}p._shortcut2=e;function t(u,h,f){return u|h<<p.MODIFIERS_SHIFT|f<<p.FLAGS_SHIFT}p._shortcut3=t;function n(u){let h=new Map([[3,[e(20,4),e(20,16)]],[4,[21,29]],[1,[93,92,69,e(93,16),e(92,16),e(69,16)]],[2,[91,70,e(91,16),e(70,16)]]]);for(let f of Array.from(h.keys()))for(let _ of h.get(f)){let m=_&p.KEY_MASK,A=_>>p.MODIFIERS_SHIFT&p.MODIFIERS_MASK,y=_>>p.FLAGS_SHIFT&p.FLAGS_MASK;o.Flags_currentlyApplies(y)&&(16&A&&(A|=bs.Modifiers_currentPlatformModifier()),ml.KeyShortcutMap_set(u,m,A,f))}}p.addTo=n;let r;(_=>(_[_.__NONE=0]="__NONE",_[_.MAC=1]="MAC",_[_.NON_MAC=2]="NON_MAC"))(r=p.Flags||(p.Flags={}));let o;(_=>{function u(m){return(1&m)!=0}_.Flags_isMacOnly=u;function h(m){return(2&m)!=0}_.Flags_isNonMacOnly=h;function f(m){return(!u(m)||Xe.current()==4)&&(!h(m)||Xe.current()!=4)}_.Flags_currentlyApplies=f})(o=p.in_Flags||(p.in_Flags={})),p.KEY_MASK=255,p.MODIFIERS_MASK=255,p.MODIFIERS_SHIFT=8,p.FLAGS_MASK=255,p.FLAGS_SHIFT=16})(Bh||(Bh={}));var Qd=(t=>(t[t.INTERNAL_ON_FRAME_LOOP_ENABLED=0]="INTERNAL_ON_FRAME_LOOP_ENABLED",t[t.INTERNAL_ON_FRAME_LOOP_DISABLED=1]="INTERNAL_ON_FRAME_LOOP_DISABLED",t))(Qd||{}),ec=class{constructor(e,t,n,r){this._window=null,this._appState=null,this._canvasView=null,this._shortcuts=new Map,this._multiplayerSession=null,this._multiplayerCoupler=null,this._window=new Yu(e,t,r==1,()=>X.isInlinePreview()),this._appState=new vn,this._canvasView=new Ya(this._appState),this._canvasView.setParent(this._window.root()),this._canvasView.setup(),this._canvasView.focus(),this._registerShortcuts(),this._multiplayerSession=new ma(this._appState,()=>this._window.isActive(),n),this._multiplayerCoupler=new Lh(this._appState,this._canvasView,this._multiplayerSession),this._canvasView.setMultiplayer(this._multiplayerSession),lr.instance.setSerialization(this._appState.serialization()),lr.instance.setMultiplayer(this._multiplayerSession)}state(){return this._appState}canvasView(){return this._canvasView}window(){return this._window}multiplayerSession(){return this._multiplayerSession}multiplayerCoupler(){return this._multiplayerCoupler}_registerShortcuts(){let e=!0;rr.addUpdate(Jt.keyPress(this._window.root().events()),t=>{e&&(Bh.addTo(this._shortcuts),e=!1);let n=ml.KeyShortcutMap_get(this._shortcuts,t.asKeyEvent().key,t.modifiers(),0);n!=0&&(this._appState.triggerAction1(n),t.accept())})}unloadSceneAndResetPrototypeLib(){this._multiplayerSession.disconnect(),this._appState.setScene(null),this._multiplayerSession.setScene(null),L._prototypeLib!=null&&(console.debug("Resetting PrototypeLib..."),L.destroy())}initializePrototypeLib(e){if(this.unloadSceneAndResetPrototypeLib(),e==null)throw new Error("Can't initialize PrototypeLib with null CppModules");L.initialize(e,this._appState)}connectTo(e,t,n,r,o,a,s){if(this._appState.setActivePrototypeStartingPointNodeId(n),this._appState.prototypeState().resetPrototype(),this._multiplayerCoupler.reset(),this._appState.setRenderDots(!!a),this._canvasView.setBackgroundEnabled(!a),wt.setImagePrefixURL(`/file/${e}/image`),wt.setVideoPrefixUrl(`/api/files/${e}/videos`),Xe.isMobile(Xe.current())||Xe.current()==4&&navigator.maxTouchPoints>0||wt.forceMobileOptimizations()){let l=X.getFeatureFlags().viewerServerDownsample1024?1024:2048;wt.setImageBatchURL(`/file/${e}/image/batch?max_size=${l}`)}else wt.setImageBatchURL(`/file/${e}/image/batch`);this.initializePrototypeLib(s),this._multiplayerSession.connectTo(e,t,r,o)}},gv;(e=>{function i(t){return Qd[t]}e.InternalOnFrameLoop_toString=i})(gv||(gv={}));var Zf;(r=>{function i(o){return Array.from(o.values())}r.Set_values=i;function e(o,a){return n(o,a)}r.Set_subtract=e;function t(o){return new Set(o)}r.Set_new1=t;function n(o,a){let s=new Set(Array.from(o.values()));return o.forEach(l=>{a.has(l)&&s.delete(l)}),s}r.Set_difference=n})(Zf||(Zf={}));var Jf=(t=>(t[t.INCREMENTAL_QUERIED_BY_CLIENT=0]="INCREMENTAL_QUERIED_BY_CLIENT",t[t.FULL_DOCUMENT_UPFRONT=1]="FULL_DOCUMENT_UPFRONT",t))(Jf||{});var fv;(e=>{function i(t){return Jf[t]}e.DocumentLoadMode_toString=i})(fv||(fv={}));var _v;(d=>{function i(){return N.BufferChunk.BYTE_COUNT}d.BYTE_COUNT=i;function e(){let c=new l,p=c.add(N.VertexFormat.POSITION_F2,i()/4|0,0);p.area.byteOffset()==0;let u=c.add(N.VertexFormat.POSITION_F2,i()/4|0,1);u.area.byteOffset()==(i()/4|0);let h=c.add(N.VertexFormat.POSITION_F2,i()/4|0,2);h.area.byteOffset()==(i()/4|0)*2;let f=c.add(N.VertexFormat.POSITION_F2,i()/4|0,3);f.area.byteOffset()==(i()/4|0)*3,p.free(),h.free();let _=c.add(N.VertexFormat.POSITION_F2,i()/4|0,4);u.area.byteOffset()==0,f.area.byteOffset()==(i()/4|0),_.area.byteOffset()==(i()/4|0)*2,c.pool.totalVRAM()==i(),c.context.buffers.length==1;let m=c.context.buffers[0];u.check(m),f.check(m),_.check(m)}d.testBasicBufferPoolGC=e;function t(){let c=new l,p=c.add(N.VertexFormat.POSITION_F2,i()/4|0,0);p.area.byteOffset()==0;let u=c.add(N.VertexFormat.POSITION_F2,i()/4|0,1);u.area.byteOffset()==(i()/4|0);let h=c.add(N.VertexFormat.POSITION_F2,i()/4|0,2);h.area.byteOffset()==(i()/4|0)*2;let f=c.add(N.VertexFormat.POSITION_F2,i()/4|0,3);f.area.byteOffset()==(i()/4|0)*3,p.free();let _=c.add(N.VertexFormat.POSITION_F2,i()/4|0,4);u.area.byteOffset()==0,h.area.byteOffset()==(i()/4|0),f.area.byteOffset()==(i()/4|0)*2,_.area.byteOffset()==(i()/4|0)*3,c.pool.totalVRAM()==i(),c.context.buffers.length==1;let m=c.context.buffers[0];u.check(m),h.check(m),f.check(m),_.check(m)}d.testBasicBufferPoolGC2=t;function n(){let c=new l,p=c.add(N.VertexFormat.POSITION_F2,i()/4|0,0);p.area.byteOffset()==0;let u=c.add(N.VertexFormat.POSITION_F2,i()/4|0,1);u.area.byteOffset()==(i()/4|0);let h=c.add(N.VertexFormat.POSITION_F2,i()/4|0,2);h.area.byteOffset()==(i()/4|0)*2,u.free();let f=c.add(N.VertexFormat.POSITION_F2,i()/2|0,3);p.area.byteOffset()==0,h.area.byteOffset()==(i()/4|0),f.area.byteOffset()==(i()/4|0)*2,c.pool.totalVRAM()==i(),c.context.buffers.length==1;let _=c.context.buffers[0];p.check(_),h.check(_),f.check(_)}d.testByteOffsetBugFig5426=n;function r(){let c=new l,p=c.add(N.VertexFormat.POSITION_F2,8,0);p.area.byteOffset()==0;let u=c.add(N.VertexFormat.POSITION_F2,8,1);u.area.byteOffset()==8;let h=c.add(N.VertexFormat.POSITION_F4_COORD_F4,32,2);h.area.byteOffset()==32;let f=c.add(N.VertexFormat.POSITION_F4_COORD_F4,32,3);f.area.byteOffset()==64,u.free(),h.free();let _=c.add(N.VertexFormat.POSITION_F2,i()-64,4);p.area.byteOffset()==0,f.area.byteOffset()==32,_.area.byteOffset()==64,c.pool.totalVRAM()==i(),c.context.buffers.length==1;let m=c.context.buffers[0];p.check(m),f.check(m),_.check(m)}d.testStrideBugFig5426=r;class o{constructor(p,u){this._context=null,this._byteCount=0,this._bytes=null,this._context=p,this._byteCount=u,this._bytes=new Uint8Array(u)}context(){return this._context}bytes(){return this._bytes}byteCount(){return this._byteCount}move(p,u,h){h>=0,0<=p&&p+h<=this._byteCount,0<=u&&u+h<=this._byteCount,p!=u&&h!=0&&this._bytes.set(this._bytes.subarray(p,p+h),u)}upload2(p,u){0<=u&&u+p.length<=this._byteCount,this._bytes.set(p,u)}prepare(){}}d.VertexBuffer=o;class a{createVertexBuffer(p){let u=new o(this,p);return this.buffers.push(u),u}addContextResetHandler(p){}beginFrame(){}clear2(p,u){}createMaterial(p,u,h,f){return null}createTexture2(p,u,h,f,_){return null}createTexture3(p,u,h){return null}createFramebuffer(p,u,h){return null}currentFramebuffer(){return null}currentStencilState(){return null}currentBlendState(){return null}draw(p,u,h){}endFrame(){}flush(){}getNumFramebufferSwitches(){return 0}height(){return 0}maxTextureSize(){return 4096}removeContextResetHandler(p){}resize(p,u){return new N.ComputedCanvasSize(new E(p,u),!1)}setBlendState(p){}readPixels(p,u,h,f,_){return null}resetNumFramebufferSwitches(){}bindWebGLFramebufferAndTrackForBudget(p){}setStencilState(p){}setFramebuffer(p){}setViewport(p,u,h,f){}width(){return 0}annotate(p,u){u()}annotateAndReturn(p,u){return u()}annotateProfile(p,u){u()}setScissor(p){}isContextLost(){return!1}graphicsCardName(){return"Unknown"}setMaximumDrawingBufferSizeForTesting(p){}clearMaximumDrawingBufferSizeForTesting(){}hasLoggedHighpPrecisionUnsupported(){return!0}setHasLoggedHighpPrecisionUnsupported(){}constructor(){this.buffers=[]}}d.Context=a;class s{free(){this.area.free(),this.area.wasFreed()}check(p){for(let u=0,h=this.bytes.length;u<h;u=u+1)p.bytes()[this.area.byteOffset()+u]==this.bytes[u]}constructor(p,u){this.bytes=p,this.area=u}}d.Result=s;class l{constructor(){this.context=new a,this.pool=null,this.pool=new N.BufferPool(this.context)}add(p,u,h){let f=new Uint8Array(u);f[0]=h*2+1,f[f.length-1]=h*2+2;let _=this.pool.allocate(p,f);return _!=null,_.byteCount()==u,_.wasFreed(),new s(f,_)}}d.Helper=l})(_v||(_v={}));var Kd=class{constructor(e){this._scene=null,this._watchedNodeIDs=new Map,this.onChangeCallback=null,e.addAppObserver(this)}watchNodesWithIDs(e){this._watchedNodeIDs=new Map;for(let t of e)this._watchedNodeIDs.set(t,!0)}handleSceneChange(e,t){this._scene=t,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this.onChangeCallback!=null&&this.onChangeCallback()}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}_isWatchedNode(e){return this._watchedNodeIDs.has(e)}_isAncestorOrSelfOfWatchedNode(e){for(let t of Array.from(this._watchedNodeIDs.keys())){let n=this._scene.findNode2(t);for(let r=n;r!=null;r=r.parent())if(ne.equals(r.id(),e))return!0}return!1}handleSceneGraphEvent(e){let t=!1;if(e.property==25){let n=e.oldVal!=null&&$.isParentIndex(e.oldVal)?$.asParentIndex(e.oldVal):null,r=e.newVal!=null&&$.isParentIndex(e.newVal)?$.asParentIndex(e.newVal):null;(n==null||r==null||n.id!=r.id)&&(t=this._isAncestorOrSelfOfWatchedNode(e.node.id()))}else e.property==24?t=this._isAncestorOrSelfOfWatchedNode(e.node.id()):(e.property==49||e.property==88)&&(t=this._isWatchedNode(e.node.id()));t&&this.onChangeCallback!=null&&this.onChangeCallback()}};var Ks=class i{toJSON(){let e={nodeId:this.nodeId};return this.nodeOffset!=null&&(e.nodeOffset={x:this.nodeOffset.x(),y:this.nodeOffset.y()}),this.canvasPosition!=null&&(e.canvasPosition={x:this.canvasPosition.x(),y:this.canvasPosition.y()}),e}static fromJSON(e){let t=null,n=null,r=null;return e.nodeId!==null&&e.nodeId!==void 0&&(t=ne.fromString(e.nodeId)),e.nodeOffset!==null&&e.nodeOffset!==void 0&&(n=new E(e.nodeOffset.x,e.nodeOffset.y)),e.canvasPosition!==null&&e.canvasPosition!==void 0&&(r=new E(e.canvasPosition.x,e.canvasPosition.y)),new i(t,n,r)}constructor(e,t,n){this.nodeId=e,this.nodeOffset=t,this.canvasPosition=n}},qd=class{constructor(e){this._appState=null,this._boundsWatcher=null,this._shouldNotifyCommentPositionsChanged=!1,this._nodesWithComments=[],this.notifyCommentPositionsChange=null,this._appState=e,this._boundsWatcher=new Kd(e),this._boundsWatcher.onChangeCallback=()=>{this._shouldNotifyCommentPositionsChanged=!0},this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this)}setNodesWithComments(e){this._boundsWatcher.watchNodesWithIDs(e),this._nodesWithComments=e}onFrame(){this._shouldNotifyCommentPositionsChanged&&(this.notifyCommentPositionsChange!=null&&this.notifyCommentPositionsChange(),this._shouldNotifyCommentPositionsChanged=!1)}handleSceneChange(e,t){this._shouldNotifyCommentPositionsChanged=!0}handleActiveCanvasChange(e,t){this._shouldNotifyCommentPositionsChanged=!0}handleActivePrototypeStartingPointChange(e,t){}_isAncestorOrSelfOfNodeWithComment(e){let t=this._appState.scene();if(t==null)return!1;for(let n of this._nodesWithComments){let r=t.findNode1(n);for(let o=r;o!=null;o=o.parent()){let a=o.id();if(ne.equals(a,e))return!0}}return!1}handleStateChangeAborted(e){this.handlePresentedStateChange(e)}handleStateChangeCommitted(e,t){this.handlePresentedStateChange(e)}handleStateChangeInitiated(e){this.handlePresentedStateChange(e)}handleStateChangeRequested(e){}handlePresentedStateChange(e){if(e==null||this._shouldNotifyCommentPositionsChanged)return;if(this._isAncestorOrSelfOfNodeWithComment(e.oldStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let t=e.oldStateAndOverlays.overlays;for(let r=0,o=t.length;r<o;r=r+1){let a=t[r].id;if(this._isAncestorOrSelfOfNodeWithComment(a)){this._shouldNotifyCommentPositionsChanged=!0;return}}if(this._isAncestorOrSelfOfNodeWithComment(e.newStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let n=e.newStateAndOverlays.overlays;for(let r=0,o=n.length;r<o;r=r+1){let a=n[r].id;if(this._isAncestorOrSelfOfNodeWithComment(a)){this._shouldNotifyCommentPositionsChanged=!0;return}}}handleFitModeChange(e,t){}handleRestartPrototype(){}getCommentDestinationAtPosition(e){let t=this._appState.scene();if(t==null)return null;let n=this._appState.baseScreenNode();if(n==null)return null;let r=this._appState.prototypeState().getCurrentOverlays();for(let a=r.length-1;a>=0;a=a-1){let s=t.findNode1(r[a].id());if(s==null)continue;let l=r[a].renderedBounds(n);if(l.contains2(e)){let d=e.subtract1(l.topLeft());return new Ks(s.id(),d,null)}}let o=e.subtract1(n.canvasSpaceBoundingBox().topLeft());return new Ks(n.id(),o,null)}_currentCommentsScreen(){return this._appState.prototypeState().getTopmostScreen()}_currentCommentsScreenRenderedBounds(){let e=this._appState.baseScreenNode(),t=this._appState.prototypeState().getTopmostOverlay();return e!=null&&t!=null?t.renderedBounds(e):e==null?void 0:e.canvasSpaceBoundingBox()}getCanvasSpaceCommentLocations(e,t){let n={};for(let r of Array.from(t.keys())){let o=t.get(r),a=e.findNode1(o.nodeId),s=this._currentCommentsScreen(),l=this._currentCommentsScreenRenderedBounds();if(a==null||s==null||l==null)continue;let d=!1;if(d=s.isAncestorOf(a),!d)continue;let c=a.canvasSpaceScrolledBounds(1).topLeft().subtract1(s.canvasSpaceBoundingBox().topLeft()),u=l.topLeft().add1(c).add1(o.nodeOffset),h={};h.x=u.x(),h.y=u.y(),n[r]=h}return n}};var kh;(s=>(s.FIG_FILE_NO_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,73,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,130,136,1,0]),s.FIG_FILE_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,76,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,2,11,177,49,48,0,0,3,0,0,0,1,2,3]),s.GIF_MULTI_IMAGE=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,2,76,1,0,59]),s.GIF_MALFORMED_END_NO_EOF=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,50,76,1,0]),s.GIF_SPEED=new Uint8Array([71,73,70,56,57,97,2,0,2,0,240,0,0,0,0,0,255,255,255,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,0,25,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,33,249,4,0,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,68,0,5,0,33,249,4,0,100,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,132,83,0,33,249,4,0,200,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,4,2,5,0,59]),s.GIF_D1_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,5,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59]),s.GIF_D3_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,13,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59])))(kh||(kh={}));var Yd=class{constructor(e,t){if(this._app=null,this._frameLoader=null,this._session=null,this._pendingNodeId=null,this._app=e,this._session=t,this._frameLoader=this._session.incrementalLoader(),this._frameLoader==null)throw new Error("Expected incremental frame loader for mirror mode");this._emitter=$t.getEventEmitter(),this._pendingNodeId=null,this._emitter.on("incrementalLoadingInfo",n=>{n.type==="finishIncrementalLoading"&&this._handleIncrementalLoadFinished()})}hasPendingSelectionChange(){return this._pendingNodeId!==null}connectToFileAndShowNode(e,t,n,r,o,a,s){n!=null&&this._app.state().setActivePrototypeStartingPointNodeId(n),this._session.fileKey()!=e?this._app.connectTo(e,t,n,r,o,a,s):this._app.state().currentFileKey()!=e?(this._frameLoader.requestTlf(t),this._pendingNodeId=t):this._frameLoader.requestTlf(t)?this._app.state().prototypeState().navigateToFrameAndCloseOverlays1(t):this._pendingNodeId=t}_handleIncrementalLoadFinished(){var e;this._pendingNodeId!=null&&((e=this._app.state().scene())==null?void 0:e.findNode1(this._pendingNodeId))!=null&&(this._app.state().prototypeState().navigateToFrameAndCloseOverlays1(this._pendingNodeId),this._pendingNodeId=null)}};var tc;(a=>{function i(s){return{x:Math.round(s.x()*100)/100,y:Math.round(s.y()*100)/100}}a._serialize=i;function e(s){return new E(s.x,s.y)}a._deserializeVector=e;function t(s,l){1&l&&(s.alt=!0),2&l&&(s.meta=!0),4&l&&(s.shift=!0),8&l&&(s.ctrl=!0),16&l&&(s.platform=!0)}a._setModifiers=t;function n(s){return("alt"in s?1:0)|("meta"in s?2:0)|("shift"in s?4:0)|("ctrl"in s?8:0)|("platform"in s?16:0)}a._loadModifiers=n;function r(s,l){let d=s.asMouseEvent();if(d!=null){let p={};return p.type=la[s.type()],p.at=i(l(d.locationInWindow)),d.locationInWindow.equals(d.previousLocationInWindow)||(p.lastAt=i(l(d.previousLocationInWindow))),d.clickCount!=0&&(p.clicks=d.clickCount),d.scrollDelta!=null&&(p.scroll=i(d.scrollDelta)),t(p,s.modifiers()),p}let c=s.asKeyEvent();if(c!=null){let p={};return p.type=la[s.type()],p.key=c.key,c.isRepeat&&(p.repeat=!0),t(p,s.modifiers()),p}return null}a.serialize=r;function o(s,l,d,c){let p=Ra.ViewerEventType_fromString(s.type);if(Ra.ViewerEventType_isMouseEventType(p)){let u=c(e(s.at)),h=l(u),f=u;"lastAt"in s&&(f=c(e(s.lastAt)));let _=null;"scroll"in s&&(_=e(s.scroll));let m=0;"clicks"in s&&(m=s.clicks);let A=n(s);return new As(p,h,A,u,f,_,m,[])}else if(Ra.ViewerEventType_isKeyEventType(p)){let u=d(),h=s.key|0,f=s.repeat,_=n(s);return new ys(p,u,_,h,f)}else if(Ra.ViewerEventType_isTouchEventType(p)){let u=n(s),h=c(e(s.at)),f=l(h);if(p==11||p==12){let _=h;"lastAt"in s&&(_=c(e(s.lastAt)));let m=new hl(0,f,h,_);return new Ss(p,f,u,[m],[m])}else return new Ss(p,f,u,[],[])}else if(Ra.ViewerEventType_isWindowEventType(p))throw new Error("Deserializing window events not supported");throw new Error(`Unrecognized event type in deserialize ${la[p]}`)}a.deserialize=o})(tc||(tc={}));var iJ=new _l(1/.05,1),aJ=fl.withDampingRatio(.5,100,1.1);var Av;(t=>{function i(n,r){return n(r)}t.call=i;function e(n){return n}t._new=e})(Av||(Av={}));var e_;(r=>{function i(o){e(o.map(a=>(s,l,d,c)=>{a(d,c)}))}r.createNewSceneAndRun=i;function e(o){let a=new vn,s=It.createSceneWithCanvasForTests1(),l=s.root().childAt1(0),d=Gn(l,"source",C.BLACK);d.setRelativeTransform(new oe(1,0,0,0,1,400)),d.setSize(new E(500,700));let c=Gn(l,"dst",C.BLACK);c.setRelativeTransform(new oe(1,0,0,0,1,1100)),c.setSize(new E(500,700)),a.setActiveCanvas(l),a.setScene(s);for(let p of o)p(a,s,d,c)}r.createNewAppStateAndSceneAndRun=e;function t(){let o=AssertLib.deepStrictEqual,a=new Ka("./src/test/protomagicmove.test.sk");beforeEach(()=>{X.setViewerMode(X.ViewerMode.PROTOTYPE)}),Qt("getNodeMatches",()=>{let s=(l,d,c)=>{let p=Go.getNodeMatches(l,d);for(let u of c){let h=u[0],f=u[1],_=Le.StringMap_get(p,h.id(),null),m=Le.StringMap_get(p,f.id(),null);o(_,f,`Expected ${h.id()} to match ${f.id()}, but got ${_==null?null:_.id()} instead.`),o(m,h,`Expected ${f.id()} to match ${h.id()}, but got ${m==null?null:m.id()} instead.`)}o(p.size,c.length*2)};we("simple match case",()=>{let d=It.createSceneWithCanvasForTests1().root().childAt1(0),c=dt(d,"src"),p=rt(c,"A"),u=rt(c,"B"),h=rt(c,"C"),f=dt(d,"dst"),_=rt(f,"A"),m=rt(f,"B"),A=rt(f,"C");s(c,f,[[p,_],[u,m],[h,A]])}),we("crossed match case",()=>{let d=It.createSceneWithCanvasForTests1().root().childAt1(0),c=dt(d,"src"),p=rt(c,"A"),u=rt(c,"B"),h=dt(d,"dst"),f=rt(h,"B"),_=rt(h,"A");s(c,h,[[p,_],[u,f]])}),we("duplicate names",()=>{let d=It.createSceneWithCanvasForTests1().root().childAt1(0),c=dt(d,"src"),p=rt(c,"A"),u=rt(c,"A");rt(c,"A");let h=dt(d,"dst"),f=rt(h,"A"),_=rt(h,"A");s(c,h,[[p,f],[u,_]])}),we("recursive matches",()=>{let d=It.createSceneWithCanvasForTests1().root().childAt1(0),c=dt(d,"src"),p=dt(d,"dst"),u=rt(c,"A"),h=rt(u,"A"),f=rt(u,"B"),_=rt(c,"B");rt(_,"A"),rt(_,"B");let m=rt(c,"C");rt(m,"A"),rt(m,"B");let A=rt(p,"A"),y=rt(A,"A"),S=rt(A,"B"),g=rt(p,"B");rt(g,"C"),rt(g,"D");let b=rt(p,"D");rt(b,"A"),rt(b,"B"),s(c,p,[[u,A],[h,y],[f,S],[_,g]])}),we("hidden and transparent nodes",()=>{let d=It.createSceneWithCanvasForTests1().root().childAt1(0),c=dt(d,"src"),p=rt(c,"A");rt(c,"B");let u=rt(c,"C"),h=rt(c,"D");p.setVisible(!1),u.setOpacity(0);let f=dt(d,"dst");rt(f,"A");let _=rt(f,"B"),m=rt(f,"C"),A=rt(f,"D");_.setVisible(!1),h.setOpacity(0),s(c,f,[[u,m],[h,A]])}),we("boolean op nodes",()=>{let d=It.createSceneWithCanvasForTests1().root().childAt1(0),c=dt(d,"src"),p=Il(c);p.setName("booleanOp"),rt(p,"A"),rt(p,"B");let u=dt(d,"dst"),h=Il(u);h.setName("booleanOp"),rt(h,"A"),rt(h,"B"),s(c,u,[[p,h]])})}),we("Smart animate of fixed elements",()=>{let s=new E(100,100),l=new E(10,10),d=new vn,c=It.createSceneWithCanvasForTests1(),p=c.root().childAt1(0);p.setPrototypeDevice(new er("CUSTOM",s,null,"NONE")),p.setCurrentViewportSize(s),d.setActiveCanvas(p),d.setScene(c);let u=(m,A)=>{let y=ut(p);y.setSize(new E(m,A)),y.setUsedAsBaseScreen(!0);let S=Mr(y);return S.setSize(new E(10,10)),S.setRelativeTransform(new oe(1,0,0,0,1,A-l.y())),S.setVerticalConstraint("MAX"),S.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),y},h=u(100,200),f=u(100,100);vl(h,f);let _=$l.buildStrategy(h.childAt1(0),f.childAt1(0));o(_.transition.from().transform1().translation().y(),s.y()-l.y()),o(_.transition.to().transform1().translation().y(),s.y()-l.y())}),Qt("interpolation strategies",()=>{let s=(l,d)=>{let c=$l.buildStrategy(l,d);c.isDissolve};we("dissolve discrete properties",()=>{[(d,c)=>{let p=he(d,"A");p.setBlendMode("NORMAL");let u=he(c,"A");u.setBlendMode("MULTIPLY"),s(p,u)},(d,c)=>{let p=Rb(d,"B"),u=he(c,"B");s(p,u)},(d,c)=>{let p=Gn(d,"C",C.TRANSPARENT);he(p,"C_content");let u=da(c,"C");he(u,"C_content"),s(p,u)},(d,c)=>{d.setOverflowDirection("VERTICAL"),c.setOverflowDirection("VERTICAL");let p=he(d,"D");p.setScrollBehavior("SCROLLS");let u=he(c,"D");u.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),s(p,u)}].forEach(d=>{i([d])})}),we("interpolate effects and paints",()=>{let l=se.createLinearGradient([new at(C.RED,0),new at(C.TRANSPARENT,.5)]);[(c,p)=>{let u=ap(c,"A",[l]),h=he(p,"A");s(u,h)},(c,p)=>{let u=he(c,"B");u.setTestOnlyEffects1([]);let h=he(p,"B");h.setTestOnlyEffects1([Fe.createForegroundBlur(1)]),s(u,h)},(c,p)=>{let u=he(c,"C");u.setTestOnlyEffects1([Fe.createForegroundBlur(1)]);let h=he(p,"C");h.setTestOnlyEffects1([Fe.createDropShadow1(1,new E(1,1),C.BLACK,1)]),s(u,h)},(c,p)=>{let u=he(c,"D"),h=[Fe.createForegroundBlur(1),Fe.createDropShadow1(1,new E(1,1),C.BLACK,1)];u.setTestOnlyEffects1(h);let f=he(p,"D"),_=h.slice();_[0].setIsEnabled(!1),f.setTestOnlyEffects1(_),s(u,f)},(c,p)=>{let u=he(c,"E"),h=[l,se.createSolid(C.RED,1)];u.setTestOnlyFillPaints3(h);let f=he(p,"E"),_=h.slice();_[0].setIsEnabled(!1),f.setTestOnlyFillPaints3(_),s(u,f)}].forEach(c=>{i([c])})}),we("interpolate geometry",()=>{let l=(c,p,u)=>{let h=rt(c,p);h.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]);let f=u.topLeft().x(),_=u.topLeft().y(),m=u.width(),A=u.height(),y=new Yn("NONZERO",0,Rt.new2().moveTo1(f,_).lineTo(f+m,_).lineTo(f+m,_+A).lineTo(f,_+A-1).close(),u),S=new Dn([y],null,y.bounds(),null);return h.setTestOnlyFillPaints([se.createSolid(C.RED,1)]),h.setTestOnlyFillGeometry(S),h.setTestOnlyStrokeGeometry(S),je(h,u.topLeft(),u.size()),h};[(c,p)=>{let u=l(c,"A",new U(0,0,100,100)),h=zt(p,"A",C.RED,1);s(u,h)}].forEach(c=>{i([c])})})}),Qt("magic move",()=>{let s=(p,u,h)=>{Vs(p,()=>{let f=[];return u.forEach(_=>{i([h,(m,A)=>{let y=new oe(1,0,0,0,1,700),S=Nt.FrozenAffineTransform_IDENTITY,g=Go.getMagicMovePlan2(m,y,A,S,Rn.get(_));f.push(a.asyncAssertMatchesSnapshot(`plan ${_}`,g.debugString()));let b=()=>0,T=Vr.makeEasingFunction([0,0,1,1],.3),I=new Xi(g,b,T);f.push(a.asyncAssertMatchesSnapshot(`render tree ${_}`,I.renderTree().debugString1()))}])}),Promise.all(f)})},l=["DISSOLVE","SLIDE_FROM_RIGHT","PUSH_FROM_RIGHT","MOVE_FROM_RIGHT","SLIDE_OUT_TO_RIGHT","MOVE_OUT_TO_RIGHT"],d=["DISSOLVE","MOVE_FROM_RIGHT","MOVE_OUT_TO_RIGHT"],c=["DISSOLVE"];s("identical rectangles",c,(p,u)=>{he(p,"rect"),he(u,"rect")}),s("rectangles with different opacities",c,(p,u)=>{he(p,"rect").setOpacity(.9),he(u,"rect").setOpacity(.1)}),s("rectangles with changing and unchanging paints",c,(p,u)=>{ap(p,"rect",[se.createSolid(C.RED,1),se.createSolid(C.GREEN,1)]),ap(u,"rect",[se.createSolid(C.BLUE,1),se.createSolid(C.GREEN,1)])}),s("rectangles with different translations",c,(p,u)=>{he(p,"rect").setRelativeTransform(new oe(1,0,30,0,1,50)),he(u,"rect").setRelativeTransform(new oe(1,0,130,0,1,250))}),s("rectangles with different rotation",c,(p,u)=>{let h=he(p,"rect");h.setRelativeTransform(new oe(1,0,30,0,1,50));let f=he(u,"rect"),_=oe.new3(h.relativeTransform());_.rotatedBy(Math.PI/4),f.setRelativeTransform(_)}),s("rectangles with different scale",c,(p,u)=>{let h=he(p,"rect");h.setRelativeTransform(new oe(1,0,30,0,1,50));let f=he(u,"rect"),_=oe.new3(h.relativeTransform());_.scaledBy1(new E(2,3)),f.setRelativeTransform(_)}),s("insertion of new rectangle",c,(p,u)=>{he(u,"rect")}),s("deletion of old rectangle",c,(p,u)=>{he(p,"rect")}),s("rectangles with mismatched names",c,(p,u)=>{he(p,"A"),he(u,"B")}),s("hidden and never-visible rectangles",c,(p,u)=>{let h=he(p,"hidden"),f=he(p,"neverVisible");h.setVisible(!1),f.setOpacity(0);let _=he(u,"hidden"),m=he(u,"neverVisible");_.setVisible(!1),m.setOpacity(0)}),s("hidden and transparent and no match nodes to visible nodes",c,(p,u)=>{let h=he(p,"hidden"),f=he(p,"transparent");h.setVisible(!1),f.setOpacity(0),he(u,"hidden"),he(u,"transparent"),he(u,"noMatch")}),s("visible nodes to hidden and transparent and no match nodes",c,(p,u)=>{he(p,"hidden"),he(p,"transparent"),he(p,"noMatch");let h=he(u,"hidden"),f=he(u,"transparent");h.setVisible(!1),f.setOpacity(0)}),s("matching boolean op nodes",c,(p,u)=>{let h=Il(p);h.setName("booleanOp"),rt(h,"A"),rt(h,"B");let f=Il(u);f.setName("booleanOp"),rt(f,"A"),rt(f,"B")}),s("simple matching with layer re-ordering",c,(p,u)=>{he(p,"A"),he(p,"B"),he(u,"B"),he(u,"A")}),s("simple insertion, deletion, and matching",l,(p,u)=>{he(p,"A"),he(p,"B"),he(u,"C"),he(u,"B")}),s("complex layer re-ordering with insertions and removals",d,(p,u)=>{he(p,"A"),he(p,"B"),he(p,"C"),he(p,"D"),he(p,"E"),he(p,"F"),he(p,"G"),he(p,"H"),he(u,"1"),he(u,"2"),he(u,"F"),he(u,"3"),he(u,"4"),he(u,"C"),he(u,"5"),he(u,"6")}),s("complex matching case with no nesting",c,(p,u)=>{he(p,"A"),he(p,"B"),he(p,"C"),he(p,"E"),he(u,"X"),he(u,"Y"),he(u,"B"),he(u,"Z"),he(u,"E"),he(u,"F")}),s("simple nested matching",c,(p,u)=>{let h=dt(p,"F");dt(h,"rect");let f=dt(u,"F");dt(f,"rect").setOpacity(.5)}),s("nested insertions/removals",d,(p,u)=>{let h=dt(p,"A");he(h,"rectA");let f=dt(u,"B");he(f,"rectB")}),s("dissolving between different sized objects",c,(p,u)=>{he(p,"A").setSize(new E(100,100)),he(u,"A").setSize(new E(200,200))}),s("dissolving between non-uniformly scaling frames with children",c,(p,u)=>{let h=dt(p,"A");h.setSize(new E(150,1)),zt(h,"rect",C.RED,1).setSize(new E(100,100)),zt(h,"rect",C.RED,1).setSize(new E(100,100));let m=dt(u,"A");m.setSize(new E(300,300)),zt(m,"rect",C.RED,1).setSize(new E(100,100)),zt(m,"rect",C.RED,1).setSize(new E(100,100))}),s("dissolving between background blur objects",c,(p,u)=>{let h=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(h),zt(p,"A",C.RED,.5).setTestOnlyEffects1([Fe.createBackgroundBlur(1)]),zt(u,"A",C.BLUE,.5).setTestOnlyEffects1([Fe.createBackgroundBlur(1)])}),s("dissolving between background blur objects with a background blur behind",c,(p,u)=>{let h=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(h),zt(p,"BG",C.RED,.5).setTestOnlyEffects1([Fe.createBackgroundBlur(1)]),zt(u,"BG",C.RED,.5).setTestOnlyEffects1([Fe.createBackgroundBlur(1)]),zt(p,"A",C.RED,.5).setTestOnlyEffects1([Fe.createBackgroundBlur(1)]),zt(u,"A",C.BLUE,.5).setTestOnlyEffects1([Fe.createBackgroundBlur(1)])}),s("translating a background blur contained in a frame with clip-content enabled",c,(p,u)=>{let h=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(h);let f=dt(p,"A");f.setIsFrameMaskDisabled(!0);let _=dt(f,"B");zt(_,"BG",C.RED,.5).setTestOnlyEffects1([Fe.createBackgroundBlur(1)]);let A=dt(u,"A");A.setIsFrameMaskDisabled(!0);let y=oe.new3(A.relativeTransform());y.translatedBy2(10,10),A.setRelativeTransform(y);let S=dt(A,"B");zt(S,"BG",C.RED,.5).setTestOnlyEffects1([Fe.createBackgroundBlur(1)])}),s("translating a node with a background blur",c,(p,u)=>{zt(p,"BG",C.RED,.5).setTestOnlyEffects1([Fe.createBackgroundBlur(1)]);let f=zt(u,"BG",C.RED,.5);f.setTestOnlyEffects1([Fe.createBackgroundBlur(1)]);let _=oe.new3(f.relativeTransform());_.translatedBy2(10,10),f.setRelativeTransform(_)}),s("dissolving + scaling between nodes with unmatched children",c,(p,u)=>{let h=Gn(p,"F",C.RED);h.setSize(new E(100,100)),he(h,"rect"),dt(u,"F").setSize(new E(200,200))}),s("dissolve only between nodes with unmatched children",c,(p,u)=>{let h=Gn(p,"F",C.RED);h.setSize(new E(100,100)),he(h,"rect"),Ib(u,"F").setSize(new E(100,100))}),s("dissolving between visible top frame to invisibile top frame",c,(p,u)=>{let h=new se("SOLID");h.setColor(C.RED),h.setOpacity(1),h.setIsEnabled(!0),p.setTestOnlyFillPaints3([h]),h.setOpacity(0),u.setTestOnlyFillPaints3([h])}),s("dissolving between different opacity objects",c,(p,u)=>{let h=he(p,"A");h.setOpacity(1),h.setBlendMode("MULTIPLY");let f=he(u,"A");f.setOpacity(.5),f.setBlendMode("NORMAL")}),s("dissolving between invisible node to visible node",c,(p,u)=>{zt(p,"A",C.RED,0),zt(u,"A",C.BLUE,.5)}),s("interpolating between two solid color paints",c,(p,u)=>{zt(p,"A",C.RED,1),zt(u,"A",C.BLUE,1)}),s("drop shadow: node rotates",c,(p,u)=>{let h=he(p,"rect");h.setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]),h.setRelativeTransform(new oe(1,0,30,0,1,50));let f=he(u,"rect");f.setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]);let _=oe.new3(h.relativeTransform());_.rotatedBy(Math.PI/4),f.setRelativeTransform(_)}),s("inner shadow: node rotates",c,(p,u)=>{let h=he(p,"rect");h.setTestOnlyEffects1([Fe.createInnerShadow(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]),h.setRelativeTransform(new oe(1,0,30,0,1,50));let f=he(u,"rect");f.setTestOnlyEffects1([Fe.createInnerShadow(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]);let _=oe.new3(h.relativeTransform());_.rotatedBy(Math.PI/4),f.setRelativeTransform(_)}),s("drop shadow: group shadow where group rotates and children are static",c,(p,u)=>{let h=Gn(p,"F",C.TRANSPARENT);h.setIsBackgroundEnabled(!1),he(h,"rectA").setRelativeTransform(oe.new2()),he(h,"rectB").setRelativeTransform(new oe(1,0,50,0,1,0)),h.setRelativeTransform(new oe(1,0,30,0,1,50)),h.setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]);let m=Gn(u,"F",C.TRANSPARENT);m.setIsBackgroundEnabled(!1),he(m,"rectA").setRelativeTransform(oe.new2()),he(m,"rectB").setRelativeTransform(new oe(1,0,50,0,1,0));let S=oe.new3(h.relativeTransform());S.rotatedBy(Math.PI/4),m.setRelativeTransform(S),m.setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)])}),s("drop shadow: group shadow where group is static and children rotate",c,(p,u)=>{let h=Gn(p,"F",C.TRANSPARENT);h.setIsBackgroundEnabled(!1),he(h,"rectA").setRelativeTransform(oe.new2()),he(h,"rectB").setRelativeTransform(new oe(1,0,50,0,1,0)),h.setRelativeTransform(new oe(1,0,30,0,1,50)),h.setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]);let m=Gn(u,"F",C.TRANSPARENT);m.setIsBackgroundEnabled(!1);let A=he(m,"rectA");A.setRelativeTransform(oe.new2());let y=he(m,"rectB");y.setRelativeTransform(new oe(1,0,50,0,1,0));let S=oe.new3(A.relativeTransform());S.rotatedBy(Math.PI/4),A.setRelativeTransform(S);let g=oe.new3(y.relativeTransform());g.rotatedBy(Math.PI/4),y.setRelativeTransform(g),m.setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)])}),s("drop shadow: complex group shadow with nested groups and mixed transitions",c,(p,u)=>{let h=Gn(p,"staticGroup1",C.TRANSPARENT);h.setIsBackgroundEnabled(!1),h.setRelativeTransform(new oe(1,0,30,0,1,50)),h.setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]),he(h,"staticRectZ").setRelativeTransform(oe.new2());let _=Gn(h,"rotatingGroup2",C.TRANSPARENT);_.setIsBackgroundEnabled(!1),he(_,"rotatingRectA").setRelativeTransform(oe.new2()),he(_,"staticRectB").setRelativeTransform(new oe(1,0,50,0,1,0));let y=Gn(u,"staticGroup1",C.TRANSPARENT);y.setIsBackgroundEnabled(!1),y.setRelativeTransform(new oe(1,0,30,0,1,50)),y.setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]),he(y,"staticRectZ").setRelativeTransform(oe.new2());let g=Gn(y,"rotatingGroup2",C.TRANSPARENT);g.setIsBackgroundEnabled(!1),g.setRelativeTransform(oe.new2().rotatedBy(Math.PI/4)),he(g,"rotatingRectA").setRelativeTransform(oe.new2().rotatedBy(Math.PI/3)),he(g,"staticRectB").setRelativeTransform(new oe(1,0,50,0,1,0))}),s("inner shadow: complex group shadow with nested groups and mixed transitions",c,(p,u)=>{let h=Gn(p,"staticGroup1",C.TRANSPARENT);h.setIsBackgroundEnabled(!1),h.setRelativeTransform(new oe(1,0,30,0,1,50)),h.setTestOnlyEffects1([Fe.createInnerShadow(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]),he(h,"staticRectZ").setRelativeTransform(oe.new2());let _=Gn(h,"rotatingGroup2",C.TRANSPARENT);_.setIsBackgroundEnabled(!1),he(_,"rotatingRectA").setRelativeTransform(oe.new2()),he(_,"staticRectB").setRelativeTransform(new oe(1,0,50,0,1,0));let y=Gn(u,"staticGroup1",C.TRANSPARENT);y.setIsBackgroundEnabled(!1),y.setRelativeTransform(new oe(1,0,30,0,1,50)),y.setTestOnlyEffects1([Fe.createInnerShadow(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]),he(y,"staticRectZ").setRelativeTransform(oe.new2());let g=Gn(y,"rotatingGroup2",C.TRANSPARENT);g.setIsBackgroundEnabled(!1),g.setRelativeTransform(oe.new2().rotatedBy(Math.PI/4)),he(g,"rotatingRectA").setRelativeTransform(oe.new2().rotatedBy(Math.PI/3)),he(g,"staticRectB").setRelativeTransform(new oe(1,0,50,0,1,0))}),s("drop shadow: no node change but parent rotates",c,(p,u)=>{let h=dt(p,"F");he(h,"rect").setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]),h.setRelativeTransform(new oe(1,0,30,0,1,50));let _=he(u,"F");he(_,"rect").setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]);let A=oe.new3(h.relativeTransform());A.rotatedBy(Math.PI/4),_.setRelativeTransform(A)}),s("drop shadow: no node change but parent translates/resizes",c,(p,u)=>{let h=dt(p,"F");he(h,"rect").setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]),h.setRelativeTransform(new oe(1,0,30,0,1,50)),h.setSize(new E(100,100));let _=dt(u,"F");he(_,"rect").setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]);let A=oe.new3(h.relativeTransform());A.translate1(ve.FrozenVector_new4(1,1)),_.setRelativeTransform(A),_.setSize(new E(100,200))}),s("transition between scrolling frames",d,(p,u)=>{p.setOverflowDirection("VERTICAL"),p.setTestOnlyFillPaints([se.createSolid(C.RED,1)]),p.setTestOnlyEffects1([Fe.createDropShadow1(1,new E(1,1),C.BLACK,1)]),u.setTestOnlyFillPaints([se.createSolid(C.BLUE,1)]),u.setTestOnlyEffects1([Fe.createDropShadow1(1,new E(1,1),C.BLACK,1)]);let h=zt(p,"rect",C.GREEN,1);h.setSize(new E(p.size().x(),p.size().y()+100)),zt(u,"rect",C.GREEN,1).setSize(h.size())}),s("scaling nodes whose children have different scaling factors",c,(p,u)=>{let h=dt(p,"subframe");h.setSize(new E(100,100)),he(h,"rect").setSize(new E(50,50));let _=dt(u,"subframe");_.setSize(new E(200,200)),he(_,"rect").setSize(new E(50,50))}),s("deeply nested scaling nodes whose children have different scaling factors",c,(p,u)=>{let h=dt(p,"A");h.setSize(new E(100,100));let f=Gn(h,"B",C.RED);f.setSize(new E(50,50)),Gn(f,"C",C.BLACK).setSize(new E(10,10));let m=dt(u,"A");m.setSize(new E(200,200));let A=he(m,"B");A.setSize(new E(50,50)),Gn(A,"C",C.BLACK).setSize(new E(10,10))}),s("transition between two screens with masks",c,(p,u)=>{let h=he(p,"mask");h.setSize(new E(50,50)),h.setIsMask(!0),he(p,"color").setSize(new E(100,100)),rt(u,"andrew");let _=he(u,"mask");_.setRelativeTransform(new oe(1,0,10,0,1,10)),_.setSize(new E(50,50)),_.setIsMask(!0),he(u,"color").setSize(new E(100,100))}),s("MOVE_IN with unmatched layers nested inside of matched layers",["MOVE_FROM_RIGHT"],(p,u)=>{let h=dt(p,"A");zt(h,"A_1",C.BLUE,1);let f=dt(u,"A");zt(f,"A_2",C.GREEN,1)}),s("MOVE_IN with unmatched layers nested inside of matched fixed layers",["MOVE_FROM_RIGHT"],(p,u)=>{let h=dt(p,"A");h.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),zt(h,"A_1",C.BLUE,1);let f=dt(u,"A");zt(f,"A_2",C.GREEN,1)}),s("dissolving image fills with different geometries should separate into masks",c,(p,u)=>{Cg(p,"tri",new E(100,100)),Cg(u,"tri",new E(50,100))}),s("dissolving non-image fills with different geometries should NOT separate into masks",c,(p,u)=>{wg(p,"rect",C.RED,1,new E(100,100)),wg(u,"rect",C.GREEN,1,new E(50,100))}),Vs("non-image rects with different geometries interpolate rounded rectangle parameters",()=>{let p=[];return c.forEach(u=>{i([(h,f)=>{Lr(h,"rect",C.RED,1,new E(100,100)),Lr(f,"rect",C.GREEN,1,new E(50,100));let _=new oe(1,0,0,0,1,1100-400),m=Nt.FrozenAffineTransform_IDENTITY,A=Go.getMagicMovePlan2(h,_,f,m,Rn.get(u));p.push(a.asyncAssertMatchesSnapshot(`plan ${u}`,A.debugString()));let y=()=>0,S=Vr.makeEasingFunction([0,0,1,1],.3),g=new Xi(A,y,S);p.push(a.asyncAssertMatchesSnapshot(`render tree ${u}`,g.renderTree().debugString1()))}])}),Promise.all(p)}),Vs("non-image rects with different geometries and different effect spreads interpolate rounded rectangle + effect parameters",()=>{let p=[];return c.forEach(u=>{i([(h,f)=>{Lr(h,"rect",C.RED,1,new E(100,100)).setTestOnlyEffects1([Fe.createDropShadow2(1,new E(5,5),C.BLACK,.5,10)]),Lr(f,"rect",C.GREEN,1,new E(50,100)).setTestOnlyEffects1([Fe.createDropShadow2(1,new E(5,5),C.BLACK,.5,10)]);let A=new oe(1,0,0,0,1,1100-400),y=Nt.FrozenAffineTransform_IDENTITY,S=Go.getMagicMovePlan2(h,A,f,y,Rn.get(u));p.push(a.asyncAssertMatchesSnapshot(`plan ${u}`,S.debugString()));let g=()=>0,b=Vr.makeEasingFunction([0,0,1,1],.3),T=new Xi(S,g,b);p.push(a.asyncAssertMatchesSnapshot(`render tree ${u}`,T.renderTree().debugString1()))}])}),Promise.all(p)}),s("dissolving image rects with different geometries: render good-enough identical shadows for now",c,(p,u)=>{let h=[Fe.createDropShadow1(1,new E(5,5),C.BLACK,.5)];td(p,"rect",new E(100,100)).setTestOnlyEffects1(h),td(u,"rect",new E(50,100)).setTestOnlyEffects1(h)}),s("dissolving image rects with different geometries: non-identical shadows fall back to dissolve for now",c,(p,u)=>{td(p,"rect",new E(100,100)).setTestOnlyEffects1([Fe.createDropShadow1(1,new E(5,5),C.BLACK,.5)]),td(u,"rect",new E(50,100)).setTestOnlyEffects1([Fe.createDropShadow1(5,new E(5,5),C.BLACK,.5)])}),s("groups with drop shadows and moving children",c,(p,u)=>{let h=da(p,"G");Lr(h,"A",C.RED,1,new E(10,10)),Lr(h,"B",C.GREEN,1,new E(10,10)),h.setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]);let f=da(u,"G");f.setTestOnlyEffects1([Fe.createDropShadow1(1,ve.FrozenVector_new4(1,1),C.BLACK,.5)]),Lr(f,"A",C.RED,1,new E(10,10)).setRelativeTransform(new oe(1,0,20,0,1,30)),Lr(f,"B",C.GREEN,1,new E(10,10)).setRelativeTransform(new oe(1,0,50,0,1,100))}),s("resizing resize-to-fit-groups without background paints",c,(p,u)=>{let h=da(p,"G");Lr(h,"A",C.RED,1,new E(10,10)).setRelativeTransform(new oe(1,0,0,0,1,0)),Lr(h,"B",C.GREEN,1,new E(10,10)).setRelativeTransform(new oe(1,0,10,0,1,30)),h.setSize(new E(20,40));let m=da(u,"G");Lr(m,"A",C.RED,1,new E(10,10)).setRelativeTransform(new oe(1,0,0,0,1,0)),Lr(m,"B",C.GREEN,1,new E(10,10)).setRelativeTransform(new oe(1,0,20,0,1,30)),m.setSize(new E(30,40))}),s("resizing resize-to-fit-groups with background paints",c,(p,u)=>{let h=[se.createSolid(C.RED,1)],f=da(p,"G");f.setTestOnlyFillPaints(h),Lr(f,"A",C.RED,1,new E(10,10)).setRelativeTransform(new oe(1,0,0,0,1,0)),Lr(f,"B",C.GREEN,1,new E(10,10)).setRelativeTransform(new oe(1,0,10,0,1,30)),f.setSize(new E(20,40));let A=da(u,"G");A.setTestOnlyFillPaints(h),Lr(A,"A",C.RED,1,new E(10,10)).setRelativeTransform(new oe(1,0,0,0,1,0)),Lr(A,"B",C.GREEN,1,new E(10,10)).setRelativeTransform(new oe(1,0,20,0,1,30)),A.setSize(new E(30,40))}),s("transition between symbols with new frame properties",c,(p,u)=>{p.setType("SYMBOL"),p.setContainerSupportsFillStrokeAndCorners(!0),p.setTestOnlyFillPaints(p.fillPaints()),u.setType("SYMBOL"),u.setContainerSupportsFillStrokeAndCorners(!0),u.setTestOnlyFillPaints([se.createSolid(C.RED,1)])}),s("Smart animate frames with reverse z-index",["SMART_ANIMATE"],(p,u)=>{let h=f=>{f.setStackReverseZIndex(!0),f.setStackMode("HORIZONTAL");let _=zt(f,"A",C.RED,.5);_.setSize(new E(20,20)),_.setRelativeTransform(new oe(1,0,0,0,1,0));let m=zt(f,"B",C.BLUE,.5);m.setSize(new E(20,20)),m.setRelativeTransform(new oe(1,0,10,0,1,0))};h(p),h(u)})})}r.testMagicMove=t;function n(){let o=AssertLib.deepEqual;beforeEach(()=>{X.setViewerMode(X.ViewerMode.PROTOTYPE)}),Qt("Drag vector computation:",()=>{we("Smart animate drag - matched object with translation",()=>{e([(a,s,l,d)=>{let c=he(l,"rect");c.setRelativeTransform(new oe(1,0,30,0,1,50)),he(d,"rect").setRelativeTransform(new oe(1,0,130,0,1,250));let u=Hn(c,d,"DRAG","SMART_ANIMATE","NAVIGATE"),h=_n.computeDragVector1(c,u,l,a.prototypeStructure(),a.prototypeState());o(h,new E(100,200))}])}),we("Smart animate drag - matched object with translation, rotation, and resizing",()=>{e([(a,s,l,d)=>{let c=he(l,"rect");c.setSize(new E(100,100)),c.setRelativeTransform(oe.new2().translatedBy1(c.size().negative().divide(2)));let p=he(d,"rect");p.setSize(new E(200,100));let u=oe.new2().translatedBy1(p.size().negative().divide(2));u.postRotate(Math.PI/2),u.postTranslate(new E(100,200)),p.setRelativeTransform(u);let h=Hn(c,d,"DRAG","SMART_ANIMATE","NAVIGATE"),f=_n.computeDragVector1(c,h,l,a.prototypeStructure(),a.prototypeState());o(f,new E(100,200))}])}),we("Smart animate drag - no matches",()=>{e([(a,s,l,d)=>{let c=he(l,"rect");c.setRelativeTransform(new oe(1,0,30,0,1,50));let p=Hn(c,d,"DRAG","SMART_ANIMATE","NAVIGATE"),u=_n.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());o(u,null)}])}),we("Smart animate drag - overlay swap with matched object with translation",()=>{e([(a,s,l,d)=>{let c=s.root().childAt1(0),p=dt(c,"overlayA"),u=dt(c,"overlayB"),h=he(p,"rect");h.setRelativeTransform(new oe(1,0,30,0,1,50)),he(u,"rect").setRelativeTransform(new oe(1,0,130,0,1,250));let _=Hn(h,u,"DRAG","SMART_ANIMATE","SWAP");Hn(l,p,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let m=_n.computeDragVector1(h,_,l,a.prototypeStructure(),a.prototypeState());o(m,new E(100,200))}])}),we("Smart animate drag - overlay swap with no matches",()=>{e([(a,s,l,d)=>{let c=s.root().childAt1(0),p=dt(c,"overlayA"),u=dt(c,"overlayB"),h=he(p,"rect");h.setRelativeTransform(new oe(1,0,30,0,1,50));let f=Hn(h,u,"DRAG","SMART_ANIMATE","SWAP");Hn(l,p,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let _=_n.computeDragVector1(h,f,l,a.prototypeStructure(),a.prototypeState());o(_,null)}])}),we("Move in smart animate drag - matched object with translation",()=>{e([(a,s,l,d)=>{let c=he(l,"rect");c.setRelativeTransform(new oe(1,0,30,0,1,50)),he(d,"rect").setRelativeTransform(new oe(1,0,130,0,1,250));let u=rp(c,d,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),h=_n.computeDragVector1(c,u,l,a.prototypeStructure(),a.prototypeState());o(h,new E(100,200))}])}),we("Move in smart animate drag - no matches",()=>{e([(a,s,l,d)=>{let c=he(l,"rect");c.setRelativeTransform(new oe(1,0,30,0,1,50));let p=rp(c,d,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),u=Rn.get("MOVE_FROM_LEFT").enteringFrameTransition(),h=d.size().multiply1(u.to().translation1().subtract1(u.from().translation1())),f=_n.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());o(f,h)}])}),we("Screen swipe drag - nested node move in transition",()=>{e([(a,s,l,d)=>{let c=he(l,"rect");c.setRelativeTransform(new oe(1,0,30,0,1,50));let p=Hn(c,d,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),u=Rn.get("MOVE_FROM_LEFT").enteringFrameTransition(),h=d.size().multiply1(u.to().translation1().subtract1(u.from().translation1())),f=_n.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());o(f,h)}])}),we("Screen swipe drag - nested node move out transition",()=>{e([(a,s,l,d)=>{let c=he(l,"rect");c.setRelativeTransform(new oe(1,0,30,0,1,50));let p=Hn(c,d,"DRAG","MOVE_OUT_TO_LEFT","NAVIGATE"),u=Rn.get("MOVE_OUT_TO_LEFT").exitingFrameTransition(),h=l.size().multiply1(u.to().translation1().subtract1(u.from().translation1())),f=_n.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());o(f,h)}])}),we("Screen swipe drag - TLF move in transition",()=>{e([(a,s,l,d)=>{let c=Hn(l,d,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),p=Rn.get("MOVE_FROM_LEFT").enteringFrameTransition(),u=d.size().multiply1(p.to().translation1().subtract1(p.from().translation1())),h=_n.computeDragVector1(l,c,l,a.prototypeStructure(),a.prototypeState());o(h,u)}])}),we("Back screen swipe drag - TLF was opened by move in",()=>{e([(a,s,l,d)=>{Hn(l,d,"ON_CLICK","MOVE_FROM_LEFT","NAVIGATE"),op(d),ip(d,"DRAG");let c=l.prototypeInteractions()[0],p=c.action().value;a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays1(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().navigateToFrameAndCloseOverlays3(p.transitionNodeID(),a.baseScreenNode(),1,0,4,c,p),a.prototypeState().commitStateChange();let u=Rn.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),h=d.size().multiply1(u.to().translation1().subtract1(u.from().translation1())),f=d.prototypeInteractions()[0],_=_n.computeDragVector1(d,f,d,a.prototypeStructure(),a.prototypeState());o(_,h)}])}),we("Overlay swipe drag - overlay move in transition",()=>{e([(a,s,l,d)=>{Hn(l,d,"DRAG","MOVE_FROM_LEFT","OVERLAY"),d.setSize(new E(250,250)),d.setOverlayPositionType("TOP_LEFT");let c=_n.computeDragVector1(l,l.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());o(c,new E(d.size().x(),0))}])}),we("Overlay swipe drag - overlay move in transition with nested source",()=>{e([(a,s,l,d)=>{let c=he(l,"rect"),p=Hn(c,d,"DRAG","MOVE_FROM_LEFT","OVERLAY");d.setSize(new E(250,250)),d.setOverlayPositionType("TOP_LEFT");let u=_n.computeDragVector1(c,p,l,a.prototypeStructure(),a.prototypeState());o(u,new E(d.size().x(),0))}])}),we("Close overlay swipe drag - overlay opened by move in",()=>{e([(a,s,l,d)=>{let c=s.root().childAt1(0),p=dt(c,"overlayA");p.setSize(new E(250,250)),p.setOverlayPositionType("TOP_LEFT");let u=he(p,"rect");u.setRelativeTransform(new oe(1,0,30,0,1,50)),Hn(l,p,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY"),Eg(u),ip(u,"DRAG"),a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays1(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().overlayFrame(p.id(),l,0,0,l.prototypeInteractions()[0],null),a.prototypeState().commitStateChange();let h=Rn.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),f=p.size().multiply1(h.to().translation1().subtract1(h.from().translation1())),_=_n.computeDragVector1(u,u.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());o(_,f)}])}),we("Overlay go back swipe drag - no back frame",()=>{e([(a,s,l,d)=>{d.setSize(new E(250,250)),d.setOverlayPositionType("TOP_LEFT"),Hn(l,d,"DRAG","MOVE_FROM_LEFT","OVERLAY"),op(d),ip(d,"DRAG"),a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays1(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().overlayFrame(d.id(),l,0,0,l.prototypeInteractions()[0],null),a.prototypeState().commitStateChange();let c=_n.computeDragVector1(d,d.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());o(c,null)}])}),we("Drag - invalid navigate transition",()=>{e([(a,s,l,d)=>{Hn(l,d,"DRAG","DISSOLVE","NAVIGATE");let c=_n.computeDragVector1(l,null,l,a.prototypeStructure(),a.prototypeState());o(c,null)}])})}),Qt("Drag progress measurement:",()=>{let a=null;beforeEach(()=>{a=new Ta,Qe.dangerouslyPushMockTime(a)}),afterEach(()=>{Qe.popMockTime()}),we("Simple drag velocity and progress measurement",()=>{e([(s,l,d,c)=>{let u=AssertLib,h=(O,w,P)=>u(Math.abs(P-w)<=1e-14,`Expected velocity at timestep ${O} to equal ${w}, got ${P}`);s.prototypeState().setIsDragging(!0);let f=new _n(null,new E(1,0),null,null);f.handleDragStart(new E(0,0)),f.handleDrag(new E(0,0));let _=f.onTickProgress();o(_,0),a.advanceSeconds(1),f.handleDrag(new E(.5,0));let m=f.onTickProgress();o(m,.5);let A=f.signedDragSpeed();h(1,.5,A),a.advanceSeconds(.5),f.handleDrag(new E(1,0));let y=f.onTickProgress();o(y,1);let S=f.signedDragSpeed();h(2,1,S),a.advanceSeconds(1);let g=f.onTickProgress();o(g,1);let b=f.signedDragSpeed();h(3,0,b),a.advanceSeconds(.1),f.handleDrag(new E(.5,0));let T=f.onTickProgress();o(T,.5);let I=f.signedDragSpeed();h(4,-5,I)}])}),we("Different-direction drag velocity and progress measurement",()=>{e([(s,l,d,c)=>{let u=AssertLib,h=(T,I,O)=>u(Math.abs(O-I)<=1e-14,`Expected velocity at timestep ${T} to equal ${I}, got ${O}`);s.prototypeState().setIsDragging(!0);let f=new _n(null,new E(1,0),null,null);f.handleDragStart(new E(0,0)),f.handleDrag(new E(0,0));let _=f.onTickProgress();o(_,0),a.advanceSeconds(1),f.handleDrag(new E(0,.5));let m=f.onTickProgress();o(m,0);let A=f.signedDragSpeed();h(1,0,A),a.advanceSeconds(1),f.handleDrag(new E(-.5,0));let y=f.onTickProgress();o(y,0);let S=f.signedDragSpeed();h(2,-.5,S),a.advanceSeconds(1),f.handleDrag(new E(.5,1));let g=f.onTickProgress();o(g,.5);let b=f.signedDragSpeed();h(3,1,b)}])})})}r.testDragToAnimateBehavior=n})(e_||(e_={}));var t_;(f=>{function i(_,m){let A=new Yn("NONZERO",0,Rt.forCenterStrokeAroundRect(_,m),_);return new Dn([A],null,A.bounds(),null)}f.strokeGeometryForRect=i;function e(_,m){if(Math.abs(C.redF(_)-C.redF(m))+Math.abs(C.greenF(_)-C.greenF(m))+Math.abs(C.blueF(_)-C.blueF(m))+Math.abs(C.alphaF(_)-C.alphaF(m))>.01)throw new Error(`Colors are too different ${C.toString(_)} ${C.toString(m)}`)}f.assertColorRoughlyEquals=e;function t(_,m,A){let y=vb(_);return y.setTestOnlyFillPaints([se.createSolid(C.BLACK,A)]),y.setTestOnlyFillGeometry(Nb(m)),je(y,y.fillGeometry().bounds.topLeft(),y.fillGeometry().bounds.size()),y}f.createStaticVectorWithMultipleRegions=t;function n(_,m,A,y){_.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),h.GeometryType_hasFill(m)&&_.setTestOnlyFillGeometry(ii(A)),h.GeometryType_hasStroke(m)&&(_.setTestOnlyStrokeGeometry(i(A,y)),_.setStrokeWeight(y)),je(_,A.topLeft(),A.size())}f.addPaintsAndGeometry=n;function r(_,m,A,y){let S=Mr(_);return n(S,m,A,y),S}f.createRectangleWithPaintsAndGeometry1=r;function o(_,m,A){return r(_,m,A,1)}f.createRectangleWithPaintsAndGeometry2=o;function a(_,m,A,y,S){let g=Eb(_,m);return n(g,A,y,S),g}f.createRoundedRectangleWithPaintsAndGeometry1=a;function s(_,m,A,y){return a(_,m,A,y,1)}f.createRoundedRectangleWithPaintsAndGeometry2=s;function l(_,m){let A=Mr(_);A.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]);let y=m.topLeft().x(),S=m.topLeft().y(),g=m.width(),b=m.height(),T=new Yn("NONZERO",0,Rt.new2().moveTo1(y,S).lineTo(y+g,S).lineTo(y+g,S+b).lineTo(y,S+b-1).close(),m),I=new Dn([T],null,T.bounds(),null);return A.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),A.setTestOnlyFillGeometry(I),A.setTestOnlyStrokeGeometry(I),je(A,m.topLeft(),m.size()),A}f.createNonRectangleInNode=l;function d(_,m,A){let y=_.canvasSpaceBoundingBox();switch(A){case"INSIDE":case"OUTSIDE":{_.setTestOnlyStrokeGeometry(i(y,m*2));break}case"CENTER":{_.setTestOnlyStrokeGeometry(i(y,m));break}}_.setStrokeAlign(A)}f.setStrokeForRect=d;function c(){let _=AssertLib.deepStrictEqual,m=new Ka("./src/test/rendertree.test.sk");Qt("generateRenderTree",()=>{let A=null,y=null,S=()=>{A=It.createSceneWithCanvasForTests1(),y=A.root().childAt1(0),y.setPrototypeDevice(er.DEFAULT)};beforeEach(S),Ie("simple rect",()=>{let g=o(y,0,new U(0,0,100,100));return m.asyncAssertMatchesSnapshot("should emit single fill",g.renderTree1().debugString1())}),Ie("simple rounded rect",()=>{let g=s(y,10,0,new U(0,0,100,100));return m.asyncAssertMatchesSnapshot("should emit single rounded rect fill",g.renderTree1().debugString1())}),Ie("rounded rect symbol",()=>{let g=gi(y);return n(g,0,new U(0,0,100,100),0),g.setContainerSupportsFillStrokeAndCorners(!0),g.setIsFrameMaskDisabled(!0),g.setCornerRadius(10),m.asyncAssertMatchesSnapshot("symbol should emit rounded rect fill",g.renderTree1().debugString1())}),Ie("rounded rect instance",()=>{let g=gi(y),b=Da(y,g);return n(b,0,new U(0,0,100,100),0),b.setContainerSupportsFillStrokeAndCorners(!0),b.setIsFrameMaskDisabled(!0),b.setCornerRadius(10),m.asyncAssertMatchesSnapshot("instance should emit rounded rect fill",b.renderTree1().debugString1())}),Vs("simple vector with multiple regions",()=>{let g=[],b=t(y,[new U(0,0,10,10),new U(20,20,10,10)],.5);g.push(m.asyncAssertMatchesSnapshot("should emit single fill",b.renderTree1().debugString1()));let T=t(y,[new U(0,0,10,10),new U(5,5,10,10)],.5);return g.push(m.asyncAssertMatchesSnapshot("should emit multiple fills",T.renderTree1().debugString1())),Promise.all(g)}),Ie("multiply blend mode",()=>{let g=o(y,0,new U(0,0,100,100));return g.setBlendMode("MULTIPLY"),m.asyncAssertMatchesSnapshot("should emit fill with blend mode",g.renderTree1().debugString1())}),Ie("foreground blur",()=>{let g=o(y,0,new U(0,0,100,100));return g.setTestOnlyEffects([Fe.createForegroundBlur(4)].slice()),m.asyncAssertMatchesSnapshot("should emit foreground blur",g.renderTree1().debugString1())}),Ie("foreground blur w/ radius zero",()=>{let g=o(y,0,new U(0,0,100,100));return g.setTestOnlyEffects([Fe.createForegroundBlur(0)].slice()),m.asyncAssertMatchesSnapshot("blur should be ellided",g.renderTree1().debugString1())}),Ie("foreground blur disabled",()=>{let g=o(y,0,new U(0,0,100,100)),b=Fe.createForegroundBlur(4);return b.setIsEnabled(!1),g.setTestOnlyEffects([b].slice()),m.asyncAssertMatchesSnapshot("blur should be ellided",g.renderTree1().debugString1())}),Ie("background blur",()=>{o(y,0,new U(25,25,50,50)).setTestOnlyFillPaints([se.createSolid(C.RED,1)]);let b=o(y,0,new U(0,0,100,100));return b.setTestOnlyEffects([Fe.createBackgroundBlur(4)].slice()),m.asyncAssertMatchesSnapshot("blur should be ellided because rect with blur is opaque",b.renderTree1().debugString1())}),Ie("background blur on partially transparent node",()=>{let g=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(g),o(y,0,new U(25,25,50,50)).setTestOnlyFillPaints([se.createSolid(C.RED,1)]);let T=o(y,0,new U(0,0,100,100));return T.setTestOnlyFillPaints([se.createSolid(C.BLACK,.5)]),T.setTestOnlyEffects([Fe.createBackgroundBlur(4)].slice()),m.asyncAssertMatchesSnapshot("background blur should be emitted",T.renderTree1().debugString1())}),Ie("rectangle won't show up in the background blur",()=>{let g=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(g),o(y,0,new U(0,0,10,10)).setTestOnlyFillPaints([se.createSolid(C.RED,1)]);let T=ut(y);T.setTestOnlyFillPaints([se.createSolid(C.BLACK,.5)]),je(T,new E(0,0),new E(10,10));let I=o(T,0,new U(0,0,10,10));return I.setTestOnlyFillPaints([se.createSolid(C.GREEN,.5)]),I.setTestOnlyEffects([Fe.createBackgroundBlur(4)].slice()),m.asyncAssertMatchesSnapshot("red rectangle should not show up in the background blur",T.renderTree1().debugString1())}),Qt("scrolling frames",()=>{Ie("wrap scrollable layers in a volatile property binding",()=>{let g=ut(y);return g.setOverflowDirection("VERTICAL"),je(g,new E(0,0),new E(100,100)),o(g,0,new U(0,0,100,200)).setTestOnlyFillPaints([se.createSolid(C.RED,1)]),m.asyncAssertMatchesSnapshot("red fill should be in volatile property binding",g.renderTree1().debugString1())}),Ie("wrap scrollable layers with non-isolated blends with a group",()=>{let g=ut(y);g.setOverflowDirection("VERTICAL"),je(g,new E(0,0),new E(100,100));let b=o(g,0,new U(0,0,100,200));b.setBlendMode("MULTIPLY"),b.setTestOnlyFillPaints([se.createSolid(C.RED,1)]);let T=g.renderTree1();return m.asyncAssertMatchesSnapshot("red rectangle should be wrapped with a group",T.debugString1())}),Vs("fixed layers and their descendants should be re-positioned",()=>{let g=[];y.setPrototypeDevice(new er("CUSTOM",new E(100,100),"","NONE"));let b=ut(y);je(b,new E(0,0),new E(100,500));let T=ut(b);return T.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),T.setVerticalConstraint("MAX"),je(T,new E(0,400),new E(100,100)),o(T,0,new U(0,0,100,100)).setTestOnlyFillPaints([se.createSolid(C.RED,1)]),g.push(m.asyncAssertMatchesSnapshot("Red square should NOT be culled because the screen is 100 x 500",b.renderTree1().debugString1())),g.push(m.asyncAssertMatchesSnapshot("Red square should NOT be culled even though the screen is 100 x 100 because it is a fixed footer that was repositioned to be in in the screen",b.renderTreeForBaseScreen1().debugString1())),T.setScrollBehavior("SCROLLS"),g.push(m.asyncAssertMatchesSnapshot("Red square SHOULD be culled because the screen is 100 x 100 and the footer is not fixed",b.renderTreeForBaseScreen1().debugString1())),Promise.all(g)}),Ie("do not wrap fixed layers in a volatile property binding",()=>{let g=ut(y);g.setOverflowDirection("VERTICAL"),je(g,new E(0,0),new E(100,100));let b=ut(g);return b.setTestOnlyFillPaints([se.createSolid(C.GREEN,1)]),b.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),o(g,0,new U(0,50,100,150)).setTestOnlyFillPaints([se.createSolid(C.RED,1)]),m.asyncAssertMatchesSnapshot("red fill should be in volatile property binding; green fill should not",g.renderTree1().debugString1())}),Ie("Background blur trees should not cull scrollable content",()=>{let g=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(g);let b=ut(y);b.setOverflowDirection("VERTICAL"),je(b,new E(0,0),new E(100,100)),b.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]);let T=o(b,0,new U(0,150,100,100));je(T,new E(150,0),new E(100,101)),T.setTestOnlyFillPaints([se.createSolid(C.GREEN,1)]);let I=o(b,0,new U(0,0,100,100));return I.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),je(I,new E(0,0),new E(100,100)),I.setTestOnlyFillPaints([se.createSolid(C.RED,.5)]),I.setTestOnlyEffects([Fe.createBackgroundBlur(4)].slice()),m.asyncAssertMatchesSnapshot("blur node should contain green fill",b.renderTree1().optimized().debugString1())}),["FRAME","GROUP"].forEach(g=>{Ie(`Background blur inside ${g} in scrolling content should contain transformed scrolling siblings`,()=>{let b=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(b);let T=ut(y);T.setOverflowDirection("VERTICAL"),je(T,new E(0,0),new E(100,100)),T.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]);let I=g=="FRAME"?ut(T):mi(T),O=o(I,0,new U(0,0,100,101));je(O,new E(0,0),new E(100,101)),O.setTestOnlyFillPaints([se.createSolid(C.GREEN,1)]);let w=o(I,0,new U(0,0,100,100));return je(w,new E(0,0),new E(100,100)),w.setTestOnlyFillPaints([se.createSolid(C.RED,.5)]),w.setTestOnlyEffects([Fe.createBackgroundBlur(4)].slice()),je(I,new E(0,0),new E(100,101)),m.asyncAssertMatchesSnapshot("blur node should contain transformed green fill",T.renderTree1().optimized().debugString1())})}),Ie("calling .renderTree on a frame should NOT make it scrollable by default",()=>{y.setCurrentViewportSize(new E(100,50));let g=ut(y);return je(g,new E(0,0),new E(100,100)),o(g,0,new U(0,0,100,100)).setTestOnlyFillPaints([se.createSolid(C.RED,1)]),m.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should NOT be present",g.renderTree1().debugString1())}),Ie("calling .renderTreeForBaseScreen on a frame should make it scrollable by default",()=>{y.setCurrentViewportSize(new E(100,50));let g=ut(y);return je(g,new E(0,0),new E(100,100)),o(g,0,new U(0,0,100,100)).setTestOnlyFillPaints([se.createSolid(C.RED,1)]),m.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should be present",g.renderTreeForBaseScreen1().debugString1())})}),Ie("drop shadow",()=>{let g=o(y,0,new U(0,0,100,100));return g.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),g.setTestOnlyEffects([Fe.createDropShadow1(4,new E(0,0),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("drop shadow should be emitted",g.renderTree1().debugString1())}),Ie("two drop shadows",()=>{let g=o(y,0,new U(0,0,100,100));return g.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),g.setTestOnlyEffects([Fe.createDropShadow1(0,new E(50,50),C.RED,1),Fe.createDropShadow1(0,new E(-50,-50),C.GREEN,1)].slice()),m.asyncAssertMatchesSnapshot("two drop shadows should be emitted",g.renderTree1().debugString1())}),Ie("drop shadow on semi-transparent layer",()=>{let g=o(y,0,new U(0,0,100,100));return g.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),g.setTestOnlyEffects([Fe.createDropShadow1(4,new E(0,0),C.BLACK,.25)].slice()),g.setOpacity(.5),m.asyncAssertMatchesSnapshot("should be wrapped in blend with 0.5 opacity",g.renderTree1().debugString1())}),Ie("drop shadow on clipping frame with visible background paints",()=>{let g=ut(y);je(g,new E(-100,-100),new E(300,300));let b=ut(g);return je(b,new E(0,0),new E(200,200)),b.setTestOnlyFillPaints([se.createSolid(C.RED,1)]),o(b,0,new U(0,0,100,100)).setTestOnlyFillPaints([se.createSolid(C.GREEN,1)]),b.setTestOnlyEffects([Fe.createDropShadow1(4,new E(0,0),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("shadow tree does not contain rect fill",b.renderTree1().debugString1())}),Ie("drop shadow on non-clipping frame with visible background paints",()=>{let g=ut(y);je(g,new E(-100,-100),new E(300,300));let b=ut(g);return je(b,new E(0,0),new E(200,200)),b.setTestOnlyFillPaints([se.createSolid(C.RED,1)]),b.setIsFrameMaskDisabled(!0),o(b,0,new U(0,0,100,100)).setTestOnlyFillPaints([se.createSolid(C.GREEN,1)]),b.setTestOnlyEffects([Fe.createDropShadow1(4,new E(0,0),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill",b.renderTree1().debugString1())}),Ie("drop shadow on clipping frame with no background paints",()=>{let g=ut(y);je(g,new E(-100,-100),new E(300,300));let b=ut(g);return je(b,new E(0,0),new E(200,200)),b.setTestOnlyFillPaints([]),o(b,0,new U(0,0,100,100)).setTestOnlyFillPaints([se.createSolid(C.GREEN,1)]),b.setTestOnlyEffects([Fe.createDropShadow1(4,new E(0,0),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",b.renderTree1().debugString1())}),Ie("drop shadow on clipping frame with no visible background paints",()=>{let g=ut(y);je(g,new E(-100,-100),new E(300,300));let b=ut(g);return je(b,new E(0,0),new E(200,200)),b.setTestOnlyFillPaints([se.createSolid(C.RED,0)]),o(b,0,new U(0,0,100,100)).setTestOnlyFillPaints([se.createSolid(C.GREEN,1)]),b.setTestOnlyEffects([Fe.createDropShadow1(4,new E(0,0),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",b.renderTree1().debugString1())}),Ie("drop shadow on clipping frame with visible background paint with transparent area",()=>{let g=se.createLinearGradient([new at(C.new3(0,0,0,1),0),new at(C.new3(0,0,0,0),.5)]),b=ut(y);je(b,new E(-100,-100),new E(300,300));let T=ut(b);return je(T,new E(0,0),new E(200,200)),T.setTestOnlyFillPaints([g]),o(T,0,new U(0,0,100,100)).setTestOnlyFillPaints([se.createSolid(C.GREEN,1)]),T.setTestOnlyEffects([Fe.createDropShadow1(4,new E(0,0),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("shadow tree should contain frame background and rect",T.renderTree1().debugString1())}),Ie("drop shadow on clipping frame with inside stroke",()=>{let g=ut(y);je(g,new E(-100,-100),new E(300,300));let b=Cs(g,"frame",[se.createSolid(C.RED,1)],[se.createSolid(C.BLACK,1)],new U(0,0,50,50));return je(b,new E(0,0),new E(50,50)),b.setStrokeAlign("INSIDE"),b.setStrokeWeight(4),l(b,new U(0,0,100,100)),b.setTestOnlyEffects([Fe.createDropShadow1(4,new E(0,0),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("drop shadow should not be clipped by frame mask",b.renderTree1().debugString1())}),Ie("drop shadow on rounded rectangle clipping frame with inside stroke",()=>{let g=ut(y);je(g,new E(-100,-100),new E(300,300));let b=Cs(g,"frame",[se.createSolid(C.RED,1)],[se.createSolid(C.WHITE,1)],new U(0,0,50,50));return je(b,new E(0,0),new E(50,50)),b.setStrokeAlign("INSIDE"),b.setStrokeWeight(4),b.setCornerRadius(10),b.setTestOnlyFillGeometry(Cb(b.canvasSpaceBoundingBox(),10)),b.setTestOnlyEffects([Fe.createDropShadow1(4,new E(0,0),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("drop shadow should be a rounded rect",b.renderTree1().debugString1())}),Ie("drop shadow and inner shadow on clipping frame with inside stroke",()=>{let g=ut(y);je(g,new E(-100,-100),new E(300,300));let b=Cs(g,"frame",[se.createSolid(C.RED,1)],[se.createSolid(C.BLACK,1)],new U(0,0,50,50));return je(b,new E(0,0),new E(50,50)),b.setTestOnlyFillPaints([se.createSolid(C.WHITE,1)]),b.setStrokeAlign("INSIDE"),b.setTestOnlyStrokePaints([se.createSolid(C.RED,1)]),b.setStrokeWeight(4),l(b,new U(0,0,100,100)),b.setTestOnlyEffects([Fe.createInnerShadow(4,new E(0,0),C.BLACK,.25),Fe.createDropShadow1(4,new E(0,0),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("inner shadow should be clipped by frame mask",b.renderTree1().debugString1())}),Ie("spread shadow for eligible frame",()=>{let g=ut(y);je(g,new E(0,0),new E(300,300));let b=So(g,"frame",se.createSolid(C.RED,1));return je(b,new E(0,0),new E(50,50)),b.setTestOnlyEffects([Fe.createDropShadow2(0,new E(0,0),C.BLACK,.25,10)].slice()),m.asyncAssertMatchesSnapshot("should generate shadow with spread for eligible frame: max bounds",`${b.renderTree1().maxBounds}
`)}),Ie("no spread shadow for frame with no visible fill paints",()=>{let g=So(y,"frame",se.createSolid(C.RED,0));return je(g,new E(0,0),new E(50,50)),o(g,0,new U(0,0,100,100)).setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),g.setTestOnlyEffects([Fe.createDropShadow2(0,new E(0,0),C.BLACK,.25,10)].slice()),m.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no visible fill: max bounds",`${g.renderTree1().maxBounds}
`)}),Ie("no spread shadow for frame that does not clip",()=>{let g=ut(y);je(g,new E(0,0),new E(300,300));let b=So(g,"frame",se.createSolid(C.RED,1));return je(b,new E(0,0),new E(50,50)),b.setIsFrameMaskDisabled(!0),b.setTestOnlyEffects([Fe.createDropShadow2(0,new E(0,0),C.BLACK,.25,10)].slice()),m.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no clipping: max bounds",`${b.renderTree1().maxBounds}
`)}),Ie("drop shadow with knockout: translucent node",()=>{let g=o(y,0,new U(0,0,100,100));return g.setTestOnlyFillPaints([se.createSolid(C.RED,.5)]),g.setTestOnlyEffects([Fe.createDropShadow3(10,new E(10,0),C.BLACK,.25,5,!1)].slice()),m.asyncAssertMatchesSnapshot("should generate knockout shadow for regular translucent node",g.renderTree1().debugString1())}),Ie("drop shadow with knockout: opaque node",()=>{let g=o(y,0,new U(0,0,100,100));return g.setTestOnlyFillPaints([se.createSolid(C.RED,1)]),g.setTestOnlyEffects([Fe.createDropShadow3(10,new E(10,0),C.BLACK,.25,5,!1)].slice()),m.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque node",g.renderTree1().debugString1())}),Ie("drop shadow with knockout: opaque frame",()=>{let g=ut(y);je(g,new E(-100,-100),new E(300,300));let b=So(g,"frame",se.createSolid(C.RED,1));return je(b,new E(0,0),new E(50,50)),b.setIsFrameMaskDisabled(!0),b.setTestOnlyEffects([Fe.createDropShadow3(10,new E(10,0),C.BLACK,.25,20,!1)].slice()),m.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque frame",b.renderTree1().debugString1())}),Ie("drop shadow with knockout: node with gradient transparency",()=>{let g=o(y,0,new U(0,0,100,100)),b=se.createLinearGradient([new at(C.new3(0,0,0,1),0),new at(C.new3(0,0,0,0),.3),new at(C.new3(0,0,0,0),.7),new at(C.new3(0,0,0,1),.7)]);return g.setTestOnlyFillPaints([b]),g.setTestOnlyEffects([Fe.createDropShadow3(10,new E(10,0),C.BLACK,.25,5,!1)].slice()),m.asyncAssertMatchesSnapshot("should knockout gradient with transparency",g.renderTree1().debugString1())}),Ie("drop shadow with knockout: with effect blend mode",()=>{let g=o(y,0,new U(0,0,100,100));g.setTestOnlyFillPaints([se.createSolid(C.RED,.5)]);let b=Fe.createDropShadow3(0,new E(10,0),C.BLACK,.25,5,!1);return b.setBlendMode("DIFFERENCE"),g.setTestOnlyEffects([b].slice()),m.asyncAssertMatchesSnapshot("should generate blend for knockout shadow",g.renderTree1().debugString1())}),Ie("drop shadow with knockout: with an inner shadow",()=>{let g=o(y,0,new U(0,0,100,100));return g.setTestOnlyFillPaints([se.createSolid(C.RED,.5)]),g.setTestOnlyEffects([Fe.createDropShadow3(10,new E(10,0),C.BLACK,.25,5,!1),Fe.createInnerShadow(4,new E(5,5),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("should generate knockout shadow and inner shadow",g.renderTree1().debugString1())}),Ie("drop shadow with knockout: with fill/stroke blend modes",()=>{let g=o(y,0,new U(0,0,100,100)),b=se.createSolid(C.RED,.5);b.setBlendMode("HARD_LIGHT"),g.setTestOnlyFillPaints([b]);let T=se.createSolid(C.BLUE,.5);return T.setBlendMode("SOFT_LIGHT"),g.setTestOnlyStrokePaints([T]),g.setStrokeWeight(5),g.setStrokeAlign("OUTSIDE"),g.setTestOnlyEffects([Fe.createDropShadow3(10,new E(10,0),C.BLACK,.25,5,!1)].slice()),m.asyncAssertMatchesSnapshot("should generate fills/strokes with effects correctly (should not nest blends into knockout shadow mask alpha)",g.renderTree1().debugString1())}),Ie("drop shadow with knockout: should not render knockout shadow inside bg blur",()=>{let g=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(g);let b=So(y,"frame",se.createSolid(C.RED,1));je(b,new E(0,0),new E(50,50));let T=o(y,0,new U(0,0,100,100));return T.setTestOnlyFillPaints([se.createSolid(C.RED,.5)]),T.setTestOnlyEffects([Fe.createDropShadow3(10,new E(10,0),C.BLACK,.25,5,!1),Fe.createBackgroundBlur(10)].slice()),m.asyncAssertMatchesSnapshot("should not render knockout shadow inside bg blur",T.renderTree1().debugString1())}),Ie("drop shadow with knockout: with drop shadow that does not overlap node at all",()=>{let g=o(y,0,new U(0,0,100,100));return g.setTestOnlyFillPaints([se.createSolid(C.RED,.5)]),g.setTestOnlyEffects([Fe.createDropShadow3(10,new E(200,0),C.BLACK,.25,5,!1)].slice()),m.asyncAssertMatchesSnapshot("should optimize but not cull knockout shadow that does not overlap node",g.renderTree1().debugString1())}),Ie("drop shadow with knockout: transparent frame with stroke should have no shadows inside",()=>{let g=ut(y);je(g,new E(-100,-100),new E(300,300));let b=Cs(g,"frame",[se.createSolid(C.RED,0)],[se.createSolid(C.BLACK,1)],new U(0,0,50,50));return je(b,new E(0,0),new E(50,50)),b.setTestOnlyEffects([Fe.createDropShadow3(10,new E(10,0),C.BLACK,1,5,!1)].slice()),m.asyncAssertMatchesSnapshot("should generate knockout shadow for transparent node",b.renderTree1().debugString1())}),Ie("inner shadow",()=>{let g=o(y,0,new U(0,0,100,100));return g.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),g.setTestOnlyEffects([Fe.createInnerShadow(4,new E(0,0),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("should output inner shadow",g.renderTree1().debugString1())}),Ie("two inner shadows",()=>{let g=o(y,0,new U(0,0,100,100));return g.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),g.setTestOnlyEffects([Fe.createInnerShadow(0,new E(50,50),C.RED,1),Fe.createInnerShadow(0,new E(-50,-50),C.GREEN,1)].slice()),m.asyncAssertMatchesSnapshot("should output two inner shadows",g.renderTree1().debugString1())}),Ie("inner shadow w/ zero blur radius",()=>{let g=o(y,0,new U(0,0,100,100));return g.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),g.setTestOnlyEffects([Fe.createInnerShadow(0,new E(0,4),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("should NOT output inner shadow",g.renderTree1().debugString1())}),Ie("inner shadow, with outside stroke (mask.alpha HARD_MASK_WITH_COLOR inlines into shader)",()=>{let g=o(y,1,new U(0,0,100,100));return g.setStrokeAlign("OUTSIDE"),g.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),g.setTestOnlyStrokePaints([se.createSolid(C.WHITE,1)]),g.setTestOnlyEffects([Fe.createInnerShadow(1,new E(0,4),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("should have mask without hard mask alpha",g.renderTree1().debugString1())}),Ie("semi-transparent rect",()=>{let g=o(y,0,new U(0,0,100,100));return g.setTestOnlyFillPaints([se.createSolid(C.BLACK,.5)]),g.setOpacity(.5),m.asyncAssertMatchesSnapshot("opacity should be baked into fill paint",g.renderTree1().debugString1())}),Ie("simple rect with stroke",()=>{let g=o(y,1,new U(0,0,100,100));return g.setStrokeAlign("INSIDE"),g.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),g.setTestOnlyStrokePaints([se.createSolid(C.WHITE,1)]),m.asyncAssertMatchesSnapshot("should output FillStroke",g.renderTree1().debugString1())}),Ie("rect with stroke and disabled fill should NOT render fill",()=>{let g=o(y,1,new U(0,0,100,100));g.setStrokeAlign("INSIDE");let b=se.createSolid(C.BLACK,1);return b.setIsEnabled(!1),g.setTestOnlyFillPaints([b]),g.setTestOnlyStrokePaints([se.createSolid(C.WHITE,1)]),m.asyncAssertMatchesSnapshot("FILL_STROKE should NOT have black fill",g.renderTree1().debugString1())}),Ie("background blur with no background",()=>{let g=Object({viewer_background_blur_opts:!0});X.updateFeatureFlags(g);let b=So(y,"frame",se.createSolid(C.RED,.5));return je(b,new E(0,0),new E(100,100)),b.setTestOnlyEffects([Fe.createBackgroundBlur(10)].slice()),m.asyncAssertMatchesSnapshot("should not generate a background blur subtree",b.renderTree1().debugString1())}),Ie("background blur with no scrolling elements",()=>{let g=Object({viewer_background_blur_opts:!0});X.updateFeatureFlags(g);let b=So(y,"frame",se.createSolid(C.RED,1));je(b,new E(0,0),new E(100,100));let T=o(y,0,new U(0,0,50,50));return T.setTestOnlyFillPaints([se.createSolid(C.RED,.5)]),T.setTestOnlyEffects([Fe.createBackgroundBlur(10)].slice()),m.asyncAssertMatchesSnapshot("should not include an INVERSE_TRANSFORM node",T.renderTree1().debugString1())}),Ie("background blur with scroll: foreground and background in clipping frame",()=>{let g=Object({viewer_background_blur_opts:!0});X.updateFeatureFlags(g);let b=So(y,"frame",se.createSolid(C.RED,1));je(b,new E(0,0),new E(100,100)),b.setOverflowDirection("VERTICAL");let T=So(b,"container",se.createSolid(C.WHITE,1));je(T,new E(0,0),new E(100,500));let I=o(T,0,new U(0,0,50,50));return I.setTestOnlyFillPaints([se.createSolid(C.RED,.5)]),I.setTestOnlyEffects([Fe.createBackgroundBlur(10)].slice()),m.asyncAssertMatchesSnapshot("background blur should not include INVERSE_TRANSFORM or scrolling TRANSFORM nodes",I.renderTree1().debugString1())}),Qt("simple stroke-only rect",()=>{let g=null;beforeEach(()=>{S(),g=o(y,1,new U(0,0,100,100)),g.setTestOnlyFillPaints(Oe.EMPTY),g.setTestOnlyStrokePaints([se.createSolid(C.WHITE,1)])}),Ie("inside stroke",()=>(d(g,1,"INSIDE"),m.asyncAssertMatchesSnapshot("should output FillStroke with mode .INSIDE",g.renderTree1().debugString1()))),Ie("outside stroke",()=>(d(g,1,"OUTSIDE"),m.asyncAssertMatchesSnapshot("should output FillStroke with mode .OUTSIDE",g.renderTree1().debugString1()))),Ie("center stroke",()=>(d(g,1,"CENTER"),m.asyncAssertMatchesSnapshot("should output FillStroke with mode .CENTER",g.renderTree1().debugString1())))}),Qt("Simple tests on non-rects",()=>{Ie("simple non-rectangle",()=>{let g=l(y,new U(0,0,100,100));return m.asyncAssertMatchesSnapshot("should be single fill without isRect flag",g.renderTree1().debugString1())}),Ie("non-rectangle not clipped by frame",()=>{let g=ut(y);return je(g,new E(0,0),new E(100,100)),g.setTestOnlyFillPaints([se.createSolid(C.WHITE,1)]),l(g,new U(0,0,99,99)),m.asyncAssertMatchesSnapshot("group with two fills (frame background and non-rect layer)",g.renderTree1().debugString1())}),Ie("non-rectangle clipped by frame",()=>{let g=ut(y);return je(g,new E(0,0),new E(50,50)),g.setTestOnlyFillPaints([se.createSolid(C.WHITE,1)]),l(g,new U(0,0,100,100)),m.asyncAssertMatchesSnapshot("clipping should not be optimized",g.renderTree1().debugString1())})}),Ie("grouped single node",()=>{let g=mi(y);Ma(g,!1),je(g,new E(0,0),new E(100,100));let b=o(g,0,new U(0,0,100,100));return b.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),m.asyncAssertMatchesSnapshot("group should be ellided since it does not affect rendering",b.renderTree1().debugString1())}),Ie("nested groups",()=>{let g=mi(y);Ma(g,!1),je(g,new E(0,0),new E(100,100));let b=mi(g);Ma(b,!1),je(b,new E(0,0),new E(50,50)),o(b,0,new U(0,0,50,50)).setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]);let I=mi(g);return Ma(I,!1),je(I,new E(50,50),new E(50,50)),o(I,0,new U(0,0,50,50)).setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),m.asyncAssertMatchesSnapshot("render tree should contain only 1 group since groups do not affect rendering",g.renderTree1().debugString1())}),Ie("flatten nested opacities",()=>{let g=mi(y);je(g,new E(0,0),new E(100,100)),g.setOpacity(.8);let b=mi(g);je(b,new E(0,0),new E(50,50)),b.setOpacity(.5);let T=o(b,0,new U(0,0,50,50));T.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),T.setOpacity(.5);let I=mi(g);je(I,new E(50,50),new E(50,50)),I.setOpacity(.25);let O=o(I,0,new U(0,0,50,50));return O.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]),O.setOpacity(.1),m.asyncAssertMatchesSnapshot("opacities for ellided groups should be applied to leaves",g.renderTree1().debugString1())}),Qt("node outside bounds of frame",()=>{let g=null;beforeEach(()=>{S(),g=ut(y),g.setTestOnlyFillPaints([se.createSolid(C.WHITE,1)]),je(g,new E(0,0),new E(100,100)),o(g,0,new U(110,110,100,100)).setTestOnlyFillPaints([se.createSolid(C.BLACK,1)])}),Ie("without frame clipping",()=>(g.setIsFrameMaskDisabled(!0),m.asyncAssertMatchesSnapshot("there should be two fills; one for the non-clipped rect",g.renderTree1().debugString1()))),Ie("with frame clipping",()=>(g.setIsFrameMaskDisabled(!1),m.asyncAssertMatchesSnapshot("there should be on fill; rect was clipped",g.renderTree1().debugString1()))),we("with frame clipping and no background color",()=>{g.setIsFrameMaskDisabled(!1),Ma(g,!1),_(g.renderTree1(),null)})}),Qt("frame background",()=>{let g=null;beforeEach(()=>{S(),g=ut(y),g.setTestOnlyFillPaints([se.createSolid(C.WHITE,1)]),Ma(g,!0),je(g,new E(0,0),new E(100,100))}),Ie("with solid paint",()=>(g.setTestOnlyFillPaints([se.createSolid(C.new3(1,.5,0,1),1)]),m.asyncAssertMatchesSnapshot("frame background fill should be present",y.renderTree1().debugString1()))),Ie("with solid paint and blend mode",()=>{let b=se.createSolid(C.new3(1,.5,0,1),1);return b.setBlendMode("MULTIPLY"),g.setTestOnlyFillPaints([b]),m.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",y.renderTree1().debugString1())}),Ie("with solid paint and blended gradient",()=>{let b=se.createSolid(C.new3(1,.5,0,1),1),T=se.createLinearGradient([new at(C.new3(1,.5,0,1),.25),new at(C.new3(0,.5,1,1),.75)]);return T.setBlendMode("MULTIPLY"),g.setTestOnlyFillPaints([b,T]),m.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",y.renderTree1().debugString1())}),Ie("with solid paint and blend mode and children",()=>{let b=se.createSolid(C.new3(1,.5,0,1),1);return b.setBlendMode("MULTIPLY"),g.setTestOnlyFillPaints([b]),o(g,0,new U(0,0,100,100)).setTestOnlyFillPaints([se.createSolid(C.BLACK,.5)]),m.asyncAssertMatchesSnapshot("should output background and children",y.renderTree1().debugString1())}),Ie("with drop shadow and opaque fill",()=>(g.setTestOnlyEffects([Fe.createDropShadow1(4,new E(0,0),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("should not output a drop shadow",g.renderTree1().debugString1()))),Ie("with drop shadow and no opaque fill",()=>(g.setTestOnlyFillPaints([se.createSolid(C.WHITE,.5)]),g.setTestOnlyEffects([Fe.createDropShadow1(4,new E(0,0),C.BLACK,.25)].slice()),m.asyncAssertMatchesSnapshot("should output a drop shadow",g.renderTree1().debugString1())))}),Qt("frame fills for containers supporting fill stroke and corners",()=>{let g=null;beforeEach(()=>{S(),g=ut(y),g.setContainerSupportsFillStrokeAndCorners(!0),g.setTestOnlyFillPaints([se.createSolid(C.WHITE,1)]),je(g,new E(0,0),new E(100,100))}),Ie("with solid paint",()=>(g.setTestOnlyFillPaints([se.createSolid(C.new3(1,.5,0,1),1)]),m.asyncAssertMatchesSnapshot("frame background fill should be present",y.renderTree1().debugString1()))),Ie("with solid paint and blend mode",()=>{let b=se.createSolid(C.new3(1,.5,0,1),1);return b.setBlendMode("MULTIPLY"),g.setTestOnlyFillPaints([b]),m.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",y.renderTree1().debugString1())}),Ie("with solid paint and blended gradient",()=>{let b=se.createSolid(C.new3(1,.5,0,1),1),T=se.createLinearGradient([new at(C.new3(1,.5,0,1),.25),new at(C.new3(0,.5,1,1),.75)]);return T.setBlendMode("MULTIPLY"),g.setTestOnlyFillPaints([b,T]),m.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",y.renderTree1().debugString1())}),Ie("with solid paint and blend mode and children",()=>{let b=se.createSolid(C.new3(1,.5,0,1),1);return b.setBlendMode("MULTIPLY"),g.setTestOnlyFillPaints([b]),o(g,0,new U(0,0,100,100)).setTestOnlyFillPaints([se.createSolid(C.BLACK,.5)]),m.asyncAssertMatchesSnapshot("should output background and children",y.renderTree1().debugString1())}),Ie("with inside stroke",()=>{let b=Cs(y,"frame",[se.createSolid(C.RED,1)],[se.createSolid(C.BLACK,1)],new U(0,0,50,50));return je(b,new E(0,0),new E(50,50)),b.setContainerSupportsFillStrokeAndCorners(!0),b.setStrokeAlign("INSIDE"),b.setStrokeWeight(4),l(b,new U(0,0,100,100)),m.asyncAssertMatchesSnapshot("should generate a fill render node that is clipped by the frame mask",y.renderTree1().debugString1())}),Ie("with outside stroke",()=>{let b=Cs(y,"frame",[se.createSolid(C.RED,1)],[se.createSolid(C.BLACK,1)],new U(0,0,50,50));return je(b,new E(0,0),new E(50,50)),b.setContainerSupportsFillStrokeAndCorners(!0),je(b,new E(0,0),new E(50,50)),b.setStrokeAlign("OUTSIDE"),b.setStrokeWeight(4),l(b,new U(0,0,100,100)),m.asyncAssertMatchesSnapshot("should have stroke on top of mask",y.renderTree1().debugString1())})}),Qt("masks",()=>{Ie("blend mode of masked content should mark mask and all ancestors as 'hasBlends'",()=>{let g=Object({rounded_mask_optimization:!0,viewer_perf_h2_2023_holdout:!1,viewer_perf_h2_2023_combined:!1});X.updateFeatureFlags(g);let b=ut(y);return b.setIsBackgroundEnabled(!1),b.setIsFrameMaskDisabled(!0),o(b,0,new U(0,0,10,10)).setIsMask(!0),o(b,0,new U(0,0,100,100)).setBlendMode("MULTIPLY"),m.asyncAssertMatchesSnapshot("all ancestors of rect should have 'hasBlends' flag",y.renderTree1().debugString1())}),Ie("small outside strokes should be masked",()=>{let g=Object({rounded_mask_optimization:!0,viewer_perf_h2_2023_holdout:!1,viewer_perf_h2_2023_combined:!1});X.updateFeatureFlags(g);let b=ut(y);b.setIsBackgroundEnabled(!1),b.setIsFrameMaskDisabled(!0),o(b,0,new U(0,0,100,100)).setIsMask(!0);let I=r(b,1,new U(0,0,100,100),2);return I.setStrokeAlign("OUTSIDE"),I.setTestOnlyFillPaints([se.createSolid(C.WHITE,1)]),I.setTestOnlyStrokePaints([se.createSolid(C.BLACK,1)]),m.asyncAssertMatchesSnapshot("optimized RenderTree should mask rect with outside stroke",y.renderTree1().optimized().debugString1())}),Ie("mask should be ignored if color is contained within the alpha",()=>{let g=Object({rounded_mask_optimization:!0,viewer_perf_h2_2023_holdout:!1,viewer_perf_h2_2023_combined:!1});X.updateFeatureFlags(g);let b=ut(y);return b.setIsBackgroundEnabled(!1),b.setIsFrameMaskDisabled(!0),s(b,50,0,new U(0,0,100,100)).setIsMask(!0),s(b,10,0,new U(40,40,20,20)).setTestOnlyFillPaints([se.createSolid(C.WHITE,1)]),m.asyncAssertMatchesSnapshot("optimized RenderTree should ignore mask as contained",y.renderTree1().optimized().debugString1())}),Ie("mask should not ignored if color is not contained within the alpha",()=>{let g=Object({rounded_mask_optimization:!0,viewer_perf_h2_2023_holdout:!1,viewer_perf_h2_2023_combined:!1});X.updateFeatureFlags(g);let b=ut(y);return b.setIsBackgroundEnabled(!1),b.setIsFrameMaskDisabled(!0),s(b,50,0,new U(0,0,100,100)).setIsMask(!0),s(b,32,0,new U(12,12,76,76)).setTestOnlyFillPaints([se.createSolid(C.WHITE,1)]),m.asyncAssertMatchesSnapshot("optimized RenderTree should have a mask if alpha does not contain color",y.renderTree1().optimized().debugString1())}),Ie("mask should be ignored if color contained within the a rounded rectangular alpha",()=>{let g=Object({rounded_mask_optimization:!0,viewer_perf_h2_2023_holdout:!1,viewer_perf_h2_2023_combined:!1});X.updateFeatureFlags(g);let b=ut(y);return b.setIsBackgroundEnabled(!1),b.setIsFrameMaskDisabled(!0),s(b,27,0,new U(0,0,100,100)).setIsMask(!0),s(b,32,0,new U(12,12,76,76)).setTestOnlyFillPaints([se.createSolid(C.WHITE,1)]),m.asyncAssertMatchesSnapshot("optimized RenderTree should not contain a mask if color is contained within a rounded rectangular alpha",y.renderTree1().optimized().debugString1())})}),Qt("rectangle visibility",()=>{let g=null;beforeEach(()=>{S(),g=o(y,0,new U(0,0,100,100)),g.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)])}),Ie("default visible",()=>m.asyncAssertMatchesSnapshot("should output single fill",g.renderTree1().debugString1())),we("visibility false",()=>{g.setVisible(!1),_(g.renderTree1(),null)}),we("layer opacity zero",()=>{g.setOpacity(0),_(g.renderTree1(),null)}),we("fill paint opacity zero",()=>{g.setTestOnlyFillPaints([se.createSolid(C.BLACK,0)]),_(g.renderTree1(),null)}),we("no paints",()=>{g.setTestOnlyFillPaints(Oe.EMPTY),_(g.renderTree1(),null)}),we("no fill paint, stroke paints, zero stroke width",()=>{let T=r(y,1,new U(0,0,100,100),0);T.setTestOnlyFillPaints(Oe.EMPTY),T.setTestOnlyStrokePaints([se.createSolid(C.TRANSPARENT,0)]),_(T.renderTree1(),null)})}),Qt("solid paints",()=>{let g=null;beforeEach(()=>{S(),g=o(y,0,new U(0,0,100,100))}),Ie("normal",()=>(g.setTestOnlyFillPaints([se.createSolid(C.new3(1,.5,0,1),1)]),m.asyncAssertMatchesSnapshot("should output fill with opacity=1",g.renderTree1().debugString1()))),Ie("50% opacity",()=>(g.setTestOnlyFillPaints([se.createSolid(C.new3(1,.5,0,1),.5)]),m.asyncAssertMatchesSnapshot("should output fill with opacity=0.5",g.renderTree1().debugString1()))),we("0% opacity",()=>{g.setTestOnlyFillPaints([se.createSolid(C.new3(1,.5,0,1),0)]),_(g.renderTree1(),null)}),we("disabled",()=>{let b=se.createSolid(C.new3(1,.5,0,1),1);b.setIsEnabled(!1),g.setTestOnlyFillPaints([b]),_(g.renderTree1(),null)}),Ie("multiply blend",()=>{let b=se.createSolid(C.new3(1,.5,0,1),1);return b.setBlendMode("MULTIPLY"),g.setTestOnlyFillPaints([b]),m.asyncAssertMatchesSnapshot("should output Blend with Fill child",g.renderTree1().debugString1())})}),Qt("gradient paints",()=>{let g=null;beforeEach(()=>{S(),g=o(y,0,new U(0,0,100,100))}),Ie("linear",()=>{let b=se.createLinearGradient([new at(C.new3(1,.5,0,1),.25),new at(C.new3(0,.5,1,1),.75)]);return g.setTestOnlyFillPaints([b]),m.asyncAssertMatchesSnapshot("should output Fill with linear gradient paint",g.renderTree1().debugString1())}),Ie("radial",()=>{let b=se.createRadialGradient([new at(C.new3(1,.5,0,1),.25),new at(C.new3(0,.5,1,1),.75)]);return g.setTestOnlyFillPaints([b]),m.asyncAssertMatchesSnapshot("should output Fill with radial gradient paint",g.renderTree1().debugString1())}),Ie("angular",()=>{let b=se.createAngularGradient([new at(C.new3(1,.5,0,1),.25),new at(C.new3(0,.5,1,1),.75)]);return g.setTestOnlyFillPaints([b]),m.asyncAssertMatchesSnapshot("should output Fill with angular gradient paint",g.renderTree1().debugString1())}),Ie("diamond",()=>{let b=se.createDiamondGradient([new at(C.new3(1,.5,0,1),.25),new at(C.new3(0,.5,1,1),.75)]);return g.setTestOnlyFillPaints([b]),m.asyncAssertMatchesSnapshot("should output Fill with diamond gradient paint",g.renderTree1().debugString1())}),Ie("50% opacity",()=>{let b=se.createLinearGradient([new at(C.new3(1,.5,0,1),.25),new at(C.new3(0,.5,1,1),.75)]);return b.setOpacity(.5),g.setTestOnlyFillPaints([b]),m.asyncAssertMatchesSnapshot("should output linear gradient with 50% opacity",g.renderTree1().debugString1())}),we("0% opacity",()=>{let b=se.createLinearGradient([new at(C.new3(1,.5,0,1),.25),new at(C.new3(0,.5,1,1),.75)]);b.setOpacity(0),g.setTestOnlyFillPaints([b]),_(g.renderTree1(),null)}),we("disabled",()=>{let b=se.createLinearGradient([new at(C.new3(1,.5,0,1),.25),new at(C.new3(0,.5,1,1),.75)]);b.setIsEnabled(!1),g.setTestOnlyFillPaints([b]),_(g.renderTree1(),null)}),Ie("40% stop opacity",()=>{let b=se.createLinearGradient([new at(C.new3(1,.5,0,.4),.25),new at(C.new3(0,.5,1,.6),.75)]);return g.setTestOnlyFillPaints([b]),m.asyncAssertMatchesSnapshot("should output linear gradient with partial opacity stops",g.renderTree1().debugString1())}),we("0% stop opacity",()=>{let b=se.createLinearGradient([new at(C.new3(1,.5,0,0),.25),new at(C.new3(0,.5,1,0),.75)]);g.setTestOnlyFillPaints([b]),_(g.renderTree1(),null)}),Ie("transform",()=>{let b=se.createLinearGradient([new at(C.new3(1,.5,0,1),.25),new at(C.new3(0,.5,1,1),.75)]);b.setTransform1(new oe(.5,-.5,1,-1,1.5,-1.5)),g.setTestOnlyFillPaints([b]);let T=g.renderTree1();_(T.op(),3);let O=T.geometry.paints;return _(O,g.fillPaints()),m.asyncAssertMatchesSnapshot("should output linear gradient",g.renderTree1().debugString1())})}),Ie("geometry",()=>{let g=Dr(y,"VECTOR");g.setTestOnlyFillPaints([se.createSolid(C.BLACK,1)]);let b=new U(0,0,100,100),T=new Yn("ODD",0,Rt.new2().moveTo1(0,0).lineTo(100,0).lineTo(50,100).close(),b),I=new Yn("NONZERO",0,Rt.new2().moveTo1(0,100).lineTo(100,100).lineTo(50,0).close(),b);g.setTestOnlyFillGeometry(new Dn([T,I],null,b,null));let O=g.renderTree1();_(O.op(),1);let w=O;return _(w.children.length,2),_(w.children[0].op(),3),_(w.children[1].op(),3),_(w.children[0].geometry.path().windingRule(),"ODD"),_(w.children[1].geometry.path().windingRule(),"NONZERO"),m.asyncAssertMatchesSnapshot("should output a group with two fills",g.renderTree1().debugString1())})}),Qt("RenderTree optimization of PaintData",()=>{we("dual-color gradient",()=>{let A=[se.createLinearGradient([new at(C.new3(0,.5,1,1),0),new at(C.new3(1,.5,0,1),1)])],y=Oe.optimize(A);_(y.length,1),_(y[0].type(),"GRADIENT_LINEAR")}),we("dual-opacity gradient",()=>{let A=[se.createLinearGradient([new at(C.new3(1,.5,0,0),0),new at(C.new3(1,.5,0,1),1)])],y=Oe.optimize(A);_(y.length,1),_(y[0].type(),"GRADIENT_LINEAR")}),we("single-color gradient",()=>{let A=[se.createLinearGradient([new at(C.new3(1,.5,0,1),0),new at(C.new3(1,.5,0,1),1)])],y=Oe.optimize(A);_(y.length,1),_(y[0].type(),"SOLID")}),we("solid underneath dual-color gradient",()=>{let A=[se.createSolid(C.GREEN,1),se.createLinearGradient([new at(C.new3(0,0,1,.5),0),new at(C.new3(1,0,0,.5),1)])],y=Oe.optimize(A);_(y.length,1),_(y[0].type(),"GRADIENT_LINEAR"),y[0].asSinglePaint()!=null;let S=y[0].asSinglePaint().colorStops()[0],g=y[0].asSinglePaint().colorStops()[1];_(S.position,0),e(S.color,C.new3(0,.5,.5,1)),_(g.position,1),e(g.color,C.new3(.5,.5,0,1))}),we("solid underneath single-color gradient",()=>{let A=[se.createSolid(C.GREEN,1),se.createLinearGradient([new at(C.new3(1,0,0,.5),0),new at(C.new3(1,0,0,.5),1)])],y=Oe.optimize(A);_(y.length,1),_(y[0].type(),"SOLID"),e(y[0].asSinglePaint().color(),C.new3(.5,.5,0,1))})}),Qt("RenderTree.isRect",()=>{let A=S=>{_(new Lt(S,"ODD").isRect(),!0)},y=S=>{_(new Lt(S,"ODD").isRect(),!1)};we("RenderTree.isRect",()=>{A(Rt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5)),A(Rt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0)),A(Rt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),A(Rt.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).close()),A(Rt.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),y(Rt.new2().moveTo1(10,0).lineTo(10,5).lineTo(0,5)),y(Rt.new2().moveTo1(10,0).lineTo(0,0).lineTo(10,5).lineTo(0,5).close()),y(Rt.new2().quadraticTo(10,0,10,5).lineTo(0,5)),y(Rt.new2().lineTo(10,0).quadraticTo(10,5,0,5)),y(Rt.new2().cubicTo1(10,0,10,5,0,5));let g=It.createSceneWithCanvasForTests1().root().childAt1(0),b=o(g,0,new U(0,0,100,100));_(b.renderTree1()!=null,!0),_(b.renderTree1().isRectFill(),!0)})}),Qt("RenderTree optimization of Group nodes",()=>{let A=null;beforeEach(()=>{let y=new on(new Lt(Pt.fromRect(new U(0,0,1,1)),"ODD"),[se.createSolid(C.BLACK,1)]);A=new Kn(oe.new2(),y,E.new2())}),we("empty group",()=>{_(new ze([]).optimized(),null)}),we("empty nested group",()=>{_(new ze([new ze([])]).optimized(),null)}),Ie("single group",()=>m.asyncAssertMatchesSnapshot("should be fill only; no groups",new ze([A]).optimized().debugString1())),Ie("single nested group",()=>m.asyncAssertMatchesSnapshot("should be fill only; no groups",new ze([new ze([A])]).optimized().debugString1())),Ie("double group",()=>m.asyncAssertMatchesSnapshot("group with two fill children can't be optimized",new ze([A,A]).optimized().debugString1())),Ie("double nested group 1",()=>m.asyncAssertMatchesSnapshot("outer group should be optimized away, leaving a group with two fill children",new ze([new ze([A,A])]).optimized().debugString1())),Ie("double nested group 2",()=>m.asyncAssertMatchesSnapshot("inner groups should be optimized away, leaving a group with two fill children",new ze([new ze([A]),new ze([A])]).optimized().debugString1()))}),Qt("RenderTree optimization of Dissolve",()=>{let A=null,y=null,S=(g,b)=>new Ar(g,b,"A",()=>1).optimized();beforeEach(()=>{let g=new on(new Lt(Pt.fromRect(new U(0,0,1,1)),"ODD"),[se.createSolid(C.BLACK,1)]);A=new Kn(oe.new2(),g,E.new2());let b=new on(new Lt(Pt.fromRect(new U(0,0,1,1)),"ODD"),[se.createSolid(C.RED,1)]);y=new Kn(oe.new2(),b,E.new2())}),we("both subtrees null",()=>{_(S(null,null),null)}),Ie("old subtree null",()=>m.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because old subtree is null",S(null,A).debugString1())),Ie("new subtree null",()=>m.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because new subtree is null",S(A,null).debugString1())),Ie("identical subtrees",()=>m.asyncAssertMatchesSnapshot("dissolve should be optimized away entirely because subtrees are identical",S(A,A).debugString1())),Ie("different subtrees",()=>m.asyncAssertMatchesSnapshot("dissolve should not be optimized away",S(A,y).debugString1()))}),Qt("RenderTree optimization of Fill",()=>{we("fill with zero opacity paint",()=>{_(new Kn(oe.new2(),new on(new Lt(Pt.fromRect(new U(0,0,1,1)),"ODD"),[se.createSolid(C.BLACK,0)]),E.new2()).optimized(),null)}),we("fill with disabled paint",()=>{_(new Kn(oe.new2(),new on(new Lt(Pt.fromRect(new U(0,0,1,1)),"ODD"),[se.create("SOLID",1,"NORMAL",!1,C.BLACK)]),E.new2()).optimized(),null)}),we("fill with empty bounds",()=>{_(new Kn(oe.new2(),new on(new Lt(Pt.fromRect(new U(0,0,0,0)),"ODD"),[se.createSolid(C.BLACK,1)]),E.new2()).optimized(),null)})}),Qt("RenderTree optimization of Blur",()=>{let A=null;beforeEach(()=>{let y=new on(new Lt(Pt.fromRect(new U(0,0,1,1)),"ODD"),[se.createSolid(C.BLACK,1)]);A=new Kn(oe.new2(),y,E.new2())}),Ie("zero radius blur",()=>m.asyncAssertMatchesSnapshot("should contain no Blur node",new ro(0,A,U.INVALID).optimized().debugString1())),Ie("blur wrapping volatile fill",()=>m.asyncAssertMatchesSnapshot("volatile property binding should be OUTSIDE of blur",new ro(10,pt.forTranslation(A,Et.forAnimateableTranslation("x"),()=>E.new2()),U.INVALID).optimized().debugString1())),Ie("clamp blur wrapping volatile fill",()=>m.asyncAssertMatchesSnapshot("volatile property binding should be INSIDE of blur",new ro(10,pt.forTranslation(A,Et.forAnimateableTranslation("x"),()=>E.new2()),new U(0,0,1,1)).optimized().debugString1()))}),Qt("RenderTree optimization of HardMaskWithColor",()=>{let A=null;beforeEach(()=>{let y=new on(new Lt(Pt.fromRect(new U(0,0,1,1)),"ODD"),[se.createSolid(C.BLACK,1)]);A=new Kn(oe.new2(),y,E.new2())}),Ie("hard mask wrapping fill",()=>m.asyncAssertMatchesSnapshot("should be a single Fill",new bo(A,C.BLACK).optimized().debugString1())),Ie("hard mask wrapping volatile fill",()=>m.asyncAssertMatchesSnapshot("should be a single Fill wrapped by the VolatilePropertyBinding",new bo(pt.forTranslation(A,Et.forAnimateableTranslation("x"),()=>E.new2()),C.BLACK).optimized().debugString1())),Ie("hard mask wrapping blend nodes",()=>m.asyncAssertMatchesSnapshot("should be a single Fill",new bo(new oo("MULTIPLY",.5,A),C.BLACK).optimized().debugString1()))}),Qt("Stack reverse Z index",()=>{let A=null,y=null,S=()=>{A=It.createSceneWithCanvasForTests1(),y=A.root().childAt1(0),y.setPrototypeDevice(er.DEFAULT)};beforeEach(S),Ie("stacking frame without stackReverseZIndex",()=>{let g=dt(y,"f");return zt(g,"c1",C.RED,1),zt(g,"c2",C.BLUE,1),g.setStackMode("VERTICAL"),g.setStackReverseZIndex(!1),m.asyncAssertMatchesSnapshot("should have non-reversed children",g.renderTree1().debugString1())}),Ie("stacking frame with stackReverseZIndex",()=>{let g=dt(y,"f");return zt(g,"c1",C.RED,1),zt(g,"c2",C.BLUE,1),g.setStackMode("VERTICAL"),g.setStackReverseZIndex(!0),m.asyncAssertMatchesSnapshot("should have reversed children",g.renderTree1().debugString1())}),Ie("non-stacking frame without stackReverseZIndex",()=>{let g=dt(y,"f");return zt(g,"c1",C.RED,1),zt(g,"c2",C.BLUE,1),g.setStackMode("NONE"),g.setStackReverseZIndex(!1),m.asyncAssertMatchesSnapshot("should have non-reversed children",g.renderTree1().debugString1())}),Ie("non-stacking frame with stackReverseZIndex",()=>{let g=dt(y,"f");return zt(g,"c1",C.RED,1),zt(g,"c2",C.BLUE,1),g.setStackMode("NONE"),g.setStackReverseZIndex(!0),m.asyncAssertMatchesSnapshot("should have non-reversed children",g.renderTree1().debugString1())})})}f.testRenderTree=c;function p(){let _=AssertLib.deepStrictEqual;we("Reparenting a node should invalidate render trees on both its old and its new parent",()=>{let A=It.createSceneWithCanvasForTests1().root().childAt1(0),y=ut(A),S=ut(A),g=o(y,0,new U(0,0,100,100)),b=y.renderTree1(),T=S.renderTree1();_(b!=null,!0),_(T!=null,!0),g.setParentIndex(new qn(ne.invalid(),dn.fromString(""))),S.appendChild(g);let I=y.renderTree1(),O=S.renderTree1();_(I!=b,!0),_(O!=T,!0)})}f.testNodeRenderTree=p;let u;(A=>(A[A.FILL=0]="FILL",A[A.FILL_AND_STROKE=1]="FILL_AND_STROKE"))(u=f.GeometryType||(f.GeometryType={}));let h;(y=>{function _(S){return S==0||S==1}y.GeometryType_hasFill=_;function m(S){return S==1}y.GeometryType_hasStroke=m;function A(S){return u[S]}y.GeometryType_toString=A})(h=f.in_GeometryType||(f.in_GeometryType={}))})(t_||(t_={}));var nc=class{constructor(e,t,n){this.prototypeApp=e,this.skewKiwiSerialization=t,this.deprecatedJsSceneHooks=n}};var Uh=class{constructor(e){this._session=null,this._preservers=[],this._isReconnecting=!1,this._session=e,this._session.addObserver(this),this._preservers.push(new r_),this._preservers.push(new n_)}handleSceneChangedLoadingPhase(e,t){t==1?this.handleSceneWillRebuildAfterReconnect():e==1&&t==2&&this.handleSceneDidRebuildAfterReconnect()}handleSceneWillRebuildAfterReconnect(){if(this._session.scene()==null){Ke("Scene unexpectedly null in handleSceneWillRebuildAfterReconnect");return}this._isReconnecting=!0,this._preservers.forEach(e=>{e.reset()}),this._session.scene().each(e=>{this._preservers.forEach(t=>{t.saveDataFromOldSceneNode(e)})})}handleSceneDidRebuildAfterReconnect(){this._isReconnecting=!1,this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())}),this._preservers.forEach(e=>{e.reset()})}handleConnect(e,t){}handleDisconnect(){}handleJoinStart(e,t,n){}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){this._isReconnecting&&this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())})}handleSceneGraphReply(e,t){}},n_=class{constructor(){this._nodeDeveloperFriendlyIdToScrollOffset=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdToScrollOffset=new Map}saveDataFromOldSceneNode(e){e.scrollDirection()!="NONE"&&!e.scrollOffset().equals(ve.FrozenVector_ZERO)&&this._nodeDeveloperFriendlyIdToScrollOffset.set(e.developerFriendlyId(),e.scrollOffset())}restoreDataToNewScene(e){Le.StringMap_each(this._nodeDeveloperFriendlyIdToScrollOffset,(t,n)=>{let r=e.findNodeFromDeveloperFriendlyId(t);r!=null&&r.setScrollOffset(n)})}},r_=class{constructor(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=new Cr}saveDataFromOldSceneNode(e){e.usedAsBaseScreen()&&this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.add(e.developerFriendlyId())}restoreDataToNewScene(e){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.each(t=>{let n=e.findNodeFromDeveloperFriendlyId(t);n!=null&&n.setUsedAsBaseScreen(!0)})}};var Gh=class{constructor(e){this._scene=null,this.onChange=null,this._scene=e.scene(),e.addAppObserver(this)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._scene=t}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){(e.node.type()=="CANVAS"||e.node.type()=="DOCUMENT")&&this.onChange(this.pages())}pages(){let e=[];if(this._scene!=null&&this._scene.root()!=null)for(let t=0;t<this._scene.root().childCount();t=t+1){let n=this._scene.root().childAt1(t);n.type()=="CANVAS"&&!n.isInternalOnly()&&e.push({id:n.id(),name:n.name()})}return e}};var Iv=(n=>(n[n.NONE=0]="NONE",n[n.RECORD=1]="RECORD",n[n.PLAYBACK=2]="PLAYBACK",n))(Iv||{}),i_;(r=>{function i(){return r._instance}r.instance=i;function e(o,a){r._instance=new t(o,a)}r.create=e;class t extends dh{constructor(s,l){super(d=>{this._emitter.trigger("topLevelFrameChange",null)});this._dirtyNodes=null,this._emitter=null,this._scene=null,s.addFrameObserver(this),s.addAppObserver(this),s.prototypeState().addObserver(this),this._emitter=l,this._clearDirtySet()}_clearDirtySet(){this._dirtyNodes=new ta(s=>s)}handleSceneGraphEvent(s){switch(s.property){case 62:case 25:case 24:case 88:case 49:case 78:case 4:case 19:case 8:{this._dirtyNodes.add(s.node.id());break}}}handleSceneChange(s,l){s!=null&&s.removeObserver(this),l!=null&&l.addObserver(this)}handleActiveCanvasChange(s,l){}handleActivePrototypeStartingPointChange(s,l){}onFrame(){this._dirtyNodes.each(s=>{this._emitter.trigger("accessibilityNodeInvalidated",s)}),this._clearDirtySet()}}r._AccessibilityObserver=t,r._instance=null})(i_||(i_={}));var Sv;(e=>{function i(t){return Iv[t]}e.InteractionTestState_toString=i})(Sv||(Sv={}));function o_(i){return{x:i.x(),y:i.y(),width:i.width(),height:i.height()}}function yv(i){let e=i.state().getActiveCanvas();if(e==null)return null;let t=e.backgroundColor();return t==C.TRANSPARENT?null:C.asFloattoJSON(t)}function bv(i){if(i.state().scene()==null)return null;let t=i.state().getActiveCanvas();if(t==null)return null;let n=X.prototypeBackgroundColorOverride!=null?X.prototypeBackgroundColorOverride.value:t.prototypeBackgroundColor();return n==C.TRANSPARENT?null:C.asInttoJSON(n)}function bN(i){let e=[];for(let t of i)e.push(ne.fromString(t));return e}function TN(i){let e=window;e!==null&&e.addEventListener("message",t=>{let n=t.data,r=n.type,o=n.data;if(r==="NAVIGATE_TO_FRAME_IN_PROTOTYPE")if(!o.nodeId)Ke(`Expected nodeId to exist, received ${o.nodeId}.`);else{let a=ne.fromString(o.nodeId),s=ne.fromString(o.startingPointNodeId);s!=null?i.prototypeState().navigateToFrameAndCloseOverlays2(a,s):i.prototypeState().navigateToFrameAndCloseOverlays1(a)}})}function IN(i){return{trigger:i.event().interactionType(),to:i.action().value.connectionType(),type:i.action().value.navigationType()}}function vv(i){return t=>{let n=t.subtract1(i.canvasView().absoluteBounds().topLeft()),r=i.canvasView().canvasSpaceToWindowSpace().clone();return r.invert()?(r.transformPoint(n),n):null}}function Ev(i,e){e.window().setAfterNotify(t=>{let n=tc.serialize(t,i);n!==null&&$t.getEventEmitter().trigger("recordInteraction",n)})}function vN(i){let e=vv(i);Ev(e,i)}function EN(i){sa.detect(),wt.initialize(i),yn.initialize(),Gr.initialize(),X.initialize(i),be.schema=i.kiwiSchema,ks.initialize(i.statsigConfigCallback);let e=new ec(wt.getContainerElement(),X.gameControllerListener(),new oh,0),t=e.multiplayerSession(),n=e.multiplayerCoupler(),r=$t.getEventEmitter();new Uh(t);let o=new qd(e.state()),a=new Gh(e.state());TN(e.state()),fa.init(e.state(),e.canvasView());let s=null;X.getViewerMode()==X.ViewerMode.MIRROR&&(s=new Yd(e,t)),r.on("documentSyncingMessage",S=>{var g;Be.trackEventJSON1("Viewer Document Syncing Message",{...S,hasPendingMirrorSelectionChange:(g=s==null?void 0:s.hasPendingSelectionChange())!=null?g:!1,hasPendingPrototypeStateChange:e.state().prototypeState().hasRequestedStateChange()})});let l=i.deviceName;if(typeof l=="string"){if(["viewer","prototype","editor"].indexOf(l)==-1)throw new Error(`Invalid device name ${l}`);t.setRole(l)}r.on("sceneDidCompleteInitialLoad",S=>{let g=b=>{window.figmaPerfTesting&&window.postMessage({name:b,value:0},"*")};g("DOCUMENT_IS_LOADED"),e.canvasView().afterFrame=()=>{e.canvasView().afterFrame=null,g("AFTER_FIRST_RENDER"),r.trigger("documentIsLoaded",null)},e.canvasView().afterFirstRenderOfScreenStack=()=>{e.canvasView().afterFirstRenderOfScreenStack=null,g("AFTER_FIRST_RENDER_OF_TLF")}});let d=0,c=i.interactionTestState;if(typeof c!="string"||c==="NONE")d=0;else if(c==="RECORD")d=1;else if(c==="PLAYBACK")d=2,SS();else throw new Error(`Invalid interactionTestState ${c}`);let p=null,u=null,h=null,f=null;d!=0&&(p=S=>{let g=S.clone();return e.canvasView().canvasSpaceToWindowSpace().transformPoint(g),g.add1(e.canvasView().absoluteBounds().topLeft())},u=vv(e),h=S=>e.window().root().viewFromPoint(S),f=()=>e.window().focusedView()),d==1&&Ev(u,e),e.state().addActionObserver(new $t.ActionHandler);let _=new $t.AppHandler(e.state());e.state().addFrameObserver(_),i_.create(e.state(),r),rr.addUpdate(Jt.windowFrame(e.window().events()),S=>{t.maybeFlushNextUserChange(0)}),e.canvasView().onBaseScreenIdChanged=(S,g,b,T)=>{S!=null&&r.trigger("baseScreenChanged",{nodeId:S,userInitiated:g==1,updateURL:b,repairsInvalidState:T})},e.canvasView().disengageObservationMode=()=>{r.trigger("disengageObservationMode",{})},e.canvasView().viewportTracker().onChange=(S,g)=>{r.trigger("viewportChanged",{offset:{x:S.x(),y:S.y()},zoomScale:g})},e.canvasView().onResize=()=>{r.trigger("canvasResize",null)},e.canvasView().onURLClicked=(S,g)=>{r.trigger("urlClicked",{url:S,openInNewWindow:g})},e.canvasView().onNavigateToPrototype=(S,g)=>{r.trigger("navigateToPrototype",{fileKey:S,guid:g})},To.instance().startLibLoad=()=>{r.trigger("loadVideoJsLib",{})},a.onChange=S=>{r.trigger("pagesChange",S)},o.notifyCommentPositionsChange=()=>{r.trigger("watchedNodeBoundsChange",null)},new Qs(e.state(),64,S=>{let g="backgroundColorChange";r.trigger(g,yv(e))}),new Qs(e.state(),65,S=>{let g="prototypeBackgroundColorChange";r.trigger(g,bv(e))}),new Qs(e.state(),66,S=>{r.trigger("prototypeDeviceChanged",S!=null?$.asPrototypeDevice(S).toJSON():null)});let m=[],A={appState:()=>e.state(),multiplayer:()=>t,prototypeState:()=>e.state().prototypeState(),logAndGetDocument:()=>{var g;let S=(g=e.state().scene())==null?void 0:g.root();return S!=null?console.log(S.debugString()):console.log("Document root not found \u{1F630}"),S},logAndGetBaseScreen:()=>{let S=e.state().baseScreenNode();return S!=null?console.log(S.debugString()):console.log("Base screen not found \u{1F630}"),S},logAndGetNode:S=>{var b;let g=(b=e.state().scene())==null?void 0:b.findNode2(S);return g!=null?console.log(g.debugString()):console.log(`Node with id ${S!=null?S:"null"} not found!`),g},logAndGetNodeByStablePath:S=>{var b;let g=(b=e.state().scene())==null?void 0:b.findNode3(Mt.fromString(S));return g!=null?console.log(g.debugString()):console.log(`Node with stablePath ${S!=null?S:"null"} not found!`),g},logAndGetRenderTree:S=>{var b,T,I;let g=(b=e.state().scene())==null?void 0:b.findNode2(S);return g!=null?console.log((I=(T=g.renderTree1())==null?void 0:T.debugString1())!=null?I:"null"):console.log(`Node with id ${S!=null?S:"null"} not found!`),g.renderTree1()},logFakeError:S=>{Q_(S)},setDebugUserChanges:S=>{ma.debugUserChanges=S},fulfilledMultiplayerQueries:()=>t.fulfilledMultiplayerQueries(),ICSemanticStorageTrie:()=>{console.log(e.state().prototypeState().componentStateSyncer.debugString())},VideoSemanticStorageTrie:()=>{console.log(e.state().videoManager().runtimeStorage().toString1())}};X.getFeatureFlags().internalDebugTools&&(window.DebuggingHelpers=A);let y={setObservingSessionID:S=>{if(!ts(S))throw new Error("Missing sessionID");let g=S|0;g!=t.observingSessionID()&&(t.setObservingSessionID(g),n.setPreviewToObservedFrameOrOverlay(!1),n.performSetVariableActions(!0),n.performVideoStateChanges(!0),r.trigger("multiplayerUserInfoChange",n.userInfoJSON()),e.canvasView().viewport().invalidate())},nominatePresenter:S=>{if(!ts(S))throw new Error("Missing sessionID");t.nominatePresenter(S|0)},cancelPresenterNomination:S=>{if(!ts(S))throw new Error("Missing sessionID");t.cancelPresenterNomination(S|0)},startPresenting:()=>{t.startPresenting()},stopPresenting:()=>{t.stopPresenting()},setInteractiveSlideConfigData:(S,g,b)=>{t.setInteractiveSlideConfigData(S,g,b)},setInteractiveSlideParticipantData:(S,g,b)=>{t.setInteractiveSlideParticipantData(S,g,b)},adjustZoom:(S,g)=>{e.canvasView().viewport().adjustCameraZoom2(1,S,g)},setZoom:(S,g)=>{e.canvasView().viewport().setCameraZoom(1,S)},zoomToNode:(S,g)=>{var T;let b=(T=e.state().scene())==null?void 0:T.findNode1(ne.fromString(S));b!=null&&(e.state().setActiveCanvas(b.canvas()),e.canvasView().viewport().zoomToFit1(1,b.canvasSpaceBoundingBox(),g))},getZoomBounds:()=>({min:hi.ZOOM_MIN,max:hi.ZOOM_MAX}),setCanvasSpaceCenter:(S,g)=>{let b=new E(-1*S.x,-1*S.y);e.canvasView().viewport().setCameraOffset2(1,b,g)},setCanvasSpaceCenterWithScroll:S=>{var P;let g=new E(S.x,S.y),b=(P=e.state().baseScreenNode())==null?void 0:P.canvasSpaceBoundingBox();if(b==null)return;let T=Math.max(g.x()-b.x(),0),I=Math.max(g.y()-b.y(),0),O=Math.max(T-b.width()/2,0),w=Math.max(I-b.height()/2,0);if(T!=0||I!=0){let H=new E(O,w);e.canvasView().updateScrollOffsetForNode(e.state().prototypeState().getTopmostScreen(),H)}},setScrollPadding:S=>{e.canvasView().setScrollPadding(+S.left,+S.top,+S.right,+S.bottom)},setScrollToPan:S=>{X.setScrollToPan(S)},setDragToPan:S=>{X.setDragToPan(S)},injectVideoJsLib:S=>{To.instance().onLoadComplete(S)},connectTo:(S,g)=>{let b=new nc(lr.instance,Za.instance,lr.instance);g(b).then(T=>{let I=T.cppModules;e.state().setFontListPromise(T.fontListPromise),X.getFeatureFlags().internalDebugTools&&(A.fullscreen=I==null?void 0:I.sharedDebuggingHelpers,window.DebuggingHelpers=A);let O=S.fileKey,w=ne.fromString(S.nodeId);ne.isRoot(w)&&(w=null),X.getViewerMode()==X.ViewerMode.MIRROR&&s!=null?s.connectToFileAndShowNode(O,w,ne.fromString(S.startingPointNodeId),S.oauthToken,S.interactiveComponentsEnabled?0:1,!!S.renderDots,I):e.connectTo(O,w,ne.fromString(S.startingPointNodeId),S.oauthToken,S.interactiveComponentsEnabled?0:1,!!S.renderDots,I)})},openFileKey:()=>{var S;return(S=t.fileKey())!=null?S:e.state().currentFileKey()},isConnected:()=>t.isConnected(),hasActiveScene:()=>e.state().scene()!=null,unloadSceneForTesting:()=>{t.disconnect(),e.state().prototypeState().resetPrototype(),e.state().setScene(null)},disconnectForTesting:()=>{t.disconnect()},reconnectForTesting:()=>{t.attemptReconnect()},enforceValidPrototypeStateForTesting:()=>{e.state().prototypeState().enforceValidPrototypeStateForTesting()},deleteNodeForTesting:S=>{let g=e.state().scene();if(g==null)throw new Error("No current scene");g.removeNode(ne.fromString(S))},translateNodeForTesting:(S,g,b)=>{let T=e.state().scene();if(T==null)throw new Error("No current scene");let I=T.findNode2(S);if(I==null)throw new Error("Node not found");let O=I.relativeTransform().clone();O.translate2(g,b),I.setRelativeTransform(O)},addCanvasViewObserverForTesting:(S,g)=>{let b=new vh((T,I,O,w)=>{S()},T=>{g(T.scrollOffset().x(),T.scrollOffset().y())});m.push(b),e.canvasView().addObserver(b)},clearCanvasViewObserversForTesting:()=>{for(let S of m)e.canvasView().removeObserver(S);m=[]},sendMultiplayerNodeChangesForTesting:S=>{let g=e.state().scene();if(g==null)throw new Error("No current scene");let b=be.schema.encodeMessage(S);g.applyMessageToScene(b)},setMockEmbedListener:S=>{fa.setMockListener(S)},setMaximumDrawingBufferSizeForTesting:S=>{e.canvasView().setMaximumDrawingBufferSizeForTesting(S)},clearMaximumDrawingBufferSizeForTesting:()=>{e.canvasView().clearMaximumDrawingBufferSizeForTesting()},triggerResizeForTesting:()=>{e.canvasView().triggerResizeForTesting()},reset:()=>{e.state().prototypeState().resetState(),e.unloadSceneAndResetPrototypeLib()},loadFile:(S,g)=>{let b=new nc(lr.instance,Za.instance,lr.instance);g(b).then(T=>{let I=T.cppModules;e.state().setFontListPromise(T.fontListPromise),e.initializePrototypeLib(I),X.getFeatureFlags().internalDebugTools&&(A.fullscreen=I==null?void 0:I.debuggingHelpers,window.DebuggingHelpers=A);let O=S.bytes,w=ne.fromString(S.nodeId);ne.isRoot(w)&&(w=null);let P=S.startingPointNodeId,H=S.imagePrefixURL,re=S.videoPrefixURL,q=S.interactiveComponentsEnabled,W=S.renderDots;typeof H=="string"&&wt.setImagePrefixURL(H),typeof re=="string"&&wt.setVideoPrefixUrl(re),e.state().serialization().decodeSceneForViewerAndPrototypeLib2(O,q?0:1,"DUMMY_FILE_KEY").then(x=>{if(t.disconnect(),e.state().prototypeState().resetPrototype(),e.state().setScene(x),e.state().setRenderDots(!!W),e.canvasView().setBackgroundEnabled(!W),x.setAllTlfsLoaded(),X.getViewerMode()==X.ViewerMode.PROTOTYPE){let F=e.state().scene().findNode1(w);if(F==null){let M=e.state().scene().findNode1(ne.fromString(P));if(M!=null&&M.isTopLevel()&&hc(M)&&(F=M),F==null){let Q=e.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();Q.length>0&&(F=e.state().scene().findNode1(ne.fromString(Q[0])))}}e.state().setActivePrototypeStartingPointNodeId(ne.fromString(P));let k=e.state().prototypeStructure().nodeToRestartPrototypeOn(e.state().getActiveCanvas()),G=F==null?void 0:F.topLevelAncestor();if(G!=null)e.state().prototypeState().navigateToFrameAndCloseOverlays1(G.id());else if(k!=null)e.state().prototypeState().navigateToFrameAndCloseOverlays1(k.id());else if(!Ki)throw new Error("Calling loadFile in PROTOTYPE mode but with a file that isn't a valid prototype")}e.state().fontListPromise().then(F=>{r.trigger("sceneDidCompleteInitialLoad",null)})})})},navigateForward:()=>{e.canvasView().navigateForward(19)},navigateBackward:()=>{e.canvasView().navigateBackward(18)},navigateToFrameAndCloseOverlays:S=>{let g=ne.fromString(S);g!=null&&e.state().prototypeState().navigateToFrameAndCloseOverlays1(g)},restartPrototype:()=>{e.state().prototypeState().restartPrototype(1)},forceFrame:()=>{e.window().forceFrame!=null&&Uu(()=>{e.window().forceFrame()})},setScalingMode:S=>{if(typeof S!="string")throw new Error("Expected string");S=="free"&&console.warn("setScalingMode('free') called "),e.state().prototypeState().setFitModeFromParameter(S),e.state().prototypeState().getCurrentFitMode()==3&&e.canvasView().viewport().setCameraZoom(0,1)},setTransitionOnClick:S=>{e.state().prototypeState().setTransitionOnClick(S)},setShowHotspots:S=>{e.canvasView().setShowHotspots(S)},toggleInteractionRecording:S=>{S?vN(e):e.window().clearAfterNotify()},getBackgroundColor:()=>yv(e),getPrototypeBackgroundColor:()=>bv(e),getPrototypeStartNodeId:()=>{let S=null,g=e.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();return g.length>0&&(S=ne.fromString(g[0])),S==null||!ne.isValid(S)?null:S},getActivePrototypeStartingPointNodeId:()=>{let S=e.state().activePrototypeStartingPointNodeId();return S==null||!ne.isValid(S)?null:S},setActivePrototypeStartingPointNodeId:S=>{let g=ne.fromString(S);e.state().activePrototypeStartingPointNodeId()!=g&&e.state().setActivePrototypeStartingPointNodeId(g)},prototypeStartingPointsData:()=>{let S=e.state().prototypeStructure();return S==null?null:S.prototypeStartingPointsData()},getBaseScreenId:()=>e.state().baseScreenId(),getCurrentOverlayIdsForTesting:()=>e.state().prototypeState().getCurrentOverlayIds().map(S=>S),getOnscreenStatesForTesting:()=>e.state().prototypeState().getOnscreenStates().map(S=>({stablePath:S.a.guids.map(g=>g),stateId:S.b})),pageIdForNodeId:S=>{var T;let g=e.state().scene();if(g==null)return null;let b=g.findNode2(S);return(T=b==null?void 0:b.findContainingCanvasOrSelf())==null?void 0:T.id()},prototypeType:()=>{let S=e.state().prototypeStructure();return S==null||S.currentType()==1?"FRAME_LIST":"NONLINEAR"},requestPage:S=>{var I;let g,b=ne.fromString(S),T=(I=e.state().scene())==null?void 0:I.findNode1(b);T!=null&&T.type()=="CANVAS"&&e.state().requestSetActiveCanvas(T)},setCurrentPageId:S=>{var I;let g,b=ne.fromString(S),T=(I=e.state().scene())==null?void 0:I.findNode1(b);T!=null&&T.type()=="CANVAS"&&e.state().setActiveCanvas(T)},getCurrentPageId:()=>{var g;let S=e.state().getActiveCanvas();return(g=S==null?void 0:S.findContainingCanvasOrSelf())==null?void 0:g.id()},getNodesToShowInPrototype:()=>e.state().prototypeStructure().topLevelPrototypeNodesInOrder(),getStatsForAnalytics:()=>{let S=e.state().getActiveCanvas();if(S==null)throw new Error("Asking for stats without an active canvas");let g=S.prototypeDevice();return{pageId:S.id(),deviceType:g.type,presetIdentifier:g.presetIdentifier,graphicsCardName:e.canvasView().graphicsCardName(),isHardwareAccelerationDisabled:N.isUsingSoftwareRenderer(e.canvasView().getContext()),isHighDPR:X.isHighDPR(),fastImageDecode:jn.browserSupportsFastImageDecoding()}},getPrototypeDeviceType:()=>{let S=e.state().getActiveCanvas();return S==null?(Ke("Asking for prototype device type without a playback canvas"),"NONE"):S.prototypeDevice().type},getCurrentTlfBounds:()=>{var b;let S=(b=e.state().baseScreenNode())==null?void 0:b.canvasSpaceBoundingBox(),g=U.new2();return S==null?null:(S.transformInto2(g,e.canvasView().canvasSpaceToWindowSpace()),o_(g))},setUserDidAttemptZoom:S=>{e.canvasView().userDidAttemptZoom=g=>{S(Ch[g])}},getCanvasSpaceBoundsByNodeId:S=>{let g={},b=e.state().scene();if(b==null)throw new Error("No current scene");for(let T of S){let I=ne.fromString(T);if(I==null)continue;let O=b.findNode1(I);if(O==null)continue;let w=O.canvasSpaceBoundingBox();g[T]=new Map([["x",w.x()],["y",w.y()],["width",w.width()],["height",w.height()]])}return g},watchBoundsForNodes:S=>{let g=bN(S);o.setNodesWithComments(g)},getPrototypeStateCurrentIndex:()=>e.state().prototypeState().getCurrentBaseScreenIndex(),getNavigateForwardEnabled:()=>e.state().prototypeStructure().currentType()==1?e.state().prototypeState().getNextBaseScreenIdForFrameList()!=null:e.state().prototypeState().getNextBaseScreenIdForPrototype()!=null,getNavigateBackwardEnabled:()=>e.state().prototypeState().getPreviousBaseScreenId()!=null,getPages:()=>a.pages(),viewport:()=>{let S=e.canvasView().viewport(),g=S.offset(),b=S.zoomScale();return{offset:{x:g.x(),y:g.y()},zoomScale:b}},getStatsForDebugging:()=>Mn.getStatsForDebugging(),on:r.on,off:r.off,trigger:r.trigger,playbackInteraction:S=>{if(d==2){let g=tc.deserialize(S,h,f,p);e.window().notify(g)}},setNewContainerElement:S=>{e.window().setNewContainerElement(S)},canvasViewCursorForTesting:()=>Wc[e.canvasView().cursor()],lastTopLevelTransitionPropertiesForTesting:()=>{let S=e.state().prototypeState().lastInitiatedTopLevelStateChange();return S==null||S.transitionParameters==null?null:{type:S.transitionParameters.transitionType,durationSeconds:S.transitionParameters.transitionDuration}},lastICTransitionPropertiesForTesting:()=>{let S=e.state().prototypeState().lastInitiatedInstanceStateChange();return S==null||S.transitionParameters==null?null:{type:S.transitionParameters.transitionType,durationSeconds:S.transitionParameters.transitionDuration}},scrollOffsetForNodeInBaseScreenForTesting:S=>{let g=e.state().scene();if(g==null)return{};let b=g.findNode2(S);return b!=null?b.scrollOffset().toJSON():E.new2().toJSON()},scrollOffsetForNodeInOverlayAtForTesting:(S,g)=>{let b=e.state().scene();if(b==null)return{};let T=b.findNode2(S);return T!=null?T.scrollOffset().toJSON():E.new2().toJSON()},getCanvasSpaceCommentLocations:S=>{let g=e.state().scene();if(g==null)return{};let b=new Map;for(let T in S)b.set(T,Ks.fromJSON(S[T]));return o.getCanvasSpaceCommentLocations(g,b)},getCommentDestinationAtPosition:S=>{let g=new E(S.x,S.y),b=o.getCommentDestinationAtPosition(g);return b==null?null:b.toJSON()},onChange:S=>{var g;(g=e.state().scene())==null||g.onChange(S)},isWaitingForDeviceFrameToLoadForTesting:()=>{var g;let S=e.state().getActiveCanvas();return S==null?!1:(g=e.canvasView().deviceRenderer())==null?void 0:g.isWaitingForDeviceFrameToLoad(S.prototypeDevice())},prototypeViewHitTest:S=>{let g=new E(S.x,S.y),b=e.state().baseScreenNode();return b==null?{type:"NONE"}:e.canvasView().hitTestDeviceFrame(g)?{type:"DEVICE_FRAME"}:b.canvasSpaceBoundingBox().contains2(g)?{type:"CURRENT_TLF"}:{type:"PROTOTYPE_BACKGROUND"}},getPrototypeNode:S=>{var g;return(g=e.state().scene())==null?void 0:g.findNode2(S)},getTopmostFrameNode:S=>e.state().prototypeState().getTopmostScreen(),mapChildren:(S,g)=>{let b=[];if(S.isStack())for(let T=0,I=S.childCount();T<I;T=T+1)b.push(g(S.childAt1(T)));else for(let T=0,I=S.childCount();T<I;T=T+1)b.push(g(S.childAt1(S.childCount()-T-1)));return b},nodeId:S=>S.id(),nodeName:S=>S.name(),nodeParent:S=>S.parent(),nodeType:S=>S.type(),nodeCanvasSpaceBounds:S=>o_(S.canvasSpacePreviewBounds()),nodeDisplayBounds:S=>{let g=null;if(S.parent().type()=="CANVAS"){let b=e.state().prototypeState().getOpenOverlayData(S.id());b!=null?g=b.renderedBounds(e.state().prototypeState().getCurrentBaseScreenNode()):g=S.canvasSpaceScrolledBounds(1),g=e.canvasView().viewport().canvasSpaceToViewSpace1().transformRect(g.clone())}else{let b=S.fullSize(),T=new U(0,0,b.x(),b.y()),I=S.relativeTransform().clone(),O=oe.new2();O.scale2(e.canvasView().viewport().canvasSpaceToViewSpace1().scale()),I.leftMultiply(O),g=I.transformRect(T)}return o_(g)},nodeFillTypes:S=>S.fillPaints().map(g=>g.type()),nodeInteractions:S=>S.prototypeInteractions().filter(g=>g.action()!=null&&g.action().value.connectionType()!="NONE").map(g=>IN(g)),nodeScrollBounds:S=>{let g=null;if(S.hasOverflowingContentInScrollDirection()){let b=S.canvasSpaceContentBounds(),T=S.scrollOffset();g={x:T.x(),y:T.y(),width:b.width(),height:b.height()}}return g},nodeScrollTo:(S,g,b)=>{S.setScrollOffset(new E(g,b))},nodeText:S=>{var g;return(g=S==null?void 0:S.textData())==null?void 0:g.characters()},nodeVisible:S=>S==null?!1:S.visible(),nodeAccessibilityProperties:S=>({label:S.accessibleLabel()}),nodeCharacterStyles:S=>{var b,T,I,O;let g=(b=S==null?void 0:S.textData())==null?void 0:b.characters();if(g!=null){let w=Sn._new();Sn.set(w,6,S.get2(6));let P=(T=S==null?void 0:S.textData())==null?void 0:T.characterStyleIds(),H=(O=(I=S==null?void 0:S.textData())==null?void 0:I.styleOverrideTable())!=null?O:new Xn,re=P!=null?P.length:0,q=0,W=0,x=[],F=(k,G,M)=>{let Q=new Map;Sn.each(w,(B,te)=>{Q.set(Ot[B],te)});let Y=H==null?void 0:H.styleByID2();if(Y!=null){let B=qt.IntMap_get(Y,M,null);B!=null&&Sn.each(B,(te,j)=>{Q.set(Ot[te],j)})}x.push({start:k,end:G,props:Q})};for(let k=0,G=g.length;k<G;k=k+1){let M=re>k?P[k]:0;H._in(M)||(M=0),q!=M&&(F(W,k,q),q=M,W=k)}return F(W,g.length,q),x}else return[]},nodeLineData:S=>{var b;let g=(b=S==null?void 0:S.textData())==null?void 0:b.lines();return g!=null?g.map(T=>({indentLevel:T.indentationLevel,lineType:T.lineType})):null},nodeTriggerInteraction:(S,g)=>{let b=0;g=="ON_CLICK"&&(b=4);let T=e.state().prototypeStructure().findHotspotsWithInteractionType(S,0,g);for(let I of T){let O=e.state().prototypeStructure().findPrototypeInteractionsWithInteractionType(I.node,g);for(let w of O){e.canvasView().triggerHotspot(I,w,b,null);return}}},nodeHover:S=>{let g=new Bo(S);e.canvasView().handleHoverAtHotspot(g)},nodeReverseHover:S=>{let g=new Bo(S);e.canvasView().handleReverseHoverAtHotspot(g)},nodeTableCells:S=>{if(S.type()!="TABLE")return null;let g=[];for(let b=0,T=S.childCount();b<T;b=b+1)g.push(S.childAt1(S.childCount()-b-1));return g},nodeTableCellContent:S=>{var g,b;return S.type()!="TABLE_CELL"?null:(b=(g=S.childAt1(0))==null?void 0:g.textData())==null?void 0:b.characters()},nodeInteractiveSlideConfigData:S=>S.interactiveSlideConfigData(),nodeInteractiveSlideParticipantData:S=>S.interactiveSlideParticipantData(),getCurrentOverlayStack:()=>e.state().prototypeState().getCurrentOverlays().map(S=>S.node()),setFeatureFlagsForTesting:S=>{X.setFeatureFlags(S)},setPrototypeBackgroundColorOverride:S=>{let g=C.new2(S>>16&255,S>>8&255,S&255,255);X.setPrototypeBackgroundColorOverride(new Se(g))},resetStateForTests:()=>{e.canvasView().resetStateForTests()},takeSpectorSnapshot:()=>{e.canvasView().viewport().invalidate(),e.canvasView().getContext().takeSpectorSnapshot()},clearTileCachesAndTakeSpectorSnapshot:()=>{e.canvasView().viewport().invalidate(),e.canvasView().clearTileCaches(),e.canvasView().getContext().takeSpectorSnapshot()},renderLayerByLayerActivate:()=>{X.internalDebugTools()&&(e.canvasView().viewport().invalidate(),e.canvasView().clearTileCaches(),e.canvasView().renderLayerByLayerActivate())},renderLayerByLayerDeactivate:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerDeactivate()},renderLayerByLayerPlay:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerPlay()},renderLayerByLayerPause:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerPause()},renderLayerByLayerForward:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerForward()},renderLayerByLayerBackward:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerBackward()},renderLayerByLayerRewind:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerRewind()},renderLayerByLayerIncreaseSpeed:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerIncreaseSpeed()},renderLayerByLayerDecreaseSpeed:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerDecreaseSpeed()},toggleRenderTreePrinting:()=>{X.internalDebugTools()&&e.canvasView().toggleRenderTreePrinting()}};return 3==0&&(y.app=e),lr.instance.setViewer(y),y}function CN(){return new nc(lr.instance,Za.instance,lr.instance)}function Cv(){let i=window,e=i.Fig;e||(i.Fig=e={}),e.createViewer=t=>{if(delete e.createViewer,!(t instanceof Object))throw new Error("Missing parameters");return EN(t)},e.getPrototypeAppBindingsForTest=()=>(delete e.getPrototypeAppBindingsForTest,CN())}function wN(){console.debug("viewer build: sk"),Cv()}wN();})();
//!!!!!!!!!!!!!!!!!!!!!!
/*! Bundled license information:

diff/dist/diff.js:
  (*!
  
   diff v3.5.0
  
  Software License Agreement (BSD License)
  
  Copyright (c) 2009-2015, Kevin Decker <kpdecker@gmail.com>
  
  All rights reserved.
  
  Redistribution and use of this software in source and binary forms, with or without modification,
  are permitted provided that the following conditions are met:
  
  * Redistributions of source code must retain the above
    copyright notice, this list of conditions and the
    following disclaimer.
  
  * Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the
    following disclaimer in the documentation and/or other
    materials provided with the distribution.
  
  * Neither the name of Kevin Decker nor the names of its
    contributors may be used to endorse or promote products
    derived from this software without specific prior
    written permission.
  
  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR
  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
  FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
  IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
  OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  @license
  *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=https://admin.figma.com/admin/viewerbuild-artifacts/9fd37c025b8918aac3d40f72f10f3773586fcfb9/ts-viewer.js.map

//# debugId=8ebcdabe-4469-56a6-9d9c-320e57af2f61
